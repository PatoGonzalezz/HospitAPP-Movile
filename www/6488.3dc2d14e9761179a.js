"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6488],{4562:(vs,Ft,F)=>{F.d(Ft,{$:()=>rl,A:()=>Qe,G:()=>Ut,K:()=>Zu,L:()=>Or,N:()=>Nt,P:()=>ah,R:()=>oh,U:()=>pe,V:()=>Tn,W:()=>tl,X:()=>nl,Y:()=>qc,Z:()=>Li,_:()=>dr,a:()=>Ma,a0:()=>zc,a1:()=>Ks,a2:()=>wa,a3:()=>js,a4:()=>Gc,a5:()=>qi,a6:()=>$c,a7:()=>ul,a8:()=>ll,a9:()=>cl,aA:()=>la,aB:()=>ge,aC:()=>L,aD:()=>Pn,aE:()=>q,aF:()=>ue,aG:()=>yo,aH:()=>Ll,aI:()=>ch,aJ:()=>Ne,aN:()=>jr,aQ:()=>Rt,aa:()=>hl,ab:()=>dl,ac:()=>rn,ad:()=>Kc,ae:()=>fl,af:()=>ba,ag:()=>pl,ah:()=>Zc,ak:()=>ml,al:()=>xa,am:()=>gl,ap:()=>Wc,aq:()=>Vt,as:()=>Rn,at:()=>Kr,au:()=>Dt,av:()=>ur,aw:()=>ws,ax:()=>ye,ay:()=>So,az:()=>it,b:()=>wl,c:()=>Ot,d:()=>pt,e:()=>Yi,f:()=>hh,g:()=>mh,h:()=>fh,i:()=>ih,j:()=>_h,k:()=>Gl,l:()=>Wa,m:()=>lt,o:()=>Zl,p:()=>Ae,r:()=>Nl,s:()=>Dl,u:()=>ho});var g=F(5861),R=F(9058),A=F(534),he=F(7879),gt=F(7582),D=F(4537);const Ae={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Qe={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};const Ut=function Tt(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},ct=function $t(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},bn=new R.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),xn=new he.Yd("@firebase/auth");function ne(l,...a){xn.logLevel<=he.in.ERROR&&xn.error(`Auth (${A.SDK_VERSION}): ${l}`,...a)}function ye(l,...a){throw et(l,...a)}function ge(l,...a){return et(l,...a)}function Ee(l,a,u){const c=Object.assign(Object.assign({},ct()),{[a]:u});return new R.LL("auth","Firebase",c).create(a,{appName:l.name})}function oe(l,a,u){if(!(a instanceof u))throw u.name!==a.constructor.name&&ye(l,"argument-error"),Ee(l,"argument-error",`Type of ${a.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function et(l,...a){if("string"!=typeof l){const u=a[0],c=[...a.slice(1)];return c[0]&&(c[0].appName=l.name),l._errorFactory.create(u,...c)}return bn.create(l,...a)}function L(l,a,...u){if(!l)throw et(a,...u)}function $e(l){const a="INTERNAL ASSERTION FAILED: "+l;throw ne(a),new Error(a)}function Dt(l,a){l||$e(a)}function Yt(){var l;return typeof self<"u"&&(null===(l=self.location)||void 0===l?void 0:l.href)||""}function Nn(){return"http:"===_i()||"https:"===_i()}function _i(){var l;return typeof self<"u"&&(null===(l=self.location)||void 0===l?void 0:l.protocol)||null}class mn{constructor(a,u){this.shortDelay=a,this.longDelay=u,Dt(u>a,"Short delay should be less than long delay!"),this.isMobile=(0,R.uI)()||(0,R.b$)()}get(){return function Ts(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Nn()||(0,R.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function As(l,a){Dt(l.emulator,"Emulator should always be set here");const{url:u}=l.emulator;return a?`${u}${a.startsWith("/")?a.slice(1):a}`:u}class gn{static initialize(a,u,c){this.fetchImpl=a,u&&(this.headersImpl=u),c&&(this.responseImpl=c)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:typeof globalThis<"u"&&globalThis.fetch?globalThis.fetch:typeof fetch<"u"?fetch:void $e("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:typeof globalThis<"u"&&globalThis.Headers?globalThis.Headers:typeof Headers<"u"?Headers:void $e("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:typeof globalThis<"u"&&globalThis.Response?globalThis.Response:typeof Response<"u"?Response:void $e("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Ie={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Vn=new mn(3e4,6e4);function ae(l,a){return l.tenantId&&!a.tenantId?Object.assign(Object.assign({},a),{tenantId:l.tenantId}):a}function we(l,a,u,c){return yi.apply(this,arguments)}function yi(){return(yi=(0,g.Z)(function*(l,a,u,c,p={}){return Jt(l,p,(0,g.Z)(function*(){let _={},T={};c&&("GET"===a?T=c:_={body:JSON.stringify(c)});const b=(0,R.xO)(Object.assign({key:l.config.apiKey},T)).slice(1),k=yield l._getAdditionalHeaders();return k["Content-Type"]="application/json",l.languageCode&&(k["X-Firebase-Locale"]=l.languageCode),gn.fetch()(br(l,l.config.apiHost,u,b),Object.assign({method:a,headers:k,referrerPolicy:"no-referrer"},_))}))})).apply(this,arguments)}function Jt(l,a,u){return Ii.apply(this,arguments)}function Ii(){return(Ii=(0,g.Z)(function*(l,a,u){l._canInitEmulator=!1;const c=Object.assign(Object.assign({},Ie),a);try{const p=new sa(l),_=yield Promise.race([u(),p.promise]);p.clearNetworkTimeout();const T=yield _.json();if("needConfirmation"in T)throw kn(l,"account-exists-with-different-credential",T);if(_.ok&&!("errorMessage"in T))return T;{const b=_.ok?T.errorMessage:T.error.message,[k,$]=b.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===k)throw kn(l,"credential-already-in-use",T);if("EMAIL_EXISTS"===k)throw kn(l,"email-already-in-use",T);if("USER_DISABLED"===k)throw kn(l,"user-disabled",T);const Q=c[k]||k.toLowerCase().replace(/[_\s]+/g,"-");if($)throw Ee(l,Q,$);ye(l,Q)}}catch(p){if(p instanceof R.ZR)throw p;ye(l,"network-request-failed",{message:String(p)})}})).apply(this,arguments)}function Bt(l,a,u,c){return er.apply(this,arguments)}function er(){return(er=(0,g.Z)(function*(l,a,u,c,p={}){const _=yield we(l,a,u,c,p);return"mfaPendingCredential"in _&&ye(l,"multi-factor-auth-required",{_serverResponse:_}),_})).apply(this,arguments)}function br(l,a,u,c){const p=`${a}${u}?${c}`;return l.config.emulator?As(l.config,p):`${l.config.apiScheme}://${p}`}function ia(l){switch(l){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class sa{constructor(a){this.auth=a,this.timer=null,this.promise=new Promise((u,c)=>{this.timer=setTimeout(()=>c(ge(this.auth,"network-request-failed")),Vn.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function kn(l,a,u){const c={appName:l.name};u.email&&(c.email=u.email),u.phoneNumber&&(c.phoneNumber=u.phoneNumber);const p=ge(l,a,c);return p.customData._tokenResponse=u,p}function ht(l){return void 0!==l&&void 0!==l.getResponse}function z(l){return void 0!==l&&void 0!==l.enterprise}class tr{constructor(a){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===a.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=a.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=a.recaptchaEnforcementState}getProviderEnforcementState(a){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const u of this.recaptchaEnforcementState)if(u.provider&&u.provider===a)return ia(u.enforcementState);return null}isProviderEnabled(a){return"ENFORCE"===this.getProviderEnforcementState(a)||"AUDIT"===this.getProviderEnforcementState(a)}}function Xt(){return(Xt=(0,g.Z)(function*(l){return(yield we(l,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function On(l,a){return at.apply(this,arguments)}function at(){return(at=(0,g.Z)(function*(l,a){return we(l,"GET","/v2/recaptchaConfig",ae(l,a))})).apply(this,arguments)}function xr(){return(xr=(0,g.Z)(function*(l,a){return we(l,"POST","/v1/accounts:delete",a)})).apply(this,arguments)}function nr(){return(nr=(0,g.Z)(function*(l,a){return we(l,"POST","/v1/accounts:update",a)})).apply(this,arguments)}function Ln(){return(Ln=(0,g.Z)(function*(l,a){return we(l,"POST","/v1/accounts:lookup",a)})).apply(this,arguments)}function De(l){if(l)try{const a=new Date(Number(l));if(!isNaN(a.getTime()))return a.toUTCString()}catch{}}function rr(){return(rr=(0,g.Z)(function*(l,a=!1){const u=(0,R.m9)(l),c=yield u.getIdToken(a),p=sr(c);L(p&&p.exp&&p.auth_time&&p.iat,u.auth,"internal-error");const _="object"==typeof p.firebase?p.firebase:void 0,T=_?.sign_in_provider;return{claims:p,token:c,authTime:De(ir(p.auth_time)),issuedAtTime:De(ir(p.iat)),expirationTime:De(ir(p.exp)),signInProvider:T||null,signInSecondFactor:_?.sign_in_second_factor||null}})).apply(this,arguments)}function ir(l){return 1e3*Number(l)}function sr(l){const[a,u,c]=l.split(".");if(void 0===a||void 0===u||void 0===c)return ne("JWT malformed, contained fewer than 3 sections"),null;try{const p=(0,R.tV)(u);return p?JSON.parse(p):(ne("Failed to decode base64 JWT payload"),null)}catch(p){return ne("Caught error parsing JWT payload as JSON",p?.toString()),null}}function qt(l,a){return Be.apply(this,arguments)}function Be(){return(Be=(0,g.Z)(function*(l,a,u=!1){if(u)return a;try{return yield a}catch(c){throw c instanceof R.ZR&&function Mn({code:l}){return"auth/user-disabled"===l||"auth/user-token-expired"===l}(c)&&l.auth.currentUser===l&&(yield l.auth.signOut()),c}})).apply(this,arguments)}class At{constructor(a){this.user=a,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(a){var u;if(a){const c=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),c}{this.errorBackoff=3e4;const p=(null!==(u=this.user.stsTokenManager.expirationTime)&&void 0!==u?u:0)-Date.now()-3e5;return Math.max(0,p)}}schedule(a=!1){var u=this;if(!this.isRunning)return;const c=this.getInterval(a);this.timerId=setTimeout((0,g.Z)(function*(){yield u.iteration()}),c)}iteration(){var a=this;return(0,g.Z)(function*(){try{yield a.user.getIdToken(!0)}catch(u){return void("auth/network-request-failed"===u?.code&&a.schedule(!0))}a.schedule()})()}}class Dr{constructor(a,u){this.createdAt=a,this.lastLoginAt=u,this._initializeTime()}_initializeTime(){this.lastSignInTime=De(this.lastLoginAt),this.creationTime=De(this.createdAt)}_copy(a){this.createdAt=a.createdAt,this.lastLoginAt=a.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function _t(l){return In.apply(this,arguments)}function In(){return In=(0,g.Z)(function*(l){var a;const u=l.auth,c=yield l.getIdToken(),p=yield qt(l,function Ke(l,a){return Ln.apply(this,arguments)}(u,{idToken:c}));L(p?.users.length,u,"internal-error");const _=p.users[0];l._notifyReloadListener(_);const T=null!==(a=_.providerUserInfo)&&void 0!==a&&a.length?function Nr(l){return l.map(a=>{var{providerId:u}=a,c=(0,gt._T)(a,["providerId"]);return{providerId:u,uid:c.rawId||"",displayName:c.displayName||null,email:c.email||null,phoneNumber:c.phoneNumber||null,photoURL:c.photoUrl||null}})}(_.providerUserInfo):[],b=function vi(l,a){return[...l.filter(c=>!a.some(p=>p.providerId===c.providerId)),...a]}(l.providerData,T),Q=!!l.isAnonymous&&!(l.email&&_.passwordHash||b?.length),de={uid:_.localId,displayName:_.displayName||null,photoURL:_.photoUrl||null,email:_.email||null,emailVerified:_.emailVerified||!1,phoneNumber:_.phoneNumber||null,tenantId:_.tenantId||null,providerData:b,metadata:new Dr(_.createdAt,_.lastLoginAt),isAnonymous:Q};Object.assign(l,de)}),In.apply(this,arguments)}function or(){return(or=(0,g.Z)(function*(l){const a=(0,R.m9)(l);yield _t(a),yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)})).apply(this,arguments)}function Vr(){return(Vr=(0,g.Z)(function*(l,a){const u=yield Jt(l,{},(0,g.Z)(function*(){const c=(0,R.xO)({grant_type:"refresh_token",refresh_token:a}).slice(1),{tokenApiHost:p,apiKey:_}=l.config,T=br(l,p,"/v1/token",`key=${_}`),b=yield l._getAdditionalHeaders();return b["Content-Type"]="application/x-www-form-urlencoded",gn.fetch()(T,{method:"POST",headers:b,body:c})}));return{accessToken:u.access_token,expiresIn:u.expires_in,refreshToken:u.refresh_token}})).apply(this,arguments)}function ar(){return(ar=(0,g.Z)(function*(l,a){return we(l,"POST","/v2/accounts:revokeToken",ae(l,a))})).apply(this,arguments)}class S{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(a){L(a.idToken,"internal-error"),L(typeof a.idToken<"u","internal-error"),L(typeof a.refreshToken<"u","internal-error");const u="expiresIn"in a&&typeof a.expiresIn<"u"?Number(a.expiresIn):function tt(l){const a=sr(l);return L(a,"internal-error"),L(typeof a.exp<"u","internal-error"),L(typeof a.iat<"u","internal-error"),Number(a.exp)-Number(a.iat)}(a.idToken);this.updateTokensAndExpiration(a.idToken,a.refreshToken,u)}getToken(a,u=!1){var c=this;return(0,g.Z)(function*(){return L(!c.accessToken||c.refreshToken,a,"user-token-expired"),u||!c.accessToken||c.isExpired?c.refreshToken?(yield c.refresh(a,c.refreshToken),c.accessToken):null:c.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(a,u){var c=this;return(0,g.Z)(function*(){const{accessToken:p,refreshToken:_,expiresIn:T}=yield function aa(l,a){return Vr.apply(this,arguments)}(a,u);c.updateTokensAndExpiration(p,_,Number(T))})()}updateTokensAndExpiration(a,u,c){this.refreshToken=u||null,this.accessToken=a||null,this.expirationTime=Date.now()+1e3*c}static fromJSON(a,u){const{refreshToken:c,accessToken:p,expirationTime:_}=u,T=new S;return c&&(L("string"==typeof c,"internal-error",{appName:a}),T.refreshToken=c),p&&(L("string"==typeof p,"internal-error",{appName:a}),T.accessToken=p),_&&(L("number"==typeof _,"internal-error",{appName:a}),T.expirationTime=_),T}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(a){this.accessToken=a.accessToken,this.refreshToken=a.refreshToken,this.expirationTime=a.expirationTime}_clone(){return Object.assign(new S,this.toJSON())}_performRefresh(){return $e("not implemented")}}function E(l,a){L("string"==typeof l||typeof l>"u","internal-error",{appName:a})}class v{constructor(a){var{uid:u,auth:c,stsTokenManager:p}=a,_=(0,gt._T)(a,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new At(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=u,this.auth=c,this.stsTokenManager=p,this.accessToken=p.accessToken,this.displayName=_.displayName||null,this.email=_.email||null,this.emailVerified=_.emailVerified||!1,this.phoneNumber=_.phoneNumber||null,this.photoURL=_.photoURL||null,this.isAnonymous=_.isAnonymous||!1,this.tenantId=_.tenantId||null,this.providerData=_.providerData?[..._.providerData]:[],this.metadata=new Dr(_.createdAt||void 0,_.lastLoginAt||void 0)}getIdToken(a){var u=this;return(0,g.Z)(function*(){const c=yield qt(u,u.stsTokenManager.getToken(u.auth,a));return L(c,u.auth,"internal-error"),u.accessToken!==c&&(u.accessToken=c,yield u.auth._persistUserIfCurrent(u),u.auth._notifyListenersIfCurrent(u)),c})()}getIdTokenResult(a){return function en(l){return rr.apply(this,arguments)}(this,a)}reload(){return function vn(l){return or.apply(this,arguments)}(this)}_assign(a){this!==a&&(L(this.uid===a.uid,this.auth,"internal-error"),this.displayName=a.displayName,this.photoURL=a.photoURL,this.email=a.email,this.emailVerified=a.emailVerified,this.phoneNumber=a.phoneNumber,this.isAnonymous=a.isAnonymous,this.tenantId=a.tenantId,this.providerData=a.providerData.map(u=>Object.assign({},u)),this.metadata._copy(a.metadata),this.stsTokenManager._assign(a.stsTokenManager))}_clone(a){const u=new v(Object.assign(Object.assign({},this),{auth:a,stsTokenManager:this.stsTokenManager._clone()}));return u.metadata._copy(this.metadata),u}_onReload(a){L(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=a,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(a){this.reloadListener?this.reloadListener(a):this.reloadUserInfo=a}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(a,u=!1){var c=this;return(0,g.Z)(function*(){let p=!1;a.idToken&&a.idToken!==c.stsTokenManager.accessToken&&(c.stsTokenManager.updateFromServerResponse(a),p=!0),u&&(yield _t(c)),yield c.auth._persistUserIfCurrent(c),p&&c.auth._notifyListenersIfCurrent(c)})()}delete(){var a=this;return(0,g.Z)(function*(){const u=yield a.getIdToken();return yield qt(a,function _n(l,a){return xr.apply(this,arguments)}(a.auth,{idToken:u})),a.stsTokenManager.clearRefreshToken(),a.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(a=>Object.assign({},a)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(a,u){var c,p,_,T,b,k,$,Q;const de=null!==(c=u.displayName)&&void 0!==c?c:void 0,Ct=null!==(p=u.email)&&void 0!==p?p:void 0,cn=null!==(_=u.phoneNumber)&&void 0!==_?_:void 0,hn=null!==(T=u.photoURL)&&void 0!==T?T:void 0,si=null!==(b=u.tenantId)&&void 0!==b?b:void 0,oi=null!==(k=u._redirectEventId)&&void 0!==k?k:void 0,rs=null!==($=u.createdAt)&&void 0!==$?$:void 0,tu=null!==(Q=u.lastLoginAt)&&void 0!==Q?Q:void 0,{uid:Do,emailVerified:dn,isAnonymous:nu,providerData:Zn,stsTokenManager:ru}=u;L(Do&&ru,a,"internal-error");const iu=S.fromJSON(this.name,ru);L("string"==typeof Do,a,"internal-error"),E(de,a.name),E(Ct,a.name),L("boolean"==typeof dn,a,"internal-error"),L("boolean"==typeof nu,a,"internal-error"),E(cn,a.name),E(hn,a.name),E(si,a.name),E(oi,a.name),E(rs,a.name),E(tu,a.name);const jn=new v({uid:Do,auth:a,email:Ct,emailVerified:dn,displayName:de,isAnonymous:nu,photoURL:hn,phoneNumber:cn,tenantId:si,stsTokenManager:iu,createdAt:rs,lastLoginAt:tu});return Zn&&Array.isArray(Zn)&&(jn.providerData=Zn.map(vt=>Object.assign({},vt))),oi&&(jn._redirectEventId=oi),jn}static _fromIdTokenResponse(a,u,c=!1){return(0,g.Z)(function*(){const p=new S;p.updateFromServerResponse(u);const _=new v({uid:u.localId,auth:a,stsTokenManager:p,isAnonymous:c});return yield _t(_),_})()}}const x=new Map;function q(l){Dt(l instanceof Function,"Expected a class definition");let a=x.get(l);return a?(Dt(a instanceof l,"Instance stored in cache mismatched with class"),a):(a=new l,x.set(l,a),a)}const pe=(()=>{class l{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,g.Z)(function*(){return!0})()}_set(u,c){var p=this;return(0,g.Z)(function*(){p.storage[u]=c})()}_get(u){var c=this;return(0,g.Z)(function*(){const p=c.storage[u];return void 0===p?null:p})()}_remove(u){var c=this;return(0,g.Z)(function*(){delete c.storage[u]})()}_addListener(u,c){}_removeListener(u,c){}}return l.type="NONE",l})();function ue(l,a,u){return`firebase:${l}:${a}:${u}`}class Fe{constructor(a,u,c){this.persistence=a,this.auth=u,this.userKey=c;const{config:p,name:_}=this.auth;this.fullUserKey=ue(this.userKey,p.apiKey,_),this.fullPersistenceKey=ue("persistence",p.apiKey,_),this.boundEventHandler=u._onStorageEvent.bind(u),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(a){return this.persistence._set(this.fullUserKey,a.toJSON())}getCurrentUser(){var a=this;return(0,g.Z)(function*(){const u=yield a.persistence._get(a.fullUserKey);return u?v._fromJSON(a.auth,u):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(a){var u=this;return(0,g.Z)(function*(){if(u.persistence===a)return;const c=yield u.getCurrentUser();return yield u.removeCurrentUser(),u.persistence=a,c?u.setCurrentUser(c):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(a,u,c="authUser"){return(0,g.Z)(function*(){if(!u.length)return new Fe(q(pe),a,c);const p=(yield Promise.all(u.map(function(){var $=(0,g.Z)(function*(Q){if(yield Q._isAvailable())return Q});return function(Q){return $.apply(this,arguments)}}()))).filter($=>$);let _=p[0]||q(pe);const T=ue(c,a.config.apiKey,a.name);let b=null;for(const $ of u)try{const Q=yield $._get(T);if(Q){const de=v._fromJSON(a,Q);$!==_&&(b=de),_=$;break}}catch{}const k=p.filter($=>$._shouldAllowMigration);return _._shouldAllowMigration&&k.length?(_=k[0],b&&(yield _._set(T,b.toJSON())),yield Promise.all(u.map(function(){var $=(0,g.Z)(function*(Q){if(Q!==_)try{yield Q._remove(T)}catch{}});return function(Q){return $.apply(this,arguments)}}())),new Fe(_,a,c)):new Fe(_,a,c)})()}}function wt(l){const a=l.toLowerCase();if(a.includes("opera/")||a.includes("opr/")||a.includes("opios/"))return"Opera";if(kr(a))return"IEMobile";if(a.includes("msie")||a.includes("trident/"))return"IE";if(a.includes("edge/"))return"Edge";if(dt(a))return"Firefox";if(a.includes("silk/"))return"Silk";if(ua(a))return"Blackberry";if(Ti(a))return"Webos";if(le(a))return"Safari";if((a.includes("chrome/")||Kt(a))&&!a.includes("edge/"))return"Chrome";if(ws(a))return"Android";{const c=l.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===c?.length)return c[1]}return"Other"}function dt(l=(0,R.z$)()){return/firefox\//i.test(l)}function le(l=(0,R.z$)()){const a=l.toLowerCase();return a.includes("safari/")&&!a.includes("chrome/")&&!a.includes("crios/")&&!a.includes("android")}function Kt(l=(0,R.z$)()){return/crios\//i.test(l)}function kr(l=(0,R.z$)()){return/iemobile/i.test(l)}function ws(l=(0,R.z$)()){return/android/i.test(l)}function ua(l=(0,R.z$)()){return/blackberry/i.test(l)}function Ti(l=(0,R.z$)()){return/webos/i.test(l)}function ur(l=(0,R.z$)()){return/iphone|ipad|ipod/i.test(l)||/macintosh/i.test(l)&&/mobile/i.test(l)}function la(l=(0,R.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(l)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(l)}function da(l=(0,R.z$)()){return ur(l)||ws(l)||Ti(l)||ua(l)||/windows phone/i.test(l)||kr(l)}function qu(l,a=[]){let u;switch(l){case"Browser":u=wt((0,R.z$)());break;case"Worker":u=`${wt((0,R.z$)())}-${l}`;break;default:u=l}const c=a.length?a.join(","):"FirebaseCore-web";return`${u}/JsCore/${A.SDK_VERSION}/${c}`}class zu{constructor(a){this.auth=a,this.queue=[]}pushCallback(a,u){const c=_=>new Promise((T,b)=>{try{T(a(_))}catch(k){b(k)}});c.onAbort=u,this.queue.push(c);const p=this.queue.length-1;return()=>{this.queue[p]=()=>Promise.resolve()}}runMiddleware(a){var u=this;return(0,g.Z)(function*(){if(u.auth.currentUser===a)return;const c=[];try{for(const p of u.queue)yield p(a),p.onAbort&&c.push(p.onAbort)}catch(p){c.reverse();for(const _ of c)try{_()}catch{}throw u.auth._errorFactory.create("login-blocked",{originalMessage:p?.message})}})()}}function Ai(){return(Ai=(0,g.Z)(function*(l,a={}){return we(l,"GET","/v2/passwordPolicy",ae(l,a))})).apply(this,arguments)}class Oc{constructor(a){var u,c,p,_;const T=a.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(u=T.minPasswordLength)&&void 0!==u?u:6,T.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=T.maxPasswordLength),void 0!==T.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=T.containsLowercaseCharacter),void 0!==T.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=T.containsUppercaseCharacter),void 0!==T.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=T.containsNumericCharacter),void 0!==T.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=T.containsNonAlphanumericCharacter),this.enforcementState=a.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(p=null===(c=a.allowedNonAlphanumericCharacters)||void 0===c?void 0:c.join(""))&&void 0!==p?p:"",this.forceUpgradeOnSignin=null!==(_=a.forceUpgradeOnSignin)&&void 0!==_&&_,this.schemaVersion=a.schemaVersion}validatePassword(a){var u,c,p,_,T,b;const k={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(a,k),this.validatePasswordCharacterOptions(a,k),k.isValid&&(k.isValid=null===(u=k.meetsMinPasswordLength)||void 0===u||u),k.isValid&&(k.isValid=null===(c=k.meetsMaxPasswordLength)||void 0===c||c),k.isValid&&(k.isValid=null===(p=k.containsLowercaseLetter)||void 0===p||p),k.isValid&&(k.isValid=null===(_=k.containsUppercaseLetter)||void 0===_||_),k.isValid&&(k.isValid=null===(T=k.containsNumericCharacter)||void 0===T||T),k.isValid&&(k.isValid=null===(b=k.containsNonAlphanumericCharacter)||void 0===b||b),k}validatePasswordLengthOptions(a,u){const c=this.customStrengthOptions.minPasswordLength,p=this.customStrengthOptions.maxPasswordLength;c&&(u.meetsMinPasswordLength=a.length>=c),p&&(u.meetsMaxPasswordLength=a.length<=p)}validatePasswordCharacterOptions(a,u){let c;this.updatePasswordCharacterOptionsStatuses(u,!1,!1,!1,!1);for(let p=0;p<a.length;p++)c=a.charAt(p),this.updatePasswordCharacterOptionsStatuses(u,c>="a"&&c<="z",c>="A"&&c<="Z",c>="0"&&c<="9",this.allowedNonAlphanumericCharacters.includes(c))}updatePasswordCharacterOptionsStatuses(a,u,c,p,_){this.customStrengthOptions.containsLowercaseLetter&&(a.containsLowercaseLetter||(a.containsLowercaseLetter=u)),this.customStrengthOptions.containsUppercaseLetter&&(a.containsUppercaseLetter||(a.containsUppercaseLetter=c)),this.customStrengthOptions.containsNumericCharacter&&(a.containsNumericCharacter||(a.containsNumericCharacter=p)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(a.containsNonAlphanumericCharacter||(a.containsNonAlphanumericCharacter=_))}}class fa{constructor(a,u,c,p){this.app=a,this.heartbeatServiceProvider=u,this.appCheckServiceProvider=c,this.config=p,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Rs(this),this.idTokenSubscription=new Rs(this),this.beforeStateQueue=new zu(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=bn,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=a.name,this.clientVersion=p.sdkClientVersion}_initializeWithPersistence(a,u){var c=this;return u&&(this._popupRedirectResolver=q(u)),this._initializationPromise=this.queue((0,g.Z)(function*(){var p,_;if(!c._deleted&&(c.persistenceManager=yield Fe.create(c,a),!c._deleted)){if(null!==(p=c._popupRedirectResolver)&&void 0!==p&&p._shouldInitProactively)try{yield c._popupRedirectResolver._initialize(c)}catch{}yield c.initializeCurrentUser(u),c.lastNotifiedUid=(null===(_=c.currentUser)||void 0===_?void 0:_.uid)||null,!c._deleted&&(c._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var a=this;return(0,g.Z)(function*(){if(a._deleted)return;const u=yield a.assertedPersistence.getCurrentUser();if(a.currentUser||u){if(a.currentUser&&u&&a.currentUser.uid===u.uid)return a._currentUser._assign(u),void(yield a.currentUser.getIdToken());yield a._updateCurrentUser(u,!0)}})()}initializeCurrentUser(a){var u=this;return(0,g.Z)(function*(){var c;const p=yield u.assertedPersistence.getCurrentUser();let _=p,T=!1;if(a&&u.config.authDomain){yield u.getOrInitRedirectPersistenceManager();const b=null===(c=u.redirectUser)||void 0===c?void 0:c._redirectEventId,k=_?._redirectEventId,$=yield u.tryRedirectSignIn(a);(!b||b===k)&&$?.user&&(_=$.user,T=!0)}if(!_)return u.directlySetCurrentUser(null);if(!_._redirectEventId){if(T)try{yield u.beforeStateQueue.runMiddleware(_)}catch(b){_=p,u._popupRedirectResolver._overrideRedirectResult(u,()=>Promise.reject(b))}return _?u.reloadAndSetCurrentUserOrClear(_):u.directlySetCurrentUser(null)}return L(u._popupRedirectResolver,u,"argument-error"),yield u.getOrInitRedirectPersistenceManager(),u.redirectUser&&u.redirectUser._redirectEventId===_._redirectEventId?u.directlySetCurrentUser(_):u.reloadAndSetCurrentUserOrClear(_)})()}tryRedirectSignIn(a){var u=this;return(0,g.Z)(function*(){let c=null;try{c=yield u._popupRedirectResolver._completeRedirectFn(u,a,!0)}catch{yield u._setRedirectUser(null)}return c})()}reloadAndSetCurrentUserOrClear(a){var u=this;return(0,g.Z)(function*(){try{yield _t(a)}catch(c){if("auth/network-request-failed"!==c?.code)return u.directlySetCurrentUser(null)}return u.directlySetCurrentUser(a)})()}useDeviceLanguage(){this.languageCode=function Xn(){if(typeof navigator>"u")return null;const l=navigator;return l.languages&&l.languages[0]||l.language||null}()}_delete(){var a=this;return(0,g.Z)(function*(){a._deleted=!0})()}updateCurrentUser(a){var u=this;return(0,g.Z)(function*(){const c=a?(0,R.m9)(a):null;return c&&L(c.auth.config.apiKey===u.config.apiKey,u,"invalid-user-token"),u._updateCurrentUser(c&&c._clone(u))})()}_updateCurrentUser(a,u=!1){var c=this;return(0,g.Z)(function*(){if(!c._deleted)return a&&L(c.tenantId===a.tenantId,c,"tenant-id-mismatch"),u||(yield c.beforeStateQueue.runMiddleware(a)),c.queue((0,g.Z)(function*(){yield c.directlySetCurrentUser(a),c.notifyAuthListeners()}))})()}signOut(){var a=this;return(0,g.Z)(function*(){return yield a.beforeStateQueue.runMiddleware(null),(a.redirectPersistenceManager||a._popupRedirectResolver)&&(yield a._setRedirectUser(null)),a._updateCurrentUser(null,!0)})()}setPersistence(a){var u=this;return this.queue((0,g.Z)(function*(){yield u.assertedPersistence.setPersistence(q(a))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(a){var u=this;return(0,g.Z)(function*(){u._getPasswordPolicyInternal()||(yield u._updatePasswordPolicy());const c=u._getPasswordPolicyInternal();return c.schemaVersion!==u.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(u._errorFactory.create("unsupported-password-policy-schema-version",{})):c.validatePassword(a)})()}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){var a=this;return(0,g.Z)(function*(){const u=yield function Wu(l){return Ai.apply(this,arguments)}(a),c=new Oc(u);null===a.tenantId?a._projectPasswordPolicy=c:a._tenantPasswordPolicies[a.tenantId]=c})()}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(a){this._errorFactory=new R.LL("auth","Firebase",a())}onAuthStateChanged(a,u,c){return this.registerStateListener(this.authStateSubscription,a,u,c)}beforeAuthStateChanged(a,u){return this.beforeStateQueue.pushCallback(a,u)}onIdTokenChanged(a,u,c){return this.registerStateListener(this.idTokenSubscription,a,u,c)}authStateReady(){return new Promise((a,u)=>{if(this.currentUser)a();else{const c=this.onAuthStateChanged(()=>{c(),a()},u)}})}revokeAccessToken(a){var u=this;return(0,g.Z)(function*(){if(u.currentUser){const c=yield u.currentUser.getIdToken(),p={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:a,idToken:c};null!=u.tenantId&&(p.tenantId=u.tenantId),yield function Ei(l,a){return ar.apply(this,arguments)}(u,p)}})()}toJSON(){var a;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(a=this._currentUser)||void 0===a?void 0:a.toJSON()}}_setRedirectUser(a,u){var c=this;return(0,g.Z)(function*(){const p=yield c.getOrInitRedirectPersistenceManager(u);return null===a?p.removeCurrentUser():p.setCurrentUser(a)})()}getOrInitRedirectPersistenceManager(a){var u=this;return(0,g.Z)(function*(){if(!u.redirectPersistenceManager){const c=a&&q(a)||u._popupRedirectResolver;L(c,u,"argument-error"),u.redirectPersistenceManager=yield Fe.create(u,[q(c._redirectPersistence)],"redirectUser"),u.redirectUser=yield u.redirectPersistenceManager.getCurrentUser()}return u.redirectPersistenceManager})()}_redirectUserForId(a){var u=this;return(0,g.Z)(function*(){var c,p;return u._isInitialized&&(yield u.queue((0,g.Z)(function*(){}))),(null===(c=u._currentUser)||void 0===c?void 0:c._redirectEventId)===a?u._currentUser:(null===(p=u.redirectUser)||void 0===p?void 0:p._redirectEventId)===a?u.redirectUser:null})()}_persistUserIfCurrent(a){var u=this;return(0,g.Z)(function*(){if(a===u.currentUser)return u.queue((0,g.Z)(function*(){return u.directlySetCurrentUser(a)}))})()}_notifyListenersIfCurrent(a){a===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var a,u;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const c=null!==(u=null===(a=this.currentUser)||void 0===a?void 0:a.uid)&&void 0!==u?u:null;this.lastNotifiedUid!==c&&(this.lastNotifiedUid=c,this.authStateSubscription.next(this.currentUser))}registerStateListener(a,u,c,p){if(this._deleted)return()=>{};const _="function"==typeof u?u:u.next.bind(u);let T=!1;const b=this._isInitialized?Promise.resolve():this._initializationPromise;if(L(b,this,"internal-error"),b.then(()=>{T||_(this.currentUser)}),"function"==typeof u){const k=a.addObserver(u,c,p);return()=>{T=!0,k()}}{const k=a.addObserver(u);return()=>{T=!0,k()}}}directlySetCurrentUser(a){var u=this;return(0,g.Z)(function*(){u.currentUser&&u.currentUser!==a&&u._currentUser._stopProactiveRefresh(),a&&u.isProactiveRefreshEnabled&&a._startProactiveRefresh(),u.currentUser=a,a?yield u.assertedPersistence.setCurrentUser(a):yield u.assertedPersistence.removeCurrentUser()})()}queue(a){return this.operations=this.operations.then(a,a),this.operations}get assertedPersistence(){return L(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(a){!a||this.frameworks.includes(a)||(this.frameworks.push(a),this.frameworks.sort(),this.clientVersion=qu(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var a=this;return(0,g.Z)(function*(){var u;const c={"X-Client-Version":a.clientVersion};a.app.options.appId&&(c["X-Firebase-gmpid"]=a.app.options.appId);const p=yield null===(u=a.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===u?void 0:u.getHeartbeatsHeader();p&&(c["X-Firebase-Client"]=p);const _=yield a._getAppCheckToken();return _&&(c["X-Firebase-AppCheck"]=_),c})()}_getAppCheckToken(){var a=this;return(0,g.Z)(function*(){var u;const c=yield null===(u=a.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===u?void 0:u.getToken();return c?.error&&function Dn(l,...a){xn.logLevel<=he.in.WARN&&xn.warn(`Auth (${A.SDK_VERSION}): ${l}`,...a)}(`Error while retrieving App Check token: ${c.error}`),c?.token})()}}function Ne(l){return(0,R.m9)(l)}class Rs{constructor(a){this.auth=a,this.observer=null,this.addObserver=(0,R.ne)(u=>this.observer=u)}get next(){return L(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Ye(l){return new Promise((a,u)=>{const c=document.createElement("script");c.setAttribute("src",l),c.onload=a,c.onerror=p=>{const _=ge("internal-error");_.customData=p,u(_)},c.type="text/javascript",c.charset="UTF-8",function nt(){var l,a;return null!==(a=null===(l=document.getElementsByTagName("head"))||void 0===l?void 0:l[0])&&void 0!==a?a:document}().appendChild(c)})}function wi(l){return`__${l}${Math.floor(1e6*Math.random())}`}class $u{constructor(a){this.type="recaptcha-enterprise",this.auth=Ne(a)}verify(a="verify",u=!1){var c=this;return(0,g.Z)(function*(){function _(){return _=(0,g.Z)(function*(b){if(!u){if(null==b.tenantId&&null!=b._agentRecaptchaConfig)return b._agentRecaptchaConfig.siteKey;if(null!=b.tenantId&&void 0!==b._tenantRecaptchaConfigs[b.tenantId])return b._tenantRecaptchaConfigs[b.tenantId].siteKey}return new Promise(function(){var k=(0,g.Z)(function*($,Q){On(b,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(de=>{if(void 0!==de.recaptchaKey){const Ct=new tr(de);return null==b.tenantId?b._agentRecaptchaConfig=Ct:b._tenantRecaptchaConfigs[b.tenantId]=Ct,$(Ct.siteKey)}Q(new Error("recaptcha Enterprise site key undefined"))}).catch(de=>{Q(de)})});return function($,Q){return k.apply(this,arguments)}}())}),_.apply(this,arguments)}function T(b,k,$){const Q=window.grecaptcha;z(Q)?Q.enterprise.ready(()=>{Q.enterprise.execute(b,{action:a}).then(de=>{k(de)}).catch(()=>{k("NO_RECAPTCHA")})}):$(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((b,k)=>{(function p(b){return _.apply(this,arguments)})(c.auth).then($=>{if(!u&&z(window.grecaptcha))T($,b,k);else{if(typeof window>"u")return void k(new Error("RecaptchaVerifier is only supported in browser"));Ye("https://www.google.com/recaptcha/enterprise.js?render="+$).then(()=>{T($,b,k)}).catch(Q=>{k(Q)})}}).catch($=>{k($)})})})()}}function ma(l,a,u){return ga.apply(this,arguments)}function ga(){return(ga=(0,g.Z)(function*(l,a,u,c=!1){const p=new $u(l);let _;try{_=yield p.verify(u)}catch{_=yield p.verify(u,!0)}const T=Object.assign({},a);return Object.assign(T,c?{captchaResp:_}:{captchaResponse:_}),Object.assign(T,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(T,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),T})).apply(this,arguments)}function Ri(l,a,u,c){return _a.apply(this,arguments)}function _a(){return _a=(0,g.Z)(function*(l,a,u,c){var p;if(null!==(p=l._getRecaptchaConfig())&&void 0!==p&&p.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const _=yield ma(l,a,u,"getOobCode"===u);return c(l,_)}return c(l,a).catch(function(){var _=(0,g.Z)(function*(T){if("auth/missing-recaptcha-token"===T.code){console.log(`${u} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const b=yield ma(l,a,u,"getOobCode"===u);return c(l,b)}return Promise.reject(T)});return function(T){return _.apply(this,arguments)}}())}),_a.apply(this,arguments)}function Zu(l,a,u){const c=Ne(l);L(c._canInitEmulator,c,"emulator-config-failed"),L(/^https?:\/\//.test(a),c,"invalid-emulator-scheme");const p=!!u?.disableWarnings,_=Si(a),{host:T,port:b}=function Ia(l){const a=Si(l),u=/(\/\/)?([^?#/]+)/.exec(l.substr(a.length));if(!u)return{host:"",port:null};const c=u[2].split("@").pop()||"",p=/^(\[[^\]]+\])(:|$)/.exec(c);if(p){const _=p[1];return{host:_,port:Ps(c.substr(_.length+1))}}{const[_,T]=c.split(":");return{host:_,port:Ps(T)}}}(a);c.config.emulator={url:`${_}//${T}${null===b?"":`:${b}`}/`},c.settings.appVerificationDisabledForTesting=!0,c.emulatorConfig=Object.freeze({host:T,port:b,protocol:_.replace(":",""),options:Object.freeze({disableWarnings:p})}),p||function ju(){function l(){const a=document.createElement("p"),u=a.style;a.innerText="Running in emulator mode. Do not use with production credentials.",u.position="fixed",u.width="100%",u.backgroundColor="#ffffff",u.border=".1em solid #000000",u.color="#b50000",u.bottom="0px",u.left="0px",u.margin="0px",u.zIndex="10000",u.textAlign="center",a.classList.add("firebase-emulator-warning"),document.body.appendChild(a)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",l):l())}()}function Si(l){const a=l.indexOf(":");return a<0?"":l.substr(0,a+1)}function Ps(l){if(!l)return null;const a=Number(l);return isNaN(a)?null:a}class Or{constructor(a,u){this.providerId=a,this.signInMethod=u}toJSON(){return $e("not implemented")}_getIdTokenResponse(a){return $e("not implemented")}_linkToIdToken(a,u){return $e("not implemented")}_getReauthenticationResolver(a){return $e("not implemented")}}function Lr(l,a){return Ss.apply(this,arguments)}function Ss(){return(Ss=(0,g.Z)(function*(l,a){return we(l,"POST","/v1/accounts:resetPassword",ae(l,a))})).apply(this,arguments)}function Cs(){return(Cs=(0,g.Z)(function*(l,a){return we(l,"POST","/v1/accounts:update",a)})).apply(this,arguments)}function bs(l,a){return va.apply(this,arguments)}function va(){return(va=(0,g.Z)(function*(l,a){return we(l,"POST","/v1/accounts:signUp",a)})).apply(this,arguments)}function Fn(){return(Fn=(0,g.Z)(function*(l,a){return we(l,"POST","/v1/accounts:update",ae(l,a))})).apply(this,arguments)}function Uc(l,a){return Ea.apply(this,arguments)}function Ea(){return(Ea=(0,g.Z)(function*(l,a){return Bt(l,"POST","/v1/accounts:signInWithPassword",ae(l,a))})).apply(this,arguments)}function tn(l,a){return xs.apply(this,arguments)}function xs(){return(xs=(0,g.Z)(function*(l,a){return we(l,"POST","/v1/accounts:sendOobCode",ae(l,a))})).apply(this,arguments)}function Ns(){return(Ns=(0,g.Z)(function*(l,a){return tn(l,a)})).apply(this,arguments)}function Ci(l,a){return Vs.apply(this,arguments)}function Vs(){return(Vs=(0,g.Z)(function*(l,a){return tn(l,a)})).apply(this,arguments)}function yt(l,a){return ks.apply(this,arguments)}function ks(){return(ks=(0,g.Z)(function*(l,a){return tn(l,a)})).apply(this,arguments)}function Mr(){return(Mr=(0,g.Z)(function*(l,a){return tn(l,a)})).apply(this,arguments)}function xi(){return(xi=(0,g.Z)(function*(l,a){return Bt(l,"POST","/v1/accounts:signInWithEmailLink",ae(l,a))})).apply(this,arguments)}function Os(){return(Os=(0,g.Z)(function*(l,a){return Bt(l,"POST","/v1/accounts:signInWithEmailLink",ae(l,a))})).apply(this,arguments)}class En extends Or{constructor(a,u,c,p=null){super("password",c),this._email=a,this._password=u,this._tenantId=p}static _fromEmailAndPassword(a,u){return new En(a,u,"password")}static _fromEmailAndCode(a,u,c=null){return new En(a,u,"emailLink",c)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(a){const u="string"==typeof a?JSON.parse(a):a;if(u?.email&&u?.password){if("password"===u.signInMethod)return this._fromEmailAndPassword(u.email,u.password);if("emailLink"===u.signInMethod)return this._fromEmailAndCode(u.email,u.password,u.tenantId)}return null}_getIdTokenResponse(a){var u=this;return(0,g.Z)(function*(){switch(u.signInMethod){case"password":return Ri(a,{returnSecureToken:!0,email:u._email,password:u._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Uc);case"emailLink":return function Qu(l,a){return xi.apply(this,arguments)}(a,{email:u._email,oobCode:u._password});default:ye(a,"internal-error")}})()}_linkToIdToken(a,u){var c=this;return(0,g.Z)(function*(){switch(c.signInMethod){case"password":return Ri(a,{idToken:u,returnSecureToken:!0,email:c._email,password:c._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",bs);case"emailLink":return function Yu(l,a){return Os.apply(this,arguments)}(a,{idToken:u,email:c._email,oobCode:c._password});default:ye(a,"internal-error")}})()}_getReauthenticationResolver(a){return this._getIdTokenResponse(a)}}function Zt(l,a){return Di.apply(this,arguments)}function Di(){return(Di=(0,g.Z)(function*(l,a){return Bt(l,"POST","/v1/accounts:signInWithIdp",ae(l,a))})).apply(this,arguments)}class Nt extends Or{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(a){const u=new Nt(a.providerId,a.signInMethod);return a.idToken||a.accessToken?(a.idToken&&(u.idToken=a.idToken),a.accessToken&&(u.accessToken=a.accessToken),a.nonce&&!a.pendingToken&&(u.nonce=a.nonce),a.pendingToken&&(u.pendingToken=a.pendingToken)):a.oauthToken&&a.oauthTokenSecret?(u.accessToken=a.oauthToken,u.secret=a.oauthTokenSecret):ye("argument-error"),u}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(a){const u="string"==typeof a?JSON.parse(a):a,{providerId:c,signInMethod:p}=u,_=(0,gt._T)(u,["providerId","signInMethod"]);if(!c||!p)return null;const T=new Nt(c,p);return T.idToken=_.idToken||void 0,T.accessToken=_.accessToken||void 0,T.secret=_.secret,T.nonce=_.nonce,T.pendingToken=_.pendingToken||null,T}_getIdTokenResponse(a){return Zt(a,this.buildRequest())}_linkToIdToken(a,u){const c=this.buildRequest();return c.idToken=u,Zt(a,c)}_getReauthenticationResolver(a){const u=this.buildRequest();return u.autoCreate=!1,Zt(a,u)}buildRequest(){const a={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)a.pendingToken=this.pendingToken;else{const u={};this.idToken&&(u.id_token=this.idToken),this.accessToken&&(u.access_token=this.accessToken),this.secret&&(u.oauth_token_secret=this.secret),u.providerId=this.providerId,this.nonce&&!this.pendingToken&&(u.nonce=this.nonce),a.postBody=(0,R.xO)(u)}return a}}function Ls(){return(Ls=(0,g.Z)(function*(l,a){return we(l,"POST","/v1/accounts:sendVerificationCode",ae(l,a))})).apply(this,arguments)}function Vi(){return(Vi=(0,g.Z)(function*(l,a){return Bt(l,"POST","/v1/accounts:signInWithPhoneNumber",ae(l,a))})).apply(this,arguments)}function ki(){return(ki=(0,g.Z)(function*(l,a){const u=yield Bt(l,"POST","/v1/accounts:signInWithPhoneNumber",ae(l,a));if(u.temporaryProof)throw kn(l,"account-exists-with-different-credential",u);return u})).apply(this,arguments)}const Ju={USER_NOT_FOUND:"user-not-found"};function Fs(){return(Fs=(0,g.Z)(function*(l,a){return Bt(l,"POST","/v1/accounts:signInWithPhoneNumber",ae(l,Object.assign(Object.assign({},a),{operation:"REAUTH"})),Ju)})).apply(this,arguments)}class cr extends Or{constructor(a){super("phone","phone"),this.params=a}static _fromVerification(a,u){return new cr({verificationId:a,verificationCode:u})}static _fromTokenResponse(a,u){return new cr({phoneNumber:a,temporaryProof:u})}_getIdTokenResponse(a){return function Bc(l,a){return Vi.apply(this,arguments)}(a,this._makeVerificationRequest())}_linkToIdToken(a,u){return function Ms(l,a){return ki.apply(this,arguments)}(a,Object.assign({idToken:u},this._makeVerificationRequest()))}_getReauthenticationResolver(a){return function Xu(l,a){return Fs.apply(this,arguments)}(a,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:a,phoneNumber:u,verificationId:c,verificationCode:p}=this.params;return a&&u?{temporaryProof:a,phoneNumber:u}:{sessionInfo:c,code:p}}toJSON(){const a={providerId:this.providerId};return this.params.phoneNumber&&(a.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(a.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(a.verificationCode=this.params.verificationCode),this.params.verificationId&&(a.verificationId=this.params.verificationId),a}static fromJSON(a){"string"==typeof a&&(a=JSON.parse(a));const{verificationId:u,verificationCode:c,phoneNumber:p,temporaryProof:_}=a;return c||u||p||_?new cr({verificationId:u,verificationCode:c,phoneNumber:p,temporaryProof:_}):null}}class Un{constructor(a){var u,c,p,_,T,b;const k=(0,R.zd)((0,R.pd)(a)),$=null!==(u=k.apiKey)&&void 0!==u?u:null,Q=null!==(c=k.oobCode)&&void 0!==c?c:null,de=function Oi(l){switch(l){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(p=k.mode)&&void 0!==p?p:null);L($&&Q&&de,"argument-error"),this.apiKey=$,this.operation=de,this.code=Q,this.continueUrl=null!==(_=k.continueUrl)&&void 0!==_?_:null,this.languageCode=null!==(T=k.languageCode)&&void 0!==T?T:null,this.tenantId=null!==(b=k.tenantId)&&void 0!==b?b:null}static parseLink(a){const u=function el(l){const a=(0,R.zd)((0,R.pd)(l)).link,u=a?(0,R.zd)((0,R.pd)(a)).deep_link_id:null,c=(0,R.zd)((0,R.pd)(l)).deep_link_id;return(c?(0,R.zd)((0,R.pd)(c)).link:null)||c||u||a||l}(a);try{return new Un(u)}catch{return null}}}let Tn=(()=>{class l{constructor(){this.providerId=l.PROVIDER_ID}static credential(u,c){return En._fromEmailAndPassword(u,c)}static credentialWithLink(u,c){const p=Un.parseLink(c);return L(p,"argument-error"),En._fromEmailAndCode(u,p.code,p.tenantId)}}return l.PROVIDER_ID="password",l.EMAIL_PASSWORD_SIGN_IN_METHOD="password",l.EMAIL_LINK_SIGN_IN_METHOD="emailLink",l})();class jt{constructor(a){this.providerId=a,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(a){this.defaultLanguageCode=a}setCustomParameters(a){return this.customParameters=a,this}getCustomParameters(){return this.customParameters}}class Fr extends jt{constructor(){super(...arguments),this.scopes=[]}addScope(a){return this.scopes.includes(a)||this.scopes.push(a),this}getScopes(){return[...this.scopes]}}class Li extends Fr{static credentialFromJSON(a){const u="string"==typeof a?JSON.parse(a):a;return L("providerId"in u&&"signInMethod"in u,"argument-error"),Nt._fromParams(u)}credential(a){return this._credential(Object.assign(Object.assign({},a),{nonce:a.rawNonce}))}_credential(a){return L(a.idToken||a.accessToken,"argument-error"),Nt._fromParams(Object.assign(Object.assign({},a),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(a){return Li.oauthCredentialFromTaggedObject(a)}static credentialFromError(a){return Li.oauthCredentialFromTaggedObject(a.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:u,oauthAccessToken:c,oauthTokenSecret:p,pendingToken:_,nonce:T,providerId:b}=a;if(!c&&!p&&!u&&!_||!b)return null;try{return new Li(b)._credential({idToken:u,accessToken:c,nonce:T,pendingToken:_})}catch{return null}}}let tl=(()=>{class l extends Fr{constructor(){super("facebook.com")}static credential(u){return Nt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.FACEBOOK_SIGN_IN_METHOD,accessToken:u})}static credentialFromResult(u){return l.credentialFromTaggedObject(u)}static credentialFromError(u){return l.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u||!("oauthAccessToken"in u)||!u.oauthAccessToken)return null;try{return l.credential(u.oauthAccessToken)}catch{return null}}}return l.FACEBOOK_SIGN_IN_METHOD="facebook.com",l.PROVIDER_ID="facebook.com",l})(),nl=(()=>{class l extends Fr{constructor(){super("google.com"),this.addScope("profile")}static credential(u,c){return Nt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.GOOGLE_SIGN_IN_METHOD,idToken:u,accessToken:c})}static credentialFromResult(u){return l.credentialFromTaggedObject(u)}static credentialFromError(u){return l.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u)return null;const{oauthIdToken:c,oauthAccessToken:p}=u;if(!c&&!p)return null;try{return l.credential(c,p)}catch{return null}}}return l.GOOGLE_SIGN_IN_METHOD="google.com",l.PROVIDER_ID="google.com",l})(),qc=(()=>{class l extends Fr{constructor(){super("github.com")}static credential(u){return Nt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.GITHUB_SIGN_IN_METHOD,accessToken:u})}static credentialFromResult(u){return l.credentialFromTaggedObject(u)}static credentialFromError(u){return l.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u||!("oauthAccessToken"in u)||!u.oauthAccessToken)return null;try{return l.credential(u.oauthAccessToken)}catch{return null}}}return l.GITHUB_SIGN_IN_METHOD="github.com",l.PROVIDER_ID="github.com",l})();class Rt extends Or{constructor(a,u){super(a,a),this.pendingToken=u}_getIdTokenResponse(a){return Zt(a,this.buildRequest())}_linkToIdToken(a,u){const c=this.buildRequest();return c.idToken=u,Zt(a,c)}_getReauthenticationResolver(a){const u=this.buildRequest();return u.autoCreate=!1,Zt(a,u)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(a){const u="string"==typeof a?JSON.parse(a):a,{providerId:c,signInMethod:p,pendingToken:_}=u;return c&&p&&_&&c===p?new Rt(c,_):null}static _create(a,u){return new Rt(a,u)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class dr extends jt{constructor(a){L(a.startsWith("saml."),"argument-error"),super(a)}static credentialFromResult(a){return dr.samlCredentialFromTaggedObject(a)}static credentialFromError(a){return dr.samlCredentialFromTaggedObject(a.customData||{})}static credentialFromJSON(a){const u=Rt.fromJSON(a);return L(u,"argument-error"),u}static samlCredentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{pendingToken:u,providerId:c}=a;if(!u||!c)return null;try{return Rt._create(c,u)}catch{return null}}}let rl=(()=>{class l extends Fr{constructor(){super("twitter.com")}static credential(u,c){return Nt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.TWITTER_SIGN_IN_METHOD,oauthToken:u,oauthTokenSecret:c})}static credentialFromResult(u){return l.credentialFromTaggedObject(u)}static credentialFromError(u){return l.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u)return null;const{oauthAccessToken:c,oauthTokenSecret:p}=u;if(!c||!p)return null;try{return l.credential(c,p)}catch{return null}}}return l.TWITTER_SIGN_IN_METHOD="twitter.com",l.PROVIDER_ID="twitter.com",l})();function xe(l,a){return Ur.apply(this,arguments)}function Ur(){return(Ur=(0,g.Z)(function*(l,a){return Bt(l,"POST","/v1/accounts:signUp",ae(l,a))})).apply(this,arguments)}class ft{constructor(a){this.user=a.user,this.providerId=a.providerId,this._tokenResponse=a._tokenResponse,this.operationType=a.operationType}static _fromIdTokenResponse(a,u,c,p=!1){return(0,g.Z)(function*(){const _=yield v._fromIdTokenResponse(a,c,p),T=Br(c);return new ft({user:_,providerId:T,_tokenResponse:c,operationType:u})})()}static _forOperation(a,u,c){return(0,g.Z)(function*(){yield a._updateTokensIfNecessary(c,!0);const p=Br(c);return new ft({user:a,providerId:p,_tokenResponse:c,operationType:u})})()}}function Br(l){return l.providerId?l.providerId:"phoneNumber"in l?"phone":null}function zc(l){return qs.apply(this,arguments)}function qs(){return(qs=(0,g.Z)(function*(l){var a;const u=Ne(l);if(yield u._initializationPromise,null!==(a=u.currentUser)&&void 0!==a&&a.isAnonymous)return new ft({user:u.currentUser,providerId:null,operationType:"signIn"});const c=yield xe(u,{returnSecureToken:!0}),p=yield ft._fromIdTokenResponse(u,"signIn",c,!0);return yield u._updateCurrentUser(p.user),p})).apply(this,arguments)}class zs extends R.ZR{constructor(a,u,c,p){var _;super(u.code,u.message),this.operationType=c,this.user=p,Object.setPrototypeOf(this,zs.prototype),this.customData={appName:a.name,tenantId:null!==(_=a.tenantId)&&void 0!==_?_:void 0,_serverResponse:u.customData._serverResponse,operationType:c}}static _fromErrorAndOperation(a,u,c,p){return new zs(a,u,c,p)}}function il(l,a,u,c){return("reauthenticate"===a?u._getReauthenticationResolver(l):u._getIdTokenResponse(l)).catch(_=>{throw"auth/multi-factor-auth-required"===_.code?zs._fromErrorAndOperation(l,_,a,c):_})}function sl(l){return new Set(l.map(({providerId:a})=>a).filter(a=>!!a))}function Wc(l,a){return fr.apply(this,arguments)}function fr(){return fr=(0,g.Z)(function*(l,a){const u=(0,R.m9)(l);yield Mi(!0,u,a);const{providerUserInfo:c}=yield function oa(l,a){return nr.apply(this,arguments)}(u.auth,{idToken:yield u.getIdToken(),deleteProvider:[a]}),p=sl(c||[]);return u.providerData=u.providerData.filter(_=>p.has(_.providerId)),p.has("phone")||(u.phoneNumber=null),yield u.auth._persistUserIfCurrent(u),u}),fr.apply(this,arguments)}function nn(l,a){return Ws.apply(this,arguments)}function Ws(){return(Ws=(0,g.Z)(function*(l,a,u=!1){const c=yield qt(l,a._linkToIdToken(l.auth,yield l.getIdToken()),u);return ft._forOperation(l,"link",c)})).apply(this,arguments)}function Mi(l,a,u){return Gs.apply(this,arguments)}function Gs(){return(Gs=(0,g.Z)(function*(l,a,u){yield _t(a);const p=!1===l?"provider-already-linked":"no-such-provider";L(sl(a.providerData).has(u)===l,a.auth,p)})).apply(this,arguments)}function pr(l,a){return Aa.apply(this,arguments)}function Aa(){return(Aa=(0,g.Z)(function*(l,a,u=!1){const{auth:c}=l,p="reauthenticate";try{const _=yield qt(l,il(c,p,a,l),u);L(_.idToken,c,"internal-error");const T=sr(_.idToken);L(T,c,"internal-error");const{sub:b}=T;return L(l.uid===b,c,"user-mismatch"),ft._forOperation(l,p,_)}catch(_){throw"auth/user-not-found"===_?.code&&ye(c,"user-mismatch"),_}})).apply(this,arguments)}function ol(l,a){return $s.apply(this,arguments)}function $s(){return($s=(0,g.Z)(function*(l,a,u=!1){const c="signIn",p=yield il(l,c,a),_=yield ft._fromIdTokenResponse(l,c,p);return u||(yield l._updateCurrentUser(_.user)),_})).apply(this,arguments)}function Ks(l,a){return Zs.apply(this,arguments)}function Zs(){return(Zs=(0,g.Z)(function*(l,a){return ol(Ne(l),a)})).apply(this,arguments)}function wa(l,a){return Fi.apply(this,arguments)}function Fi(){return(Fi=(0,g.Z)(function*(l,a){const u=(0,R.m9)(l);return yield Mi(!1,u,a.providerId),nn(u,a)})).apply(this,arguments)}function js(l,a){return Hs.apply(this,arguments)}function Hs(){return(Hs=(0,g.Z)(function*(l,a){return pr((0,R.m9)(l),a)})).apply(this,arguments)}function Ra(){return(Ra=(0,g.Z)(function*(l,a){return Bt(l,"POST","/v1/accounts:signInWithCustomToken",ae(l,a))})).apply(this,arguments)}function Gc(l,a){return Pa.apply(this,arguments)}function Pa(){return Pa=(0,g.Z)(function*(l,a){const u=Ne(l),c=yield function al(l,a){return Ra.apply(this,arguments)}(u,{token:a,returnSecureToken:!0}),p=yield ft._fromIdTokenResponse(u,"signIn",c);return yield u._updateCurrentUser(p.user),p}),Pa.apply(this,arguments)}class Ui{constructor(a,u){this.factorId=a,this.uid=u.mfaEnrollmentId,this.enrollmentTime=new Date(u.enrolledAt).toUTCString(),this.displayName=u.displayName}static _fromServerResponse(a,u){return"phoneInfo"in u?qr._fromServerResponse(a,u):"totpInfo"in u?mr._fromServerResponse(a,u):ye(a,"internal-error")}}class qr extends Ui{constructor(a){super("phone",a),this.phoneNumber=a.phoneInfo}static _fromServerResponse(a,u){return new qr(u)}}class mr extends Ui{constructor(a){super("totp",a)}static _fromServerResponse(a,u){return new mr(u)}}function gr(l,a,u){var c;L((null===(c=u.url)||void 0===c?void 0:c.length)>0,l,"invalid-continue-uri"),L(typeof u.dynamicLinkDomain>"u"||u.dynamicLinkDomain.length>0,l,"invalid-dynamic-link-domain"),a.continueUrl=u.url,a.dynamicLinkDomain=u.dynamicLinkDomain,a.canHandleCodeInApp=u.handleCodeInApp,u.iOS&&(L(u.iOS.bundleId.length>0,l,"missing-ios-bundle-id"),a.iOSBundleId=u.iOS.bundleId),u.android&&(L(u.android.packageName.length>0,l,"missing-android-pkg-name"),a.androidInstallApp=u.android.installApp,a.androidMinimumVersionCode=u.android.minimumVersion,a.androidPackageName=u.android.packageName)}function Bi(l){return Qs.apply(this,arguments)}function Qs(){return(Qs=(0,g.Z)(function*(l){const a=Ne(l);a._getPasswordPolicyInternal()&&(yield a._updatePasswordPolicy())})).apply(this,arguments)}function qi(l,a,u){return _r.apply(this,arguments)}function _r(){return(_r=(0,g.Z)(function*(l,a,u){const c=Ne(l),p={requestType:"PASSWORD_RESET",email:a,clientType:"CLIENT_TYPE_WEB"};u&&gr(c,p,u),yield Ri(c,p,"getOobCode",Ci)})).apply(this,arguments)}function $c(l,a,u){return Le.apply(this,arguments)}function Le(){return Le=(0,g.Z)(function*(l,a,u){yield Lr((0,R.m9)(l),{oobCode:a,newPassword:u}).catch(function(){var c=(0,g.Z)(function*(p){throw"auth/password-does-not-meet-requirements"===p.code&&Bi(l),p});return function(p){return c.apply(this,arguments)}}())}),Le.apply(this,arguments)}function ul(l,a){return Sa.apply(this,arguments)}function Sa(){return Sa=(0,g.Z)(function*(l,a){yield function Fc(l,a){return Fn.apply(this,arguments)}((0,R.m9)(l),{oobCode:a})}),Sa.apply(this,arguments)}function ll(l,a){return Ca.apply(this,arguments)}function Ca(){return(Ca=(0,g.Z)(function*(l,a){const u=(0,R.m9)(l),c=yield Lr(u,{oobCode:a}),p=c.requestType;switch(L(p,u,"internal-error"),p){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":L(c.newEmail,u,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":L(c.mfaInfo,u,"internal-error");default:L(c.email,u,"internal-error")}let _=null;return c.mfaInfo&&(_=Ui._fromServerResponse(Ne(u),c.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===c.requestType?c.newEmail:c.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===c.requestType?c.email:c.newEmail)||null,multiFactorInfo:_},operation:p}})).apply(this,arguments)}function cl(l,a){return Ys.apply(this,arguments)}function Ys(){return(Ys=(0,g.Z)(function*(l,a){const{data:u}=yield ll((0,R.m9)(l),a);return u.email})).apply(this,arguments)}function hl(l,a,u){return zr.apply(this,arguments)}function zr(){return(zr=(0,g.Z)(function*(l,a,u){const c=Ne(l),T=yield Ri(c,{returnSecureToken:!0,email:a,password:u,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",xe).catch(k=>{throw"auth/password-does-not-meet-requirements"===k.code&&Bi(l),k}),b=yield ft._fromIdTokenResponse(c,"signIn",T);return yield c._updateCurrentUser(b.user),b})).apply(this,arguments)}function dl(l,a,u){return Ks((0,R.m9)(l),Tn.credential(a,u)).catch(function(){var c=(0,g.Z)(function*(p){throw"auth/password-does-not-meet-requirements"===p.code&&Bi(l),p});return function(p){return c.apply(this,arguments)}}())}function rn(l,a,u){return Js.apply(this,arguments)}function Js(){return(Js=(0,g.Z)(function*(l,a,u){const c=Ne(l),p={requestType:"EMAIL_SIGNIN",email:a,clientType:"CLIENT_TYPE_WEB"};(function _(T,b){L(b.handleCodeInApp,c,"argument-error"),b&&gr(c,T,b)})(p,u),yield Ri(c,p,"getOobCode",yt)})).apply(this,arguments)}function Kc(l,a){const u=Un.parseLink(a);return"EMAIL_SIGNIN"===u?.operation}function fl(l,a,u){return zi.apply(this,arguments)}function zi(){return(zi=(0,g.Z)(function*(l,a,u){const c=(0,R.m9)(l),p=Tn.credentialWithLink(a,u||Yt());return L(p._tenantId===(c.tenantId||null),c,"tenant-id-mismatch"),Ks(c,p)})).apply(this,arguments)}function Xs(){return(Xs=(0,g.Z)(function*(l,a){return we(l,"POST","/v1/accounts:createAuthUri",ae(l,a))})).apply(this,arguments)}function ba(l,a){return Wr.apply(this,arguments)}function Wr(){return Wr=(0,g.Z)(function*(l,a){const c={identifier:a,continueUri:Nn()?Yt():"http://localhost"},{signinMethods:p}=yield function Wi(l,a){return Xs.apply(this,arguments)}((0,R.m9)(l),c);return p||[]}),Wr.apply(this,arguments)}function pl(l,a){return Gr.apply(this,arguments)}function Gr(){return Gr=(0,g.Z)(function*(l,a){const u=(0,R.m9)(l),p={requestType:"VERIFY_EMAIL",idToken:yield l.getIdToken()};a&&gr(u.auth,p,a);const{email:_}=yield function Ds(l,a){return Ns.apply(this,arguments)}(u.auth,p);_!==l.email&&(yield l.reload())}),Gr.apply(this,arguments)}function Zc(l,a,u){return eo.apply(this,arguments)}function eo(){return eo=(0,g.Z)(function*(l,a,u){const c=(0,R.m9)(l),_={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield l.getIdToken(),newEmail:a};u&&gr(c.auth,_,u);const{email:T}=yield function bi(l,a){return Mr.apply(this,arguments)}(c.auth,_);T!==l.email&&(yield l.reload())}),eo.apply(this,arguments)}function to(){return(to=(0,g.Z)(function*(l,a){return we(l,"POST","/v1/accounts:update",a)})).apply(this,arguments)}function ml(l,a){return $i.apply(this,arguments)}function $i(){return $i=(0,g.Z)(function*(l,{displayName:a,photoURL:u}){if(void 0===a&&void 0===u)return;const c=(0,R.m9)(l),_={idToken:yield c.getIdToken(),displayName:a,photoUrl:u,returnSecureToken:!0},T=yield qt(c,function Gi(l,a){return to.apply(this,arguments)}(c.auth,_));c.displayName=T.displayName||null,c.photoURL=T.photoUrl||null;const b=c.providerData.find(({providerId:k})=>"password"===k);b&&(b.displayName=c.displayName,b.photoURL=c.photoURL),yield c._updateTokensIfNecessary(T)}),$i.apply(this,arguments)}function xa(l,a){return Ki((0,R.m9)(l),a,null)}function gl(l,a){return Ki((0,R.m9)(l),null,a)}function Ki(l,a,u){return no.apply(this,arguments)}function no(){return no=(0,g.Z)(function*(l,a,u){const{auth:c}=l,_={idToken:yield l.getIdToken(),returnSecureToken:!0};a&&(_.email=a),u&&(_.password=u);const T=yield qt(l,function Hu(l,a){return Cs.apply(this,arguments)}(c,_));yield l._updateTokensIfNecessary(T,!0)}),no.apply(this,arguments)}class zt{constructor(a,u,c={}){this.isNewUser=a,this.providerId=u,this.profile=c}}class Da extends zt{constructor(a,u,c,p){super(a,u,c),this.username=p}}class yl extends zt{constructor(a,u){super(a,"facebook.com",u)}}class Il extends Da{constructor(a,u){super(a,"github.com",u,"string"==typeof u?.login?u?.login:null)}}class vl extends zt{constructor(a,u){super(a,"google.com",u)}}class ro extends Da{constructor(a,u,c){super(a,"twitter.com",u,c)}}function Vt(l){const{user:a,_tokenResponse:u}=l;return a.isAnonymous&&!u?{providerId:null,isNewUser:!1,profile:null}:function _l(l){var a,u;if(!l)return null;const{providerId:c}=l,p=l.rawUserInfo?JSON.parse(l.rawUserInfo):{},_=l.isNewUser||"identitytoolkit#SignupNewUserResponse"===l.kind;if(!c&&l?.idToken){const T=null===(u=null===(a=sr(l.idToken))||void 0===a?void 0:a.firebase)||void 0===u?void 0:u.sign_in_provider;if(T)return new zt(_,"anonymous"!==T&&"custom"!==T?T:null)}if(!c)return null;switch(c){case"facebook.com":return new yl(_,p);case"github.com":return new Il(_,p);case"google.com":return new vl(_,p);case"twitter.com":return new ro(_,p,l.screenName||null);case"custom":case"anonymous":return new zt(_,null);default:return new zt(_,c,p)}}(u)}class wn{constructor(a,u,c){this.type=a,this.credential=u,this.user=c}static _fromIdtoken(a,u){return new wn("enroll",a,u)}static _fromMfaPendingCredential(a){return new wn("signin",a)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(a){var u,c;if(a?.multiFactorSession){if(null!==(u=a.multiFactorSession)&&void 0!==u&&u.pendingCredential)return wn._fromMfaPendingCredential(a.multiFactorSession.pendingCredential);if(null!==(c=a.multiFactorSession)&&void 0!==c&&c.idToken)return wn._fromIdtoken(a.multiFactorSession.idToken)}return null}}class io{constructor(a,u,c){this.session=a,this.hints=u,this.signInResolver=c}static _fromError(a,u){const c=Ne(a),p=u.customData._serverResponse,_=(p.mfaInfo||[]).map(b=>Ui._fromServerResponse(c,b));L(p.mfaPendingCredential,c,"internal-error");const T=wn._fromMfaPendingCredential(p.mfaPendingCredential);return new io(T,_,function(){var b=(0,g.Z)(function*(k){const $=yield k._process(c,T);delete p.mfaInfo,delete p.mfaPendingCredential;const Q=Object.assign(Object.assign({},p),{idToken:$.idToken,refreshToken:$.refreshToken});switch(u.operationType){case"signIn":const de=yield ft._fromIdTokenResponse(c,u.operationType,Q);return yield c._updateCurrentUser(de.user),de;case"reauthenticate":return L(u.user,c,"internal-error"),ft._forOperation(u.user,u.operationType,Q);default:ye(c,"internal-error")}});return function(k){return b.apply(this,arguments)}}())}resolveSignIn(a){var u=this;return(0,g.Z)(function*(){return u.signInResolver(a)})()}}function Rn(l,a){var u;const c=(0,R.m9)(l),p=a;return L(a.customData.operationType,c,"argument-error"),L(null===(u=p.customData._serverResponse)||void 0===u?void 0:u.mfaPendingCredential,c,"argument-error"),io._fromError(c,p)}class $r{constructor(a){this.user=a,this.enrolledFactors=[],a._onReload(u=>{u.mfaInfo&&(this.enrolledFactors=u.mfaInfo.map(c=>Ui._fromServerResponse(a.auth,c)))})}static _fromUser(a){return new $r(a)}getSession(){var a=this;return(0,g.Z)(function*(){return wn._fromIdtoken(yield a.user.getIdToken(),a.user)})()}enroll(a,u){var c=this;return(0,g.Z)(function*(){const p=a,_=yield c.getSession(),T=yield qt(c.user,p._process(c.user.auth,_,u));return yield c.user._updateTokensIfNecessary(T),c.user.reload()})()}unenroll(a){var u=this;return(0,g.Z)(function*(){const c="string"==typeof a?a:a.uid,p=yield u.user.getIdToken();try{const _=yield qt(u.user,function ji(l,a){return we(l,"POST","/v2/accounts/mfaEnrollment:withdraw",ae(l,a))}(u.user.auth,{idToken:p,mfaEnrollmentId:c}));u.enrolledFactors=u.enrolledFactors.filter(({uid:T})=>T!==c),yield u.user._updateTokensIfNecessary(_),yield u.user.reload()}catch(_){throw _}})()}}const oo=new WeakMap;function Kr(l){const a=(0,R.m9)(l);return oo.has(a)||oo.set(a,$r._fromUser(a)),oo.get(a)}const ao="__sak";class Al{constructor(a,u){this.storageRetriever=a,this.type=u}_isAvailable(){try{return this.storage?(this.storage.setItem(ao,"1"),this.storage.removeItem(ao),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(a,u){return this.storage.setItem(a,JSON.stringify(u)),Promise.resolve()}_get(a){const u=this.storage.getItem(a);return Promise.resolve(u?JSON.parse(u):null)}_remove(a){return this.storage.removeItem(a),Promise.resolve()}get storage(){return this.storageRetriever()}}const wl=(()=>{class l extends Al{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(u,c)=>this.onStorageEvent(u,c),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function Oa(){const l=(0,R.z$)();return le(l)||ur(l)}()&&function Bu(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=da(),this._shouldAllowMigration=!0}forAllChangedKeys(u){for(const c of Object.keys(this.listeners)){const p=this.storage.getItem(c),_=this.localCache[c];p!==_&&u(c,_,p)}}onStorageEvent(u,c=!1){if(!u.key)return void this.forAllChangedKeys((b,k,$)=>{this.notifyListeners(b,$)});const p=u.key;if(c?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const b=this.storage.getItem(p);if(u.newValue!==b)null!==u.newValue?this.storage.setItem(p,u.newValue):this.storage.removeItem(p);else if(this.localCache[p]===u.newValue&&!c)return}const _=()=>{const b=this.storage.getItem(p);!c&&this.localCache[p]===b||this.notifyListeners(p,b)},T=this.storage.getItem(p);!function ha(){return(0,R.w1)()&&10===document.documentMode}()||T===u.newValue||u.newValue===u.oldValue?_():setTimeout(_,10)}notifyListeners(u,c){this.localCache[u]=c;const p=this.listeners[u];if(p)for(const _ of Array.from(p))_(c&&JSON.parse(c))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((u,c,p)=>{this.onStorageEvent(new StorageEvent("storage",{key:u,oldValue:c,newValue:p}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(u,c){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[u]||(this.listeners[u]=new Set,this.localCache[u]=this.storage.getItem(u)),this.listeners[u].add(c)}_removeListener(u,c){this.listeners[u]&&(this.listeners[u].delete(c),0===this.listeners[u].size&&delete this.listeners[u]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(u,c){var p=()=>super._set,_=this;return(0,g.Z)(function*(){yield p().call(_,u,c),_.localCache[u]=JSON.stringify(c)})()}_get(u){var c=()=>super._get,p=this;return(0,g.Z)(function*(){const _=yield c().call(p,u);return p.localCache[u]=JSON.stringify(_),_})()}_remove(u){var c=()=>super._remove,p=this;return(0,g.Z)(function*(){yield c().call(p,u),delete p.localCache[u]})()}}return l.type="LOCAL",l})(),Ma=(()=>{class l extends Al{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(u,c){}_removeListener(u,c){}}return l.type="SESSION",l})();let Zr=(()=>{class l{constructor(u){this.eventTarget=u,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(u){const c=this.receivers.find(_=>_.isListeningto(u));if(c)return c;const p=new l(u);return this.receivers.push(p),p}isListeningto(u){return this.eventTarget===u}handleEvent(u){var c=this;return(0,g.Z)(function*(){const p=u,{eventId:_,eventType:T,data:b}=p.data,k=c.handlersMap[T];if(!k?.size)return;p.ports[0].postMessage({status:"ack",eventId:_,eventType:T});const $=Array.from(k).map(function(){var de=(0,g.Z)(function*(Ct){return Ct(p.origin,b)});return function(Ct){return de.apply(this,arguments)}}()),Q=yield function eh(l){return Promise.all(l.map(function(){var a=(0,g.Z)(function*(u){try{return{fulfilled:!0,value:yield u}}catch(c){return{fulfilled:!1,reason:c}}});return function(u){return a.apply(this,arguments)}}()))}($);p.ports[0].postMessage({status:"done",eventId:_,eventType:T,response:Q})})()}_subscribe(u,c){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[u]||(this.handlersMap[u]=new Set),this.handlersMap[u].add(c)}_unsubscribe(u,c){this.handlersMap[u]&&c&&this.handlersMap[u].delete(c),(!c||0===this.handlersMap[u].size)&&delete this.handlersMap[u],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return l.receivers=[],l})();function jr(l="",a=10){let u="";for(let c=0;c<a;c++)u+=Math.floor(10*Math.random());return l+u}class rt{constructor(a){this.target=a,this.handlers=new Set}removeMessageHandler(a){a.messageChannel&&(a.messageChannel.port1.removeEventListener("message",a.onMessage),a.messageChannel.port1.close()),this.handlers.delete(a)}_send(a,u,c=50){var p=this;return(0,g.Z)(function*(){const _=typeof MessageChannel<"u"?new MessageChannel:null;if(!_)throw new Error("connection_unavailable");let T,b;return new Promise((k,$)=>{const Q=jr("",20);_.port1.start();const de=setTimeout(()=>{$(new Error("unsupported_event"))},c);b={messageChannel:_,onMessage(Ct){const cn=Ct;if(cn.data.eventId===Q)switch(cn.data.status){case"ack":clearTimeout(de),T=setTimeout(()=>{$(new Error("timeout"))},3e3);break;case"done":clearTimeout(T),k(cn.data.response);break;default:clearTimeout(de),clearTimeout(T),$(new Error("invalid_response"))}}},p.handlers.add(b),_.port1.addEventListener("message",b.onMessage),p.target.postMessage({eventType:a,eventId:Q,data:u},[_.port2])}).finally(()=>{b&&p.removeMessageHandler(b)})})()}}function Ve(){return window}function zn(){return typeof Ve().WorkerGlobalScope<"u"&&"function"==typeof Ve().importScripts}function V(){return(V=(0,g.Z)(function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const uo="firebaseLocalStorageDb",K="firebaseLocalStorage",Rl="fbase_key";class B{constructor(a){this.request=a}toPromise(){return new Promise((a,u)=>{this.request.addEventListener("success",()=>{a(this.request.result)}),this.request.addEventListener("error",()=>{u(this.request.error)})})}}function C(l,a){return l.transaction([K],a?"readwrite":"readonly").objectStore(K)}function Ge(){const l=indexedDB.open(uo,1);return new Promise((a,u)=>{l.addEventListener("error",()=>{u(l.error)}),l.addEventListener("upgradeneeded",()=>{const c=l.result;try{c.createObjectStore(K,{keyPath:Rl})}catch(p){u(p)}}),l.addEventListener("success",(0,g.Z)(function*(){const c=l.result;c.objectStoreNames.contains(K)?a(c):(c.close(),yield function N(){const l=indexedDB.deleteDatabase(uo);return new B(l).toPromise()}(),a(yield Ge()))}))})}function Fa(l,a,u){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,g.Z)(function*(l,a,u){const c=C(l,!0).put({[Rl]:a,value:u});return new B(c).toPromise()})).apply(this,arguments)}function Ba(){return(Ba=(0,g.Z)(function*(l,a){const u=C(l,!1).get(a),c=yield new B(u).toPromise();return void 0===c?null:c.value})).apply(this,arguments)}function Pl(l,a){const u=C(l,!0).delete(a);return new B(u).toPromise()}const ih=(()=>{class l{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var u=this;return(0,g.Z)(function*(){return u.db||(u.db=yield Ge()),u.db})()}_withRetries(u){var c=this;return(0,g.Z)(function*(){let p=0;for(;;)try{const _=yield c._openDb();return yield u(_)}catch(_){if(p++>3)throw _;c.db&&(c.db.close(),c.db=void 0)}})()}initializeServiceWorkerMessaging(){var u=this;return(0,g.Z)(function*(){return zn()?u.initializeReceiver():u.initializeSender()})()}initializeReceiver(){var u=this;return(0,g.Z)(function*(){u.receiver=Zr._getInstance(function Pt(){return zn()?self:null}()),u.receiver._subscribe("keyChanged",function(){var c=(0,g.Z)(function*(p,_){return{keyProcessed:(yield u._poll()).includes(_.key)}});return function(p,_){return c.apply(this,arguments)}}()),u.receiver._subscribe("ping",function(){var c=(0,g.Z)(function*(p,_){return["keyChanged"]});return function(p,_){return c.apply(this,arguments)}}())})()}initializeSender(){var u=this;return(0,g.Z)(function*(){var c,p;if(u.activeServiceWorker=yield function th(){return V.apply(this,arguments)}(),!u.activeServiceWorker)return;u.sender=new rt(u.activeServiceWorker);const _=yield u.sender._send("ping",{},800);_&&null!==(c=_[0])&&void 0!==c&&c.fulfilled&&null!==(p=_[0])&&void 0!==p&&p.value.includes("keyChanged")&&(u.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(u){var c=this;return(0,g.Z)(function*(){if(c.sender&&c.activeServiceWorker&&function We(){var l;return(null===(l=navigator?.serviceWorker)||void 0===l?void 0:l.controller)||null}()===c.activeServiceWorker)try{yield c.sender._send("keyChanged",{key:u},c.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,g.Z)(function*(){try{if(!indexedDB)return!1;const u=yield Ge();return yield Fa(u,ao,"1"),yield Pl(u,ao),!0}catch{}return!1})()}_withPendingWrite(u){var c=this;return(0,g.Z)(function*(){c.pendingWrites++;try{yield u()}finally{c.pendingWrites--}})()}_set(u,c){var p=this;return(0,g.Z)(function*(){return p._withPendingWrite((0,g.Z)(function*(){return yield p._withRetries(_=>Fa(_,u,c)),p.localCache[u]=c,p.notifyServiceWorker(u)}))})()}_get(u){var c=this;return(0,g.Z)(function*(){const p=yield c._withRetries(_=>function nh(l,a){return Ba.apply(this,arguments)}(_,u));return c.localCache[u]=p,p})()}_remove(u){var c=this;return(0,g.Z)(function*(){return c._withPendingWrite((0,g.Z)(function*(){return yield c._withRetries(p=>Pl(p,u)),delete c.localCache[u],c.notifyServiceWorker(u)}))})()}_poll(){var u=this;return(0,g.Z)(function*(){const c=yield u._withRetries(T=>{const b=C(T,!1).getAll();return new B(b).toPromise()});if(!c)return[];if(0!==u.pendingWrites)return[];const p=[],_=new Set;for(const{fbase_key:T,value:b}of c)_.add(T),JSON.stringify(u.localCache[T])!==JSON.stringify(b)&&(u.notifyListeners(T,b),p.push(T));for(const T of Object.keys(u.localCache))u.localCache[T]&&!_.has(T)&&(u.notifyListeners(T,null),p.push(T));return p})()}notifyListeners(u,c){this.localCache[u]=c;const p=this.listeners[u];if(p)for(const _ of Array.from(p))_(c)}startPolling(){var u=this;this.stopPolling(),this.pollTimer=setInterval((0,g.Z)(function*(){return u._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(u,c){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[u]||(this.listeners[u]=new Set,this._get(u)),this.listeners[u].add(c)}_removeListener(u,c){this.listeners[u]&&(this.listeners[u].delete(c),0===this.listeners[u].size&&delete this.listeners[u]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return l.type="LOCAL",l})(),Pe=1e12;class j{constructor(a){this.auth=a,this.counter=Pe,this._widgets=new Map}render(a,u){const c=this.counter;return this._widgets.set(c,new Hi(a,this.auth.name,u||{})),this.counter++,c}reset(a){var u;const c=a||Pe;null===(u=this._widgets.get(c))||void 0===u||u.delete(),this._widgets.delete(c)}getResponse(a){var u;return(null===(u=this._widgets.get(a||Pe))||void 0===u?void 0:u.getResponse())||""}execute(a){var u=this;return(0,g.Z)(function*(){var c;return null===(c=u._widgets.get(a||Pe))||void 0===c||c.execute(),""})()}}class Hi{constructor(a,u,c){this.params=c,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const p="string"==typeof a?document.getElementById(a):a;L(p,"argument-error",{appName:u}),this.container=p,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function me(l){const a=[],u="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let c=0;c<l;c++)a.push(u.charAt(Math.floor(62*Math.random())));return a.join("")}(50);const{callback:a,"expired-callback":u}=this.params;if(a)try{a(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,u)try{u()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const qa=wi("rcb"),ke=new mn(3e4,6e4);class Qr{constructor(){var a;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(a=Ve().grecaptcha)||void 0===a||!a.render)}load(a,u=""){return L(function za(l){return l.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(l)}(u),a,"argument-error"),this.shouldResolveImmediately(u)&&ht(Ve().grecaptcha)?Promise.resolve(Ve().grecaptcha):new Promise((c,p)=>{const _=Ve().setTimeout(()=>{p(ge(a,"network-request-failed"))},ke.get());Ve()[qa]=()=>{Ve().clearTimeout(_),delete Ve()[qa];const b=Ve().grecaptcha;if(!b||!ht(b))return void p(ge(a,"internal-error"));const k=b.render;b.render=($,Q)=>{const de=k($,Q);return this.counter++,de},this.hostLanguage=u,c(b)},Ye(`https://www.google.com/recaptcha/api.js??${(0,R.xO)({onload:qa,render:"explicit",hl:u})}`).catch(()=>{clearTimeout(_),p(ge(a,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(a){var u;return!(null===(u=Ve().grecaptcha)||void 0===u||!u.render)&&(a===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class yr{load(a){return(0,g.Z)(function*(){return new j(a)})()}clearedOneInstance(){}}const xl="recaptcha",Ir={theme:"light",type:"image"};class oh{constructor(a,u,c=Object.assign({},Ir)){this.parameters=c,this.type=xl,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Ne(a),this.isInvisible="invisible"===this.parameters.size,L(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const p="string"==typeof u?document.getElementById(u):u;L(p,this.auth,"argument-error"),this.container=p,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new yr:new Qr,this.validateStartingState()}verify(){var a=this;return(0,g.Z)(function*(){a.assertNotDestroyed();const u=yield a.render(),c=a.getAssertedRecaptcha();return c.getResponse(u)||new Promise(_=>{const T=b=>{b&&(a.tokenChangeListeners.delete(T),_(b))};a.tokenChangeListeners.add(T),a.isInvisible&&c.execute(u)})})()}render(){try{this.assertNotDestroyed()}catch(a){return Promise.reject(a)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(a=>{throw this.renderPromise=null,a})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(a=>{this.container.removeChild(a)})}validateStartingState(){L(!this.parameters.sitekey,this.auth,"argument-error"),L(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),L(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(a){return u=>{if(this.tokenChangeListeners.forEach(c=>c(u)),"function"==typeof a)a(u);else if("string"==typeof a){const c=Ve()[a];"function"==typeof c&&c(u)}}}assertNotDestroyed(){L(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var a=this;return(0,g.Z)(function*(){if(yield a.init(),!a.widgetId){let u=a.container;if(!a.isInvisible){const c=document.createElement("div");u.appendChild(c),u=c}a.widgetId=a.getAssertedRecaptcha().render(u,a.parameters)}return a.widgetId})()}init(){var a=this;return(0,g.Z)(function*(){L(Nn()&&!zn(),a.auth,"internal-error"),yield function Yr(){let l=null;return new Promise(a=>{"complete"!==document.readyState?(l=()=>a(),window.addEventListener("load",l)):a()}).catch(a=>{throw l&&window.removeEventListener("load",l),a})}(),a.recaptcha=yield a._recaptchaLoader.load(a.auth,a.auth.languageCode||void 0);const u=yield function X(l){return Xt.apply(this,arguments)}(a.auth);L(u,a.auth,"internal-error"),a.parameters.sitekey=u})()}getAssertedRecaptcha(){return L(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class lo{constructor(a,u){this.verificationId=a,this.onConfirmation=u}confirm(a){const u=cr._fromVerification(this.verificationId,a);return this.onConfirmation(u)}}function Dl(l,a,u){return It.apply(this,arguments)}function It(){return(It=(0,g.Z)(function*(l,a,u){const c=Ne(l),p=yield Jr(c,a,(0,R.m9)(u));return new lo(p,_=>Ks(c,_))})).apply(this,arguments)}function Wa(l,a,u){return co.apply(this,arguments)}function co(){return(co=(0,g.Z)(function*(l,a,u){const c=(0,R.m9)(l);yield Mi(!1,c,"phone");const p=yield Jr(c.auth,a,(0,R.m9)(u));return new lo(p,_=>wa(c,_))})).apply(this,arguments)}function Nl(l,a,u){return sn.apply(this,arguments)}function sn(){return(sn=(0,g.Z)(function*(l,a,u){const c=(0,R.m9)(l),p=yield Jr(c.auth,a,(0,R.m9)(u));return new lo(p,_=>js(c,_))})).apply(this,arguments)}function Jr(l,a,u){return w.apply(this,arguments)}function w(){return w=(0,g.Z)(function*(l,a,u){var c;const p=yield u.verify();try{let _;if(L("string"==typeof p,l,"argument-error"),L(u.type===xl,l,"argument-error"),_="string"==typeof a?{phoneNumber:a}:a,"session"in _){const T=_.session;if("phoneNumber"in _)return L("enroll"===T.type,l,"internal-error"),(yield function Wt(l,a){return we(l,"POST","/v2/accounts/mfaEnrollment:start",ae(l,a))}(l,{idToken:T.credential,phoneEnrollmentInfo:{phoneNumber:_.phoneNumber,recaptchaToken:p}})).phoneSessionInfo.sessionInfo;{L("signin"===T.type,l,"internal-error");const b=(null===(c=_.multiFactorHint)||void 0===c?void 0:c.uid)||_.multiFactorUid;return L(b,l,"missing-multi-factor-info"),(yield function sh(l,a){return we(l,"POST","/v2/accounts/mfaSignIn:start",ae(l,a))}(l,{mfaPendingCredential:T.credential,mfaEnrollmentId:b,phoneSignInInfo:{recaptchaToken:p}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:T}=yield function Ni(l,a){return Ls.apply(this,arguments)}(l,{phoneNumber:_.phoneNumber,recaptchaToken:p});return T}}finally{u._reset()}}),w.apply(this,arguments)}function ho(l,a){return kt.apply(this,arguments)}function kt(){return(kt=(0,g.Z)(function*(l,a){yield nn((0,R.m9)(l),a)})).apply(this,arguments)}let ah=(()=>{class l{constructor(u){this.providerId=l.PROVIDER_ID,this.auth=Ne(u)}verifyPhoneNumber(u,c){return Jr(this.auth,u,(0,R.m9)(c))}static credential(u,c){return cr._fromVerification(u,c)}static credentialFromResult(u){return l.credentialFromTaggedObject(u)}static credentialFromError(u){return l.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u)return null;const{phoneNumber:c,temporaryProof:p}=u;return c&&p?cr._fromTokenResponse(c,p):null}}return l.PROVIDER_ID="phone",l.PHONE_SIGN_IN_METHOD="phone",l})();function Qt(l,a){return a?q(a):(L(l._popupRedirectResolver,l,"argument-error"),l._popupRedirectResolver)}class on extends Or{constructor(a){super("custom","custom"),this.params=a}_getIdTokenResponse(a){return Zt(a,this._buildIdpRequest())}_linkToIdToken(a,u){return Zt(a,this._buildIdpRequest(u))}_getReauthenticationResolver(a){return Zt(a,this._buildIdpRequest())}_buildIdpRequest(a){const u={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return a&&(u.idToken=a),u}}function uh(l){return ol(l.auth,new on(l),l.bypassAuthState)}function vr(l){const{auth:a,user:u}=l;return L(u,a,"internal-error"),pr(u,new on(l),l.bypassAuthState)}function Vl(l){return Qi.apply(this,arguments)}function Qi(){return(Qi=(0,g.Z)(function*(l){const{auth:a,user:u}=l;return L(u,a,"internal-error"),nn(u,new on(l),l.bypassAuthState)})).apply(this,arguments)}class kl{constructor(a,u,c,p,_=!1){this.auth=a,this.resolver=c,this.user=p,this.bypassAuthState=_,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(u)?u:[u]}execute(){var a=this;return new Promise(function(){var u=(0,g.Z)(function*(c,p){a.pendingPromise={resolve:c,reject:p};try{a.eventManager=yield a.resolver._initialize(a.auth),yield a.onExecution(),a.eventManager.registerConsumer(a)}catch(_){a.reject(_)}});return function(c,p){return u.apply(this,arguments)}}())}onAuthEvent(a){var u=this;return(0,g.Z)(function*(){const{urlResponse:c,sessionId:p,postBody:_,tenantId:T,error:b,type:k}=a;if(b)return void u.reject(b);const $={auth:u.auth,requestUri:c,sessionId:p,tenantId:T||void 0,postBody:_||void 0,user:u.user,bypassAuthState:u.bypassAuthState};try{u.resolve(yield u.getIdpTask(k)($))}catch(Q){u.reject(Q)}})()}onError(a){this.reject(a)}getIdpTask(a){switch(a){case"signInViaPopup":case"signInViaRedirect":return uh;case"linkViaPopup":case"linkViaRedirect":return Vl;case"reauthViaPopup":case"reauthViaRedirect":return vr;default:ye(this.auth,"internal-error")}}resolve(a){Dt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(a),this.unregisterAndCleanUp()}reject(a){Dt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(a),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const lh=new mn(2e3,1e4);function Ot(l,a,u){return Er.apply(this,arguments)}function Er(){return(Er=(0,g.Z)(function*(l,a,u){const c=Ne(l);oe(l,a,jt);const p=Qt(c,u);return new po(c,"signInViaPopup",a,p).executeNotNull()})).apply(this,arguments)}function Yi(l,a,u){return fo.apply(this,arguments)}function fo(){return(fo=(0,g.Z)(function*(l,a,u){const c=(0,R.m9)(l);oe(c.auth,a,jt);const p=Qt(c.auth,u);return new po(c.auth,"reauthViaPopup",a,p,c).executeNotNull()})).apply(this,arguments)}function pt(l,a,u){return Ga.apply(this,arguments)}function Ga(){return(Ga=(0,g.Z)(function*(l,a,u){const c=(0,R.m9)(l);oe(c.auth,a,jt);const p=Qt(c.auth,u);return new po(c.auth,"linkViaPopup",a,p,c).executeNotNull()})).apply(this,arguments)}let po=(()=>{class l extends kl{constructor(u,c,p,_,T){super(u,c,_,T),this.provider=p,this.authWindow=null,this.pollId=null,l.currentPopupAction&&l.currentPopupAction.cancel(),l.currentPopupAction=this}executeNotNull(){var u=this;return(0,g.Z)(function*(){const c=yield u.execute();return L(c,u.auth,"internal-error"),c})()}onExecution(){var u=this;return(0,g.Z)(function*(){Dt(1===u.filter.length,"Popup operations only handle one event");const c=jr();u.authWindow=yield u.resolver._openPopup(u.auth,u.provider,u.filter[0],c),u.authWindow.associatedEvent=c,u.resolver._originValidation(u.auth).catch(p=>{u.reject(p)}),u.resolver._isIframeWebStorageSupported(u.auth,p=>{p||u.reject(ge(u.auth,"web-storage-unsupported"))}),u.pollUserCancellation()})()}get eventId(){var u;return(null===(u=this.authWindow)||void 0===u?void 0:u.associatedEvent)||null}cancel(){this.reject(ge(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,l.currentPopupAction=null}pollUserCancellation(){const u=()=>{var c,p;this.pollId=null!==(p=null===(c=this.authWindow)||void 0===c?void 0:c.window)&&void 0!==p&&p.closed?window.setTimeout(()=>{this.pollId=null,this.reject(ge(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(u,lh.get())};u()}}return l.currentPopupAction=null,l})();const an="pendingRedirect",Xr=new Map;class mo extends kl{constructor(a,u,c=!1){super(a,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],u,void 0,c),this.eventId=null}execute(){var a=()=>super.execute,u=this;return(0,g.Z)(function*(){let c=Xr.get(u.auth._key());if(!c){try{const _=(yield function Ol(l,a){return $a.apply(this,arguments)}(u.resolver,u.auth))?yield a().call(u):null;c=()=>Promise.resolve(_)}catch(p){c=()=>Promise.reject(p)}Xr.set(u.auth._key(),c)}return u.bypassAuthState||Xr.set(u.auth._key(),()=>Promise.resolve(null)),c()})()}onAuthEvent(a){var u=()=>super.onAuthEvent,c=this;return(0,g.Z)(function*(){if("signInViaRedirect"===a.type)return u().call(c,a);if("unknown"!==a.type){if(a.eventId){const p=yield c.auth._redirectUserForId(a.eventId);if(p)return c.user=p,u().call(c,a);c.resolve(null)}}else c.resolve(null)})()}onExecution(){return(0,g.Z)(function*(){})()}cleanUp(){}}function $a(){return($a=(0,g.Z)(function*(l,a){const u=Fl(a),c=Ml(l);if(!(yield c._isAvailable()))return!1;const p="true"===(yield c._get(u));return yield c._remove(u),p})).apply(this,arguments)}function Ka(l,a){return Za.apply(this,arguments)}function Za(){return(Za=(0,g.Z)(function*(l,a){return Ml(l)._set(Fl(a),"true")})).apply(this,arguments)}function ch(){Xr.clear()}function Ll(l,a){Xr.set(l._key(),a)}function Ml(l){return q(l._redirectPersistence)}function Fl(l){return ue(an,l.config.apiKey,l.name)}function hh(l,a,u){return function dh(l,a,u){return ja.apply(this,arguments)}(l,a,u)}function ja(){return(ja=(0,g.Z)(function*(l,a,u){const c=Ne(l);oe(l,a,jt),yield c._initializationPromise;const p=Qt(c,u);return yield Ka(p,c),p._openRedirect(c,a,"signInViaRedirect")})).apply(this,arguments)}function fh(l,a,u){return function ph(l,a,u){return Ha.apply(this,arguments)}(l,a,u)}function Ha(){return(Ha=(0,g.Z)(function*(l,a,u){const c=(0,R.m9)(l);oe(c.auth,a,jt),yield c.auth._initializationPromise;const p=Qt(c.auth,u);yield Ka(p,c.auth);const _=yield Io(c);return p._openRedirect(c.auth,a,"reauthViaRedirect",_)})).apply(this,arguments)}function mh(l,a,u){return function gh(l,a,u){return go.apply(this,arguments)}(l,a,u)}function go(){return(go=(0,g.Z)(function*(l,a,u){const c=(0,R.m9)(l);oe(c.auth,a,jt),yield c.auth._initializationPromise;const p=Qt(c.auth,u);yield Mi(!1,c,a.providerId),yield Ka(p,c.auth);const _=yield Io(c);return p._openRedirect(c.auth,a,"linkViaRedirect",_)})).apply(this,arguments)}function _h(l,a){return _o.apply(this,arguments)}function _o(){return(_o=(0,g.Z)(function*(l,a){return yield Ne(l)._initializationPromise,yo(l,a,!1)})).apply(this,arguments)}function yo(l,a){return Qa.apply(this,arguments)}function Qa(){return(Qa=(0,g.Z)(function*(l,a,u=!1){const c=Ne(l),p=Qt(c,a),T=yield new mo(c,p,u).execute();return T&&!u&&(delete T.user._redirectEventId,yield c._persistUserIfCurrent(T.user),yield c._setRedirectUser(null,a)),T})).apply(this,arguments)}function Io(l){return Ze.apply(this,arguments)}function Ze(){return(Ze=(0,g.Z)(function*(l){const a=jr(`${l.uid}:::`);return l._redirectEventId=a,yield l.auth._setRedirectUser(l),yield l.auth._persistUserIfCurrent(l),a})).apply(this,arguments)}class Pn{constructor(a){this.auth=a,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(a){this.consumers.add(a),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,a)&&(this.sendToConsumer(this.queuedRedirectEvent,a),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(a){this.consumers.delete(a)}onEvent(a){if(this.hasEventBeenHandled(a))return!1;let u=!1;return this.consumers.forEach(c=>{this.isEventForConsumer(a,c)&&(u=!0,this.sendToConsumer(a,c),this.saveEventToCache(a))}),this.hasHandledPotentialRedirect||!function vo(l){switch(l.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Se(l);default:return!1}}(a)||(this.hasHandledPotentialRedirect=!0,u||(this.queuedRedirectEvent=a,u=!0)),u}sendToConsumer(a,u){var c;if(a.error&&!Se(a)){const p=(null===(c=a.error.code)||void 0===c?void 0:c.split("auth/")[1])||"internal-error";u.onError(ge(this.auth,p))}else u.onAuthEvent(a)}isEventForConsumer(a,u){const c=null===u.eventId||!!a.eventId&&a.eventId===u.eventId;return u.filter.includes(a.type)&&c}hasEventBeenHandled(a){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ya(a))}saveEventToCache(a){this.cachedEventUids.add(Ya(a)),this.lastProcessedEventTime=Date.now()}}function Ya(l){return[l.type,l.eventId,l.sessionId,l.tenantId].filter(a=>a).join("-")}function Se({type:l,error:a}){return"unknown"===l&&"auth/no-auth-event"===a?.code}function it(l){return ve.apply(this,arguments)}function ve(){return(ve=(0,g.Z)(function*(l,a={}){return we(l,"GET","/v1/projects",a)})).apply(this,arguments)}const Bl=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ei=/^https?/;function Eo(){return(Eo=(0,g.Z)(function*(l){if(l.config.emulator)return;const{authorizedDomains:a}=yield it(l);for(const u of a)try{if(yh(u))return}catch{}ye(l,"unauthorized-domain")})).apply(this,arguments)}function yh(l){const a=Yt(),{protocol:u,hostname:c}=new URL(a);if(l.startsWith("chrome-extension://")){const T=new URL(l);return""===T.hostname&&""===c?"chrome-extension:"===u&&l.replace("chrome-extension://","")===a.replace("chrome-extension://",""):"chrome-extension:"===u&&T.hostname===c}if(!ei.test(u))return!1;if(Bl.test(l))return c===l;const p=l.replace(/\./g,"\\.");return new RegExp("^(.+\\."+p+"|"+p+")$","i").test(c)}const Je=new mn(3e4,6e4);function ql(){const l=Ve().___jsl;if(l?.H)for(const a of Object.keys(l.H))if(l.H[a].r=l.H[a].r||[],l.H[a].L=l.H[a].L||[],l.H[a].r=[...l.H[a].L],l.CP)for(let u=0;u<l.CP.length;u++)l.CP[u]=null}let Oe=null;const To=new mn(5e3,15e3),Ao="__/auth/iframe",Ji="emulator/auth/iframe",Ih={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Gn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function $n(l){const a=l.config;L(a.authDomain,l,"auth-domain-config-required");const u=a.emulator?As(a,Ji):`https://${l.config.authDomain}/${Ao}`,c={apiKey:a.apiKey,appName:l.name,v:A.SDK_VERSION},p=Gn.get(l.config.apiHost);p&&(c.eid=p);const _=l._getFrameworks();return _.length&&(c.fw=_.join(",")),`${u}?${(0,R.xO)(c).slice(1)}`}function un(){return un=(0,g.Z)(function*(l){const a=yield function Sn(l){return Oe=Oe||function Wn(l){return new Promise((a,u)=>{var c,p,_;function T(){ql(),gapi.load("gapi.iframes",{callback:()=>{a(gapi.iframes.getContext())},ontimeout:()=>{ql(),u(ge(l,"network-request-failed"))},timeout:Je.get()})}if(null!==(p=null===(c=Ve().gapi)||void 0===c?void 0:c.iframes)&&void 0!==p&&p.Iframe)a(gapi.iframes.getContext());else{if(null===(_=Ve().gapi)||void 0===_||!_.load){const b=wi("iframefcb");return Ve()[b]=()=>{gapi.load?T():u(ge(l,"network-request-failed"))},Ye(`https://apis.google.com/js/api.js?onload=${b}`).catch(k=>u(k))}T()}}).catch(a=>{throw Oe=null,a})}(l),Oe}(l),u=Ve().gapi;return L(u,l,"internal-error"),a.open({where:document.body,url:$n(l),messageHandlersFilter:u.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ih,dontclear:!0},c=>new Promise(function(){var p=(0,g.Z)(function*(_,T){yield c.restyle({setHideOnLeave:!1});const b=ge(l,"network-request-failed"),k=Ve().setTimeout(()=>{T(b)},To.get());function $(){Ve().clearTimeout(k),_(c)}c.ping($).then($,()=>{T(b)})});return function(_,T){return p.apply(this,arguments)}}()))}),un.apply(this,arguments)}const ln={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Ro{constructor(a){this.window=a,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const Ja="__/auth/handler",es="emulator/auth/handler",Wl=encodeURIComponent("fac");function So(l,a,u,c,p,_){return ni.apply(this,arguments)}function ni(){return(ni=(0,g.Z)(function*(l,a,u,c,p,_){L(l.config.authDomain,l,"auth-domain-config-required"),L(l.config.apiKey,l,"invalid-api-key");const T={apiKey:l.config.apiKey,appName:l.name,authType:u,redirectUrl:c,v:A.SDK_VERSION,eventId:p};if(a instanceof jt){a.setDefaultLanguage(l.languageCode),T.providerId=a.providerId||"",(0,R.xb)(a.getCustomParameters())||(T.customParameters=JSON.stringify(a.getCustomParameters()));for(const[Q,de]of Object.entries(_||{}))T[Q]=de}if(a instanceof Fr){const Q=a.getScopes().filter(de=>""!==de);Q.length>0&&(T.scopes=Q.join(","))}l.tenantId&&(T.tid=l.tenantId);const b=T;for(const Q of Object.keys(b))void 0===b[Q]&&delete b[Q];const k=yield l._getAppCheckToken(),$=k?`#${Wl}=${encodeURIComponent(k)}`:"";return`${function ts({config:l}){return l.emulator?As(l,es):`https://${l.authDomain}/${Ja}`}(l)}?${(0,R.xO)(b).slice(1)}${$}`})).apply(this,arguments)}const Co="webStorageSupport",Gl=class vh{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ma,this._completeRedirectFn=yo,this._overrideRedirectResult=Ll}_openPopup(a,u,c,p){var _=this;return(0,g.Z)(function*(){var T;Dt(null===(T=_.eventManagers[a._key()])||void 0===T?void 0:T.manager,"_initialize() not called before _openPopup()");const b=yield So(a,u,c,Yt(),p);return function Po(l,a,u,c=500,p=600){const _=Math.max((window.screen.availHeight-p)/2,0).toString(),T=Math.max((window.screen.availWidth-c)/2,0).toString();let b="";const k=Object.assign(Object.assign({},ln),{width:c.toString(),height:p.toString(),top:_,left:T}),$=(0,R.z$)().toLowerCase();u&&(b=Kt($)?"_blank":u),dt($)&&(a=a||"http://localhost",k.scrollbars="yes");const Q=Object.entries(k).reduce((Ct,[cn,hn])=>`${Ct}${cn}=${hn},`,"");if(function ca(l=(0,R.z$)()){var a;return ur(l)&&!(null===(a=window.navigator)||void 0===a||!a.standalone)}($)&&"_self"!==b)return function Tr(l,a){const u=document.createElement("a");u.href=l,u.target=a;const c=document.createEvent("MouseEvent");c.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),u.dispatchEvent(c)}(a||"",b),new Ro(null);const de=window.open(a||"",b,Q);L(de,l,"popup-blocked");try{de.focus()}catch{}return new Ro(de)}(a,b,jr())})()}_openRedirect(a,u,c,p){var _=this;return(0,g.Z)(function*(){return yield _._originValidation(a),function qn(l){Ve().location.href=l}(yield So(a,u,c,Yt(),p)),new Promise(()=>{})})()}_initialize(a){const u=a._key();if(this.eventManagers[u]){const{manager:p,promise:_}=this.eventManagers[u];return p?Promise.resolve(p):(Dt(_,"If manager is not set, promise should be"),_)}const c=this.initAndGetManager(a);return this.eventManagers[u]={promise:c},c.catch(()=>{delete this.eventManagers[u]}),c}initAndGetManager(a){var u=this;return(0,g.Z)(function*(){const c=yield function wo(l){return un.apply(this,arguments)}(a),p=new Pn(a);return c.register("authEvent",_=>(L(_?.authEvent,a,"invalid-auth-event"),{status:p.onEvent(_.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),u.eventManagers[a._key()]={manager:p},u.iframes[a._key()]=c,p})()}_isIframeWebStorageSupported(a,u){this.iframes[a._key()].send(Co,{type:Co},p=>{var _;const T=null===(_=p?.[0])||void 0===_?void 0:_[Co];void 0!==T&&u(!!T),ye(a,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(a){const u=a._key();return this.originValidationPromises[u]||(this.originValidationPromises[u]=function St(l){return Eo.apply(this,arguments)}(a)),this.originValidationPromises[u]}get _shouldInitProactively(){return da()||le()||ur()}};class $l{constructor(a){this.factorId=a}_process(a,u,c){switch(u.type){case"enroll":return this._finalizeEnroll(a,u.credential,c);case"signin":return this._finalizeSignIn(a,u.credential);default:return $e("unexpected MultiFactorSessionType")}}}class bo extends $l{constructor(a){super("phone"),this.credential=a}static _fromCredential(a){return new bo(a)}_finalizeEnroll(a,u,c){return function ut(l,a){return we(l,"POST","/v2/accounts/mfaEnrollment:finalize",ae(l,a))}(a,{idToken:u,displayName:c,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(a,u){return function Cl(l,a){return we(l,"POST","/v2/accounts/mfaSignIn:finalize",ae(l,a))}(a,{mfaPendingCredential:u,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let lt=(()=>{class l{constructor(){}static assertion(u){return bo._fromCredential(u)}}return l.FACTOR_ID="phone",l})();var Xa="@firebase/auth";class Th{constructor(a){this.auth=a,this.internalListeners=new Map}getUid(){var a;return this.assertAuthConfigured(),(null===(a=this.auth.currentUser)||void 0===a?void 0:a.uid)||null}getToken(a){var u=this;return(0,g.Z)(function*(){return u.assertAuthConfigured(),yield u.auth._initializationPromise,u.auth.currentUser?{accessToken:yield u.auth.currentUser.getIdToken(a)}:null})()}addAuthTokenListener(a){if(this.assertAuthConfigured(),this.internalListeners.has(a))return;const u=this.auth.onIdTokenChanged(c=>{a(c?.stsTokenManager.accessToken||null)});this.internalListeners.set(a,u),this.updateProactiveRefresh()}removeAuthTokenListener(a){this.assertAuthConfigured();const u=this.internalListeners.get(a);u&&(this.internalListeners.delete(a),u(),this.updateProactiveRefresh())}assertAuthConfigured(){L(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const ii=(0,R.Pz)("authIdTokenMaxAge")||300;let xo=null;const eu=l=>function(){var a=(0,g.Z)(function*(u){const c=u&&(yield u.getIdTokenResult()),p=c&&((new Date).getTime()-Date.parse(c.issuedAtTime))/1e3;if(p&&p>ii)return;const _=c?.token;xo!==_&&(xo=_,yield fetch(l,{method:_?"POST":"DELETE",headers:_?{Authorization:`Bearer ${_}`}:{}}))});return function(u){return a.apply(this,arguments)}}();function Zl(l=(0,A.getApp)()){const a=(0,A._getProvider)(l,"auth");if(a.isInitialized())return a.getImmediate();const u=function ya(l,a){const u=(0,A._getProvider)(l,"auth");if(u.isInitialized()){const p=u.getImmediate(),_=u.getOptions();if((0,R.vZ)(_,a??{}))return p;ye(p,"already-initialized")}return u.initialize({options:a})}(l,{popupRedirectResolver:Gl,persistence:[ih,wl,Ma]}),c=(0,R.Pz)("authTokenSyncURL");if(c){const _=eu(c);(function Va(l,a,u){(0,R.m9)(l).beforeAuthStateChanged(a,u)})(u,_,()=>_(u.currentUser)),function Ht(l,a,u,c){(0,R.m9)(l).onIdTokenChanged(a,u,c)}(u,T=>_(T))}const p=(0,R.q4)("auth");return p&&Zu(u,`http://${p}`),u}!function ce(l){(0,A._registerComponent)(new D.wA("auth",(a,{options:u})=>{const c=a.getProvider("app").getImmediate(),p=a.getProvider("heartbeat"),_=a.getProvider("app-check-internal"),{apiKey:T,authDomain:b}=c.options;L(T&&!T.includes(":"),"invalid-api-key",{appName:c.name});const k={apiKey:T,authDomain:b,clientPlatform:l,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:qu(l)},$=new fa(c,p,_,k);return function Ku(l,a){const u=a?.persistence||[],c=(Array.isArray(u)?u:[u]).map(q);a?.errorMap&&l._updateErrorMap(a.errorMap),l._initializeWithPersistence(c,a?.popupRedirectResolver)}($,u),$},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((a,u,c)=>{a.getProvider("auth-internal").initialize()})),(0,A._registerComponent)(new D.wA("auth-internal",a=>{const u=Ne(a.getProvider("auth").getImmediate());return new Th(u)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,A.registerVersion)(Xa,"1.4.0",function Kl(l){switch(l){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(l)),(0,A.registerVersion)(Xa,"1.4.0","esm2017")}("Browser")},8736:(vs,Ft,F)=>{F.d(Ft,{s:()=>ze});var g=F(5879),R=F(6814),A=F(7852),he=F(95);function gt(Ae,be){if(1&Ae&&g._UZ(0,"ion-icon",3),2&Ae){const He=g.oxw();g.Q6J("name",He.icon)}}function D(Ae,be){if(1&Ae){const He=g.EpF();g.TgZ(0,"ion-button",4),g.NdJ("click",function(){g.CHM(He);const Tt=g.oxw();return g.KtG(Tt.shorOrHidePassword())}),g._UZ(1,"ion-icon",5),g.qZA()}if(2&Ae){const He=g.oxw();g.xp6(1),g.Q6J("name",He.hide?"eye-outline":"eye-off-outline")}}let ze=(()=>{var Ae;class be{constructor(){this.hide=!0}ngOnInit(){"password"==this.type&&(this.isPassword=!0)}shorOrHidePassword(){this.hide=!this.hide,this.type=this.hide?"password":"text"}}return(Ae=be).\u0275fac=function(Qe){return new(Qe||Ae)},Ae.\u0275cmp=g.Xpm({type:Ae,selectors:[["app-login-custom"]],inputs:{control:"control",type:"type",label:"label",autocomplete:"autocomplete",icon:"icon"},decls:4,vars:6,consts:[["color","primary","slot","start",3,"name",4,"ngIf"],["label-placement","floating",3,"type","autocomplete","label","formControl"],["slot","end","fill","clear","shape","round",3,"click",4,"ngIf"],["color","primary","slot","start",3,"name"],["slot","end","fill","clear","shape","round",3,"click"],["slot","icon-only",3,"name"]],template:function(Qe,Tt){1&Qe&&(g.TgZ(0,"ion-item"),g.YNc(1,gt,1,1,"ion-icon",0),g._UZ(2,"ion-input",1),g.YNc(3,D,2,1,"ion-button",2),g.qZA()),2&Qe&&(g.xp6(1),g.Q6J("ngIf",Tt.icon),g.xp6(1),g.Q6J("type",Tt.type)("autocomplete",Tt.autocomplete)("label",Tt.label)("formControl",Tt.control),g.xp6(1),g.Q6J("ngIf",Tt.isPassword))},dependencies:[R.O5,A.YG,A.gu,A.pK,A.Ie,A.j9,he.JJ,he.oH]}),be})()},5346:(vs,Ft,F)=>{F.d(Ft,{m:()=>gt});var g=F(6814),R=F(7852),A=F(95),he=F(5879);let gt=(()=>{var D;class ze{}return(D=ze).\u0275fac=function(be){return new(be||D)},D.\u0275mod=he.oAB({type:D}),D.\u0275inj=he.cJS({imports:[g.ez,R.Pc,A.UX,A.u5,A.UX]}),ze})()},6488:(vs,Ft,F)=>{F.r(Ft),F.d(Ft,{LoginPageModule:()=>Dn});var g=F(6814),R=F(95),A=F(7852),he=F(1160),gt=F(5861),D=F(5879),ze=F(547),Ae=F(4532),be=F(8736);function He(ne,ye){1&ne&&(D.TgZ(0,"div"),D._uU(1,"El correo es requerido"),D.qZA())}function Qe(ne,ye){1&ne&&(D.TgZ(0,"div"),D._uU(1,"Ingrese un correo valido"),D.qZA())}function Tt(ne,ye){if(1&ne&&(D.TgZ(0,"div",10),D._UZ(1,"br"),D.YNc(2,He,2,0,"div",11),D.YNc(3,Qe,2,0,"div",11),D.qZA()),2&ne){const ge=D.oxw();D.xp6(2),D.Q6J("ngIf",null==ge.form.controls.email.errors?null:ge.form.controls.email.errors.required),D.xp6(1),D.Q6J("ngIf",null==ge.form.controls.email.errors?null:ge.form.controls.email.errors.email)}}function $t(ne,ye){1&ne&&(D.TgZ(0,"div"),D._uU(1,"La contrase\xf1a es requerida"),D.qZA())}function Ut(ne,ye){if(1&ne&&(D.TgZ(0,"div",10),D._UZ(1,"br"),D.YNc(2,$t,2,0,"div",11),D.qZA()),2&ne){const ge=D.oxw();D.xp6(2),D.Q6J("ngIf",null==ge.form.controls.password.errors?null:ge.form.controls.password.errors.required)}}const bn=[{path:"",component:(()=>{var ne;class ye{constructor(Ee,oe){this.router=Ee,this.toastController=oe,this.form=new R.cw({email:new R.NI("",[R.kI.required,R.kI.email]),password:new R.NI("",[R.kI.required])}),this.firebaseSvc=(0,D.f3M)(ze.O),this.utilSvc=(0,D.f3M)(Ae.F)}ngOnInit(){}submit(){var Ee=this;return(0,gt.Z)(function*(){if(Ee.form.valid){const oe=yield Ee.utilSvc.loading();yield oe.present(),Ee.firebaseSvc.signIn(Ee.form.value).then(et=>{localStorage.setItem("ingresado","true"),Ee.utilSvc.routerLink("/home"),Ee.getUserInfo(et.user.uid)}).catch(et=>{console.log(et),Ee.utilSvc.presentToast({message:et.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>{oe.dismiss()})}})()}getUserInfo(Ee){var oe=this;return(0,gt.Z)(function*(){if(oe.form.valid){const et=yield oe.utilSvc.loading();yield et.present(),oe.firebaseSvc.getDocument(`users/${Ee}`).then($e=>{oe.utilSvc.saveInLocalStorage("user",$e),localStorage.setItem("ingresado","true"),oe.utilSvc.routerLink("/home"),oe.form.reset(),oe.utilSvc.presentToast({message:`Bienvenido ${$e.name}`,duration:1500,color:"primary",position:"middle",icon:"person-circle-outline"})}).catch($e=>{console.log($e),oe.utilSvc.presentToast({message:$e.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>{et.dismiss()})}})()}presentToast(Ee,oe,et){var L=this;return(0,gt.Z)(function*(){yield(yield L.toastController.create({message:oe,duration:et||2e3,position:Ee})).present()})()}}return(ne=ye).\u0275fac=function(Ee){return new(Ee||ne)(D.Y36(he.F0),D.Y36(A.yF))},ne.\u0275cmp=D.Xpm({type:ne,selectors:[["app-login"]],decls:27,vars:6,consts:[[1,"d-flex-center"],[1,"auth-form",3,"formGroup","ngSubmit","keypress.enter"],["autocomplete","email","type","email","label","Correo","icon","mail-outline",3,"control"],["class","validators",4,"ngIf"],["type","password","label","Contrase\xf1a","icon","lock-closed-outline",3,"control"],["routerLink","forgot-pass"],["expand","block","mode","md","type","submit",1,"submit",3,"disabled"],["slot","end","name","log-in-outline"],["expand","block","routerLink","sign-up","mode","md","fill","outline",1,"ion-margin-top"],["slot","end","name","person-add-outline"],[1,"validators"],[4,"ngIf"]],template:function(Ee,oe){1&Ee&&(D.TgZ(0,"ion-content")(1,"ion-card")(2,"div",0)(3,"ion-card-header")(4,"ion-card-title"),D._uU(5,"Inicio de Sesi\xf3n"),D.qZA()(),D.TgZ(6,"form",1),D.NdJ("ngSubmit",function(){return oe.submit()})("keypress.enter",function(){return oe.submit()}),D.TgZ(7,"ion-card-content")(8,"ion-item"),D._UZ(9,"app-login-custom",2)(10,"br")(11,"br"),D.qZA(),D.YNc(12,Tt,4,2,"div",3),D.TgZ(13,"ion-item"),D._UZ(14,"app-login-custom",4),D.qZA(),D.YNc(15,Ut,3,1,"div",3),D._UZ(16,"br"),D.TgZ(17,"p",5),D._uU(18,"\xbfOlvidaste tu contrase\xf1a?"),D.qZA(),D.TgZ(19,"ion-col")(20,"ion-button",6),D._uU(21," Ingresar "),D._UZ(22,"ion-icon",7),D.qZA()(),D.TgZ(23,"ion-col")(24,"ion-button",8),D._uU(25," Registrarse "),D._UZ(26,"ion-icon",9),D.qZA()()()()()()()),2&Ee&&(D.xp6(6),D.Q6J("formGroup",oe.form),D.xp6(3),D.Q6J("control",oe.form.controls.email),D.xp6(3),D.Q6J("ngIf",oe.form.controls.email.errors&&oe.form.controls.email.touched),D.xp6(2),D.Q6J("control",oe.form.controls.password),D.xp6(1),D.Q6J("ngIf",oe.form.controls.password.errors&&oe.form.controls.password.touched),D.xp6(5),D.Q6J("disabled",oe.form.invalid))},dependencies:[g.O5,R._Y,R.JL,A.YG,A.PM,A.FN,A.Zi,A.Dq,A.wI,A.W2,A.gu,A.Ie,A.YI,he.rH,R.sg,be.s],styles:["html[_ngcontent-%COMP%]{height:100%}.icon-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.bg[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide 3s ease-in-out infinite alternate!important;background-image:linear-gradient(-60deg,#6c3 50%,#09f 50%)!important;inset:0 -50%!important;opacity:.5!important;position:fixed!important;z-index:-1!important}.bg2[_ngcontent-%COMP%]{animation-direction:alternate-reverse!important;animation-duration:4s!important}.bg3[_ngcontent-%COMP%]{animation-duration:5s!important}.content[_ngcontent-%COMP%]{background-color:#fffc!important;border-radius:.25em!important;box-shadow:0 0 .25em #00000040!important;box-sizing:border-box!important;left:50%!important;padding:10vmin!important;position:fixed!important;text-align:center!important;top:50%!important;transform:translate(-50%,-50%)!important}h1[_ngcontent-%COMP%]{font-family:monospace!important}@keyframes _ngcontent-%COMP%_slide{0%{transform:translate(-25%)}to{transform:translate(25%)}}ion-content[_ngcontent-%COMP%]{--background: url(https://4kwallpapers.com/images/wallpapers/ios-13-stock-ipados-green-black-background-amoled-ipad-hd-1125x2436-793.jpg) no-repeat center center / cover}"]}),ye})()},{path:"sign-up",loadChildren:()=>F.e(3791).then(F.bind(F,3791)).then(ne=>ne.SignUpPageModule)},{path:"forgot-pass",loadChildren:()=>F.e(1595).then(F.bind(F,1595)).then(ne=>ne.ForgotPassPageModule)}];let Es=(()=>{var ne;class ye{}return(ne=ye).\u0275fac=function(Ee){return new(Ee||ne)},ne.\u0275mod=D.oAB({type:ne}),ne.\u0275inj=D.cJS({imports:[he.Bz.forChild(bn),he.Bz]}),ye})();var xn=F(5346);let Dn=(()=>{var ne;class ye{}return(ne=ye).\u0275fac=function(Ee){return new(Ee||ne)},ne.\u0275mod=D.oAB({type:ne}),ne.\u0275inj=D.cJS({imports:[g.ez,R.u5,A.Pc,Es,R.UX,xn.m]}),ye})()},547:(vs,Ft,F)=>{F.d(Ft,{O:()=>Rv});var g=F(5861),R=F(5879),A=F(1180),gt=(F(6365),F(6814)),D=F(1920),ze=F(7217),Ae=F(8645),be=F(2096),He=F(5592),Qe=F(2459),Tt=F(3019),$t=F(3093),Ut=F(4664),ct=F(7398),bn=F(4552);class Es extends Ae.x{constructor(e=1/0,t=1/0,r=bn.l){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:r,_infiniteTimeWindow:i,_timestampProvider:s,_windowTime:o}=this;t||(r.push(e),!i&&r.push(s.now()+o)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:r,_buffer:i}=this,s=i.slice();for(let o=0;o<s.length&&!e.closed;o+=r?1:2)e.next(s[o]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:r,_infiniteTimeWindow:i}=this,s=(i?1:2)*e;if(e<1/0&&s<r.length&&r.splice(0,r.length-s),!i){const o=t.now();let h=0;for(let d=1;d<r.length&&r[d]<=o;d+=2)h=d;h&&r.splice(0,h+1)}}}var xn=F(3020);function Dn(n,e,t){let r,i=!1;return n&&"object"==typeof n?({bufferSize:r=1/0,windowTime:e=1/0,refCount:i=!1,scheduler:t}=n):r=n??1/0,(0,xn.B)({connector:()=>new Es(r,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}var ne=F(1374),ye=F(4674);function ge(n,e){return(0,ye.m)(e)?(0,Ut.w)(()=>n,e):(0,Ut.w)(()=>n)}var Ee=F(5137),oe=F(2181);F(7142);const $e=new R.OlP("angularfire2.auth.use-emulator"),Dt=new R.OlP("angularfire2.auth.settings"),Yt=new R.OlP("angularfire2.auth.tenant-id"),Nn=new R.OlP("angularfire2.auth.langugage-code"),_i=new R.OlP("angularfire2.auth.use-device-language"),Ts=new R.OlP("angularfire.auth.persistence"),Xn=(n,e,t,r,i,s,o,h)=>(0,ze.cc)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const d=e.runOutsideAngular(()=>n.auth());if(t&&d.useEmulator(...t),r&&(d.tenantId=r),d.languageCode=i,s&&d.useDeviceLanguage(),o)for(const[f,m]of Object.entries(o))d.settings[f]=m;return h&&d.setPersistence(h),d},[t,r,i,s,o,h]);let mn=(()=>{var n;class e{constructor(r,i,s,o,h,d,f,m,y,I,P,O){(0,A.Z)(this,"authState",void 0),(0,A.Z)(this,"idToken",void 0),(0,A.Z)(this,"user",void 0),(0,A.Z)(this,"idTokenResult",void 0),(0,A.Z)(this,"credential",void 0);const U=new Ae.x,M=(0,be.of)(void 0).pipe((0,$t.Q)(h.outsideAngular),(0,Ut.w)(()=>o.runOutsideAngular(()=>Promise.resolve().then(F.bind(F,6365)))),(0,ct.U)(()=>(0,ze.on)(r,o,i)),(0,ct.U)(Z=>Xn(Z,o,d,m,y,I,f,P)),Dn({bufferSize:1,refCount:!1}));if((0,gt.PM)(s))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,be.of)(null);else{M.pipe((0,ne.P)()).subscribe();const Z=M.pipe((0,Ut.w)(H=>H.getRedirectResult().then(se=>se,()=>null)),D.iC,Dn({bufferSize:1,refCount:!1})),J=M.pipe((0,Ut.w)(H=>new He.y(se=>({unsubscribe:o.runOutsideAngular(()=>H.onAuthStateChanged(re=>se.next(re),re=>se.error(re),()=>se.complete()))})))),Y=M.pipe((0,Ut.w)(H=>new He.y(se=>({unsubscribe:o.runOutsideAngular(()=>H.onIdTokenChanged(re=>se.next(re),re=>se.error(re),()=>se.complete()))}))));this.authState=Z.pipe(ge(J),(0,Ee.R)(h.outsideAngular),(0,$t.Q)(h.insideAngular)),this.user=Z.pipe(ge(Y),(0,Ee.R)(h.outsideAngular),(0,$t.Q)(h.insideAngular)),this.idToken=this.user.pipe((0,Ut.w)(H=>H?(0,Qe.D)(H.getIdToken()):(0,be.of)(null))),this.idTokenResult=this.user.pipe((0,Ut.w)(H=>H?(0,Qe.D)(H.getIdTokenResult()):(0,be.of)(null))),this.credential=(0,Tt.T)(Z,U,this.authState.pipe((0,oe.h)(H=>!H))).pipe((0,ct.U)(H=>H?.user?H:null),(0,Ee.R)(h.outsideAngular),(0,$t.Q)(h.insideAngular))}return(0,ze.pX)(this,M,o,{spy:{apply:(Z,J,Y)=>{(Z.startsWith("signIn")||Z.startsWith("createUser"))&&Y.then(H=>U.next(H))}}})}}return n=e,(0,A.Z)(e,"\u0275fac",function(r){return new(r||n)(R.LFG(ze.Dh),R.LFG(ze.xv,8),R.LFG(R.Lbi),R.LFG(R.R0b),R.LFG(D.HU),R.LFG($e,8),R.LFG(Dt,8),R.LFG(Yt,8),R.LFG(Nn,8),R.LFG(_i,8),R.LFG(Ts,8),R.LFG(D.Rf,8))}),(0,A.Z)(e,"\u0275prov",R.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"})),e})();var gn=F(4562),Ie=F(9058),Vn=F(534),ae=F(7879),we=F(4537),yi=F(6321),Jt=F(7921),Ii=F(9360),Bt=F(8251);function er(){return(0,Ii.e)((n,e)=>{let t,r=!1;n.subscribe((0,Bt.x)(e,i=>{const s=t;t=i,r&&e.next([s,i]),r=!0}))})}var z,br=F(6699),ia=F(3997),sa=F(3106),kn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ht={},tr=tr||{},X=kn||self;function Xt(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function On(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var _n="closure_uid_"+(1e9*Math.random()>>>0),xr=0;function oa(n,e,t){return n.call.apply(n.bind,arguments)}function nr(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Ke(n,e,t){return(Ke=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?oa:nr).apply(null,arguments)}function Ln(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function De(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),h=2;h<arguments.length;h++)o[h-2]=arguments[h];return e.prototype[i].apply(r,o)}}function yn(){this.s=this.s,this.o=this.o}yn.prototype.s=!1,yn.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function at(n){Object.prototype.hasOwnProperty.call(n,_n)&&n[_n]||(n[_n]=++xr)}(this)},yn.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const rr=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function ir(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function sr(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(Xt(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function tt(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}tt.prototype.h=function(){this.defaultPrevented=!0};var qt=function(){if(!X.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{X.addEventListener("test",()=>{},e),X.removeEventListener("test",()=>{},e)}catch{}return n}();function Be(n){return/^[\s\xa0]*$/.test(n)}function Mn(){var n=X.navigator;return n&&(n=n.userAgent)?n:""}function At(n){return-1!=Mn().indexOf(n)}function Dr(n){return Dr[" "](n),n}Dr[" "]=function(){};var Ei,n,In=At("Opera"),vn=At("Trident")||At("MSIE"),or=At("Edge"),vi=or||vn,Nr=At("Gecko")&&!(-1!=Mn().toLowerCase().indexOf("webkit")&&!At("Edge"))&&!(At("Trident")||At("MSIE"))&&!At("Edge"),aa=-1!=Mn().toLowerCase().indexOf("webkit")&&!At("Edge");function Vr(){var n=X.document;return n?n.documentMode:void 0}e:{var ar="",S=(n=Mn(),Nr?/rv:([^\);]+)(\)|;)/.exec(n):or?/Edge\/([\d\.]+)/.exec(n):vn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):aa?/WebKit\/(\S+)/.exec(n):In?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(S&&(ar=S?S[1]:""),vn){var E=Vr();if(null!=E&&E>parseFloat(ar)){Ei=String(E);break e}}Ei=ar}var q=X.document&&vn&&(Vr()||parseInt(Ei,10))||void 0;function te(n,e){if(tt.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Nr){e:{try{Dr(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:pe[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&te.$.h.call(this)}}De(te,tt);var pe={2:"touch",3:"pen",4:"mouse"};te.prototype.h=function(){te.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var ue="closure_listenable_"+(1e6*Math.random()|0),Fe=0;function wt(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++Fe,this.fa=this.ia=!1}function dt(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function le(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function kr(n){const e={};for(const t in n)e[t]=n[t];return e}const ws="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ua(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<ws.length;s++)t=ws[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Ti(n){this.src=n,this.g={},this.h=0}function ur(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=rr(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(dt(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function la(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}Ti.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var o=la(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):((e=new wt(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var ca="closure_lm_"+(1e6*Math.random()|0),ha={};function da(n,e,t,r,i){if(r&&r.once)return zu(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)da(n,e[s],t,r,i);return null}return t=Rs(t),n&&n[ue]?n.O(e,t,On(r)?!!r.capture:!!r,i):Bu(n,e,t,!1,r,i)}function Bu(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=On(i)?!!i.capture:!!i,h=fa(n);if(h||(n[ca]=h=new Ti(n)),(t=h.add(e,t,r,o,s)).proxy)return t;if(r=function qu(){const e=Oc;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)qt||(i=o),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(Gu(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function zu(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)zu(n,e[s],t,r,i);return null}return t=Rs(t),n&&n[ue]?n.P(e,t,On(r)?!!r.capture:!!r,i):Bu(n,e,t,!0,r,i)}function Wu(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Wu(n,e[s],t,r,i);else r=On(r)?!!r.capture:!!r,t=Rs(t),n&&n[ue]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=la(s=n.g[e],t,r,i))&&(dt(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=fa(n))&&(e=n.g[e.toString()],n=-1,e&&(n=la(e,t,r,i)),(t=-1<n?e[n]:null)&&Ai(t))}function Ai(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[ue])ur(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(Gu(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=fa(e))?(ur(t,n),0==t.h&&(t.src=null,e[ca]=null)):dt(n)}}}function Gu(n){return n in ha?ha[n]:ha[n]="on"+n}function Oc(n,e){if(n.fa)n=!0;else{e=new te(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Ai(n),n=t.call(r,e)}return n}function fa(n){return(n=n[ca])instanceof Ti?n:null}var Ne="__closure_events_fn_"+(1e9*Math.random()>>>0);function Rs(n){return"function"==typeof n?n:(n[Ne]||(n[Ne]=function(e){return n.handleEvent(e)}),n[Ne])}function nt(){yn.call(this),this.i=new Ti(this),this.S=this,this.J=null}function Ye(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new tt(e,n);else if(e instanceof tt)e.target=e.target||n;else{var i=e;ua(e=new tt(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=wi(o,r,!0,e)&&i}if(i=wi(o=e.g=n,r,!0,e)&&i,i=wi(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=wi(o=e.g=t[s],r,!1,e)&&i}function wi(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var h=o.listener,d=o.la||o.src;o.ia&&ur(n.i,o),i=!1!==h.call(d,r)&&i}}return i&&!r.defaultPrevented}De(nt,yn),nt.prototype[ue]=!0,nt.prototype.removeEventListener=function(n,e,t,r){Wu(this,n,e,t,r)},nt.prototype.N=function(){if(nt.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)dt(t[r]);delete n.g[e],n.h--}}this.J=null},nt.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},nt.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var pa=X.JSON.stringify;function Mc(){var n=ya;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var ma=new class Lc{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new ga,n=>n.reset());class ga{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Ri(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function _a(n){X.setTimeout(()=>{throw n},0)}let Pi,lr=!1,ya=new class $u{constructor(){this.h=this.g=null}add(e,t){const r=ma.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},Ku=()=>{const n=X.Promise.resolve(void 0);Pi=()=>{n.then(Zu)}};var Zu=()=>{for(var n;n=Mc();){try{n.h.call(n.g)}catch(t){_a(t)}var e=ma;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}lr=!1};function Si(n,e){nt.call(this),this.h=n||1,this.g=e||X,this.j=Ke(this.qb,this),this.l=Date.now()}function Ia(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function Ps(n,e,t){if("function"==typeof n)t&&(n=Ke(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=Ke(n.handleEvent,n)}return 2147483647<Number(e)?-1:X.setTimeout(n,e||0)}function ju(n){n.g=Ps(()=>{n.g=null,n.i&&(n.i=!1,ju(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}De(Si,nt),(z=Si.prototype).ga=!1,z.T=null,z.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ye(this,"tick"),this.ga&&(Ia(this),this.start()))}},z.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},z.N=function(){Si.$.N.call(this),Ia(this),delete this.g};class Or extends yn{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:ju(this)}N(){super.N(),this.g&&(X.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Lr(n){yn.call(this),this.h=n,this.g={}}De(Lr,yn);var Ss=[];function Hu(n,e,t,r){Array.isArray(t)||(t&&(Ss[0]=t.toString()),t=Ss);for(var i=0;i<t.length;i++){var s=da(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function Cs(n){le(n.g,function(e,t){this.g.hasOwnProperty(t)&&Ai(e)},n),n.g={}}function bs(){this.g=!0}function Fn(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Ea(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return pa(t)}catch{return e}}(n,t)+(r?" "+r:"")})}Lr.prototype.N=function(){Lr.$.N.call(this),Cs(this)},Lr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},bs.prototype.Ea=function(){this.g=!1},bs.prototype.info=function(){};var tn={},xs=null;function Ds(){return xs=xs||new nt}function Ns(n){tt.call(this,tn.Ta,n)}function Ci(n){const e=Ds();Ye(e,new Ns(e))}function Vs(n,e){tt.call(this,tn.STAT_EVENT,n),this.stat=e}function yt(n){const e=Ds();Ye(e,new Vs(e,n))}function ks(n,e){tt.call(this,tn.Ua,n),this.size=e}function bi(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return X.setTimeout(function(){n()},e)}tn.Ta="serverreachability",De(Ns,tt),tn.STAT_EVENT="statevent",De(Vs,tt),tn.Ua="timingevent",De(ks,tt);var Mr={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Qu={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function xi(){}function Os(){}xi.prototype.h=null;var Ta,En={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Zt(){tt.call(this,"d")}function Di(){tt.call(this,"c")}function Nt(){}function Ni(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Lr(this),this.P=Bc,this.V=new Si(n=vi?125:void 0),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Ls}function Ls(){this.i=null,this.g="",this.h=!1}De(Zt,tt),De(Di,tt),De(Nt,xi),Nt.prototype.g=function(){return new XMLHttpRequest},Nt.prototype.i=function(){return{}},Ta=new Nt;var Bc=45e3,Vi={},Ms={};function ki(n,e,t){n.L=1,n.v=Ur(Rt(e)),n.s=t,n.S=!0,Ju(n,null)}function Ju(n,e){n.G=Date.now(),Oi(n),n.A=Rt(n.v);var t=n.A,r=n.W;Array.isArray(r)||(r=[String(r)]),Gs(t.i,"t",r),n.C=0,t=n.l.J,n.h=new Ls,n.g=Il(n.l,t?e:null,!n.s),0<n.O&&(n.M=new Or(Ke(n.Pa,n,n.g),n.O)),Hu(n.U,n.g,"readystatechange",n.nb),e=n.I?kr(n.I):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.A,n.u,n.s,e)):(n.u="GET",n.g.ha(n.A,n.u,null,e)),Ci(),function va(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",h=s.split("&"),d=0;d<h.length;d++){var f=h[d].split("=");if(1<f.length){var m=f[0];f=f[1];var y=m.split("_");o=2<=y.length&&"type"==y[1]?o+(m+"=")+f+"&":o+(m+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.W,n.s)}function Xu(n){return!!n.g&&"GET"==n.u&&2!=n.L&&n.l.Ha}function Fs(n,e,t){let i,r=!0;for(;!n.J&&n.C<t.length;){if(i=cr(n,t),i==Ms){4==e&&(n.o=4,yt(14),r=!1),Fn(n.j,n.m,null,"[Incomplete Response]");break}if(i==Vi){n.o=4,yt(15),Fn(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}Fn(n.j,n.m,i,null),jt(n,i)}Xu(n)&&i!=Ms&&i!=Vi&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,yt(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),xa(e),e.M=!0,yt(11))):(Fn(n.j,n.m,t,"[Invalid Chunked Response]"),Tn(n),Us(n))}function cr(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?Ms:(t=Number(e.substring(t,r)),isNaN(t)?Vi:(r+=1)+t>e.length?Ms:(e=e.slice(r,r+t),n.C=r+t,e))}function Oi(n){n.Y=Date.now()+n.P,el(n,n.P)}function el(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=bi(Ke(n.lb,n),e)}function Un(n){n.B&&(X.clearTimeout(n.B),n.B=null)}function Us(n){0==n.l.H||n.J||no(n.l,n)}function Tn(n){Un(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,Ia(n.V),Cs(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function jt(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||Fi(t.i,n)))if(!n.K&&Fi(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;Ki(t),Wr(t)}$i(t),yt(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=bi(Ke(t.ib,t),6e3));if(1>=wa(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else zt(t,11)}else if((n.K||t.g==n)&&Ki(t),!Be(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let f=i[e];if(t.V=f[0],f=f[1],2==t.H)if("c"==f[0]){t.K=f[1],t.pa=f[2];const m=f[3];null!=m&&(t.ra=m,t.l.info("VER="+t.ra));const y=f[4];null!=y&&(t.Ga=y,t.l.info("SVER="+t.Ga));const I=f[5];null!=I&&"number"==typeof I&&0<I&&(t.L=r=1.5*I,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const P=n.g;if(P){const O=P.g?P.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(O){var s=r.i;s.g||-1==O.indexOf("spdy")&&-1==O.indexOf("quic")&&-1==O.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(js(s,s.h),s.h=null))}if(r.F){const U=P.g?P.g.getResponseHeader("X-HTTP-Session-Id"):null;U&&(r.Da=U,xe(r.I,r.F,U))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var o=n;if((r=t).wa=yl(r,r.J?r.pa:null,r.Y),o.K){Hs(r.i,o);var h=o,d=r.L;d&&h.setTimeout(d),h.B&&(Un(h),Oi(h)),r.g=o}else ml(r);0<t.j.length&&Gr(t)}else"stop"!=f[0]&&"close"!=f[0]||zt(t,7);else 3==t.H&&("stop"==f[0]||"close"==f[0]?"stop"==f[0]?zt(t,7):ba(t):"noop"!=f[0]&&t.h&&t.h.Aa(f),t.A=0)}Ci()}catch{}}function tl(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(Xt(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function Li(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Xt(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function Fr(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(Xt(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(z=Ni.prototype).setTimeout=function(n){this.P=n},z.nb=function(n){n=n.target;const e=this.M;e&&3==rn(n)?e.l():this.Pa(n)},z.Pa=function(n){try{if(n==this.g)e:{const m=rn(this.g);var e=this.g.Ia();if(this.g.da(),!(3>m)&&(3!=m||vi||this.g&&(this.h.h||this.g.ja()||Js(this.g)))){this.J||4!=m||7==e||Ci(),Un(this);var t=this.g.da();this.ca=t;t:if(Xu(this)){var r=Js(this.g);n="";var i=r.length,s=4==rn(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Tn(this),Us(this);var o="";break t}this.h.i=new X.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function Fc(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+o})}(this.j,this.u,this.A,this.m,this.W,m,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var h,d=this.g;if((h=d.g?d.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Be(h)){var f=h;break t}}f=null}if(!(t=f)){this.i=!1,this.o=3,yt(12),Tn(this),Us(this);break e}Fn(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,jt(this,t)}this.S?(Fs(this,m,o),vi&&this.i&&3==m&&(Hu(this.U,this.V,"tick",this.mb),this.V.start())):(Fn(this.j,this.m,o,null),jt(this,o)),4==m&&Tn(this),this.i&&!this.J&&(4==m?no(this.l,this):(this.i=!1,Oi(this)))}else(function Kc(n){const e={};n=(n.g&&2<=rn(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(Be(n[r]))continue;var t=Ri(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function Kt(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<o.indexOf("Unknown SID")?(this.o=3,yt(12)):(this.o=0,yt(13)),Tn(this),Us(this)}}}catch{}},z.mb=function(){if(this.g){var n=rn(this.g),e=this.g.ja();this.C<e.length&&(Un(this),Fs(this,n,e),this.i&&4!=n&&Oi(this))}},z.cancel=function(){this.J=!0,Tn(this)},z.lb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function Uc(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.L&&(Ci(),yt(17)),Tn(this),this.o=2,Us(this)):el(this,this.Y-n)};var nl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function hr(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof hr){this.h=n.h,Bs(this,n.j),this.s=n.s,this.g=n.g,dr(this,n.m),this.l=n.l;var e=n.i,t=new fr;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),rl(this,t),this.o=n.o}else n&&(e=String(n).match(nl))?(this.h=!1,Bs(this,e[1]||"",!0),this.s=ft(e[2]||""),this.g=ft(e[3]||"",!0),dr(this,e[4]),this.l=ft(e[5]||"",!0),rl(this,e[6]||"",!0),this.o=ft(e[7]||"")):(this.h=!1,this.i=new fr(null,this.h))}function Rt(n){return new hr(n)}function Bs(n,e,t){n.j=t?ft(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function dr(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function rl(n,e,t){e instanceof fr?(n.i=e,function Aa(n,e){e&&!n.j&&(nn(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(Ws(this,r),Gs(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Br(e,sl)),n.i=new fr(e,n.h))}function xe(n,e,t){n.i.set(e,t)}function Ur(n){return xe(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function ft(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Br(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,zc),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function zc(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}hr.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Br(e,qs,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Br(e,qs,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Br(t,"/"==t.charAt(0)?il:zs,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Br(t,Wc)),n.join("")};var qs=/[#\/\?@]/g,zs=/[#\?:]/g,il=/[#\?]/g,sl=/[#\?@]/g,Wc=/#/g;function fr(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function nn(n){n.g||(n.g=new Map,n.h=0,n.i&&function qc(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Ws(n,e){nn(n),e=pr(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Mi(n,e){return nn(n),e=pr(n,e),n.g.has(e)}function Gs(n,e,t){Ws(n,e),0<t.length&&(n.i=null,n.g.set(pr(n,e),ir(t)),n.h+=t.length)}function pr(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function $s(n){this.l=n||Ks,n=X.PerformanceNavigationTiming?0<(n=X.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(X.g&&X.g.Ka&&X.g.Ka()&&X.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(z=fr.prototype).add=function(n,e){nn(this),this.i=null,n=pr(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},z.forEach=function(n,e){nn(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},z.ta=function(){nn(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},z.Z=function(n){nn(this);let e=[];if("string"==typeof n)Mi(this,n)&&(e=e.concat(this.g.get(pr(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},z.set=function(n,e){return nn(this),this.i=null,Mi(this,n=pr(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},z.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},z.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};var Ks=10;function Zs(n){return!!n.h||!!n.g&&n.g.size>=n.j}function wa(n){return n.h?1:n.g?n.g.size:0}function Fi(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function js(n,e){n.g?n.g.add(e):n.h=e}function Hs(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function al(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return ir(n.i)}$s.prototype.cancel=function(){if(this.i=al(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var Ra=class{stringify(n){return X.JSON.stringify(n,void 0)}parse(n){return X.JSON.parse(n,void 0)}};function Gc(){this.g=new Ra}function Pa(n,e,t){const r=t||"";try{tl(n,function(i,s){let o=i;On(i)&&(o=pa(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function qr(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function mr(n){this.l=n.ec||null,this.j=n.ob||!1}function gr(n,e){nt.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Bi,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}De(mr,xi),mr.prototype.g=function(){return new gr(this.l,this.j)},mr.prototype.i=function(n){return function(){return n}}({}),De(gr,nt);var Bi=0;function Qs(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function qi(n){n.readyState=4,n.l=null,n.j=null,n.A=null,_r(n)}function _r(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(z=gr.prototype).open=function(n,e){if(this.readyState!=Bi)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,_r(this)},z.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||X).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},z.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,qi(this)),this.readyState=Bi},z.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,_r(this)),this.g&&(this.readyState=3,_r(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof X.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Qs(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},z.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?qi(this):_r(this),3==this.readyState&&Qs(this)}},z.Za=function(n){this.g&&(this.response=this.responseText=n,qi(this))},z.Ya=function(n){this.g&&(this.response=n,qi(this))},z.ka=function(){this.g&&qi(this)},z.setRequestHeader=function(n,e){this.v.append(n,e)},z.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},z.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(gr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var $c=X.JSON.parse;function Le(n){nt.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=ul,this.L=this.M=!1}De(Le,nt);var ul="",Sa=/^https?$/i,ll=["POST","PUT"];function cl(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Ys(n),zr(n)}function Ys(n){n.F||(n.F=!0,Ye(n,"complete"),Ye(n,"error"))}function hl(n){if(n.h&&typeof tr<"u"&&(!n.C[1]||4!=rn(n)||2!=n.da()))if(n.v&&4==rn(n))Ps(n.La,0,n);else if(Ye(n,"readystatechange"),4==rn(n)){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===o){var i=String(n.I).match(nl)[1]||null;!i&&X.self&&X.self.location&&(i=X.self.location.protocol.slice(0,-1)),r=!Sa.test(i?i.toLowerCase():"")}t=r}if(t)Ye(n,"complete"),Ye(n,"success");else{n.m=6;try{var s=2<rn(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Ys(n)}}finally{zr(n)}}}function zr(n,e){if(n.g){dl(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Ye(n,"ready");try{t.onreadystatechange=r}catch{}}}function dl(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(X.clearTimeout(n.A),n.A=null)}function rn(n){return n.g?n.g.readyState:0}function Js(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case ul:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function fl(n){let e="";return le(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function zi(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=fl(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):xe(n,e,t))}function Wi(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Xs(n){this.Ga=0,this.j=[],this.l=new bs,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Wi("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Wi("baseRetryDelayMs",5e3,n),this.hb=Wi("retryDelaySeedMs",1e4,n),this.eb=Wi("forwardChannelMaxRetries",2,n),this.xa=Wi("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new $s(n&&n.concurrentRequestLimit),this.Ja=new Gc,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function ba(n){if(pl(n),3==n.H){var e=n.W++,t=Rt(n.I);if(xe(t,"SID",n.K),xe(t,"RID",e),xe(t,"TYPE","terminate"),Gi(n,t),(e=new Ni(n,n.l,e)).L=2,e.v=Ur(Rt(t)),t=!1,X.navigator&&X.navigator.sendBeacon)try{t=X.navigator.sendBeacon(e.v.toString(),"")}catch{}!t&&X.Image&&((new Image).src=e.v,t=!0),t||(e.g=Il(e.l,null),e.g.ha(e.v)),e.G=Date.now(),Oi(e)}Da(n)}function Wr(n){n.g&&(xa(n),n.g.cancel(),n.g=null)}function pl(n){Wr(n),n.u&&(X.clearTimeout(n.u),n.u=null),Ki(n),n.i.cancel(),n.m&&("number"==typeof n.m&&X.clearTimeout(n.m),n.m=null)}function Gr(n){if(!Zs(n.i)&&!n.m){n.m=!0;var e=n.Na;Pi||Ku(),lr||(Pi(),lr=!0),ya.add(e,n),n.C=0}}function eo(n,e){var t;t=e?e.m:n.W++;const r=Rt(n.I);xe(r,"SID",n.K),xe(r,"RID",t),xe(r,"AID",n.V),Gi(n,r),n.o&&n.s&&zi(r,n.o,n.s),t=new Ni(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=to(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),js(n.i,t),ki(t,r,e)}function Gi(n,e){n.na&&le(n.na,function(t,r){xe(e,r,t)}),n.h&&tl({},function(t,r){xe(e,r,t)})}function to(n,e,t){t=Math.min(n.j.length,t);var r=n.h?Ke(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const o=["count="+t];-1==s?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let h=!0;for(let d=0;d<t;d++){let f=i[d].g;const m=i[d].map;if(f-=s,0>f)s=Math.max(0,i[d].g-100),h=!1;else try{Pa(m,o,"req"+f+"_")}catch{r&&r(m)}}if(h){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function ml(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;Pi||Ku(),lr||(Pi(),lr=!0),ya.add(e,n),n.A=0}}function $i(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=bi(Ke(n.Ma,n),_l(n,n.A)),n.A++,0))}function xa(n){null!=n.B&&(X.clearTimeout(n.B),n.B=null)}function gl(n){n.g=new Ni(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=Rt(n.wa);xe(e,"RID","rpc"),xe(e,"SID",n.K),xe(e,"AID",n.V),xe(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&xe(e,"TO",n.qa),xe(e,"TYPE","xmlhttp"),Gi(n,e),n.o&&n.s&&zi(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.v=Ur(Rt(e)),t.s=null,t.S=!0,Ju(t,n)}function Ki(n){null!=n.v&&(X.clearTimeout(n.v),n.v=null)}function no(n,e){var t=null;if(n.g==e){Ki(n),xa(n),n.g=null;var r=2}else{if(!Fi(n.i,e))return;t=e.F,Hs(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.G;var i=n.C;Ye(r=Ds(),new ks(r,t)),Gr(n)}else ml(n);else if(3==(i=e.o)||0==i&&0<e.ca||!(1==r&&function Zc(n,e){return!(wa(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=bi(Ke(n.Na,n,e),_l(n,n.C)),n.C++,0)))}(n,e)||2==r&&$i(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:zt(n,5);break;case 4:zt(n,10);break;case 3:zt(n,6);break;default:zt(n,2)}}function _l(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function zt(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=Ke(n.pb,n);t||(t=new hr("//www.google.com/images/cleardot.gif"),X.location&&"http"==X.location.protocol||Bs(t,"https"),Ur(t)),function Ui(n,e){const t=new bs;if(X.Image){const r=new Image;r.onload=Ln(qr,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Ln(qr,t,r,"TestLoadImage: error",!1,e),r.onabort=Ln(qr,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ln(qr,t,r,"TestLoadImage: timeout",!1,e),X.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else yt(2);n.H=0,n.h&&n.h.za(e),Da(n),pl(n)}function Da(n){if(n.H=0,n.ma=[],n.h){const e=al(n.i);(0!=e.length||0!=n.j.length)&&(sr(n.ma,e),sr(n.ma,n.j),n.i.i.length=0,ir(n.j),n.j.length=0),n.h.ya()}}function yl(n,e,t){var r=t instanceof hr?Rt(t):new hr(t);if(""!=r.g)e&&(r.g=e+"."+r.g),dr(r,r.m);else{var i=X.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new hr(null);r&&Bs(s,r),e&&(s.g=e),i&&dr(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&xe(r,t,e),xe(r,"VER",n.ra),Gi(n,r),r}function Il(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Le(t&&n.Ha&&!n.va?new mr({ob:!0}):n.va)).Oa(n.J),e}function vl(){}function ro(){if(vn&&!(10<=Number(q)))throw Error("Environmental error: no available transport.")}function Vt(n,e){nt.call(this),this.g=new Xs(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Be(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Be(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Zi(this)}function jc(n){Zt.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Hc(){Di.call(this),this.status=1}function Zi(n){this.g=n}function Ht(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Va(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],o=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;o=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=t+((o=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function Re(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(z=Le.prototype).Oa=function(n){this.M=n},z.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Ta.g(),this.C=function Yu(n){return n.h||(n.h=n.i())}(this.u?this.u:Ta),this.g.onreadystatechange=Ke(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void cl(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=X.FormData&&n instanceof X.FormData,!(0<=rr(ll,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{dl(this),0<this.B&&((this.L=function Ca(n){return vn&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ke(this.ua,this)):this.A=Ps(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){cl(this,s)}},z.ua=function(){typeof tr<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ye(this,"timeout"),this.abort(8))},z.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Ye(this,"complete"),Ye(this,"abort"),zr(this))},z.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),zr(this,!0)),Le.$.N.call(this)},z.La=function(){this.s||(this.G||this.v||this.l?hl(this):this.kb())},z.kb=function(){hl(this)},z.isActive=function(){return!!this.g},z.da=function(){try{return 2<rn(this)?this.g.status:-1}catch{return-1}},z.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},z.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),$c(e)}},z.Ia=function(){return this.m},z.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(z=Xs.prototype).ra=8,z.H=1,z.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new Ni(this,this.l,n);let s=this.s;if(this.U&&(s?(s=kr(s),ua(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=to(this,i,e),xe(t=Rt(this.I),"RID",n),xe(t,"CVER",22),this.F&&xe(t,"X-HTTP-Session-Id",this.F),Gi(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(fl(s)))+"&"+e:this.o&&zi(t,this.o,s)),js(this.i,i),this.bb&&xe(t,"TYPE","init"),this.P?(xe(t,"$req",e),xe(t,"SID","null"),i.aa=!0,ki(i,t,null)):ki(i,t,e),this.H=2}}else 3==this.H&&(n?eo(this,n):0==this.j.length||Zs(this.i)||eo(this))},z.Ma=function(){if(this.u=null,gl(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=bi(Ke(this.jb,this),n)}},z.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,yt(10),Wr(this),gl(this))},z.ib=function(){null!=this.v&&(this.v=null,Wr(this),$i(this),yt(19))},z.pb=function(n){n?(this.l.info("Successfully pinged google.com"),yt(2)):(this.l.info("Failed to ping google.com"),yt(1))},z.isActive=function(){return!!this.h&&this.h.isActive(this)},(z=vl.prototype).Ba=function(){},z.Aa=function(){},z.za=function(){},z.ya=function(){},z.isActive=function(){return!0},z.Va=function(){},ro.prototype.g=function(n,e){return new Vt(n,e)},De(Vt,nt),Vt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;yt(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=yl(n,null,n.Y),Gr(n)},Vt.prototype.close=function(){ba(this.g)},Vt.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=pa(n),n=t);e.j.push(new class{constructor(n,e){this.g=n,this.map=e}}(e.fb++,n)),3==e.H&&Gr(e)},Vt.prototype.N=function(){this.g.h=null,delete this.j,ba(this.g),delete this.g,Vt.$.N.call(this)},De(jc,Zt),De(Hc,Di),De(Zi,vl),Zi.prototype.Ba=function(){Ye(this.g,"a")},Zi.prototype.Aa=function(n){Ye(this.g,new jc(n))},Zi.prototype.za=function(n){Ye(this.g,new Hc)},Zi.prototype.ya=function(){Ye(this.g,"b")},De(Ht,function Na(){this.blockSize=-1}),Ht.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Ht.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)Va(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){Va(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){Va(this,r),i=0;break}}this.h=i,this.i+=e},Ht.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var Nf={};function El(n){return-128<=n&&128>n?function _t(n,e){var t=Nf;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new Re([0|e],0>e?-1:0)}):new Re([0|n],0>n?-1:0)}function An(n){if(isNaN(n)||!isFinite(n))return Bn;if(0>n)return ut(An(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=Tl;return new Re(e,0)}var Tl=4294967296,Bn=El(0),wn=El(1),io=El(16777216);function Rn(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function Wt(n){return-1==n.h}function ut(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new Re(t,~n.h).add(wn)}function ka(n,e){return n.add(ut(e))}function so(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function ji(n,e){this.g=n,this.h=e}function $r(n,e){if(Rn(e))throw Error("division by zero");if(Rn(n))return new ji(Bn,Bn);if(Wt(n))return e=$r(ut(n),e),new ji(ut(e.g),ut(e.h));if(Wt(e))return e=$r(n,ut(e)),new ji(ut(e.g),e.h);if(30<n.g.length){if(Wt(n)||Wt(e))throw Error("slowDivide_ only works with positive integers.");for(var t=wn,r=e;0>=r.X(n);)t=oo(t),r=oo(r);var i=Kr(t,1),s=Kr(r,1);for(r=Kr(r,2),t=Kr(t,2);!Rn(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=Kr(r,1),t=Kr(t,1)}return e=ka(n,i.R(e)),new ji(i,e)}for(i=Bn;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),o=(s=An(t)).R(e);Wt(o)||0<o.X(n);)o=(s=An(t-=r)).R(e);Rn(s)&&(s=wn),i=i.add(s),n=ka(n,o)}return new ji(i,n)}function oo(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new Re(t,n.h)}function Kr(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new Re(i,n.h)}(z=Re.prototype).ea=function(){if(Wt(this))return-ut(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:Tl+r)*e,e*=Tl}return n},z.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(Rn(this))return"0";if(Wt(this))return"-"+ut(this).toString(n);for(var e=An(Math.pow(n,6)),t=this,r="";;){var i=$r(t,e).g,s=((0<(t=ka(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(Rn(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},z.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},z.X=function(n){return Wt(n=ka(this,n))?-1:Rn(n)?0:1},z.abs=function(){return Wt(this)?ut(this):this},z.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,t[i]=(o&=65535)<<16|(s&=65535)}return new Re(t,-2147483648&t[t.length-1]?-1:0)},z.R=function(n){if(Rn(this)||Rn(n))return Bn;if(Wt(this))return Wt(n)?ut(this).R(ut(n)):ut(ut(this).R(n));if(Wt(n))return ut(this.R(ut(n)));if(0>this.X(io)&&0>n.X(io))return An(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),h=n.D(i)>>>16,d=65535&n.D(i);t[2*r+2*i]+=o*d,so(t,2*r+2*i),t[2*r+2*i+1]+=s*d,so(t,2*r+2*i+1),t[2*r+2*i+1]+=o*h,so(t,2*r+2*i+1),t[2*r+2*i+2]+=s*h,so(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new Re(t,0)},z.gb=function(n){return $r(this,n).h},z.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new Re(t,this.h&n.h)},z.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new Re(t,this.h|n.h)},z.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new Re(t,this.h^n.h)},ro.prototype.createWebChannel=ro.prototype.g,Vt.prototype.send=Vt.prototype.u,Vt.prototype.open=Vt.prototype.m,Vt.prototype.close=Vt.prototype.close,Mr.NO_ERROR=0,Mr.TIMEOUT=8,Mr.HTTP_ERROR=6,Qu.COMPLETE="complete",Os.EventType=En,En.OPEN="a",En.CLOSE="b",En.ERROR="c",En.MESSAGE="d",nt.prototype.listen=nt.prototype.O,Le.prototype.listenOnce=Le.prototype.P,Le.prototype.getLastError=Le.prototype.Sa,Le.prototype.getLastErrorCode=Le.prototype.Ia,Le.prototype.getStatus=Le.prototype.da,Le.prototype.getResponseJson=Le.prototype.Wa,Le.prototype.getResponseText=Le.prototype.ja,Le.prototype.send=Le.prototype.ha,Le.prototype.setWithCredentials=Le.prototype.Oa,Ht.prototype.digest=Ht.prototype.l,Ht.prototype.reset=Ht.prototype.reset,Ht.prototype.update=Ht.prototype.j,Re.prototype.add=Re.prototype.add,Re.prototype.multiply=Re.prototype.R,Re.prototype.modulo=Re.prototype.gb,Re.prototype.compare=Re.prototype.X,Re.prototype.toNumber=Re.prototype.ea,Re.prototype.toString=Re.prototype.toString,Re.prototype.getBits=Re.prototype.D,Re.fromNumber=An,Re.fromString=function Qc(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return ut(Qc(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=An(Math.pow(e,8)),r=Bn,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=An(Math.pow(e,s)),r=r.R(s).add(An(o))):r=(r=r.R(t)).add(An(o))}return r};var ao=ht.createWebChannelTransport=function(){return new ro},Al=ht.getStatEventTarget=function(){return Ds()},Oa=ht.ErrorCode=Mr,Yc=ht.EventType=Qu,Jc=ht.Event=tn,Xc=ht.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},wl=ht.FetchXmlHttpFactory=mr,La=ht.WebChannel=Os,Ma=ht.XhrIo=Le,eh=ht.Md5=Ht,Zr=ht.Integer=Re;const jr="@firebase/firestore";class rt{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}rt.UNAUTHENTICATED=new rt(null),rt.GOOGLE_CREDENTIALS=new rt("google-credentials-uid"),rt.FIRST_PARTY=new rt("first-party-uid"),rt.MOCK_USER=new rt("mock-user");let Ve="10.5.2";const qn=new ae.Yd("@firebase/firestore");function zn(){return qn.logLevel}function V(n,...e){if(qn.logLevel<=ae.in.DEBUG){const t=e.map(uo);qn.debug(`Firestore (${Ve}): ${n}`,...t)}}function We(n,...e){if(qn.logLevel<=ae.in.ERROR){const t=e.map(uo);qn.error(`Firestore (${Ve}): ${n}`,...t)}}function Pt(n,...e){if(qn.logLevel<=ae.in.WARN){const t=e.map(uo);qn.warn(`Firestore (${Ve}): ${n}`,...t)}}function uo(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function G(n="Unexpected state"){const e=`FIRESTORE (${Ve}) INTERNAL ASSERTION FAILED: `+n;throw We(e),new Error(e)}function K(n,e){n||G()}function B(n,e){return n}const C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class N extends Ie.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ge{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Fa{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ua{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(rt.UNAUTHENTICATED))}shutdown(){}}class nh{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Ba{constructor(e){this.t=e,this.currentUser=rt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=f=>this.i!==i?(i=this.i,t(f)):Promise.resolve();let o=new Ge;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Ge,e.enqueueRetryable(()=>s(this.currentUser))};const h=()=>{const f=o;e.enqueueRetryable((0,g.Z)(function*(){yield f.promise,yield s(r.currentUser)}))},d=f=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.auth.addAuthTokenListener(this.o),h()};this.t.onInit(f=>d(f)),setTimeout(()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?d(f):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Ge)}},0),h()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(K("string"==typeof r.accessToken),new Fa(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return K(null===e||"string"==typeof e),new rt(e)}}class Pl{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=rt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class rh{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Pl(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(rt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Sl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Vf{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{null!=s.error&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,V("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(K("string"==typeof t.token),this.R=t.token,new Sl(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function sh(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Cl{static newId(){const t=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=sh(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function ee(n,e){return n<e?-1:n>e?1:0}function Hr(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function bl(n){return n+"\0"}class Pe{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new N(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new N(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new N(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new N(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Pe.fromMillis(Date.now())}static fromDate(e){return Pe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Pe(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ee(this.nanoseconds,e.nanoseconds):ee(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class j{constructor(e){this.timestamp=e}static fromTimestamp(e){return new j(e)}static min(){return new j(new Pe(0,0))}static max(){return new j(new Pe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Hi{constructor(e,t,r){void 0===t?t=0:t>e.length&&G(),void 0===r?r=e.length-t:r>e.length-t&&G(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Hi.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Hi?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class me extends Hi{construct(e,t,r){return new me(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new N(C.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new me(t)}static emptyPath(){return new me([])}}const qa=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ke extends Hi{construct(e,t,r){return new ke(e,t,r)}static isValidIdentifier(e){return qa.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ke.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ke(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new N(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const h=e[i];if("\\"===h){if(i+1===e.length)throw new N(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[i+1];if("\\"!==d&&"."!==d&&"`"!==d)throw new N(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,i+=2}else"`"===h?(o=!o,i++):"."!==h||o?(r+=h,i++):(s(),i++)}if(s(),o)throw new N(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ke(t)}static emptyPath(){return new ke([])}}class W{constructor(e){this.path=e}static fromPath(e){return new W(me.fromString(e))}static fromName(e){return new W(me.fromString(e).popFirst(5))}static empty(){return new W(me.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===me.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return me.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new W(new me(e.slice()))}}class Qr{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function za(n){return n.fields.find(e=>2===e.kind)}function yr(n){return n.fields.filter(e=>2!==e.kind)}Qr.UNKNOWN_ID=-1;class Ir{constructor(e,t){this.fieldPath=e,this.kind=t}}class Yr{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Yr(0,It.min())}}function lo(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=j.fromTimestamp(1e9===r?new Pe(t+1,0):new Pe(t,r));return new It(i,W.empty(),e)}function Dl(n){return new It(n.readTime,n.key,-1)}class It{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new It(j.min(),W.empty(),-1)}static max(){return new It(j.max(),W.empty(),-1)}}function Wa(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=W.comparator(n.documentKey,e.documentKey),0!==t?t:ee(n.largestBatchId,e.largestBatchId))}const co="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Nl{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function sn(n){return Jr.apply(this,arguments)}function Jr(){return Jr=(0,g.Z)(function*(n){if(n.code!==C.FAILED_PRECONDITION||n.message!==co)throw n;V("LocalStore","Unexpectedly lost primary lease")}),Jr.apply(this,arguments)}class w{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&G(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new w((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof w?t:w.resolve(t)}catch(t){return w.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):w.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):w.reject(t)}static resolve(e){return new w((t,r)=>{t(e)})}static reject(e){return new w((t,r)=>{r(e)})}static waitFor(e){return new w((t,r)=>{let i=0,s=0,o=!1;e.forEach(h=>{++i,h.next(()=>{++s,o&&s===i&&t()},d=>r(d))}),o=!0,s===i&&t()})}static or(e){let t=w.resolve(!1);for(const r of e)t=t.next(i=>i?w.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new w((r,i)=>{const s=e.length,o=new Array(s);let h=0;for(let d=0;d<s;d++){const f=d;t(e[f]).next(m=>{o[f]=m,++h,h===s&&r(o)},m=>i(m))}})}static doWhile(e,t){return new w((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class ho{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Ge,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Qt(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=Qi(r.target.error);this.V.reject(new Qt(e,i))}}static open(e,t,r,i){try{return new ho(t,e.transaction(i,r))}catch(s){throw new Qt(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(V("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new uh(t)}}class kt{constructor(e,t,r){this.name=e,this.version=t,this.p=r,12.2===kt.S((0,Ie.z$)())&&We("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return V("SimpleDb","Removing database:",e),vr(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,Ie.hl)())return!1;if(kt.C())return!0;const e=(0,Ie.z$)(),t=kt.S(e),r=0<t&&t<10,i=kt.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(e){var t=this;return(0,g.Z)(function*(){return t.db||(V("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=o=>{r(o.target.result)},s.onblocked=()=>{i(new Qt(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=o=>{const h=o.target.error;i("VersionError"===h.name?new N(C.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===h.name?new N(C.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+h):new Qt(e,h))},s.onupgradeneeded=o=>{V("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.p.N(o.target.result,s.transaction,o.oldVersion,t.version).next(()=>{V("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=r=>t.B(r)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,g.Z)(function*(){const o="readonly"===t;let h=0;for(;;){++h;try{s.db=yield s.O(e);const d=ho.open(s.db,e,o?"readonly":"readwrite",r),f=i(d).next(m=>(d.g(),m)).catch(m=>(d.abort(m),w.reject(m))).toPromise();return f.catch(()=>{}),yield d.m,f}catch(d){const f=d,m="FirebaseError"!==f.name&&h<3;if(V("SimpleDb","Transaction failed with error:",f.message,"Retrying:",m),s.close(),!m)return Promise.reject(f)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class ah{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return vr(this.k.delete())}}class Qt extends N{constructor(e,t){super(C.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function on(n){return"IndexedDbTransactionError"===n.name}class uh{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(V("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(V("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),vr(r)}add(e){return V("SimpleDb","ADD",this.store.name,e,e),vr(this.store.add(e))}get(e){return vr(this.store.get(e)).next(t=>(void 0===t&&(t=null),V("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return V("SimpleDb","DELETE",this.store.name,e),vr(this.store.delete(e))}count(){return V("SimpleDb","COUNT",this.store.name),vr(this.store.count())}W(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const i=this.cursor(r),s=[];return this.G(i,(o,h)=>{s.push(h)}).next(()=>s)}{const i=this.store.getAll(r.range);return new w((s,o)=>{i.onerror=h=>{o(h.target.error)},i.onsuccess=h=>{s(h.target.result)}})}}j(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new w((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(e,t){V("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.J=!1;const i=this.cursor(r);return this.G(i,(s,o,h)=>h.delete())}Y(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.G(i,t)}Z(e){const t=this.cursor({});return new w((r,i)=>{t.onerror=s=>{const o=Qi(s.target.error);i(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(h=>{h?o.continue():r()}):r()}})}G(e,t){const r=[];return new w((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const h=o.target.result;if(!h)return void i();const d=new ah(h),f=t(h.primaryKey,h.value,d);if(f instanceof w){const m=f.catch(y=>(d.done(),w.reject(y)));r.push(m)}d.isDone?i():null===d.$?h.continue():h.continue(d.$)}}).next(()=>w.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function vr(n){return new w((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=Qi(r.target.error);t(i)}})}let Vl=!1;function Qi(n){const e=kt.S((0,Ie.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new N("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Vl||(Vl=!0,setTimeout(()=>{throw r},0)),r}}return n}class kl{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ee(e){var t=this;V("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,g.Z)(function*(){t.task=null;try{V("IndexBackiller",`Documents written: ${yield t.X.te()}`)}catch(r){on(r)?V("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield sn(r)}yield t.ee(6e4)}))}}class lh{constructor(e,t){this.localStore=e,this.persistence=t}te(e=50){var t=this;return(0,g.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.ne(r,e))})()}ne(e,t){const r=new Set;let i=t,s=!0;return w.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!r.has(o))return V("IndexBackiller",`Processing collection: ${o}`),this.re(e,o,i).next(h=>{i-=h,r.add(o)});s=!1})).next(()=>t-i)}re(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ie(i,s)).next(h=>(V("IndexBackiller",`Updating offset: ${h}`),this.localStore.indexManager.updateCollectionGroup(e,t,h))).next(()=>o.size)}))}ie(e,t){let r=e;return t.changes.forEach((i,s)=>{const o=Dl(s);Wa(o,r)>0&&(r=o)}),new It(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Ot=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}return n._e=-1,n})();function Er(n){return null==n}function Yi(n){return 0===n&&1/n==-1/0}function fo(n){return"number"==typeof n&&Number.isInteger(n)&&!Yi(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function pt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=po(e)),e=Ga(n.get(t),e);return po(e)}function Ga(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function po(n){return n+"\x01\x01"}function an(n){const e=n.length;if(K(e>=2),2===e)return K("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),me.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const o=n.indexOf("\x01",s);switch((o<0||o>t)&&G(),n.charAt(o+1)){case"\x01":const h=n.substring(s,o);let d;0===i.length?d=h:(i+=h,d=i,i=""),r.push(d);break;case"\x10":i+=n.substring(s,o),i+="\0";break;case"\x11":i+=n.substring(s,o+1);break;default:G()}s=o+2}return new me(r)}const Xr=["userId","batchId"];function mo(n,e){return[n,pt(e)]}function Ol(n,e,t){return[n,pt(e),t]}const $a={},Ka=["prefixPath","collectionGroup","readTime","documentId"],Za=["prefixPath","collectionGroup","documentId"],ch=["collectionGroup","readTime","prefixPath","documentId"],Ll=["canonicalId","targetId"],Ml=["targetId","path"],Fl=["path","targetId"],hh=["collectionId","parent"],dh=["indexId","uid"],ja=["uid","sequenceNumber"],fh=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ph=["indexId","uid","orderedDocumentKey"],Ha=["userId","collectionPath","documentId"],mh=["userId","collectionPath","largestBatchId"],gh=["userId","collectionGroup","largestBatchId"],go=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],_h=[...go,"documentOverlays"],_o=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],yo=_o,Qa=[...yo,"indexConfiguration","indexState","indexEntries"];class Io extends Nl{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}}function Ze(n,e){const t=B(n);return kt.M(t.ae,e)}function Ul(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Pn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Ya(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class Se{constructor(e,t){this.comparator=e,this.root=t||it.EMPTY}insert(e,t){return new Se(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,it.BLACK,null,null))}remove(e){return new Se(this.comparator,this.root.remove(e,this.comparator).copy(null,null,it.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new vo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new vo(this.root,e,this.comparator,!1)}getReverseIterator(){return new vo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new vo(this.root,e,this.comparator,!0)}}class vo{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class it{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??it.RED,this.left=i??it.EMPTY,this.right=s??it.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new it(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return it.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return it.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,it.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,it.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw G();const e=this.left.check();if(e!==this.right.check())throw G();return e+(this.isRed()?0:1)}}it.EMPTY=null,it.RED=!0,it.BLACK=!1,it.EMPTY=new class{constructor(){this.size=0}get key(){throw G()}get value(){throw G()}get color(){throw G()}get left(){throw G()}get right(){throw G()}copy(e,t,r,i,s){return this}insert(e,t,r){return new it(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ve{constructor(e){this.comparator=e,this.data=new Se(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Bl(this.data.getIterator())}getIteratorFrom(e){return new Bl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof ve)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ve(this.comparator);return t.data=e,t}}class Bl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ei(n){return n.hasNext()?n.getNext():void 0}class St{constructor(e){this.fields=e,e.sort(ke.comparator)}static empty(){return new St([])}unionWith(e){let t=new ve(ke.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new St(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Hr(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class Eo extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Je{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Eo("Invalid base64 string: "+s):s}}(e);return new Je(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new Je(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ee(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Je.EMPTY_BYTE_STRING=new Je("");const ql=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Wn(n){if(K(!!n),"string"==typeof n){let e=0;const t=ql.exec(n);if(K(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Oe(n.seconds),nanos:Oe(n.nanos)}}function Oe(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Sn(n){return"string"==typeof n?Je.fromBase64String(n):Je.fromUint8Array(n)}function To(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ao(n){const e=n.mapValue.fields.__previous_value__;return To(e)?Ao(e):e}function Ji(n){const e=Wn(n.mapValue.fields.__local_write_time__.timestampValue);return new Pe(e.seconds,e.nanos)}class Ih{constructor(e,t,r,i,s,o,h,d,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=h,this.longPollingOptions=d,this.useFetchStreams=f}}class Gn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Gn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Gn&&e.projectId===this.projectId&&e.database===this.database}}const $n={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},wo={nullValue:"NULL_VALUE"};function un(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?To(n)?4:Co(n)?9007199254740991:10:G()}function ln(n,e){if(n===e)return!0;const t=un(n);if(t!==un(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ji(n).isEqual(Ji(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=Wn(i.timestampValue),h=Wn(s.timestampValue);return o.seconds===h.seconds&&o.nanos===h.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,Sn(n.bytesValue).isEqual(Sn(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return Oe(i.geoPointValue.latitude)===Oe(s.geoPointValue.latitude)&&Oe(i.geoPointValue.longitude)===Oe(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Oe(i.integerValue)===Oe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=Oe(i.doubleValue),h=Oe(s.doubleValue);return o===h?Yi(o)===Yi(h):isNaN(o)&&isNaN(h)}return!1}(n,e);case 9:return Hr(n.arrayValue.values||[],e.arrayValue.values||[],ln);case 10:return function(i,s){const o=i.mapValue.fields||{},h=s.mapValue.fields||{};if(Ul(o)!==Ul(h))return!1;for(const d in o)if(o.hasOwnProperty(d)&&(void 0===h[d]||!ln(o[d],h[d])))return!1;return!0}(n,e);default:return G()}var s}function Xi(n,e){return void 0!==(n.values||[]).find(t=>ln(t,e))}function Kn(n,e){if(n===e)return 0;const t=un(n),r=un(e);if(t!==r)return ee(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ee(n.booleanValue,e.booleanValue);case 2:return function(s,o){const h=Oe(s.integerValue||s.doubleValue),d=Oe(o.integerValue||o.doubleValue);return h<d?-1:h>d?1:h===d?0:isNaN(h)?isNaN(d)?0:-1:1}(n,e);case 3:return zl(n.timestampValue,e.timestampValue);case 4:return zl(Ji(n),Ji(e));case 5:return ee(n.stringValue,e.stringValue);case 6:return function(s,o){const h=Sn(s),d=Sn(o);return h.compareTo(d)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const h=s.split("/"),d=o.split("/");for(let f=0;f<h.length&&f<d.length;f++){const m=ee(h[f],d[f]);if(0!==m)return m}return ee(h.length,d.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const h=ee(Oe(s.latitude),Oe(o.latitude));return 0!==h?h:ee(Oe(s.longitude),Oe(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){const h=s.values||[],d=o.values||[];for(let f=0;f<h.length&&f<d.length;++f){const m=Kn(h[f],d[f]);if(m)return m}return ee(h.length,d.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===$n.mapValue&&o===$n.mapValue)return 0;if(s===$n.mapValue)return 1;if(o===$n.mapValue)return-1;const h=s.fields||{},d=Object.keys(h),f=o.fields||{},m=Object.keys(f);d.sort(),m.sort();for(let y=0;y<d.length&&y<m.length;++y){const I=ee(d[y],m[y]);if(0!==I)return I;const P=Kn(h[d[y]],f[m[y]]);if(0!==P)return P}return ee(d.length,m.length)}(n.mapValue,e.mapValue);default:throw G()}}function zl(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return ee(n,e);const t=Wn(n),r=Wn(e),i=ee(t.seconds,r.seconds);return 0!==i?i:ee(t.nanos,r.nanos)}function ti(n){return Ro(n)}function Ro(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Wn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Sn(n.bytesValue).toBase64():"referenceValue"in n?W.fromName(n.referenceValue).toString():"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=Ro(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${Ro(t.fields[o])}`;return i+"}"}(n.mapValue):G()}function Tr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ja(n){return!!n&&"integerValue"in n}function es(n){return!!n&&"arrayValue"in n}function Wl(n){return!!n&&"nullValue"in n}function So(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ni(n){return!!n&&"mapValue"in n}function ts(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Pn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ts(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ts(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Co(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function vh(n){return"nullValue"in n?wo:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Tr(Gn.empty(),W.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:G()}function Gl(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Tr(Gn.empty(),W.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?$n:G()}function $l(n,e){const t=Kn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function bo(n,e){const t=Kn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class lt{constructor(e){this.value=e}static empty(){return new lt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ni(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ts(t)}setAll(e){let t=ke.emptyPath(),r={},i=[];e.forEach((o,h)=>{if(!t.isImmediateParentOf(h)){const d=this.getFieldsMap(t);this.applyChanges(d,r,i),r={},i=[],t=h.popLast()}o?r[h.lastSegment()]=ts(o):i.push(h.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());ni(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ln(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];ni(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Pn(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new lt(ts(this.value))}}function Eh(n){const e=[];return Pn(n.fields,(t,r)=>{const i=new ke([t]);if(ni(r)){const s=Eh(r.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new St(e)}class Ce{constructor(e,t,r,i,s,o,h){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=h}static newInvalidDocument(e){return new Ce(e,0,j.min(),j.min(),j.min(),lt.empty(),0)}static newFoundDocument(e,t,r,i){return new Ce(e,1,t,j.min(),r,i,0)}static newNoDocument(e,t){return new Ce(e,2,t,j.min(),j.min(),lt.empty(),0)}static newUnknownDocument(e,t){return new Ce(e,3,t,j.min(),j.min(),lt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(j.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=lt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=lt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ce&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ce(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Cn{constructor(e,t){this.position=e,this.inclusive=t}}function ns(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(r=s.field.isKeyField()?W.comparator(W.fromName(o.referenceValue),t.key):Kn(o,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Xa(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ln(n.position[t],e.position[t]))return!1;return!0}class ri{constructor(e,t="asc"){this.field=e,this.dir=t}}function Th(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Kl{}class ce extends Kl{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new p(e,t,r):"array-contains"===t?new k(e,r):"in"===t?new $(e,r):"not-in"===t?new Q(e,r):"array-contains-any"===t?new de(e,r):new ce(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new _(e,r):new T(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Kn(t,this.value)):null!==t&&un(this.value)===un(t)&&this.matchesComparison(Kn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return G()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Te extends Kl{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new Te(e,t)}matches(e){return ii(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function ii(n){return"and"===n.op}function xo(n){return"or"===n.op}function eu(n){return Zl(n)&&ii(n)}function Zl(n){for(const e of n.filters)if(e instanceof Te)return!1;return!0}function l(n){if(n instanceof ce)return n.field.canonicalString()+n.op.toString()+ti(n.value);if(eu(n))return n.filters.map(e=>l(e)).join(",");{const e=n.filters.map(t=>l(t)).join(",");return`${n.op}(${e})`}}function a(n,e){return n instanceof ce?(r=n,(i=e)instanceof ce&&r.op===i.op&&r.field.isEqual(i.field)&&ln(r.value,i.value)):n instanceof Te?function(r,i){return i instanceof Te&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,o,h)=>s&&a(o,i.filters[h]),!0)}(n,e):void G();var r,i}function u(n,e){const t=n.filters.concat(e);return Te.create(t,n.op)}function c(n){return n instanceof ce?`${(t=n).field.canonicalString()} ${t.op} ${ti(t.value)}`:n instanceof Te?function(t){return t.op.toString()+" {"+t.getFilters().map(c).join(" ,")+"}"}(n):"Filter";var t}class p extends ce{constructor(e,t,r){super(e,t,r),this.key=W.fromName(r.referenceValue)}matches(e){const t=W.comparator(e.key,this.key);return this.matchesComparison(t)}}class _ extends ce{constructor(e,t){super(e,"in",t),this.keys=b(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class T extends ce{constructor(e,t){super(e,"not-in",t),this.keys=b(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function b(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>W.fromName(r.referenceValue))}class k extends ce{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return es(t)&&Xi(t.arrayValue,this.value)}}class $ extends ce{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Xi(this.value.arrayValue,t)}}class Q extends ce{constructor(e,t){super(e,"not-in",t)}matches(e){if(Xi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Xi(this.value.arrayValue,t)}}class de extends ce{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!es(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Xi(this.value.arrayValue,r))}}class Ct{constructor(e,t=null,r=[],i=[],s=null,o=null,h=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=h,this.ce=null}}function cn(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Ct(n,e,t,r,i,s,o)}function hn(n){const e=B(n);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>l(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),Er(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>ti(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>ti(r)).join(",")),e.ce=t}return e.ce}function si(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Th(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!a(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Xa(n.startAt,e.startAt)&&Xa(n.endAt,e.endAt)}function oi(n){return W.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function rs(n,e){return n.filters.filter(t=>t instanceof ce&&t.field.isEqual(e))}function tu(n,e,t){let r=wo,i=!0;for(const s of rs(n,e)){let o=wo,h=!0;switch(s.op){case"<":case"<=":o=vh(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,h=!1;break;case"!=":case"not-in":o=wo}$l({value:r,inclusive:i},{value:o,inclusive:h})<0&&(r=o,i=h)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];$l({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}function Do(n,e,t){let r=$n,i=!0;for(const s of rs(n,e)){let o=$n,h=!0;switch(s.op){case">=":case">":o=Gl(s.value),h=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,h=!1;break;case"!=":case"not-in":o=$n}bo({value:r,inclusive:i},{value:o,inclusive:h})>0&&(r=o,i=h)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];bo({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}class dn{constructor(e,t=null,r=[],i=[],s=null,o="F",h=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=h,this.endAt=d,this.le=null,this.he=null,this.Pe=null}}function nu(n,e,t,r,i,s,o,h){return new dn(n,e,t,r,i,s,o,h)}function Zn(n){return new dn(n)}function ru(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function iu(n){return null!==n.collectionGroup}function jn(n){const e=B(n);if(null===e.le){e.le=[];const t=new Set;for(const s of e.explicitOrderBy)e.le.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let h=new ve(ke.comparator);return o.filters.forEach(d=>{d.getFlattenedFilters().forEach(f=>{f.isInequality()&&(h=h.add(f.field))})}),h})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.le.push(new ri(s,r))}),t.has(ke.keyField().canonicalString())||e.le.push(new ri(ke.keyField(),r))}return e.le}function vt(n){const e=B(n);return e.he||(e.he=function kf(n,e){if("F"===n.limitType)return cn(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>new ri(i.field,"desc"===i.dir?"asc":"desc"));const t=n.endAt?new Cn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Cn(n.startAt.position,n.startAt.inclusive):null;return cn(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}(e,jn(n))),e.he}function Ah(n,e){const t=n.filters.concat([e]);return new dn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function jl(n,e,t){return new dn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function su(n,e){return si(vt(n),vt(e))&&n.limitType===e.limitType}function Of(n){return`${hn(vt(n))}|lt:${n.limitType}`}function No(n){return`Query(target=${function(t){let r=t.path.canonicalString();return null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>c(i)).join(", ")}]`),Er(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>ti(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>ti(i)).join(",")),`Target(${r})`}(vt(n))}; limitType=${n.limitType})`}function ou(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):W.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of jn(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&(i=e,!((r=n).startAt&&!function(o,h,d){const f=ns(o,h,d);return o.inclusive?f<=0:f<0}(r.startAt,jn(r),i)||r.endAt&&!function(o,h,d){const f=ns(o,h,d);return o.inclusive?f>=0:f>0}(r.endAt,jn(r),i)));var r,i}function Lf(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Mf(n){return(e,t)=>{let r=!1;for(const i of jn(n)){const s=kg(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function kg(n,e,t){const r=n.field.isKeyField()?W.comparator(e.key,t.key):function(s,o,h){const d=o.data.field(s),f=h.data.field(s);return null!==d&&null!==f?Kn(d,f):G()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return G()}}class Ar{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Pn(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return Ya(this.inner)}size(){return this.innerSize}}const Og=new Se(W.comparator);function Gt(){return Og}const Ff=new Se(W.comparator);function au(...n){let e=Ff;for(const t of n)e=e.insert(t.key,t);return e}function Uf(n){let e=Ff;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Hn(){return uu()}function Bf(){return uu()}function uu(){return new Ar(n=>n.toString(),(n,e)=>n.isEqual(e))}const Lg=new Se(W.comparator),Mg=new ve(W.comparator);function ie(...n){let e=Mg;for(const t of n)e=e.add(t);return e}const Fg=new ve(ee);function wh(){return Fg}function qf(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Yi(e)?"-0":e}}function zf(n){return{integerValue:""+n}}function Wf(n,e){return fo(e)?zf(e):qf(n,e)}class Hl{constructor(){this._=void 0}}function Ug(n,e,t){return n instanceof Vo?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&To(s)&&(s=Ao(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof is?$f(n,e):n instanceof ss?Kf(n,e):function(i,s){const o=Gf(i,s),h=Zf(o)+Zf(i.Ie);return Ja(o)&&Ja(i.Ie)?zf(h):qf(i.serializer,h)}(n,e)}function Bg(n,e,t){return n instanceof is?$f(n,e):n instanceof ss?Kf(n,e):t}function Gf(n,e){return n instanceof ko?Ja(r=e)||(s=r)&&"doubleValue"in s?e:{integerValue:0}:null;var r,s}class Vo extends Hl{}class is extends Hl{constructor(e){super(),this.elements=e}}function $f(n,e){const t=jf(e);for(const r of n.elements)t.some(i=>ln(i,r))||t.push(r);return{arrayValue:{values:t}}}class ss extends Hl{constructor(e){super(),this.elements=e}}function Kf(n,e){let t=jf(e);for(const r of n.elements)t=t.filter(i=>!ln(i,r));return{arrayValue:{values:t}}}class ko extends Hl{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function Zf(n){return Oe(n.integerValue||n.doubleValue)}function jf(n){return es(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class lu{constructor(e,t){this.field=e,this.transform=t}}class zg{constructor(e,t){this.version=e,this.transformResults=t}}class qe{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new qe}static exists(e){return new qe(void 0,e)}static updateTime(e){return new qe(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ql(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class Yl{}function Hf(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new Lo(n.key,qe.none()):new Oo(n.key,n.data,qe.none());{const t=n.data,r=lt.empty();let i=new ve(ke.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?r.delete(s):r.set(s,o),i=i.add(s)}return new wr(n.key,r,new St(i.toArray()),qe.none())}}function Wg(n,e,t){n instanceof Oo?function(i,s,o){const h=i.value.clone(),d=Jf(i.fieldTransforms,s,o.transformResults);h.setAll(d),s.convertToFoundDocument(o.version,h).setHasCommittedMutations()}(n,e,t):n instanceof wr?function(i,s,o){if(!Ql(i.precondition,s))return void s.convertToUnknownDocument(o.version);const h=Jf(i.fieldTransforms,s,o.transformResults),d=s.data;d.setAll(Yf(i)),d.setAll(h),s.convertToFoundDocument(o.version,d).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function cu(n,e,t,r){return n instanceof Oo?function(s,o,h,d){if(!Ql(s.precondition,o))return h;const f=s.value.clone(),m=Xf(s.fieldTransforms,d,o);return f.setAll(m),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),null}(n,e,t,r):n instanceof wr?function(s,o,h,d){if(!Ql(s.precondition,o))return h;const f=Xf(s.fieldTransforms,d,o),m=o.data;return m.setAll(Yf(s)),m.setAll(f),o.convertToFoundDocument(o.version,m).setHasLocalMutations(),null===h?null:h.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(y=>y.field))}(n,e,t,r):(h=t,Ql(n.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):h);var o,h}function Gg(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=Gf(r.transform,i||null);null!=s&&(null===t&&(t=lt.empty()),t.set(r.field,s))}return t||null}function Qf(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&Hr(r,i,(s,o)=>function qg(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(r=n.transform)instanceof is&&i instanceof is||r instanceof ss&&i instanceof ss?Hr(r.elements,i.elements,ln):r instanceof ko&&i instanceof ko?ln(r.Ie,i.Ie):r instanceof Vo&&i instanceof Vo);var r,i}(s,o))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var r,i}class Oo extends Yl{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class wr extends Yl{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Yf(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Jf(n,e,t){const r=new Map;K(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,h=e.data.field(s.field);r.set(s.field,Bg(o,h,t[i]))}return r}function Xf(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,Ug(s,o,e))}return r}class Lo extends Yl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Rh extends Yl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ph{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Wg(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=cu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=cu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Bf();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let h=this.applyToLocalView(o,s.mutatedFields);h=t.has(i.key)?null:h;const d=Hf(o,h);null!==d&&r.set(i.key,d),o.isValidDocument()||o.convertToNoDocument(j.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ie())}isEqual(e){return this.batchId===e.batchId&&Hr(this.mutations,e.mutations,(t,r)=>Qf(t,r))&&Hr(this.baseMutations,e.baseMutations,(t,r)=>Qf(t,r))}}class Sh{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){K(e.mutations.length===r.length);let i=Lg;const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new Sh(e,t,r,i)}}class Ch{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Kg{constructor(e,t){this.count=e,this.unchangedNames=t}}var st,_e;function ep(n){switch(n){default:return G();case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0}}function tp(n){if(void 0===n)return We("GRPC error has no .code"),C.UNKNOWN;switch(n){case st.OK:return C.OK;case st.CANCELLED:return C.CANCELLED;case st.UNKNOWN:return C.UNKNOWN;case st.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case st.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case st.INTERNAL:return C.INTERNAL;case st.UNAVAILABLE:return C.UNAVAILABLE;case st.UNAUTHENTICATED:return C.UNAUTHENTICATED;case st.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case st.NOT_FOUND:return C.NOT_FOUND;case st.ALREADY_EXISTS:return C.ALREADY_EXISTS;case st.PERMISSION_DENIED:return C.PERMISSION_DENIED;case st.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case st.ABORTED:return C.ABORTED;case st.OUT_OF_RANGE:return C.OUT_OF_RANGE;case st.UNIMPLEMENTED:return C.UNIMPLEMENTED;case st.DATA_LOSS:return C.DATA_LOSS;default:return G()}}(_e=st||(st={}))[_e.OK=0]="OK",_e[_e.CANCELLED=1]="CANCELLED",_e[_e.UNKNOWN=2]="UNKNOWN",_e[_e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_e[_e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_e[_e.NOT_FOUND=5]="NOT_FOUND",_e[_e.ALREADY_EXISTS=6]="ALREADY_EXISTS",_e[_e.PERMISSION_DENIED=7]="PERMISSION_DENIED",_e[_e.UNAUTHENTICATED=16]="UNAUTHENTICATED",_e[_e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_e[_e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_e[_e.ABORTED=10]="ABORTED",_e[_e.OUT_OF_RANGE=11]="OUT_OF_RANGE",_e[_e.UNIMPLEMENTED=12]="UNIMPLEMENTED",_e[_e.INTERNAL=13]="INTERNAL",_e[_e.UNAVAILABLE=14]="UNAVAILABLE",_e[_e.DATA_LOSS=15]="DATA_LOSS";function np(){return new TextEncoder}const Zg=new Zr([4294967295,4294967295],0);function rp(n){const e=np().encode(n),t=new eh;return t.update(e),new Uint8Array(t.digest())}function ip(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Zr([t,r],0),new Zr([i,s],0)]}class bh{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new hu(`Invalid padding: ${t}`);if(r<0)throw new hu(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new hu(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new hu(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=Zr.fromNumber(this.Te)}de(e,t,r){let i=e.add(t.multiply(Zr.fromNumber(r)));return 1===i.compare(Zg)&&(i=new Zr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=rp(e),[r,i]=ip(t);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new bh(s,i,t);return r.forEach(h=>o.insert(h)),o}insert(e){if(0===this.Te)return;const t=rp(e),[r,i]=ip(t);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);this.Re(o)}}Re(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class hu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class du{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,fu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new du(j.min(),i,new Se(ee),Gt(),ie())}}class fu{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new fu(r,t,ie(),ie(),ie())}}class Xl{constructor(e,t,r,i){this.Ve=e,this.removedTargetIds=t,this.key=r,this.me=i}}class sp{constructor(e,t){this.targetId=e,this.fe=t}}class op{constructor(e,t,r=Je.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class ap{constructor(){this.ge=0,this.pe=lp(),this.ye=Je.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=ie(),t=ie(),r=ie();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:G()}}),new fu(this.ye,this.we,e,t,r)}Fe(){this.Se=!1,this.pe=lp()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1}Be(){this.Se=!0,this.we=!0}}class jg{constructor(e){this.Le=e,this.ke=new Map,this.qe=Gt(),this.Qe=up(),this.Ke=new Se(ee)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{const r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(t);break;case 3:this.je(t)&&(r.Be(),r.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.Ce(e.resumeToken));break;default:G()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((r,i)=>{this.je(i)&&t(i)})}Je(e){const t=e.targetId,r=e.fe.count,i=this.Ye(t);if(i){const s=i.target;if(oi(s))if(0===r){const o=new W(s.path);this.We(t,o,Ce.newNoDocument(o,j.min()))}else K(1===r);else{const o=this.Ze(t);if(o!==r){const h=this.Xe(e),d=h?this.et(h,e,o):1;0!==d&&(this.He(t),this.Ke=this.Ke.insert(t,2===d?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let o,h;try{o=Sn(r).toUint8Array()}catch(d){if(d instanceof Eo)return Pt("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{h=new bh(o,i,s)}catch(d){return Pt(d instanceof hu?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return 0===h.Te?null:h}et(e,t,r){return t.fe.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const o=this.Le.nt(),h=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(h)||(this.We(t,s,null),i++)}),i}it(e){const t=new Map;this.ke.forEach((s,o)=>{const h=this.Ye(o);if(h){if(s.current&&oi(h.target)){const d=new W(h.target.path);null!==this.qe.get(d)||this.st(o,d)||this.We(o,d,Ce.newNoDocument(d,e))}s.De&&(t.set(o,s.ve()),s.Fe())}});let r=ie();this.Qe.forEach((s,o)=>{let h=!0;o.forEachWhile(d=>{const f=this.Ye(d);return!f||"TargetPurposeLimboResolution"===f.purpose||(h=!1,!1)}),h&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(e));const i=new du(e,t,this.Ke,this.qe,r);return this.qe=Gt(),this.Qe=up(),this.Ke=new Se(ee),i}Ue(e,t){if(!this.je(e))return;const r=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,r),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,r){if(!this.je(e))return;const i=this.ze(e);this.st(e,t)?i.Me(t,1):i.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),r&&(this.qe=this.qe.insert(t,r))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new ap,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new ve(ee),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||V("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new ap),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function up(){return new Se(W.comparator)}function lp(){return new Se(W.comparator)}const Hg={asc:"ASCENDING",desc:"DESCENDING"},Qg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Yg={and:"AND",or:"OR"};class Jg{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function xh(n,e){return n.useProto3Json||Er(e)?e:{value:e}}function Mo(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function cp(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Xg(n,e){return Mo(n,e.toTimestamp())}function Xe(n){return K(!!n),j.fromTimestamp(function(t){const r=Wn(t);return new Pe(r.seconds,r.nanos)}(n))}function Dh(n,e){return(r=n,new me(["projects",r.projectId,"databases",r.database])).child("documents").child(e).canonicalString();var r}function hp(n){const e=me.fromString(n);return K(vp(e)),e}function pu(n,e){return Dh(n.databaseId,e.path)}function Qn(n,e){const t=hp(e);if(t.get(1)!==n.databaseId.projectId)throw new N(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new N(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new W(fp(t))}function Nh(n,e){return Dh(n.databaseId,e)}function dp(n){const e=hp(n);return 4===e.length?me.emptyPath():fp(e)}function mu(n){return new me(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function fp(n){return K(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function pp(n,e,t){return{name:pu(n,e),fields:t.value.mapValue.fields}}function mp(n,e,t){const r=Qn(n,e.name),i=Xe(e.updateTime),s=e.createTime?Xe(e.createTime):j.min(),o=new lt({mapValue:{fields:e.fields}}),h=Ce.newFoundDocument(r,i,s,o);return t&&h.setHasCommittedMutations(),t?h.setHasCommittedMutations():h}function gu(n,e){let t;if(e instanceof Oo)t={update:pp(n,e.key,e.value)};else if(e instanceof Lo)t={delete:pu(n,e.key)};else if(e instanceof wr)t={update:pp(n,e.key,e.data),updateMask:a_(e.fieldMask)};else{if(!(e instanceof Rh))return G();t={verify:pu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const h=o.transform;if(h instanceof Vo)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(h instanceof is)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:h.elements}};if(h instanceof ss)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:h.elements}};if(h instanceof ko)return{fieldPath:o.field.canonicalString(),increment:h.Ie};throw G()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:Xg(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:G()),t;var s}function Vh(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?qe.updateTime(Xe(s.updateTime)):void 0!==s.exists?qe.exists(s.exists):qe.none():qe.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,h){let d=null;"setToServerValue"in h?(K("REQUEST_TIME"===h.setToServerValue),d=new Vo):"appendMissingElements"in h?d=new is(h.appendMissingElements.values||[]):"removeAllFromArray"in h?d=new ss(h.removeAllFromArray.values||[]):"increment"in h?d=new ko(o,h.increment):G();const f=ke.fromServerFormat(h.fieldPath);return new lu(f,d)}(n,i)):[];var s;if(e.update){const i=Qn(n,e.update.name),s=new lt({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new St((e.updateMask.fieldPaths||[]).map(m=>ke.fromServerFormat(m)));return new wr(i,s,o,t,r)}return new Oo(i,s,t,r)}if(e.delete){const i=Qn(n,e.delete);return new Lo(i,t)}if(e.verify){const i=Qn(n,e.verify);return new Rh(i,t)}return G()}function gp(n,e){return{documents:[Nh(n,e.path)]}}function kh(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=Nh(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Nh(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(d){if(0!==d.length)return Ip(Te.create(d,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const s=function(d){if(0!==d.length)return d.map(f=>{return{field:ai((y=f).field),direction:i_(y.dir)};var y})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const o=xh(n,e.limit);return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(d=e.startAt).inclusive,values:d.position}),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),t;var d}function _p(n){let e=dp(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){K(1===r);const m=t.from[0];m.allDescendants?i=m.collectionId:e=e.child(m.collectionId)}let s=[];t.where&&(s=function(y){const I=yp(y);return I instanceof Te&&eu(I)?I.getFilters():[I]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(I=>{return new ri(Fo((O=I).field),function(M){switch(M){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(O.direction));var O}));let h=null;t.limit&&(h=function(y){let I;return I="object"==typeof y?y.value:y,Er(I)?null:I}(t.limit));let d=null;var y;t.startAt&&(d=new Cn((y=t.startAt).values||[],!!y.before));let f=null;return t.endAt&&(f=function(y){return new Cn(y.values||[],!y.before)}(t.endAt)),nu(e,i,o,s,h,"F",d,f)}function yp(n){return void 0!==n.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Fo(t.unaryFilter.field);return ce.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Fo(t.unaryFilter.field);return ce.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Fo(t.unaryFilter.field);return ce.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Fo(t.unaryFilter.field);return ce.create(o,"!=",{nullValue:"NULL_VALUE"});default:return G()}}(n):void 0!==n.fieldFilter?ce.create(Fo((t=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return G()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==n.compositeFilter?function(t){return Te.create(t.compositeFilter.filters.map(r=>yp(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return G()}}(t.compositeFilter.op))}(n):G();var t}function i_(n){return Hg[n]}function s_(n){return Qg[n]}function o_(n){return Yg[n]}function ai(n){return{fieldPath:n.canonicalString()}}function Fo(n){return ke.fromServerFormat(n.fieldPath)}function Ip(n){return n instanceof ce?function(t){if("=="===t.op){if(So(t.value))return{unaryFilter:{field:ai(t.field),op:"IS_NAN"}};if(Wl(t.value))return{unaryFilter:{field:ai(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(So(t.value))return{unaryFilter:{field:ai(t.field),op:"IS_NOT_NAN"}};if(Wl(t.value))return{unaryFilter:{field:ai(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ai(t.field),op:s_(t.op),value:t.value}}}(n):n instanceof Te?function(t){const r=t.getFilters().map(i=>Ip(i));return 1===r.length?r[0]:{compositeFilter:{op:o_(t.op),filters:r}}}(n):G()}function a_(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function vp(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class Rr{constructor(e,t,r,i,s=j.min(),o=j.min(),h=Je.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=h,this.expectedCount=d}withSequenceNumber(e){return new Rr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Rr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Rr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Rr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Ep{constructor(e){this.ut=e}}function Tp(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:ec(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:pu(s=n.ut,(o=e).key),fields:o.data.value.mapValue.fields,updateTime:Mo(s,o.version.toTimestamp()),createTime:Mo(s,o.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:os(e.version)};else{if(!e.isUnknownDocument())return G();r.unknownDocument={path:t.path.toArray(),version:os(e.version)}}var s,o;return r}function ec(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function os(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function as(n){const e=new Pe(n.seconds,n.nanoseconds);return j.fromTimestamp(e)}function us(n,e){const t=(e.baseMutations||[]).map(s=>Vh(n.ut,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const r=e.mutations.map(s=>Vh(n.ut,s)),i=Pe.fromMillis(e.localWriteTimeMs);return new Ph(e.batchId,i,t,r)}function _u(n){const e=as(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?as(n.lastLimboFreeSnapshotVersion):j.min();let r;return r=void 0!==n.query.documents?(K(1===(s=n.query).documents.length),vt(Zn(dp(s.documents[0])))):function(s){return vt(_p(s))}(n.query),new Rr(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Je.fromBase64String(n.resumeToken));var s}function Ap(n,e){const t=os(e.snapshotVersion),r=os(e.lastLimboFreeSnapshotVersion);let i;i=oi(e.target)?gp(n.ut,e.target):kh(n.ut,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:hn(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Oh(n){const e=_p({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?jl(e,e.limit,"L"):e}function Lh(n,e){return new Ch(e.largestBatchId,Vh(n.ut,e.overlayMutation))}function wp(n,e){const t=e.path.lastSegment();return[n,pt(e.path.popLast()),t]}function Rp(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:os(r.readTime),documentKey:pt(r.documentKey.path),largestBatchId:r.largestBatchId}}class l_{getBundleMetadata(e,t){return Pp(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:as(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Pp(e).put({bundleId:(i=t).id,createTime:os(Xe(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return Sp(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:Oh(s.bundledQuery),readTime:as(s.readTime)};var s})}saveNamedQuery(e,t){return Sp(e).put({name:(i=t).name,readTime:os(Xe(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Pp(n){return Ze(n,"bundles")}function Sp(n){return Ze(n,"namedQueries")}class tc{constructor(e,t){this.serializer=e,this.userId=t}static ct(e,t){return new tc(e,t.uid||"")}getOverlay(e,t){return yu(e).get(wp(this.userId,t)).next(r=>r?Lh(this.serializer,r):null)}getOverlays(e,t){const r=Hn();return w.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,o)=>{const h=new Ch(t,o);i.push(this.lt(e,h))}),w.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(o=>i.add(pt(o.getCollectionPath())));const s=[];return i.forEach(o=>{const h=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(yu(e).H("collectionPathOverlayIndex",h))}),w.waitFor(s)}getOverlaysForCollection(e,t,r){const i=Hn(),s=pt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return yu(e).W("collectionPathOverlayIndex",o).next(h=>{for(const d of h){const f=Lh(this.serializer,d);i.set(f.getKey(),f)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=Hn();let o;const h=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return yu(e).Y({index:"collectionGroupOverlayIndex",range:h},(d,f,m)=>{const y=Lh(this.serializer,f);s.size()<i||y.largestBatchId===o?(s.set(y.getKey(),y),o=y.largestBatchId):m.done()}).next(()=>s)}lt(e,t){return yu(e).put(function(i,s,o){const[h,d,f]=wp(s,o.mutation.key);return{userId:s,collectionPath:d,documentId:f,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:gu(i.ut,o.mutation)}}(this.serializer,this.userId,t))}}function yu(n){return Ze(n,"documentOverlays")}class ls{constructor(){}ht(e,t){this.Pt(e,t),t.It()}Pt(e,t){if("nullValue"in e)this.Tt(t,5);else if("booleanValue"in e)this.Tt(t,10),t.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(t,15),t.Et(Oe(e.integerValue));else if("doubleValue"in e){const r=Oe(e.doubleValue);isNaN(r)?this.Tt(t,13):(this.Tt(t,15),Yi(r)?t.Et(0):t.Et(r))}else if("timestampValue"in e){const r=e.timestampValue;this.Tt(t,20),"string"==typeof r?t.dt(r):(t.dt(`${r.seconds||""}`),t.Et(r.nanos||0))}else if("stringValue"in e)this.At(e.stringValue,t),this.Rt(t);else if("bytesValue"in e)this.Tt(t,30),t.Vt(Sn(e.bytesValue)),this.Rt(t);else if("referenceValue"in e)this.ft(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Tt(t,45),t.Et(r.latitude||0),t.Et(r.longitude||0)}else"mapValue"in e?Co(e)?this.Tt(t,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,t),this.Rt(t)):"arrayValue"in e?(this.yt(e.arrayValue,t),this.Rt(t)):G()}At(e,t){this.Tt(t,25),this.wt(e,t)}wt(e,t){t.dt(e)}gt(e,t){const r=e.fields||{};this.Tt(t,55);for(const i of Object.keys(r))this.At(i,t),this.Pt(r[i],t)}yt(e,t){const r=e.values||[];this.Tt(t,50);for(const i of r)this.Pt(i,t)}ft(e,t){this.Tt(t,37),W.fromName(e).path.forEach(r=>{this.Tt(t,60),this.wt(r,t)})}Tt(e,t){e.Et(t)}Rt(e){e.Et(2)}}function c_(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Cp(n){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const o=c_(255&r[s]);if(i+=o,8!==o)break}return i}(n);return Math.ceil(e/8)}ls.St=new ls;class h_{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Dt(r.value),r=t.next();this.Ct()}vt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{const i=t.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(e){const t=this.Bt(e),r=Cp(t);this.Lt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}kt(e){const t=this.Bt(e),r=Cp(t);this.Lt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(e){this.Lt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ut(){return this.buffer.slice(0,this.position)}Bt(e){const t=function(s){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Dt(e){const t=255&e;0===t?(this.Qt(0),this.Qt(255)):255===t?(this.Qt(255),this.Qt(0)):this.Qt(t)}Ft(e){const t=255&e;0===t?(this.$t(0),this.$t(255)):255===t?(this.$t(255),this.$t(0)):this.$t(e)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(e){this.Lt(1),this.buffer[this.position++]=e}$t(e){this.Lt(1),this.buffer[this.position++]=~e}Lt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class d_{constructor(e){this.Wt=e}Vt(e){this.Wt.bt(e)}dt(e){this.Wt.xt(e)}Et(e){this.Wt.Nt(e)}It(){this.Wt.qt()}}class f_{constructor(e){this.Wt=e}Vt(e){this.Wt.vt(e)}dt(e){this.Wt.Ot(e)}Et(e){this.Wt.kt(e)}It(){this.Wt.Kt()}}class Iu{constructor(){this.Wt=new h_,this.Gt=new d_(this.Wt),this.zt=new f_(this.Wt)}seed(e){this.Wt.seed(e)}jt(e){return 0===e?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}}class cs{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ht(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new cs(this.indexId,this.documentKey,this.arrayValue,r)}}function ui(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=bp(n.arrayValue,e.arrayValue),0!==t?t:(t=bp(n.directionalValue,e.directionalValue),0!==t?t:W.comparator(n.documentKey,e.documentKey)))}function bp(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class xp{constructor(e){this.Jt=new ve((t,r)=>ke.comparator(t.field,r.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(const t of e.filters){const r=t;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(e){if(K(e.collectionGroup===this.collectionId),this.Xt)return!1;const t=za(e);if(void 0!==t&&!this.tn(t))return!1;const r=yr(e);let i=new Set,s=0,o=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){const h=this.Jt.getIterator().getNext();if(!i.has(h.field.canonicalString())){const d=r[s];if(!this.nn(h,d)||!this.rn(this.Yt[o++],d))return!1}++s}for(;s<r.length;++s)if(o>=this.Yt.length||!this.rn(this.Yt[o++],r[s]))return!1;return!0}sn(){if(this.Xt)return null;let e=new ve(ke.comparator);const t=[];for(const r of this.Zt)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new Ir(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Ir(r.field,0))}for(const r of this.Yt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Ir(r.field,"asc"===r.dir?0:1)));return new Qr(Qr.UNKNOWN_ID,this.collectionId,t,Yr.empty())}tn(e){for(const t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Dp(n){var e,t;if(K(n instanceof ce||n instanceof Te),n instanceof ce){if(n instanceof $){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>ce.create(n.field,"==",s)))||[];return Te.create(i,"or")}return n}const r=n.filters.map(i=>Dp(i));return Te.create(r,n.op)}function p_(n){if(0===n.getFilters().length)return[];const e=Uh(Dp(n));return K(Np(e)),Mh(e)||Fh(e)?[e]:e.getFilters()}function Mh(n){return n instanceof ce}function Fh(n){return n instanceof Te&&eu(n)}function Np(n){return Mh(n)||Fh(n)||function(t){if(t instanceof Te&&xo(t)){for(const r of t.getFilters())if(!Mh(r)&&!Fh(r))return!1;return!0}return!1}(n)}function Uh(n){if(K(n instanceof ce||n instanceof Te),n instanceof ce)return n;if(1===n.filters.length)return Uh(n.filters[0]);const e=n.filters.map(r=>Uh(r));let t=Te.create(e,n.op);return t=nc(t),Np(t)?t:(K(t instanceof Te),K(ii(t)),K(t.filters.length>1),t.filters.reduce((r,i)=>Bh(r,i)))}function Bh(n,e){let t;return K(n instanceof ce||n instanceof Te),K(e instanceof ce||e instanceof Te),t=n instanceof ce?e instanceof ce?Te.create([n,e],"and"):Vp(n,e):e instanceof ce?Vp(e,n):function(i,s){if(K(i.filters.length>0&&s.filters.length>0),ii(i)&&ii(s))return u(i,s.getFilters());const o=xo(i)?i:s,h=xo(i)?s:i,d=o.filters.map(f=>Bh(f,h));return Te.create(d,"or")}(n,e),nc(t)}function Vp(n,e){if(ii(e))return u(e,n.getFilters());{const t=e.filters.map(r=>Bh(n,r));return Te.create(t,"or")}}function nc(n){if(K(n instanceof ce||n instanceof Te),n instanceof ce)return n;const e=n.getFilters();if(1===e.length)return nc(e[0]);if(Zl(n))return n;const t=e.map(i=>nc(i)),r=[];return t.forEach(i=>{i instanceof ce?r.push(i):i instanceof Te&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:Te.create(r,n.op)}class m_{constructor(){this.on=new qh}addToCollectionParentIndex(e,t){return this.on.add(t),w.resolve()}getCollectionParents(e,t){return w.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return w.resolve()}deleteFieldIndex(e,t){return w.resolve()}deleteAllFieldIndexes(e){return w.resolve()}createTargetIndexes(e,t){return w.resolve()}getDocumentsMatchingTarget(e,t){return w.resolve(null)}getIndexType(e,t){return w.resolve(0)}getFieldIndexes(e,t){return w.resolve([])}getNextCollectionGroupToUpdate(e){return w.resolve(null)}getMinOffset(e,t){return w.resolve(It.min())}getMinOffsetFromCollectionGroup(e,t){return w.resolve(It.min())}updateCollectionGroup(e,t,r){return w.resolve()}updateIndexEntries(e,t){return w.resolve()}}class qh{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ve(me.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ve(me.comparator)).toArray()}}const rc=new Uint8Array(0);class g_{constructor(e,t){this.user=e,this.databaseId=t,this._n=new qh,this.an=new Ar(r=>hn(r),(r,i)=>si(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this._n.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this._n.add(t)});const s={collectionId:r,parent:pt(i)};return kp(e).put(s)}return w.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[bl(t),""],!1,!0);return kp(e).W(i).next(s=>{for(const o of s){if(o.collectionId!==t)break;r.push(an(o.parent))}return r})}addFieldIndex(e,t){const r=vu(e),i={indexId:(h=t).indexId,collectionGroup:h.collectionGroup,fields:h.fields.map(d=>[d.fieldPath.canonicalString(),d.kind])};var h;delete i.indexId;const s=r.add(i);if(t.indexState){const o=Bo(e);return s.next(h=>{o.put(Rp(h,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=vu(e),i=Bo(e),s=Uo(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=vu(e),r=Uo(e),i=Bo(e);return t.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(e,t){return w.forEach(this.un(t),r=>this.getIndexType(e,r).next(i=>{if(0===i||1===i){const s=new xp(r).sn();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const r=Uo(e);let i=!0;const s=new Map;return w.forEach(this.un(t),o=>this.cn(e,o).next(h=>{i&&(i=!!h),s.set(o,h)})).next(()=>{if(i){let o=ie();const h=[];return w.forEach(s,(d,f)=>{var Y;V("IndexedDbIndexManager",`Using index ${Y=d,`id=${Y.indexId}|cg=${Y.collectionGroup}|f=${Y.fields.map(H=>`${H.fieldPath}:${H.kind}`).join(",")}`} to execute ${hn(t)}`);const m=function(Y,H){const se=za(H);if(void 0===se)return null;for(const re of rs(Y,se.fieldPath))switch(re.op){case"array-contains-any":return re.value.arrayValue.values||[];case"array-contains":return[re.value]}return null}(f,d),y=function(Y,H){const se=new Map;for(const re of yr(H))for(const ot of rs(Y,re.fieldPath))switch(ot.op){case"==":case"in":se.set(re.fieldPath.canonicalString(),ot.value);break;case"not-in":case"!=":return se.set(re.fieldPath.canonicalString(),ot.value),Array.from(se.values())}return null}(f,d),I=function(Y,H){const se=[];let re=!0;for(const ot of yr(H)){const pn=0===ot.kind?tu(Y,ot.fieldPath,Y.startAt):Do(Y,ot.fieldPath,Y.startAt);se.push(pn.value),re&&(re=pn.inclusive)}return new Cn(se,re)}(f,d),P=function(Y,H){const se=[];let re=!0;for(const ot of yr(H)){const pn=0===ot.kind?Do(Y,ot.fieldPath,Y.endAt):tu(Y,ot.fieldPath,Y.endAt);se.push(pn.value),re&&(re=pn.inclusive)}return new Cn(se,re)}(f,d),O=this.ln(d,f,I),U=this.ln(d,f,P),M=this.hn(d,f,y),Z=this.Pn(d.indexId,m,O,I.inclusive,U,P.inclusive,M);return w.forEach(Z,J=>r.j(J,t.limit).next(Y=>{Y.forEach(H=>{const se=W.fromSegments(H.documentKey);o.has(se)||(o=o.add(se),h.push(se))})}))}).next(()=>h)}return w.resolve(null)})}un(e){let t=this.an.get(e);return t||(t=0===e.filters.length?[e]:p_(Te.create(e.filters,"and")).map(r=>cn(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.an.set(e,t),t)}Pn(e,t,r,i,s,o,h){const d=(null!=t?t.length:1)*Math.max(r.length,s.length),f=d/(null!=t?t.length:1),m=[];for(let y=0;y<d;++y){const I=t?this.In(t[y/f]):rc,P=this.Tn(e,I,r[y%f],i),O=this.En(e,I,s[y%f],o),U=h.map(M=>this.Tn(e,I,M,!0));m.push(...this.createRange(P,O,U))}return m}Tn(e,t,r,i){const s=new cs(e,W.empty(),t,r);return i?s:s.Ht()}En(e,t,r,i){const s=new cs(e,W.empty(),t,r);return i?s.Ht():s}cn(e,t){const r=new xp(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(const h of s)r.en(h)&&(!o||h.fields.length>o.fields.length)&&(o=h);return o})}getIndexType(e,t){let r=2;const i=this.un(t);return w.forEach(i,s=>this.cn(e,s).next(o=>{o?0!==r&&o.fields.length<function(d){let f=new ve(ke.comparator),m=!1;for(const y of d.filters)for(const I of y.getFlattenedFilters())I.field.isKeyField()||("array-contains"===I.op||"array-contains-any"===I.op?m=!0:f=f.add(I.field));for(const y of d.orderBy)y.field.isKeyField()||(f=f.add(y.field));return f.size+(m?1:0)}(s)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}dn(e,t){const r=new Iu;for(const i of yr(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const o=r.jt(i.kind);ls.St.ht(s,o)}return r.Ut()}In(e){const t=new Iu;return ls.St.ht(e,t.jt(0)),t.Ut()}An(e,t){const r=new Iu;return ls.St.ht(Tr(this.databaseId,t),r.jt(function(s){const o=yr(s);return 0===o.length?0:o[o.length-1].kind}(e))),r.Ut()}hn(e,t,r){if(null===r)return[];let i=[];i.push(new Iu);let s=0;for(const o of yr(e)){const h=r[s++];for(const d of i)if(this.Rn(t,o.fieldPath)&&es(h))i=this.Vn(i,o,h);else{const f=d.jt(o.kind);ls.St.ht(h,f)}}return this.mn(i)}ln(e,t,r){return this.hn(e,t,r.position)}mn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Ut();return t}Vn(e,t,r){const i=[...e],s=[];for(const o of r.arrayValue.values||[])for(const h of i){const d=new Iu;d.seed(h.Ut()),ls.St.ht(o,d.jt(t.kind)),s.push(d)}return s}Rn(e,t){return!!e.filters.find(r=>r instanceof ce&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=vu(e),i=Bo(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(s=>{const o=[];return w.forEach(s,h=>i.get([h.indexId,this.uid]).next(d=>{o.push(function(m,y){const I=y?new Yr(y.sequenceNumber,new It(as(y.readTime),new W(an(y.documentKey)),y.largestBatchId)):Yr.empty(),P=m.fields.map(([O,U])=>new Ir(ke.fromServerFormat(O),U));return new Qr(m.indexId,m.collectionGroup,P,I)}(h,d))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:ee(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=vu(e),s=Bo(e);return this.fn(e).next(o=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(h=>w.forEach(h,d=>s.put(Rp(d.indexId,this.user,o,r)))))}updateIndexEntries(e,t){const r=new Map;return w.forEach(t,(i,s)=>{const o=r.get(i.collectionGroup);return(o?w.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(h=>(r.set(i.collectionGroup,h),w.forEach(h,d=>this.gn(e,i,d).next(f=>{const m=this.pn(s,d);return f.isEqual(m)?w.resolve():this.yn(e,s,d,f,m)}))))})}wn(e,t,r,i){return Uo(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,t.key),documentKey:t.key.path.toArray()})}Sn(e,t,r,i){return Uo(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,t.key),t.key.path.toArray()])}gn(e,t,r){const i=Uo(e);let s=new ve(ui);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,t)])},(o,h)=>{s=s.add(new cs(r.indexId,t,h.arrayValue,h.directionalValue))}).next(()=>s)}pn(e,t){let r=new ve(ui);const i=this.dn(t,e);if(null==i)return r;const s=za(t);if(null!=s){const o=e.data.field(s.fieldPath);if(es(o))for(const h of o.arrayValue.values||[])r=r.add(new cs(t.indexId,e.key,this.In(h),i))}else r=r.add(new cs(t.indexId,e.key,rc,i));return r}yn(e,t,r,i,s){V("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(d,f,m,y,I){const P=d.getIterator(),O=f.getIterator();let U=ei(P),M=ei(O);for(;U||M;){let Z=!1,J=!1;if(U&&M){const Y=m(U,M);Y<0?J=!0:Y>0&&(Z=!0)}else null!=U?J=!0:Z=!0;Z?(y(M),M=ei(O)):J?(I(U),U=ei(P)):(U=ei(P),M=ei(O))}}(i,s,ui,h=>{o.push(this.wn(e,t,r,h))},h=>{o.push(this.Sn(e,t,r,h))}),w.waitFor(o)}fn(e){let t=1;return Bo(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,h)=>ui(o,h)).filter((o,h,d)=>!h||0!==ui(o,d[h-1]));const i=[];i.push(e);for(const o of r){const h=ui(o,e),d=ui(o,t);if(0===h)i[0]=e.Ht();else if(h>0&&d<0)i.push(o),i.push(o.Ht());else if(d>0)break}i.push(t);const s=[];for(let o=0;o<i.length;o+=2){if(this.bn(i[o],i[o+1]))return[];s.push(IDBKeyRange.bound([i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,rc,[]],[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,rc,[]]))}return s}bn(e,t){return ui(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Op)}getMinOffset(e,t){return w.mapArray(this.un(t),r=>this.cn(e,r).next(i=>i||G())).next(Op)}}function kp(n){return Ze(n,"collectionParents")}function Uo(n){return Ze(n,"indexEntries")}function vu(n){return Ze(n,"indexConfiguration")}function Bo(n){return Ze(n,"indexState")}function Op(n){K(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;Wa(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new It(e.readTime,e.documentKey,t)}const Lp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class bt{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new bt(e,bt.DEFAULT_COLLECTION_PERCENTILE,bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Mp(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId);let h=0;const d=r.Y({range:o},(m,y,I)=>(h++,I.delete()));s.push(d.next(()=>{K(1===h)}));const f=[];for(const m of t.mutations){const y=Ol(e,m.key.path,t.batchId);s.push(i.delete(y)),f.push(m.key)}return w.waitFor(s).next(()=>f)}function ic(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw G();e=n.noDocument}return JSON.stringify(e).length}bt.DEFAULT_COLLECTION_PERCENTILE=10,bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,bt.DEFAULT=new bt(41943040,bt.DEFAULT_COLLECTION_PERCENTILE,bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),bt.DISABLED=new bt(-1,0,0);class sc{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(e,t,r,i){K(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new sc(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return li(e).Y({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=qo(e),o=li(e);return o.add({}).next(h=>{K("number"==typeof h);const d=new Ph(h,t,r,i),f=function(P,O,U){const M=U.baseMutations.map(J=>gu(P.ut,J)),Z=U.mutations.map(J=>gu(P.ut,J));return{userId:O,batchId:U.batchId,localWriteTimeMs:U.localWriteTime.toMillis(),baseMutations:M,mutations:Z}}(this.serializer,this.userId,d),m=[];let y=new ve((I,P)=>ee(I.canonicalString(),P.canonicalString()));for(const I of i){const P=Ol(this.userId,I.key.path,h);y=y.add(I.key.path.popLast()),m.push(o.put(f)),m.push(s.put(P,$a))}return y.forEach(I=>{m.push(this.indexManager.addToCollectionParentIndex(e,I))}),e.addOnCommittedListener(()=>{this.Dn[h]=d.keys()}),w.waitFor(m).next(()=>d)})}lookupMutationBatch(e,t){return li(e).get(t).next(r=>r?(K(r.userId===this.userId),us(this.serializer,r)):null)}Cn(e,t){return this.Dn[t]?w.resolve(this.Dn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Dn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return li(e).Y({index:"userMutationsIndex",range:i},(o,h,d)=>{h.userId===this.userId&&(K(h.batchId>=r),s=us(this.serializer,h)),d.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return li(e).Y({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return li(e).W("userMutationsIndex",t).next(r=>r.map(i=>us(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=mo(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return qo(e).Y({range:i},(o,h,d)=>{const[f,m,y]=o,I=an(m);if(f===this.userId&&t.path.isEqual(I))return li(e).get(y).next(P=>{if(!P)throw G();K(P.userId===this.userId),s.push(us(this.serializer,P))});d.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ve(ee);const i=[];return t.forEach(s=>{const o=mo(this.userId,s.path),h=IDBKeyRange.lowerBound(o),d=qo(e).Y({range:h},(f,m,y)=>{const[I,P,O]=f,U=an(P);I===this.userId&&s.path.isEqual(U)?r=r.add(O):y.done()});i.push(d)}),w.waitFor(i).next(()=>this.vn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=mo(this.userId,r),o=IDBKeyRange.lowerBound(s);let h=new ve(ee);return qo(e).Y({range:o},(d,f,m)=>{const[y,I,P]=d,O=an(I);y===this.userId&&r.isPrefixOf(O)?O.length===i&&(h=h.add(P)):m.done()}).next(()=>this.vn(e,h))}vn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(li(e).get(s).next(o=>{if(null===o)throw G();K(o.userId===this.userId),r.push(us(this.serializer,o))}))}),w.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return Mp(e.ae,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Fn(t.batchId)}),w.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Fn(e){delete this.Dn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return w.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return qo(e).Y({range:r},(s,o,h)=>{if(s[0]===this.userId){const d=an(s[1]);i.push(d)}else h.done()}).next(()=>{K(0===i.length)})})}containsKey(e,t){return Fp(e,this.userId,t)}Mn(e){return Up(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Fp(n,e,t){const r=mo(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return qo(n).Y({range:s,J:!0},(h,d,f)=>{const[m,y,I]=h;m===e&&y===i&&(o=!0),f.done()}).next(()=>o)}function li(n){return Ze(n,"mutations")}function qo(n){return Ze(n,"documentMutations")}function Up(n){return Ze(n,"mutationQueues")}class hs{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new hs(0)}static Nn(){return new hs(-1)}}class __{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{const r=new hs(t.highestTargetId);return t.highestTargetId=r.next(),this.Ln(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>j.fromTimestamp(new Pe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Ln(e,i)))}addTargetData(e,t){return this.kn(e,t).next(()=>this.Bn(e).next(r=>(r.targetCount+=1,this.qn(t,r),this.Ln(e,r))))}updateTargetData(e,t){return this.kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>zo(e).delete(t.targetId)).next(()=>this.Bn(e)).next(r=>(K(r.targetCount>0),r.targetCount-=1,this.Ln(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return zo(e).Y((o,h)=>{const d=_u(h);d.sequenceNumber<=t&&null===r.get(d.targetId)&&(i++,s.push(this.removeTargetData(e,d)))}).next(()=>w.waitFor(s)).next(()=>i)}forEachTarget(e,t){return zo(e).Y((r,i)=>{const s=_u(i);t(s)})}Bn(e){return Bp(e).get("targetGlobalKey").next(t=>(K(null!==t),t))}Ln(e,t){return Bp(e).put("targetGlobalKey",t)}kn(e,t){return zo(e).put(Ap(this.serializer,t))}qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=hn(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return zo(e).Y({range:i,index:"queryTargetsIndex"},(o,h,d)=>{const f=_u(h);si(t,f.target)&&(s=f,d.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=ci(e);return t.forEach(o=>{const h=pt(o.path);i.push(s.put({targetId:r,path:h})),i.push(this.referenceDelegate.addReference(e,r,o))}),w.waitFor(i)}removeMatchingKeys(e,t,r){const i=ci(e);return w.forEach(t,s=>{const o=pt(s.path);return w.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=ci(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=ci(e);let s=ie();return i.Y({range:r,J:!0},(o,h,d)=>{const f=an(o[1]),m=new W(f);s=s.add(m)}).next(()=>s)}containsKey(e,t){const r=pt(t.path),i=IDBKeyRange.bound([r],[bl(r)],!1,!0);let s=0;return ci(e).Y({index:"documentTargetsIndex",J:!0,range:i},([o,h],d,f)=>{0!==o&&(s++,f.done())}).next(()=>s>0)}_t(e,t){return zo(e).get(t).next(r=>r?_u(r):null)}}function zo(n){return Ze(n,"targets")}function Bp(n){return Ze(n,"targetGlobal")}function ci(n){return Ze(n,"targetDocuments")}function qp([n,e],[t,r]){const i=ee(n,t);return 0===i?ee(e,r):i}class y_{constructor(e){this.Qn=e,this.buffer=new ve(qp),this.Kn=0}$n(){return++this.Kn}Un(e){const t=[e,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();qp(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class zp{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Wn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return null!==this.Wn}Gn(e){var t=this;V("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,g.Z)(function*(){t.Wn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){on(r)?V("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield sn(r)}yield t.Gn(3e5)}))}}class I_{constructor(e,t){this.zn=e,this.params=t}calculateTargetCount(e,t){return this.zn.jn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return w.resolve(Ot._e);const r=new y_(t);return this.zn.forEachTarget(e,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(e,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.zn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector","Garbage collection skipped; disabled"),w.resolve(Lp)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Lp):this.Jn(e,t))}getCacheSize(e){return this.zn.getCacheSize(e)}Jn(e,t){let r,i,s,o,h,d,f;const m=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(y=>(y>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${y}`),i=this.params.maximumSequenceNumbersToCollect):i=y,o=Date.now(),this.nthSequenceNumber(e,i))).next(y=>(r=y,h=Date.now(),this.removeTargets(e,r,t))).next(y=>(s=y,d=Date.now(),this.removeOrphanedDocuments(e,r))).next(y=>(f=Date.now(),zn()<=ae.in.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-m}ms\n\tDetermined least recently used ${i} in `+(h-o)+`ms\n\tRemoved ${s} targets in `+(d-h)+`ms\n\tRemoved ${y} documents in `+(f-d)+`ms\nTotal Duration: ${f-m}ms`),w.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:y})))}}class v_{constructor(e,t){this.db=e,this.garbageCollector=function Wp(n,e){return new I_(n,e)}(this,t)}jn(e){const t=this.Yn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Yn(e){let t=0;return this.Hn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Hn(e,t){return this.Zn(e,(r,i)=>t(i))}addReference(e,t,r){return oc(e,r)}removeReference(e,t,r){return oc(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return oc(e,t)}Xn(e,t){return function(i,s){let o=!1;return Up(i).Z(h=>Fp(i,h,s).next(d=>(d&&(o=!0),w.resolve(!d)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Zn(e,(o,h)=>{if(h<=t){const d=this.Xn(e,o).next(f=>{if(!f)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,j.min()),ci(e).delete([0,pt(o.path)])))});i.push(d)}}).next(()=>w.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return oc(e,t)}Zn(e,t){const r=ci(e);let i,s=Ot._e;return r.Y({index:"documentTargetsIndex"},([o,h],{path:d,sequenceNumber:f})=>{0===o?(s!==Ot._e&&t(new W(an(i)),s),s=f,i=d):s=Ot._e}).next(()=>{s!==Ot._e&&t(new W(an(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function oc(n,e){return ci(n).put((i=n.currentSequenceNumber,{targetId:0,path:pt(e.path),sequenceNumber:i}));var i}class Gp{constructor(){this.changes=new Ar(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ce.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?w.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class E_{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ds(e).put(r)}removeEntry(e,t,r){return ds(e).delete(function(s,o){const h=s.path.toArray();return[h.slice(0,h.length-2),h[h.length-2],ec(o),h[h.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.er(e,r)))}getEntry(e,t){let r=Ce.newInvalidDocument(t);return ds(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Eu(t))},(i,s)=>{r=this.tr(t,s)}).next(()=>r)}nr(e,t){let r={size:0,document:Ce.newInvalidDocument(t)};return ds(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Eu(t))},(i,s)=>{r={document:this.tr(t,s),size:ic(s)}}).next(()=>r)}getEntries(e,t){let r=Gt();return this.rr(e,t,(i,s)=>{const o=this.tr(i,s);r=r.insert(i,o)}).next(()=>r)}ir(e,t){let r=Gt(),i=new Se(W.comparator);return this.rr(e,t,(s,o)=>{const h=this.tr(s,o);r=r.insert(s,h),i=i.insert(s,ic(o))}).next(()=>({documents:r,sr:i}))}rr(e,t,r){if(t.isEmpty())return w.resolve();let i=new ve(jp);t.forEach(d=>i=i.add(d));const s=IDBKeyRange.bound(Eu(i.first()),Eu(i.last())),o=i.getIterator();let h=o.getNext();return ds(e).Y({index:"documentKeyIndex",range:s},(d,f,m)=>{const y=W.fromSegments([...f.prefixPath,f.collectionGroup,f.documentId]);for(;h&&jp(h,y)<0;)r(h,null),h=o.getNext();h&&h.isEqual(y)&&(r(h,f),h=o.hasNext()?o.getNext():null),h?m.U(Eu(h)):m.done()}).next(()=>{for(;h;)r(h,null),h=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){const o=t.path,h=[o.popLast().toArray(),o.lastSegment(),ec(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],d=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ds(e).W(IDBKeyRange.bound(h,d,!0)).next(f=>{s?.incrementDocumentReadCount(f.length);let m=Gt();for(const y of f){const I=this.tr(W.fromSegments(y.prefixPath.concat(y.collectionGroup,y.documentId)),y);I.isFoundDocument()&&(ou(t,I)||i.has(I.key))&&(m=m.insert(I.key,I))}return m})}getAllFromCollectionGroup(e,t,r,i){let s=Gt();const o=Zp(t,r),h=Zp(t,It.max());return ds(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,h,!0)},(d,f,m)=>{const y=this.tr(W.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);s=s.insert(y.key,y),s.size===i&&m.done()}).next(()=>s)}newChangeBuffer(e){return new T_(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Kp(e).get("remoteDocumentGlobalKey").next(t=>(K(!!t),t))}er(e,t){return Kp(e).put("remoteDocumentGlobalKey",t)}tr(e,t){if(t){const r=function u_(n,e){let t;if(e.document)t=mp(n.ut,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=W.fromSegments(e.noDocument.path),i=as(e.noDocument.readTime);t=Ce.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return G();{const r=W.fromSegments(e.unknownDocument.path),i=as(e.unknownDocument.version);t=Ce.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){const s=new Pe(i[0],i[1]);return j.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!r.isNoDocument()||!r.version.isEqual(j.min()))return r}return Ce.newInvalidDocument(e)}}function $p(n){return new E_(n)}class T_ extends Gp{constructor(e,t){super(),this._r=e,this.trackRemovals=t,this.ar=new Ar(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new ve((s,o)=>ee(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const h=this.ar.get(s);if(t.push(this._r.removeEntry(e,s,h.readTime)),o.isValidDocument()){const d=Tp(this._r.serializer,o);i=i.add(s.path.popLast());const f=ic(d);r+=f-h.size,t.push(this._r.addEntry(e,s,d))}else if(r-=h.size,this.trackRemovals){const d=Tp(this._r.serializer,o.convertToNoDocument(j.min()));t.push(this._r.addEntry(e,s,d))}}),i.forEach(s=>{t.push(this._r.indexManager.addToCollectionParentIndex(e,s))}),t.push(this._r.updateMetadata(e,r)),w.waitFor(t)}getFromCache(e,t){return this._r.nr(e,t).next(r=>(this.ar.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this._r.ir(e,t).next(({documents:r,sr:i})=>(i.forEach((s,o)=>{this.ar.set(s,{size:o,readTime:r.get(s).readTime})}),r))}}function Kp(n){return Ze(n,"remoteDocumentGlobal")}function ds(n){return Ze(n,"remoteDocumentsV14")}function Eu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Zp(n,e){const t=e.documentKey.path.toArray();return[n,ec(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function jp(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=ee(t[s],r[s]),i)return i;return i=ee(t.length,r.length),i||(i=ee(t[t.length-2],r[r.length-2]),i||ee(t[t.length-1],r[r.length-1]))}class A_{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Hp{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&cu(r.mutation,i,St.empty(),Pe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ie()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ie()){const i=Hn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=au();return s.forEach((h,d)=>{o=o.insert(h,d.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Hn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ie()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,h)=>{t.set(o,h)})})}computeViews(e,t,r,i){let s=Gt();const o=uu(),h=uu();return t.forEach((d,f)=>{const m=r.get(f.key);i.has(f.key)&&(void 0===m||m.mutation instanceof wr)?s=s.insert(f.key,f):void 0!==m?(o.set(f.key,m.mutation.getFieldMask()),cu(m.mutation,f,m.mutation.getFieldMask(),Pe.now())):o.set(f.key,St.empty())}),this.recalculateAndSaveOverlays(e,s).next(d=>(d.forEach((f,m)=>o.set(f,m)),t.forEach((f,m)=>{var y;return h.set(f,new A_(m,null!==(y=o.get(f))&&void 0!==y?y:null))}),h))}recalculateAndSaveOverlays(e,t){const r=uu();let i=new Se((o,h)=>o-h),s=ie();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const h of o)h.keys().forEach(d=>{const f=t.get(d);if(null===f)return;let m=r.get(d)||St.empty();m=h.applyToLocalView(f,m),r.set(d,m);const y=(i.get(h.batchId)||ie()).add(d);i=i.insert(h.batchId,y)})}).next(()=>{const o=[],h=i.getReverseIterator();for(;h.hasNext();){const d=h.getNext(),f=d.key,m=d.value,y=Bf();m.forEach(I=>{if(!s.has(I)){const P=Hf(t.get(I),r.get(I));null!==P&&y.set(I,P),s=s.add(I)}}),o.push(this.documentOverlayCache.saveOverlays(e,f,y))}return w.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return W.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):iu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i);var o}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):w.resolve(Hn());let h=-1,d=s;return o.next(f=>w.forEach(f,(m,y)=>(h<y.largestBatchId&&(h=y.largestBatchId),s.get(m)?w.resolve():this.remoteDocumentCache.getEntry(e,m).next(I=>{d=d.insert(m,I)}))).next(()=>this.populateOverlays(e,f,s)).next(()=>this.computeViews(e,d,f,ie())).next(m=>({batchId:h,changes:Uf(m)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new W(t)).next(r=>{let i=au();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let o=au();return this.indexManager.getCollectionParents(e,s).next(h=>w.forEach(h,d=>{const f=(y=t,I=d.child(s),new dn(I,null,y.explicitOrderBy.slice(),y.filters.slice(),y.limit,y.limitType,y.startAt,y.endAt));var y,I;return this.getDocumentsMatchingCollectionQuery(e,f,r,i).next(m=>{m.forEach((y,I)=>{o=o.insert(y,I)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((d,f)=>{const m=f.getKey();null===o.get(m)&&(o=o.insert(m,Ce.newInvalidDocument(m)))});let h=au();return o.forEach((d,f)=>{const m=s.get(d);void 0!==m&&cu(m.mutation,f,St.empty(),Pe.now()),ou(t,f)&&(h=h.insert(d,f))}),h})}}class w_{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return w.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,{id:(i=t).id,version:i.version,createTime:Xe(i.createTime)}),w.resolve();var i}getNamedQuery(e,t){return w.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,{name:(i=t).name,query:Oh(i.bundledQuery),readTime:Xe(i.readTime)}),w.resolve();var i}}class R_{constructor(){this.overlays=new Se(W.comparator),this.lr=new Map}getOverlay(e,t){return w.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Hn();return w.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.lt(e,t,s)}),w.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.lr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),w.resolve()}getOverlaysForCollection(e,t,r){const i=Hn(),s=t.length+1,o=new W(t.child("")),h=this.overlays.getIteratorFrom(o);for(;h.hasNext();){const d=h.getNext().value,f=d.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===s&&d.largestBatchId>r&&i.set(d.getKey(),d)}return w.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Se((f,m)=>f-m);const o=this.overlays.getIterator();for(;o.hasNext();){const f=o.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>r){let m=s.get(f.largestBatchId);null===m&&(m=Hn(),s=s.insert(f.largestBatchId,m)),m.set(f.getKey(),f)}}const h=Hn(),d=s.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((f,m)=>h.set(f,m)),!(h.size()>=i)););return w.resolve(h)}lt(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const o=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Ch(t,r));let s=this.lr.get(t);void 0===s&&(s=ie(),this.lr.set(t,s)),this.lr.set(t,s.add(r.key))}}class zh{constructor(){this.hr=new ve(mt.Pr),this.Ir=new ve(mt.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){const r=new mt(e,t);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.dr(new mt(e,t))}Ar(e,t){e.forEach(r=>this.removeReference(r,t))}Rr(e){const t=new W(new me([])),r=new mt(t,e),i=new mt(t,e+1),s=[];return this.Ir.forEachInRange([r,i],o=>{this.dr(o),s.push(o.key)}),s}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){const t=new W(new me([])),r=new mt(t,e),i=new mt(t,e+1);let s=ie();return this.Ir.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new mt(e,0),r=this.hr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class mt{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return W.comparator(e.key,t.key)||ee(e.gr,t.gr)}static Tr(e,t){return ee(e.gr,t.gr)||W.comparator(e.key,t.key)}}class P_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new ve(mt.Pr)}checkEmpty(e){return w.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.pr;this.pr++;const o=new Ph(s,t,r,i);this.mutationQueue.push(o);for(const h of i)this.yr=this.yr.add(new mt(h.key,s)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return w.resolve(o)}lookupMutationBatch(e,t){return w.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.Sr(t+1),s=i<0?0:i;return w.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return w.resolve(0===this.mutationQueue.length?-1:this.pr-1)}getAllMutationBatches(e){return w.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new mt(t,0),i=new mt(t,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],o=>{const h=this.wr(o.gr);s.push(h)}),w.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ve(ee);return t.forEach(i=>{const s=new mt(i,0),o=new mt(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,o],h=>{r=r.add(h.gr)})}),w.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;W.isDocumentKey(s)||(s=s.child(""));const o=new mt(new W(s),0);let h=new ve(ee);return this.yr.forEachWhile(d=>{const f=d.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(h=h.add(d.gr)),!0)},o),w.resolve(this.br(h))}br(e){const t=[];return e.forEach(r=>{const i=this.wr(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){K(0===this.Dr(t.batchId,"removed")),this.mutationQueue.shift();let r=this.yr;return w.forEach(t.mutations,i=>{const s=new mt(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,t){const r=new mt(t,0),i=this.yr.firstAfterOrEqual(r);return w.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return w.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}wr(e){const t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class S_{constructor(e){this.Cr=e,this.docs=new Se(W.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Cr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return w.resolve(r?r.document.mutableCopy():Ce.newInvalidDocument(t))}getEntries(e,t){let r=Gt();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ce.newInvalidDocument(i))}),w.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Gt();const o=t.path,h=new W(o.child("")),d=this.docs.getIteratorFrom(h);for(;d.hasNext();){const{key:f,value:{document:m}}=d.getNext();if(!o.isPrefixOf(f.path))break;f.path.length>o.length+1||Wa(Dl(m),r)<=0||(i.has(m.key)||ou(t,m))&&(s=s.insert(m.key,m.mutableCopy()))}return w.resolve(s)}getAllFromCollectionGroup(e,t,r,i){G()}vr(e,t){return w.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new C_(this)}getSize(e){return w.resolve(this.size)}}class C_ extends Gp{constructor(e){super(),this._r=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this._r.addEntry(e,i)):this._r.removeEntry(r)}),w.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}}class b_{constructor(e){this.persistence=e,this.Fr=new Ar(t=>hn(t),si),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.Mr=0,this.Or=new zh,this.targetCount=0,this.Nr=hs.On()}forEachTarget(e,t){return this.Fr.forEach((r,i)=>t(i)),w.resolve()}getLastRemoteSnapshotVersion(e){return w.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return w.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),w.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Mr&&(this.Mr=t),w.resolve()}kn(e){this.Fr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Nr=new hs(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,w.resolve()}updateTargetData(e,t){return this.kn(t),w.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,w.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Fr.forEach((o,h)=>{h.sequenceNumber<=t&&null===r.get(h.targetId)&&(this.Fr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,h.targetId)),i++)}),w.waitFor(s).next(()=>i)}getTargetCount(e){return w.resolve(this.targetCount)}getTargetData(e,t){const r=this.Fr.get(t)||null;return w.resolve(r)}addMatchingKeys(e,t,r){return this.Or.Er(t,r),w.resolve()}removeMatchingKeys(e,t,r){this.Or.Ar(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),w.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),w.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Or.mr(t);return w.resolve(r)}containsKey(e,t){return w.resolve(this.Or.containsKey(t))}}class Wh{constructor(e,t){this.Br={},this.overlays={},this.Lr=new Ot(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new b_(this),this.indexManager=new m_,this.remoteDocumentCache=new S_(r=>this.referenceDelegate.Qr(r)),this.serializer=new Ep(t),this.Kr=new w_(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new R_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new P_(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,r){V("MemoryPersistence","Starting transaction:",e);const i=new x_(this.Lr.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(e,t){return w.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}}class x_ extends Nl{constructor(e){super(),this.currentSequenceNumber=e}}class ac{constructor(e){this.persistence=e,this.Gr=new zh,this.zr=null}static jr(e){return new ac(e)}get Hr(){if(this.zr)return this.zr;throw G()}addReference(e,t,r){return this.Gr.addReference(r,t),this.Hr.delete(r.toString()),w.resolve()}removeReference(e,t,r){return this.Gr.removeReference(r,t),this.Hr.add(r.toString()),w.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),w.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(i=>this.Hr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return w.forEach(this.Hr,r=>{const i=W.fromPath(r);return this.Jr(e,i).next(s=>{s||t.removeEntry(i,j.min())})}).next(()=>(this.zr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Jr(e,t).next(r=>{r?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return w.or([()=>w.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}}class D_{constructor(e){this.serializer=e}N(e,t,r,i){const s=new ho("createOrUpgrade",t);var d;r<1&&i>=1&&(e.createObjectStore("owner"),(d=e).createObjectStore("mutationQueues",{keyPath:"userId"}),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Xr,{unique:!0}),d.createObjectStore("documentMutations"),Qp(e),function(d){d.createObjectStore("remoteDocuments")}(e));let o=w.resolve();return r<3&&i>=3&&(0!==r&&(function(d){d.deleteObjectStore("targetDocuments"),d.deleteObjectStore("targets"),d.deleteObjectStore("targetGlobal")}(e),Qp(e)),o=o.next(()=>function(d){const f=d.store("targetGlobal"),m={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:j.min().toTimestamp(),targetCount:0};return f.put("targetGlobalKey",m)}(s))),r<4&&i>=4&&(0!==r&&(o=o.next(()=>function(d,f){return f.store("mutations").W().next(m=>{d.deleteObjectStore("mutations"),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Xr,{unique:!0});const y=f.store("mutations"),I=m.map(P=>y.put(P));return w.waitFor(I)})}(e,s))),o=o.next(()=>{!function(d){d.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(o=o.next(()=>this.Zr(s))),r<6&&i>=6&&(o=o.next(()=>(function(d){d.createObjectStore("remoteDocumentGlobal")}(e),this.Xr(s)))),r<7&&i>=7&&(o=o.next(()=>this.ei(s))),r<8&&i>=8&&(o=o.next(()=>this.ti(e,s))),r<9&&i>=9&&(o=o.next(()=>{!function(d){d.objectStoreNames.contains("remoteDocumentChanges")&&d.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(o=o.next(()=>this.ni(s))),r<11&&i>=11&&(o=o.next(()=>{(function(d){d.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(d){d.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{!function(d){const f=d.createObjectStore("documentOverlays",{keyPath:Ha});f.createIndex("collectionPathOverlayIndex",mh,{unique:!1}),f.createIndex("collectionGroupOverlayIndex",gh,{unique:!1})}(e)})),r<13&&i>=13&&(o=o.next(()=>function(d){const f=d.createObjectStore("remoteDocumentsV14",{keyPath:Ka});f.createIndex("documentKeyIndex",Za),f.createIndex("collectionGroupIndex",ch)}(e)).next(()=>this.ri(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ii(e,s))),r<15&&i>=15&&(o=o.next(()=>function(d){d.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),d.createObjectStore("indexState",{keyPath:dh}).createIndex("sequenceNumberIndex",ja,{unique:!1}),d.createObjectStore("indexEntries",{keyPath:fh}).createIndex("documentKeyIndex",ph,{unique:!1})}(e))),o}Xr(e){let t=0;return e.store("remoteDocuments").Y((r,i)=>{t+=ic(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>w.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(h=>w.forEach(h,d=>{K(d.userId===s.userId);const f=us(this.serializer,d);return Mp(e,s.userId,f).next(()=>{})}))}))}ei(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Y((o,h)=>{const d=new me(o),f=[0,pt(d)];s.push(t.get(f).next(m=>m?w.resolve():t.put({targetId:0,path:pt(d),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>w.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:hh});const r=t.store("collectionParents"),i=new qh,s=o=>{if(i.add(o)){const h=o.lastSegment(),d=o.popLast();return r.put({collectionId:h,parent:pt(d)})}};return t.store("remoteDocuments").Y({J:!0},(o,h)=>{const d=new me(o);return s(d.popLast())}).next(()=>t.store("documentMutations").Y({J:!0},([o,h,d],f)=>{const m=an(h);return s(m.popLast())}))}ni(e){const t=e.store("targets");return t.Y((r,i)=>{const s=_u(i),o=Ap(this.serializer,s);return t.put(o)})}ri(e,t){const r=t.store("remoteDocuments"),i=[];return r.Y((s,o)=>{const h=t.store("remoteDocumentsV14"),d=(y=o,y.document?new W(me.fromString(y.document.name).popFirst(5)):y.noDocument?W.fromSegments(y.noDocument.path):y.unknownDocument?W.fromSegments(y.unknownDocument.path):G()).path.toArray(),f={prefixPath:d.slice(0,d.length-2),collectionGroup:d[d.length-2],documentId:d[d.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};var y;i.push(h.put(f))}).next(()=>w.waitFor(i))}ii(e,t){const r=t.store("mutations"),i=$p(this.serializer),s=new Wh(ac.jr,this.serializer.ut);return r.W().next(o=>{const h=new Map;return o.forEach(d=>{var f;let m=null!==(f=h.get(d.userId))&&void 0!==f?f:ie();us(this.serializer,d).keys().forEach(y=>m=m.add(y)),h.set(d.userId,m)}),w.forEach(h,(d,f)=>{const m=new rt(f),y=tc.ct(this.serializer,m),I=s.getIndexManager(m),P=sc.ct(m,this.serializer,I,s.referenceDelegate);return new Hp(i,P,y,I).recalculateAndSaveOverlaysForDocumentKeys(new Io(t,Ot._e),d).next()})})}}function Qp(n){n.createObjectStore("targetDocuments",{keyPath:Ml}).createIndex("documentTargetsIndex",Fl,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Ll,{unique:!0}),n.createObjectStore("targetGlobal")}const Gh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class $h{constructor(e,t,r,i,s,o,h,d,f,m,y=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.si=s,this.window=o,this.document=h,this.oi=f,this._i=m,this.ai=y,this.Lr=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=I=>Promise.resolve(),!$h.D())throw new N(C.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new v_(this,i),this.Ii=t+"main",this.serializer=new Ep(d),this.Ti=new kt(this.Ii,this.ai,new D_(this.serializer)),this.qr=new __(this.referenceDelegate,this.serializer),this.remoteDocumentCache=$p(this.serializer),this.Kr=new l_,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,!1===m&&We("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new N(C.FAILED_PRECONDITION,Gh);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.qr.getHighestSequenceNumber(e))}).then(e=>{this.Lr=new Ot(e,this.oi)}).then(()=>{this.kr=!0}).catch(e=>(this.Ti&&this.Ti.close(),Promise.reject(e)))}mi(e){var t=this;return this.Pi=function(){var r=(0,g.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ti.L(function(){var t=(0,g.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget((0,g.Z)(function*(){t.started&&(yield t.di())})))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>lc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(e)).next(t=>this.isPrimary&&!t?this.pi(e).next(()=>!1):!!t&&this.yi(e).next(()=>!0))).catch(e=>{if(on(e))return V("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return V("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.Pi(e)),this.isPrimary=e})}fi(e){return Tu(e).get("owner").next(t=>w.resolve(this.wi(t)))}Si(e){return lc(e).delete(this.clientId)}bi(){var e=this;return(0,g.Z)(function*(){if(e.isPrimary&&!e.Di(e.hi,18e5)){e.hi=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=Ze(r,"clientMetadata");return i.W().next(s=>{const o=e.Ci(s,18e5),h=s.filter(d=>-1===o.indexOf(d));return w.forEach(h,d=>i.delete(d.clientId)).next(()=>h)})}).catch(()=>[]);if(e.Ei)for(const r of t)e.Ei.removeItem(e.vi(r.clientId))}})()}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(e){return!!e&&e.ownerId===this.clientId}gi(e){return this._i?w.resolve(!0):Tu(e).get("owner").next(t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)){if(this.wi(t)&&this.networkEnabled)return!0;if(!this.wi(t)){if(!t.allowTabSynchronization)throw new N(C.FAILED_PRECONDITION,Gh);return!1}}return!(!this.networkEnabled||!this.inForeground)||lc(e).W().next(r=>void 0===this.Ci(r,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&V("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,g.Z)(function*(){e.kr=!1,e.Mi(),e.li&&(e.li.cancel(),e.li=null),e.xi(),e.Oi(),yield e.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Io(t,Ot._e);return e.pi(r).next(()=>e.Si(r))}),e.Ti.close(),e.Ni()})()}Ci(e,t){return e.filter(r=>this.Di(r.updateTimeMs,t)&&!this.Fi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>lc(e).W().next(t=>this.Ci(t,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(e,t){return sc.ct(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new g_(e,this.serializer.ut.databaseId)}getDocumentOverlayCache(e){return tc.ct(this.serializer,e)}getBundleCache(){return this.Kr}runTransaction(e,t,r){V("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=15===(d=this.ai)?Qa:14===d?yo:13===d?_o:12===d?_h:11===d?go:void G();var d;let o;return this.Ti.runTransaction(e,i,s,h=>(o=new Io(h,this.Lr?this.Lr.next():Ot._e),"readwrite-primary"===t?this.fi(o).next(d=>!!d||this.gi(o)).next(d=>{if(!d)throw We(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new N(C.FAILED_PRECONDITION,co);return r(o)}).next(d=>this.yi(o).next(()=>d)):this.Li(o).next(()=>r(o)))).then(h=>(o.raiseOnCommittedEvent(),h))}Li(e){return Tu(e).get("owner").next(t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)&&!this.wi(t)&&!(this._i||this.allowTabSynchronization&&t.allowTabSynchronization))throw new N(C.FAILED_PRECONDITION,Gh)})}yi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Tu(e).put("owner",t)}static D(){return kt.D()}pi(e){const t=Tu(e);return t.get("owner").next(r=>this.wi(r)?(V("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):w.resolve())}Di(e,t){const r=Date.now();return!(e<r-t||e>r&&(We(`Detected an update time that is in the future: ${e} > ${r}`),1))}Ai(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground="visible"===this.document.visibilityState)}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ui=()=>{this.Mi();const t=/(?:Version|Mobile)\/1[456]/;(0,Ie.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(e){var t;try{const r=null!==(null===(t=this.Ei)||void 0===t?void 0:t.getItem(this.vi(e)));return V("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return We("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){We("Failed to set zombie client id.",e)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Tu(n){return Ze(n,"owner")}function lc(n){return Ze(n,"clientMetadata")}function Kh(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class Zh{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ki=r,this.qi=i}static Qi(e,t){let r=ie(),i=ie();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Zh(e,t.fromCache,r,i)}}class N_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Yp{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=8}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.zi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ji(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new N_;return this.Hi(e,t,o).next(h=>{if(s.result=h,this.$i)return this.Ji(e,t,o,h.size)})}).next(()=>s.result)}Ji(e,t,r,i){return r.documentReadCount<this.Ui?(zn()<=ae.in.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",No(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),w.resolve()):(zn()<=ae.in.DEBUG&&V("QueryEngine","Query:",No(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(zn()<=ae.in.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",No(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,vt(t))):w.resolve())}zi(e,t){if(ru(t))return w.resolve(null);let r=vt(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=jl(t,null,"F"),r=vt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=ie(...s);return this.Gi.getDocuments(e,o).next(h=>this.indexManager.getMinOffset(e,r).next(d=>{const f=this.Yi(t,h);return this.Zi(t,f,o,d.readTime)?this.zi(e,jl(t,null,"F")):this.Xi(e,f,t,d)}))})))}ji(e,t,r,i){return ru(t)||i.isEqual(j.min())?w.resolve(null):this.Gi.getDocuments(e,r).next(s=>{const o=this.Yi(t,s);return this.Zi(t,o,r,i)?w.resolve(null):(zn()<=ae.in.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),No(t)),this.Xi(e,o,t,lo(i,-1)).next(h=>h))})}Yi(e,t){let r=new ve(Mf(e));return t.forEach((i,s)=>{ou(e,s)&&(r=r.add(s))}),r}Zi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(e,t,r){return zn()<=ae.in.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",No(t)),this.Gi.getDocumentsMatchingQuery(e,t,It.min(),r)}Xi(e,t,r,i){return this.Gi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class V_{constructor(e,t,r,i){this.persistence=e,this.es=t,this.serializer=i,this.ts=new Se(ee),this.ns=new Ar(s=>hn(s),si),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Hp(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ts))}}function Jp(n,e,t,r){return new V_(n,e,t,r)}function Xp(n,e){return jh.apply(this,arguments)}function jh(){return jh=(0,g.Z)(function*(n,e){const t=B(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.os(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],h=[];let d=ie();for(const f of i){o.push(f.batchId);for(const m of f.mutations)d=d.add(m.key)}for(const f of s){h.push(f.batchId);for(const m of f.mutations)d=d.add(m.key)}return t.localDocuments.getDocuments(r,d).next(f=>({_s:f,removedBatchIds:o,addedBatchIds:h}))})})}),jh.apply(this,arguments)}function em(n){const e=B(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qr.getLastRemoteSnapshotVersion(t))}function tm(n,e,t){let r=ie(),i=ie();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Gt();return t.forEach((h,d)=>{const f=s.get(h);d.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(h)),d.isNoDocument()&&d.version.isEqual(j.min())?(e.removeEntry(h,d.readTime),o=o.insert(h,d)):!f.isValidDocument()||d.version.compareTo(f.version)>0||0===d.version.compareTo(f.version)&&f.hasPendingWrites?(e.addEntry(d),o=o.insert(h,d)):V("LocalStore","Ignoring outdated watch update for ",h,". Current version:",f.version," Watch version:",d.version)}),{us:o,cs:i}})}function L_(n,e){const t=B(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Wo(n,e){const t=B(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.qr.getTargetData(r,e).next(s=>s?(i=s,w.resolve(i)):t.qr.allocateTargetId(r).next(o=>(i=new Rr(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.ts.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ts=t.ts.insert(r.targetId,r),t.ns.set(e,r.targetId)),r})}function Go(n,e,t){return Hh.apply(this,arguments)}function Hh(){return Hh=(0,g.Z)(function*(n,e,t){const r=B(n),i=r.ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!on(o))throw o;V("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)}),Hh.apply(this,arguments)}function cc(n,e,t){const r=B(n);let i=j.min(),s=ie();return r.persistence.runTransaction("Execute query","readwrite",o=>function(d,f,m){const y=B(d),I=y.ns.get(m);return void 0!==I?w.resolve(y.ts.get(I)):y.qr.getTargetData(f,m)}(r,o,vt(e)).next(h=>{if(h)return i=h.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(o,h.targetId).next(d=>{s=d})}).next(()=>r.es.getDocumentsMatchingQuery(o,e,t?i:j.min(),t?s:ie())).next(h=>(im(r,Lf(e),h),{documents:h,ls:s})))}function nm(n,e){const t=B(n),r=B(t.qr),i=t.ts.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r._t(s,e).next(o=>o?o.target:null))}function rm(n,e){const t=B(n),r=t.rs.get(e)||j.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.ss.getAllFromCollectionGroup(i,e,lo(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(im(t,e,i),i))}function im(n,e,t){let r=n.rs.get(e)||j.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(e,r)}function Qh(){return Qh=(0,g.Z)(function*(n,e,t,r){const i=B(n);let s=ie(),o=Gt();for(const f of t){const m=e.hs(f.metadata.name);f.document&&(s=s.add(m));const y=e.Ps(f);y.setReadTime(e.Is(f.metadata.readTime)),o=o.insert(m,y)}const h=i.ss.newChangeBuffer({trackRemovals:!0}),d=yield Wo(i,(m=r,vt(Zn(me.fromString(`__bundle__/docs/${m}`)))));var m;return i.persistence.runTransaction("Apply bundle documents","readwrite",f=>tm(f,h,o).next(m=>(h.apply(f),m)).next(m=>i.qr.removeMatchingKeysForTargetId(f,d.targetId).next(()=>i.qr.addMatchingKeys(f,s,d.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(f,m.us,m.cs)).next(()=>m.us)))}),Qh.apply(this,arguments)}function F_(n,e){return Yh.apply(this,arguments)}function Yh(){return Yh=(0,g.Z)(function*(n,e,t=ie()){const r=yield Wo(n,vt(Oh(e.bundledQuery))),i=B(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const o=Xe(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Kr.saveNamedQuery(s,e);const h=r.withResumeToken(Je.EMPTY_BYTE_STRING,o);return i.ts=i.ts.insert(h.targetId,h),i.qr.updateTargetData(s,h).next(()=>i.qr.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.qr.addMatchingKeys(s,t,r.targetId)).next(()=>i.Kr.saveNamedQuery(s,e))})}),Yh.apply(this,arguments)}function sm(n,e){return`firestore_clients_${n}_${e}`}function om(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Jh(n,e){return`firestore_targets_${n}_${e}`}class hc{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ts(e,t,r){const i=JSON.parse(r);let s,o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code,o&&(s=new N(i.error.code,i.error.message))),o?new hc(e,t,i.state,s):(We("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Au{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ts(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new N(r.error.code,r.error.message))),s?new Au(e,r.state,i):(We("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class dc{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ts(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=wh();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=fo(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new dc(e,s):(We("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Xh{constructor(e,t){this.clientId=e,this.onlineState=t}static Ts(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Xh(t.clientId,t.onlineState):(We("SharedClientState",`Failed to parse online state: ${e}`),null)}}class ed{constructor(){this.activeTargetIds=wh()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class td{constructor(e,t,r,i,s){this.window=e,this.si=t,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new Se(ee),this.started=!1,this.ps=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=sm(this.persistenceKey,this.Rs),this.ws=`firestore_sequence_number_${this.persistenceKey}`,this.gs=this.gs.insert(this.Rs,new ed),this.Ss=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Cs=`firestore_online_state_${this.persistenceKey}`,this.vs=function(d){return`firestore_bundle_loaded_v2_${d}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,g.Z)(function*(){const t=yield e.syncEngine.Bi();for(const i of t){if(i===e.Rs)continue;const s=e.getItem(sm(e.persistenceKey,i));if(s){const o=dc.Ts(i,s);o&&(e.gs=e.gs.insert(o.clientId,o))}}e.Fs();const r=e.storage.getItem(e.Cs);if(r){const i=e.Ms(r);i&&e.xs(i)}for(const i of e.ps)e.fs(i);e.ps=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(e){let t=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ns(e,"pending")}updateMutationState(e,t,r){this.Ns(e,t,r),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(Jh(this.persistenceKey,e));if(r){const i=Au.Ts(e,r);i&&(t=i.state)}}return this.Ls.ds(e),this.Fs(),t}removeLocalQueryTarget(e){this.Ls.As(e),this.Fs()}isLocalQueryTarget(e){return this.Ls.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Jh(this.persistenceKey,e))}updateQueryState(e,t,r){this.ks(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.qs(e)}notifyBundleLoaded(e){this.Qs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return V("SharedClientState","READ",e,t),t}setItem(e,t){V("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){V("SharedClientState","REMOVE",e),this.storage.removeItem(e)}fs(e){var t=this;const r=e;if(r.storageArea===this.storage){if(V("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ys)return void We("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable((0,g.Z)(function*(){if(t.started){if(null!==r.key)if(t.Ss.test(r.key)){if(null==r.newValue){const i=t.Ks(r.key);return t.$s(i,null)}{const i=t.Us(r.key,r.newValue);if(i)return t.$s(i.clientId,i)}}else if(t.bs.test(r.key)){if(null!==r.newValue){const i=t.Ws(r.key,r.newValue);if(i)return t.Gs(i)}}else if(t.Ds.test(r.key)){if(null!==r.newValue){const i=t.zs(r.key,r.newValue);if(i)return t.js(i)}}else if(r.key===t.Cs){if(null!==r.newValue){const i=t.Ms(r.newValue);if(i)return t.xs(i)}}else if(r.key===t.ws){const i=function(o){let h=Ot._e;if(null!=o)try{const d=JSON.parse(o);K("number"==typeof d),h=d}catch(d){We("SharedClientState","Failed to read sequence number from WebStorage",d)}return h}(r.newValue);i!==Ot._e&&t.sequenceNumberHandler(i)}else if(r.key===t.vs){const i=t.Hs(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Js(s)))}}else t.ps.push(r)}))}}get Ls(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Ls.Es())}Ns(e,t,r){const i=new hc(this.currentUser,e,t,r),s=om(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Es())}Bs(e){const t=om(this.persistenceKey,this.currentUser,e);this.removeItem(t)}qs(e){this.storage.setItem(this.Cs,JSON.stringify({clientId:this.Rs,onlineState:e}))}ks(e,t,r){const i=Jh(this.persistenceKey,e),s=new Au(e,t,r);this.setItem(i,s.Es())}Qs(e){const t=JSON.stringify(Array.from(e));this.setItem(this.vs,t)}Ks(e){const t=this.Ss.exec(e);return t?t[1]:null}Us(e,t){const r=this.Ks(e);return dc.Ts(r,t)}Ws(e,t){const r=this.bs.exec(e),i=Number(r[1]);return hc.Ts(new rt(void 0!==r[2]?r[2]:null),i,t)}zs(e,t){const r=this.Ds.exec(e),i=Number(r[1]);return Au.Ts(i,t)}Ms(e){return Xh.Ts(e)}Hs(e){return JSON.parse(e)}Gs(e){var t=this;return(0,g.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Ys(e.batchId,e.state,e.error);V("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}js(e){return this.syncEngine.Zs(e.targetId,e.state,e.error)}$s(e,t){const r=t?this.gs.insert(e,t):this.gs.remove(e),i=this.Os(this.gs),s=this.Os(r),o=[],h=[];return s.forEach(d=>{i.has(d)||o.push(d)}),i.forEach(d=>{s.has(d)||h.push(d)}),this.syncEngine.Xs(o,h).then(()=>{this.gs=r})}xs(e){this.gs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Os(e){let t=wh();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class am{constructor(){this.eo=new ed,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,r){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new ed,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class U_{ro(e){}shutdown(){}}class um{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){V("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ao)e(0)}_o(){V("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ao)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let fc=null;function nd(){return null===fc?fc=268435456+Math.round(2147483648*Math.random()):fc++,"0x"+fc.toString(16)}const B_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class q_{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}onMessage(e){this.Eo=e}close(){this.lo()}send(e){this.co(e)}Ao(){this.Po()}Ro(e){this.To(e)}Vo(e){this.Eo(e)}}const xt="WebChannelConnection";class z_ extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.mo=r+"://"+t.host,this.fo=`projects/${i}/databases/${s}`,this.po="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get yo(){return!1}wo(t,r,i,s,o){const h=nd(),d=this.So(t,r);V("RestConnection",`Sending RPC '${t}' ${h}:`,d,i);const f={"google-cloud-resource-prefix":this.fo,"x-goog-request-params":this.po};return this.bo(f,s,o),this.Do(t,d,f,i).then(m=>(V("RestConnection",`Received RPC '${t}' ${h}: `,m),m),m=>{throw Pt("RestConnection",`RPC '${t}' ${h} failed with error: `,m,"url: ",d,"request:",i),m})}Co(t,r,i,s,o,h){return this.wo(t,r,i,s,o)}bo(t,r,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+Ve,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}So(t,r){return`${this.mo}/v1/${r}:${B_[t]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Do(e,t,r,i){const s=nd();return new Promise((o,h)=>{const d=new Ma;d.setWithCredentials(!0),d.listenOnce(Yc.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Oa.NO_ERROR:const m=d.getResponseJson();V(xt,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(m)),o(m);break;case Oa.TIMEOUT:V(xt,`RPC '${e}' ${s} timed out`),h(new N(C.DEADLINE_EXCEEDED,"Request time out"));break;case Oa.HTTP_ERROR:const y=d.getStatus();if(V(xt,`RPC '${e}' ${s} failed with status:`,y,"response text:",d.getResponseText()),y>0){let I=d.getResponseJson();Array.isArray(I)&&(I=I[0]);const P=I?.error;if(P&&P.status&&P.message){const O=function(M){const Z=M.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(Z)>=0?Z:C.UNKNOWN}(P.status);h(new N(O,P.message))}else h(new N(C.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new N(C.UNAVAILABLE,"Connection failed."));break;default:G()}}finally{V(xt,`RPC '${e}' ${s} completed.`)}});const f=JSON.stringify(i);V(xt,`RPC '${e}' ${s} sending request:`,i),d.send(t,"POST",f,r,15)})}vo(e,t,r){const i=nd(),s=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=ao(),h=Al(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;void 0!==f&&(d.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(d.xmlHttpFactory=new wl({})),this.bo(d.initMessageHeaders,t,r),d.encodeInitMessageHeaders=!0;const m=s.join("");V(xt,`Creating RPC '${e}' stream ${i}: ${m}`,d);const y=o.createWebChannel(m,d);let I=!1,P=!1;const O=new q_({co:M=>{P?V(xt,`Not sending because RPC '${e}' stream ${i} is closed:`,M):(I||(V(xt,`Opening RPC '${e}' stream ${i} transport.`),y.open(),I=!0),V(xt,`RPC '${e}' stream ${i} sending:`,M),y.send(M))},lo:()=>y.close()}),U=(M,Z,J)=>{M.listen(Z,Y=>{try{J(Y)}catch(H){setTimeout(()=>{throw H},0)}})};return U(y,La.EventType.OPEN,()=>{P||V(xt,`RPC '${e}' stream ${i} transport opened.`)}),U(y,La.EventType.CLOSE,()=>{P||(P=!0,V(xt,`RPC '${e}' stream ${i} transport closed`),O.Ro())}),U(y,La.EventType.ERROR,M=>{P||(P=!0,Pt(xt,`RPC '${e}' stream ${i} transport errored:`,M),O.Ro(new N(C.UNAVAILABLE,"The operation could not be completed")))}),U(y,La.EventType.MESSAGE,M=>{var Z;if(!P){const J=M.data[0];K(!!J);const H=J.error||(null===(Z=J[0])||void 0===Z?void 0:Z.error);if(H){V(xt,`RPC '${e}' stream ${i} received error:`,H);const se=H.status;let re=function(Pv){const Vg=st[Pv];if(void 0!==Vg)return tp(Vg)}(se),ot=H.message;void 0===re&&(re=C.INTERNAL,ot="Unknown error status: "+se+" with message "+H.message),P=!0,O.Ro(new N(re,ot)),y.close()}else V(xt,`RPC '${e}' stream ${i} received:`,J),O.Vo(J)}}),U(h,Jc.STAT_EVENT,M=>{M.stat===Xc.PROXY?V(xt,`RPC '${e}' stream ${i} detected buffering proxy`):M.stat===Xc.NOPROXY&&V(xt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{O.Ao()},0),O}}function lm(){return typeof window<"u"?window:null}function pc(){return typeof document<"u"?document:null}function wu(n){return new Jg(n,!0)}class rd{constructor(e,t,r=1e3,i=1.5,s=6e4){this.si=e,this.timerId=t,this.Fo=r,this.Mo=i,this.xo=s,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(e){this.cancel();const t=Math.floor(this.Oo+this.qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,t-r);i>0&&V("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Oo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),e())),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){null!==this.No&&(this.No.skipDelay(),this.No=null)}cancel(){null!==this.No&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}}class cm{constructor(e,t,r,i,s,o,h,d){this.si=e,this.Ko=r,this.$o=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=h,this.listener=d,this.state=0,this.Uo=0,this.Wo=null,this.Go=null,this.stream=null,this.zo=new rd(e,t)}jo(){return 1===this.state||5===this.state||this.Ho()}Ho(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Jo()}stop(){var e=this;return(0,g.Z)(function*(){e.jo()&&(yield e.close(0))})()}Yo(){this.state=0,this.zo.reset()}Zo(){this.Ho()&&null===this.Wo&&(this.Wo=this.si.enqueueAfterDelay(this.Ko,6e4,()=>this.Xo()))}e_(e){this.t_(),this.stream.send(e)}Xo(){var e=this;return(0,g.Z)(function*(){if(e.Ho())return e.close(0)})()}t_(){this.Wo&&(this.Wo.cancel(),this.Wo=null)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}close(e,t){var r=this;return(0,g.Z)(function*(){r.t_(),r.n_(),r.zo.cancel(),r.Uo++,4!==e?r.zo.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(We(t.toString()),We("Using maximum backoff delay to prevent overloading the backend."),r.zo.Lo()):t&&t.code===C.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.r_(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Io(t)})()}r_(){}auth(){this.state=1;const e=this.i_(this.Uo),t=this.Uo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Uo===t&&this.s_(r,i)},r=>{e(()=>{const i=new N(C.UNKNOWN,"Fetching auth token failed: "+r.message);return this.o_(i)})})}s_(e,t){const r=this.i_(this.Uo);this.stream=this.__(e,t),this.stream.ho(()=>{r(()=>(this.state=2,this.Go=this.si.enqueueAfterDelay(this.$o,1e4,()=>(this.Ho()&&(this.state=3),Promise.resolve())),this.listener.ho()))}),this.stream.Io(i=>{r(()=>this.o_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Jo(){var e=this;this.state=5,this.zo.ko((0,g.Z)(function*(){e.state=0,e.start()}))}o_(e){return V("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}i_(e){return t=>{this.si.enqueueAndForget(()=>this.Uo===e?t():(V("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class W_ extends cm{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}__(e,t){return this.connection.vo("Listen",e,t)}onMessage(e){this.zo.reset();const t=function t_(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(f=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:G(),i=e.targetChange.targetIds||[],s=function(f,m){return f.useProto3Json?(K(void 0===m||"string"==typeof m),Je.fromBase64String(m||"")):(K(void 0===m||m instanceof Uint8Array),Je.fromUint8Array(m||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,h=o&&function(f){const m=void 0===f.code?C.UNKNOWN:tp(f.code);return new N(m,f.message||"")}(o);t=new op(r,i,s,h||null)}else if("documentChange"in e){const r=e.documentChange,i=Qn(n,r.document.name),s=Xe(r.document.updateTime),o=r.document.createTime?Xe(r.document.createTime):j.min(),h=new lt({mapValue:{fields:r.document.fields}}),d=Ce.newFoundDocument(i,s,o,h);t=new Xl(r.targetIds||[],r.removedTargetIds||[],d.key,d)}else if("documentDelete"in e){const r=e.documentDelete,i=Qn(n,r.document),s=r.readTime?Xe(r.readTime):j.min(),o=Ce.newNoDocument(i,s);t=new Xl([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,i=Qn(n,r.document);t=new Xl([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return G();{const r=e.filter,{count:i=0,unchangedNames:s}=r,o=new Kg(i,s);t=new sp(r.targetId,o)}}var f;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return j.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?j.min():o.readTime?Xe(o.readTime):j.min()}(e);return this.listener.a_(t,r)}u_(e){const t={};t.database=mu(this.serializer),t.addTarget=function(s,o){let h;const d=o.target;if(h=oi(d)?{documents:gp(s,d)}:{query:kh(s,d)},h.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){h.resumeToken=cp(s,o.resumeToken);const f=xh(s,o.expectedCount);null!==f&&(h.expectedCount=f)}else if(o.snapshotVersion.compareTo(j.min())>0){h.readTime=Mo(s,o.snapshotVersion.toTimestamp());const f=xh(s,o.expectedCount);null!==f&&(h.expectedCount=f)}return h}(this.serializer,e);const r=function r_(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return G()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.e_(t)}c_(e){const t={};t.database=mu(this.serializer),t.removeTarget=e,this.e_(t)}}class G_ extends cm{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.l_=!1}get h_(){return this.l_}start(){this.l_=!1,this.lastStreamToken=void 0,super.start()}r_(){this.l_&&this.P_([])}__(e,t){return this.connection.vo("Write",e,t)}onMessage(e){if(K(!!e.streamToken),this.lastStreamToken=e.streamToken,this.l_){this.zo.reset();const t=function n_(n,e){return n&&n.length>0?(K(void 0!==e),n.map(t=>function(i,s){let o=Xe(i.updateTime?i.updateTime:s);return o.isEqual(j.min())&&(o=Xe(s)),new zg(o,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=Xe(e.commitTime);return this.listener.I_(r,t)}return K(!e.writeResults||0===e.writeResults.length),this.l_=!0,this.listener.T_()}E_(){const e={};e.database=mu(this.serializer),this.e_(e)}P_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>gu(this.serializer,r))};this.e_(t)}}class $_ extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.d_=!1}A_(){if(this.d_)throw new N(C.FAILED_PRECONDITION,"The client has already been terminated.")}wo(e,t,r){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.wo(e,t,r,i,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new N(C.UNKNOWN,i.toString())})}Co(e,t,r,i){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Co(e,t,r,s,o,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new N(C.UNKNOWN,s.toString())})}terminate(){this.d_=!0}}class Z_{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.V_=0,this.m_=null,this.f_=!0}g_(){0===this.V_&&(this.p_("Unknown"),this.m_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.m_=null,this.y_("Backend didn't respond within 10 seconds."),this.p_("Offline"),Promise.resolve())))}w_(e){"Online"===this.state?this.p_("Unknown"):(this.V_++,this.V_>=1&&(this.S_(),this.y_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.p_("Offline")))}set(e){this.S_(),this.V_=0,"Online"===e&&(this.f_=!1),this.p_(e)}p_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}y_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.f_?(We(t),this.f_=!1):V("OnlineStateTracker",t)}S_(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}}class j_{constructor(e,t,r,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.b_=[],this.D_=new Map,this.C_=new Set,this.v_=[],this.F_=s,this.F_.ro(h=>{r.enqueueAndForget((0,g.Z)(function*(){var d;hi(o)&&(V("RemoteStore","Restarting streams for network reachability change."),yield(d=(0,g.Z)(function*(m){const y=B(m);y.C_.add(4),yield $o(y),y.M_.set("Unknown"),y.C_.delete(4),yield Ru(y)}),function f(m){return d.apply(this,arguments)})(o))}))}),this.M_=new Z_(r,i)}}function Ru(n){return sd.apply(this,arguments)}function sd(){return sd=(0,g.Z)(function*(n){if(hi(n))for(const e of n.v_)yield e(!0)}),sd.apply(this,arguments)}function $o(n){return od.apply(this,arguments)}function od(){return od=(0,g.Z)(function*(n){for(const e of n.v_)yield e(!1)}),od.apply(this,arguments)}function mc(n,e){const t=B(n);t.D_.has(e.targetId)||(t.D_.set(e.targetId,e),ld(t)?ud(t):Zo(t).Ho()&&ad(t,e))}function Pu(n,e){const t=B(n),r=Zo(t);t.D_.delete(e),r.Ho()&&hm(t,e),0===t.D_.size&&(r.Ho()?r.Zo():hi(t)&&t.M_.set("Unknown"))}function ad(n,e){if(n.x_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(j.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Zo(n).u_(e)}function hm(n,e){n.x_.Oe(e),Zo(n).c_(e)}function ud(n){n.x_=new jg({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.D_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),Zo(n).start(),n.M_.g_()}function ld(n){return hi(n)&&!Zo(n).jo()&&n.D_.size>0}function hi(n){return 0===B(n).C_.size}function dm(n){n.x_=void 0}function H_(n){return cd.apply(this,arguments)}function cd(){return cd=(0,g.Z)(function*(n){n.D_.forEach((e,t)=>{ad(n,e)})}),cd.apply(this,arguments)}function Q_(n,e){return hd.apply(this,arguments)}function hd(){return hd=(0,g.Z)(function*(n,e){dm(n),ld(n)?(n.M_.w_(e),ud(n)):n.M_.set("Unknown")}),hd.apply(this,arguments)}function Y_(n,e,t){return dd.apply(this,arguments)}function dd(){return dd=(0,g.Z)(function*(n,e,t){if(n.M_.set("Online"),e instanceof op&&2===e.state&&e.cause)try{yield(r=(0,g.Z)(function*(s,o){const h=o.cause;for(const d of o.targetIds)s.D_.has(d)&&(yield s.remoteSyncer.rejectListen(d,h),s.D_.delete(d),s.x_.removeTarget(d))}),function i(s,o){return r.apply(this,arguments)})(n,e)}catch(r){V("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield gc(n,r)}else if(e instanceof Xl?n.x_.$e(e):e instanceof sp?n.x_.Je(e):n.x_.Ge(e),!t.isEqual(j.min()))try{const r=yield em(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){const h=s.x_.it(o);return h.targetChanges.forEach((d,f)=>{if(d.resumeToken.approximateByteSize()>0){const m=s.D_.get(f);m&&s.D_.set(f,m.withResumeToken(d.resumeToken,o))}}),h.targetMismatches.forEach((d,f)=>{const m=s.D_.get(d);if(!m)return;s.D_.set(d,m.withResumeToken(Je.EMPTY_BYTE_STRING,m.snapshotVersion)),hm(s,d);const y=new Rr(m.target,d,f,m.sequenceNumber);ad(s,y)}),s.remoteSyncer.applyRemoteEvent(h)}(n,t))}catch(r){V("RemoteStore","Failed to raise snapshot:",r),yield gc(n,r)}var r}),dd.apply(this,arguments)}function gc(n,e,t){return fd.apply(this,arguments)}function fd(){return fd=(0,g.Z)(function*(n,e,t){if(!on(e))throw e;n.C_.add(1),yield $o(n),n.M_.set("Offline"),t||(t=()=>em(n.localStore)),n.asyncQueue.enqueueRetryable((0,g.Z)(function*(){V("RemoteStore","Retrying IndexedDB access"),yield t(),n.C_.delete(1),yield Ru(n)}))}),fd.apply(this,arguments)}function fm(n,e){return e().catch(t=>gc(n,t,e))}function Ko(n){return pd.apply(this,arguments)}function pd(){return pd=(0,g.Z)(function*(n){const e=B(n),t=di(e);let r=e.b_.length>0?e.b_[e.b_.length-1].batchId:-1;for(;J_(e);)try{const i=yield L_(e.localStore,r);if(null===i){0===e.b_.length&&t.Zo();break}r=i.batchId,X_(e,i)}catch(i){yield gc(e,i)}pm(e)&&mm(e)}),pd.apply(this,arguments)}function J_(n){return hi(n)&&n.b_.length<10}function X_(n,e){n.b_.push(e);const t=di(n);t.Ho()&&t.h_&&t.P_(e.mutations)}function pm(n){return hi(n)&&!di(n).jo()&&n.b_.length>0}function mm(n){di(n).start()}function ey(n){return md.apply(this,arguments)}function md(){return md=(0,g.Z)(function*(n){di(n).E_()}),md.apply(this,arguments)}function ty(n){return gd.apply(this,arguments)}function gd(){return gd=(0,g.Z)(function*(n){const e=di(n);for(const t of n.b_)e.P_(t.mutations)}),gd.apply(this,arguments)}function ny(n,e,t){return _d.apply(this,arguments)}function _d(){return _d=(0,g.Z)(function*(n,e,t){const r=n.b_.shift(),i=Sh.from(r,e,t);yield fm(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Ko(n)}),_d.apply(this,arguments)}function ry(n,e){return yd.apply(this,arguments)}function yd(){return yd=(0,g.Z)(function*(n,e){var t;e&&di(n).h_&&(yield(t=(0,g.Z)(function*(i,s){if(ep(h=s.code)&&h!==C.ABORTED){const o=i.b_.shift();di(i).Yo(),yield fm(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield Ko(i)}var h}),function r(i,s){return t.apply(this,arguments)})(n,e)),pm(n)&&mm(n)}),yd.apply(this,arguments)}function gm(n,e){return Id.apply(this,arguments)}function Id(){return Id=(0,g.Z)(function*(n,e){const t=B(n);t.asyncQueue.verifyOperationInProgress(),V("RemoteStore","RemoteStore received new credentials");const r=hi(t);t.C_.add(3),yield $o(t),r&&t.M_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.C_.delete(3),yield Ru(t)}),Id.apply(this,arguments)}function vd(n,e){return Ed.apply(this,arguments)}function Ed(){return Ed=(0,g.Z)(function*(n,e){const t=B(n);e?(t.C_.delete(2),yield Ru(t)):e||(t.C_.add(2),yield $o(t),t.M_.set("Unknown"))}),Ed.apply(this,arguments)}function Zo(n){return n.O_||(n.O_=function(t,r,i){const s=B(t);return s.A_(),new W_(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:H_.bind(null,n),Io:Q_.bind(null,n),a_:Y_.bind(null,n)}),n.v_.push(function(){var e=(0,g.Z)(function*(t){t?(n.O_.Yo(),ld(n)?ud(n):n.M_.set("Unknown")):(yield n.O_.stop(),dm(n))});return function(t){return e.apply(this,arguments)}}())),n.O_}function di(n){return n.N_||(n.N_=function(t,r,i){const s=B(t);return s.A_(),new G_(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:ey.bind(null,n),Io:ry.bind(null,n),T_:ty.bind(null,n),I_:ny.bind(null,n)}),n.v_.push(function(){var e=(0,g.Z)(function*(t){t?(n.N_.Yo(),yield Ko(n)):(yield n.N_.stop(),n.b_.length>0&&(V("RemoteStore",`Stopping write stream with ${n.b_.length} pending writes`),n.b_=[]))});return function(t){return e.apply(this,arguments)}}())),n.N_}class Td{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ge,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,h=new Td(e,t,o,i,s);return h.start(r),h}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new N(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function jo(n,e){if(We("AsyncQueue",`${e}: ${n}`),on(n))return new N(C.UNAVAILABLE,`${e}: ${n}`);throw n}class Ho{constructor(e){this.comparator=e?(t,r)=>e(t,r)||W.comparator(t.key,r.key):(t,r)=>W.comparator(t.key,r.key),this.keyedMap=au(),this.sortedSet=new Se(this.comparator)}static emptySet(e){return new Ho(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ho)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Ho;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class _m{constructor(){this.B_=new Se(W.comparator)}track(e){const t=e.doc.key,r=this.B_.get(t);r?0!==e.type&&3===r.type?this.B_=this.B_.insert(t,e):3===e.type&&1!==r.type?this.B_=this.B_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.B_=this.B_.remove(t):1===e.type&&2===r.type?this.B_=this.B_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):G():this.B_=this.B_.insert(t,e)}L_(){const e=[];return this.B_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Qo{constructor(e,t,r,i,s,o,h,d,f){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=h,this.excludesMetadataChanges=d,this.hasCachedResults=f}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(h=>{o.push({type:0,doc:h})}),new Qo(e,t,Ho.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&su(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class iy{constructor(){this.k_=void 0,this.listeners=[]}}class sy{constructor(){this.queries=new Ar(e=>Of(e),su),this.onlineState="Unknown",this.q_=new Set}}function Ad(n,e){return wd.apply(this,arguments)}function wd(){return wd=(0,g.Z)(function*(n,e){const t=B(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new iy),i)try{s.k_=yield t.onListen(r)}catch(o){const h=jo(o,`Initialization of query '${No(e.query)}' failed`);return void e.onError(h)}t.queries.set(r,s),s.listeners.push(e),e.Q_(t.onlineState),s.k_&&e.K_(s.k_)&&Sd(t)}),wd.apply(this,arguments)}function Rd(n,e){return Pd.apply(this,arguments)}function Pd(){return Pd=(0,g.Z)(function*(n,e){const t=B(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),i=0===s.listeners.length)}if(i)return t.queries.delete(r),t.onUnlisten(r)}),Pd.apply(this,arguments)}function oy(n,e){const t=B(n);let r=!1;for(const i of e){const o=t.queries.get(i.query);if(o){for(const h of o.listeners)h.K_(i)&&(r=!0);o.k_=i}}r&&Sd(t)}function ay(n,e,t){const r=B(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function Sd(n){n.q_.forEach(e=>{e.next()})}class Cd{constructor(e,t,r){this.query=e,this.U_=t,this.W_=!1,this.G_=null,this.onlineState="Unknown",this.options=r||{}}K_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new Qo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.W_?this.z_(e)&&(this.U_.next(e),t=!0):this.j_(e,this.onlineState)&&(this.H_(e),t=!0),this.G_=e,t}onError(e){this.U_.error(e)}Q_(e){this.onlineState=e;let t=!1;return this.G_&&!this.W_&&this.j_(this.G_,e)&&(this.H_(this.G_),t=!0),t}j_(e,t){return!e.fromCache||(!this.options.J_||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}z_(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.G_&&this.G_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}H_(e){e=Qo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.W_=!0,this.U_.next(e)}}class uy{constructor(e,t){this.Y_=e,this.byteLength=t}Z_(){return"metadata"in this.Y_}}class ym{constructor(e){this.serializer=e}hs(e){return Qn(this.serializer,e)}Ps(e){return e.metadata.exists?mp(this.serializer,e.document,!1):Ce.newNoDocument(this.hs(e.metadata.name),this.Is(e.metadata.readTime))}Is(e){return Xe(e)}}class ly{constructor(e,t,r){this.X_=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Im(e)}ea(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Y_.namedQuery)this.queries.push(e.Y_.namedQuery);else if(e.Y_.documentMetadata){this.documents.push({metadata:e.Y_.documentMetadata}),e.Y_.documentMetadata.exists||++t;const r=me.fromString(e.Y_.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Y_.document&&(this.documents[this.documents.length-1].document=e.Y_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ta(e){const t=new Map,r=new ym(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.hs(i.metadata.name);for(const o of i.metadata.queries){const h=(t.get(o)||ie()).add(s);t.set(o,h)}}return t}complete(){var e=this;return(0,g.Z)(function*(){const t=yield function M_(n,e,t,r){return Qh.apply(this,arguments)}(e.localStore,new ym(e.serializer),e.documents,e.X_.id),r=e.ta(e.documents);for(const i of e.queries)yield F_(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,na:e.collectionGroups,ra:t}})()}}function Im(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class vm{constructor(e){this.key=e}}class Em{constructor(e){this.key=e}}class Tm{constructor(e,t){this.query=e,this.ia=t,this.sa=null,this.hasCachedResults=!1,this.current=!1,this.oa=ie(),this.mutatedKeys=ie(),this._a=Mf(e),this.aa=new Ho(this._a)}get ua(){return this.ia}ca(e,t){const r=t?t.la:new _m,i=t?t.aa:this.aa;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,h=!1;const d="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,f="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((m,y)=>{const I=i.get(m),P=ou(this.query,y)?y:null,O=!!I&&this.mutatedKeys.has(I.key),U=!!P&&(P.hasLocalMutations||this.mutatedKeys.has(P.key)&&P.hasCommittedMutations);let M=!1;I&&P?I.data.isEqual(P.data)?O!==U&&(r.track({type:3,doc:P}),M=!0):this.ha(I,P)||(r.track({type:2,doc:P}),M=!0,(d&&this._a(P,d)>0||f&&this._a(P,f)<0)&&(h=!0)):!I&&P?(r.track({type:0,doc:P}),M=!0):I&&!P&&(r.track({type:1,doc:I}),M=!0,(d||f)&&(h=!0)),M&&(P?(o=o.add(P),s=U?s.add(m):s.delete(m)):(o=o.delete(m),s=s.delete(m)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const m="F"===this.query.limitType?o.last():o.first();o=o.delete(m.key),s=s.delete(m.key),r.track({type:1,doc:m})}return{aa:o,la:r,Zi:h,mutatedKeys:s}}ha(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const i=this.aa;this.aa=e.aa,this.mutatedKeys=e.mutatedKeys;const s=e.la.L_();s.sort((f,m)=>function(I,P){const O=U=>{switch(U){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return G()}};return O(I)-O(P)}(f.type,m.type)||this._a(f.doc,m.doc)),this.Pa(r);const o=t?this.Ia():[],h=0===this.oa.size&&this.current?1:0,d=h!==this.sa;return this.sa=h,0!==s.length||d?{snapshot:new Qo(this.query,e.aa,i,s,e.mutatedKeys,0===h,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ta:o}:{Ta:o}}Q_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({aa:this.aa,la:new _m,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{Ta:[]}}Ea(e){return!this.ia.has(e)&&!!this.aa.has(e)&&!this.aa.get(e).hasLocalMutations}Pa(e){e&&(e.addedDocuments.forEach(t=>this.ia=this.ia.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.ia=this.ia.delete(t)),this.current=e.current)}Ia(){if(!this.current)return[];const e=this.oa;this.oa=ie(),this.aa.forEach(r=>{this.Ea(r.key)&&(this.oa=this.oa.add(r.key))});const t=[];return e.forEach(r=>{this.oa.has(r)||t.push(new Em(r))}),this.oa.forEach(r=>{e.has(r)||t.push(new vm(r))}),t}da(e){this.ia=e.ls,this.oa=ie();const t=this.ca(e.documents);return this.applyChanges(t,!0)}Aa(){return Qo.fromInitialDocuments(this.query,this.aa,this.mutatedKeys,0===this.sa,this.hasCachedResults)}}class cy{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class hy{constructor(e){this.key=e,this.Ra=!1}}class dy{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Va={},this.ma=new Ar(h=>Of(h),su),this.fa=new Map,this.ga=new Set,this.pa=new Se(W.comparator),this.ya=new Map,this.wa=new zh,this.Sa={},this.ba=new Map,this.Da=hs.Nn(),this.onlineState="Unknown",this.Ca=void 0}get isPrimaryClient(){return!0===this.Ca}}function fy(n,e){return bd.apply(this,arguments)}function bd(){return bd=(0,g.Z)(function*(n,e){const t=Jd(n);let r,i;const s=t.ma.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.Aa();else{const o=yield Wo(t.localStore,vt(e)),h=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=yield xd(t,e,r,"current"===h,o.resumeToken),t.isPrimaryClient&&mc(t.remoteStore,o)}return i}),bd.apply(this,arguments)}function xd(n,e,t,r,i){return Dd.apply(this,arguments)}function Dd(){return Dd=(0,g.Z)(function*(n,e,t,r,i){n.va=(y,I,P)=>{return(O=(0,g.Z)(function*(M,Z,J,Y){let H=Z.view.ca(J);H.Zi&&(H=yield cc(M.localStore,Z.query,!1).then(({documents:ot})=>Z.view.ca(ot,H)));const se=Y&&Y.targetChanges.get(Z.targetId),re=Z.view.applyChanges(H,M.isPrimaryClient,se);return qd(M,Z.targetId,re.Ta),re.snapshot}),function U(M,Z,J,Y){return O.apply(this,arguments)})(n,y,I,P);var O};const s=yield cc(n.localStore,e,!0),o=new Tm(e,s.ls),h=o.ca(s.documents),d=fu.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),f=o.applyChanges(h,n.isPrimaryClient,d);qd(n,t,f.Ta);const m=new cy(e,t,o);return n.ma.set(e,m),n.fa.has(t)?n.fa.get(t).push(e):n.fa.set(t,[e]),f.snapshot}),Dd.apply(this,arguments)}function py(n,e){return Nd.apply(this,arguments)}function Nd(){return Nd=(0,g.Z)(function*(n,e){const t=B(n),r=t.ma.get(e),i=t.fa.get(r.targetId);if(i.length>1)return t.fa.set(r.targetId,i.filter(s=>!su(s,e))),void t.ma.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield Go(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),Pu(t.remoteStore,r.targetId),Yo(t,r.targetId)}).catch(sn))):(Yo(t,r.targetId),yield Go(t.localStore,r.targetId,!0))}),Nd.apply(this,arguments)}function Vd(){return Vd=(0,g.Z)(function*(n,e,t){const r=Xd(n);try{const i=yield function(o,h){const d=B(o),f=Pe.now(),m=h.reduce((P,O)=>P.add(O.key),ie());let y,I;return d.persistence.runTransaction("Locally write mutations","readwrite",P=>{let O=Gt(),U=ie();return d.ss.getEntries(P,m).next(M=>{O=M,O.forEach((Z,J)=>{J.isValidDocument()||(U=U.add(Z))})}).next(()=>d.localDocuments.getOverlayedDocuments(P,O)).next(M=>{y=M;const Z=[];for(const J of h){const Y=Gg(J,y.get(J.key).overlayedDocument);null!=Y&&Z.push(new wr(J.key,Y,Eh(Y.value.mapValue),qe.exists(!0)))}return d.mutationQueue.addMutationBatch(P,f,Z,h)}).next(M=>{I=M;const Z=M.applyToLocalDocumentSet(y,U);return d.documentOverlayCache.saveOverlays(P,M.batchId,Z)})}).then(()=>({batchId:I.batchId,changes:Uf(y)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,h,d){let f=o.Sa[o.currentUser.toKey()];f||(f=new Se(ee)),f=f.insert(h,d),o.Sa[o.currentUser.toKey()]=f}(r,i.batchId,t),yield Pr(r,i.changes),yield Ko(r.remoteStore)}catch(i){const s=jo(i,"Failed to persist write");t.reject(s)}}),Vd.apply(this,arguments)}function Am(n,e){return kd.apply(this,arguments)}function kd(){return kd=(0,g.Z)(function*(n,e){const t=B(n);try{const r=yield function O_(n,e){const t=B(n),r=e.snapshotVersion;let i=t.ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.ss.newChangeBuffer({trackRemovals:!0});i=t.ts;const h=[];e.targetChanges.forEach((m,y)=>{const I=i.get(y);if(!I)return;h.push(t.qr.removeMatchingKeys(s,m.removedDocuments,y).next(()=>t.qr.addMatchingKeys(s,m.addedDocuments,y)));let P=I.withSequenceNumber(s.currentSequenceNumber);var U,M,Z;null!==e.targetMismatches.get(y)?P=P.withResumeToken(Je.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):m.resumeToken.approximateByteSize()>0&&(P=P.withResumeToken(m.resumeToken,r)),i=i.insert(y,P),M=P,Z=m,(0===(U=I).resumeToken.approximateByteSize()||M.snapshotVersion.toMicroseconds()-U.snapshotVersion.toMicroseconds()>=3e8||Z.addedDocuments.size+Z.modifiedDocuments.size+Z.removedDocuments.size>0)&&h.push(t.qr.updateTargetData(s,P))});let d=Gt(),f=ie();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&h.push(t.persistence.referenceDelegate.updateLimboDocument(s,m))}),h.push(tm(s,o,e.documentUpdates).next(m=>{d=m.us,f=m.cs})),!r.isEqual(j.min())){const m=t.qr.getLastRemoteSnapshotVersion(s).next(y=>t.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));h.push(m)}return w.waitFor(h).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,d,f)).next(()=>d)}).then(s=>(t.ts=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.ya.get(s);o&&(K(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.Ra=!0:i.modifiedDocuments.size>0?K(o.Ra):i.removedDocuments.size>0&&(K(o.Ra),o.Ra=!1))}),yield Pr(t,r,e)}catch(r){yield sn(r)}}),kd.apply(this,arguments)}function wm(n,e,t){const r=B(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.ma.forEach((s,o)=>{const h=o.view.Q_(e);h.snapshot&&i.push(h.snapshot)}),function(o,h){const d=B(o);d.onlineState=h;let f=!1;d.queries.forEach((m,y)=>{for(const I of y.listeners)I.Q_(h)&&(f=!0)}),f&&Sd(d)}(r.eventManager,e),i.length&&r.Va.a_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function gy(n,e,t){return Od.apply(this,arguments)}function Od(){return Od=(0,g.Z)(function*(n,e,t){const r=B(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.ya.get(e),s=i&&i.key;if(s){let o=new Se(W.comparator);o=o.insert(s,Ce.newNoDocument(s,j.min()));const h=ie().add(s),d=new du(j.min(),new Map,new Se(ee),o,h);yield Am(r,d),r.pa=r.pa.remove(s),r.ya.delete(e),zd(r)}else yield Go(r.localStore,e,!1).then(()=>Yo(r,e,t)).catch(sn)}),Od.apply(this,arguments)}function _y(n,e){return Ld.apply(this,arguments)}function Ld(){return Ld=(0,g.Z)(function*(n,e){const t=B(n),r=e.batch.batchId;try{const i=yield function k_(n,e){const t=B(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.ss.newChangeBuffer({trackRemovals:!0});return function(h,d,f,m){const y=f.batch,I=y.keys();let P=w.resolve();return I.forEach(O=>{P=P.next(()=>m.getEntry(d,O)).next(U=>{const M=f.docVersions.get(O);K(null!==M),U.version.compareTo(M)<0&&(y.applyToRemoteDocument(U,f),U.isValidDocument()&&(U.setReadTime(f.commitVersion),m.addEntry(U)))})}),P.next(()=>h.mutationQueue.removeMutationBatch(d,y))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(h){let d=ie();for(let f=0;f<h.mutationResults.length;++f)h.mutationResults[f].transformResults.length>0&&(d=d.add(h.batch.mutations[f].key));return d}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(t.localStore,e);Bd(t,r,null),Ud(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Pr(t,i)}catch(i){yield sn(i)}}),Ld.apply(this,arguments)}function yy(n,e,t){return Md.apply(this,arguments)}function Md(){return Md=(0,g.Z)(function*(n,e,t){const r=B(n);try{const i=yield function(o,h){const d=B(o);return d.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let m;return d.mutationQueue.lookupMutationBatch(f,h).next(y=>(K(null!==y),m=y.keys(),d.mutationQueue.removeMutationBatch(f,y))).next(()=>d.mutationQueue.performConsistencyCheck(f)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(f,m,h)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m)).next(()=>d.localDocuments.getDocuments(f,m))})}(r.localStore,e);Bd(r,e,t),Ud(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Pr(r,i)}catch(i){yield sn(i)}}),Md.apply(this,arguments)}function Fd(){return Fd=(0,g.Z)(function*(n,e){const t=B(n);hi(t.remoteStore)||V("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(o){const h=B(o);return h.persistence.runTransaction("Get highest unacknowledged batch id","readonly",d=>h.mutationQueue.getHighestUnacknowledgedBatchId(d))}(t.localStore);if(-1===r)return void e.resolve();const i=t.ba.get(r)||[];i.push(e),t.ba.set(r,i)}catch(r){const i=jo(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),Fd.apply(this,arguments)}function Ud(n,e){(n.ba.get(e)||[]).forEach(t=>{t.resolve()}),n.ba.delete(e)}function Bd(n,e,t){const r=B(n);let i=r.Sa[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Sa[r.currentUser.toKey()]=i}}function Yo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.fa.get(e))n.ma.delete(r),t&&n.Va.Fa(r,t);n.fa.delete(e),n.isPrimaryClient&&n.wa.Rr(e).forEach(r=>{n.wa.containsKey(r)||Rm(n,r)})}function Rm(n,e){n.ga.delete(e.path.canonicalString());const t=n.pa.get(e);null!==t&&(Pu(n.remoteStore,t),n.pa=n.pa.remove(e),n.ya.delete(t),zd(n))}function qd(n,e,t){for(const r of t)r instanceof vm?(n.wa.addReference(r.key,e),vy(n,r)):r instanceof Em?(V("SyncEngine","Document no longer in limbo: "+r.key),n.wa.removeReference(r.key,e),n.wa.containsKey(r.key)||Rm(n,r.key)):G()}function vy(n,e){const t=e.key,r=t.path.canonicalString();n.pa.get(t)||n.ga.has(r)||(V("SyncEngine","New document in limbo: "+t),n.ga.add(r),zd(n))}function zd(n){for(;n.ga.size>0&&n.pa.size<n.maxConcurrentLimboResolutions;){const e=n.ga.values().next().value;n.ga.delete(e);const t=new W(me.fromString(e)),r=n.Da.next();n.ya.set(r,new hy(t)),n.pa=n.pa.insert(t,r),mc(n.remoteStore,new Rr(vt(Zn(t.path)),r,"TargetPurposeLimboResolution",Ot._e))}}function Pr(n,e,t){return Wd.apply(this,arguments)}function Wd(){return Wd=(0,g.Z)(function*(n,e,t){const r=B(n),i=[],s=[],o=[];var h;r.ma.isEmpty()||(r.ma.forEach((h,d)=>{o.push(r.va(d,e,t).then(f=>{if((f||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(d.targetId,f?.fromCache?"not-current":"current"),f){i.push(f);const m=Zh.Qi(d.targetId,f);s.push(m)}}))}),yield Promise.all(o),r.Va.a_(i),yield(h=(0,g.Z)(function*(f,m){const y=B(f);try{yield y.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>w.forEach(m,P=>w.forEach(P.ki,O=>y.persistence.referenceDelegate.addReference(I,P.targetId,O)).next(()=>w.forEach(P.qi,O=>y.persistence.referenceDelegate.removeReference(I,P.targetId,O)))))}catch(I){if(!on(I))throw I;V("LocalStore","Failed to update sequence numbers: "+I)}for(const I of m){const P=I.targetId;if(!I.fromCache){const O=y.ts.get(P),M=O.withLastLimboFreeSnapshotVersion(O.snapshotVersion);y.ts=y.ts.insert(P,M)}}}),function d(f,m){return h.apply(this,arguments)})(r.localStore,s))}),Wd.apply(this,arguments)}function Ey(n,e){return Gd.apply(this,arguments)}function Gd(){return Gd=(0,g.Z)(function*(n,e){const t=B(n);if(!t.currentUser.isEqual(e)){V("SyncEngine","User change. New user:",e.toKey());const r=yield Xp(t.localStore,e);t.currentUser=e,(s=t).ba.forEach(h=>{h.forEach(d=>{d.reject(new N(C.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.ba.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Pr(t,r._s)}var s}),Gd.apply(this,arguments)}function Ty(n,e){const t=B(n),r=t.ya.get(e);if(r&&r.Ra)return ie().add(r.key);{let i=ie();const s=t.fa.get(e);if(!s)return i;for(const o of s){const h=t.ma.get(o);i=i.unionWith(h.view.ua)}return i}}function Ay(n,e){return $d.apply(this,arguments)}function $d(){return $d=(0,g.Z)(function*(n,e){const t=B(n),r=yield cc(t.localStore,e.query,!0),i=e.view.da(r);return t.isPrimaryClient&&qd(t,e.targetId,i.Ta),i}),$d.apply(this,arguments)}function wy(n,e){return Kd.apply(this,arguments)}function Kd(){return Kd=(0,g.Z)(function*(n,e){const t=B(n);return rm(t.localStore,e).then(r=>Pr(t,r))}),Kd.apply(this,arguments)}function Ry(n,e,t,r){return Zd.apply(this,arguments)}function Zd(){return Zd=(0,g.Z)(function*(n,e,t,r){const i=B(n),s=yield function(h,d){const f=B(h),m=B(f.mutationQueue);return f.persistence.runTransaction("Lookup mutation documents","readonly",y=>m.Cn(y,d).next(I=>I?f.localDocuments.getDocuments(y,I):w.resolve(null)))}(i.localStore,e);var d;null!==s?("pending"===t?yield Ko(i.remoteStore):"acknowledged"===t||"rejected"===t?(Bd(i,e,r||null),Ud(i,e),d=e,B(B(i.localStore).mutationQueue).Fn(d)):G(),yield Pr(i,s)):V("SyncEngine","Cannot apply mutation batch with id: "+e)}),Zd.apply(this,arguments)}function jd(){return jd=(0,g.Z)(function*(n,e){const t=B(n);if(Jd(t),Xd(t),!0===e&&!0!==t.Ca){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Pm(t,r.toArray());t.Ca=!0,yield vd(t.remoteStore,!0);for(const s of i)mc(t.remoteStore,s)}else if(!1===e&&!1!==t.Ca){const r=[];let i=Promise.resolve();t.fa.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Yo(t,o),Go(t.localStore,o,!0))),Pu(t.remoteStore,o)}),yield i,yield Pm(t,r),function(o){const h=B(o);h.ya.forEach((d,f)=>{Pu(h.remoteStore,f)}),h.wa.Vr(),h.ya=new Map,h.pa=new Se(W.comparator)}(t),t.Ca=!1,yield vd(t.remoteStore,!1)}}),jd.apply(this,arguments)}function Pm(n,e,t){return Hd.apply(this,arguments)}function Hd(){return Hd=(0,g.Z)(function*(n,e,t){const r=B(n),i=[],s=[];for(const o of e){let h;const d=r.fa.get(o);if(d&&0!==d.length){h=yield Wo(r.localStore,vt(d[0]));for(const f of d){const m=r.ma.get(f),y=yield Ay(r,m);y.snapshot&&s.push(y.snapshot)}}else{const f=yield nm(r.localStore,o);h=yield Wo(r.localStore,f),yield xd(r,Sm(f),o,!1,h.resumeToken)}i.push(h)}return r.Va.a_(s),i}),Hd.apply(this,arguments)}function Sm(n){return nu(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Sy(n){return t=B(n).localStore,B(B(t).persistence).Bi();var t}function Cy(n,e,t,r){return Qd.apply(this,arguments)}function Qd(){return Qd=(0,g.Z)(function*(n,e,t,r){const i=B(n);if(i.Ca)return void V("SyncEngine","Ignoring unexpected query state notification.");const s=i.fa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const o=yield rm(i.localStore,Lf(s[0])),h=du.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,Je.EMPTY_BYTE_STRING);yield Pr(i,o,h);break}case"rejected":yield Go(i.localStore,e,!0),Yo(i,e,r);break;default:G()}}),Qd.apply(this,arguments)}function by(n,e,t){return Yd.apply(this,arguments)}function Yd(){return Yd=(0,g.Z)(function*(n,e,t){const r=Jd(n);if(r.Ca){for(const i of e){if(r.fa.has(i)){V("SyncEngine","Adding an already active target "+i);continue}const s=yield nm(r.localStore,i),o=yield Wo(r.localStore,s);yield xd(r,Sm(s),o.targetId,!1,o.resumeToken),mc(r.remoteStore,o)}for(const i of t)r.fa.has(i)&&(yield Go(r.localStore,i,!1).then(()=>{Pu(r.remoteStore,i),Yo(r,i)}).catch(sn))}}),Yd.apply(this,arguments)}function Jd(n){const e=B(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Am.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ty.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=gy.bind(null,e),e.Va.a_=oy.bind(null,e.eventManager),e.Va.Fa=ay.bind(null,e.eventManager),e}function Xd(n){const e=B(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=_y.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=yy.bind(null,e),e}class Su{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,g.Z)(function*(){t.serializer=wu(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Jp(this.persistence,new Yp,e.initialUser,this.serializer)}createPersistence(e){return new Wh(ac.jr,this.serializer)}createSharedClientState(e){return new am}terminate(){var e=this;return(0,g.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class ef extends Su{constructor(e,t,r){super(),this.xa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,g.Z)(function*(){yield t().call(r,e),yield r.xa.initialize(r,e),yield Xd(r.xa.syncEngine),yield Ko(r.xa.remoteStore),yield r.persistence.mi(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return Jp(this.persistence,new Yp,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new zp(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new lh(t,this.persistence);return new kl(e.asyncQueue,r)}createPersistence(e){const t=Kh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?bt.withCacheSize(this.cacheSizeBytes):bt.DEFAULT;return new $h(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,lm(),pc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new am}}class Cm extends ef{constructor(e,t){super(e,t,!1),this.xa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,g.Z)(function*(){yield t().call(r,e);const i=r.xa.syncEngine;r.sharedClientState instanceof td&&(r.sharedClientState.syncEngine={Ys:Ry.bind(null,i),Zs:Cy.bind(null,i),Xs:by.bind(null,i),Bi:Sy.bind(null,i),Js:wy.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.mi(function(){var s=(0,g.Z)(function*(o){yield function Py(n,e){return jd.apply(this,arguments)}(r.xa.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start():o||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(o&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():o||r.indexBackfillerScheduler.stop())});return function(o){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=lm();if(!td.D(t))throw new N(C.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Kh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new td(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Jo{initialize(e,t){var r=this;return(0,g.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>wm(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=Ey.bind(null,r.syncEngine),yield vd(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new sy}createDatastore(e){const t=wu(e.databaseInfo.databaseId),r=new z_(e.databaseInfo);return new $_(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return r=this.localStore,i=this.datastore,s=e.asyncQueue,o=t=>wm(this.syncEngine,t,0),h=um.D()?new um:new U_,new j_(r,i,s,o,h);var r,i,s,o,h}createSyncEngine(e,t){return function(i,s,o,h,d,f,m){const y=new dy(i,s,o,h,d,f);return m&&(y.Ca=!0),y}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,g.Z)(function*(r){const i=B(r);V("RemoteStore","RemoteStore shutting down."),i.C_.add(5),yield $o(i),i.F_.shutdown(),i.M_.set("Unknown")}),function t(r){return e.apply(this,arguments)})(this.remoteStore);var e}}function bm(n,e=10240){let t=0;return{read:()=>(0,g.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,g.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class _c{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Oa(this.observer.next,e)}error(e){this.observer.error?this.Oa(this.observer.error,e):We("Uncaught Error in snapshot listener:",e.toString())}Na(){this.muted=!0}Oa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Ny{constructor(e,t){this.Ba=e,this.serializer=t,this.metadata=new Ge,this.buffer=new Uint8Array,this.La=new TextDecoder("utf-8"),this.ka().then(r=>{r&&r.Z_()?this.metadata.resolve(r.Y_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(r?.Y_)}`))},r=>this.metadata.reject(r))}close(){return this.Ba.cancel()}getMetadata(){var e=this;return(0,g.Z)(function*(){return e.metadata.promise})()}Ma(){var e=this;return(0,g.Z)(function*(){return yield e.getMetadata(),e.ka()})()}ka(){var e=this;return(0,g.Z)(function*(){const t=yield e.qa();if(null===t)return null;const r=e.La.decode(t),i=Number(r);isNaN(i)&&e.Qa(`length string (${r}) is not valid number`);const s=yield e.Ka(i);return new uy(JSON.parse(s),t.length+i)})()}$a(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}qa(){var e=this;return(0,g.Z)(function*(){for(;e.$a()<0&&!(yield e.Ua()););if(0===e.buffer.length)return null;const t=e.$a();t<0&&e.Qa("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}Ka(e){var t=this;return(0,g.Z)(function*(){for(;t.buffer.length<e;)(yield t.Ua())&&t.Qa("Reached the end of bundle when more is expected.");const r=t.La.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Qa(e){throw this.Ba.cancel(),new Error(`Invalid bundle format: ${e}`)}Ua(){var e=this;return(0,g.Z)(function*(){const t=yield e.Ba.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class Vy{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,g.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new N(C.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(i=(0,g.Z)(function*(o,h){const d=B(o),f=mu(d.serializer)+"/documents",m={documents:h.map(O=>pu(d.serializer,O))},y=yield d.Co("BatchGetDocuments",f,m,h.length),I=new Map;y.forEach(O=>{const U=function e_(n,e){return"found"in e?function(r,i){K(!!i.found);const s=Qn(r,i.found.name),o=Xe(i.found.updateTime),h=i.found.createTime?Xe(i.found.createTime):j.min(),d=new lt({mapValue:{fields:i.found.fields}});return Ce.newFoundDocument(s,o,h,d)}(n,e):"missing"in e?function(r,i){K(!!i.missing),K(!!i.readTime);const s=Qn(r,i.missing),o=Xe(i.readTime);return Ce.newNoDocument(s,o)}(n,e):G()}(d.serializer,O);I.set(U.key.toString(),U)});const P=[];return h.forEach(O=>{const U=I.get(O.toString());K(!!U),P.push(U)}),P}),function s(o,h){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Lo(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,g.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=W.fromPath(i);e.mutations.push(new Rh(s,e.precondition(s)))}),yield(r=(0,g.Z)(function*(s,o){const h=B(s),d=mu(h.serializer)+"/documents",f={writes:o.map(m=>gu(h.serializer,m))};yield h.wo("Commit",d,f)}),function i(s,o){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw G();t=j.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new N(C.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(j.min())?qe.exists(!1):qe.updateTime(t):qe.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(j.min()))throw new N(C.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return qe.updateTime(t)}return qe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class ky{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Wa=r.maxAttempts,this.zo=new rd(this.asyncQueue,"transaction_retry")}run(){this.Wa-=1,this.Ga()}Ga(){var e=this;this.zo.ko((0,g.Z)(function*(){const t=new Vy(e.datastore),r=e.za(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.ja(s)}))}).catch(i=>{e.ja(i)})}))}za(e){try{const t=this.updateFunction(e);return!Er(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ja(e){this.Wa>0&&this.Ha(e)?(this.Wa-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ga(),Promise.resolve()))):this.deferred.reject(e)}Ha(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!ep(t)}return!1}}class Oy{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=rt.UNAUTHENTICATED,this.clientId=Cl.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,g.Z)(function*(h){V("FirestoreClient","Received user=",h.uid),yield s.authCredentialListener(h),s.user=h});return function(h){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(V("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}getConfiguration(){var e=this;return(0,g.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new N(C.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Ge;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,g.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=jo(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function yc(n,e){return tf.apply(this,arguments)}function tf(){return tf=(0,g.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),V("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,g.Z)(function*(s){r.isEqual(s)||(yield Xp(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),tf.apply(this,arguments)}function nf(n,e){return rf.apply(this,arguments)}function rf(){return rf=(0,g.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield sf(n);V("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(i=>gm(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>gm(e.remoteStore,s)),n._onlineComponents=e}),rf.apply(this,arguments)}function xm(n){return"FirebaseError"===n.name?n.code===C.FAILED_PRECONDITION||n.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function sf(n){return of.apply(this,arguments)}function of(){return of=(0,g.Z)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V("FirestoreClient","Using user provided OfflineComponentProvider");try{yield yc(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!xm(t))throw t;Pt("Error using user provided cache. Falling back to memory cache: "+t),yield yc(n,new Su)}}else V("FirestoreClient","Using default OfflineComponentProvider"),yield yc(n,new Su);return n._offlineComponents}),of.apply(this,arguments)}function Ic(n){return af.apply(this,arguments)}function af(){return af=(0,g.Z)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(V("FirestoreClient","Using user provided OnlineComponentProvider"),yield nf(n,n._uninitializedComponentsProvider._online)):(V("FirestoreClient","Using default OnlineComponentProvider"),yield nf(n,new Jo))),n._onlineComponents}),af.apply(this,arguments)}function Dm(n){return sf(n).then(e=>e.persistence)}function Xo(n){return sf(n).then(e=>e.localStore)}function Nm(n){return Ic(n).then(e=>e.remoteStore)}function uf(n){return Ic(n).then(e=>e.syncEngine)}function ea(n){return lf.apply(this,arguments)}function lf(){return lf=(0,g.Z)(function*(n){const e=yield Ic(n),t=e.eventManager;return t.onListen=fy.bind(null,e.syncEngine),t.onUnlisten=py.bind(null,e.syncEngine),t}),lf.apply(this,arguments)}function km(n,e,t={}){const r=new Ge;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return function(s,o,h,d,f){const m=new _c({next:I=>{o.enqueueAndForget(()=>Rd(s,y));const P=I.docs.has(h);!P&&I.fromCache?f.reject(new N(C.UNAVAILABLE,"Failed to get document because the client is offline.")):P&&I.fromCache&&d&&"server"===d.source?f.reject(new N(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(I)},error:I=>f.reject(I)}),y=new Cd(Zn(h.path),m,{includeMetadataChanges:!0,J_:!0});return Ad(s,y)}(yield ea(n),n.asyncQueue,e,t,r)})),r.promise}function Om(n,e,t={}){const r=new Ge;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return function(s,o,h,d,f){const m=new _c({next:I=>{o.enqueueAndForget(()=>Rd(s,y)),I.fromCache&&"server"===d.source?f.reject(new N(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(I)},error:I=>f.reject(I)}),y=new Cd(h,m,{includeMetadataChanges:!0,J_:!0});return Ad(s,y)}(yield ea(n),n.asyncQueue,e,t,r)})),r.promise}function Lm(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const Mm=new Map;function cf(n,e,t){if(!t)throw new N(C.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Fm(n,e,t,r){if(!0===e&&!0===r)throw new N(C.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Um(n){if(!W.isDocumentKey(n))throw new N(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Bm(n){if(W.isDocumentKey(n))throw new N(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function vc(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(r=n).constructor?r.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var r;return"function"==typeof n?"a function":G()}function fe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new N(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=vc(n);throw new N(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function qm(n,e){if(e<=0)throw new N(C.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class zm{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new N(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new N(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Fm("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Lm(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new N(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new N(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new N(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Cu{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new zm({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new N(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new N(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new zm(e),void 0!==e.credentials&&(this._authCredentials=function(r){if(!r)return new Ua;switch(r.type){case"firstParty":return new rh(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new N(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=Mm.get(t);r&&(V("ComponentProvider","Removing Datastore"),Mm.delete(t),r.terminate())}(this),Promise.resolve()}}function Wm(n,e,t,r={}){var i;const s=(n=fe(n,Cu))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Pt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let h,d;if("string"==typeof r.mockUserToken)h=r.mockUserToken,d=rt.MOCK_USER;else{h=(0,Ie.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new N(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new rt(f)}n._authCredentials=new nh(new Fa(h,d))}}class Et{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Et(this.firestore,e,this._query)}}class Ue{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Yn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ue(this.firestore,e,this._key)}}class Yn extends Et{constructor(e,t,r){super(e,t,Zn(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ue(this.firestore,null,new W(e))}withConverter(e){return new Yn(this.firestore,e,this._path)}}function Gm(n,e,...t){if(n=(0,Ie.m9)(n),cf("collection","path",e),n instanceof Cu){const r=me.fromString(e,...t);return Bm(r),new Yn(n,null,r)}{if(!(n instanceof Ue||n instanceof Yn))throw new N(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(me.fromString(e,...t));return Bm(r),new Yn(n.firestore,null,r)}}function bu(n,e,...t){if(n=(0,Ie.m9)(n),1===arguments.length&&(e=Cl.newId()),cf("doc","path",e),n instanceof Cu){const r=me.fromString(e,...t);return Um(r),new Ue(n,null,new W(r))}{if(!(n instanceof Ue||n instanceof Yn))throw new N(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(me.fromString(e,...t));return Um(r),new Ue(n.firestore,n instanceof Yn?n.converter:null,new W(r))}}function $m(n,e){return n=(0,Ie.m9)(n),e=(0,Ie.m9)(e),(n instanceof Ue||n instanceof Yn)&&(e instanceof Ue||e instanceof Yn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function hf(n,e){return n=(0,Ie.m9)(n),e=(0,Ie.m9)(e),n instanceof Et&&e instanceof Et&&n.firestore===e.firestore&&su(n._query,e._query)&&n.converter===e.converter}class Zy{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new rd(this,"async_queue_retry"),this.iu=()=>{const t=pc();t&&V("AsyncQueue","Visibility state changed to "+t.visibilityState),this.zo.Qo()};const e=pc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.su(),this.ou(e)}enterRestrictedMode(e){if(!this.Za){this.Za=!0,this.nu=e||!1;const t=pc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.iu)}}enqueue(e){if(this.su(),this.Za)return new Promise(()=>{});const t=new Ge;return this.ou(()=>this.Za&&this.nu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ya.push(e),this._u()))}_u(){var e=this;return(0,g.Z)(function*(){if(0!==e.Ya.length){try{yield e.Ya[0](),e.Ya.shift(),e.zo.reset()}catch(t){if(!on(t))throw t;V("AsyncQueue","Operation failed with retryable error: "+t)}e.Ya.length>0&&e.zo.ko(()=>e._u())}})()}ou(e){const t=this.Ja.then(()=>(this.tu=!0,e().catch(r=>{throw this.eu=r,this.tu=!1,We("INTERNAL UNHANDLED ERROR: ",function(o){let h=o.message||"";return o.stack&&(h=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),h}(r)),r}).then(r=>(this.tu=!1,r))));return this.Ja=t,t}enqueueAfterDelay(e,t,r){this.su(),this.ru.indexOf(e)>-1&&(t=0);const i=Td.createAndSchedule(this,e,t,r,s=>this.au(s));return this.Xa.push(i),i}su(){this.eu&&G()}verifyOperationInProgress(){}uu(){var e=this;return(0,g.Z)(function*(){let t;do{t=e.Ja,yield t}while(t!==e.Ja)})()}cu(e){for(const t of this.Xa)if(t.timerId===e)return!0;return!1}lu(e){return this.uu().then(()=>{this.Xa.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Xa)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.uu()})}hu(e){this.ru.push(e)}au(e){const t=this.Xa.indexOf(e);this.Xa.splice(t,1)}}function df(n){return function(t,r){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(n)}class jy{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ge,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Me extends Cu{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Zy,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Km(this),this._firestoreClient.terminate()}}function Qy(n,e){const t="object"==typeof n?n:(0,Vn.getApp)(),r="string"==typeof n?n:e||"(default)",i=(0,Vn._getProvider)(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=(0,Ie.P0)("firestore");s&&Wm(i,...s)}return i}function je(n){return n._firestoreClient||Km(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Km(n){var e,t,r;const i=n._freezeSettings(),s=(d=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Ih(n._databaseId,d,n._persistenceKey,(m=i).host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,Lm(m.experimentalLongPollingOptions),m.useFetchStreams));var d,m;n._firestoreClient=new Oy(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Zm(n,e,t){const r=new Ge;return n.asyncQueue.enqueue((0,g.Z)(function*(){try{yield yc(n,t),yield nf(n,e),r.resolve()}catch(i){const s=i;if(!xm(s))throw s;Pt("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function jm(n){if(n._initialized||n._terminated)throw new N(C.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Jn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Jn(Je.fromBase64String(e))}catch(t){throw new N(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Jn(Je.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Sr{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new N(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ke(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class fs{constructor(e){this._methodName=e}}class Ec{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new N(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new N(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ee(this._lat,e._lat)||ee(this._long,e._long)}}const oI=/^__.*__$/;class aI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new wr(e,this.data,this.fieldMask,t,this.fieldTransforms):new Oo(e,this.data,t,this.fieldTransforms)}}class Hm{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new wr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Qm(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw G()}}class Tc{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.Pu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Iu(){return this.settings.Iu}Tu(e){return new Tc(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Eu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Tu({path:r,du:!1});return i.Au(e),i}Ru(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Tu({path:r,du:!1});return i.Pu(),i}Vu(e){return this.Tu({path:void 0,du:!0})}mu(e){return Rc(e,this.settings.methodName,this.settings.fu||!1,this.path,this.settings.gu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Pu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Au(this.path.get(e))}Au(e){if(0===e.length)throw this.mu("Document fields must not be empty");if(Qm(this.Iu)&&oI.test(e))throw this.mu('Document fields cannot begin and end with "__"')}}class uI{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||wu(e)}pu(e,t,r,i=!1){return new Tc({Iu:e,methodName:t,gu:r,path:ke.emptyPath(),du:!1,fu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ps(n){const e=n._freezeSettings(),t=wu(n._databaseId);return new uI(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Ac(n,e,t,r,i,s={}){const o=n.pu(s.merge||s.mergeFields?2:0,e,t,i);gf("Data must be an object, but it was:",o,r);const h=Xm(r,o);let d,f;if(s.merge)d=new St(o.fieldMask),f=o.fieldTransforms;else if(s.mergeFields){const m=[];for(const y of s.mergeFields){const I=Nu(e,y,t);if(!o.contains(I))throw new N(C.INVALID_ARGUMENT,`Field '${I}' is specified in your field mask but missing from your input data.`);tg(m,I)||m.push(I)}d=new St(m),f=o.fieldTransforms.filter(y=>d.covers(y.field))}else d=null,f=o.fieldTransforms;return new aI(new lt(h),d,f)}class Du extends fs{_toFieldTransform(e){if(2!==e.Iu)throw e.mu(1===e.Iu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Du}}function Ym(n,e,t){return new Tc({Iu:3,gu:e.settings.gu,methodName:n._methodName,du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class ff extends fs{_toFieldTransform(e){return new lu(e.path,new Vo)}isEqual(e){return e instanceof ff}}class lI extends fs{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=Ym(this,e,!0),r=this.yu.map(s=>ms(s,t)),i=new is(r);return new lu(e.path,i)}isEqual(e){return this===e}}class cI extends fs{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=Ym(this,e,!0),r=this.yu.map(s=>ms(s,t)),i=new ss(r);return new lu(e.path,i)}isEqual(e){return this===e}}class hI extends fs{constructor(e,t){super(e),this.wu=t}_toFieldTransform(e){const t=new ko(e.serializer,Wf(e.serializer,this.wu));return new lu(e.path,t)}isEqual(e){return this===e}}function pf(n,e,t,r){const i=n.pu(1,e,t);gf("Data must be an object, but it was:",i,r);const s=[],o=lt.empty();Pn(r,(d,f)=>{const m=wc(e,d,t);f=(0,Ie.m9)(f);const y=i.Ru(m);if(f instanceof Du)s.push(m);else{const I=ms(f,y);null!=I&&(s.push(m),o.set(m,I))}});const h=new St(s);return new Hm(o,h,i.fieldTransforms)}function mf(n,e,t,r,i,s){const o=n.pu(1,e,t),h=[Nu(e,r,t)],d=[i];if(s.length%2!=0)throw new N(C.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let I=0;I<s.length;I+=2)h.push(Nu(e,s[I])),d.push(s[I+1]);const f=[],m=lt.empty();for(let I=h.length-1;I>=0;--I)if(!tg(f,h[I])){const P=h[I];let O=d[I];O=(0,Ie.m9)(O);const U=o.Ru(P);if(O instanceof Du)f.push(P);else{const M=ms(O,U);null!=M&&(f.push(P),m.set(P,M))}}const y=new St(f);return new Hm(m,y,o.fieldTransforms)}function Jm(n,e,t,r=!1){return ms(t,n.pu(r?4:3,e))}function ms(n,e){if(eg(n=(0,Ie.m9)(n)))return gf("Unsupported field value:",e,n),Xm(n,e);if(n instanceof fs)return function(r,i){if(!Qm(i.Iu))throw i.mu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.mu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.du&&4!==e.Iu)throw e.mu("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const h of r){let d=ms(h,i.Vu(o));null==d&&(d={nullValue:"NULL_VALUE"}),s.push(d),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if(null===(r=(0,Ie.m9)(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return Wf(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=Pe.fromDate(r);return{timestampValue:Mo(i.serializer,s)}}if(r instanceof Pe){const s=new Pe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Mo(i.serializer,s)}}if(r instanceof Ec)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Jn)return{bytesValue:cp(i.serializer,r._byteString)};if(r instanceof Ue){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Dh(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.mu(`Unsupported field value: ${vc(r)}`)}(n,e)}function Xm(n,e){const t={};return Ya(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Pn(n,(r,i)=>{const s=ms(i,e.Eu(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function eg(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof Pe||n instanceof Ec||n instanceof Jn||n instanceof Ue||n instanceof fs)}function gf(n,e,t){if(!eg(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const r=vc(t);throw e.mu("an object"===r?n+" a custom object":n+" "+r)}var i}function Nu(n,e,t){if((e=(0,Ie.m9)(e))instanceof Sr)return e._internalPath;if("string"==typeof e)return wc(n,e);throw Rc("Field path arguments must be of type string or ",n,!1,void 0,t)}const dI=new RegExp("[~\\*/\\[\\]]");function wc(n,e,t){if(e.search(dI)>=0)throw Rc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Sr(...e.split("."))._internalPath}catch{throw Rc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Rc(n,e,t,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let h=`Function ${e}() called with invalid data`;t&&(h+=" (via `toFirestore()`)"),h+=". ";let d="";return(s||o)&&(d+=" (found",s&&(d+=` in field ${r}`),o&&(d+=` in document ${i}`),d+=")"),new N(C.INVALID_ARGUMENT,h+n+d)}function tg(n,e){return n.some(t=>t.isEqual(e))}class Vu{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ue(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new fI(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Pc("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class fI extends Vu{data(){return super.data()}}function Pc(n,e){return"string"==typeof e?wc(n,e):e instanceof Sr?e._internalPath:e._delegate._internalPath}function ng(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new N(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class _f{}class ku extends _f{}function fi(n,e,...t){let r=[];e instanceof _f&&r.push(e),r=r.concat(t),function(s){const o=s.filter(d=>d instanceof ta).length,h=s.filter(d=>d instanceof Ou).length;if(o>1||o>0&&h>0)throw new N(C.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class Ou extends ku{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Ou(e,t,r)}_apply(e){const t=this._parse(e);return og(e._query,t),new Et(e.firestore,e.converter,Ah(e._query,t))}_parse(e){const t=ps(e.firestore);return function(s,o,h,d,f,m,y){let I;if(f.isKeyField()){if("array-contains"===m||"array-contains-any"===m)throw new N(C.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if("in"===m||"not-in"===m){sg(y,m);const P=[];for(const O of y)P.push(ig(d,s,O));I={arrayValue:{values:P}}}else I=ig(d,s,y)}else"in"!==m&&"not-in"!==m&&"array-contains-any"!==m||sg(y,m),I=Jm(h,"where",y,"in"===m||"not-in"===m);return ce.create(f,m,I)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class ta extends _f{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ta(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:Te.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let o=i;const h=s.getFlattenedFilters();for(const d of h)og(o,d),o=Ah(o,d)}(e._query,t),new Et(e.firestore,e.converter,Ah(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class yf extends ku{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new yf(e,t)}_apply(e){const t=function(i,s,o){if(null!==i.startAt)throw new N(C.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new N(C.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ri(s,o)}(e._query,this._field,this._direction);return new Et(e.firestore,e.converter,function(i,s){const o=i.explicitOrderBy.concat([s]);return new dn(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class Sc extends ku{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Sc(e,t,r)}_apply(e){return new Et(e.firestore,e.converter,jl(e._query,this._limit,this._limitType))}}class Cc extends ku{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Cc(e,t,r)}_apply(e){const t=rg(e,this.type,this._docOrFields,this._inclusive);return new Et(e.firestore,e.converter,(s=t,new dn((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class bc extends ku{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new bc(e,t,r)}_apply(e){const t=rg(e,this.type,this._docOrFields,this._inclusive);return new Et(e.firestore,e.converter,(s=t,new dn((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function rg(n,e,t,r){if(t[0]=(0,Ie.m9)(t[0]),t[0]instanceof Vu)return function(s,o,h,d,f){if(!d)throw new N(C.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${h}().`);const m=[];for(const y of jn(s))if(y.field.isKeyField())m.push(Tr(o,d.key));else{const I=d.data.field(y.field);if(To(I))throw new N(C.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+y.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===I){const P=y.field.canonicalString();throw new N(C.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${P}' (used as the orderBy) does not exist.`)}m.push(I)}return new Cn(m,f)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=ps(n.firestore);return function(o,h,d,f,m,y){const I=o.explicitOrderBy;if(m.length>I.length)throw new N(C.INVALID_ARGUMENT,`Too many arguments provided to ${f}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const P=[];for(let O=0;O<m.length;O++){const U=m[O];if(I[O].field.isKeyField()){if("string"!=typeof U)throw new N(C.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${f}(), but got a ${typeof U}`);if(!iu(o)&&-1!==U.indexOf("/"))throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${f}() must be a plain document ID, but '${U}' contains a slash.`);const M=o.path.child(me.fromString(U));if(!W.isDocumentKey(M))throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${f}() must result in a valid document path, but '${M}' is not because it contains an odd number of segments.`);const Z=new W(M);P.push(Tr(h,Z))}else{const M=Jm(d,f,U);P.push(M)}}return new Cn(P,y)}(n._query,n.firestore._databaseId,i,e,t,r)}}function ig(n,e,t){if("string"==typeof(t=(0,Ie.m9)(t))){if(""===t)throw new N(C.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!iu(e)&&-1!==t.indexOf("/"))throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(me.fromString(t));if(!W.isDocumentKey(r))throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Tr(n,new W(r))}if(t instanceof Ue)return Tr(n,t._key);throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${vc(t)}.`)}function sg(n,e){if(!Array.isArray(n)||0===n.length)throw new N(C.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function og(n,e){const t=function(i,s){for(const o of i)for(const h of o.getFlattenedFilters())if(s.indexOf(h.op)>=0)return h.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new N(C.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class If{convertValue(e,t="none"){switch(un(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Oe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Sn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw G()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Pn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Ec(Oe(e.latitude),Oe(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Ao(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Ji(e));default:return null}}convertTimestamp(e){const t=Wn(e);return new Pe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=me.fromString(e);K(vp(r));const i=new Gn(r.get(1),r.get(3)),s=new W(r.popFirst(5));return i.isEqual(t)||We(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function xc(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class TI extends If{constructor(e){super(),this.firestore=e}convertBytes(e){return new Jn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ue(this.firestore,null,t)}}class gs{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Cr extends Vu{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Lu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Pc("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Lu extends Cr{data(e={}){return super.data(e)}}class pi{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new gs(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Lu(this._firestore,this._userDataWriter,r.key,r,new gs(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new N(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(h=>({type:"added",doc:new Lu(i._firestore,i._userDataWriter,h.doc.key,h.doc,new gs(i._snapshot.mutatedKeys.has(h.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:o++}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(h=>s||3!==h.type).map(h=>{const d=new Lu(i._firestore,i._userDataWriter,h.doc.key,h.doc,new gs(i._snapshot.mutatedKeys.has(h.doc.key),i._snapshot.fromCache),i.query.converter);let f=-1,m=-1;return 0!==h.type&&(f=o.indexOf(h.doc.key),o=o.delete(h.doc.key)),1!==h.type&&(o=o.add(h.doc),m=o.indexOf(h.doc.key)),{type:wI(h.type),doc:d,oldIndex:f,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function wI(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return G()}}function ug(n,e){return n instanceof Cr&&e instanceof Cr?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof pi&&e instanceof pi&&n._firestore===e._firestore&&hf(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function lg(n){n=fe(n,Ue);const e=fe(n.firestore,Me);return km(je(e),n._key).then(t=>Ef(e,n,t))}class mi extends If{constructor(e){super(),this.firestore=e}convertBytes(e){return new Jn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ue(this.firestore,null,t)}}function vf(n,e,t){n=fe(n,Ue);const r=fe(n.firestore,Me),i=xc(n.converter,e,t);return na(r,[Ac(ps(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,qe.none())])}function cg(n,e,t,...r){n=fe(n,Ue);const i=fe(n.firestore,Me),s=ps(i);let o;return o="string"==typeof(e=(0,Ie.m9)(e))||e instanceof Sr?mf(s,"updateDoc",n._key,e,t,r):pf(s,"updateDoc",n._key,e),na(i,[o.toMutation(n._key,qe.exists(!0))])}function hg(n,...e){var t,r,i;n=(0,Ie.m9)(n);let s={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||df(e[o])||(s=e[o],o++);const h={includeMetadataChanges:s.includeMetadataChanges};if(df(e[o])){const y=e[o];e[o]=null===(t=y.next)||void 0===t?void 0:t.bind(y),e[o+1]=null===(r=y.error)||void 0===r?void 0:r.bind(y),e[o+2]=null===(i=y.complete)||void 0===i?void 0:i.bind(y)}let d,f,m;if(n instanceof Ue)f=fe(n.firestore,Me),m=Zn(n._key.path),d={next:y=>{e[o]&&e[o](Ef(f,n,y))},error:e[o+1],complete:e[o+2]};else{const y=fe(n,Et);f=fe(y.firestore,Me),m=y._query;const I=new mi(f);d={next:P=>{e[o]&&e[o](new pi(f,I,y,P))},error:e[o+1],complete:e[o+2]},ng(n._query)}return function(I,P,O,U){const M=new _c(U),Z=new Cd(P,M,O);return I.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return Ad(yield ea(I),Z)})),()=>{M.Na(),I.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return Rd(yield ea(I),Z)}))}}(je(f),m,h,d)}function na(n,e){return function(r,i){const s=new Ge;return r.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return function my(n,e,t){return Vd.apply(this,arguments)}(yield uf(r),i,s)})),s.promise}(je(n),e)}function Ef(n,e,t){const r=t.docs.get(e._key),i=new mi(n);return new Cr(n,i,e._key,r,new gs(t.hasPendingWrites,t.fromCache),e.converter)}const qI={maxAttempts:5};class dg{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ps(e)}set(e,t,r){this._verifyNotCommitted();const i=gi(e,this._firestore),s=xc(i.converter,t,r),o=Ac(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(o.toMutation(i._key,qe.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=gi(e,this._firestore);let o;return o="string"==typeof(t=(0,Ie.m9)(t))||t instanceof Sr?mf(this._dataReader,"WriteBatch.update",s._key,t,r,i):pf(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,qe.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=gi(e,this._firestore);return this._mutations=this._mutations.concat(new Lo(t._key,qe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new N(C.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function gi(n,e){if((n=(0,Ie.m9)(n)).firestore!==e)throw new N(C.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class zI extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=ps(t)}get(t){const r=gi(t,this._firestore),i=new TI(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||1!==s.length)return G();const o=s[0];if(o.isFoundDocument())return new Vu(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Vu(this._firestore,i,r._key,null,r.converter);throw G()})}set(t,r,i){const s=gi(t,this._firestore),o=xc(s.converter,r,i),h=Ac(this._dataReader,"Transaction.set",s._key,o,null!==s.converter,i);return this._transaction.set(s._key,h),this}update(t,r,i,...s){const o=gi(t,this._firestore);let h;return h="string"==typeof(r=(0,Ie.m9)(r))||r instanceof Sr?mf(this._dataReader,"Transaction.update",o._key,r,i,s):pf(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,h),this}delete(t){const r=gi(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=gi(e,this._firestore),r=new mi(this._firestore);return super.get(e).then(i=>new Cr(this._firestore,r,t._key,i._document,new gs(!1,!1),t.converter))}}function Af(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new N("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function gg(){if(typeof Uint8Array>"u")throw new N("unimplemented","Uint8Arrays are not available in this environment.")}function _g(){if(!function yh(){return typeof atob<"u"}())throw new N("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){Ve=Vn.SDK_VERSION,(0,Vn._registerComponent)(new we.wA("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),h=new Me(new Ba(r.getProvider("auth-internal")),new Vf(r.getProvider("app-check-internal")),function(f,m){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new N(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Gn(f.options.projectId,m)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),h._setSettings(s),h},"PUBLIC").setMultipleInstances(!0)),(0,Vn.registerVersion)(jr,"4.3.2",e),(0,Vn.registerVersion)(jr,"4.3.2","esm2017")}();class Mu{constructor(e){this._delegate=e}static fromBase64String(e){return _g(),new Mu(Jn.fromBase64String(e))}static fromUint8Array(e){return gg(),new Mu(Jn.fromUint8Array(e))}toBase64(){return _g(),this._delegate.toBase64()}toUint8Array(){return gg(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function wf(n){return function JI(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class XI{enableIndexedDbPersistence(e,t){return function Yy(n,e){jm(n=fe(n,Me));const t=je(n);if(t._uninitializedComponentsProvider)throw new N(C.FAILED_PRECONDITION,"SDK cache is already specified.");Pt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new Jo;return Zm(t,i,new ef(i,r.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function Jy(n){jm(n=fe(n,Me));const e=je(n);if(e._uninitializedComponentsProvider)throw new N(C.FAILED_PRECONDITION,"SDK cache is already specified.");Pt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new Jo;return Zm(e,r,new Cm(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function Xy(n){if(n._initialized&&!n._terminated)throw new N(C.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Ge;return n._queue.enqueueAndForgetEvenWhileRestricted((0,g.Z)(function*(){try{yield(t=(0,g.Z)(function*(i){if(!kt.D())return Promise.resolve();const s=i+"main";yield kt.delete(s)}),function r(i){return t.apply(this,arguments)})(Kh(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class yg{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Gn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Pt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){Wm(this._delegate,e,t,r)}enableNetwork(){return function tI(n){return function Ly(n){return n.asyncQueue.enqueue((0,g.Z)(function*(){const e=yield Dm(n),t=yield Nm(n);return e.setNetworkEnabled(!0),function(i){const s=B(i);return s.C_.delete(0),Ru(s)}(t)}))}(je(n=fe(n,Me)))}(this._delegate)}disableNetwork(){return function nI(n){return function My(n){return n.asyncQueue.enqueue((0,g.Z)(function*(){const e=yield Dm(n),t=yield Nm(n);return e.setNetworkEnabled(!1),(r=(0,g.Z)(function*(s){const o=B(s);o.C_.add(0),yield $o(o),o.M_.set("Offline")}),function i(s){return r.apply(this,arguments)})(t);var r}))}(je(n=fe(n,Me)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Fm("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function eI(n){return function(t){const r=new Ge;return t.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return function Iy(n,e){return Fd.apply(this,arguments)}(yield uf(t),r)})),r.promise}(je(n=fe(n,Me)))}(this._delegate)}onSnapshotsInSync(e){return function NI(n,e){return function By(n,e){const t=new _c(e);return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return i=yield ea(n),s=t,B(i).q_.add(s),void s.next();var i,s})),()=>{t.Na(),n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return i=yield ea(n),s=t,void B(i).q_.delete(s);var i,s}))}}(je(n=fe(n,Me)),df(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new N("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new ra(this,Gm(this._delegate,e))}catch(t){throw Lt(t,"collection()","Firestore.collection()")}}doc(e){try{return new fn(this,bu(this._delegate,e))}catch(t){throw Lt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Mt(this,function Ky(n,e){if(n=fe(n,Cu),cf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new N(C.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Et(n,null,(r=e,new dn(me.emptyPath(),r)));var r}(this._delegate,e))}catch(t){throw Lt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function WI(n,e,t){n=fe(n,Me);const r=Object.assign(Object.assign({},qI),t);return function(s){if(s.maxAttempts<1)throw new N(C.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,h){const d=new Ge;return s.asyncQueue.enqueueAndForget((0,g.Z)(function*(){const f=yield function Vm(n){return Ic(n).then(e=>e.datastore)}(s);new ky(s.asyncQueue,f,h,o,d).run()})),d.promise}(je(n),i=>e(new zI(n,i)),r)}(this._delegate,t=>e(new Ig(this,t)))}batch(){return je(this._delegate),new vg(new dg(this._delegate,e=>na(this._delegate,e)))}loadBundle(e){return function rI(n,e){const t=je(n=fe(n,Me)),r=new jy;return function qy(n,e,t,r){const i=function(o,h){let d;return d="string"==typeof o?np().encode(o):o,m=function(m,y){if(m instanceof Uint8Array)return bm(m,y);if(m instanceof ArrayBuffer)return bm(new Uint8Array(m),y);if(m instanceof ReadableStream)return m.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(d),new Ny(m,h);var m}(t,wu(e));n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){!function xy(n,e,t){const r=B(n);var i;(i=(0,g.Z)(function*(o,h,d){try{const f=yield h.getMetadata();if(yield function(O,U){const M=B(O),Z=Xe(U.createTime);return M.persistence.runTransaction("hasNewerBundle","readonly",J=>M.Kr.getBundleMetadata(J,U.id)).then(J=>!!J&&J.createTime.compareTo(Z)>=0)}(o.localStore,f))return yield h.close(),d._completeWith({taskState:"Success",documentsLoaded:(O=f).totalDocuments,bytesLoaded:O.totalBytes,totalDocuments:O.totalDocuments,totalBytes:O.totalBytes}),Promise.resolve(new Set);d._updateProgress(Im(f));const m=new ly(f,o.localStore,h.serializer);let y=yield h.Ma();for(;y;){const P=yield m.ea(y);P&&d._updateProgress(P),y=yield h.Ma()}const I=yield m.complete();return yield Pr(o,I.ra,void 0),yield function(O,U){const M=B(O);return M.persistence.runTransaction("Save bundle","readwrite",Z=>M.Kr.saveBundleMetadata(Z,U))}(o.localStore,f),d._completeWith(I.progress),Promise.resolve(I.na)}catch(f){return Pt("SyncEngine",`Loading bundle failed with ${f}`),d._failWith(f),Promise.resolve(new Set)}var O}),function s(o,h,d){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield uf(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function iI(n,e){return function zy(n,e){return n.asyncQueue.enqueue((0,g.Z)(function*(){return function(r,i){const s=B(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Kr.getNamedQuery(o,i))}(yield Xo(n),e)}))}(je(n=fe(n,Me)),e).then(t=>t?new Et(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Mt(this,t):null)}}class Nc extends If{constructor(e){super(),this.firestore=e}convertBytes(e){return new Mu(new Jn(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return fn.forKey(t,this.firestore,null)}}class Ig{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Nc(e)}get(e){const t=ys(e);return this._delegate.get(t).then(r=>new Fu(this._firestore,new Cr(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=ys(e);return r?(Af("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=ys(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=ys(e);return this._delegate.delete(t),this}}class vg{constructor(e){this._delegate=e}set(e,t,r){const i=ys(e);return r?(Af("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=ys(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=ys(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class _s{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new Lu(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Uu(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=_s.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new _s(e,new Nc(e),t),i.set(t,s)),s}}_s.INSTANCES=new WeakMap;class fn{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Nc(e)}static forPath(e,t,r){if(e.length%2!=0)throw new N("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new fn(t,new Ue(t._delegate,r,new W(e)))}static forKey(e,t,r){return new fn(t,new Ue(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new ra(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new ra(this.firestore,Gm(this._delegate,e))}catch(t){throw Lt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,Ie.m9)(e))instanceof Ue&&$m(this._delegate,e)}set(e,t){t=Af("DocumentReference.set",t);try{return t?vf(this._delegate,e,t):vf(this._delegate,e)}catch(r){throw Lt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?cg(this._delegate,e):cg(this._delegate,e,t,...r)}catch(i){throw Lt(i,"updateDoc()","DocumentReference.update()")}}delete(){return function xI(n){return na(fe(n.firestore,Me),[new Lo(n._key,qe.none())])}(this._delegate)}onSnapshot(...e){const t=Eg(e),r=Tg(e,i=>new Fu(this.firestore,new Cr(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return hg(this._delegate,t,r)}get(e){let t;return t="cache"===e?.source?function RI(n){n=fe(n,Ue);const e=fe(n.firestore,Me),t=je(e),r=new mi(e);return function Fy(n,e){const t=new Ge;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return(r=(0,g.Z)(function*(s,o,h){try{const d=yield function(m,y){const I=B(m);return I.persistence.runTransaction("read document","readonly",P=>I.localDocuments.getDocument(P,y))}(s,o);d.isFoundDocument()?h.resolve(d):d.isNoDocument()?h.resolve(null):h.reject(new N(C.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(d){const f=jo(d,`Failed to get document '${o} from cache`);h.reject(f)}}),function i(s,o,h){return r.apply(this,arguments)})(yield Xo(n),e,t);var r})),t.promise}(t,n._key).then(i=>new Cr(e,r,n._key,i,new gs(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===e?.source?function PI(n){n=fe(n,Ue);const e=fe(n.firestore,Me);return km(je(e),n._key,{source:"server"}).then(t=>Ef(e,n,t))}(this._delegate):lg(this._delegate),t.then(r=>new Fu(this.firestore,new Cr(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new fn(this.firestore,this._delegate.withConverter(e?_s.getInstance(this.firestore,e):null))}}function Lt(n,e,t){return n.message=n.message.replace(e,t),n}function Eg(n){for(const e of n)if("object"==typeof e&&!wf(e))return e;return{}}function Tg(n,e){var t,r;let i;return i=wf(n[0])?n[0]:wf(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Fu{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new fn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return ug(this._delegate,e._delegate)}}class Uu extends Fu{data(e){const t=this._delegate.data(e);return this._delegate._converter||function Rl(n,e){n||G()}(void 0!==t),t}}class Mt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Nc(e)}where(e,t,r){try{return new Mt(this.firestore,fi(this._delegate,function pI(n,e,t){const r=e,i=Pc("where",n);return Ou._create(i,r,t)}(e,t,r)))}catch(i){throw Lt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Mt(this.firestore,fi(this._delegate,function mI(n,e="asc"){const t=e,r=Pc("orderBy",n);return yf._create(r,t)}(e,t)))}catch(r){throw Lt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Mt(this.firestore,fi(this._delegate,function gI(n){return qm("limit",n),Sc._create("limit",n,"F")}(e)))}catch(t){throw Lt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Mt(this.firestore,fi(this._delegate,function _I(n){return qm("limitToLast",n),Sc._create("limitToLast",n,"L")}(e)))}catch(t){throw Lt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Mt(this.firestore,fi(this._delegate,function yI(...n){return Cc._create("startAt",n,!0)}(...e)))}catch(t){throw Lt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Mt(this.firestore,fi(this._delegate,function II(...n){return Cc._create("startAfter",n,!1)}(...e)))}catch(t){throw Lt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Mt(this.firestore,fi(this._delegate,function vI(...n){return bc._create("endBefore",n,!1)}(...e)))}catch(t){throw Lt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Mt(this.firestore,fi(this._delegate,function EI(...n){return bc._create("endAt",n,!0)}(...e)))}catch(t){throw Lt(t,"endAt()","Query.endAt()")}}isEqual(e){return hf(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function CI(n){n=fe(n,Et);const e=fe(n.firestore,Me),t=je(e),r=new mi(e);return function Uy(n,e){const t=new Ge;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return(r=(0,g.Z)(function*(s,o,h){try{const d=yield cc(s,o,!0),f=new Tm(o,d.ls),m=f.ca(d.documents),y=f.applyChanges(m,!1);h.resolve(y.snapshot)}catch(d){const f=jo(d,`Failed to execute query '${o} against cache`);h.reject(f)}}),function i(s,o,h){return r.apply(this,arguments)})(yield Xo(n),e,t);var r})),t.promise}(t,n._query).then(i=>new pi(e,r,n,i))}(this._delegate):"server"===e?.source?function bI(n){n=fe(n,Et);const e=fe(n.firestore,Me),t=je(e),r=new mi(e);return Om(t,n._query,{source:"server"}).then(i=>new pi(e,r,n,i))}(this._delegate):function SI(n){n=fe(n,Et);const e=fe(n.firestore,Me),t=je(e),r=new mi(e);return ng(n._query),Om(t,n._query).then(i=>new pi(e,r,n,i))}(this._delegate),t.then(r=>new Rf(this.firestore,new pi(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=Eg(e),r=Tg(e,i=>new Rf(this.firestore,new pi(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return hg(this._delegate,t,r)}withConverter(e){return new Mt(this.firestore,this._delegate.withConverter(e?_s.getInstance(this.firestore,e):null))}}class tv{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Uu(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Rf{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Mt(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Uu(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new tv(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Uu(this._firestore,r))})}isEqual(e){return ug(this._delegate,e._delegate)}}class ra extends Mt{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new fn(this.firestore,e):null}doc(e){try{return new fn(this.firestore,void 0===e?bu(this._delegate):bu(this._delegate,e))}catch(t){throw Lt(t,"doc()","CollectionReference.doc()")}}add(e){return function DI(n,e){const t=fe(n.firestore,Me),r=bu(n),i=xc(n.converter,e);return na(t,[Ac(ps(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,qe.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new fn(this.firestore,t))}isEqual(e){return $m(this._delegate,e._delegate)}withConverter(e){return new ra(this.firestore,this._delegate.withConverter(e?_s.getInstance(this.firestore,e):null))}}function ys(n){return fe(n,Ue)}class Pf{constructor(...e){this._delegate=new Sr(...e)}static documentId(){return new Pf(ke.keyField().canonicalString())}isEqual(e){return(e=(0,Ie.m9)(e))instanceof Sr&&this._delegate._internalPath.isEqual(e._internalPath)}}class Is{constructor(e){this._delegate=e}static serverTimestamp(){const e=function $I(){return new ff("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new Is(e)}static delete(){const e=function GI(){return new Du("deleteField")}();return e._methodName="FieldValue.delete",new Is(e)}static arrayUnion(...e){const t=function KI(...n){return new lI("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new Is(t)}static arrayRemove(...e){const t=function ZI(...n){return new cI("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new Is(t)}static increment(e){const t=function jI(n){return new hI("increment",n)}(e);return t._methodName="FieldValue.increment",new Is(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const nv={Firestore:yg,GeoPoint:Ec,Timestamp:Pe,Blob:Mu,Transaction:Ig,WriteBatch:vg,DocumentReference:fn,DocumentSnapshot:Fu,Query:Mt,QueryDocumentSnapshot:Uu,QuerySnapshot:Rf,CollectionReference:ra,FieldPath:Pf,FieldValue:Is,setLogLevel:function ev(n){!function th(n){qn.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};function Ag(n,e){return function sv(n,e=yi.z){return new He.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}(n,e)}function Sf(n,e){return Ag(n,e).pipe((0,ct.U)(t=>({payload:t,type:"query"})))}!function iv(n){(function rv(n,e){n.INTERNAL.registerComponent(new we.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},nv)))})(n,(e,t)=>new yg(e,t,new XI)),n.registerVersion("@firebase/firestore-compat","0.3.22")}(sa.Z);class wg{constructor(e,t){(0,A.Z)(this,"ref",void 0),(0,A.Z)(this,"afs",void 0),this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:i,query:s}=Cg(r,t);return new Sg(i,s,this.afs)}snapshotChanges(){return function ov(n,e){return Ag(n,e).pipe((0,Jt.O)(void 0),er(),(0,ct.U)(t=>{const[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(D.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,ct.U)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,Qe.D)(this.ref.get(e)).pipe(D.iC)}}function Vc(n,e){return Sf(n,e).pipe((0,Jt.O)(void 0),er(),(0,ct.U)(t=>{const[r,i]=t,s=i.payload.docChanges(),o=s.map(h=>({type:h.type,payload:h}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((h,d)=>{const f=s.find(y=>y.doc.ref.isEqual(h.ref)),m=r?.payload.docs.find(y=>y.ref.isEqual(h.ref));f&&JSON.stringify(f.doc.metadata)===JSON.stringify(h.metadata)||!f&&m&&JSON.stringify(m.metadata)===JSON.stringify(h.metadata)||o.push({type:"modified",payload:{oldIndex:d,newIndex:d,type:"modified",doc:h}})}),o}))}function Rg(n,e,t){return Vc(n,t).pipe((0,br.R)((r,i)=>function av(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function uv(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return Cf(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return Cf(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Cf(n,e.oldIndex,1)}return n}(n,r))}),n}(r,i.map(s=>s.payload),e),[]),(0,ia.x)(),(0,ct.U)(r=>r.map(i=>({type:i.type,payload:i}))))}function Cf(n,e,t,...r){const i=n.slice();return i.splice(e,t,...r),i}function Pg(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}class Sg{constructor(e,t,r){(0,A.Z)(this,"ref",void 0),(0,A.Z)(this,"query",void 0),(0,A.Z)(this,"afs",void 0),this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Vc(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,ct.U)(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,Jt.O)(void 0),er(),(0,oe.h)(([r,i])=>i.length>0||!r),(0,ct.U)(([,r])=>r),D.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,br.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Pg(e);return Rg(this.query,t,this.afs.schedulers.outsideAngular).pipe(D.iC)}valueChanges(e={}){return Sf(this.query,this.afs.schedulers.outsideAngular).pipe((0,ct.U)(t=>t.payload.docs.map(r=>e.idField?{...r.data(),[e.idField]:r.id}:r.data())),D.iC)}get(e){return(0,Qe.D)(this.query.get(e)).pipe(D.iC)}add(e){return this.ref.add(e)}doc(e){return new wg(this.ref.doc(e),this.afs)}}class lv{constructor(e,t){(0,A.Z)(this,"query",void 0),(0,A.Z)(this,"afs",void 0),this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?Vc(this.query,this.afs.schedulers.outsideAngular).pipe((0,ct.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,oe.h)(t=>t.length>0),D.iC):Vc(this.query,this.afs.schedulers.outsideAngular).pipe(D.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,br.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Pg(e);return Rg(this.query,t,this.afs.schedulers.outsideAngular).pipe(D.iC)}valueChanges(e={}){return Sf(this.query,this.afs.schedulers.outsideAngular).pipe((0,ct.U)(r=>r.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),D.iC)}get(e){return(0,Qe.D)(this.query.get(e)).pipe(D.iC)}}const cv=new R.OlP("angularfire2.enableFirestorePersistence"),hv=new R.OlP("angularfire2.firestore.persistenceSettings"),dv=new R.OlP("angularfire2.firestore.settings"),fv=new R.OlP("angularfire2.firestore.use-emulator");function Cg(n,e=(t=>t)){return{query:e(n),ref:n}}let pv=(()=>{var n;class e{constructor(r,i,s,o,h,d,f,m,y,I,P,O,U,M,Z,J,Y){(0,A.Z)(this,"schedulers",void 0),(0,A.Z)(this,"firestore",void 0),(0,A.Z)(this,"persistenceEnabled$",void 0),this.schedulers=f;const H=(0,ze.on)(r,d,i),se=y;I&&Xn(H,d,P,U,M,Z,O,J),[this.firestore,this.persistenceEnabled$]=(0,ze.cc)(`${H.name}.firestore`,"AngularFirestore",H.name,()=>{const re=d.runOutsideAngular(()=>H.firestore());if(o&&re.settings(o),se&&re.useEmulator(...se),s&&!(0,gt.PM)(h)){const ot=()=>{try{return(0,Qe.D)(re.enablePersistence(m||void 0).then(()=>!0,()=>!1))}catch(pn){return typeof console<"u"&&console.warn(pn),(0,be.of)(!1)}};return[re,d.runOutsideAngular(ot)]}return[re,(0,be.of)(!1)]},[o,se,s])}collection(r,i){let s;s="string"==typeof r?this.firestore.collection(r):r;const{ref:o,query:h}=Cg(s,i),d=this.schedulers.ngZone.run(()=>o);return new Sg(d,h,this)}collectionGroup(r,i){const s=i||(h=>h),o=this.firestore.collectionGroup(r);return new lv(s(o),this)}doc(r){let i;i="string"==typeof r?this.firestore.doc(r):r;const s=this.schedulers.ngZone.run(()=>i);return new wg(s,this)}createId(){return this.firestore.collection("_").doc().id}}return n=e,(0,A.Z)(e,"\u0275fac",function(r){return new(r||n)(R.LFG(ze.Dh),R.LFG(ze.xv,8),R.LFG(cv,8),R.LFG(dv,8),R.LFG(R.Lbi),R.LFG(R.R0b),R.LFG(D.HU),R.LFG(hv,8),R.LFG(fv,8),R.LFG(mn,8),R.LFG($e,8),R.LFG(Dt,8),R.LFG(Yt,8),R.LFG(Nn,8),R.LFG(_i,8),R.LFG(Ts,8),R.LFG(D.Rf,8))}),(0,A.Z)(e,"\u0275prov",R.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"})),e})();F(3182);const Dg=(0,D.u3)(bu,!0),Av=(0,D.u3)(lg,!0),Ng=(0,D.u3)(Qy,!0),wv=(0,D.u3)(vf,!0);let Rv=(()=>{var n;class e{constructor(){this.auth=(0,R.f3M)(mn),this.firestore=(0,R.f3M)(pv)}signIn(r){return(0,gn.ab)((0,gn.o)(),r.email,r.password)}signUp(r){return(0,gn.aa)((0,gn.o)(),r.email,r.password)}updateUser(r){return(0,gn.ak)((0,gn.o)().currentUser,{displayName:r})}setDocument(r,i){return wv(Dg(Ng(),r),i)}getDocument(r){return(0,g.Z)(function*(){return(yield Av(Dg(Ng(),r))).data()})()}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=R.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),e})()},4532:(vs,Ft,F)=>{F.d(Ft,{F:()=>gt});var g=F(5861),R=F(5879),A=F(1160),he=F(7852);let gt=(()=>{var D;class ze{constructor(){this.loadingCtrl=(0,R.f3M)(he.HT),this.toastCtrl=(0,R.f3M)(he.yF),this.router=(0,R.f3M)(A.F0)}loading(){return this.loadingCtrl.create({spinner:"crescent"})}presentToast(be){var He=this;return(0,g.Z)(function*(){(yield He.toastCtrl.create(be)).present()})()}routerLink(be){return this.router.navigateByUrl(be)}saveInLocalStorage(be,He){return localStorage.setItem(be,JSON.stringify(He))}getFromLocalStorage(be){return JSON.parse(localStorage.getItem(be))}}return(D=ze).\u0275fac=function(be){return new(be||D)},D.\u0275prov=R.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),ze})()},6365:(vs,Ft,F)=>{F.r(Ft);var g=F(5861),R=F(3106),A=F(4562),he=F(9058),ze=(F(534),F(7879),F(4537));function Ae(){return window}function Qe(){return Qe=(0,g.Z)(function*(S,E,v){var x;const{BuildInfo:q}=Ae();(0,A.au)(E.sessionId,"AuthEvent did not contain a session ID");const te=yield function xn(S){return Dn.apply(this,arguments)}(E.sessionId),pe={};return(0,A.av)()?pe.ibi=q.packageName:(0,A.aw)()?pe.apn=q.packageName:(0,A.ax)(S,"operation-not-supported-in-this-environment"),q.displayName&&(pe.appDisplayName=q.displayName),pe.sessionId=te,(0,A.ay)(S,v,E.type,void 0,null!==(x=E.eventId)&&void 0!==x?x:void 0,pe)}),Qe.apply(this,arguments)}function $t(){return($t=(0,g.Z)(function*(S){const{BuildInfo:E}=Ae(),v={};(0,A.av)()?v.iosBundleId=E.packageName:(0,A.aw)()?v.androidPackageName=E.packageName:(0,A.ax)(S,"operation-not-supported-in-this-environment"),yield(0,A.az)(S,v)})).apply(this,arguments)}function bn(){return(bn=(0,g.Z)(function*(S,E,v){const{cordova:x}=Ae();let q=()=>{};try{yield new Promise((te,pe)=>{let ue=null;function Fe(){var le;te();const Kt=null===(le=x.plugins.browsertab)||void 0===le?void 0:le.close;"function"==typeof Kt&&Kt(),"function"==typeof v?.close&&v.close()}function wt(){ue||(ue=window.setTimeout(()=>{pe((0,A.aB)(S,"redirect-cancelled-by-user"))},2e3))}function dt(){"visible"===document?.visibilityState&&wt()}E.addPassiveListener(Fe),document.addEventListener("resume",wt,!1),(0,A.aw)()&&document.addEventListener("visibilitychange",dt,!1),q=()=>{E.removePassiveListener(Fe),document.removeEventListener("resume",wt,!1),document.removeEventListener("visibilitychange",dt,!1),ue&&window.clearTimeout(ue)}})}finally{q()}})).apply(this,arguments)}function Dn(){return(Dn=(0,g.Z)(function*(S){const E=function ne(S){if((0,A.au)(/[0-9a-zA-Z]+/.test(S),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(S);const E=new ArrayBuffer(S.length),v=new Uint8Array(E);for(let x=0;x<S.length;x++)v[x]=S.charCodeAt(x);return v}(S),v=yield crypto.subtle.digest("SHA-256",E);return Array.from(new Uint8Array(v)).map(q=>q.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}class ge extends A.aD{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(E=>{this.resolveInialized=E})}addPassiveListener(E){this.passiveListeners.add(E)}removePassiveListener(E){this.passiveListeners.delete(E)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(E){return this.resolveInialized(),this.passiveListeners.forEach(v=>v(E)),super.onEvent(E)}initialized(){var E=this;return(0,g.Z)(function*(){yield E.initPromise})()}}function et(S){return L.apply(this,arguments)}function L(){return(L=(0,g.Z)(function*(S){const E=yield Yt()._get(Nn(S));return E&&(yield Yt()._remove(Nn(S))),E})).apply(this,arguments)}function Dt(){const S=[];for(let v=0;v<20;v++){const x=Math.floor(62*Math.random());S.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(x))}return S.join("")}function Yt(){return(0,A.aE)(A.b)}function Nn(S){return(0,A.aF)("authEvent",S.config.apiKey,S.name)}function Xn(S){if(!S?.includes("?"))return{};const[E,...v]=S.split("?");return(0,he.zd)(v.join("?"))}const gn=class As{constructor(){this._redirectPersistence=A.a,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=A.aG,this._overrideRedirectResult=A.aH}_initialize(E){var v=this;return(0,g.Z)(function*(){const x=E._key();let q=v.eventManagers.get(x);return q||(q=new ge(E),v.eventManagers.set(x,q),v.attachCallbackListeners(E,q)),q})()}_openPopup(E){(0,A.ax)(E,"operation-not-supported-in-this-environment")}_openRedirect(E,v,x,q){var te=this;return(0,g.Z)(function*(){!function Es(S){var E,v,x,q,te,pe,ue,Fe,wt,dt;const le=Ae();(0,A.aC)("function"==typeof(null===(E=le?.universalLinks)||void 0===E?void 0:E.subscribe),S,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),(0,A.aC)(typeof(null===(v=le?.BuildInfo)||void 0===v?void 0:v.packageName)<"u",S,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),(0,A.aC)("function"==typeof(null===(te=null===(q=null===(x=le?.cordova)||void 0===x?void 0:x.plugins)||void 0===q?void 0:q.browsertab)||void 0===te?void 0:te.openUrl),S,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,A.aC)("function"==typeof(null===(Fe=null===(ue=null===(pe=le?.cordova)||void 0===pe?void 0:pe.plugins)||void 0===ue?void 0:ue.browsertab)||void 0===Fe?void 0:Fe.isAvailable),S,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,A.aC)("function"==typeof(null===(dt=null===(wt=le?.cordova)||void 0===wt?void 0:wt.InAppBrowser)||void 0===dt?void 0:dt.open),S,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(E);const pe=yield te._initialize(E);yield pe.initialized(),pe.resetRedirect(),(0,A.aI)(),yield te._originValidation(E);const ue=function Ee(S,E,v=null){return{type:E,eventId:v,urlResponse:null,sessionId:Dt(),postBody:null,tenantId:S.tenantId,error:(0,A.aB)(S,"no-auth-event")}}(E,x,q);yield function oe(S,E){return Yt()._set(Nn(S),E)}(E,ue);const Fe=yield function He(S,E,v){return Qe.apply(this,arguments)}(E,ue,v),wt=yield function Ut(S){const{cordova:E}=Ae();return new Promise(v=>{E.plugins.browsertab.isAvailable(x=>{let q=null;x?E.plugins.browsertab.openUrl(S):q=E.InAppBrowser.open(S,(0,A.aA)()?"_blank":"_system","location=yes"),v(q)})})}(Fe);return function ct(S,E,v){return bn.apply(this,arguments)}(E,pe,wt)})()}_isIframeWebStorageSupported(E,v){throw new Error("Method not implemented.")}_originValidation(E){const v=E._key();return this.originValidationPromises[v]||(this.originValidationPromises[v]=function Tt(S){return $t.apply(this,arguments)}(E)),this.originValidationPromises[v]}attachCallbackListeners(E,v){const{universalLinks:x,handleOpenURL:q,BuildInfo:te}=Ae(),pe=setTimeout((0,g.Z)(function*(){yield et(E),v.onEvent(Ie())}),500),ue=function(){var dt=(0,g.Z)(function*(le){clearTimeout(pe);const Kt=yield et(E);let kr=null;Kt&&le?.url&&(kr=function $e(S,E){var v,x;const q=function Ts(S){const E=Xn(S),v=E.link?decodeURIComponent(E.link):void 0,x=Xn(v).link,q=E.deep_link_id?decodeURIComponent(E.deep_link_id):void 0;return Xn(q).link||q||x||v||S}(E);if(q.includes("/__/auth/callback")){const te=Xn(q),pe=te.firebaseError?function _i(S){try{return JSON.parse(S)}catch{return null}}(decodeURIComponent(te.firebaseError)):null,ue=null===(x=null===(v=pe?.code)||void 0===v?void 0:v.split("auth/"))||void 0===x?void 0:x[1],Fe=ue?(0,A.aB)(ue):null;return Fe?{type:S.type,eventId:S.eventId,tenantId:S.tenantId,error:Fe,urlResponse:null,sessionId:null,postBody:null}:{type:S.type,eventId:S.eventId,tenantId:S.tenantId,sessionId:S.sessionId,urlResponse:q,postBody:null}}return null}(Kt,le.url)),v.onEvent(kr||Ie())});return function(Kt){return dt.apply(this,arguments)}}();typeof x<"u"&&"function"==typeof x.subscribe&&x.subscribe(null,ue);const Fe=q,wt=`${te.packageName.toLowerCase()}://`;Ae().handleOpenURL=function(){var dt=(0,g.Z)(function*(le){if(le.toLowerCase().startsWith(wt)&&ue({url:le}),"function"==typeof Fe)try{Fe(le)}catch(Kt){console.error(Kt)}});return function(le){return dt.apply(this,arguments)}}()}};function Ie(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:(0,A.aB)("no-auth-event")}}function Jt(){var S;return(null===(S=self?.location)||void 0===S?void 0:S.protocol)||null}function Bt(S=(0,he.z$)()){return!("file:"!==Jt()&&"ionic:"!==Jt()&&"capacitor:"!==Jt()||!S.toLowerCase().match(/iphone|ipad|ipod|android/))}function kn(){try{const S=self.localStorage,E=A.aN();if(S)return S.setItem(E,"1"),S.removeItem(E),!function sa(S=(0,he.z$)()){return function br(){return(0,he.w1)()&&11===document?.documentMode}()||function ia(S=(0,he.z$)()){return/Edge\/\d+/.test(S)}(S)}()||(0,he.hl)()}catch{return ht()&&(0,he.hl)()}return!1}function ht(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function z(){return(function Ii(){return"http:"===Jt()||"https:"===Jt()}()||(0,he.ru)()||Bt())&&!function er(){return(0,he.b$)()||(0,he.UG)()}()&&kn()&&!ht()}function tr(){return Bt()&&typeof document<"u"}function Xt(){return(Xt=(0,g.Z)(function*(){return!!tr()&&new Promise(S=>{const E=setTimeout(()=>{S(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(E),S(!0)})})})).apply(this,arguments)}const at={LOCAL:"local",NONE:"none",SESSION:"session"},_n=A.aC,xr="persistence";function nr(S){return Ke.apply(this,arguments)}function Ke(){return(Ke=(0,g.Z)(function*(S){yield S._initializationPromise;const E=De(),v=A.aF(xr,S.config.apiKey,S.name);E&&E.setItem(v,S._getPersistence())})).apply(this,arguments)}function De(){var S;try{return(null===(S=function On(){return typeof window<"u"?window:null}())||void 0===S?void 0:S.sessionStorage)||null}catch{return null}}const yn=A.aC;class en{constructor(){this.browserResolver=A.aE(A.k),this.cordovaResolver=A.aE(gn),this.underlyingResolver=null,this._redirectPersistence=A.a,this._completeRedirectFn=A.aG,this._overrideRedirectResult=A.aH}_initialize(E){var v=this;return(0,g.Z)(function*(){return yield v.selectUnderlyingResolver(),v.assertedUnderlyingResolver._initialize(E)})()}_openPopup(E,v,x,q){var te=this;return(0,g.Z)(function*(){return yield te.selectUnderlyingResolver(),te.assertedUnderlyingResolver._openPopup(E,v,x,q)})()}_openRedirect(E,v,x,q){var te=this;return(0,g.Z)(function*(){return yield te.selectUnderlyingResolver(),te.assertedUnderlyingResolver._openRedirect(E,v,x,q)})()}_isIframeWebStorageSupported(E,v){this.assertedUnderlyingResolver._isIframeWebStorageSupported(E,v)}_originValidation(E){return this.assertedUnderlyingResolver._originValidation(E)}get _shouldInitProactively(){return tr()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return yn(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var E=this;return(0,g.Z)(function*(){if(E.underlyingResolver)return;const v=yield function X(){return Xt.apply(this,arguments)}();E.underlyingResolver=v?E.cordovaResolver:E.browserResolver})()}}function rr(S){return S.unwrap()}function sr(S){return qt(S)}function qt(S){const{_tokenResponse:E}=S instanceof he.ZR?S.customData:S;if(!E)return null;if(!(S instanceof he.ZR)&&"temporaryProof"in E&&"phoneNumber"in E)return A.P.credentialFromResult(S);const v=E.providerId;if(!v||v===A.p.PASSWORD)return null;let x;switch(v){case A.p.GOOGLE:x=A.X;break;case A.p.FACEBOOK:x=A.W;break;case A.p.GITHUB:x=A.Y;break;case A.p.TWITTER:x=A.$;break;default:const{oauthIdToken:q,oauthAccessToken:te,oauthTokenSecret:pe,pendingToken:ue,nonce:Fe}=E;return te||pe||q||ue?ue?v.startsWith("saml.")?A.aQ._create(v,ue):A.N._fromParams({providerId:v,signInMethod:v,pendingToken:ue,idToken:q,accessToken:te}):new A.Z(v).credential({idToken:q,accessToken:te,rawNonce:Fe}):null}return S instanceof he.ZR?x.credentialFromError(S):x.credentialFromResult(S)}function Be(S,E){return E.catch(v=>{throw v instanceof he.ZR&&function tt(S,E){var v;const x=null===(v=E.customData)||void 0===v?void 0:v._tokenResponse;if("auth/multi-factor-auth-required"===E?.code)E.resolver=new Dr(S,A.as(S,E));else if(x){const q=qt(E),te=E;q&&(te.credential=q,te.tenantId=x.tenantId||void 0,te.email=x.email||void 0,te.phoneNumber=x.phoneNumber||void 0)}}(S,v),v}).then(v=>{const q=v.user;return{operationType:v.operationType,credential:sr(v),additionalUserInfo:A.aq(v),user:_t.getOrCreate(q)}})}function Mn(S,E){return At.apply(this,arguments)}function At(){return(At=(0,g.Z)(function*(S,E){const v=yield E;return{verificationId:v.verificationId,confirm:x=>Be(S,v.confirm(x))}})).apply(this,arguments)}class Dr{constructor(E,v){this.resolver=v,this.auth=function ir(S){return S.wrapped()}(E)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(E){return Be(rr(this.auth),this.resolver.resolveSignIn(E))}}class _t{constructor(E){this._delegate=E,this.multiFactor=A.at(E)}static getOrCreate(E){return _t.USER_MAP.has(E)||_t.USER_MAP.set(E,new _t(E)),_t.USER_MAP.get(E)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(E){return this._delegate.getIdTokenResult(E)}getIdToken(E){return this._delegate.getIdToken(E)}linkAndRetrieveDataWithCredential(E){return this.linkWithCredential(E)}linkWithCredential(E){var v=this;return(0,g.Z)(function*(){return Be(v.auth,A.a2(v._delegate,E))})()}linkWithPhoneNumber(E,v){var x=this;return(0,g.Z)(function*(){return Mn(x.auth,A.l(x._delegate,E,v))})()}linkWithPopup(E){var v=this;return(0,g.Z)(function*(){return Be(v.auth,A.d(v._delegate,E,en))})()}linkWithRedirect(E){var v=this;return(0,g.Z)(function*(){return yield nr(A.aJ(v.auth)),A.g(v._delegate,E,en)})()}reauthenticateAndRetrieveDataWithCredential(E){return this.reauthenticateWithCredential(E)}reauthenticateWithCredential(E){var v=this;return(0,g.Z)(function*(){return Be(v.auth,A.a3(v._delegate,E))})()}reauthenticateWithPhoneNumber(E,v){return Mn(this.auth,A.r(this._delegate,E,v))}reauthenticateWithPopup(E){return Be(this.auth,A.e(this._delegate,E,en))}reauthenticateWithRedirect(E){var v=this;return(0,g.Z)(function*(){return yield nr(A.aJ(v.auth)),A.h(v._delegate,E,en)})()}sendEmailVerification(E){return A.ag(this._delegate,E)}unlink(E){var v=this;return(0,g.Z)(function*(){return yield A.ap(v._delegate,E),v})()}updateEmail(E){return A.al(this._delegate,E)}updatePassword(E){return A.am(this._delegate,E)}updatePhoneNumber(E){return A.u(this._delegate,E)}updateProfile(E){return A.ak(this._delegate,E)}verifyBeforeUpdateEmail(E,v){return A.ah(this._delegate,E,v)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}_t.USER_MAP=new WeakMap;const In=A.aC;let vn=(()=>{class S{constructor(v,x){if(this.app=v,x.isInitialized())return this._delegate=x.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:q}=v.options;In(q,"invalid-api-key",{appName:v.name}),In(q,"invalid-api-key",{appName:v.name});const te=typeof window<"u"?en:void 0;this._delegate=x.initialize({options:{persistence:vi(q,v.name),popupRedirectResolver:te}}),this._delegate._updateErrorMap(A.G),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?_t.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(v){this._delegate.languageCode=v}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(v){this._delegate.tenantId=v}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(v,x){A.K(this._delegate,v,x)}applyActionCode(v){return A.a7(this._delegate,v)}checkActionCode(v){return A.a8(this._delegate,v)}confirmPasswordReset(v,x){return A.a6(this._delegate,v,x)}createUserWithEmailAndPassword(v,x){var q=this;return(0,g.Z)(function*(){return Be(q._delegate,A.aa(q._delegate,v,x))})()}fetchProvidersForEmail(v){return this.fetchSignInMethodsForEmail(v)}fetchSignInMethodsForEmail(v){return A.af(this._delegate,v)}isSignInWithEmailLink(v){return A.ad(this._delegate,v)}getRedirectResult(){var v=this;return(0,g.Z)(function*(){In(z(),v._delegate,"operation-not-supported-in-this-environment");const x=yield A.j(v._delegate,en);return x?Be(v._delegate,Promise.resolve(x)):{credential:null,user:null}})()}addFrameworkForLogging(v){!function Vn(S,E){(0,A.aJ)(S)._logFramework(E)}(this._delegate,v)}onAuthStateChanged(v,x,q){const{next:te,error:pe,complete:ue}=or(v,x,q);return this._delegate.onAuthStateChanged(te,pe,ue)}onIdTokenChanged(v,x,q){const{next:te,error:pe,complete:ue}=or(v,x,q);return this._delegate.onIdTokenChanged(te,pe,ue)}sendSignInLinkToEmail(v,x){return A.ac(this._delegate,v,x)}sendPasswordResetEmail(v,x){return A.a5(this._delegate,v,x||void 0)}setPersistence(v){var x=this;return(0,g.Z)(function*(){let q;switch(function oa(S,E){_n(Object.values(at).includes(E),S,"invalid-persistence-type"),(0,he.b$)()?_n(E!==at.SESSION,S,"unsupported-persistence-type"):(0,he.UG)()?_n(E===at.NONE,S,"unsupported-persistence-type"):ht()?_n(E===at.NONE||E===at.LOCAL&&(0,he.hl)(),S,"unsupported-persistence-type"):_n(E===at.NONE||kn(),S,"unsupported-persistence-type")}(x._delegate,v),v){case at.SESSION:q=A.a;break;case at.LOCAL:q=(yield A.aE(A.i)._isAvailable())?A.i:A.b;break;case at.NONE:q=A.U;break;default:return A.ax("argument-error",{appName:x._delegate.name})}return x._delegate.setPersistence(q)})()}signInAndRetrieveDataWithCredential(v){return this.signInWithCredential(v)}signInAnonymously(){return Be(this._delegate,A.a0(this._delegate))}signInWithCredential(v){return Be(this._delegate,A.a1(this._delegate,v))}signInWithCustomToken(v){return Be(this._delegate,A.a4(this._delegate,v))}signInWithEmailAndPassword(v,x){return Be(this._delegate,A.ab(this._delegate,v,x))}signInWithEmailLink(v,x){return Be(this._delegate,A.ae(this._delegate,v,x))}signInWithPhoneNumber(v,x){return Mn(this._delegate,A.s(this._delegate,v,x))}signInWithPopup(v){var x=this;return(0,g.Z)(function*(){return In(z(),x._delegate,"operation-not-supported-in-this-environment"),Be(x._delegate,A.c(x._delegate,v,en))})()}signInWithRedirect(v){var x=this;return(0,g.Z)(function*(){return In(z(),x._delegate,"operation-not-supported-in-this-environment"),yield nr(x._delegate),A.f(x._delegate,v,en)})()}updateCurrentUser(v){return this._delegate.updateCurrentUser(v)}verifyPasswordResetCode(v){return A.a9(this._delegate,v)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return S.Persistence=at,S})();function or(S,E,v){let x=S;"function"!=typeof S&&({next:x,error:E,complete:v}=S);const q=x;return{next:pe=>q(pe&&_t.getOrCreate(pe)),error:E,complete:v}}function vi(S,E){const v=function Ln(S,E){const v=De();if(!v)return[];const x=A.aF(xr,S,E);switch(v.getItem(x)){case at.NONE:return[A.U];case at.LOCAL:return[A.i,A.a];case at.SESSION:return[A.a];default:return[]}}(S,E);if(typeof self<"u"&&!v.includes(A.i)&&v.push(A.i),typeof window<"u")for(const x of[A.b,A.a])v.includes(x)||v.push(x);return v.includes(A.U)||v.push(A.U),v}class Nr{constructor(){this.providerId="phone",this._delegate=new A.P(rr(R.Z.auth()))}static credential(E,v){return A.P.credential(E,v)}verifyPhoneNumber(E,v){return this._delegate.verifyPhoneNumber(E,v)}unwrap(){return this._delegate}}Nr.PHONE_SIGN_IN_METHOD=A.P.PHONE_SIGN_IN_METHOD,Nr.PROVIDER_ID=A.P.PROVIDER_ID;const aa=A.aC;class Vr{constructor(E,v,x=R.Z.app()){var q;aa(null===(q=x.options)||void 0===q?void 0:q.apiKey,"invalid-api-key",{appName:x.name}),this._delegate=new A.R(x.auth(),E,v),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function ar(S){S.INTERNAL.registerComponent(new ze.wA("auth-compat",E=>{const v=E.getProvider("app-compat").getImmediate(),x=E.getProvider("auth");return new vn(v,x)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:A.A.EMAIL_SIGNIN,PASSWORD_RESET:A.A.PASSWORD_RESET,RECOVER_EMAIL:A.A.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:A.A.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:A.A.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:A.A.VERIFY_EMAIL}},EmailAuthProvider:A.V,FacebookAuthProvider:A.W,GithubAuthProvider:A.Y,GoogleAuthProvider:A.X,OAuthProvider:A.Z,SAMLAuthProvider:A._,PhoneAuthProvider:Nr,PhoneMultiFactorGenerator:A.m,RecaptchaVerifier:Vr,TwitterAuthProvider:A.$,Auth:vn,AuthCredential:A.L,Error:he.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),S.registerVersion("@firebase/auth-compat","0.4.9")}(R.Z)}}]);