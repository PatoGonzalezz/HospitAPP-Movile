(self.webpackChunkapp=self.webpackChunkapp||[]).push([[179],{6506:(ci,Qt,le)=>{"use strict";le.d(Qt,{c:()=>Wt});var M=le(7643),b=le(544);let Ft;const Me=Ct=>Ct.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),ht=Ct=>(void 0===Ft&&(Ft=void 0===Ct.style.animationName&&void 0!==Ct.style.webkitAnimationName?"-webkit-":""),Ft),Ke=(Ct,it,Kt)=>{const Tt=it.startsWith("animation")?ht(Ct):"";Ct.style.setProperty(Tt+it,Kt)},pt=(Ct,it)=>{const Kt=it.startsWith("animation")?ht(Ct):"";Ct.style.removeProperty(Kt+it)},st=[],_t=(Ct=[],it)=>{if(void 0!==it){const Kt=Array.isArray(it)?it:[it];return[...Ct,...Kt]}return Ct},Wt=Ct=>{let it,Kt,Tt,Ze,Fe,$t,ft,Re,Ne,at,At,ri,Cn,un=[],De=[],dt=[],Lt=!1,pn={},hn=[],Vt=[],Jn={},Ht=0,li=!1,tn=!1,en=!0,on=!1,Zn=!0,nn=!1;const xt=Ct,St=[],xn=[],Hn=[],yi=[],qn=[],ti=[],Xn=[],ar=[],yn=[],lr=[],Pr="function"==typeof AnimationEffect||void 0!==M.w&&"function"==typeof M.w.AnimationEffect,pr="function"==typeof Element&&"function"==typeof Element.prototype.animate&&Pr,Si=()=>lr,Er=(ge,Te)=>((Te?.oneTimeCallback?xn:St).push({c:ge,o:Te}),Cn),Sr=()=>{if(pr)lr.forEach(ge=>{ge.cancel()}),lr.length=0;else{const ge=Hn.slice();(0,b.r)(()=>{ge.forEach(Te=>{pt(Te,"animation-name"),pt(Te,"animation-duration"),pt(Te,"animation-timing-function"),pt(Te,"animation-iteration-count"),pt(Te,"animation-delay"),pt(Te,"animation-play-state"),pt(Te,"animation-fill-mode"),pt(Te,"animation-direction")})})}},gr=()=>{qn.forEach(ge=>{ge?.parentNode&&ge.parentNode.removeChild(ge)}),qn.length=0},Bt=()=>void 0!==Fe?Fe:ft?ft.getFill():"both",bn=()=>void 0!==Ne?Ne:void 0!==$t?$t:ft?ft.getDirection():"normal",Pn=()=>li?"linear":void 0!==Tt?Tt:ft?ft.getEasing():"linear",Ye=()=>tn?0:void 0!==at?at:void 0!==Kt?Kt:ft?ft.getDuration():0,je=()=>void 0!==Ze?Ze:ft?ft.getIterations():1,wt=()=>void 0!==At?At:void 0!==it?it:ft?ft.getDelay():0,Mo=()=>{0!==Ht&&(Ht--,0===Ht&&((()=>{Or(),ar.forEach(sn=>sn()),yn.forEach(sn=>sn());const ge=en?1:0,Te=hn,vt=Vt,Mt=Jn;Hn.forEach(sn=>{const mn=sn.classList;Te.forEach(an=>mn.add(an)),vt.forEach(an=>mn.remove(an));for(const an in Mt)Mt.hasOwnProperty(an)&&Ke(sn,an,Mt[an])}),St.forEach(sn=>sn.c(ge,Cn)),xn.forEach(sn=>sn.c(ge,Cn)),xn.length=0,Zn=!0,en&&(on=!0),en=!0})(),ft&&ft.animationFinish()))},Uo=(ge=!0)=>{gr();const Te=(Ct=>(Ct.forEach(it=>{for(const Kt in it)if(it.hasOwnProperty(Kt)){const Tt=it[Kt];if("easing"===Kt)it["animation-timing-function"]=Tt,delete it[Kt];else{const Ze=Me(Kt);Ze!==Kt&&(it[Ze]=Tt,delete it[Kt])}}}),Ct))(un);Hn.forEach(vt=>{if(Te.length>0){const Mt=((Ct=[])=>Ct.map(it=>{const Kt=it.offset,Tt=[];for(const Ze in it)it.hasOwnProperty(Ze)&&"offset"!==Ze&&Tt.push(`${Ze}: ${it[Ze]};`);return`${100*Kt}% { ${Tt.join(" ")} }`}).join(" "))(Te);ri=void 0!==Ct?Ct:(Ct=>{let it=st.indexOf(Ct);return it<0&&(it=st.push(Ct)-1),`ion-animation-${it}`})(Mt);const sn=((Ct,it,Kt)=>{var Tt;const Ze=(Ct=>{const it=void 0!==Ct.getRootNode?Ct.getRootNode():Ct;return it.head||it})(Kt),Fe=ht(Kt),$t=Ze.querySelector("#"+Ct);if($t)return $t;const un=(null!==(Tt=Kt.ownerDocument)&&void 0!==Tt?Tt:document).createElement("style");return un.id=Ct,un.textContent=`@${Fe}keyframes ${Ct} { ${it} } @${Fe}keyframes ${Ct}-alt { ${it} }`,Ze.appendChild(un),un})(ri,Mt,vt);qn.push(sn),Ke(vt,"animation-duration",`${Ye()}ms`),Ke(vt,"animation-timing-function",Pn()),Ke(vt,"animation-delay",`${wt()}ms`),Ke(vt,"animation-fill-mode",Bt()),Ke(vt,"animation-direction",bn());const mn=je()===1/0?"infinite":je().toString();Ke(vt,"animation-iteration-count",mn),Ke(vt,"animation-play-state","paused"),ge&&Ke(vt,"animation-name",`${sn.id}-alt`),(0,b.r)(()=>{Ke(vt,"animation-name",sn.id||null)})}})},Ao=(ge=!0)=>{(()=>{ti.forEach(Mt=>Mt()),Xn.forEach(Mt=>Mt());const ge=De,Te=dt,vt=pn;Hn.forEach(Mt=>{const sn=Mt.classList;ge.forEach(mn=>sn.add(mn)),Te.forEach(mn=>sn.remove(mn));for(const mn in vt)vt.hasOwnProperty(mn)&&Ke(Mt,mn,vt[mn])})})(),un.length>0&&(pr?(Hn.forEach(ge=>{const Te=ge.animate(un,{id:xt,delay:wt(),duration:Ye(),easing:Pn(),iterations:je(),fill:Bt(),direction:bn()});Te.pause(),lr.push(Te)}),lr.length>0&&(lr[0].onfinish=()=>{Mo()})):Uo(ge)),Lt=!0},Br=ge=>{if(ge=Math.min(Math.max(ge,0),.9999),pr)lr.forEach(Te=>{Te.currentTime=Te.effect.getComputedTiming().delay+Ye()*ge,Te.pause()});else{const Te=`-${Ye()*ge}ms`;Hn.forEach(vt=>{un.length>0&&(Ke(vt,"animation-delay",Te),Ke(vt,"animation-play-state","paused"))})}},Dr=ge=>{lr.forEach(Te=>{Te.effect.updateTiming({delay:wt(),duration:Ye(),easing:Pn(),iterations:je(),fill:Bt(),direction:bn()})}),void 0!==ge&&Br(ge)},Hi=(ge=!0,Te)=>{(0,b.r)(()=>{Hn.forEach(vt=>{Ke(vt,"animation-name",ri||null),Ke(vt,"animation-duration",`${Ye()}ms`),Ke(vt,"animation-timing-function",Pn()),Ke(vt,"animation-delay",void 0!==Te?`-${Te*Ye()}ms`:`${wt()}ms`),Ke(vt,"animation-fill-mode",Bt()||null),Ke(vt,"animation-direction",bn()||null);const Mt=je()===1/0?"infinite":je().toString();Ke(vt,"animation-iteration-count",Mt),ge&&Ke(vt,"animation-name",`${ri}-alt`),(0,b.r)(()=>{Ke(vt,"animation-name",ri||null)})})})},Ur=(ge=!1,Te=!0,vt)=>(ge&&yi.forEach(Mt=>{Mt.update(ge,Te,vt)}),pr?Dr(vt):Hi(Te,vt),Cn),Gt=()=>{Lt&&(pr?lr.forEach(ge=>{ge.pause()}):Hn.forEach(ge=>{Ke(ge,"animation-play-state","paused")}),nn=!0)},Rr=()=>{Re=void 0,Mo()},Or=()=>{Re&&clearTimeout(Re)},Lo=ge=>new Promise(Te=>{ge?.sync&&(tn=!0,Er(()=>tn=!1,{oneTimeCallback:!0})),Lt||Ao(),on&&(pr?(Br(0),Dr()):Hi(),on=!1),Zn&&(Ht=yi.length+1,Zn=!1),Er(()=>Te(),{oneTimeCallback:!0}),yi.forEach(vt=>{vt.play()}),pr?(lr.forEach(ge=>{ge.play()}),(0===un.length||0===Hn.length)&&Mo()):(()=>{if(Or(),(0,b.r)(()=>{Hn.forEach(ge=>{un.length>0&&Ke(ge,"animation-play-state","running")})}),0===un.length||0===Hn.length)Mo();else{const ge=wt()||0,Te=Ye()||0,vt=je()||1;isFinite(vt)&&(Re=setTimeout(Rr,ge+Te*vt+100)),((Ct,it)=>{let Kt;const Tt={passive:!0},Fe=$t=>{Ct===$t.target&&(Kt&&Kt(),Or(),(0,b.r)(()=>{Hn.forEach(ge=>{pt(ge,"animation-duration"),pt(ge,"animation-delay"),pt(ge,"animation-play-state")}),(0,b.r)(Mo)}))};Ct&&(Ct.addEventListener("webkitAnimationEnd",Fe,Tt),Ct.addEventListener("animationend",Fe,Tt),Kt=()=>{Ct.removeEventListener("webkitAnimationEnd",Fe,Tt),Ct.removeEventListener("animationend",Fe,Tt)})})(Hn[0])}})(),nn=!1}),Pi=(ge,Te)=>{const vt=un[0];return void 0===vt||void 0!==vt.offset&&0!==vt.offset?un=[{offset:0,[ge]:Te},...un]:vt[ge]=Te,Cn};return Cn={parentAnimation:ft,elements:Hn,childAnimations:yi,id:xt,animationFinish:Mo,from:Pi,to:(ge,Te)=>{const vt=un[un.length-1];return void 0===vt||void 0!==vt.offset&&1!==vt.offset?un=[...un,{offset:1,[ge]:Te}]:vt[ge]=Te,Cn},fromTo:(ge,Te,vt)=>Pi(ge,Te).to(ge,vt),parent:ge=>(ft=ge,Cn),play:Lo,pause:()=>(yi.forEach(ge=>{ge.pause()}),Gt(),Cn),stop:()=>{yi.forEach(ge=>{ge.stop()}),Lt&&(Sr(),Lt=!1),li=!1,tn=!1,Zn=!0,Ne=void 0,at=void 0,At=void 0,Ht=0,on=!1,en=!0,nn=!1},destroy:ge=>(yi.forEach(Te=>{Te.destroy(ge)}),(ge=>{Sr(),ge&&gr()})(ge),Hn.length=0,yi.length=0,un.length=0,St.length=0,xn.length=0,Lt=!1,Zn=!0,Cn),keyframes:ge=>{const Te=un!==ge;return un=ge,Te&&(ge=>{pr?Si().forEach(Te=>{if(Te.effect.setKeyframes)Te.effect.setKeyframes(ge);else{const vt=new KeyframeEffect(Te.effect.target,ge,Te.effect.getTiming());Te.effect=vt}}):Uo()})(un),Cn},addAnimation:ge=>{if(null!=ge)if(Array.isArray(ge))for(const Te of ge)Te.parent(Cn),yi.push(Te);else ge.parent(Cn),yi.push(ge);return Cn},addElement:ge=>{if(null!=ge)if(1===ge.nodeType)Hn.push(ge);else if(ge.length>=0)for(let Te=0;Te<ge.length;Te++)Hn.push(ge[Te]);else console.error("Invalid addElement value");return Cn},update:Ur,fill:ge=>(Fe=ge,Ur(!0),Cn),direction:ge=>($t=ge,Ur(!0),Cn),iterations:ge=>(Ze=ge,Ur(!0),Cn),duration:ge=>(!pr&&0===ge&&(ge=1),Kt=ge,Ur(!0),Cn),easing:ge=>(Tt=ge,Ur(!0),Cn),delay:ge=>(it=ge,Ur(!0),Cn),getWebAnimations:Si,getKeyframes:()=>un,getFill:Bt,getDirection:bn,getDelay:wt,getIterations:je,getEasing:Pn,getDuration:Ye,afterAddRead:ge=>(ar.push(ge),Cn),afterAddWrite:ge=>(yn.push(ge),Cn),afterClearStyles:(ge=[])=>{for(const Te of ge)Jn[Te]="";return Cn},afterStyles:(ge={})=>(Jn=ge,Cn),afterRemoveClass:ge=>(Vt=_t(Vt,ge),Cn),afterAddClass:ge=>(hn=_t(hn,ge),Cn),beforeAddRead:ge=>(ti.push(ge),Cn),beforeAddWrite:ge=>(Xn.push(ge),Cn),beforeClearStyles:(ge=[])=>{for(const Te of ge)pn[Te]="";return Cn},beforeStyles:(ge={})=>(pn=ge,Cn),beforeRemoveClass:ge=>(dt=_t(dt,ge),Cn),beforeAddClass:ge=>(De=_t(De,ge),Cn),onFinish:Er,isRunning:()=>0!==Ht&&!nn,progressStart:(ge=!1,Te)=>(yi.forEach(vt=>{vt.progressStart(ge,Te)}),Gt(),li=ge,Lt||Ao(),Ur(!1,!0,Te),Cn),progressStep:ge=>(yi.forEach(Te=>{Te.progressStep(ge)}),Br(ge),Cn),progressEnd:(ge,Te,vt)=>(li=!1,yi.forEach(Mt=>{Mt.progressEnd(ge,Te,vt)}),void 0!==vt&&(at=vt),on=!1,en=!0,0===ge?(Ne="reverse"===bn()?"normal":"reverse","reverse"===Ne&&(en=!1),pr?(Ur(),Br(1-Te)):(At=(1-Te)*Ye()*-1,Ur(!1,!1))):1===ge&&(pr?(Ur(),Br(Te)):(At=Te*Ye()*-1,Ur(!1,!1))),void 0!==ge&&(Er(()=>{at=void 0,Ne=void 0,At=void 0},{oneTimeCallback:!0}),ft||Lo()),Cn)}}},1273:(ci,Qt,le)=>{"use strict";le.d(Qt,{E:()=>Dt,a:()=>M,s:()=>pt});const M=st=>{try{if(st instanceof Ke)return st.value;if(!l()||"string"!=typeof st||""===st)return st;if(st.includes("onload="))return"";const bt=document.createDocumentFragment(),mt=document.createElement("div");bt.appendChild(mt),mt.innerHTML=st,ht.forEach(Ct=>{const it=bt.querySelectorAll(Ct);for(let Kt=it.length-1;Kt>=0;Kt--){const Tt=it[Kt];Tt.parentNode?Tt.parentNode.removeChild(Tt):bt.removeChild(Tt);const Ze=Ft(Tt);for(let Fe=0;Fe<Ze.length;Fe++)b(Ze[Fe])}});const Qe=Ft(bt);for(let Ct=0;Ct<Qe.length;Ct++)b(Qe[Ct]);const _t=document.createElement("div");_t.appendChild(bt);const Wt=_t.querySelector("div");return null!==Wt?Wt.innerHTML:_t.innerHTML}catch(bt){return console.error(bt),""}},b=st=>{if(st.nodeType&&1!==st.nodeType)return;if(typeof NamedNodeMap<"u"&&!(st.attributes instanceof NamedNodeMap))return void st.remove();for(let mt=st.attributes.length-1;mt>=0;mt--){const Qe=st.attributes.item(mt),_t=Qe.name;if(!Me.includes(_t.toLowerCase())){st.removeAttribute(_t);continue}const Wt=Qe.value,Ct=st[_t];(null!=Wt&&Wt.toLowerCase().includes("javascript:")||null!=Ct&&Ct.toLowerCase().includes("javascript:"))&&st.removeAttribute(_t)}const bt=Ft(st);for(let mt=0;mt<bt.length;mt++)b(bt[mt])},Ft=st=>null!=st.children?st.children:st.childNodes,l=()=>{var st;const bt=window,mt=null===(st=bt?.Ionic)||void 0===st?void 0:st.config;return!mt||(mt.get?mt.get("sanitizerEnabled",!0):!0===mt.sanitizerEnabled||void 0===mt.sanitizerEnabled)},Me=["class","id","href","src","name","slot"],ht=["script","style","iframe","meta","link","object","embed"];class Ke{constructor(bt){this.value=bt}}const pt=st=>{const bt=window,mt=bt.Ionic;if(!mt||!mt.config||"Object"===mt.config.constructor.name)return bt.Ionic=bt.Ionic||{},bt.Ionic.config=Object.assign(Object.assign({},bt.Ionic.config),st),bt.Ionic.config},Dt=!1},9439:(ci,Qt,le)=>{"use strict";le.d(Qt,{C:()=>Me,a:()=>Ft,d:()=>l});var M=le(5861),b=le(544);const Ft=function(){var ht=(0,M.Z)(function*(Ke,pt,yt,Dt,st,bt){var mt;if(Ke)return Ke.attachViewToDom(pt,yt,st,Dt);if(!(bt||"string"==typeof yt||yt instanceof HTMLElement))throw new Error("framework delegate is missing");const Qe="string"==typeof yt?null===(mt=pt.ownerDocument)||void 0===mt?void 0:mt.createElement(yt):yt;return Dt&&Dt.forEach(_t=>Qe.classList.add(_t)),st&&Object.assign(Qe,st),pt.appendChild(Qe),yield new Promise(_t=>(0,b.c)(Qe,_t)),Qe});return function(pt,yt,Dt,st,bt,mt){return ht.apply(this,arguments)}}(),l=(ht,Ke)=>{if(Ke){if(ht)return ht.removeViewFromDom(Ke.parentElement,Ke);Ke.remove()}return Promise.resolve()},Me=()=>{let ht,Ke;return{attachViewToDom:function(){var Dt=(0,M.Z)(function*(st,bt,mt={},Qe=[]){var _t,Wt;if(ht=st,bt){const it="string"==typeof bt?null===(_t=ht.ownerDocument)||void 0===_t?void 0:_t.createElement(bt):bt;Qe.forEach(Kt=>it.classList.add(Kt)),Object.assign(it,mt),ht.appendChild(it),yield new Promise(Kt=>(0,b.c)(it,Kt))}else if(ht.children.length>0&&("ION-MODAL"===ht.tagName||"ION-POPOVER"===ht.tagName)&&!ht.children[0].classList.contains("ion-delegate-host")){const Kt=null===(Wt=ht.ownerDocument)||void 0===Wt?void 0:Wt.createElement("div");Kt.classList.add("ion-delegate-host"),Qe.forEach(Tt=>Kt.classList.add(Tt)),Kt.append(...ht.children),ht.appendChild(Kt)}const Ct=document.querySelector("ion-app")||document.body;return Ke=document.createComment("ionic teleport"),ht.parentNode.insertBefore(Ke,ht),Ct.appendChild(ht),ht});return function(bt,mt){return Dt.apply(this,arguments)}}(),removeViewFromDom:()=>(ht&&Ke&&(Ke.parentNode.insertBefore(ht,Ke),Ke.remove()),Promise.resolve())}}},4587:(ci,Qt,le)=>{"use strict";le.d(Qt,{G:()=>Me});class b{constructor(Ke,pt,yt,Dt,st){this.id=pt,this.name=yt,this.disableScroll=st,this.priority=1e6*Dt+pt,this.ctrl=Ke}canStart(){return!!this.ctrl&&this.ctrl.canStart(this.name)}start(){return!!this.ctrl&&this.ctrl.start(this.name,this.id,this.priority)}capture(){if(!this.ctrl)return!1;const Ke=this.ctrl.capture(this.name,this.id,this.priority);return Ke&&this.disableScroll&&this.ctrl.disableScroll(this.id),Ke}release(){this.ctrl&&(this.ctrl.release(this.id),this.disableScroll&&this.ctrl.enableScroll(this.id))}destroy(){this.release(),this.ctrl=void 0}}class Ft{constructor(Ke,pt,yt,Dt){this.id=pt,this.disable=yt,this.disableScroll=Dt,this.ctrl=Ke}block(){if(this.ctrl){if(this.disable)for(const Ke of this.disable)this.ctrl.disableGesture(Ke,this.id);this.disableScroll&&this.ctrl.disableScroll(this.id)}}unblock(){if(this.ctrl){if(this.disable)for(const Ke of this.disable)this.ctrl.enableGesture(Ke,this.id);this.disableScroll&&this.ctrl.enableScroll(this.id)}}destroy(){this.unblock(),this.ctrl=void 0}}const l="backdrop-no-scroll",Me=new class M{constructor(){this.gestureId=0,this.requestedStart=new Map,this.disabledGestures=new Map,this.disabledScroll=new Set}createGesture(Ke){var pt;return new b(this,this.newID(),Ke.name,null!==(pt=Ke.priority)&&void 0!==pt?pt:0,!!Ke.disableScroll)}createBlocker(Ke={}){return new Ft(this,this.newID(),Ke.disable,!!Ke.disableScroll)}start(Ke,pt,yt){return this.canStart(Ke)?(this.requestedStart.set(pt,yt),!0):(this.requestedStart.delete(pt),!1)}capture(Ke,pt,yt){if(!this.start(Ke,pt,yt))return!1;const Dt=this.requestedStart;let st=-1e4;if(Dt.forEach(bt=>{st=Math.max(st,bt)}),st===yt){this.capturedId=pt,Dt.clear();const bt=new CustomEvent("ionGestureCaptured",{detail:{gestureName:Ke}});return document.dispatchEvent(bt),!0}return Dt.delete(pt),!1}release(Ke){this.requestedStart.delete(Ke),this.capturedId===Ke&&(this.capturedId=void 0)}disableGesture(Ke,pt){let yt=this.disabledGestures.get(Ke);void 0===yt&&(yt=new Set,this.disabledGestures.set(Ke,yt)),yt.add(pt)}enableGesture(Ke,pt){const yt=this.disabledGestures.get(Ke);void 0!==yt&&yt.delete(pt)}disableScroll(Ke){this.disabledScroll.add(Ke),1===this.disabledScroll.size&&document.body.classList.add(l)}enableScroll(Ke){this.disabledScroll.delete(Ke),0===this.disabledScroll.size&&document.body.classList.remove(l)}canStart(Ke){return!(void 0!==this.capturedId||this.isDisabled(Ke))}isCaptured(){return void 0!==this.capturedId}isScrollDisabled(){return this.disabledScroll.size>0}isDisabled(Ke){const pt=this.disabledGestures.get(Ke);return!!(pt&&pt.size>0)}newID(){return this.gestureId++,this.gestureId}}},5421:(ci,Qt,le)=>{"use strict";le.r(Qt),le.d(Qt,{MENU_BACK_BUTTON_PRIORITY:()=>Me,OVERLAY_BACK_BUTTON_PRIORITY:()=>l,blockHardwareBackButton:()=>b,startHardwareBackButton:()=>Ft});var M=le(5861);const b=()=>{document.addEventListener("backbutton",()=>{})},Ft=()=>{const ht=document;let Ke=!1;ht.addEventListener("backbutton",()=>{if(Ke)return;let pt=0,yt=[];const Dt=new CustomEvent("ionBackButton",{bubbles:!1,detail:{register(mt,Qe){yt.push({priority:mt,handler:Qe,id:pt++})}}});ht.dispatchEvent(Dt);const st=function(){var mt=(0,M.Z)(function*(Qe){try{if(Qe?.handler){const _t=Qe.handler(bt);null!=_t&&(yield _t)}}catch(_t){console.error(_t)}});return function(_t){return mt.apply(this,arguments)}}(),bt=()=>{if(yt.length>0){let mt={priority:Number.MIN_SAFE_INTEGER,handler:()=>{},id:-1};yt.forEach(Qe=>{Qe.priority>=mt.priority&&(mt=Qe)}),Ke=!0,yt=yt.filter(Qe=>Qe.id!==mt.id),st(mt).then(()=>Ke=!1)}};bt()})},l=100,Me=99},544:(ci,Qt,le)=>{"use strict";le.d(Qt,{a:()=>pt,b:()=>yt,c:()=>Ft,d:()=>Wt,e:()=>_t,f:()=>Qe,g:()=>Dt,h:()=>mt,i:()=>Ke,j:()=>Fe,k:()=>Me,l:()=>Ct,m:()=>l,n:()=>bt,o:()=>it,p:()=>Ze,q:()=>$t,r:()=>st,s:()=>un,t:()=>M,u:()=>Kt,v:()=>Tt});const M=(De,dt=0)=>new Promise(Lt=>{b(De,dt,Lt)}),b=(De,dt=0,Lt)=>{let ft,pn;const hn={passive:!0},Jn=()=>{ft&&ft()},Ht=li=>{(void 0===li||De===li.target)&&(Jn(),Lt(li))};return De&&(De.addEventListener("webkitTransitionEnd",Ht,hn),De.addEventListener("transitionend",Ht,hn),pn=setTimeout(Ht,dt+500),ft=()=>{pn&&(clearTimeout(pn),pn=void 0),De.removeEventListener("webkitTransitionEnd",Ht,hn),De.removeEventListener("transitionend",Ht,hn)}),Jn},Ft=(De,dt)=>{De.componentOnReady?De.componentOnReady().then(Lt=>dt(Lt)):st(()=>dt(De))},l=De=>void 0!==De.componentOnReady,Me=(De,dt=[])=>{const Lt={};return dt.forEach(ft=>{De.hasAttribute(ft)&&(null!==De.getAttribute(ft)&&(Lt[ft]=De.getAttribute(ft)),De.removeAttribute(ft))}),Lt},ht=["role","aria-activedescendant","aria-atomic","aria-autocomplete","aria-braillelabel","aria-brailleroledescription","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colindextext","aria-colspan","aria-controls","aria-current","aria-describedby","aria-description","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowindextext","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext"],Ke=(De,dt)=>{let Lt=ht;return dt&&dt.length>0&&(Lt=Lt.filter(ft=>!dt.includes(ft))),Me(De,Lt)},pt=(De,dt,Lt,ft)=>{var pn;if(typeof window<"u"){const hn=window,Vt=null===(pn=hn?.Ionic)||void 0===pn?void 0:pn.config;if(Vt){const Jn=Vt.get("_ael");if(Jn)return Jn(De,dt,Lt,ft);if(Vt._ael)return Vt._ael(De,dt,Lt,ft)}}return De.addEventListener(dt,Lt,ft)},yt=(De,dt,Lt,ft)=>{var pn;if(typeof window<"u"){const hn=window,Vt=null===(pn=hn?.Ionic)||void 0===pn?void 0:pn.config;if(Vt){const Jn=Vt.get("_rel");if(Jn)return Jn(De,dt,Lt,ft);if(Vt._rel)return Vt._rel(De,dt,Lt,ft)}}return De.removeEventListener(dt,Lt,ft)},Dt=(De,dt=De)=>De.shadowRoot||dt,st=De=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(De):"function"==typeof requestAnimationFrame?requestAnimationFrame(De):setTimeout(De),bt=De=>!!De.shadowRoot&&!!De.attachShadow,mt=De=>{const dt=De.closest("ion-item");return dt?dt.querySelector("ion-label"):null},Qe=De=>{if(De.focus(),De.classList.contains("ion-focusable")){const dt=De.closest("ion-app");dt&&dt.setFocus([De])}},_t=(De,dt)=>{let Lt;const ft=De.getAttribute("aria-labelledby"),pn=De.id;let hn=null!==ft&&""!==ft.trim()?ft:dt+"-lbl",Vt=null!==ft&&""!==ft.trim()?document.getElementById(ft):mt(De);return Vt?(null===ft&&(Vt.id=hn),Lt=Vt.textContent,Vt.setAttribute("aria-hidden","true")):""!==pn.trim()&&(Vt=document.querySelector(`label[for="${pn}"]`),Vt&&(""!==Vt.id?hn=Vt.id:Vt.id=hn=`${pn}-lbl`,Lt=Vt.textContent)),{label:Vt,labelId:hn,labelText:Lt}},Wt=(De,dt,Lt,ft,pn)=>{if(De||bt(dt)){let hn=dt.querySelector("input.aux-input");hn||(hn=dt.ownerDocument.createElement("input"),hn.type="hidden",hn.classList.add("aux-input"),dt.appendChild(hn)),hn.disabled=pn,hn.name=Lt,hn.value=ft||""}},Ct=(De,dt,Lt)=>Math.max(De,Math.min(dt,Lt)),it=(De,dt)=>{if(!De){const Lt="ASSERT: "+dt;throw console.error(Lt),new Error(Lt)}},Kt=De=>De.timeStamp||Date.now(),Tt=De=>{if(De){const dt=De.changedTouches;if(dt&&dt.length>0){const Lt=dt[0];return{x:Lt.clientX,y:Lt.clientY}}if(void 0!==De.pageX)return{x:De.pageX,y:De.pageY}}return{x:0,y:0}},Ze=De=>{const dt="rtl"===document.dir;switch(De){case"start":return dt;case"end":return!dt;default:throw new Error(`"${De}" is not a valid value for [side]. Use "start" or "end" instead.`)}},Fe=(De,dt)=>{const Lt=De._original||De;return{_original:De,emit:$t(Lt.emit.bind(Lt),dt)}},$t=(De,dt=0)=>{let Lt;return(...ft)=>{clearTimeout(Lt),Lt=setTimeout(De,dt,...ft)}},un=(De,dt)=>{if(De??(De={}),dt??(dt={}),De===dt)return!0;const Lt=Object.keys(De);if(Lt.length!==Object.keys(dt).length)return!1;for(const ft of Lt)if(!(ft in dt)||De[ft]!==dt[ft])return!1;return!0}},6953:(ci,Qt,le)=>{"use strict";le.d(Qt,{B:()=>st,H:()=>Jn,a:()=>Qo,b:()=>bi,c:()=>on,d:()=>nn,e:()=>Un,f:()=>Cn,g:()=>Zn,h:()=>hn,i:()=>rt,j:()=>bt,p:()=>so,r:()=>qi,w:()=>Pi});var M=le(5861);let Ft,l,Me,ht=!1,Ke=!1,pt=!1,yt=!1,Dt=!1;const st={isDev:!1,isBrowser:!0,isServer:!1,isTesting:!1},bt=se=>{const Oe=new URL(se,Ni.$resourcesUrl$);return Oe.origin!==Ur.location.origin?Oe.href:Oe.pathname},Kt="s-id",Tt="sty-id",$t="http://www.w3.org/1999/xlink",un={},ft=se=>"object"==(se=typeof se)||"function"===se;function pn(se){var Oe,ge,Te;return null!==(Te=null===(ge=null===(Oe=se.head)||void 0===Oe?void 0:Oe.querySelector('meta[name="csp-nonce"]'))||void 0===ge?void 0:ge.getAttribute("content"))&&void 0!==Te?Te:void 0}const hn=(se,Oe,...ge)=>{let Te=null,vt=null,Mt=null,sn=!1,mn=!1;const an=[],Tn=vi=>{for(let Fi=0;Fi<vi.length;Fi++)Te=vi[Fi],Array.isArray(Te)?Tn(Te):null!=Te&&"boolean"!=typeof Te&&((sn="function"!=typeof se&&!ft(Te))&&(Te=String(Te)),sn&&mn?an[an.length-1].$text$+=Te:an.push(sn?Vt(null,Te):Te),mn=sn)};if(Tn(ge),Oe){Oe.key&&(vt=Oe.key),Oe.name&&(Mt=Oe.name);{const vi=Oe.className||Oe.class;vi&&(Oe.class="object"!=typeof vi?vi:Object.keys(vi).filter(Fi=>vi[Fi]).join(" "))}}if("function"==typeof se)return se(null===Oe?{}:Oe,an,li);const ii=Vt(se,null);return ii.$attrs$=Oe,an.length>0&&(ii.$children$=an),ii.$key$=vt,ii.$name$=Mt,ii},Vt=(se,Oe)=>({$flags$:0,$tag$:se,$text$:Oe,$elm$:null,$children$:null,$attrs$:null,$key$:null,$name$:null}),Jn={},li={forEach:(se,Oe)=>se.map(tn).forEach(Oe),map:(se,Oe)=>se.map(tn).map(Oe).map(Re)},tn=se=>({vattrs:se.$attrs$,vchildren:se.$children$,vkey:se.$key$,vname:se.$name$,vtag:se.$tag$,vtext:se.$text$}),Re=se=>{if("function"==typeof se.vtag){const ge=Object.assign({},se.vattrs);return se.vkey&&(ge.key=se.vkey),se.vname&&(ge.name=se.vname),hn(se.vtag,ge,...se.vchildren||[])}const Oe=Vt(se.vtag,se.vtext);return Oe.$attrs$=se.vattrs,Oe.$children$=se.vchildren,Oe.$key$=se.vkey,Oe.$name$=se.vname,Oe},at=(se,Oe,ge,Te,vt,Mt,sn)=>{let mn,an,Tn,ii;if(1===Mt.nodeType){for(mn=Mt.getAttribute("c-id"),mn&&(an=mn.split("."),(an[0]===sn||"0"===an[0])&&(Tn={$flags$:0,$hostId$:an[0],$nodeId$:an[1],$depth$:an[2],$index$:an[3],$tag$:Mt.tagName.toLowerCase(),$elm$:Mt,$attrs$:null,$children$:null,$key$:null,$name$:null,$text$:null},Oe.push(Tn),Mt.removeAttribute("c-id"),se.$children$||(se.$children$=[]),se.$children$[Tn.$index$]=Tn,se=Tn,Te&&"0"===Tn.$depth$&&(Te[Tn.$index$]=Tn.$elm$))),ii=Mt.childNodes.length-1;ii>=0;ii--)at(se,Oe,ge,Te,vt,Mt.childNodes[ii],sn);if(Mt.shadowRoot)for(ii=Mt.shadowRoot.childNodes.length-1;ii>=0;ii--)at(se,Oe,ge,Te,vt,Mt.shadowRoot.childNodes[ii],sn)}else if(8===Mt.nodeType)an=Mt.nodeValue.split("."),(an[1]===sn||"0"===an[1])&&(mn=an[0],Tn={$flags$:0,$hostId$:an[1],$nodeId$:an[2],$depth$:an[3],$index$:an[4],$elm$:Mt,$attrs$:null,$children$:null,$key$:null,$name$:null,$tag$:null,$text$:null},"t"===mn?(Tn.$elm$=Mt.nextSibling,Tn.$elm$&&3===Tn.$elm$.nodeType&&(Tn.$text$=Tn.$elm$.textContent,Oe.push(Tn),Mt.remove(),se.$children$||(se.$children$=[]),se.$children$[Tn.$index$]=Tn,Te&&"0"===Tn.$depth$&&(Te[Tn.$index$]=Tn.$elm$))):Tn.$hostId$===sn&&("s"===mn?(Tn.$tag$="slot",Mt["s-sn"]=an[5]?Tn.$name$=an[5]:"",Mt["s-sr"]=!0,Te&&(Tn.$elm$=xr.createElement(Tn.$tag$),Tn.$name$&&Tn.$elm$.setAttribute("name",Tn.$name$),Mt.parentNode.insertBefore(Tn.$elm$,Mt),Mt.remove(),"0"===Tn.$depth$&&(Te[Tn.$index$]=Tn.$elm$)),ge.push(Tn),se.$children$||(se.$children$=[]),se.$children$[Tn.$index$]=Tn):"r"===mn&&(Te?Mt.remove():(vt["s-cr"]=Mt,Mt["s-cn"]=!0))));else if(se&&"style"===se.$tag$){const vi=Vt(null,Mt.textContent);vi.$elm$=Mt,vi.$index$="0",se.$children$=[vi]}},At=(se,Oe)=>{if(1===se.nodeType){let ge=0;for(;ge<se.childNodes.length;ge++)At(se.childNodes[ge],Oe);if(se.shadowRoot)for(ge=0;ge<se.shadowRoot.childNodes.length;ge++)At(se.shadowRoot.childNodes[ge],Oe)}else if(8===se.nodeType){const ge=se.nodeValue.split(".");"o"===ge[0]&&(Oe.set(ge[1]+"."+ge[2],se),se.nodeValue="",se["s-en"]=ge[3])}},on=se=>Hi.push(se),Zn=se=>Wr(se).$modeName$,Cn=se=>Wr(se).$hostElement$,nn=(se,Oe,ge)=>{const Te=Cn(se);return{emit:vt=>xt(Te,Oe,{bubbles:!!(4&ge),composed:!!(2&ge),cancelable:!!(1&ge),detail:vt})}},xt=(se,Oe,ge)=>{const Te=Ni.ce(Oe,ge);return se.dispatchEvent(Te),Te},St=new WeakMap,xn=(se,Oe,ge)=>{let Te=Dr.get(se);Rr&&ge?(Te=Te||new CSSStyleSheet,"string"==typeof Te?Te=Oe:Te.replaceSync(Oe)):Te=Oe,Dr.set(se,Te)},Hn=(se,Oe,ge,Te)=>{var vt;let Mt=qn(Oe,ge);const sn=Dr.get(Mt);if(se=11===se.nodeType?se:xr,sn)if("string"==typeof sn){let an,mn=St.get(se=se.head||se);if(mn||St.set(se,mn=new Set),!mn.has(Mt)){if(se.host&&(an=se.querySelector(`[${Tt}="${Mt}"]`)))an.innerHTML=sn;else{an=xr.createElement("style"),an.innerHTML=sn;const Tn=null!==(vt=Ni.$nonce$)&&void 0!==vt?vt:pn(xr);null!=Tn&&an.setAttribute("nonce",Tn),se.insertBefore(an,se.querySelector("link"))}mn&&mn.add(Mt)}}else se.adoptedStyleSheets.includes(sn)||(se.adoptedStyleSheets=[...se.adoptedStyleSheets,sn]);return Mt},qn=(se,Oe)=>"sc-"+(Oe&&32&se.$flags$?se.$tagName$+"-"+Oe:se.$tagName$),ti=se=>se.replace(/\/\*!@([^\/]+)\*\/[^\{]+\{/g,"$1{"),Xn=(se,Oe,ge,Te,vt,Mt)=>{if(ge!==Te){let sn=Uo(se,Oe),mn=Oe.toLowerCase();if("class"===Oe){const an=se.classList,Tn=yn(ge),ii=yn(Te);an.remove(...Tn.filter(vi=>vi&&!ii.includes(vi))),an.add(...ii.filter(vi=>vi&&!Tn.includes(vi)))}else if("style"===Oe){for(const an in ge)(!Te||null==Te[an])&&(an.includes("-")?se.style.removeProperty(an):se.style[an]="");for(const an in Te)(!ge||Te[an]!==ge[an])&&(an.includes("-")?se.style.setProperty(an,Te[an]):se.style[an]=Te[an])}else if("key"!==Oe)if("ref"===Oe)Te&&Te(se);else if(sn||"o"!==Oe[0]||"n"!==Oe[1]){const an=ft(Te);if((sn||an&&null!==Te)&&!vt)try{if(se.tagName.includes("-"))se[Oe]=Te;else{const ii=Te??"";"list"===Oe?sn=!1:(null==ge||se[Oe]!=ii)&&(se[Oe]=ii)}}catch{}let Tn=!1;mn!==(mn=mn.replace(/^xlink\:?/,""))&&(Oe=mn,Tn=!0),null==Te||!1===Te?(!1!==Te||""===se.getAttribute(Oe))&&(Tn?se.removeAttributeNS($t,Oe):se.removeAttribute(Oe)):(!sn||4&Mt||vt)&&!an&&(Te=!0===Te?"":Te,Tn?se.setAttributeNS($t,Oe,Te):se.setAttribute(Oe,Te))}else Oe="-"===Oe[2]?Oe.slice(3):Uo(Ur,mn)?mn.slice(2):mn[2]+Oe.slice(3),ge&&Ni.rel(se,Oe,ge,!1),Te&&Ni.ael(se,Oe,Te,!1)}},ar=/\s/,yn=se=>se?se.split(ar):[],lr=(se,Oe,ge,Te)=>{const vt=11===Oe.$elm$.nodeType&&Oe.$elm$.host?Oe.$elm$.host:Oe.$elm$,Mt=se&&se.$attrs$||un,sn=Oe.$attrs$||un;for(Te in Mt)Te in sn||Xn(vt,Te,Mt[Te],void 0,ge,Oe.$flags$);for(Te in sn)Xn(vt,Te,Mt[Te],sn[Te],ge,Oe.$flags$)},Pr=(se,Oe,ge,Te)=>{const vt=Oe.$children$[ge];let sn,mn,an,Mt=0;if(ht||(pt=!0,"slot"===vt.$tag$&&(Ft&&Te.classList.add(Ft+"-s"),vt.$flags$|=vt.$children$?2:1)),null!==vt.$text$)sn=vt.$elm$=xr.createTextNode(vt.$text$);else if(1&vt.$flags$)sn=vt.$elm$=xr.createTextNode("");else{if(yt||(yt="svg"===vt.$tag$),sn=vt.$elm$=xr.createElementNS(yt?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",2&vt.$flags$?"slot-fb":vt.$tag$),yt&&"foreignObject"===vt.$tag$&&(yt=!1),lr(null,vt,yt),(se=>null!=se)(Ft)&&sn["s-si"]!==Ft&&sn.classList.add(sn["s-si"]=Ft),vt.$children$)for(Mt=0;Mt<vt.$children$.length;++Mt)mn=Pr(se,vt,Mt,sn),mn&&sn.appendChild(mn);"svg"===vt.$tag$?yt=!1:"foreignObject"===sn.tagName&&(yt=!0)}return sn["s-hn"]=Me,3&vt.$flags$&&(sn["s-sr"]=!0,sn["s-cr"]=l,sn["s-sn"]=vt.$name$||"",an=se&&se.$children$&&se.$children$[ge],an&&an.$tag$===vt.$tag$&&se.$elm$&&pr(se.$elm$,!1)),sn},pr=(se,Oe)=>{Ni.$flags$|=1;const ge=se.childNodes;for(let Te=ge.length-1;Te>=0;Te--){const vt=ge[Te];vt["s-hn"]!==Me&&vt["s-ol"]&&(Hr(vt).insertBefore(vt,wi(vt)),vt["s-ol"].remove(),vt["s-ol"]=void 0,pt=!0),Oe&&pr(vt,Oe)}Ni.$flags$&=-2},oo=(se,Oe,ge,Te,vt,Mt)=>{let mn,sn=se["s-cr"]&&se["s-cr"].parentNode||se;for(sn.shadowRoot&&sn.tagName===Me&&(sn=sn.shadowRoot);vt<=Mt;++vt)Te[vt]&&(mn=Pr(null,ge,vt,se),mn&&(Te[vt].$elm$=mn,sn.insertBefore(mn,wi(Oe))))},Si=(se,Oe,ge)=>{for(let Te=Oe;Te<=ge;++Te){const vt=se[Te];if(vt){const Mt=vt.$elm$;rr(vt),Mt&&(Ke=!0,Mt["s-ol"]?Mt["s-ol"].remove():pr(Mt,!0),Mt.remove())}}},po=(se,Oe)=>se.$tag$===Oe.$tag$&&("slot"===se.$tag$?se.$name$===Oe.$name$:se.$key$===Oe.$key$),wi=se=>se&&se["s-ol"]||se,Hr=se=>(se["s-ol"]?se["s-ol"]:se).parentNode,Er=(se,Oe)=>{const ge=Oe.$elm$=se.$elm$,Te=se.$children$,vt=Oe.$children$,Mt=Oe.$tag$,sn=Oe.$text$;let mn;null===sn?(yt="svg"===Mt||"foreignObject"!==Mt&&yt,"slot"===Mt||lr(se,Oe,yt),null!==Te&&null!==vt?((se,Oe,ge,Te)=>{let jo,mo,vt=0,Mt=0,sn=0,mn=0,an=Oe.length-1,Tn=Oe[0],ii=Oe[an],vi=Te.length-1,Fi=Te[0],br=Te[vi];for(;vt<=an&&Mt<=vi;)if(null==Tn)Tn=Oe[++vt];else if(null==ii)ii=Oe[--an];else if(null==Fi)Fi=Te[++Mt];else if(null==br)br=Te[--vi];else if(po(Tn,Fi))Er(Tn,Fi),Tn=Oe[++vt],Fi=Te[++Mt];else if(po(ii,br))Er(ii,br),ii=Oe[--an],br=Te[--vi];else if(po(Tn,br))("slot"===Tn.$tag$||"slot"===br.$tag$)&&pr(Tn.$elm$.parentNode,!1),Er(Tn,br),se.insertBefore(Tn.$elm$,ii.$elm$.nextSibling),Tn=Oe[++vt],br=Te[--vi];else if(po(ii,Fi))("slot"===Tn.$tag$||"slot"===br.$tag$)&&pr(ii.$elm$.parentNode,!1),Er(ii,Fi),se.insertBefore(ii.$elm$,Tn.$elm$),ii=Oe[--an],Fi=Te[++Mt];else{for(sn=-1,mn=vt;mn<=an;++mn)if(Oe[mn]&&null!==Oe[mn].$key$&&Oe[mn].$key$===Fi.$key$){sn=mn;break}sn>=0?(mo=Oe[sn],mo.$tag$!==Fi.$tag$?jo=Pr(Oe&&Oe[Mt],ge,sn,se):(Er(mo,Fi),Oe[sn]=void 0,jo=mo.$elm$),Fi=Te[++Mt]):(jo=Pr(Oe&&Oe[Mt],ge,Mt,se),Fi=Te[++Mt]),jo&&Hr(Tn.$elm$).insertBefore(jo,wi(Tn.$elm$))}vt>an?oo(se,null==Te[vi+1]?null:Te[vi+1].$elm$,ge,Te,Mt,vi):Mt>vi&&Si(Oe,vt,an)})(ge,Te,Oe,vt):null!==vt?(null!==se.$text$&&(ge.textContent=""),oo(ge,null,Oe,vt,0,vt.length-1)):null!==Te&&Si(Te,0,Te.length-1),yt&&"svg"===Mt&&(yt=!1)):(mn=ge["s-cr"])?mn.parentNode.textContent=sn:se.$text$!==sn&&(ge.data=sn)},fi=se=>{const Oe=se.childNodes;let ge,Te,vt,Mt,sn,mn;for(Te=0,vt=Oe.length;Te<vt;Te++)if(ge=Oe[Te],1===ge.nodeType){if(ge["s-sr"])for(sn=ge["s-sn"],ge.hidden=!1,Mt=0;Mt<vt;Mt++)if(mn=Oe[Mt].nodeType,Oe[Mt]["s-hn"]!==ge["s-hn"]||""!==sn){if(1===mn&&sn===Oe[Mt].getAttribute("slot")){ge.hidden=!0;break}}else if(1===mn||3===mn&&""!==Oe[Mt].textContent.trim()){ge.hidden=!0;break}fi(ge)}},Sr=[],gr=se=>{let Oe,ge,Te,vt,Mt,sn,mn=0;const an=se.childNodes,Tn=an.length;for(;mn<Tn;mn++){if(Oe=an[mn],Oe["s-sr"]&&(ge=Oe["s-cr"])&&ge.parentNode)for(Te=ge.parentNode.childNodes,vt=Oe["s-sn"],sn=Te.length-1;sn>=0;sn--)ge=Te[sn],!ge["s-cn"]&&!ge["s-nr"]&&ge["s-hn"]!==Oe["s-hn"]&&(ir(ge,vt)?(Mt=Sr.find(ii=>ii.$nodeToRelocate$===ge),Ke=!0,ge["s-sn"]=ge["s-sn"]||vt,Mt?Mt.$slotRefNode$=Oe:Sr.push({$slotRefNode$:Oe,$nodeToRelocate$:ge}),ge["s-sr"]&&Sr.map(ii=>{ir(ii.$nodeToRelocate$,ge["s-sn"])&&(Mt=Sr.find(vi=>vi.$nodeToRelocate$===ge),Mt&&!ii.$slotRefNode$&&(ii.$slotRefNode$=Mt.$slotRefNode$))})):Sr.some(ii=>ii.$nodeToRelocate$===ge)||Sr.push({$nodeToRelocate$:ge}));1===Oe.nodeType&&gr(Oe)}},ir=(se,Oe)=>1===se.nodeType?null===se.getAttribute("slot")&&""===Oe||se.getAttribute("slot")===Oe:se["s-sn"]===Oe||""===Oe,rr=se=>{se.$attrs$&&se.$attrs$.ref&&se.$attrs$.ref(null),se.$children$&&se.$children$.map(rr)},Ue=(se,Oe)=>{Oe&&!se.$onRenderResolve$&&Oe["s-p"]&&Oe["s-p"].push(new Promise(ge=>se.$onRenderResolve$=ge))},ae=(se,Oe)=>{if(se.$flags$|=16,!(4&se.$flags$))return Ue(se,se.$ancestorComponent$),Pi(()=>de(se,Oe));se.$flags$|=512},de=(se,Oe)=>{const Te=se.$lazyInstance$;let vt;return Oe&&(se.$flags$|=256,se.$queuedListeners$&&(se.$queuedListeners$.map(([Mt,sn])=>bn(Te,Mt,sn)),se.$queuedListeners$=void 0),vt=bn(Te,"componentWillLoad")),vt=Le(vt,()=>bn(Te,"componentWillRender")),Le(vt,()=>ot(se,Te,Oe))},Le=(se,Oe)=>We(se)?se.then(Oe):Oe(),We=se=>se instanceof Promise||se&&se.then&&"function"==typeof se.then,ot=function(){var se=(0,M.Z)(function*(Oe,ge,Te){var vt;const Mt=Oe.$hostElement$,mn=Mt["s-rc"];Te&&(se=>{const Oe=se.$cmpMeta$,ge=se.$hostElement$,Te=Oe.$flags$,Mt=Hn(ge.shadowRoot?ge.shadowRoot:ge.getRootNode(),Oe,se.$modeName$);10&Te&&(ge["s-sc"]=Mt,ge.classList.add(Mt+"-h"),2&Te&&ge.classList.add(Mt+"-s"))})(Oe);Rt(Oe,ge),mn&&(mn.map(Tn=>Tn()),Mt["s-rc"]=void 0);{const Tn=null!==(vt=Mt["s-p"])&&void 0!==vt?vt:[],ii=()=>It(Oe);0===Tn.length?ii():(Promise.all(Tn).then(ii),Oe.$flags$|=4,Tn.length=0)}});return function(ge,Te,vt){return se.apply(this,arguments)}}(),Rt=(se,Oe,ge)=>{try{Oe=Oe.render&&Oe.render(),se.$flags$&=-17,se.$flags$|=2,((se,Oe)=>{const ge=se.$hostElement$,Te=se.$cmpMeta$,vt=se.$vnode$||Vt(null,null),Mt=(se=>se&&se.$tag$===Jn)(Oe)?Oe:hn(null,null,Oe);if(Me=ge.tagName,Te.$attrsToReflect$&&(Mt.$attrs$=Mt.$attrs$||{},Te.$attrsToReflect$.map(([sn,mn])=>Mt.$attrs$[mn]=ge[sn])),Mt.$tag$=null,Mt.$flags$|=4,se.$vnode$=Mt,Mt.$elm$=vt.$elm$=ge.shadowRoot||ge,Ft=ge["s-sc"],l=ge["s-cr"],ht=0!=(1&Te.$flags$),Ke=!1,Er(vt,Mt),Ni.$flags$|=1,pt){gr(Mt.$elm$);let sn,mn,an,Tn,ii,vi,Fi=0;for(;Fi<Sr.length;Fi++)sn=Sr[Fi],mn=sn.$nodeToRelocate$,mn["s-ol"]||(an=xr.createTextNode(""),an["s-nr"]=mn,mn.parentNode.insertBefore(mn["s-ol"]=an,mn));for(Fi=0;Fi<Sr.length;Fi++)if(sn=Sr[Fi],mn=sn.$nodeToRelocate$,sn.$slotRefNode$){for(Tn=sn.$slotRefNode$.parentNode,ii=sn.$slotRefNode$.nextSibling,an=mn["s-ol"];an=an.previousSibling;)if(vi=an["s-nr"],vi&&vi["s-sn"]===mn["s-sn"]&&Tn===vi.parentNode&&(vi=vi.nextSibling,!vi||!vi["s-nr"])){ii=vi;break}(!ii&&Tn!==mn.parentNode||mn.nextSibling!==ii)&&mn!==ii&&(!mn["s-hn"]&&mn["s-ol"]&&(mn["s-hn"]=mn["s-ol"].parentNode.nodeName),Tn.insertBefore(mn,ii))}else 1===mn.nodeType&&(mn.hidden=!0)}Ke&&fi(Mt.$elm$),Ni.$flags$&=-2,Sr.length=0})(se,Oe)}catch(Te){qr(Te,se.$hostElement$)}return null},It=se=>{const ge=se.$hostElement$,vt=se.$lazyInstance$,Mt=se.$ancestorComponent$;bn(vt,"componentDidRender"),64&se.$flags$?bn(vt,"componentDidUpdate"):(se.$flags$|=64,Pn(ge),bn(vt,"componentDidLoad"),se.$onReadyResolve$(ge),Mt||Bt()),se.$onInstanceResolve$(ge),se.$onRenderResolve$&&(se.$onRenderResolve$(),se.$onRenderResolve$=void 0),512&se.$flags$&&Lo(()=>ae(se,!1)),se.$flags$&=-517},rt=se=>{{const Oe=Wr(se),ge=Oe.$hostElement$.isConnected;return ge&&2==(18&Oe.$flags$)&&ae(Oe,!1),ge}},Bt=se=>{Pn(xr.documentElement),Lo(()=>xt(Ur,"appload",{detail:{namespace:"ionic"}}))},bn=(se,Oe,ge)=>{if(se&&se[Oe])try{return se[Oe](ge)}catch(Te){qr(Te)}},Pn=se=>se.classList.add("hydrated"),wt=(se,Oe,ge)=>{if(Oe.$members$){se.watchers&&(Oe.$watchers$=se.watchers);const Te=Object.entries(Oe.$members$),vt=se.prototype;if(Te.map(([Mt,[sn]])=>{31&sn||2&ge&&32&sn?Object.defineProperty(vt,Mt,{get(){return((se,Oe)=>Wr(this).$instanceValues$.get(Oe))(0,Mt)},set(mn){((se,Oe,ge,Te)=>{const vt=Wr(se),Mt=vt.$hostElement$,sn=vt.$instanceValues$.get(Oe),mn=vt.$flags$,an=vt.$lazyInstance$;ge=((se,Oe)=>null==se||ft(se)?se:4&Oe?"false"!==se&&(""===se||!!se):2&Oe?parseFloat(se):1&Oe?String(se):se)(ge,Te.$members$[Oe][0]);const Tn=Number.isNaN(sn)&&Number.isNaN(ge);if((!(8&mn)||void 0===sn)&&ge!==sn&&!Tn&&(vt.$instanceValues$.set(Oe,ge),an)){if(Te.$watchers$&&128&mn){const vi=Te.$watchers$[Oe];vi&&vi.map(Fi=>{try{an[Fi](ge,sn,Oe)}catch(br){qr(br,Mt)}})}2==(18&mn)&&ae(vt,!1)}})(this,Mt,mn,Oe)},configurable:!0,enumerable:!0}):1&ge&&64&sn&&Object.defineProperty(vt,Mt,{value(...mn){const an=Wr(this);return an.$onInstancePromise$.then(()=>an.$lazyInstance$[Mt](...mn))}})}),1&ge){const Mt=new Map;vt.attributeChangedCallback=function(sn,mn,an){Ni.jmp(()=>{const Tn=Mt.get(sn);if(this.hasOwnProperty(Tn))an=this[Tn],delete this[Tn];else if(vt.hasOwnProperty(Tn)&&"number"==typeof this[Tn]&&this[Tn]==an)return;this[Tn]=(null!==an||"boolean"!=typeof this[Tn])&&an})},se.observedAttributes=Te.filter(([sn,mn])=>15&mn[0]).map(([sn,mn])=>{const an=mn[1]||sn;return Mt.set(an,sn),512&mn[0]&&Oe.$attrsToReflect$.push([sn,an]),an})}}return se},Ge=function(){var se=(0,M.Z)(function*(Oe,ge,Te,vt,Mt){if(!(32&ge.$flags$)){ge.$flags$|=32;{if((Mt=Br(Te)).then){const Tn=()=>{};Mt=yield Mt,Tn()}Mt.isProxied||(Te.$watchers$=Mt.watchers,wt(Mt,Te,2),Mt.isProxied=!0);const an=()=>{};ge.$flags$|=8;try{new Mt(ge)}catch(Tn){qr(Tn)}ge.$flags$&=-9,ge.$flags$|=128,an(),Ot(ge.$lazyInstance$)}if(Mt.style){let an=Mt.style;"string"!=typeof an&&(an=an[ge.$modeName$=(se=>Hi.map(Oe=>Oe(se)).find(Oe=>!!Oe))(Oe)]);const Tn=qn(Te,ge.$modeName$);if(!Dr.has(Tn)){const ii=()=>{};xn(Tn,an,!!(1&Te.$flags$)),ii()}}}const sn=ge.$ancestorComponent$,mn=()=>ae(ge,!0);sn&&sn["s-rc"]?sn["s-rc"].push(mn):mn()});return function(ge,Te,vt,Mt,sn){return se.apply(this,arguments)}}(),Ot=se=>{bn(se,"connectedCallback")},$n=se=>{const Oe=se["s-cr"]=xr.createComment("");Oe["s-cn"]=!0,se.insertBefore(Oe,se.firstChild)},bi=(se,Oe={})=>{var ge;const vt=[],Mt=Oe.exclude||[],sn=Ur.customElements,mn=xr.head,an=mn.querySelector("meta[charset]"),Tn=xr.createElement("style"),ii=[],vi=xr.querySelectorAll(`[${Tt}]`);let Fi,br=!0,jo=0;for(Object.assign(Ni,Oe),Ni.$resourcesUrl$=new URL(Oe.resourcesUrl||"./",xr.baseURI).href,Ni.$flags$|=2;jo<vi.length;jo++)xn(vi[jo].getAttribute(Tt),ti(vi[jo].innerHTML),!0);se.map(mo=>{mo[1].map(To=>{const go={$flags$:To[0],$tagName$:To[1],$members$:To[2],$listeners$:To[3]};go.$members$=To[2],go.$listeners$=To[3],go.$attrsToReflect$=[],go.$watchers$={};const ao=go.$tagName$,Po=class extends HTMLElement{constructor(cr){super(cr),Mo(cr=this,go),1&go.$flags$&&cr.attachShadow({mode:"open",delegatesFocus:!!(16&go.$flags$)})}connectedCallback(){Fi&&(clearTimeout(Fi),Fi=null),br?ii.push(this):Ni.jmp(()=>(se=>{if(!(1&Ni.$flags$)){const Oe=Wr(se),ge=Oe.$cmpMeta$,Te=()=>{};if(1&Oe.$flags$)Ui(se,Oe,ge.$listeners$),Ot(Oe.$lazyInstance$);else{let vt;if(Oe.$flags$|=1,vt=se.getAttribute(Kt),vt){if(1&ge.$flags$){const Mt=Hn(se.shadowRoot,ge,se.getAttribute("s-mode"));se.classList.remove(Mt+"-h",Mt+"-s")}((se,Oe,ge,Te)=>{const Mt=se.shadowRoot,sn=[],an=Mt?[]:null,Tn=Te.$vnode$=Vt(Oe,null);Ni.$orgLocNodes$||At(xr.body,Ni.$orgLocNodes$=new Map),se[Kt]=ge,se.removeAttribute(Kt),at(Tn,sn,[],an,se,se,ge),sn.map(ii=>{const vi=ii.$hostId$+"."+ii.$nodeId$,Fi=Ni.$orgLocNodes$.get(vi),br=ii.$elm$;Fi&&Gt&&""===Fi["s-en"]&&Fi.parentNode.insertBefore(br,Fi.nextSibling),Mt||(br["s-hn"]=Oe,Fi&&(br["s-ol"]=Fi,br["s-ol"]["s-nr"]=br)),Ni.$orgLocNodes$.delete(vi)}),Mt&&an.map(ii=>{ii&&Mt.appendChild(ii)})})(se,ge.$tagName$,vt,Oe)}vt||12&ge.$flags$&&$n(se);{let Mt=se;for(;Mt=Mt.parentNode||Mt.host;)if(1===Mt.nodeType&&Mt.hasAttribute("s-id")&&Mt["s-p"]||Mt["s-p"]){Ue(Oe,Oe.$ancestorComponent$=Mt);break}}ge.$members$&&Object.entries(ge.$members$).map(([Mt,[sn]])=>{if(31&sn&&se.hasOwnProperty(Mt)){const mn=se[Mt];delete se[Mt],se[Mt]=mn}}),Ge(se,Oe,ge)}Te()}})(this))}disconnectedCallback(){Ni.jmp(()=>(se=>{if(!(1&Ni.$flags$)){const Oe=Wr(this),ge=Oe.$lazyInstance$;Oe.$rmListeners$&&(Oe.$rmListeners$.map(Te=>Te()),Oe.$rmListeners$=void 0),bn(ge,"disconnectedCallback")}})())}componentOnReady(){return Wr(this).$onReadyPromise$}};go.$lazyBundleId$=mo[0],!Mt.includes(ao)&&!sn.get(ao)&&(vt.push(ao),sn.define(ao,wt(Po,go,1)))})});{Tn.innerHTML=vt+"{visibility:hidden}.hydrated{visibility:inherit}",Tn.setAttribute("data-styles","");const mo=null!==(ge=Ni.$nonce$)&&void 0!==ge?ge:pn(xr);null!=mo&&Tn.setAttribute("nonce",mo),mn.insertBefore(Tn,an?an.nextSibling:mn.firstChild)}br=!1,ii.length?ii.map(mo=>mo.connectedCallback()):Ni.jmp(()=>Fi=setTimeout(Bt,30))},Ui=(se,Oe,ge,Te)=>{ge&&ge.map(([vt,Mt,sn])=>{const mn=vr(se,vt),an=ji(Oe,sn),Tn=Di(vt);Ni.ael(mn,Mt,an,Tn),(Oe.$rmListeners$=Oe.$rmListeners$||[]).push(()=>Ni.rel(mn,Mt,an,Tn))})},ji=(se,Oe)=>ge=>{try{256&se.$flags$?se.$lazyInstance$[Oe](ge):(se.$queuedListeners$=se.$queuedListeners$||[]).push([Oe,ge])}catch(Te){qr(Te)}},vr=(se,Oe)=>4&Oe?xr:8&Oe?Ur:16&Oe?xr.body:se,Di=se=>0!=(2&se),Gr=new WeakMap,Wr=se=>Gr.get(se),qi=(se,Oe)=>Gr.set(Oe.$lazyInstance$=se,Oe),Mo=(se,Oe)=>{const ge={$flags$:0,$hostElement$:se,$cmpMeta$:Oe,$instanceValues$:new Map};return ge.$onInstancePromise$=new Promise(Te=>ge.$onInstanceResolve$=Te),ge.$onReadyPromise$=new Promise(Te=>ge.$onReadyResolve$=Te),se["s-p"]=[],se["s-rc"]=[],Ui(se,ge,Oe.$listeners$),Gr.set(se,ge)},Uo=(se,Oe)=>Oe in se,qr=(se,Oe)=>(0,console.error)(se,Oe),Ao=new Map,Br=(se,Oe,ge)=>{const Te=se.$tagName$.replace(/-/g,"_"),vt=se.$lazyBundleId$,Mt=Ao.get(vt);return Mt?Mt[Te]:le(863)(`./${vt}.entry.js`).then(sn=>(Ao.set(vt,sn),sn[Te]),qr)},Dr=new Map,Hi=[],Ur=typeof window<"u"?window:{},xr=Ur.document||{head:{}},Ni={$flags$:0,$resourcesUrl$:"",jmp:se=>se(),raf:se=>requestAnimationFrame(se),ael:(se,Oe,ge,Te)=>se.addEventListener(Oe,ge,Te),rel:(se,Oe,ge,Te)=>se.removeEventListener(Oe,ge,Te),ce:(se,Oe)=>new CustomEvent(se,Oe)},Qo=se=>{Object.assign(Ni,se)},Gt=!0,so=se=>Promise.resolve(se),Rr=(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replaceSync}catch{}return!1})(),Or=[],es=[],Co=(se,Oe)=>ge=>{se.push(ge),Dt||(Dt=!0,Oe&&4&Ni.$flags$?Lo(Yr):Ni.raf(Yr))},os=se=>{for(let Oe=0;Oe<se.length;Oe++)try{se[Oe](performance.now())}catch(ge){qr(ge)}se.length=0},Yr=()=>{os(Or),os(es),(Dt=Or.length>0)&&Ni.raf(Yr)},Lo=se=>so().then(se),Un=Co(Or,!1),Pi=Co(es,!0)},8077:(ci,Qt,le)=>{"use strict";le.r(Qt),le.d(Qt,{GESTURE_CONTROLLER:()=>M.G,createGesture:()=>yt});var M=le(4587);const b=(mt,Qe,_t,Wt)=>{const Ct=Ft(mt)?{capture:!!Wt.capture,passive:!!Wt.passive}:!!Wt.capture;let it,Kt;return mt.__zone_symbol__addEventListener?(it="__zone_symbol__addEventListener",Kt="__zone_symbol__removeEventListener"):(it="addEventListener",Kt="removeEventListener"),mt[it](Qe,_t,Ct),()=>{mt[Kt](Qe,_t,Ct)}},Ft=mt=>{if(void 0===l)try{const Qe=Object.defineProperty({},"passive",{get:()=>{l=!0}});mt.addEventListener("optsTest",()=>{},Qe)}catch{l=!1}return!!l};let l;const Ke=mt=>mt instanceof Document?mt:mt.ownerDocument,yt=mt=>{let Qe=!1,_t=!1,Wt=!0,Ct=!1;const it=Object.assign({disableScroll:!1,direction:"x",gesturePriority:0,passive:!0,maxAngle:40,threshold:10},mt),Kt=it.canStart,Tt=it.onWillStart,Ze=it.onStart,Fe=it.onEnd,$t=it.notCaptured,un=it.onMove,De=it.threshold,dt=it.passive,Lt=it.blurOnStart,ft={type:"pan",startX:0,startY:0,startTime:0,currentX:0,currentY:0,velocityX:0,velocityY:0,deltaX:0,deltaY:0,currentTime:0,event:void 0,data:void 0},pn=((mt,Qe,_t)=>{const Wt=_t*(Math.PI/180),Ct="x"===mt,it=Math.cos(Wt),Kt=Qe*Qe;let Tt=0,Ze=0,Fe=!1,$t=0;return{start(un,De){Tt=un,Ze=De,$t=0,Fe=!0},detect(un,De){if(!Fe)return!1;const dt=un-Tt,Lt=De-Ze,ft=dt*dt+Lt*Lt;if(ft<Kt)return!1;const pn=Math.sqrt(ft),hn=(Ct?dt:Lt)/pn;return $t=hn>it?1:hn<-it?-1:0,Fe=!1,!0},isGesture:()=>0!==$t,getDirection:()=>$t}})(it.direction,it.threshold,it.maxAngle),hn=M.G.createGesture({name:mt.gestureName,priority:mt.gesturePriority,disableScroll:mt.disableScroll}),Ht=()=>{Qe&&(Ct=!1,un&&un(ft))},li=()=>!!hn.capture()&&(Qe=!0,Wt=!1,ft.startX=ft.currentX,ft.startY=ft.currentY,ft.startTime=ft.currentTime,Tt?Tt(ft).then(Re):Re(),!0),Re=()=>{Lt&&(()=>{if(typeof document<"u"){const on=document.activeElement;on?.blur&&on.blur()}})(),Ze&&Ze(ft),Wt=!0},Ne=()=>{Qe=!1,_t=!1,Ct=!1,Wt=!0,hn.release()},at=on=>{const Zn=Qe,ri=Wt;if(Ne(),ri){if(Dt(ft,on),Zn)return void(Fe&&Fe(ft));$t&&$t(ft)}},At=((mt,Qe,_t,Wt,Ct)=>{let it,Kt,Tt,Ze,Fe,$t,un,De=0;const dt=tn=>{De=Date.now()+2e3,Qe(tn)&&(!Kt&&_t&&(Kt=b(mt,"touchmove",_t,Ct)),Tt||(Tt=b(tn.target,"touchend",ft,Ct)),Ze||(Ze=b(tn.target,"touchcancel",ft,Ct)))},Lt=tn=>{De>Date.now()||Qe(tn)&&(!$t&&_t&&($t=b(Ke(mt),"mousemove",_t,Ct)),un||(un=b(Ke(mt),"mouseup",pn,Ct)))},ft=tn=>{hn(),Wt&&Wt(tn)},pn=tn=>{Vt(),Wt&&Wt(tn)},hn=()=>{Kt&&Kt(),Tt&&Tt(),Ze&&Ze(),Kt=Tt=Ze=void 0},Vt=()=>{$t&&$t(),un&&un(),$t=un=void 0},Jn=()=>{hn(),Vt()},Ht=(tn=!0)=>{tn?(it||(it=b(mt,"touchstart",dt,Ct)),Fe||(Fe=b(mt,"mousedown",Lt,Ct))):(it&&it(),Fe&&Fe(),it=Fe=void 0,Jn())};return{enable:Ht,stop:Jn,destroy:()=>{Ht(!1),Wt=_t=Qe=void 0}}})(it.el,on=>{const Zn=bt(on);return!(_t||!Wt||(st(on,ft),ft.startX=ft.currentX,ft.startY=ft.currentY,ft.startTime=ft.currentTime=Zn,ft.velocityX=ft.velocityY=ft.deltaX=ft.deltaY=0,ft.event=on,Kt&&!1===Kt(ft))||(hn.release(),!hn.start()))&&(_t=!0,0===De?li():(pn.start(ft.startX,ft.startY),!0))},on=>{Qe?!Ct&&Wt&&(Ct=!0,Dt(ft,on),requestAnimationFrame(Ht)):(Dt(ft,on),pn.detect(ft.currentX,ft.currentY)&&(!pn.isGesture()||!li())&&en())},at,{capture:!1,passive:dt}),en=()=>{Ne(),At.stop(),$t&&$t(ft)};return{enable(on=!0){on||(Qe&&at(void 0),Ne()),At.enable(on)},destroy(){hn.destroy(),At.destroy()}}},Dt=(mt,Qe)=>{if(!Qe)return;const _t=mt.currentX,Wt=mt.currentY,Ct=mt.currentTime;st(Qe,mt);const it=mt.currentX,Kt=mt.currentY,Ze=(mt.currentTime=bt(Qe))-Ct;if(Ze>0&&Ze<100){const $t=(Kt-Wt)/Ze;mt.velocityX=(it-_t)/Ze*.7+.3*mt.velocityX,mt.velocityY=.7*$t+.3*mt.velocityY}mt.deltaX=it-mt.startX,mt.deltaY=Kt-mt.startY,mt.event=Qe},st=(mt,Qe)=>{let _t=0,Wt=0;if(mt){const Ct=mt.changedTouches;if(Ct&&Ct.length>0){const it=Ct[0];_t=it.clientX,Wt=it.clientY}else void 0!==mt.pageX&&(_t=mt.pageX,Wt=mt.pageY)}Qe.currentX=_t,Qe.currentY=Wt},bt=mt=>mt.timeStamp||Date.now()},1767:(ci,Qt,le)=>{"use strict";le.d(Qt,{m:()=>st});var M=le(5861),b=le(5421),Ft=le(544),l=le(7876),Me=le(6506);const ht=bt=>(0,Me.c)().duration(bt?400:300),Ke=bt=>{let mt,Qe;const _t=bt.width+8,Wt=(0,Me.c)(),Ct=(0,Me.c)();bt.isEndSide?(mt=_t+"px",Qe="0px"):(mt=-_t+"px",Qe="0px"),Wt.addElement(bt.menuInnerEl).fromTo("transform",`translateX(${mt})`,`translateX(${Qe})`);const Kt="ios"===(0,l.b)(bt),Tt=Kt?.2:.25;return Ct.addElement(bt.backdropEl).fromTo("opacity",.01,Tt),ht(Kt).addAnimation([Wt,Ct])},pt=bt=>{let mt,Qe;const _t=(0,l.b)(bt),Wt=bt.width;bt.isEndSide?(mt=-Wt+"px",Qe=Wt+"px"):(mt=Wt+"px",Qe=-Wt+"px");const Ct=(0,Me.c)().addElement(bt.menuInnerEl).fromTo("transform",`translateX(${Qe})`,"translateX(0px)"),it=(0,Me.c)().addElement(bt.contentEl).fromTo("transform","translateX(0px)",`translateX(${mt})`),Kt=(0,Me.c)().addElement(bt.backdropEl).fromTo("opacity",.01,.32);return ht("ios"===_t).addAnimation([Ct,it,Kt])},yt=bt=>{const mt=(0,l.b)(bt),Qe=bt.width*(bt.isEndSide?-1:1)+"px",_t=(0,Me.c)().addElement(bt.contentEl).fromTo("transform","translateX(0px)",`translateX(${Qe})`);return ht("ios"===mt).addAnimation(_t)},st=(()=>{const bt=new Map,mt=[],Qe=function(){var Re=(0,M.Z)(function*(Ne){const at=yield Ze(Ne);return!!at&&at.open()});return function(at){return Re.apply(this,arguments)}}(),_t=function(){var Re=(0,M.Z)(function*(Ne){const at=yield void 0!==Ne?Ze(Ne):Fe();return void 0!==at&&at.close()});return function(at){return Re.apply(this,arguments)}}(),Wt=function(){var Re=(0,M.Z)(function*(Ne){const at=yield Ze(Ne);return!!at&&at.toggle()});return function(at){return Re.apply(this,arguments)}}(),Ct=function(){var Re=(0,M.Z)(function*(Ne,at){const At=yield Ze(at);return At&&(At.disabled=!Ne),At});return function(at,At){return Re.apply(this,arguments)}}(),it=function(){var Re=(0,M.Z)(function*(Ne,at){const At=yield Ze(at);return At&&(At.swipeGesture=Ne),At});return function(at,At){return Re.apply(this,arguments)}}(),Kt=function(){var Re=(0,M.Z)(function*(Ne){if(null!=Ne){const at=yield Ze(Ne);return void 0!==at&&at.isOpen()}return void 0!==(yield Fe())});return function(at){return Re.apply(this,arguments)}}(),Tt=function(){var Re=(0,M.Z)(function*(Ne){const at=yield Ze(Ne);return!!at&&!at.disabled});return function(at){return Re.apply(this,arguments)}}(),Ze=function(){var Re=(0,M.Z)(function*(Ne){return yield tn(),"start"===Ne||"end"===Ne?li(en=>en.side===Ne&&!en.disabled)||li(en=>en.side===Ne):null!=Ne?li(At=>At.menuId===Ne):li(At=>!At.disabled)||(mt.length>0?mt[0].el:void 0)});return function(at){return Re.apply(this,arguments)}}(),Fe=function(){var Re=(0,M.Z)(function*(){return yield tn(),Vt()});return function(){return Re.apply(this,arguments)}}(),$t=function(){var Re=(0,M.Z)(function*(){return yield tn(),Jn()});return function(){return Re.apply(this,arguments)}}(),un=function(){var Re=(0,M.Z)(function*(){return yield tn(),Ht()});return function(){return Re.apply(this,arguments)}}(),De=(Re,Ne)=>{bt.set(Re,Ne)},ft=Re=>{const Ne=Re.side;mt.filter(at=>at.side===Ne&&at!==Re).forEach(at=>at.disabled=!0)},pn=function(){var Re=(0,M.Z)(function*(Ne,at,At){if(Ht())return!1;if(at){const en=yield Fe();en&&Ne.el!==en&&(yield en.setOpen(!1,!1))}return Ne._setOpen(at,At)});return function(at,At,en){return Re.apply(this,arguments)}}(),Vt=()=>li(Re=>Re._isOpen),Jn=()=>mt.map(Re=>Re.el),Ht=()=>mt.some(Re=>Re.isAnimating),li=Re=>{const Ne=mt.find(Re);if(void 0!==Ne)return Ne.el},tn=()=>Promise.all(Array.from(document.querySelectorAll("ion-menu")).map(Re=>new Promise(Ne=>(0,Ft.c)(Re,Ne))));return De("reveal",yt),De("push",pt),De("overlay",Ke),typeof document<"u"&&document.addEventListener("ionBackButton",Re=>{const Ne=Vt();Ne&&Re.detail.register(b.MENU_BACK_BUTTON_PRIORITY,()=>Ne.close())}),{registerAnimation:De,get:Ze,getMenus:$t,getOpen:Fe,isEnabled:Tt,swipeGesture:it,isAnimating:un,isOpen:Kt,enable:Ct,toggle:Wt,close:_t,open:Qe,_getOpenSync:Vt,_createAnimation:(Re,Ne)=>{const at=bt.get(Re);if(!at)throw new Error("animation not registered");return at(Ne)},_register:Re=>{mt.indexOf(Re)<0&&(Re.disabled||ft(Re),mt.push(Re))},_unregister:Re=>{const Ne=mt.indexOf(Re);Ne>-1&&mt.splice(Ne,1)},_setOpen:pn,_setActiveMenu:ft}})()},8354:(ci,Qt,le)=>{"use strict";le.d(Qt,{L:()=>l,a:()=>Me,b:()=>ht,c:()=>Ke,d:()=>pt,e:()=>De,g:()=>ft,l:()=>$t,s:()=>dt,t:()=>st,w:()=>un});var M=le(5861),b=le(6953),Ft=le(544);const l="ionViewWillEnter",Me="ionViewDidEnter",ht="ionViewWillLeave",Ke="ionViewDidLeave",pt="ionViewWillUnload",st=pn=>new Promise((hn,Vt)=>{(0,b.w)(()=>{bt(pn),mt(pn).then(Jn=>{Jn.animation&&Jn.animation.destroy(),Qe(pn),hn(Jn)},Jn=>{Qe(pn),Vt(Jn)})})}),bt=pn=>{const hn=pn.enteringEl,Vt=pn.leavingEl;Lt(hn,Vt,pn.direction),pn.showGoBack?hn.classList.add("can-go-back"):hn.classList.remove("can-go-back"),dt(hn,!1),hn.style.setProperty("pointer-events","none"),Vt&&(dt(Vt,!1),Vt.style.setProperty("pointer-events","none"))},mt=function(){var pn=(0,M.Z)(function*(hn){const Vt=yield _t(hn);return Vt&&b.B.isBrowser?Wt(Vt,hn):Ct(hn)});return function(Vt){return pn.apply(this,arguments)}}(),Qe=pn=>{const hn=pn.enteringEl,Vt=pn.leavingEl;hn.classList.remove("ion-page-invisible"),hn.style.removeProperty("pointer-events"),void 0!==Vt&&(Vt.classList.remove("ion-page-invisible"),Vt.style.removeProperty("pointer-events"))},_t=function(){var pn=(0,M.Z)(function*(hn){return hn.leavingEl&&hn.animated&&0!==hn.duration?hn.animationBuilder?hn.animationBuilder:"ios"===hn.mode?(yield Promise.resolve().then(le.bind(le,8899))).iosTransitionAnimation:(yield Promise.resolve().then(le.bind(le,5298))).mdTransitionAnimation:void 0});return function(Vt){return pn.apply(this,arguments)}}(),Wt=function(){var pn=(0,M.Z)(function*(hn,Vt){yield it(Vt,!0);const Jn=hn(Vt.baseEl,Vt);Ze(Vt.enteringEl,Vt.leavingEl);const Ht=yield Tt(Jn,Vt);return Vt.progressCallback&&Vt.progressCallback(void 0),Ht&&Fe(Vt.enteringEl,Vt.leavingEl),{hasCompleted:Ht,animation:Jn}});return function(Vt,Jn){return pn.apply(this,arguments)}}(),Ct=function(){var pn=(0,M.Z)(function*(hn){const Vt=hn.enteringEl,Jn=hn.leavingEl;return yield it(hn,!1),Ze(Vt,Jn),Fe(Vt,Jn),{hasCompleted:!0}});return function(Vt){return pn.apply(this,arguments)}}(),it=function(){var pn=(0,M.Z)(function*(hn,Vt){(void 0!==hn.deepWait?hn.deepWait:Vt)&&(yield Promise.all([De(hn.enteringEl),De(hn.leavingEl)])),yield Kt(hn.viewIsReady,hn.enteringEl)});return function(Vt,Jn){return pn.apply(this,arguments)}}(),Kt=function(){var pn=(0,M.Z)(function*(hn,Vt){hn&&(yield hn(Vt))});return function(Vt,Jn){return pn.apply(this,arguments)}}(),Tt=(pn,hn)=>{const Vt=hn.progressCallback,Jn=new Promise(Ht=>{pn.onFinish(li=>Ht(1===li))});return Vt?(pn.progressStart(!0),Vt(pn)):pn.play(),Jn},Ze=(pn,hn)=>{$t(hn,ht),$t(pn,l)},Fe=(pn,hn)=>{$t(pn,Me),$t(hn,Ke)},$t=(pn,hn)=>{if(pn){const Vt=new CustomEvent(hn,{bubbles:!1,cancelable:!1});pn.dispatchEvent(Vt)}},un=()=>new Promise(pn=>(0,Ft.r)(()=>(0,Ft.r)(()=>pn()))),De=function(){var pn=(0,M.Z)(function*(hn){const Vt=hn;if(Vt){if(null!=Vt.componentOnReady){if(null!=(yield Vt.componentOnReady()))return}else if(null!=Vt.__registerHost)return void(yield new Promise(Ht=>(0,Ft.r)(Ht)));yield Promise.all(Array.from(Vt.children).map(De))}});return function(Vt){return pn.apply(this,arguments)}}(),dt=(pn,hn)=>{hn?(pn.setAttribute("aria-hidden","true"),pn.classList.add("ion-page-hidden")):(pn.hidden=!1,pn.removeAttribute("aria-hidden"),pn.classList.remove("ion-page-hidden"))},Lt=(pn,hn,Vt)=>{void 0!==pn&&(pn.style.zIndex="back"===Vt?"99":"101"),void 0!==hn&&(hn.style.zIndex="100")},ft=pn=>pn.classList.contains("ion-page")?pn:pn.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")||pn},7643:(ci,Qt,le)=>{"use strict";le.d(Qt,{d:()=>b,w:()=>M});const M=typeof window<"u"?window:void 0,b=typeof document<"u"?document:void 0},7690:(ci,Qt,le)=>{"use strict";le.d(Qt,{a:()=>b,b:()=>Ft,p:()=>M});const M=(l,...Me)=>console.warn(`[Ionic Warning]: ${l}`,...Me),b=(l,...Me)=>console.error(`[Ionic Error]: ${l}`,...Me),Ft=(l,...Me)=>console.error(`<${l.tagName.toLowerCase()}> must be used inside ${Me.join(" or ")}.`)},7876:(ci,Qt,le)=>{"use strict";le.d(Qt,{a:()=>st,b:()=>Ht,c:()=>Ft,g:()=>Dt,i:()=>li});var M=le(6953);class b{constructor(){this.m=new Map}reset(Re){this.m=new Map(Object.entries(Re))}get(Re,Ne){const at=this.m.get(Re);return void 0!==at?at:Ne}getBoolean(Re,Ne=!1){const at=this.m.get(Re);return void 0===at?Ne:"string"==typeof at?"true"===at:!!at}getNumber(Re,Ne){const at=parseFloat(this.m.get(Re));return isNaN(at)?void 0!==Ne?Ne:NaN:at}set(Re,Ne){this.m.set(Re,Ne)}}const Ft=new b,yt="ionic-persist-config",Dt=tn=>bt(tn),st=(tn,Re)=>("string"==typeof tn&&(Re=tn,tn=void 0),Dt(tn).includes(Re)),bt=(tn=window)=>{if(typeof tn>"u")return[];tn.Ionic=tn.Ionic||{};let Re=tn.Ionic.platforms;return null==Re&&(Re=tn.Ionic.platforms=mt(tn),Re.forEach(Ne=>tn.document.documentElement.classList.add(`plt-${Ne}`))),Re},mt=tn=>{const Re=Ft.get("platform");return Object.keys(Vt).filter(Ne=>{const at=Re?.[Ne];return"function"==typeof at?at(tn):Vt[Ne](tn)})},_t=tn=>!!(pn(tn,/iPad/i)||pn(tn,/Macintosh/i)&&Fe(tn)),it=tn=>pn(tn,/android|sink/i),Fe=tn=>hn(tn,"(any-pointer:coarse)"),un=tn=>De(tn)||dt(tn),De=tn=>!!(tn.cordova||tn.phonegap||tn.PhoneGap),dt=tn=>{const Re=tn.Capacitor;return!!Re?.isNative},pn=(tn,Re)=>Re.test(tn.navigator.userAgent),hn=(tn,Re)=>{var Ne;return null===(Ne=tn.matchMedia)||void 0===Ne?void 0:Ne.call(tn,Re).matches},Vt={ipad:_t,iphone:tn=>pn(tn,/iPhone/i),ios:tn=>pn(tn,/iPhone|iPod/i)||_t(tn),android:it,phablet:tn=>{const Re=tn.innerWidth,Ne=tn.innerHeight,at=Math.min(Re,Ne),At=Math.max(Re,Ne);return at>390&&at<520&&At>620&&At<800},tablet:tn=>{const Re=tn.innerWidth,Ne=tn.innerHeight,at=Math.min(Re,Ne),At=Math.max(Re,Ne);return _t(tn)||(tn=>it(tn)&&!pn(tn,/mobile/i))(tn)||at>460&&at<820&&At>780&&At<1400},cordova:De,capacitor:dt,electron:tn=>pn(tn,/electron/i),pwa:tn=>{var Re;return!!(null!==(Re=tn.matchMedia)&&void 0!==Re&&Re.call(tn,"(display-mode: standalone)").matches||tn.navigator.standalone)},mobile:Fe,mobileweb:tn=>Fe(tn)&&!un(tn),desktop:tn=>!Fe(tn),hybrid:un};let Jn;const Ht=tn=>tn&&(0,M.g)(tn)||Jn,li=(tn={})=>{if(typeof window>"u")return;const Re=window.document,Ne=window,at=Ne.Ionic=Ne.Ionic||{},At={};tn._ael&&(At.ael=tn._ael),tn._rel&&(At.rel=tn._rel),tn._ce&&(At.ce=tn._ce),(0,M.a)(At);const en=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},(tn=>{try{const Re=tn.sessionStorage.getItem(yt);return null!==Re?JSON.parse(Re):{}}catch{return{}}})(Ne)),{persistConfig:!1}),at.config),(tn=>{const Re={};return tn.location.search.slice(1).split("&").map(Ne=>Ne.split("=")).map(([Ne,at])=>[decodeURIComponent(Ne),decodeURIComponent(at)]).filter(([Ne])=>((tn,Re)=>tn.substr(0,Re.length)===Re)(Ne,"ionic:")).map(([Ne,at])=>[Ne.slice(6),at]).forEach(([Ne,at])=>{Re[Ne]=at}),Re})(Ne)),tn);Ft.reset(en),Ft.getBoolean("persistConfig")&&((tn,Re)=>{try{tn.sessionStorage.setItem(yt,JSON.stringify(Re))}catch{return}})(Ne,en),bt(Ne),at.config=Ft,at.mode=Jn=Ft.get("mode",Re.documentElement.getAttribute("mode")||(st(Ne,"ios")?"ios":"md")),Ft.set("mode",Jn),Re.documentElement.setAttribute("mode",Jn),Re.documentElement.classList.add(Jn),Ft.getBoolean("_testing")&&Ft.set("animated",!1);const on=ri=>{var Cn;return null===(Cn=ri.tagName)||void 0===Cn?void 0:Cn.startsWith("ION-")},Zn=ri=>["ios","md"].includes(ri);(0,M.c)(ri=>{for(;ri;){const Cn=ri.mode||ri.getAttribute("mode");if(Cn){if(Zn(Cn))return Cn;on(ri)&&console.warn('Invalid ionic mode: "'+Cn+'", expected: "ios" or "md"')}ri=ri.parentElement}return Jn})}},8899:(ci,Qt,le)=>{"use strict";le.r(Qt),le.d(Qt,{iosTransitionAnimation:()=>mt,shadow:()=>Ke});var M=le(6506),b=le(8354);le(7643),le(6953);const ht=Qe=>document.querySelector(`${Qe}.ion-cloned-element`),Ke=Qe=>Qe.shadowRoot||Qe,pt=Qe=>{const _t="ION-TABS"===Qe.tagName?Qe:Qe.querySelector("ion-tabs"),Wt="ion-content ion-header:not(.header-collapse-condense-inactive) ion-title.title-large";if(null!=_t){const Ct=_t.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");return null!=Ct?Ct.querySelector(Wt):null}return Qe.querySelector(Wt)},yt=(Qe,_t)=>{const Wt="ION-TABS"===Qe.tagName?Qe:Qe.querySelector("ion-tabs");let Ct=[];if(null!=Wt){const it=Wt.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");null!=it&&(Ct=it.querySelectorAll("ion-buttons"))}else Ct=Qe.querySelectorAll("ion-buttons");for(const it of Ct){const Kt=it.closest("ion-header"),Tt=Kt&&!Kt.classList.contains("header-collapse-condense-inactive"),Ze=it.querySelector("ion-back-button"),Fe=it.classList.contains("buttons-collapse");if(null!==Ze&&("start"===it.slot||""===it.slot)&&(Fe&&Tt&&_t||!Fe))return Ze}return null},st=(Qe,_t,Wt,Ct,it,Kt)=>{const Tt=_t?`calc(100% - ${Kt.right+4}px)`:Kt.left-4+"px",Ze=_t?"7px":"-7px",Fe=_t?"-4px":"4px",$t=_t?"-4px":"4px",un=_t?"right":"left",De=_t?"left":"right",ft=Wt?[{offset:0,opacity:1,transform:`translate3d(${Fe}, ${Kt.top-46}px, 0) scale(1)`},{offset:.6,opacity:0},{offset:1,opacity:0,transform:`translate3d(${Ze}, ${it.top-40}px, 0) scale(2.1)`}]:[{offset:0,opacity:0,transform:`translate3d(${Ze}, ${it.top-40}px, 0) scale(2.1)`},{offset:1,opacity:1,transform:`translate3d(${Fe}, ${Kt.top-46}px, 0) scale(1)`}],Vt=Wt?[{offset:0,opacity:1,transform:`translate3d(${$t}, ${Kt.top-46}px, 0) scale(1)`},{offset:.2,opacity:0,transform:`translate3d(${$t}, ${Kt.top-41}px, 0) scale(0.6)`},{offset:1,opacity:0,transform:`translate3d(${$t}, ${Kt.top-41}px, 0) scale(0.6)`}]:[{offset:0,opacity:0,transform:`translate3d(${$t}, ${Kt.top-41}px, 0) scale(0.6)`},{offset:1,opacity:1,transform:`translate3d(${$t}, ${Kt.top-46}px, 0) scale(1)`}],Jn=(0,M.c)(),Ht=(0,M.c)(),li=ht("ion-back-button"),tn=Ke(li).querySelector(".button-text"),Re=Ke(li).querySelector("ion-icon");li.text=Ct.text,li.mode=Ct.mode,li.icon=Ct.icon,li.color=Ct.color,li.disabled=Ct.disabled,li.style.setProperty("display","block"),li.style.setProperty("position","fixed"),Ht.addElement(Re),Jn.addElement(tn),Jn.beforeStyles({"transform-origin":`${un} center`}).beforeAddWrite(()=>{Ct.style.setProperty("display","none"),li.style.setProperty(un,Tt)}).afterAddWrite(()=>{Ct.style.setProperty("display",""),li.style.setProperty("display","none"),li.style.removeProperty(un)}).keyframes(ft),Ht.beforeStyles({"transform-origin":`${De} center`}).keyframes(Vt),Qe.addAnimation([Jn,Ht])},bt=(Qe,_t,Wt,Ct,it,Kt)=>{const Tt=_t?`calc(100% - ${it.right}px)`:`${it.left}px`,Ze=_t?"-18px":"18px",Fe=_t?"right":"left",De=Wt?[{offset:0,opacity:0,transform:`translate3d(${Ze}, ${Kt.top-4}px, 0) scale(0.49)`},{offset:.1,opacity:0},{offset:1,opacity:1,transform:`translate3d(0, ${it.top-2}px, 0) scale(1)`}]:[{offset:0,opacity:.99,transform:`translate3d(0, ${it.top-2}px, 0) scale(1)`},{offset:.6,opacity:0},{offset:1,opacity:0,transform:`translate3d(${Ze}, ${Kt.top-4}px, 0) scale(0.5)`}],dt=ht("ion-title"),Lt=(0,M.c)();dt.innerText=Ct.innerText,dt.size=Ct.size,dt.color=Ct.color,Lt.addElement(dt),Lt.beforeStyles({"transform-origin":`${Fe} center`,height:"46px",display:"",position:"relative",[Fe]:Tt}).beforeAddWrite(()=>{Ct.style.setProperty("display","none")}).afterAddWrite(()=>{Ct.style.setProperty("display",""),dt.style.setProperty("display","none")}).keyframes(De),Qe.addAnimation(Lt)},mt=(Qe,_t)=>{var Wt;try{const Ct="cubic-bezier(0.32,0.72,0,1)",it="opacity",Kt="transform",Tt="0%",Fe="rtl"===Qe.ownerDocument.dir,$t=Fe?"-99.5%":"99.5%",un=Fe?"33%":"-33%",De=_t.enteringEl,dt=_t.leavingEl,Lt="back"===_t.direction,ft=De.querySelector(":scope > ion-content"),pn=De.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *"),hn=De.querySelectorAll(":scope > ion-header > ion-toolbar"),Vt=(0,M.c)(),Jn=(0,M.c)();if(Vt.addElement(De).duration((null!==(Wt=_t.duration)&&void 0!==Wt?Wt:0)||540).easing(_t.easing||Ct).fill("both").beforeRemoveClass("ion-page-invisible"),dt&&null!=Qe){const Re=(0,M.c)();Re.addElement(Qe),Vt.addAnimation(Re)}if(ft||0!==hn.length||0!==pn.length?(Jn.addElement(ft),Jn.addElement(pn)):Jn.addElement(De.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),Vt.addAnimation(Jn),Lt?Jn.beforeClearStyles([it]).fromTo("transform",`translateX(${un})`,`translateX(${Tt})`).fromTo(it,.8,1):Jn.beforeClearStyles([it]).fromTo("transform",`translateX(${$t})`,`translateX(${Tt})`),ft){const Re=Ke(ft).querySelector(".transition-effect");if(Re){const Ne=Re.querySelector(".transition-cover"),at=Re.querySelector(".transition-shadow"),At=(0,M.c)(),en=(0,M.c)(),on=(0,M.c)();At.addElement(Re).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),en.addElement(Ne).beforeClearStyles([it]).fromTo(it,0,.1),on.addElement(at).beforeClearStyles([it]).fromTo(it,.03,.7),At.addAnimation([en,on]),Jn.addAnimation([At])}}const Ht=De.querySelector("ion-header.header-collapse-condense"),{forward:li,backward:tn}=((Qe,_t,Wt,Ct,it)=>{const Kt=yt(Ct,Wt),Tt=pt(it),Ze=pt(Ct),Fe=yt(it,Wt),$t=null!==Kt&&null!==Tt&&!Wt,un=null!==Ze&&null!==Fe&&Wt;if($t){const De=Tt.getBoundingClientRect(),dt=Kt.getBoundingClientRect();bt(Qe,_t,Wt,Tt,De,dt),st(Qe,_t,Wt,Kt,De,dt)}else if(un){const De=Ze.getBoundingClientRect(),dt=Fe.getBoundingClientRect();bt(Qe,_t,Wt,Ze,De,dt),st(Qe,_t,Wt,Fe,De,dt)}return{forward:$t,backward:un}})(Vt,Fe,Lt,De,dt);if(hn.forEach(Re=>{const Ne=(0,M.c)();Ne.addElement(Re),Vt.addAnimation(Ne);const at=(0,M.c)();at.addElement(Re.querySelector("ion-title"));const At=(0,M.c)(),en=Array.from(Re.querySelectorAll("ion-buttons,[menuToggle]")),on=Re.closest("ion-header"),Zn=on?.classList.contains("header-collapse-condense-inactive");let ri;ri=en.filter(Lt?xn=>{const Hn=xn.classList.contains("buttons-collapse");return Hn&&!Zn||!Hn}:xn=>!xn.classList.contains("buttons-collapse")),At.addElement(ri);const Cn=(0,M.c)();Cn.addElement(Re.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])"));const nn=(0,M.c)();nn.addElement(Ke(Re).querySelector(".toolbar-background"));const xt=(0,M.c)(),St=Re.querySelector("ion-back-button");if(St&&xt.addElement(St),Ne.addAnimation([at,At,Cn,nn,xt]),At.fromTo(it,.01,1),Cn.fromTo(it,.01,1),Lt)Zn||at.fromTo("transform",`translateX(${un})`,`translateX(${Tt})`).fromTo(it,.01,1),Cn.fromTo("transform",`translateX(${un})`,`translateX(${Tt})`),xt.fromTo(it,.01,1);else if(Ht||at.fromTo("transform",`translateX(${$t})`,`translateX(${Tt})`).fromTo(it,.01,1),Cn.fromTo("transform",`translateX(${$t})`,`translateX(${Tt})`),nn.beforeClearStyles([it,"transform"]),on?.translucent?nn.fromTo("transform",Fe?"translateX(-100%)":"translateX(100%)","translateX(0px)"):nn.fromTo(it,.01,"var(--opacity)"),li||xt.fromTo(it,.01,1),St&&!li){const Hn=(0,M.c)();Hn.addElement(Ke(St).querySelector(".button-text")).fromTo("transform",Fe?"translateX(-100px)":"translateX(100px)","translateX(0px)"),Ne.addAnimation(Hn)}}),dt){const Re=(0,M.c)(),Ne=dt.querySelector(":scope > ion-content"),at=dt.querySelectorAll(":scope > ion-header > ion-toolbar"),At=dt.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *");if(Ne||0!==at.length||0!==At.length?(Re.addElement(Ne),Re.addElement(At)):Re.addElement(dt.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),Vt.addAnimation(Re),Lt){Re.beforeClearStyles([it]).fromTo("transform",`translateX(${Tt})`,Fe?"translateX(-100%)":"translateX(100%)");const en=(0,b.g)(dt);Vt.afterAddWrite(()=>{"normal"===Vt.getDirection()&&en.style.setProperty("display","none")})}else Re.fromTo("transform",`translateX(${Tt})`,`translateX(${un})`).fromTo(it,1,.8);if(Ne){const en=Ke(Ne).querySelector(".transition-effect");if(en){const on=en.querySelector(".transition-cover"),Zn=en.querySelector(".transition-shadow"),ri=(0,M.c)(),Cn=(0,M.c)(),nn=(0,M.c)();ri.addElement(en).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),Cn.addElement(on).beforeClearStyles([it]).fromTo(it,.1,0),nn.addElement(Zn).beforeClearStyles([it]).fromTo(it,.7,.03),ri.addAnimation([Cn,nn]),Re.addAnimation([ri])}}at.forEach(en=>{const on=(0,M.c)();on.addElement(en);const Zn=(0,M.c)();Zn.addElement(en.querySelector("ion-title"));const ri=(0,M.c)(),Cn=en.querySelectorAll("ion-buttons,[menuToggle]"),nn=en.closest("ion-header"),xt=nn?.classList.contains("header-collapse-condense-inactive"),St=Array.from(Cn).filter(Xn=>{const ar=Xn.classList.contains("buttons-collapse");return ar&&!xt||!ar});ri.addElement(St);const xn=(0,M.c)(),Hn=en.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])");Hn.length>0&&xn.addElement(Hn);const yi=(0,M.c)();yi.addElement(Ke(en).querySelector(".toolbar-background"));const qn=(0,M.c)(),ti=en.querySelector("ion-back-button");if(ti&&qn.addElement(ti),on.addAnimation([Zn,ri,xn,qn,yi]),Vt.addAnimation(on),qn.fromTo(it,.99,0),ri.fromTo(it,.99,0),xn.fromTo(it,.99,0),Lt){if(xt||Zn.fromTo("transform",`translateX(${Tt})`,Fe?"translateX(-100%)":"translateX(100%)").fromTo(it,.99,0),xn.fromTo("transform",`translateX(${Tt})`,Fe?"translateX(-100%)":"translateX(100%)"),yi.beforeClearStyles([it,"transform"]),nn?.translucent?yi.fromTo("transform","translateX(0px)",Fe?"translateX(-100%)":"translateX(100%)"):yi.fromTo(it,"var(--opacity)",0),ti&&!tn){const ar=(0,M.c)();ar.addElement(Ke(ti).querySelector(".button-text")).fromTo("transform",`translateX(${Tt})`,`translateX(${(Fe?-124:124)+"px"})`),on.addAnimation(ar)}}else xt||Zn.fromTo("transform",`translateX(${Tt})`,`translateX(${un})`).fromTo(it,.99,0).afterClearStyles([Kt,it]),xn.fromTo("transform",`translateX(${Tt})`,`translateX(${un})`).afterClearStyles([Kt,it]),qn.afterClearStyles([it]),Zn.afterClearStyles([it]),ri.afterClearStyles([it])})}return Vt}catch(Ct){throw Ct}}},5298:(ci,Qt,le)=>{"use strict";le.r(Qt),le.d(Qt,{mdTransitionAnimation:()=>Me});var M=le(6506),b=le(8354);le(7643),le(6953);const Me=(ht,Ke)=>{var pt,yt,Dt;const mt="back"===Ke.direction,_t=Ke.leavingEl,Wt=(0,b.g)(Ke.enteringEl),Ct=Wt.querySelector("ion-toolbar"),it=(0,M.c)();if(it.addElement(Wt).fill("both").beforeRemoveClass("ion-page-invisible"),mt?it.duration((null!==(pt=Ke.duration)&&void 0!==pt?pt:0)||200).easing("cubic-bezier(0.47,0,0.745,0.715)"):it.duration((null!==(yt=Ke.duration)&&void 0!==yt?yt:0)||280).easing("cubic-bezier(0.36,0.66,0.04,1)").fromTo("transform","translateY(40px)","translateY(0px)").fromTo("opacity",.01,1),Ct){const Kt=(0,M.c)();Kt.addElement(Ct),it.addAnimation(Kt)}if(_t&&mt){it.duration((null!==(Dt=Ke.duration)&&void 0!==Dt?Dt:0)||200).easing("cubic-bezier(0.47,0,0.745,0.715)");const Kt=(0,M.c)();Kt.addElement((0,b.g)(_t)).onFinish(Tt=>{1===Tt&&Kt.elements.length>0&&Kt.elements[0].style.setProperty("display","none")}).fromTo("transform","translateY(0px)","translateY(40px)").fromTo("opacity",1,0),it.addAnimation(Kt)}return it}},8946:(ci,Qt,le)=>{"use strict";le.d(Qt,{B:()=>on,G:()=>Zn,a:()=>st,b:()=>bt,c:()=>Wt,d:()=>ri,e:()=>Cn,f:()=>Vt,g:()=>Ht,h:()=>Re,i:()=>at,j:()=>it,k:()=>Kt,m:()=>Qe,n:()=>yt,o:()=>Fe,q:()=>pn,s:()=>en,t:()=>Ct});var M=le(5861),b=le(7876),Ft=le(9439),l=le(5421),Me=le(544),ht=le(7690);let Ke=0,pt=0;const yt=new WeakMap,Dt=nn=>({create:xt=>Tt(nn,xt),dismiss:(xt,St,xn)=>Lt(document,xt,St,nn,xn),getTop:()=>(0,M.Z)(function*(){return pn(document,nn)})()}),st=Dt("ion-alert"),bt=Dt("ion-action-sheet"),Qe=Dt("ion-modal"),Wt=Dt("ion-popover"),Ct=Dt("ion-toast"),it=nn=>{typeof document<"u"&&dt(document);const xt=Ke++;nn.overlayIndex=xt},Kt=nn=>(nn.hasAttribute("id")||(nn.id="ion-overlay-"+ ++pt),nn.id),Tt=(nn,xt)=>typeof window<"u"&&typeof window.customElements<"u"?window.customElements.whenDefined(nn).then(()=>{const St=document.createElement(nn);return St.classList.add("overlay-hidden"),Object.assign(St,Object.assign(Object.assign({},xt),{hasController:!0})),li(document).appendChild(St),new Promise(xn=>(0,Me.c)(St,xn))}):Promise.resolve(),Ze='[tabindex]:not([tabindex^="-"]):not([hidden]):not([disabled]), input:not([type=hidden]):not([tabindex^="-"]):not([hidden]):not([disabled]), textarea:not([tabindex^="-"]):not([hidden]):not([disabled]), button:not([tabindex^="-"]):not([hidden]):not([disabled]), select:not([tabindex^="-"]):not([hidden]):not([disabled]), .ion-focusable:not([tabindex^="-"]):not([hidden]):not([disabled]), .ion-focusable[disabled="false"]:not([tabindex^="-"]):not([hidden])',Fe=(nn,xt)=>{let St=nn.querySelector(Ze);const xn=St?.shadowRoot;xn&&(St=xn.querySelector(Ze)||St),St?(0,Me.f)(St):xt.focus()},un=(nn,xt)=>{const St=Array.from(nn.querySelectorAll(Ze));let xn=St.length>0?St[St.length-1]:null;const Hn=xn?.shadowRoot;Hn&&(xn=Hn.querySelector(Ze)||xn),xn?xn.focus():xt.focus()},dt=nn=>{0===Ke&&(Ke=1,nn.addEventListener("focus",xt=>{((nn,xt)=>{const St=pn(xt,"ion-alert,ion-action-sheet,ion-loading,ion-modal,ion-picker,ion-popover"),xn=nn.target;St&&xn&&!St.classList.contains("ion-disable-focus-trap")&&(St.shadowRoot?(()=>{if(St.contains(xn))St.lastFocus=xn;else{const qn=St.lastFocus;Fe(St,St),qn===xt.activeElement&&un(St,St),St.lastFocus=xt.activeElement}})():(()=>{if(St===xn)St.lastFocus=void 0;else{const qn=(0,Me.g)(St);if(!qn.contains(xn))return;const ti=qn.querySelector(".ion-overlay-wrapper");if(!ti)return;if(ti.contains(xn)||xn===qn.querySelector("ion-backdrop"))St.lastFocus=xn;else{const Xn=St.lastFocus;Fe(ti,St),Xn===xt.activeElement&&un(ti,St),St.lastFocus=xt.activeElement}}})())})(xt,nn)},!0),nn.addEventListener("ionBackButton",xt=>{const St=pn(nn);St?.backdropDismiss&&xt.detail.register(l.OVERLAY_BACK_BUTTON_PRIORITY,()=>St.dismiss(void 0,on))}),nn.addEventListener("keydown",xt=>{if("Escape"===xt.key){const St=pn(nn);St?.backdropDismiss&&St.dismiss(void 0,on)}}))},Lt=(nn,xt,St,xn,Hn)=>{const yi=pn(nn,xn,Hn);return yi?yi.dismiss(xt,St):Promise.reject("overlay does not exist")},pn=(nn,xt,St)=>{const xn=((nn,xt)=>(void 0===xt&&(xt="ion-alert,ion-action-sheet,ion-loading,ion-modal,ion-picker,ion-popover,ion-toast"),Array.from(nn.querySelectorAll(xt)).filter(St=>St.overlayIndex>0)))(nn,xt).filter(Hn=>!(nn=>nn.classList.contains("overlay-hidden"))(Hn));return void 0===St?xn[xn.length-1]:xn.find(Hn=>Hn.id===St)},hn=(nn=!1)=>{const St=li(document).querySelector("ion-router-outlet, ion-nav, #ion-view-container-root");St&&(nn?St.setAttribute("aria-hidden","true"):St.removeAttribute("aria-hidden"))},Vt=function(){var nn=(0,M.Z)(function*(xt,St,xn,Hn,yi){var qn,ti;if(xt.presented)return;hn(!0),xt.presented=!0,xt.willPresent.emit(),null===(qn=xt.willPresentShorthand)||void 0===qn||qn.emit();const Xn=(0,b.b)(xt),ar=xt.enterAnimation?xt.enterAnimation:b.c.get(St,"ios"===Xn?xn:Hn);(yield tn(xt,ar,xt.el,yi))&&(xt.didPresent.emit(),null===(ti=xt.didPresentShorthand)||void 0===ti||ti.emit()),"ION-TOAST"!==xt.el.tagName&&Jn(xt.el),xt.keyboardClose&&(null===document.activeElement||!xt.el.contains(document.activeElement))&&xt.el.focus()});return function(St,xn,Hn,yi,qn){return nn.apply(this,arguments)}}(),Jn=function(){var nn=(0,M.Z)(function*(xt){let St=document.activeElement;if(!St)return;const xn=St?.shadowRoot;xn&&(St=xn.querySelector(Ze)||St),yield xt.onDidDismiss(),St.focus()});return function(St){return nn.apply(this,arguments)}}(),Ht=function(){var nn=(0,M.Z)(function*(xt,St,xn,Hn,yi,qn,ti){var Xn,ar;if(!xt.presented)return!1;hn(!1),xt.presented=!1;try{xt.el.style.setProperty("pointer-events","none"),xt.willDismiss.emit({data:St,role:xn}),null===(Xn=xt.willDismissShorthand)||void 0===Xn||Xn.emit({data:St,role:xn});const yn=(0,b.b)(xt),lr=xt.leaveAnimation?xt.leaveAnimation:b.c.get(Hn,"ios"===yn?yi:qn);xn!==Zn&&(yield tn(xt,lr,xt.el,ti)),xt.didDismiss.emit({data:St,role:xn}),null===(ar=xt.didDismissShorthand)||void 0===ar||ar.emit({data:St,role:xn}),yt.delete(xt),xt.el.classList.add("overlay-hidden"),xt.el.style.removeProperty("pointer-events"),void 0!==xt.el.lastFocus&&(xt.el.lastFocus=void 0)}catch(yn){console.error(yn)}return xt.el.remove(),!0});return function(St,xn,Hn,yi,qn,ti,Xn){return nn.apply(this,arguments)}}(),li=nn=>nn.querySelector("ion-app")||nn.body,tn=function(){var nn=(0,M.Z)(function*(xt,St,xn,Hn){xn.classList.remove("overlay-hidden");const qn=St(xt.el,Hn);(!xt.animated||!b.c.getBoolean("animated",!0))&&qn.duration(0),xt.keyboardClose&&qn.beforeAddWrite(()=>{const Xn=xn.ownerDocument.activeElement;Xn?.matches("input,ion-input, ion-textarea")&&Xn.blur()});const ti=yt.get(xt)||[];return yt.set(xt,[...ti,qn]),yield qn.play(),!0});return function(St,xn,Hn,yi){return nn.apply(this,arguments)}}(),Re=(nn,xt)=>{let St;const xn=new Promise(Hn=>St=Hn);return Ne(nn,xt,Hn=>{St(Hn.detail)}),xn},Ne=(nn,xt,St)=>{const xn=Hn=>{(0,Me.b)(nn,xt,xn),St(Hn)};(0,Me.a)(nn,xt,xn)},at=nn=>"cancel"===nn||nn===on,At=nn=>nn(),en=(nn,xt)=>{if("function"==typeof nn)return b.c.get("_zoneGate",At)(()=>{try{return nn(xt)}catch(xn){throw xn}})},on="backdrop",Zn="gesture",ri=nn=>{let St,xt=!1;const xn=(0,Ft.C)(),Hn=(ti=!1)=>{if(St&&!ti)return{delegate:St,inline:xt};const{el:Xn,hasController:ar,delegate:yn}=nn;return xt=null!==Xn.parentNode&&!ar,St=xt?yn||xn:yn,{inline:xt,delegate:St}};return{attachViewToDom:function(){var ti=(0,M.Z)(function*(Xn){const{delegate:ar}=Hn(!0);if(ar)return yield ar.attachViewToDom(nn.el,Xn);const{hasController:yn}=nn;if(yn&&void 0!==Xn)throw new Error("framework delegate is missing");return null});return function(ar){return ti.apply(this,arguments)}}(),removeViewFromDom:()=>{const{delegate:ti}=Hn();ti&&void 0!==nn.el&&ti.removeViewFromDom(nn.el.parentElement,nn.el)}}},Cn=()=>{let nn;const xt=()=>{nn&&(nn(),nn=void 0)};return{addClickListener:(xn,Hn)=>{xt();const yi=void 0!==Hn?document.getElementById(Hn):null;yi?nn=((ti,Xn)=>{const ar=()=>{Xn.present()};return ti.addEventListener("click",ar),()=>{ti.removeEventListener("click",ar)}})(yi,xn):(0,ht.p)(`A trigger element with the ID "${Hn}" was not found in the DOM. The trigger element must be in the DOM when the "trigger" property is set on an overlay component.`,xn)},removeClickListener:xt}}},3165:(ci,Qt,le)=>{"use strict";var M=le(6593),b=le(9468),Ft=le(6879),l=le(7852);let Me=(()=>{var ce;class I{constructor(){}}return(ce=I).\u0275fac=function(W){return new(W||ce)},ce.\u0275cmp=b.Xpm({type:ce,selectors:[["app-root"]],decls:2,vars:0,template:function(W,ue){1&W&&(b.TgZ(0,"ion-app"),b._UZ(1,"ion-router-outlet"),b.qZA())},dependencies:[l.dr,l.jP]}),I})();const ht=[{path:"home",loadChildren:()=>le.e(7992).then(le.bind(le,7992)).then(ce=>ce.HomePageModule)},{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",loadChildren:()=>le.e(6488).then(le.bind(le,6488)).then(ce=>ce.LoginPageModule)},{path:"historial",loadChildren:()=>le.e(3030).then(le.bind(le,3030)).then(ce=>ce.HistorialPageModule)},{path:"perfil",loadChildren:()=>le.e(3147).then(le.bind(le,3147)).then(ce=>ce.PerfilPageModule)},{path:"mapa-x",loadChildren:()=>le.e(5001).then(le.bind(le,5001)).then(ce=>ce.MapaXPageModule)},{path:"config",loadChildren:()=>le.e(6305).then(le.bind(le,6305)).then(ce=>ce.ConfigPageModule)}];let Ke=(()=>{var ce;class I{}return(ce=I).\u0275fac=function(W){return new(W||ce)},ce.\u0275mod=b.oAB({type:ce}),ce.\u0275inj=b.cJS({imports:[Ft.Bz.forRoot(ht,{preloadingStrategy:Ft.wm}),Ft.Bz]}),I})();var pt=le(6825);function Dt(ce){return new b.vHH(3e3,!1)}function St(ce){switch(ce.length){case 0:return new pt.ZN;case 1:return ce[0];default:return new pt.ZE(ce)}}function xn(ce,I,B=new Map,W=new Map){const ue=[],Se=[];let nt=-1,gt=null;if(I.forEach(Zt=>{const fn=Zt.get("offset"),gi=fn==nt,Wn=gi&&gt||new Map;Zt.forEach((mr,Yi)=>{let Oi=Yi,Vi=mr;if("offset"!==Yi)switch(Oi=ce.normalizePropertyName(Oi,ue),Vi){case pt.k1:Vi=B.get(Yi);break;case pt.l3:Vi=W.get(Yi);break;default:Vi=ce.normalizeStyleValue(Yi,Oi,Vi,ue)}Wn.set(Oi,Vi)}),gi||Se.push(Wn),gt=Wn,nt=fn}),ue.length)throw function li(ce){return new b.vHH(3502,!1)}();return Se}function Hn(ce,I,B,W){switch(I){case"start":ce.onStart(()=>W(B&&yi(B,"start",ce)));break;case"done":ce.onDone(()=>W(B&&yi(B,"done",ce)));break;case"destroy":ce.onDestroy(()=>W(B&&yi(B,"destroy",ce)))}}function yi(ce,I,B){const Se=qn(ce.element,ce.triggerName,ce.fromState,ce.toState,I||ce.phaseName,B.totalTime??ce.totalTime,!!B.disabled),nt=ce._data;return null!=nt&&(Se._data=nt),Se}function qn(ce,I,B,W,ue="",Se=0,nt){return{element:ce,triggerName:I,fromState:B,toState:W,phaseName:ue,totalTime:Se,disabled:!!nt}}function ti(ce,I,B){let W=ce.get(I);return W||ce.set(I,W=B),W}function Xn(ce){const I=ce.indexOf(":");return[ce.substring(1,I),ce.slice(I+1)]}const ar=(()=>typeof document>"u"?null:document.documentElement)();function yn(ce){const I=ce.parentNode||ce.host||null;return I===ar?null:I}let Pr=null,pr=!1;function po(ce,I){for(;I;){if(I===ce)return!0;I=yn(I)}return!1}function wi(ce,I,B){if(B)return Array.from(ce.querySelectorAll(I));const W=ce.querySelector(I);return W?[W]:[]}let Er=(()=>{var ce;class I{validateStyleProperty(W){return function oo(ce){Pr||(Pr=function $i(){return typeof document<"u"?document.body:null}()||{},pr=!!Pr.style&&"WebkitAppearance"in Pr.style);let I=!0;return Pr.style&&!function lr(ce){return"ebkit"==ce.substring(1,6)}(ce)&&(I=ce in Pr.style,!I&&pr&&(I="Webkit"+ce.charAt(0).toUpperCase()+ce.slice(1)in Pr.style)),I}(W)}matchesElement(W,ue){return!1}containsElement(W,ue){return po(W,ue)}getParentElement(W){return yn(W)}query(W,ue,Se){return wi(W,ue,Se)}computeStyle(W,ue,Se){return Se||""}animate(W,ue,Se,nt,gt,Zt=[],fn){return new pt.ZN(Se,nt)}}return(ce=I).\u0275fac=function(W){return new(W||ce)},ce.\u0275prov=b.Yz7({token:ce,factory:ce.\u0275fac}),I})(),fi=(()=>{class I{}return I.NOOP=new Er,I})();const Sr=1e3,rr="ng-enter",No="ng-leave",Ue="ng-trigger",ae=".ng-trigger",de="ng-animating",Le=".ng-animating";function We(ce){if("number"==typeof ce)return ce;const I=ce.match(/^(-?[\.\d]+)(m?s)/);return!I||I.length<2?0:ot(parseFloat(I[1]),I[2])}function ot(ce,I){return"s"===I?ce*Sr:ce}function Rt(ce,I,B){return ce.hasOwnProperty("duration")?ce:function It(ce,I,B){let ue,Se=0,nt="";if("string"==typeof ce){const gt=ce.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===gt)return I.push(Dt()),{duration:0,delay:0,easing:""};ue=ot(parseFloat(gt[1]),gt[2]);const Zt=gt[3];null!=Zt&&(Se=ot(parseFloat(Zt),gt[4]));const fn=gt[5];fn&&(nt=fn)}else ue=ce;if(!B){let gt=!1,Zt=I.length;ue<0&&(I.push(function st(){return new b.vHH(3100,!1)}()),gt=!0),Se<0&&(I.push(function bt(){return new b.vHH(3101,!1)}()),gt=!0),gt&&I.splice(Zt,0,Dt())}return{duration:ue,delay:Se,easing:nt}}(ce,I,B)}function rt(ce,I={}){return Object.keys(ce).forEach(B=>{I[B]=ce[B]}),I}function Bt(ce){const I=new Map;return Object.keys(ce).forEach(B=>{I.set(B,ce[B])}),I}function Ye(ce,I=new Map,B){if(B)for(let[W,ue]of B)I.set(W,ue);for(let[W,ue]of ce)I.set(W,ue);return I}function je(ce,I,B){I.forEach((W,ue)=>{const Se=ji(ue);B&&!B.has(ue)&&B.set(ue,ce.style[Se]),ce.style[Se]=W})}function wt(ce,I){I.forEach((B,W)=>{const ue=ji(W);ce.style[ue]=""})}function Ge(ce){return Array.isArray(ce)?1==ce.length?ce[0]:(0,pt.vP)(ce):ce}const cn=new RegExp("{{\\s*(.+?)\\s*}}","g");function $n(ce){let I=[];if("string"==typeof ce){let B;for(;B=cn.exec(ce);)I.push(B[1]);cn.lastIndex=0}return I}function si(ce,I,B){const W=ce.toString(),ue=W.replace(cn,(Se,nt)=>{let gt=I[nt];return null==gt&&(B.push(function Qe(ce){return new b.vHH(3003,!1)}()),gt=""),gt.toString()});return ue==W?ce:ue}function bi(ce){const I=[];let B=ce.next();for(;!B.done;)I.push(B.value),B=ce.next();return I}const Ui=/-+([a-z0-9])/g;function ji(ce){return ce.replace(Ui,(...I)=>I[1].toUpperCase())}function Gr(ce,I,B){switch(I.type){case 7:return ce.visitTrigger(I,B);case 0:return ce.visitState(I,B);case 1:return ce.visitTransition(I,B);case 2:return ce.visitSequence(I,B);case 3:return ce.visitGroup(I,B);case 4:return ce.visitAnimate(I,B);case 5:return ce.visitKeyframes(I,B);case 6:return ce.visitStyle(I,B);case 8:return ce.visitReference(I,B);case 9:return ce.visitAnimateChild(I,B);case 10:return ce.visitAnimateRef(I,B);case 11:return ce.visitQuery(I,B);case 12:return ce.visitStagger(I,B);default:throw function _t(ce){return new b.vHH(3004,!1)}()}}function Wr(ce,I){return window.getComputedStyle(ce)[I]}const Dr="*";function Hi(ce,I){const B=[];return"string"==typeof ce?ce.split(/\s*,\s*/).forEach(W=>function Ur(ce,I,B){if(":"==ce[0]){const Zt=function xr(ce,I){switch(ce){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(B,W)=>parseFloat(W)>parseFloat(B);case":decrement":return(B,W)=>parseFloat(W)<parseFloat(B);default:return I.push(function hn(ce){return new b.vHH(3016,!1)}()),"* => *"}}(ce,B);if("function"==typeof Zt)return void I.push(Zt);ce=Zt}const W=ce.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==W||W.length<4)return B.push(function pn(ce){return new b.vHH(3015,!1)}()),I;const ue=W[1],Se=W[2],nt=W[3];I.push(Gt(ue,nt));"<"==Se[0]&&!(ue==Dr&&nt==Dr)&&I.push(Gt(nt,ue))}(W,B,I)):B.push(ce),B}const Ni=new Set(["true","1"]),Qo=new Set(["false","0"]);function Gt(ce,I){const B=Ni.has(ce)||Qo.has(ce),W=Ni.has(I)||Qo.has(I);return(ue,Se)=>{let nt=ce==Dr||ce==ue,gt=I==Dr||I==Se;return!nt&&B&&"boolean"==typeof ue&&(nt=ue?Ni.has(ce):Qo.has(ce)),!gt&&W&&"boolean"==typeof Se&&(gt=Se?Ni.has(I):Qo.has(I)),nt&&gt}}const Rr=new RegExp("s*:selfs*,?","g");function Or(ce,I,B,W){return new Co(ce).build(I,B,W)}class Co{constructor(I){this._driver=I}build(I,B,W){const ue=new Lo(B);return this._resetContextStyleTimingState(ue),Gr(this,Ge(I),ue)}_resetContextStyleTimingState(I){I.currentQuerySelector="",I.collectedStyles=new Map,I.collectedStyles.set("",new Map),I.currentTime=0}visitTrigger(I,B){let W=B.queryCount=0,ue=B.depCount=0;const Se=[],nt=[];return"@"==I.name.charAt(0)&&B.errors.push(function Ct(){return new b.vHH(3006,!1)}()),I.definitions.forEach(gt=>{if(this._resetContextStyleTimingState(B),0==gt.type){const Zt=gt,fn=Zt.name;fn.toString().split(/\s*,\s*/).forEach(gi=>{Zt.name=gi,Se.push(this.visitState(Zt,B))}),Zt.name=fn}else if(1==gt.type){const Zt=this.visitTransition(gt,B);W+=Zt.queryCount,ue+=Zt.depCount,nt.push(Zt)}else B.errors.push(function it(){return new b.vHH(3007,!1)}())}),{type:7,name:I.name,states:Se,transitions:nt,queryCount:W,depCount:ue,options:null}}visitState(I,B){const W=this.visitStyle(I.styles,B),ue=I.options&&I.options.params||null;if(W.containsDynamicStyles){const Se=new Set,nt=ue||{};W.styles.forEach(gt=>{gt instanceof Map&&gt.forEach(Zt=>{$n(Zt).forEach(fn=>{nt.hasOwnProperty(fn)||Se.add(fn)})})}),Se.size&&(bi(Se.values()),B.errors.push(function Kt(ce,I){return new b.vHH(3008,!1)}()))}return{type:0,name:I.name,style:W,options:ue?{params:ue}:null}}visitTransition(I,B){B.queryCount=0,B.depCount=0;const W=Gr(this,Ge(I.animation),B);return{type:1,matchers:Hi(I.expr,B.errors),animation:W,queryCount:B.queryCount,depCount:B.depCount,options:se(I.options)}}visitSequence(I,B){return{type:2,steps:I.steps.map(W=>Gr(this,W,B)),options:se(I.options)}}visitGroup(I,B){const W=B.currentTime;let ue=0;const Se=I.steps.map(nt=>{B.currentTime=W;const gt=Gr(this,nt,B);return ue=Math.max(ue,B.currentTime),gt});return B.currentTime=ue,{type:3,steps:Se,options:se(I.options)}}visitAnimate(I,B){const W=function Pi(ce,I){if(ce.hasOwnProperty("duration"))return ce;if("number"==typeof ce)return Oe(Rt(ce,I).duration,0,"");const B=ce;if(B.split(/\s+/).some(Se=>"{"==Se.charAt(0)&&"{"==Se.charAt(1))){const Se=Oe(0,0,"");return Se.dynamic=!0,Se.strValue=B,Se}const ue=Rt(B,I);return Oe(ue.duration,ue.delay,ue.easing)}(I.timings,B.errors);B.currentAnimateTimings=W;let ue,Se=I.styles?I.styles:(0,pt.oB)({});if(5==Se.type)ue=this.visitKeyframes(Se,B);else{let nt=I.styles,gt=!1;if(!nt){gt=!0;const fn={};W.easing&&(fn.easing=W.easing),nt=(0,pt.oB)(fn)}B.currentTime+=W.duration+W.delay;const Zt=this.visitStyle(nt,B);Zt.isEmptyStep=gt,ue=Zt}return B.currentAnimateTimings=null,{type:4,timings:W,style:ue,options:null}}visitStyle(I,B){const W=this._makeStyleAst(I,B);return this._validateStyleAst(W,B),W}_makeStyleAst(I,B){const W=[],ue=Array.isArray(I.styles)?I.styles:[I.styles];for(let gt of ue)"string"==typeof gt?gt===pt.l3?W.push(gt):B.errors.push(new b.vHH(3002,!1)):W.push(Bt(gt));let Se=!1,nt=null;return W.forEach(gt=>{if(gt instanceof Map&&(gt.has("easing")&&(nt=gt.get("easing"),gt.delete("easing")),!Se))for(let Zt of gt.values())if(Zt.toString().indexOf("{{")>=0){Se=!0;break}}),{type:6,styles:W,easing:nt,offset:I.offset,containsDynamicStyles:Se,options:null}}_validateStyleAst(I,B){const W=B.currentAnimateTimings;let ue=B.currentTime,Se=B.currentTime;W&&Se>0&&(Se-=W.duration+W.delay),I.styles.forEach(nt=>{"string"!=typeof nt&&nt.forEach((gt,Zt)=>{const fn=B.collectedStyles.get(B.currentQuerySelector),gi=fn.get(Zt);let Wn=!0;gi&&(Se!=ue&&Se>=gi.startTime&&ue<=gi.endTime&&(B.errors.push(function Fe(ce,I,B,W,ue){return new b.vHH(3010,!1)}()),Wn=!1),Se=gi.startTime),Wn&&fn.set(Zt,{startTime:Se,endTime:ue}),B.options&&function Ot(ce,I,B){const W=I.params||{},ue=$n(ce);ue.length&&ue.forEach(Se=>{W.hasOwnProperty(Se)||B.push(function mt(ce){return new b.vHH(3001,!1)}())})}(gt,B.options,B.errors)})})}visitKeyframes(I,B){const W={type:5,styles:[],options:null};if(!B.currentAnimateTimings)return B.errors.push(function $t(){return new b.vHH(3011,!1)}()),W;let Se=0;const nt=[];let gt=!1,Zt=!1,fn=0;const gi=I.steps.map(xo=>{const as=this._makeStyleAst(xo,B);let Ds=null!=as.offset?as.offset:function Un(ce){if("string"==typeof ce)return null;let I=null;if(Array.isArray(ce))ce.forEach(B=>{if(B instanceof Map&&B.has("offset")){const W=B;I=parseFloat(W.get("offset")),W.delete("offset")}});else if(ce instanceof Map&&ce.has("offset")){const B=ce;I=parseFloat(B.get("offset")),B.delete("offset")}return I}(as.styles),Wo=0;return null!=Ds&&(Se++,Wo=as.offset=Ds),Zt=Zt||Wo<0||Wo>1,gt=gt||Wo<fn,fn=Wo,nt.push(Wo),as});Zt&&B.errors.push(function un(){return new b.vHH(3012,!1)}()),gt&&B.errors.push(function De(){return new b.vHH(3200,!1)}());const Wn=I.steps.length;let mr=0;Se>0&&Se<Wn?B.errors.push(function dt(){return new b.vHH(3202,!1)}()):0==Se&&(mr=1/(Wn-1));const Yi=Wn-1,Oi=B.currentTime,Vi=B.currentAnimateTimings,Kr=Vi.duration;return gi.forEach((xo,as)=>{const Ds=mr>0?as==Yi?1:mr*as:nt[as],Wo=Ds*Kr;B.currentTime=Oi+Vi.delay+Wo,Vi.duration=Wo,this._validateStyleAst(xo,B),xo.offset=Ds,W.styles.push(xo)}),W}visitReference(I,B){return{type:8,animation:Gr(this,Ge(I.animation),B),options:se(I.options)}}visitAnimateChild(I,B){return B.depCount++,{type:9,options:se(I.options)}}visitAnimateRef(I,B){return{type:10,animation:this.visitReference(I.animation,B),options:se(I.options)}}visitQuery(I,B){const W=B.currentQuerySelector,ue=I.options||{};B.queryCount++,B.currentQuery=I;const[Se,nt]=function os(ce){const I=!!ce.split(/\s*,\s*/).find(B=>":self"==B);return I&&(ce=ce.replace(Rr,"")),ce=ce.replace(/@\*/g,ae).replace(/@\w+/g,B=>ae+"-"+B.slice(1)).replace(/:animating/g,Le),[ce,I]}(I.selector);B.currentQuerySelector=W.length?W+" "+Se:Se,ti(B.collectedStyles,B.currentQuerySelector,new Map);const gt=Gr(this,Ge(I.animation),B);return B.currentQuery=null,B.currentQuerySelector=W,{type:11,selector:Se,limit:ue.limit||0,optional:!!ue.optional,includeSelf:nt,animation:gt,originalSelector:I.selector,options:se(I.options)}}visitStagger(I,B){B.currentQuery||B.errors.push(function Lt(){return new b.vHH(3013,!1)}());const W="full"===I.timings?{duration:0,delay:0,easing:"full"}:Rt(I.timings,B.errors,!0);return{type:12,animation:Gr(this,Ge(I.animation),B),timings:W,options:null}}}class Lo{constructor(I){this.errors=I,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function se(ce){return ce?(ce=rt(ce)).params&&(ce.params=function Yr(ce){return ce?rt(ce):null}(ce.params)):ce={},ce}function Oe(ce,I,B){return{duration:ce,delay:I,easing:B}}function ge(ce,I,B,W,ue,Se,nt=null,gt=!1){return{type:1,element:ce,keyframes:I,preStyleProps:B,postStyleProps:W,duration:ue,delay:Se,totalTime:ue+Se,easing:nt,subTimeline:gt}}class Te{constructor(){this._map=new Map}get(I){return this._map.get(I)||[]}append(I,B){let W=this._map.get(I);W||this._map.set(I,W=[]),W.push(...B)}has(I){return this._map.has(I)}clear(){this._map.clear()}}const sn=new RegExp(":enter","g"),an=new RegExp(":leave","g");function Tn(ce,I,B,W,ue,Se=new Map,nt=new Map,gt,Zt,fn=[]){return(new ii).buildKeyframes(ce,I,B,W,ue,Se,nt,gt,Zt,fn)}class ii{buildKeyframes(I,B,W,ue,Se,nt,gt,Zt,fn,gi=[]){fn=fn||new Te;const Wn=new Fi(I,B,fn,ue,Se,gi,[]);Wn.options=Zt;const mr=Zt.delay?We(Zt.delay):0;Wn.currentTimeline.delayNextStep(mr),Wn.currentTimeline.setStyles([nt],null,Wn.errors,Zt),Gr(this,W,Wn);const Yi=Wn.timelines.filter(Oi=>Oi.containsAnimation());if(Yi.length&&gt.size){let Oi;for(let Vi=Yi.length-1;Vi>=0;Vi--){const Kr=Yi[Vi];if(Kr.element===B){Oi=Kr;break}}Oi&&!Oi.allowOnlyTimelineStyles()&&Oi.setStyles([gt],null,Wn.errors,Zt)}return Yi.length?Yi.map(Oi=>Oi.buildKeyframes()):[ge(B,[],[],[],0,mr,"",!1)]}visitTrigger(I,B){}visitState(I,B){}visitTransition(I,B){}visitAnimateChild(I,B){const W=B.subInstructions.get(B.element);if(W){const ue=B.createSubContext(I.options),Se=B.currentTimeline.currentTime,nt=this._visitSubInstructions(W,ue,ue.options);Se!=nt&&B.transformIntoNewTimeline(nt)}B.previousNode=I}visitAnimateRef(I,B){const W=B.createSubContext(I.options);W.transformIntoNewTimeline(),this._applyAnimationRefDelays([I.options,I.animation.options],B,W),this.visitReference(I.animation,W),B.transformIntoNewTimeline(W.currentTimeline.currentTime),B.previousNode=I}_applyAnimationRefDelays(I,B,W){for(const ue of I){const Se=ue?.delay;if(Se){const nt="number"==typeof Se?Se:We(si(Se,ue?.params??{},B.errors));W.delayNextStep(nt)}}}_visitSubInstructions(I,B,W){let Se=B.currentTimeline.currentTime;const nt=null!=W.duration?We(W.duration):null,gt=null!=W.delay?We(W.delay):null;return 0!==nt&&I.forEach(Zt=>{const fn=B.appendInstructionToTimeline(Zt,nt,gt);Se=Math.max(Se,fn.duration+fn.delay)}),Se}visitReference(I,B){B.updateOptions(I.options,!0),Gr(this,I.animation,B),B.previousNode=I}visitSequence(I,B){const W=B.subContextCount;let ue=B;const Se=I.options;if(Se&&(Se.params||Se.delay)&&(ue=B.createSubContext(Se),ue.transformIntoNewTimeline(),null!=Se.delay)){6==ue.previousNode.type&&(ue.currentTimeline.snapshotCurrentStyles(),ue.previousNode=vi);const nt=We(Se.delay);ue.delayNextStep(nt)}I.steps.length&&(I.steps.forEach(nt=>Gr(this,nt,ue)),ue.currentTimeline.applyStylesToKeyframe(),ue.subContextCount>W&&ue.transformIntoNewTimeline()),B.previousNode=I}visitGroup(I,B){const W=[];let ue=B.currentTimeline.currentTime;const Se=I.options&&I.options.delay?We(I.options.delay):0;I.steps.forEach(nt=>{const gt=B.createSubContext(I.options);Se&&gt.delayNextStep(Se),Gr(this,nt,gt),ue=Math.max(ue,gt.currentTimeline.currentTime),W.push(gt.currentTimeline)}),W.forEach(nt=>B.currentTimeline.mergeTimelineCollectedStyles(nt)),B.transformIntoNewTimeline(ue),B.previousNode=I}_visitTiming(I,B){if(I.dynamic){const W=I.strValue;return Rt(B.params?si(W,B.params,B.errors):W,B.errors)}return{duration:I.duration,delay:I.delay,easing:I.easing}}visitAnimate(I,B){const W=B.currentAnimateTimings=this._visitTiming(I.timings,B),ue=B.currentTimeline;W.delay&&(B.incrementTime(W.delay),ue.snapshotCurrentStyles());const Se=I.style;5==Se.type?this.visitKeyframes(Se,B):(B.incrementTime(W.duration),this.visitStyle(Se,B),ue.applyStylesToKeyframe()),B.currentAnimateTimings=null,B.previousNode=I}visitStyle(I,B){const W=B.currentTimeline,ue=B.currentAnimateTimings;!ue&&W.hasCurrentStyleProperties()&&W.forwardFrame();const Se=ue&&ue.easing||I.easing;I.isEmptyStep?W.applyEmptyStep(Se):W.setStyles(I.styles,Se,B.errors,B.options),B.previousNode=I}visitKeyframes(I,B){const W=B.currentAnimateTimings,ue=B.currentTimeline.duration,Se=W.duration,gt=B.createSubContext().currentTimeline;gt.easing=W.easing,I.styles.forEach(Zt=>{gt.forwardTime((Zt.offset||0)*Se),gt.setStyles(Zt.styles,Zt.easing,B.errors,B.options),gt.applyStylesToKeyframe()}),B.currentTimeline.mergeTimelineCollectedStyles(gt),B.transformIntoNewTimeline(ue+Se),B.previousNode=I}visitQuery(I,B){const W=B.currentTimeline.currentTime,ue=I.options||{},Se=ue.delay?We(ue.delay):0;Se&&(6===B.previousNode.type||0==W&&B.currentTimeline.hasCurrentStyleProperties())&&(B.currentTimeline.snapshotCurrentStyles(),B.previousNode=vi);let nt=W;const gt=B.invokeQuery(I.selector,I.originalSelector,I.limit,I.includeSelf,!!ue.optional,B.errors);B.currentQueryTotal=gt.length;let Zt=null;gt.forEach((fn,gi)=>{B.currentQueryIndex=gi;const Wn=B.createSubContext(I.options,fn);Se&&Wn.delayNextStep(Se),fn===B.element&&(Zt=Wn.currentTimeline),Gr(this,I.animation,Wn),Wn.currentTimeline.applyStylesToKeyframe(),nt=Math.max(nt,Wn.currentTimeline.currentTime)}),B.currentQueryIndex=0,B.currentQueryTotal=0,B.transformIntoNewTimeline(nt),Zt&&(B.currentTimeline.mergeTimelineCollectedStyles(Zt),B.currentTimeline.snapshotCurrentStyles()),B.previousNode=I}visitStagger(I,B){const W=B.parentContext,ue=B.currentTimeline,Se=I.timings,nt=Math.abs(Se.duration),gt=nt*(B.currentQueryTotal-1);let Zt=nt*B.currentQueryIndex;switch(Se.duration<0?"reverse":Se.easing){case"reverse":Zt=gt-Zt;break;case"full":Zt=W.currentStaggerTime}const gi=B.currentTimeline;Zt&&gi.delayNextStep(Zt);const Wn=gi.currentTime;Gr(this,I.animation,B),B.previousNode=I,W.currentStaggerTime=ue.currentTime-Wn+(ue.startTime-W.currentTimeline.startTime)}}const vi={};class Fi{constructor(I,B,W,ue,Se,nt,gt,Zt){this._driver=I,this.element=B,this.subInstructions=W,this._enterClassName=ue,this._leaveClassName=Se,this.errors=nt,this.timelines=gt,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=vi,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=Zt||new br(this._driver,B,0),gt.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(I,B){if(!I)return;const W=I;let ue=this.options;null!=W.duration&&(ue.duration=We(W.duration)),null!=W.delay&&(ue.delay=We(W.delay));const Se=W.params;if(Se){let nt=ue.params;nt||(nt=this.options.params={}),Object.keys(Se).forEach(gt=>{(!B||!nt.hasOwnProperty(gt))&&(nt[gt]=si(Se[gt],nt,this.errors))})}}_copyOptions(){const I={};if(this.options){const B=this.options.params;if(B){const W=I.params={};Object.keys(B).forEach(ue=>{W[ue]=B[ue]})}}return I}createSubContext(I=null,B,W){const ue=B||this.element,Se=new Fi(this._driver,ue,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(ue,W||0));return Se.previousNode=this.previousNode,Se.currentAnimateTimings=this.currentAnimateTimings,Se.options=this._copyOptions(),Se.updateOptions(I),Se.currentQueryIndex=this.currentQueryIndex,Se.currentQueryTotal=this.currentQueryTotal,Se.parentContext=this,this.subContextCount++,Se}transformIntoNewTimeline(I){return this.previousNode=vi,this.currentTimeline=this.currentTimeline.fork(this.element,I),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(I,B,W){const ue={duration:B??I.duration,delay:this.currentTimeline.currentTime+(W??0)+I.delay,easing:""},Se=new jo(this._driver,I.element,I.keyframes,I.preStyleProps,I.postStyleProps,ue,I.stretchStartingKeyframe);return this.timelines.push(Se),ue}incrementTime(I){this.currentTimeline.forwardTime(this.currentTimeline.duration+I)}delayNextStep(I){I>0&&this.currentTimeline.delayNextStep(I)}invokeQuery(I,B,W,ue,Se,nt){let gt=[];if(ue&&gt.push(this.element),I.length>0){I=(I=I.replace(sn,"."+this._enterClassName)).replace(an,"."+this._leaveClassName);let fn=this._driver.query(this.element,I,1!=W);0!==W&&(fn=W<0?fn.slice(fn.length+W,fn.length):fn.slice(0,W)),gt.push(...fn)}return!Se&&0==gt.length&&nt.push(function ft(ce){return new b.vHH(3014,!1)}()),gt}}class br{constructor(I,B,W,ue){this._driver=I,this.element=B,this.startTime=W,this._elementTimelineStylesLookup=ue,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(B),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(B,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(I){const B=1===this._keyframes.size&&this._pendingStyles.size;this.duration||B?(this.forwardTime(this.currentTime+I),B&&this.snapshotCurrentStyles()):this.startTime+=I}fork(I,B){return this.applyStylesToKeyframe(),new br(this._driver,I,B||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(I){this.applyStylesToKeyframe(),this.duration=I,this._loadKeyframe()}_updateStyle(I,B){this._localTimelineStyles.set(I,B),this._globalTimelineStyles.set(I,B),this._styleSummary.set(I,{time:this.currentTime,value:B})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(I){I&&this._previousKeyframe.set("easing",I);for(let[B,W]of this._globalTimelineStyles)this._backFill.set(B,W||pt.l3),this._currentKeyframe.set(B,pt.l3);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(I,B,W,ue){B&&this._previousKeyframe.set("easing",B);const Se=ue&&ue.params||{},nt=function To(ce,I){const B=new Map;let W;return ce.forEach(ue=>{if("*"===ue){W=W||I.keys();for(let Se of W)B.set(Se,pt.l3)}else Ye(ue,B)}),B}(I,this._globalTimelineStyles);for(let[gt,Zt]of nt){const fn=si(Zt,Se,W);this._pendingStyles.set(gt,fn),this._localTimelineStyles.has(gt)||this._backFill.set(gt,this._globalTimelineStyles.get(gt)??pt.l3),this._updateStyle(gt,fn)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((I,B)=>{this._currentKeyframe.set(B,I)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((I,B)=>{this._currentKeyframe.has(B)||this._currentKeyframe.set(B,I)}))}snapshotCurrentStyles(){for(let[I,B]of this._localTimelineStyles)this._pendingStyles.set(I,B),this._updateStyle(I,B)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const I=[];for(let B in this._currentKeyframe)I.push(B);return I}mergeTimelineCollectedStyles(I){I._styleSummary.forEach((B,W)=>{const ue=this._styleSummary.get(W);(!ue||B.time>ue.time)&&this._updateStyle(W,B.value)})}buildKeyframes(){this.applyStylesToKeyframe();const I=new Set,B=new Set,W=1===this._keyframes.size&&0===this.duration;let ue=[];this._keyframes.forEach((gt,Zt)=>{const fn=Ye(gt,new Map,this._backFill);fn.forEach((gi,Wn)=>{gi===pt.k1?I.add(Wn):gi===pt.l3&&B.add(Wn)}),W||fn.set("offset",Zt/this.duration),ue.push(fn)});const Se=I.size?bi(I.values()):[],nt=B.size?bi(B.values()):[];if(W){const gt=ue[0],Zt=new Map(gt);gt.set("offset",0),Zt.set("offset",1),ue=[gt,Zt]}return ge(this.element,ue,Se,nt,this.duration,this.startTime,this.easing,!1)}}class jo extends br{constructor(I,B,W,ue,Se,nt,gt=!1){super(I,B,nt.delay),this.keyframes=W,this.preStyleProps=ue,this.postStyleProps=Se,this._stretchStartingKeyframe=gt,this.timings={duration:nt.duration,delay:nt.delay,easing:nt.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let I=this.keyframes,{delay:B,duration:W,easing:ue}=this.timings;if(this._stretchStartingKeyframe&&B){const Se=[],nt=W+B,gt=B/nt,Zt=Ye(I[0]);Zt.set("offset",0),Se.push(Zt);const fn=Ye(I[0]);fn.set("offset",mo(gt)),Se.push(fn);const gi=I.length-1;for(let Wn=1;Wn<=gi;Wn++){let mr=Ye(I[Wn]);const Yi=mr.get("offset");mr.set("offset",mo((B+Yi*W)/nt)),Se.push(mr)}W=nt,B=0,ue="",I=Se}return ge(this.element,I,this.preStyleProps,this.postStyleProps,W,B,ue,!0)}}function mo(ce,I=3){const B=Math.pow(10,I-1);return Math.round(ce*B)/B}class ao{}const cr=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class Ls extends ao{normalizePropertyName(I,B){return ji(I)}normalizeStyleValue(I,B,W,ue){let Se="";const nt=W.toString().trim();if(cr.has(B)&&0!==W&&"0"!==W)if("number"==typeof W)Se="px";else{const gt=W.match(/^[+-]?[\d\.]+([a-z]*)$/);gt&&0==gt[1].length&&ue.push(function Wt(ce,I){return new b.vHH(3005,!1)}())}return nt+Se}}function Ys(ce,I,B,W,ue,Se,nt,gt,Zt,fn,gi,Wn,mr){return{type:0,element:ce,triggerName:I,isRemovalTransition:ue,fromState:B,fromStyles:Se,toState:W,toStyles:nt,timelines:gt,queriedElements:Zt,preStyleProps:fn,postStyleProps:gi,totalTime:Wn,errors:mr}}const Ii={};class Cr{constructor(I,B,W){this._triggerName=I,this.ast=B,this._stateStyles=W}match(I,B,W,ue){return function ds(ce,I,B,W,ue){return ce.some(Se=>Se(I,B,W,ue))}(this.ast.matchers,I,B,W,ue)}buildStyles(I,B,W){let ue=this._stateStyles.get("*");return void 0!==I&&(ue=this._stateStyles.get(I?.toString())||ue),ue?ue.buildStyles(B,W):new Map}build(I,B,W,ue,Se,nt,gt,Zt,fn,gi){const Wn=[],mr=this.ast.options&&this.ast.options.params||Ii,Oi=this.buildStyles(W,gt&&gt.params||Ii,Wn),Vi=Zt&&Zt.params||Ii,Kr=this.buildStyles(ue,Vi,Wn),xo=new Set,as=new Map,Ds=new Map,Wo="void"===ue,cl={params:ur(Vi,mr),delay:this.ast.options?.delay},$s=gi?[]:Tn(I,B,this.ast.animation,Se,nt,Oi,Kr,cl,fn,Wn);let _s=0;if($s.forEach(Xs=>{_s=Math.max(Xs.duration+Xs.delay,_s)}),Wn.length)return Ys(B,this._triggerName,W,ue,Wo,Oi,Kr,[],[],as,Ds,_s,Wn);$s.forEach(Xs=>{const va=Xs.element,bl=ti(as,va,new Set);Xs.preStyleProps.forEach(Vs=>bl.add(Vs));const Ks=ti(Ds,va,new Set);Xs.postStyleProps.forEach(Vs=>Ks.add(Vs)),va!==B&&xo.add(va)});const fa=bi(xo.values());return Ys(B,this._triggerName,W,ue,Wo,Oi,Kr,$s,fa,as,Ds,_s)}}function ur(ce,I){const B=rt(I);for(const W in ce)ce.hasOwnProperty(W)&&null!=ce[W]&&(B[W]=ce[W]);return B}class Rs{constructor(I,B,W){this.styles=I,this.defaultParams=B,this.normalizer=W}buildStyles(I,B){const W=new Map,ue=rt(this.defaultParams);return Object.keys(I).forEach(Se=>{const nt=I[Se];null!==nt&&(ue[Se]=nt)}),this.styles.styles.forEach(Se=>{"string"!=typeof Se&&Se.forEach((nt,gt)=>{nt&&(nt=si(nt,ue,B));const Zt=this.normalizer.normalizePropertyName(gt,B);nt=this.normalizer.normalizeStyleValue(gt,Zt,nt,B),W.set(gt,nt)})}),W}}class hs{constructor(I,B,W){this.name=I,this.ast=B,this._normalizer=W,this.transitionFactories=[],this.states=new Map,B.states.forEach(ue=>{this.states.set(ue.name,new Rs(ue.style,ue.options&&ue.options.params||{},W))}),ia(this.states,"true","1"),ia(this.states,"false","0"),B.transitions.forEach(ue=>{this.transitionFactories.push(new Cr(I,ue,this.states))}),this.fallbackTransition=function co(ce,I,B){return new Cr(ce,{type:1,animation:{type:2,steps:[],options:null},matchers:[(nt,gt)=>!0],options:null,queryCount:0,depCount:0},I)}(I,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(I,B,W,ue){return this.transitionFactories.find(nt=>nt.match(I,B,W,ue))||null}matchStyles(I,B,W){return this.fallbackTransition.buildStyles(I,B,W)}}function ia(ce,I,B){ce.has(I)?ce.has(B)||ce.set(B,ce.get(I)):ce.has(B)&&ce.set(I,ce.get(B))}const Ir=new Te;class Kn{constructor(I,B,W){this.bodyNode=I,this._driver=B,this._normalizer=W,this._animations=new Map,this._playersById=new Map,this.players=[]}register(I,B){const W=[],Se=Or(this._driver,B,W,[]);if(W.length)throw function tn(ce){return new b.vHH(3503,!1)}();this._animations.set(I,Se)}_buildPlayer(I,B,W){const ue=I.element,Se=xn(this._normalizer,I.keyframes,B,W);return this._driver.animate(ue,Se,I.duration,I.delay,I.easing,[],!0)}create(I,B,W={}){const ue=[],Se=this._animations.get(I);let nt;const gt=new Map;if(Se?(nt=Tn(this._driver,B,Se,rr,No,new Map,new Map,W,Ir,ue),nt.forEach(gi=>{const Wn=ti(gt,gi.element,new Map);gi.postStyleProps.forEach(mr=>Wn.set(mr,null))})):(ue.push(function Re(){return new b.vHH(3300,!1)}()),nt=[]),ue.length)throw function Ne(ce){return new b.vHH(3504,!1)}();gt.forEach((gi,Wn)=>{gi.forEach((mr,Yi)=>{gi.set(Yi,this._driver.computeStyle(Wn,Yi,pt.l3))})});const fn=St(nt.map(gi=>{const Wn=gt.get(gi.element);return this._buildPlayer(gi,new Map,Wn)}));return this._playersById.set(I,fn),fn.onDestroy(()=>this.destroy(I)),this.players.push(fn),fn}destroy(I){const B=this._getPlayer(I);B.destroy(),this._playersById.delete(I);const W=this.players.indexOf(B);W>=0&&this.players.splice(W,1)}_getPlayer(I){const B=this._playersById.get(I);if(!B)throw function at(ce){return new b.vHH(3301,!1)}();return B}listen(I,B,W,ue){const Se=qn(B,"","","");return Hn(this._getPlayer(I),W,Se,ue),()=>{}}command(I,B,W,ue){if("register"==W)return void this.register(I,ue[0]);if("create"==W)return void this.create(I,B,ue[0]||{});const Se=this._getPlayer(I);switch(W){case"play":Se.play();break;case"pause":Se.pause();break;case"reset":Se.reset();break;case"restart":Se.restart();break;case"finish":Se.finish();break;case"init":Se.init();break;case"setPosition":Se.setPosition(parseFloat(ue[0]));break;case"destroy":this.destroy(I)}}}const Ti="ng-animate-queued",ts="ng-animate-disabled",Xr=[],_o={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},So={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},xi="__ng_removed";class Fo{get params(){return this.options.params}constructor(I,B=""){this.namespaceId=B;const W=I&&I.hasOwnProperty("value");if(this.value=function bs(ce){return ce??null}(W?I.value:I),W){const Se=rt(I);delete Se.value,this.options=Se}else this.options={};this.options.params||(this.options.params={})}absorbOptions(I){const B=I.params;if(B){const W=this.options.params;Object.keys(B).forEach(ue=>{null==W[ue]&&(W[ue]=B[ue])})}}}const Fs="void",ss=new Fo(Fs);class kr{constructor(I,B,W){this.id=I,this.hostElement=B,this._engine=W,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+I,_i(B,this._hostClassName)}listen(I,B,W,ue){if(!this._triggers.has(B))throw function At(ce,I){return new b.vHH(3302,!1)}();if(null==W||0==W.length)throw function en(ce){return new b.vHH(3303,!1)}();if(!function Ji(ce){return"start"==ce||"done"==ce}(W))throw function on(ce,I){return new b.vHH(3400,!1)}();const Se=ti(this._elementListeners,I,[]),nt={name:B,phase:W,callback:ue};Se.push(nt);const gt=ti(this._engine.statesByElement,I,new Map);return gt.has(B)||(_i(I,Ue),_i(I,Ue+"-"+B),gt.set(B,ss)),()=>{this._engine.afterFlush(()=>{const Zt=Se.indexOf(nt);Zt>=0&&Se.splice(Zt,1),this._triggers.has(B)||gt.delete(B)})}}register(I,B){return!this._triggers.has(I)&&(this._triggers.set(I,B),!0)}_getTrigger(I){const B=this._triggers.get(I);if(!B)throw function Zn(ce){return new b.vHH(3401,!1)}();return B}trigger(I,B,W,ue=!0){const Se=this._getTrigger(B),nt=new xs(this.id,B,I);let gt=this._engine.statesByElement.get(I);gt||(_i(I,Ue),_i(I,Ue+"-"+B),this._engine.statesByElement.set(I,gt=new Map));let Zt=gt.get(B);const fn=new Fo(W,this.id);if(!(W&&W.hasOwnProperty("value"))&&Zt&&fn.absorbOptions(Zt.options),gt.set(B,fn),Zt||(Zt=ss),fn.value!==Fs&&Zt.value===fn.value){if(!function aa(ce,I){const B=Object.keys(ce),W=Object.keys(I);if(B.length!=W.length)return!1;for(let ue=0;ue<B.length;ue++){const Se=B[ue];if(!I.hasOwnProperty(Se)||ce[Se]!==I[Se])return!1}return!0}(Zt.params,fn.params)){const Vi=[],Kr=Se.matchStyles(Zt.value,Zt.params,Vi),xo=Se.matchStyles(fn.value,fn.params,Vi);Vi.length?this._engine.reportError(Vi):this._engine.afterFlush(()=>{wt(I,Kr),je(I,xo)})}return}const mr=ti(this._engine.playersByElement,I,[]);mr.forEach(Vi=>{Vi.namespaceId==this.id&&Vi.triggerName==B&&Vi.queued&&Vi.destroy()});let Yi=Se.matchTransition(Zt.value,fn.value,I,fn.params),Oi=!1;if(!Yi){if(!ue)return;Yi=Se.fallbackTransition,Oi=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:I,triggerName:B,transition:Yi,fromState:Zt,toState:fn,player:nt,isFallbackTransition:Oi}),Oi||(_i(I,Ti),nt.onStart(()=>{sa(I,Ti)})),nt.onDone(()=>{let Vi=this.players.indexOf(nt);Vi>=0&&this.players.splice(Vi,1);const Kr=this._engine.playersByElement.get(I);if(Kr){let xo=Kr.indexOf(nt);xo>=0&&Kr.splice(xo,1)}}),this.players.push(nt),mr.push(nt),nt}deregister(I){this._triggers.delete(I),this._engine.statesByElement.forEach(B=>B.delete(I)),this._elementListeners.forEach((B,W)=>{this._elementListeners.set(W,B.filter(ue=>ue.name!=I))})}clearElementCache(I){this._engine.statesByElement.delete(I),this._elementListeners.delete(I);const B=this._engine.playersByElement.get(I);B&&(B.forEach(W=>W.destroy()),this._engine.playersByElement.delete(I))}_signalRemovalForInnerTriggers(I,B){const W=this._engine.driver.query(I,ae,!0);W.forEach(ue=>{if(ue[xi])return;const Se=this._engine.fetchNamespacesByElement(ue);Se.size?Se.forEach(nt=>nt.triggerLeaveAnimation(ue,B,!1,!0)):this.clearElementCache(ue)}),this._engine.afterFlushAnimationsDone(()=>W.forEach(ue=>this.clearElementCache(ue)))}triggerLeaveAnimation(I,B,W,ue){const Se=this._engine.statesByElement.get(I),nt=new Map;if(Se){const gt=[];if(Se.forEach((Zt,fn)=>{if(nt.set(fn,Zt.value),this._triggers.has(fn)){const gi=this.trigger(I,fn,Fs,ue);gi&&gt.push(gi)}}),gt.length)return this._engine.markElementAsRemoved(this.id,I,!0,B,nt),W&&St(gt).onDone(()=>this._engine.processLeaveNode(I)),!0}return!1}prepareLeaveAnimationListeners(I){const B=this._elementListeners.get(I),W=this._engine.statesByElement.get(I);if(B&&W){const ue=new Set;B.forEach(Se=>{const nt=Se.name;if(ue.has(nt))return;ue.add(nt);const Zt=this._triggers.get(nt).fallbackTransition,fn=W.get(nt)||ss,gi=new Fo(Fs),Wn=new xs(this.id,nt,I);this._engine.totalQueuedPlayers++,this._queue.push({element:I,triggerName:nt,transition:Zt,fromState:fn,toState:gi,player:Wn,isFallbackTransition:!0})})}}removeNode(I,B){const W=this._engine;if(I.childElementCount&&this._signalRemovalForInnerTriggers(I,B),this.triggerLeaveAnimation(I,B,!0))return;let ue=!1;if(W.totalAnimations){const Se=W.players.length?W.playersByQueriedElement.get(I):[];if(Se&&Se.length)ue=!0;else{let nt=I;for(;nt=nt.parentNode;)if(W.statesByElement.get(nt)){ue=!0;break}}}if(this.prepareLeaveAnimationListeners(I),ue)W.markElementAsRemoved(this.id,I,!1,B);else{const Se=I[xi];(!Se||Se===_o)&&(W.afterFlush(()=>this.clearElementCache(I)),W.destroyInnerAnimations(I),W._onRemovalComplete(I,B))}}insertNode(I,B){_i(I,this._hostClassName)}drainQueuedTransitions(I){const B=[];return this._queue.forEach(W=>{const ue=W.player;if(ue.destroyed)return;const Se=W.element,nt=this._elementListeners.get(Se);nt&&nt.forEach(gt=>{if(gt.name==W.triggerName){const Zt=qn(Se,W.triggerName,W.fromState.value,W.toState.value);Zt._data=I,Hn(W.player,gt.phase,Zt,gt.callback)}}),ue.markedForDestroy?this._engine.afterFlush(()=>{ue.destroy()}):B.push(W)}),this._queue=[],B.sort((W,ue)=>{const Se=W.transition.ast.depCount,nt=ue.transition.ast.depCount;return 0==Se||0==nt?Se-nt:this._engine.driver.containsElement(W.element,ue.element)?1:-1})}destroy(I){this.players.forEach(B=>B.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,I)}}class _a{_onRemovalComplete(I,B){this.onRemovalComplete(I,B)}constructor(I,B,W){this.bodyNode=I,this.driver=B,this._normalizer=W,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(ue,Se)=>{}}get queuedPlayers(){const I=[];return this._namespaceList.forEach(B=>{B.players.forEach(W=>{W.queued&&I.push(W)})}),I}createNamespace(I,B){const W=new kr(I,B,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,B)?this._balanceNamespaceList(W,B):(this.newHostElements.set(B,W),this.collectEnterElement(B)),this._namespaceLookup[I]=W}_balanceNamespaceList(I,B){const W=this._namespaceList,ue=this.namespacesByHostElement;if(W.length-1>=0){let nt=!1,gt=this.driver.getParentElement(B);for(;gt;){const Zt=ue.get(gt);if(Zt){const fn=W.indexOf(Zt);W.splice(fn+1,0,I),nt=!0;break}gt=this.driver.getParentElement(gt)}nt||W.unshift(I)}else W.push(I);return ue.set(B,I),I}register(I,B){let W=this._namespaceLookup[I];return W||(W=this.createNamespace(I,B)),W}registerTrigger(I,B,W){let ue=this._namespaceLookup[I];ue&&ue.register(B,W)&&this.totalAnimations++}destroy(I,B){I&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const W=this._fetchNamespace(I);this.namespacesByHostElement.delete(W.hostElement);const ue=this._namespaceList.indexOf(W);ue>=0&&this._namespaceList.splice(ue,1),W.destroy(B),delete this._namespaceLookup[I]}))}_fetchNamespace(I){return this._namespaceLookup[I]}fetchNamespacesByElement(I){const B=new Set,W=this.statesByElement.get(I);if(W)for(let ue of W.values())if(ue.namespaceId){const Se=this._fetchNamespace(ue.namespaceId);Se&&B.add(Se)}return B}trigger(I,B,W,ue){if(ps(B)){const Se=this._fetchNamespace(I);if(Se)return Se.trigger(B,W,ue),!0}return!1}insertNode(I,B,W,ue){if(!ps(B))return;const Se=B[xi];if(Se&&Se.setForRemoval){Se.setForRemoval=!1,Se.setForMove=!0;const nt=this.collectedLeaveElements.indexOf(B);nt>=0&&this.collectedLeaveElements.splice(nt,1)}if(I){const nt=this._fetchNamespace(I);nt&&nt.insertNode(B,W)}ue&&this.collectEnterElement(B)}collectEnterElement(I){this.collectedEnterElements.push(I)}markElementAsDisabled(I,B){B?this.disabledNodes.has(I)||(this.disabledNodes.add(I),_i(I,ts)):this.disabledNodes.has(I)&&(this.disabledNodes.delete(I),sa(I,ts))}removeNode(I,B,W){if(ps(B)){const ue=I?this._fetchNamespace(I):null;ue?ue.removeNode(B,W):this.markElementAsRemoved(I,B,!1,W);const Se=this.namespacesByHostElement.get(B);Se&&Se.id!==I&&Se.removeNode(B,W)}else this._onRemovalComplete(B,W)}markElementAsRemoved(I,B,W,ue,Se){this.collectedLeaveElements.push(B),B[xi]={namespaceId:I,setForRemoval:ue,hasAnimation:W,removedBeforeQueried:!1,previousTriggersValues:Se}}listen(I,B,W,ue,Se){return ps(B)?this._fetchNamespace(I).listen(B,W,ue,Se):()=>{}}_buildInstruction(I,B,W,ue,Se){return I.transition.build(this.driver,I.element,I.fromState.value,I.toState.value,W,ue,I.fromState.options,I.toState.options,B,Se)}destroyInnerAnimations(I){let B=this.driver.query(I,ae,!0);B.forEach(W=>this.destroyActiveAnimationsForElement(W)),0!=this.playersByQueriedElement.size&&(B=this.driver.query(I,Le,!0),B.forEach(W=>this.finishActiveQueriedAnimationOnElement(W)))}destroyActiveAnimationsForElement(I){const B=this.playersByElement.get(I);B&&B.forEach(W=>{W.queued?W.markedForDestroy=!0:W.destroy()})}finishActiveQueriedAnimationOnElement(I){const B=this.playersByQueriedElement.get(I);B&&B.forEach(W=>W.finish())}whenRenderingDone(){return new Promise(I=>{if(this.players.length)return St(this.players).onDone(()=>I());I()})}processLeaveNode(I){const B=I[xi];if(B&&B.setForRemoval){if(I[xi]=_o,B.namespaceId){this.destroyInnerAnimations(I);const W=this._fetchNamespace(B.namespaceId);W&&W.clearElementCache(I)}this._onRemovalComplete(I,B.setForRemoval)}I.classList?.contains(ts)&&this.markElementAsDisabled(I,!1),this.driver.query(I,".ng-animate-disabled",!0).forEach(W=>{this.markElementAsDisabled(W,!1)})}flush(I=-1){let B=[];if(this.newHostElements.size&&(this.newHostElements.forEach((W,ue)=>this._balanceNamespaceList(W,ue)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let W=0;W<this.collectedEnterElements.length;W++)_i(this.collectedEnterElements[W],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const W=[];try{B=this._flushAnimations(W,I)}finally{for(let ue=0;ue<W.length;ue++)W[ue]()}}else for(let W=0;W<this.collectedLeaveElements.length;W++)this.processLeaveNode(this.collectedLeaveElements[W]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(W=>W()),this._flushFns=[],this._whenQuietFns.length){const W=this._whenQuietFns;this._whenQuietFns=[],B.length?St(B).onDone(()=>{W.forEach(ue=>ue())}):W.forEach(ue=>ue())}}reportError(I){throw function ri(ce){return new b.vHH(3402,!1)}()}_flushAnimations(I,B){const W=new Te,ue=[],Se=new Map,nt=[],gt=new Map,Zt=new Map,fn=new Map,gi=new Set;this.disabledNodes.forEach(ye=>{gi.add(ye);const j=this.driver.query(ye,".ng-animate-queued",!0);for(let fe=0;fe<j.length;fe++)gi.add(j[fe])});const Wn=this.bodyNode,mr=Array.from(this.statesByElement.keys()),Yi=oa(mr,this.collectedEnterElements),Oi=new Map;let Vi=0;Yi.forEach((ye,j)=>{const fe=rr+Vi++;Oi.set(j,fe),ye.forEach(Xe=>_i(Xe,fe))});const Kr=[],xo=new Set,as=new Set;for(let ye=0;ye<this.collectedLeaveElements.length;ye++){const j=this.collectedLeaveElements[ye],fe=j[xi];fe&&fe.setForRemoval&&(Kr.push(j),xo.add(j),fe.hasAnimation?this.driver.query(j,".ng-star-inserted",!0).forEach(Xe=>xo.add(Xe)):as.add(j))}const Ds=new Map,Wo=oa(mr,Array.from(xo));Wo.forEach((ye,j)=>{const fe=No+Vi++;Ds.set(j,fe),ye.forEach(Xe=>_i(Xe,fe))}),I.push(()=>{Yi.forEach((ye,j)=>{const fe=Oi.get(j);ye.forEach(Xe=>sa(Xe,fe))}),Wo.forEach((ye,j)=>{const fe=Ds.get(j);ye.forEach(Xe=>sa(Xe,fe))}),Kr.forEach(ye=>{this.processLeaveNode(ye)})});const cl=[],$s=[];for(let ye=this._namespaceList.length-1;ye>=0;ye--)this._namespaceList[ye].drainQueuedTransitions(B).forEach(fe=>{const Xe=fe.player,rn=fe.element;if(cl.push(Xe),this.collectedEnterElements.length){const Xi=rn[xi];if(Xi&&Xi.setForMove){if(Xi.previousTriggersValues&&Xi.previousTriggersValues.has(fe.triggerName)){const wr=Xi.previousTriggersValues.get(fe.triggerName),Mr=this.statesByElement.get(fe.element);if(Mr&&Mr.has(fe.triggerName)){const qo=Mr.get(fe.triggerName);qo.value=wr,Mr.set(fe.triggerName,qo)}}return void Xe.destroy()}}const _n=!Wn||!this.driver.containsElement(Wn,rn),ki=Ds.get(rn),Gi=Oi.get(rn),Mi=this._buildInstruction(fe,W,Gi,ki,_n);if(Mi.errors&&Mi.errors.length)return void $s.push(Mi);if(_n)return Xe.onStart(()=>wt(rn,Mi.fromStyles)),Xe.onDestroy(()=>je(rn,Mi.toStyles)),void ue.push(Xe);if(fe.isFallbackTransition)return Xe.onStart(()=>wt(rn,Mi.fromStyles)),Xe.onDestroy(()=>je(rn,Mi.toStyles)),void ue.push(Xe);const Qi=[];Mi.timelines.forEach(Xi=>{Xi.stretchStartingKeyframe=!0,this.disabledNodes.has(Xi.element)||Qi.push(Xi)}),Mi.timelines=Qi,W.append(rn,Mi.timelines),nt.push({instruction:Mi,player:Xe,element:rn}),Mi.queriedElements.forEach(Xi=>ti(gt,Xi,[]).push(Xe)),Mi.preStyleProps.forEach((Xi,wr)=>{if(Xi.size){let Mr=Zt.get(wr);Mr||Zt.set(wr,Mr=new Set),Xi.forEach((qo,Cs)=>Mr.add(Cs))}}),Mi.postStyleProps.forEach((Xi,wr)=>{let Mr=fn.get(wr);Mr||fn.set(wr,Mr=new Set),Xi.forEach((qo,Cs)=>Mr.add(Cs))})});if($s.length){const ye=[];$s.forEach(j=>{ye.push(function nn(ce,I){return new b.vHH(3505,!1)}())}),cl.forEach(j=>j.destroy()),this.reportError(ye)}const _s=new Map,fa=new Map;nt.forEach(ye=>{const j=ye.element;W.has(j)&&(fa.set(j,j),this._beforeAnimationBuild(ye.player.namespaceId,ye.instruction,_s))}),ue.forEach(ye=>{const j=ye.element;this._getPreviousPlayers(j,!1,ye.namespaceId,ye.triggerName,null).forEach(Xe=>{ti(_s,j,[]).push(Xe),Xe.destroy()})});const Xs=Kr.filter(ye=>Go(ye,Zt,fn)),va=new Map;ra(va,this.driver,as,fn,pt.l3).forEach(ye=>{Go(ye,Zt,fn)&&Xs.push(ye)});const Ks=new Map;Yi.forEach((ye,j)=>{ra(Ks,this.driver,new Set(ye),Zt,pt.k1)}),Xs.forEach(ye=>{const j=va.get(ye),fe=Ks.get(ye);va.set(ye,new Map([...j?.entries()??[],...fe?.entries()??[]]))});const Vs=[],F=[],X={};nt.forEach(ye=>{const{element:j,player:fe,instruction:Xe}=ye;if(W.has(j)){if(gi.has(j))return fe.onDestroy(()=>je(j,Xe.toStyles)),fe.disabled=!0,fe.overrideTotalTime(Xe.totalTime),void ue.push(fe);let rn=X;if(fa.size>1){let ki=j;const Gi=[];for(;ki=ki.parentNode;){const Mi=fa.get(ki);if(Mi){rn=Mi;break}Gi.push(ki)}Gi.forEach(Mi=>fa.set(Mi,rn))}const _n=this._buildAnimation(fe.namespaceId,Xe,_s,Se,Ks,va);if(fe.setRealPlayer(_n),rn===X)Vs.push(fe);else{const ki=this.playersByElement.get(rn);ki&&ki.length&&(fe.parentPlayer=St(ki)),ue.push(fe)}}else wt(j,Xe.fromStyles),fe.onDestroy(()=>je(j,Xe.toStyles)),F.push(fe),gi.has(j)&&ue.push(fe)}),F.forEach(ye=>{const j=Se.get(ye.element);if(j&&j.length){const fe=St(j);ye.setRealPlayer(fe)}}),ue.forEach(ye=>{ye.parentPlayer?ye.syncPlayerEvents(ye.parentPlayer):ye.destroy()});for(let ye=0;ye<Kr.length;ye++){const j=Kr[ye],fe=j[xi];if(sa(j,No),fe&&fe.hasAnimation)continue;let Xe=[];if(gt.size){let _n=gt.get(j);_n&&_n.length&&Xe.push(..._n);let ki=this.driver.query(j,Le,!0);for(let Gi=0;Gi<ki.length;Gi++){let Mi=gt.get(ki[Gi]);Mi&&Mi.length&&Xe.push(...Mi)}}const rn=Xe.filter(_n=>!_n.destroyed);rn.length?Ns(this,j,rn):this.processLeaveNode(j)}return Kr.length=0,Vs.forEach(ye=>{this.players.push(ye),ye.onDone(()=>{ye.destroy();const j=this.players.indexOf(ye);this.players.splice(j,1)}),ye.play()}),Vs}afterFlush(I){this._flushFns.push(I)}afterFlushAnimationsDone(I){this._whenQuietFns.push(I)}_getPreviousPlayers(I,B,W,ue,Se){let nt=[];if(B){const gt=this.playersByQueriedElement.get(I);gt&&(nt=gt)}else{const gt=this.playersByElement.get(I);if(gt){const Zt=!Se||Se==Fs;gt.forEach(fn=>{fn.queued||!Zt&&fn.triggerName!=ue||nt.push(fn)})}}return(W||ue)&&(nt=nt.filter(gt=>!(W&&W!=gt.namespaceId||ue&&ue!=gt.triggerName))),nt}_beforeAnimationBuild(I,B,W){const Se=B.element,nt=B.isRemovalTransition?void 0:I,gt=B.isRemovalTransition?void 0:B.triggerName;for(const Zt of B.timelines){const fn=Zt.element,gi=fn!==Se,Wn=ti(W,fn,[]);this._getPreviousPlayers(fn,gi,nt,gt,B.toState).forEach(Yi=>{const Oi=Yi.getRealPlayer();Oi.beforeDestroy&&Oi.beforeDestroy(),Yi.destroy(),Wn.push(Yi)})}wt(Se,B.fromStyles)}_buildAnimation(I,B,W,ue,Se,nt){const gt=B.triggerName,Zt=B.element,fn=[],gi=new Set,Wn=new Set,mr=B.timelines.map(Oi=>{const Vi=Oi.element;gi.add(Vi);const Kr=Vi[xi];if(Kr&&Kr.removedBeforeQueried)return new pt.ZN(Oi.duration,Oi.delay);const xo=Vi!==Zt,as=function da(ce){const I=[];return Ho(ce,I),I}((W.get(Vi)||Xr).map(_s=>_s.getRealPlayer())).filter(_s=>!!_s.element&&_s.element===Vi),Ds=Se.get(Vi),Wo=nt.get(Vi),cl=xn(this._normalizer,Oi.keyframes,Ds,Wo),$s=this._buildPlayer(Oi,cl,as);if(Oi.subTimeline&&ue&&Wn.add(Vi),xo){const _s=new xs(I,gt,Vi);_s.setRealPlayer($s),fn.push(_s)}return $s});fn.forEach(Oi=>{ti(this.playersByQueriedElement,Oi.element,[]).push(Oi),Oi.onDone(()=>function fs(ce,I,B){let W=ce.get(I);if(W){if(W.length){const ue=W.indexOf(B);W.splice(ue,1)}0==W.length&&ce.delete(I)}return W}(this.playersByQueriedElement,Oi.element,Oi))}),gi.forEach(Oi=>_i(Oi,de));const Yi=St(mr);return Yi.onDestroy(()=>{gi.forEach(Oi=>sa(Oi,de)),je(Zt,B.toStyles)}),Wn.forEach(Oi=>{ti(ue,Oi,[]).push(Yi)}),Yi}_buildPlayer(I,B,W){return B.length>0?this.driver.animate(I.element,B,I.duration,I.delay,I.easing,W):new pt.ZN(I.duration,I.delay)}}class xs{constructor(I,B,W){this.namespaceId=I,this.triggerName=B,this.element=W,this._player=new pt.ZN,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(I){this._containsRealPlayer||(this._player=I,this._queuedCallbacks.forEach((B,W)=>{B.forEach(ue=>Hn(I,W,void 0,ue))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(I.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(I){this.totalTime=I}syncPlayerEvents(I){const B=this._player;B.triggerCallback&&I.onStart(()=>B.triggerCallback("start")),I.onDone(()=>this.finish()),I.onDestroy(()=>this.destroy())}_queueEvent(I,B){ti(this._queuedCallbacks,I,[]).push(B)}onDone(I){this.queued&&this._queueEvent("done",I),this._player.onDone(I)}onStart(I){this.queued&&this._queueEvent("start",I),this._player.onStart(I)}onDestroy(I){this.queued&&this._queueEvent("destroy",I),this._player.onDestroy(I)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(I){this.queued||this._player.setPosition(I)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(I){const B=this._player;B.triggerCallback&&B.triggerCallback(I)}}function ps(ce){return ce&&1===ce.nodeType}function Bs(ce,I){const B=ce.style.display;return ce.style.display=I??"none",B}function ra(ce,I,B,W,ue){const Se=[];B.forEach(Zt=>Se.push(Bs(Zt)));const nt=[];W.forEach((Zt,fn)=>{const gi=new Map;Zt.forEach(Wn=>{const mr=I.computeStyle(fn,Wn,ue);gi.set(Wn,mr),(!mr||0==mr.length)&&(fn[xi]=So,nt.push(fn))}),ce.set(fn,gi)});let gt=0;return B.forEach(Zt=>Bs(Zt,Se[gt++])),nt}function oa(ce,I){const B=new Map;if(ce.forEach(gt=>B.set(gt,[])),0==I.length)return B;const ue=new Set(I),Se=new Map;function nt(gt){if(!gt)return 1;let Zt=Se.get(gt);if(Zt)return Zt;const fn=gt.parentNode;return Zt=B.has(fn)?fn:ue.has(fn)?1:nt(fn),Se.set(gt,Zt),Zt}return I.forEach(gt=>{const Zt=nt(gt);1!==Zt&&B.get(Zt).push(gt)}),B}function _i(ce,I){ce.classList?.add(I)}function sa(ce,I){ce.classList?.remove(I)}function Ns(ce,I,B){St(B).onDone(()=>ce.processLeaveNode(I))}function Ho(ce,I){for(let B=0;B<ce.length;B++){const W=ce[B];W instanceof pt.ZE?Ho(W.players,I):I.push(W)}}function Go(ce,I,B){const W=B.get(ce);if(!W)return!1;let ue=I.get(ce);return ue?W.forEach(Se=>ue.add(Se)):I.set(ce,W),B.delete(ce),!0}class $o{constructor(I,B,W){this.bodyNode=I,this._driver=B,this._normalizer=W,this._triggerCache={},this.onRemovalComplete=(ue,Se)=>{},this._transitionEngine=new _a(I,B,W),this._timelineEngine=new Kn(I,B,W),this._transitionEngine.onRemovalComplete=(ue,Se)=>this.onRemovalComplete(ue,Se)}registerTrigger(I,B,W,ue,Se){const nt=I+"-"+ue;let gt=this._triggerCache[nt];if(!gt){const Zt=[],gi=Or(this._driver,Se,Zt,[]);if(Zt.length)throw function Ht(ce,I){return new b.vHH(3404,!1)}();gt=function na(ce,I,B){return new hs(ce,I,B)}(ue,gi,this._normalizer),this._triggerCache[nt]=gt}this._transitionEngine.registerTrigger(B,ue,gt)}register(I,B){this._transitionEngine.register(I,B)}destroy(I,B){this._transitionEngine.destroy(I,B)}onInsert(I,B,W,ue){this._transitionEngine.insertNode(I,B,W,ue)}onRemove(I,B,W){this._transitionEngine.removeNode(I,B,W)}disableAnimations(I,B){this._transitionEngine.markElementAsDisabled(I,B)}process(I,B,W,ue){if("@"==W.charAt(0)){const[Se,nt]=Xn(W);this._timelineEngine.command(Se,B,nt,ue)}else this._transitionEngine.trigger(I,B,W,ue)}listen(I,B,W,ue,Se){if("@"==W.charAt(0)){const[nt,gt]=Xn(W);return this._timelineEngine.listen(nt,B,gt,Se)}return this._transitionEngine.listen(I,B,W,ue,Se)}flush(I=-1){this._transitionEngine.flush(I)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(I){this._transitionEngine.afterFlushAnimationsDone(I)}}let Ka=(()=>{class I{constructor(W,ue,Se){this._element=W,this._startStyles=ue,this._endStyles=Se,this._state=0;let nt=I.initialStylesByElement.get(W);nt||I.initialStylesByElement.set(W,nt=new Map),this._initialStyles=nt}start(){this._state<1&&(this._startStyles&&je(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(je(this._element,this._initialStyles),this._endStyles&&(je(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(I.initialStylesByElement.delete(this._element),this._startStyles&&(wt(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(wt(this._element,this._endStyles),this._endStyles=null),je(this._element,this._initialStyles),this._state=3)}}return I.initialStylesByElement=new WeakMap,I})();function jr(ce){let I=null;return ce.forEach((B,W)=>{(function Bo(ce){return"display"===ce||"position"===ce})(W)&&(I=I||new Map,I.set(W,B))}),I}class Ea{constructor(I,B,W,ue){this.element=I,this.keyframes=B,this.options=W,this._specialStyles=ue,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=W.duration,this._delay=W.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(I=>I()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const I=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,I,this.options),this._finalKeyframe=I.length?I[I.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(I){const B=[];return I.forEach(W=>{B.push(Object.fromEntries(W))}),B}_triggerWebAnimation(I,B,W){return I.animate(this._convertKeyframesToObject(B),W)}onStart(I){this._originalOnStartFns.push(I),this._onStartFns.push(I)}onDone(I){this._originalOnDoneFns.push(I),this._onDoneFns.push(I)}onDestroy(I){this._onDestroyFns.push(I)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(I=>I()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(I=>I()),this._onDestroyFns=[])}setPosition(I){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=I*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const I=new Map;this.hasStarted()&&this._finalKeyframe.forEach((W,ue)=>{"offset"!==ue&&I.set(ue,this._finished?W:Wr(this.element,ue))}),this.currentSnapshot=I}triggerCallback(I){const B="start"===I?this._onStartFns:this._onDoneFns;B.forEach(W=>W()),B.length=0}}class zs{validateStyleProperty(I){return!0}validateAnimatableStyleProperty(I){return!0}matchesElement(I,B){return!1}containsElement(I,B){return po(I,B)}getParentElement(I){return yn(I)}query(I,B,W){return wi(I,B,W)}computeStyle(I,B,W){return window.getComputedStyle(I)[B]}animate(I,B,W,ue,Se,nt=[]){const Zt={duration:W,delay:ue,fill:0==ue?"both":"forwards"};Se&&(Zt.easing=Se);const fn=new Map,gi=nt.filter(Yi=>Yi instanceof Ea);(function Di(ce,I){return 0===ce||0===I})(W,ue)&&gi.forEach(Yi=>{Yi.currentSnapshot.forEach((Oi,Vi)=>fn.set(Vi,Oi))});let Wn=function bn(ce){return ce.length?ce[0]instanceof Map?ce:ce.map(I=>Bt(I)):[]}(B).map(Yi=>Ye(Yi));Wn=function no(ce,I,B){if(B.size&&I.length){let W=I[0],ue=[];if(B.forEach((Se,nt)=>{W.has(nt)||ue.push(nt),W.set(nt,Se)}),ue.length)for(let Se=1;Se<I.length;Se++){let nt=I[Se];ue.forEach(gt=>nt.set(gt,Wr(ce,gt)))}}return I}(I,Wn,fn);const mr=function yo(ce,I){let B=null,W=null;return Array.isArray(I)&&I.length?(B=jr(I[0]),I.length>1&&(W=jr(I[I.length-1]))):I instanceof Map&&(B=jr(I)),B||W?new Ka(ce,B,W):null}(I,Wn);return new Ea(I,Wn,Zt,mr)}}var ms=le(6814);let T=(()=>{var ce;class I extends pt._j{constructor(W,ue){super(),this._nextAnimationId=0,this._renderer=W.createRenderer(ue.body,{id:"0",encapsulation:b.ifc.None,styles:[],data:{animation:[]}})}build(W){const ue=this._nextAnimationId.toString();this._nextAnimationId++;const Se=Array.isArray(W)?(0,pt.vP)(W):W;return Q(this._renderer,null,ue,"register",[Se]),new K(ue,this._renderer)}}return(ce=I).\u0275fac=function(W){return new(W||ce)(b.LFG(b.FYo),b.LFG(ms.K0))},ce.\u0275prov=b.Yz7({token:ce,factory:ce.\u0275fac}),I})();class K extends pt.LC{constructor(I,B){super(),this._id=I,this._renderer=B}create(I,B){return new S(this._id,I,B||{},this._renderer)}}class S{constructor(I,B,W,ue){this.id=I,this.element=B,this._renderer=ue,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",W)}_listen(I,B){return this._renderer.listen(this.element,`@@${this.id}:${I}`,B)}_command(I,...B){return Q(this._renderer,this.element,this.id,I,B)}onDone(I){this._listen("done",I)}onStart(I){this._listen("start",I)}onDestroy(I){this._listen("destroy",I)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(I){this._command("setPosition",I)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function Q(ce,I,B,W,ue){return ce.setProperty(I,`@@${B}:${W}`,ue)}const wn="@.disabled";let ai=(()=>{var ce;class I{constructor(W,ue,Se){this.delegate=W,this.engine=ue,this._zone=Se,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,ue.onRemovalComplete=(nt,gt)=>{const Zt=gt?.parentNode(nt);Zt&&gt.removeChild(Zt,nt)}}createRenderer(W,ue){const nt=this.delegate.createRenderer(W,ue);if(!(W&&ue&&ue.data&&ue.data.animation)){let Wn=this._rendererCache.get(nt);return Wn||(Wn=new oi("",nt,this.engine,()=>this._rendererCache.delete(nt)),this._rendererCache.set(nt,Wn)),Wn}const gt=ue.id,Zt=ue.id+"-"+this._currentId;this._currentId++,this.engine.register(Zt,W);const fn=Wn=>{Array.isArray(Wn)?Wn.forEach(fn):this.engine.registerTrigger(gt,Zt,W,Wn.name,Wn)};return ue.data.animation.forEach(fn),new Lr(this,Zt,nt,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(W,ue,Se){W>=0&&W<this._microtaskId?this._zone.run(()=>ue(Se)):(0==this._animationCallbacksBuffer.length&&queueMicrotask(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(nt=>{const[gt,Zt]=nt;gt(Zt)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([ue,Se]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return(ce=I).\u0275fac=function(W){return new(W||ce)(b.LFG(b.FYo),b.LFG($o),b.LFG(b.R0b))},ce.\u0275prov=b.Yz7({token:ce,factory:ce.\u0275fac}),I})();class oi{constructor(I,B,W,ue){this.namespaceId=I,this.delegate=B,this.engine=W,this._onDestroy=ue}get data(){return this.delegate.data}destroyNode(I){this.delegate.destroyNode?.(I)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(I,B){return this.delegate.createElement(I,B)}createComment(I){return this.delegate.createComment(I)}createText(I){return this.delegate.createText(I)}appendChild(I,B){this.delegate.appendChild(I,B),this.engine.onInsert(this.namespaceId,B,I,!1)}insertBefore(I,B,W,ue=!0){this.delegate.insertBefore(I,B,W),this.engine.onInsert(this.namespaceId,B,I,ue)}removeChild(I,B,W){this.engine.onRemove(this.namespaceId,B,this.delegate)}selectRootElement(I,B){return this.delegate.selectRootElement(I,B)}parentNode(I){return this.delegate.parentNode(I)}nextSibling(I){return this.delegate.nextSibling(I)}setAttribute(I,B,W,ue){this.delegate.setAttribute(I,B,W,ue)}removeAttribute(I,B,W){this.delegate.removeAttribute(I,B,W)}addClass(I,B){this.delegate.addClass(I,B)}removeClass(I,B){this.delegate.removeClass(I,B)}setStyle(I,B,W,ue){this.delegate.setStyle(I,B,W,ue)}removeStyle(I,B,W){this.delegate.removeStyle(I,B,W)}setProperty(I,B,W){"@"==B.charAt(0)&&B==wn?this.disableAnimations(I,!!W):this.delegate.setProperty(I,B,W)}setValue(I,B){this.delegate.setValue(I,B)}listen(I,B,W){return this.delegate.listen(I,B,W)}disableAnimations(I,B){this.engine.disableAnimations(I,B)}}class Lr extends oi{constructor(I,B,W,ue,Se){super(B,W,ue,Se),this.factory=I,this.namespaceId=B}setProperty(I,B,W){"@"==B.charAt(0)?"."==B.charAt(1)&&B==wn?this.disableAnimations(I,W=void 0===W||!!W):this.engine.process(this.namespaceId,I,B.slice(1),W):this.delegate.setProperty(I,B,W)}listen(I,B,W){if("@"==B.charAt(0)){const ue=function vo(ce){switch(ce){case"body":return document.body;case"document":return document;case"window":return window;default:return ce}}(I);let Se=B.slice(1),nt="";return"@"!=Se.charAt(0)&&([Se,nt]=function ee(ce){const I=ce.indexOf(".");return[ce.substring(0,I),ce.slice(I+1)]}(Se)),this.engine.listen(this.namespaceId,ue,Se,nt,gt=>{this.factory.scheduleListenerCallback(gt._data||-1,W,gt)})}return this.delegate.listen(I,B,W)}}const Be=[{provide:pt._j,useClass:T},{provide:ao,useFactory:function xe(){return new Ls}},{provide:$o,useClass:(()=>{var ce;class I extends $o{constructor(W,ue,Se,nt){super(W.body,ue,Se)}ngOnDestroy(){this.flush()}}return(ce=I).\u0275fac=function(W){return new(W||ce)(b.LFG(ms.K0),b.LFG(fi),b.LFG(ao),b.LFG(b.z2F))},ce.\u0275prov=b.Yz7({token:ce,factory:ce.\u0275fac}),I})()},{provide:b.FYo,useFactory:function te(ce,I,B){return new ai(ce,I,B)},deps:[M.se,$o,b.R0b]}],zn=[{provide:fi,useFactory:()=>new zs},{provide:b.QbO,useValue:"BrowserAnimations"},...Be],zi=[{provide:fi,useClass:Er},{provide:b.QbO,useValue:"NoopAnimations"},...Be];let ns=(()=>{var ce;class I{static withConfig(W){return{ngModule:I,providers:W.disableAnimations?zi:zn}}}return(ce=I).\u0275fac=function(W){return new(W||ce)},ce.\u0275mod=b.oAB({type:ce}),ce.\u0275inj=b.cJS({providers:zn,imports:[M.b2]}),I})(),ya=(()=>{var ce;class I{}return(ce=I).\u0275fac=function(W){return new(W||ce)},ce.\u0275mod=b.oAB({type:ce,bootstrap:[Me]}),ce.\u0275inj=b.cJS({providers:[{provide:Ft.wN,useClass:l.r4}],imports:[M.b2,l.Pc.forRoot(),Ke,ns]}),I})();var gs=le(2574);le.n(gs)().accessToken="pk.eyJ1IjoicGF0MWhubyIsImEiOiJjbG5naWgyOXIwYnF2Mm1vOXhueWFtbXM4In0.zfLtRF__vmCcRycCOuJbPw",(0,b.G48)(),M.q6().bootstrapModule(ya).catch(ce=>console.log(ce))},2574:function(ci){ci.exports=function(){"use strict";var Qt,le,M;function b(l,Me){if(Qt)if(le){var ht="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Qt+")(sharedChunk); ("+le+")(sharedChunk); self.onerror = null;",Ke={};Qt(Ke),M=Me(Ke),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(M.workerUrl=window.URL.createObjectURL(new Blob([ht],{type:"text/javascript"})))}else le=Me;else Qt=Me}return b(0,function(l){var Me=typeof self<"u"?self:{},ht="2.15.0";let Ke;const pt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Ke){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ke=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):n}catch{Ke=n}}return Ke},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!pt.API_URL)return null;try{const n=new URL(pt.API_URL);return"api.mapbox.cn"===n.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===n.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},yt={supported:!1,testSupport:function(n){!bt&&st&&(mt?Qe(n):Dt=n)}};let Dt,st,bt=!1,mt=!1;function Qe(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,st),n.isContextLost())return;yt.supported=!0}catch{}n.deleteTexture(e),bt=!0}Me.document&&(st=Me.document.createElement("img"),st.onload=function(){Dt&&Qe(Dt),Dt=null,mt=!0},st.onerror=function(){bt=!0,Dt=null},st.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const _t="01";function Wt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ct=it;function it(n,e,i,s){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=e,this.p2x=i,this.p2y=s}it.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,e){if(void 0===e&&(e=1e-6),n<0)return 0;if(n>1)return 1;for(var i=n,s=0;s<8;s++){var u=this.sampleCurveX(i)-n;if(Math.abs(u)<e)return i;var f=this.sampleCurveDerivativeX(i);if(Math.abs(f)<1e-6)break;i-=u/f}var g=0,y=1;for(i=n,s=0;s<20&&(u=this.sampleCurveX(i),!(Math.abs(u-n)<e));s++)n>u?g=i:y=i,i=.5*(y-g)+g;return i},solve:function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))}};var Kt=Wt(Ct),Tt=Ze;function Ze(n,e){this.x=n,this.y=e}Ze.prototype={clone:function(){return new Ze(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),i=Math.sin(n),s=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=s,this},_rotateAround:function(n,e){var i=Math.cos(n),s=Math.sin(n),u=e.y+s*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-s*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ze.convert=function(n){return n instanceof Ze?n:Array.isArray(n)?new Ze(n[0],n[1]):n};var Fe=Wt(Tt);const $t=Math.PI/180,un=180/Math.PI;function De(n){return n*$t}function dt(n){return n*un}const Lt=[[0,0],[1,0],[1,1],[0,1]];function ft(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function pn(n,e,i,s){const u=new Kt(n,e,i,s);return function(f){return u.solve(f)}}const hn=pn(.25,.1,.25,1);function Vt(n,e,i){return Math.min(i,Math.max(e,n))}function Jn(n,e,i){return(i=Vt((i-n)/(e-n),0,1))*i*(3-2*i)}function Ht(n,e,i){const s=i-e,u=((n-e)%s+s)%s+e;return u===e?i:u}function li(n,e,i){if(!n.length)return i(null,[]);let s=n.length;const u=new Array(n.length);let f=null;n.forEach((g,y)=>{e(g,(w,E)=>{w&&(f=w),u[y]=E,0==--s&&i(f,u)})})}function tn(n){const e=[];for(const i in n)e.push(n[i]);return e}function Re(n,...e){for(const i of e)for(const s in i)n[s]=i[s];return n}let Ne=1;function at(){return Ne++}function At(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function en(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function on(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function Zn(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function ri(n,e){return-1!==n.indexOf(e,n.length-e.length)}function Cn(n,e,i){const s={};for(const u in n)s[u]=e.call(i||this,n[u],u,n);return s}function nn(n,e,i){const s={};for(const u in n)e.call(i||this,n[u],u,n)&&(s[u]=n[u]);return s}function xt(n){return Array.isArray(n)?n.map(xt):"object"==typeof n&&n?Cn(n,xt):n}const St={};function xn(n){St[n]||(typeof console<"u"&&console.warn(n),St[n]=!0)}function Hn(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function yi(n){let e=0;for(let i,s,u=0,f=n.length,g=f-1;u<f;g=u++)i=n[u],s=n[g],e+=(s.x-i.x)*(i.y+s.y);return e}function qn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ti(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,u,f)=>{const g=u||f;return e[s]=!g||g.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Xn=null;function ar(n){if(null==Xn){const e=n.navigator?n.navigator.userAgent:null;Xn=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Xn}function yn(n){try{const e=Me[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function lr(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}const Pr="mapbox-tiles";let Si,$i,pr=500,oo=50;function po(){try{return Me.caches}catch{}}function wi(){po()&&!Si&&(Si=Me.caches.open(Pr))}function Hr(n){const e=n.indexOf("?");if(e<0)return n;const s=function(u){const f=u.indexOf("?");return f>0?u.slice(f+1).split("&"):[]}(n).filter(u=>{const f=u.split("=");return"language"===f[0]||"worldview"===f[0]});return s.length?`${n.slice(0,e)}?${s.join("&")}`:n.slice(0,e)}let Er=1/0;const fi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(fi);class Sr extends Error{constructor(e,i,s){401===i&&Rt(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const gr=qn()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Me.location.protocol?Me.parent:Me).location.href,ir=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(gr())&&!/^\w+:/.test(i))){if(Me.fetch&&Me.Request&&Me.AbortController&&Me.Request.prototype.hasOwnProperty("signal"))return function(s,u){const f=new Me.AbortController,g=new Me.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:gr(),referrerPolicy:s.referrerPolicy,signal:f.signal});let y=!1,w=!1;const E=(k=g.url).indexOf("sku=")>0&&Rt(k);var k;"json"===s.type&&g.headers.set("Accept","application/json");const z=(Y,J,oe)=>{if(w)return;if(Y&&"SecurityError"!==Y.message&&xn(Y.toString()),J&&oe)return U(J);const _e=Date.now();Me.fetch(g).then(Pe=>{if(Pe.ok){const qe=E?Pe.clone():null;return U(Pe,qe,_e)}return u(new Sr(Pe.statusText,Pe.status,s.url))}).catch(Pe=>{"AbortError"!==Pe.name&&u(new Error(`${Pe.message} ${s.url}`))})},U=(Y,J,oe)=>{("arrayBuffer"===s.type?Y.arrayBuffer():"json"===s.type?Y.json():Y.text()).then(_e=>{w||(J&&oe&&function(Pe,qe,Ae){if(wi(),!Si)return;const He={status:qe.status,statusText:qe.statusText,headers:new Me.Headers};qe.headers.forEach((Yt,zt)=>He.headers.set(zt,Yt));const tt=ti(qe.headers.get("Cache-Control")||"");if(tt["no-store"])return;tt["max-age"]&&He.headers.set("Expires",new Date(Ae+1e3*tt["max-age"]).toUTCString());const Je=He.headers.get("Expires");Je&&(new Date(Je).getTime()-Ae<42e4||function(Yt,zt){if(void 0===$i)try{new Response(new ReadableStream),$i=!0}catch{$i=!1}$i?zt(Yt.body):Yt.blob().then(zt)}(qe,Yt=>{const zt=new Me.Response(Yt,He);wi(),Si&&Si.then(dn=>dn.put(Hr(Pe.url),zt)).catch(dn=>xn(dn.message))}))}(g,J,oe),y=!0,u(null,_e,Y.headers.get("Cache-Control"),Y.headers.get("Expires")))}).catch(_e=>{w||u(new Error(_e.message))})};return E?function(Y,J){if(wi(),!Si)return J(null);const oe=Hr(Y.url);Si.then(_e=>{_e.match(oe).then(Pe=>{const qe=function(Ae){if(!Ae)return!1;const He=new Date(Ae.headers.get("Expires")||0),tt=ti(Ae.headers.get("Cache-Control")||"");return He>Date.now()&&!tt["no-cache"]}(Pe);_e.delete(oe),qe&&_e.put(oe,Pe.clone()),J(null,Pe,qe)}).catch(J)}).catch(J)}(g,z):z(null,null),{cancel:()=>{w=!0,y||f.abort()}}}(n,e);if(qn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(s,u){const f=new Me.XMLHttpRequest;f.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(f.responseType="arraybuffer");for(const g in s.headers)f.setRequestHeader(g,s.headers[g]);return"json"===s.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===s.credentials,f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let g=f.response;if("json"===s.type)try{g=JSON.parse(f.response)}catch(y){return u(y)}u(null,g,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new Sr(f.statusText,f.status,s.url))},f.send(s.body),{cancel:()=>f.abort()}}(n,e)},rr=function(n,e){return ir(Re(n,{type:"arrayBuffer"}),e)};function No(n){const e=Me.document.createElement("a");return e.href=n,e.protocol===Me.document.location.protocol&&e.host===Me.document.location.host}const Ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ae,de;ae=[],de=0;const Le=function(n,e){if(yt.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),de>=pt.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ae.push(f),f}de++;let i=!1;const s=()=>{if(!i)for(i=!0,de--;ae.length&&de<pt.MAX_PARALLEL_IMAGE_REQUESTS;){const f=ae.shift(),{requestParameters:g,callback:y,cancelled:w}=f;w||(f.cancel=Le(g,y).cancel)}},u=rr(n,(f,g,y,w)=>{s(),f?e(f):g&&(Me.createImageBitmap?function(E,k){const z=new Me.Blob([new Uint8Array(E)],{type:"image/png"});Me.createImageBitmap(z).then(U=>{k(null,U)}).catch(U=>{k(new Error(`Could not load image because of ${U.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(E,k)=>e(E,k,y,w)):function(E,k){const z=new Me.Image,U=Me.URL;z.onload=()=>{k(null,z),U.revokeObjectURL(z.src),z.onload=null,Me.requestAnimationFrame(()=>{z.src=Ue})},z.onerror=()=>k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Y=new Me.Blob([new Uint8Array(E)],{type:"image/png"});z.src=E.byteLength?U.createObjectURL(Y):Ue}(g,(E,k)=>e(E,k,y,w)))});return{cancel:()=>{u.cancel(),s()}}},We="NO_ACCESS_TOKEN";function ot(n){return 0===n.indexOf("mapbox:")}function Rt(n){return pt.API_URL_REGEX.test(n)}function It(n){return pt.API_CDN_URL_REGEX.test(n)}function rt(n){return pt.API_STYLE_REGEX.test(n)&&!Bt(n)}function Bt(n){return pt.API_SPRITE_REGEX.test(n)}const bn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Pn(n){const e=n.match(bn);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Ye(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}const je="mapbox.eventData";function wt(n){if(!n)return null;const e=n.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Me.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ge{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=wt(pt.ACCESS_TOKEN);let s="";return s=i&&i.u?Me.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(u,f)=>String.fromCharCode(+("0x"+f)))):pt.ACCESS_TOKEN||"",e?`${je}.${e}:${s}`:`${je}:${s}`}fetchEventData(){const e=yn("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const u=Me.localStorage.getItem(i);u&&(this.eventData=JSON.parse(u));const f=Me.localStorage.getItem(s);f&&(this.anonId=f)}catch{xn("Unable to read from LocalStorage")}}saveEventData(){const e=yn("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{Me.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&Me.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{xn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,s,u){if(!pt.EVENTS_URL)return;const f=Pn(pt.EVENTS_URL);f.params.push(`access_token=${u||pt.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(e).toISOString()},y=i?Re(g,i):g,w={url:Ye(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};var k;this.pendingRequest=(k=E=>{this.pendingRequest=null,s(E),this.saveEventData(),this.processRequests(u)},ir(Re(w,{method:"POST"}),k))}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const Ot=new class extends Ge{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){pt.EVENTS_URL&&pt.ACCESS_TOKEN&&Array.isArray(n)&&n.some(i=>ot(i)||Rt(i))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=wt(pt.ACCESS_TOKEN),i=e?e.u:pt.ACCESS_TOKEN;let s=i!==this.eventData.tokenU;on(this.anonId)||(this.anonId=At(),s=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),g=new Date(u),y=(u-this.eventData.lastSuccess)/864e5;s=s||y>=1||y<-1||f.getDate()!==g.getDate()}else s=!0;s?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ht,skuId:_t,"enabled.telemetry":!1,userId:this.anonId},f=>{f||(this.eventData.lastSuccess=u,this.eventData.tokenU=i)},n):this.processRequests()}},cn=Ot.postTurnstileEvent.bind(Ot),$n=new class extends Ge{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,i,s){this.skuToken=e,this.errorCb=s,pt.EVENTS_URL&&(i||pt.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(We)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),on(this.anonId)||(this.anonId=At()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ht,skuId:_t,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n))}},si=$n.postMapLoadEvent.bind($n),bi=new class extends Ge{constructor(){super("gljs.performance")}postPerformanceEvent(n,e){pt.EVENTS_URL&&(n||pt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},n)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:i}=this.queue.shift(),s=function(u){const f=Me.performance.getEntriesByType("resource"),g=Me.performance.getEntriesByType("mark"),y=function(U){const Y={};if(U)for(const J in U)if("other"!==J)for(const oe of U[J]){const _e=`${J}ResolveRangeMin`,Pe=`${J}ResolveRangeMax`,qe=`${J}RequestCount`,Ae=`${J}RequestCachedCount`;Y[_e]=Math.min(Y[_e]||1/0,oe.startTime),Y[Pe]=Math.max(Y[Pe]||-1/0,oe.responseEnd);const He=tt=>{void 0===Y[tt]&&(Y[tt]=0),++Y[tt]};void 0!==oe.transferSize&&0===oe.transferSize&&He(Ae),He(qe)}return Y}(function(U,Y){const J={};if(U)for(const oe of U){const _e=Y(oe);void 0===J[_e]&&(J[_e]=[]),J[_e].push(oe)}return J}(f,Wr)),w=Me.devicePixelRatio,E=Me.navigator.connection||Me.navigator.mozConnection||Me.navigator.webkitConnection,k={counters:[],metadata:[],attributes:[]},z=(U,Y,J)=>{null!=J&&U.push({name:Y,value:J.toString()})};for(const U in y)z(k.counters,U,y[U]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(z(k.counters,"interactionRangeMin",u.interactionRange[0]),z(k.counters,"interactionRangeMax",u.interactionRange[1])),g)for(const U of Object.keys(no)){const Y=no[U],J=g.find(oe=>oe.name===Y);J&&z(k.counters,Y,J.startTime)}return z(k.counters,"visibilityHidden",u.visibilityHidden),z(k.attributes,"style",function(U){if(U)for(const Y of U){const J=Y.name.split("?")[0];if(rt(J)){const oe=J.split("/").slice(-2);if(2===oe.length)return`mapbox://styles/${oe[0]}/${oe[1]}`}}}(f)),z(k.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),z(k.attributes,"fogEnabled",u.fogEnabled?"true":"false"),z(k.attributes,"projection",u.projection),z(k.attributes,"zoom",u.zoom),z(k.metadata,"devicePixelRatio",w),z(k.metadata,"connectionEffectiveType",E?E.effectiveType:void 0),z(k.metadata,"navigatorUserAgent",Me.navigator.userAgent),z(k.metadata,"screenWidth",Me.screen.width),z(k.metadata,"screenHeight",Me.screen.height),z(k.metadata,"windowWidth",Me.innerWidth),z(k.metadata,"windowHeight",Me.innerHeight),z(k.metadata,"mapWidth",u.width/w),z(k.metadata,"mapHeight",u.height/w),z(k.metadata,"webglRenderer",u.renderer),z(k.metadata,"webglVendor",u.vendor),z(k.metadata,"sdkVersion",ht),z(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(i);for(const u of s.metadata);for(const u of s.counters);for(const u of s.attributes);this.postEvent(e,s,()=>{},n)}},Ui=bi.postPerformanceEvent.bind(bi),ji=new class extends Ge{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,i,s){if(!pt.API_URL||!pt.SESSION_PATH)return;const u=Pn(pt.API_URL+pt.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${s||pt.ACCESS_TOKEN||""}`);const f={url:Ye(u),headers:{"Content-Type":"text/plain"}};var y;this.pendingRequest=(y=g=>{this.pendingRequest=null,i(g),this.saveEventData(),this.processRequests(s)},ir(Re(f,{method:"GET"}),y))}getSessionAPI(n,e,i,s){this.skuToken=e,this.errorCb=s,pt.SESSION_PATH&&pt.API_URL&&(i||pt.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(We)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n)}},vr=ji.getSessionAPI.bind(ji),Di=new Set,no={create:"create",load:"load",fullLoad:"fullLoad"},Gr={mark(n){Me.performance.mark(n)},measure(n,e,i){Me.performance.measure(n,e,i)}};function Wr(n){const e=n.name.split("?")[0];return It(e)&&e.includes("mapbox-gl.js")?"javascript":It(e)&&e.includes("mapbox-gl.css")?"css":pt.API_FONTS_REGEX.test(e)?"fontRange":Bt(e)?"sprite":rt(e)?"style":pt.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const qi=Me.performance;function Mo(n){const e=n?n.url.toString():void 0;return qi.getEntriesByName(e)}let Uo,qr,Ao,Br;const Dr={now:()=>void 0!==Ao?Ao:Me.performance.now(),setNow(n){Ao=n},restoreNow(){Ao=void 0},frame(n){const e=Me.requestAnimationFrame(n);return{cancel:()=>Me.cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:s}=n;Br||(Br=Me.document.createElement("canvas"));const u=Br.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(i>Br.width||s>Br.height)&&(Br.width=i,Br.height=s),u.clearRect(-e,-e,i+2*e,s+2*e),u.drawImage(n,0,0,i,s),u.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:n=>(Uo||(Uo=Me.document.createElement("a")),Uo.href=n,Uo.href),get devicePixelRatio(){return Me.devicePixelRatio},get prefersReducedMotion(){return!!Me.matchMedia&&(null==qr&&(qr=Me.matchMedia("(prefers-reduced-motion: reduce)")),qr.matches)}};function Hi(n,e,i){i[n]&&-1!==i[n].indexOf(e)||(i[n]=i[n]||[],i[n].push(e))}function Ur(n,e,i){if(i&&i[n]){const s=i[n].indexOf(e);-1!==s&&i[n].splice(s,1)}}class xr{constructor(e,i={}){Re(this,i),this.type=e}}class Ni extends xr{constructor(e,i={}){super("error",Re({error:e},i))}}class Qo{on(e,i){return this._listeners=this._listeners||{},Hi(e,i,this._listeners),this}off(e,i){return Ur(e,i,this._listeners),Ur(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Hi(e,i,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,i){"string"==typeof e&&(e=new xr(e,i||{}));const s=e.type;if(this.listens(s)){e.target=this;const u=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of u)y.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of f)Ur(s,y,this._oneTimeListeners),y.call(this,e);const g=this._eventedParent;g&&(Re(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof Ni&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var Gt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function so(n,...e){for(const i of e)for(const s in i)n[s]=i[s];return n}function Rr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Or(n){if(Array.isArray(n))return n.map(Or);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Or(n[i]);return e}return Rr(n)}class es extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var Co=es;class os{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,u]of i)this.bindings[s]=u}concat(e){return new os(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Yr=os;const Lo={kind:"null"},Un={kind:"number"},Pi={kind:"string"},se={kind:"boolean"},Oe={kind:"color"},ge={kind:"object"},Te={kind:"value"},vt={kind:"collator"},Mt={kind:"formatted"},sn={kind:"resolvedImage"};function mn(n,e){return{kind:"array",itemType:n,N:e}}function an(n){if("array"===n.kind){const e=an(n.itemType);return"number"==typeof n.N?`array<${e}, ${n.N}>`:"value"===n.itemType.kind?"array":`array<${e}>`}return n.kind}const Tn=[Lo,Un,Pi,se,Oe,Mt,ge,mn(Te),sn];function ii(n,e){if("error"===e.kind)return null;if("array"===n.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!ii(n.itemType,e.itemType))&&("number"!=typeof n.N||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if("value"===n.kind)for(const i of Tn)if(!ii(i,e))return null}return`Expected ${an(n)} but found ${an(e)} instead.`}function vi(n,e){return e.some(i=>i.kind===n.kind)}function Fi(n,e){return e.some(i=>"null"===i?null===n:"array"===i?Array.isArray(n):"object"===i?n&&!Array.isArray(n)&&"object"==typeof n:i===typeof n)}var br,jo={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function mo(n){return(n=Math.round(n))<0?0:n>255?255:n}function To(n){return mo("%"===n[n.length-1]?parseFloat(n)/100*255:parseInt(n))}function go(n){return(e="%"===n[n.length-1]?parseFloat(n)/100:parseFloat(n))<0?0:e>1?1:e;var e}function ao(n,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?n+(e-n)*i*6:2*i<1?e:3*i<2?n+(e-n)*(2/3-i)*6:n}try{br={}.parseCSSColor=function(n){var e,i=n.replace(/ /g,"").toLowerCase();if(i in jo)return jo[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=i.indexOf("("),u=i.indexOf(")");if(-1!==s&&u+1===i.length){var f=i.substr(0,s),g=i.substr(s+1,u-(s+1)).split(","),y=1;switch(f){case"rgba":if(4!==g.length)return null;y=go(g.pop());case"rgb":return 3!==g.length?null:[To(g[0]),To(g[1]),To(g[2]),y];case"hsla":if(4!==g.length)return null;y=go(g.pop());case"hsl":if(3!==g.length)return null;var w=(parseFloat(g[0])%360+360)%360/360,E=go(g[1]),k=go(g[2]),z=k<=.5?k*(E+1):k+E-k*E,U=2*k-z;return[mo(255*ao(U,z,w+1/3)),mo(255*ao(U,z,w)),mo(255*ao(U,z,w-1/3)),y];default:return null}}return null}}catch{}class Po{constructor(e,i,s,u=1){this.r=e,this.g=i,this.b=s,this.a=u}static parse(e){if(!e)return;if(e instanceof Po)return e;if("string"!=typeof e)return;const i=br(e);return i?new Po(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,s,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(s)},${u})`}toArray(){const{r:e,g:i,b:s,a:u}=this;return 0===u?[0,0,0,0]:[255*e/u,255*i/u,255*s/u,u]}toArray01(){const{r:e,g:i,b:s,a:u}=this;return 0===u?[0,0,0,0]:[e/u,i/u,s/u,u]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:s,a:u}=this;return[e,i,s,u]}}Po.black=new Po(0,0,0,1),Po.white=new Po(1,1,1,1),Po.transparent=new Po(0,0,0,0),Po.red=new Po(1,0,0,1),Po.blue=new Po(0,0,1,1);var cr=Po;class Ls{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ys{constructor(e,i,s,u,f){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=u,this.textColor=f}}class Ii{constructor(e){this.sections=e}static fromString(e){return new Ii([new Ys(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Ii?e:Ii.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(s)}return e}}class Cr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Cr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function lo(n,e,i,s){return"number"==typeof n&&n>=0&&n<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[n,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[n,e,i,s]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ds(n){if(null===n||"string"==typeof n||"boolean"==typeof n||"number"==typeof n||n instanceof cr||n instanceof Ls||n instanceof Ii||n instanceof Cr)return!0;if(Array.isArray(n)){for(const e of n)if(!ds(e))return!1;return!0}if("object"==typeof n){for(const e in n)if(!ds(n[e]))return!1;return!0}return!1}function ur(n){if(null===n)return Lo;if("string"==typeof n)return Pi;if("boolean"==typeof n)return se;if("number"==typeof n)return Un;if(n instanceof cr)return Oe;if(n instanceof Ls)return vt;if(n instanceof Ii)return Mt;if(n instanceof Cr)return sn;if(Array.isArray(n)){const e=n.length;let i;for(const s of n){const u=ur(s);if(i){if(i===u)continue;i=Te;break}i=u}return mn(i||Te,e)}return ge}function Rs(n){const e=typeof n;return null===n?"":"string"===e||"number"===e||"boolean"===e?String(n):n instanceof cr||n instanceof Ii||n instanceof Cr?n.toString():JSON.stringify(n)}class na{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(2!==e.length)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ds(e[1]))return i.error("invalid value");const s=e[1];let u=ur(s);const f=i.expectedType;return"array"!==u.kind||0!==u.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(u=f),new na(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof cr?["rgba"].concat(this.value.toArray()):this.value instanceof Ii?this.value.serialize():this.value}}var hs=na,co=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const ia={string:Pi,number:Un,boolean:se,object:ge};class Ir{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,u=1;const f=e[0];if("array"===f){let y,w;if(e.length>2){const E=e[1];if("string"!=typeof E||!(E in ia)||"object"===E)return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=ia[E],u++}else y=Te;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=e[2],u++}s=mn(y,w)}else s=ia[f];const g=[];for(;u<e.length;u++){const y=i.parse(e[u],u,Te);if(!y)return null;g.push(y)}return new Ir(s,g)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!ii(this.type,ur(s)))return s;if(i===this.args.length-1)throw new co(`Expected value to be of type ${an(this.type)}, but found ${an(ur(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){i.push(s.kind);const u=e.N;("number"==typeof u||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(s=>s.serialize()))}}var Kn=Ir;class Ti{constructor(e){this.type=Mt,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return i.error("First argument must be an image or text section.");const u=[];let f=!1;for(let g=1;g<=e.length-1;++g){const y=e[g];if(f&&"object"==typeof y&&!Array.isArray(y)){f=!1;let w=null;if(y["font-scale"]&&(w=i.parse(y["font-scale"],1,Un),!w))return null;let E=null;if(y["text-font"]&&(E=i.parse(y["text-font"],1,mn(Pi)),!E))return null;let k=null;if(y["text-color"]&&(k=i.parse(y["text-color"],1,Oe),!k))return null;const z=u[u.length-1];z.scale=w,z.font=E,z.textColor=k}else{const w=i.parse(e[g],1,Te);if(!w)return null;const E=w.type.kind;if("string"!==E&&"value"!==E&&"null"!==E&&"resolvedImage"!==E)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:w,scale:null,font:null,textColor:null})}}return new Ti(u)}evaluate(e){return new Ii(this.sections.map(i=>{const s=i.content.evaluate(e);return ur(s)===sn?new Ys("",s,null,null,null):new Ys(Rs(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class Tr{constructor(e){this.type=sn,this.input=e}static parse(e,i){if(2!==e.length)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Pi);return s?new Tr(s):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),s=Cr.fromString(i);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(i)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ts={"to-boolean":se,"to-color":Oe,"to-number":Un,"to-string":Pi};class Os{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return i.error("Expected one argument.");const u=ts[s],f=[];for(let g=1;g<e.length;g++){const y=i.parse(e[g],g,Te);if(!y)return null;f.push(y)}return new Os(u,f)}evaluate(e){if("boolean"===this.type.kind)return!!this.args[0].evaluate(e);if("color"===this.type.kind){let i,s;for(const u of this.args){if(i=u.evaluate(e),s=null,i instanceof cr)return i;if("string"==typeof i){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:lo(i[0],i[1],i[2],i[3]),!s))return new cr(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new co(s||`Could not parse color from value '${"string"==typeof i?i:String(JSON.stringify(i))}'`)}if("number"===this.type.kind){let i=null;for(const s of this.args){if(i=s.evaluate(e),null===i)return 0;const u=Number(i);if(!isNaN(u))return u}throw new co(`Could not convert ${JSON.stringify(i)} to number.`)}return"formatted"===this.type.kind?Ii.fromString(Rs(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Cr.fromString(Rs(this.args[0].evaluate(e))):Rs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ti([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Tr(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var zr=Os;const zo=["Unknown","Point","LineString","Polygon"];var Xr=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?zo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-n[0])+this.featureDistanceData.bearing[1]*(s*e-n[1])}return 0}parseColor(n){let e=this._parseColorCache[n];return e||(e=this._parseColorCache[n]=cr.parse(n)),e}};class _o{constructor(e,i,s,u){this.name=e,this.type=i,this._evaluate=s,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const s=e[0],u=_o.definitions[s];if(!u)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=g.filter(([E])=>!Array.isArray(E)||E.length===e.length-1);let w=null;for(const[E,k]of y){w=new Bo(i.registry,i.path,null,i.scope);const z=[];let U=!1;for(let Y=1;Y<e.length;Y++){const J=e[Y],oe=Array.isArray(E)?E[Y-1]:E.type,_e=w.parse(J,1+z.length,oe);if(!_e){U=!0;break}z.push(_e)}if(!U)if(Array.isArray(E)&&E.length!==z.length)w.error(`Expected ${E.length} arguments, but found ${z.length} instead.`);else{for(let Y=0;Y<z.length;Y++){const J=Array.isArray(E)?E[Y]:E.type,oe=z[Y];w.concat(Y+1).checkSubtype(J,oe.type)}if(0===w.errors.length)return new _o(s,f,k,z)}}if(1===y.length)i.errors.push(...w.errors);else{const E=(y.length?y:g).map(([z])=>{return U=z,Array.isArray(U)?`(${U.map(an).join(", ")})`:`(${an(U.type)}...)`;var U}).join(" | "),k=[];for(let z=1;z<e.length;z++){const U=i.parse(e[z],1+k.length);if(!U)return null;k.push(an(U.type))}i.error(`Expected arguments of type ${E}, but found (${k.join(", ")}) instead.`)}return null}static register(e,i){_o.definitions=i;for(const s in i)e[s]=_o}}var So=_o;class xi{constructor(e,i,s){this.type=vt,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(2!==e.length)return i.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return i.error("Collator options argument must be an object.");const u=i.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,se);if(!u)return null;const f=i.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,se);if(!f)return null;let g=null;return s.locale&&(g=i.parse(s.locale,1,Pi),!g)?null:new xi(u,f,g)}evaluate(e){return new Ls(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Fo=8192;function Fs(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function ss(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function kr(n,e){const i=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*Fo),Math.round(s*u*Fo)]}function _a(n,e,i){const s=n[0]-e[0],u=n[1]-e[1],f=n[0]-i[0],g=n[1]-i[1];return s*g-f*u==0&&s*f<=0&&u*g<=0}function xs(n,e){let i=!1;for(let g=0,y=e.length;g<y;g++){const w=e[g];for(let E=0,k=w.length;E<k-1;E++){if(_a(n,w[E],w[E+1]))return!1;(u=w[E])[1]>(s=n)[1]!=(f=w[E+1])[1]>s[1]&&s[0]<(f[0]-u[0])*(s[1]-u[1])/(f[1]-u[1])+u[0]&&(i=!i)}}var s,u,f;return i}function fs(n,e){for(let i=0;i<e.length;i++)if(xs(n,e[i]))return!0;return!1}function bs(n,e,i,s){const u=s[0]-i[0],f=s[1]-i[1],g=(n[0]-i[0])*f-u*(n[1]-i[1]),y=(e[0]-i[0])*f-u*(e[1]-i[1]);return g>0&&y<0||g<0&&y>0}function ps(n,e,i){for(const E of i)for(let k=0;k<E.length-1;++k)if((y=[(g=E[k+1])[0]-(f=E[k])[0],g[1]-f[1]])[0]*(w=[(u=e)[0]-(s=n)[0],u[1]-s[1]])[1]-y[1]*w[0]!=0&&bs(s,u,f,g)&&bs(f,g,s,u))return!0;var s,u,f,g,y,w;return!1}function Ji(n,e){for(let i=0;i<n.length;++i)if(!xs(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(ps(n[i],n[i+1],e))return!1;return!0}function Bs(n,e){for(let i=0;i<e.length;i++)if(Ji(n,e[i]))return!0;return!1}function ra(n,e,i){const s=[];for(let u=0;u<n.length;u++){const f=[];for(let g=0;g<n[u].length;g++){const y=kr(n[u][g],i);Fs(e,y),f.push(y)}s.push(f)}return s}function oa(n,e,i){const s=[];for(let u=0;u<n.length;u++){const f=ra(n[u],e,i);s.push(f)}return s}function _i(n,e,i,s){if(n[0]<i[0]||n[0]>i[2]){const u=.5*s;let f=n[0]-i[0]>u?-s:i[0]-n[0]>u?s:0;0===f&&(f=n[0]-i[2]>u?-s:i[2]-n[0]>u?s:0),n[0]+=f}Fs(e,n)}function sa(n,e,i,s){const u=Math.pow(2,s.z)*Fo,f=[s.x*Fo,s.y*Fo],g=[];if(!n)return g;for(const y of n)for(const w of y){const E=[w.x+f[0],w.y+f[1]];_i(E,e,i,u),g.push(E)}return g}function Ns(n,e,i,s){const u=Math.pow(2,s.z)*Fo,f=[s.x*Fo,s.y*Fo],g=[];if(!n)return g;for(const w of n){const E=[];for(const k of w){const z=[k.x+f[0],k.y+f[1]];Fs(e,z),E.push(z)}g.push(E)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const w of g)for(const E of w)_i(E,e,i,u)}var y;return g}class da{constructor(e,i){this.type=se,this.geojson=e,this.geometries=i}static parse(e,i){if(2!==e.length)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ds(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let u=0;u<s.features.length;++u){const f=s.features[u].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new da(s,s.features[u].geometry)}else if("Feature"===s.type){const u=s.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new da(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new da(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(i,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if("Polygon"===s.type){const y=ra(s.coordinates,f,g),w=sa(i.geometry(),u,f,g);if(!ss(u,f))return!1;for(const E of w)if(!xs(E,y))return!1}if("MultiPolygon"===s.type){const y=oa(s.coordinates,f,g),w=sa(i.geometry(),u,f,g);if(!ss(u,f))return!1;for(const E of w)if(!fs(E,y))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(i,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if("Polygon"===s.type){const y=ra(s.coordinates,f,g),w=Ns(i.geometry(),u,f,g);if(!ss(u,f))return!1;for(const E of w)if(!Ji(E,y))return!1}if("MultiPolygon"===s.type){const y=oa(s.coordinates,f,g),w=Ns(i.geometry(),u,f,g);if(!ss(u,f))return!1;for(const E of w)if(!Bs(E,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Ho=da;function aa(n){if(n instanceof So&&("get"===n.name&&1===n.args.length||"feature-state"===n.name||"has"===n.name&&1===n.args.length||"properties"===n.name||"geometry-type"===n.name||"id"===n.name||/^filter-/.test(n.name))||n instanceof Ho)return!1;let e=!0;return n.eachChild(i=>{e&&!aa(i)&&(e=!1)}),e}function Go(n){if(n instanceof So&&"feature-state"===n.name)return!1;let e=!0;return n.eachChild(i=>{e&&!Go(i)&&(e=!1)}),e}function $o(n,e){if(n instanceof So&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(s=>{i&&!$o(s,e)&&(i=!1)}),i}class yo{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(2!==e.length||"string"!=typeof e[1])return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new yo(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Ka=yo;class jr{constructor(e,i=[],s,u=new Yr,f=[]){this.registry=e,this.path=i,this.key=i.map(g=>`[${g}]`).join(""),this.scope=u,this.errors=f,this.expectedType=s}parse(e,i,s,u,f={}){return i?this.concat(i,s,u)._parse(e,f):this._parse(e,f)}_parse(e,i){function s(u,f,g){return"assert"===g?new Kn(f,[u]):"coerce"===g?new zr(f,[u]):u}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let g=f.parse(e,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,w=g.type;if("string"!==y.kind&&"number"!==y.kind&&"boolean"!==y.kind&&"object"!==y.kind&&"array"!==y.kind||"value"!==w.kind)if("color"!==y.kind&&"formatted"!==y.kind&&"resolvedImage"!==y.kind||"value"!==w.kind&&"string"!==w.kind){if(this.checkSubtype(y,w))return null}else g=s(g,y,i.typeAnnotation||"coerce");else g=s(g,y,i.typeAnnotation||"assert")}if(!(g instanceof hs)&&"resolvedImage"!==g.type.kind&&Ea(g)){const y=new Xr;try{g=new hs(g.type,g.evaluate(y))}catch(w){return this.error(w.message),null}}return g}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s){const u="number"==typeof e?this.path.concat(e):this.path,f=s?this.scope.concat(s):this.scope;return new jr(this.registry,u,i||null,f,this.errors)}error(e,...i){const s=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new Co(s,e))}checkSubtype(e,i){const s=ii(e,i);return s&&this.error(s),s}}var Bo=jr;function Ea(n){if(n instanceof Ka)return Ea(n.boundExpression);if(n instanceof So&&"error"===n.name||n instanceof xi||n instanceof Ho)return!1;const e=n instanceof zr||n instanceof Kn;let i=!0;return n.eachChild(s=>{i=e?i&&Ea(s):i&&s instanceof hs}),!!i&&aa(n)&&$o(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function zs(n,e){const i=n.length-1;let s,u,f=0,g=i,y=0;for(;f<=g;)if(y=Math.floor((f+g)/2),s=n[y],u=n[y+1],s<=e){if(y===i||e<u)return y;f=y+1}else{if(!(s>e))throw new co("Input is not a number.");g=y-1}return 0}class ms{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,f]of s)this.labels.push(u),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,Un);if(!s)return null;const u=[];let f=null;i.expectedType&&"value"!==i.expectedType.kind&&(f=i.expectedType);for(let g=1;g<e.length;g+=2){const y=1===g?-1/0:e[g],w=e[g+1],E=g,k=g+1;if("number"!=typeof y)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(u.length&&u[u.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const z=i.parse(w,k,f);if(!z)return null;f=f||z.type,u.push([y,z])}return new ms(f,s,u)}evaluate(e){const i=this.labels,s=this.outputs;if(1===i.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return s[0].evaluate(e);const f=i.length;return u>=i[f-1]?s[f-1].evaluate(e):s[zs(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var T=ms;function K(n,e,i){return n*(1-i)+e*i}var S=Object.freeze({__proto__:null,array:function(n,e,i){return n.map((s,u)=>K(s,e[u],i))},color:function(n,e,i){return new cr(K(n.r,e.r,i),K(n.g,e.g,i),K(n.b,e.b,i),K(n.a,e.a,i))},number:K});const Q=.95047,wn=4/29,ai=6/29,oi=3*ai*ai,Lr=ai*ai*ai,vo=Math.PI/180,ee=180/Math.PI;function Z(n){return n>Lr?Math.pow(n,1/3):n/oi+wn}function xe(n){return n>ai?n*n*n:oi*(n-wn)}function te(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Be(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function zn(n){const e=Be(n.r),i=Be(n.g),s=Be(n.b),u=Z((.4124564*e+.3575761*i+.1804375*s)/Q),f=Z((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-Z((.0193339*e+.119192*i+.9503041*s)/1.08883)),alpha:n.a}}function zi(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,s=isNaN(n.b)?e:e-n.b/200;return e=1*xe(e),i=Q*xe(i),s=1.08883*xe(s),new cr(te(3.2404542*i-1.5371385*e-.4985314*s),te(-.969266*i+1.8760108*e+.041556*s),te(.0556434*i-.2040259*e+1.0572252*s),n.alpha)}function ns(n,e,i){const s=e-n;return n+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const ws={forward:zn,reverse:zi,interpolate:function(n,e,i){return{l:K(n.l,e.l,i),a:K(n.a,e.a,i),b:K(n.b,e.b,i),alpha:K(n.alpha,e.alpha,i)}}},Es={forward:function(n){const{l:e,a:i,b:s}=zn(n),u=Math.atan2(s,i)*ee;return{h:u<0?u+360:u,c:Math.sqrt(i*i+s*s),l:e,alpha:n.a}},reverse:function(n){const e=n.h*vo,i=n.c;return zi({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:ns(n.h,e.h,i),c:K(n.c,e.c,i),l:K(n.l,e.l,i),alpha:K(n.alpha,e.alpha,i)}}};var Zs=Object.freeze({__proto__:null,hcl:Es,lab:ws});class ya{constructor(e,i,s,u,f){this.type=e,this.operator=i,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[g,y]of f)this.labels.push(g),this.outputs.push(y)}static interpolationFactor(e,i,s,u){let f=0;if("exponential"===e.name)f=$a(i,e.base,s,u);else if("linear"===e.name)f=$a(i,1,s,u);else if("cubic-bezier"===e.name){const g=e.controlPoints;f=new Kt(g[0],g[1],g[2],g[3]).solve($a(i,1,s,u))}return f}static parse(e,i){let[s,u,f,...g]=e;if(!Array.isArray(u)||0===u.length)return i.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const E=u[1];if("number"!=typeof E)return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:E}}else{if("cubic-bezier"!==u[0])return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const E=u.slice(1);if(4!==E.length||E.some(k=>"number"!=typeof k||k<0||k>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,Un),!f)return null;const y=[];let w=null;"interpolate-hcl"===s||"interpolate-lab"===s?w=Oe:i.expectedType&&"value"!==i.expectedType.kind&&(w=i.expectedType);for(let E=0;E<g.length;E+=2){const k=g[E],z=g[E+1],U=E+3,Y=E+4;if("number"!=typeof k)return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(y.length&&y[y.length-1][0]>=k)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const J=i.parse(z,Y,w);if(!J)return null;w=w||J.type,y.push([k,J])}return"number"===w.kind||"color"===w.kind||"array"===w.kind&&"number"===w.itemType.kind&&"number"==typeof w.N?new ya(w,s,u,f,y):i.error(`Type ${an(w)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(1===i.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return s[0].evaluate(e);const f=i.length;if(u>=i[f-1])return s[f-1].evaluate(e);const g=zs(i,u),y=ya.interpolationFactor(this.interpolation,u,i[g],i[g+1]),w=s[g].evaluate(e),E=s[g+1].evaluate(e);return"interpolate"===this.operator?S[this.type.kind.toLowerCase()](w,E,y):"interpolate-hcl"===this.operator?Es.reverse(Es.interpolate(Es.forward(w),Es.forward(E),y)):ws.reverse(ws.interpolate(ws.forward(w),ws.forward(E),y))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function $a(n,e,i,s){const u=s-i,f=n-i;return 0===u?0:1===e?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}var gs=ya;class ha{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const u=i.expectedType;u&&"value"!==u.kind&&(s=u);const f=[];for(const y of e.slice(1)){const w=i.parse(y,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!w)return null;s=s||w.type,f.push(w)}const g=u&&f.some(y=>ii(u,y.type));return new ha(g?Te:s,f)}evaluate(e){let i,s=null,u=0;for(const f of this.args){if(u++,s=f.evaluate(e),s&&s instanceof Cr&&!s.available&&(i||(i=s),s=null,u===this.args.length))return i;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var ce=ha;class I{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let f=1;f<e.length-1;f+=2){const g=e[f];if("string"!=typeof g)return i.error(`Expected string, but found ${typeof g} instead.`,f);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=i.parse(e[f+1],f+1);if(!y)return null;s.push([g,y])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return u?new I(s,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}var B=I;class W{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Un),u=i.parse(e[2],2,mn(i.expectedType||Te));return s&&u?new W(u.type.itemType,s,u):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new co(`Array index out of bounds: ${i} < 0.`);if(i>=s.length)throw new co(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i!==Math.floor(i))throw new co(`Array index must be an integer, but found ${i} instead.`);return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var ue=W;class Se{constructor(e,i){this.type=se,this.needle=e,this.haystack=i}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Te),u=i.parse(e[2],2,Te);return s&&u?vi(s.type,[se,Pi,Un,Lo,Te])?new Se(s,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${an(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(null==s)return!1;if(!Fi(i,["boolean","string","number","null"]))throw new co(`Expected first argument to be of type boolean, string, number or null, but found ${an(ur(i))} instead.`);if(!Fi(s,["string","array"]))throw new co(`Expected second argument to be of type array or string, but found ${an(ur(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var nt=Se;class gt{constructor(e,i,s){this.type=Un,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Te),u=i.parse(e[2],2,Te);if(!s||!u)return null;if(!vi(s.type,[se,Pi,Un,Lo,Te]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${an(s.type)} instead`);if(4===e.length){const f=i.parse(e[3],3,Un);return f?new gt(s,u,f):null}return new gt(s,u)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Fi(i,["boolean","string","number","null"]))throw new co(`Expected first argument to be of type boolean, string, number or null, but found ${an(ur(i))} instead.`);if(!Fi(s,["string","array"]))throw new co(`Expected second argument to be of type array or string, but found ${an(ur(s))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return s.indexOf(i,u)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Zt=gt;class fn{constructor(e,i,s,u,f,g){this.inputType=e,this.type=i,this.input=s,this.cases=u,this.outputs=f,this.otherwise=g}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,u;i.expectedType&&"value"!==i.expectedType.kind&&(u=i.expectedType);const f={},g=[];for(let E=2;E<e.length-1;E+=2){let k=e[E];const z=e[E+1];Array.isArray(k)||(k=[k]);const U=i.concat(E);if(0===k.length)return U.error("Expected at least one branch label.");for(const J of k){if("number"!=typeof J&&"string"!=typeof J)return U.error("Branch labels must be numbers or strings.");if("number"==typeof J&&Math.abs(J)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof J&&Math.floor(J)!==J)return U.error("Numeric branch labels must be integer values.");if(s){if(U.checkSubtype(s,ur(J)))return null}else s=ur(J);if(void 0!==f[String(J)])return U.error("Branch labels must be unique.");f[String(J)]=g.length}const Y=i.parse(z,E,u);if(!Y)return null;u=u||Y.type,g.push(Y)}const y=i.parse(e[1],1,Te);if(!y)return null;const w=i.parse(e[e.length-1],e.length-1,u);return w?"value"!==y.type.kind&&i.concat(1).checkSubtype(s,y.type)?null:new fn(s,u,y,f,g,w):null}evaluate(e){const i=this.input.evaluate(e);return(ur(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],u={};for(const g of i){const y=u[this.cases[g]];void 0===y?(u[this.cases[g]]=s.length,s.push([this.cases[g],[g]])):s[y][1].push(g)}const f=g=>"number"===this.inputType.kind?Number(g):g;for(const[g,y]of s)e.push(1===y.length?f(y[0]):y.map(f)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}var gi=fn;class Wn{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&"value"!==i.expectedType.kind&&(s=i.expectedType);const u=[];for(let g=1;g<e.length-1;g+=2){const y=i.parse(e[g],g,se);if(!y)return null;const w=i.parse(e[g+1],g+1,s);if(!w)return null;u.push([y,w]),s=s||w.type}const f=i.parse(e[e.length-1],e.length-1,s);return f?new Wn(s,u,f):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var mr=Wn;class Yi{constructor(e,i,s,u){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Te),u=i.parse(e[2],2,Un);if(!s||!u)return null;if(!vi(s.type,[mn(Te),Pi,Te]))return i.error(`Expected first argument to be of type array or string, but found ${an(s.type)} instead`);if(4===e.length){const f=i.parse(e[3],3,Un);return f?new Yi(s.type,s,u,f):null}return new Yi(s.type,s,u)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Fi(i,["string","array"]))throw new co(`Expected first argument to be of type array or string, but found ${an(ur(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(s,u)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Oi=Yi;function Vi(n,e){return"=="===n||"!="===n?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Kr(n,e,i,s){return 0===s.compare(e,i)}function xo(n,e,i){const s="=="!==n&&"!="!==n;return class Zb{constructor(f,g,y){this.type=se,this.lhs=f,this.rhs=g,this.collator=y,this.hasUntypedArgument="value"===f.type.kind||"value"===g.type.kind}static parse(f,g){if(3!==f.length&&4!==f.length)return g.error("Expected two or three arguments.");const y=f[0];let w=g.parse(f[1],1,Te);if(!w)return null;if(!Vi(y,w.type))return g.concat(1).error(`"${y}" comparisons are not supported for type '${an(w.type)}'.`);let E=g.parse(f[2],2,Te);if(!E)return null;if(!Vi(y,E.type))return g.concat(2).error(`"${y}" comparisons are not supported for type '${an(E.type)}'.`);if(w.type.kind!==E.type.kind&&"value"!==w.type.kind&&"value"!==E.type.kind)return g.error(`Cannot compare types '${an(w.type)}' and '${an(E.type)}'.`);s&&("value"===w.type.kind&&"value"!==E.type.kind?w=new Kn(E.type,[w]):"value"!==w.type.kind&&"value"===E.type.kind&&(E=new Kn(w.type,[E])));let k=null;if(4===f.length){if("string"!==w.type.kind&&"string"!==E.type.kind&&"value"!==w.type.kind&&"value"!==E.type.kind)return g.error("Cannot use collator to compare non-string types.");if(k=g.parse(f[3],3,vt),!k)return null}return new Zb(w,E,k)}evaluate(f){const g=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const w=ur(g),E=ur(y);if(w.kind!==E.kind||"string"!==w.kind&&"number"!==w.kind)throw new co(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const w=ur(g),E=ur(y);if("string"!==w.kind||"string"!==E.kind)return e(f,g,y)}return this.collator?i(f,g,y,this.collator.evaluate(f)):e(f,g,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[n];return this.eachChild(g=>{f.push(g.serialize())}),f}}}const as=xo("==",function(n,e,i){return e===i},Kr),Ds=xo("!=",function(n,e,i){return e!==i},function(n,e,i,s){return!Kr(0,e,i,s)}),Wo=xo("<",function(n,e,i){return e<i},function(n,e,i,s){return s.compare(e,i)<0}),cl=xo(">",function(n,e,i){return e>i},function(n,e,i,s){return s.compare(e,i)>0}),$s=xo("<=",function(n,e,i){return e<=i},function(n,e,i,s){return s.compare(e,i)<=0}),_s=xo(">=",function(n,e,i){return e>=i},function(n,e,i,s){return s.compare(e,i)>=0});class fa{constructor(e,i,s,u,f,g){this.type=Pi,this.number=e,this.locale=i,this.currency=s,this.unit=u,this.minFractionDigits=f,this.maxFractionDigits=g}static parse(e,i){if(3!==e.length)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Un);if(!s)return null;const u=e[2];if("object"!=typeof u||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=i.parse(u.locale,1,Pi),!f))return null;let g=null;if(u.currency&&(g=i.parse(u.currency,1,Pi),!g))return null;let y=null;if(u.unit&&(y=i.parse(u.unit,1,Pi),!y))return null;let w=null;if(u["min-fraction-digits"]&&(w=i.parse(u["min-fraction-digits"],1,Un),!w))return null;let E=null;return u["max-fraction-digits"]&&(E=i.parse(u["max-fraction-digits"],1,Un),!E)?null:new fa(s,f,g,y,w,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Xs{constructor(e){this.type=Un,this.input=e}static parse(e,i){if(2!==e.length)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?i.error(`Expected argument of type string or array, but found ${an(s.type)} instead.`):new Xs(s):null}evaluate(e){const i=this.input.evaluate(e);if("string"==typeof i||Array.isArray(i))return i.length;throw new co(`Expected value to be of type string or array, but found ${an(ur(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const va={"==":as,"!=":Ds,">":cl,"<":Wo,">=":_s,"<=":$s,array:Kn,at:ue,boolean:Kn,case:mr,coalesce:ce,collator:xi,format:Ti,image:Tr,in:nt,"index-of":Zt,interpolate:gs,"interpolate-hcl":gs,"interpolate-lab":gs,length:Xs,let:B,literal:hs,match:gi,number:Kn,"number-format":fa,object:Kn,slice:Oi,step:T,string:Kn,"to-boolean":zr,"to-color":zr,"to-number":zr,"to-string":zr,var:Ka,within:Ho};function bl(n,[e,i,s,u]){e=e.evaluate(n),i=i.evaluate(n),s=s.evaluate(n);const f=u?u.evaluate(n):1,g=lo(e,i,s,f);if(g)throw new co(g);return new cr(e/255*f,i/255*f,s/255*f,f)}function Ks(n,e){return n in e}function Vs(n,e){const i=e[n];return void 0===i?null:i}function F(n){return{type:n}}So.register(va,{error:[{kind:"error"},[Pi],(n,[e])=>{throw new co(e.evaluate(n))}],typeof:[Pi,[Te],(n,[e])=>an(ur(e.evaluate(n)))],"to-rgba":[mn(Un,4),[Oe],(n,[e])=>e.evaluate(n).toArray()],rgb:[Oe,[Un,Un,Un],bl],rgba:[Oe,[Un,Un,Un,Un],bl],has:{type:se,overloads:[[[Pi],(n,[e])=>Ks(e.evaluate(n),n.properties())],[[Pi,ge],(n,[e,i])=>Ks(e.evaluate(n),i.evaluate(n))]]},get:{type:Te,overloads:[[[Pi],(n,[e])=>Vs(e.evaluate(n),n.properties())],[[Pi,ge],(n,[e,i])=>Vs(e.evaluate(n),i.evaluate(n))]]},"feature-state":[Te,[Pi],(n,[e])=>Vs(e.evaluate(n),n.featureState||{})],properties:[ge,[],n=>n.properties()],"geometry-type":[Pi,[],n=>n.geometryType()],id:[Te,[],n=>n.id()],zoom:[Un,[],n=>n.globals.zoom],pitch:[Un,[],n=>n.globals.pitch||0],"distance-from-center":[Un,[],n=>n.distanceFromCenter()],"heatmap-density":[Un,[],n=>n.globals.heatmapDensity||0],"line-progress":[Un,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[Un,[],n=>n.globals.skyRadialProgress||0],accumulated:[Te,[],n=>void 0===n.globals.accumulated?null:n.globals.accumulated],"+":[Un,F(Un),(n,e)=>{let i=0;for(const s of e)i+=s.evaluate(n);return i}],"*":[Un,F(Un),(n,e)=>{let i=1;for(const s of e)i*=s.evaluate(n);return i}],"-":{type:Un,overloads:[[[Un,Un],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Un],(n,[e])=>-e.evaluate(n)]]},"/":[Un,[Un,Un],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Un,[Un,Un],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Un,[],()=>Math.LN2],pi:[Un,[],()=>Math.PI],e:[Un,[],()=>Math.E],"^":[Un,[Un,Un],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Un,[Un],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Un,[Un],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Un,[Un],(n,[e])=>Math.log(e.evaluate(n))],log2:[Un,[Un],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Un,[Un],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Un,[Un],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Un,[Un],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Un,[Un],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Un,[Un],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Un,[Un],(n,[e])=>Math.atan(e.evaluate(n))],min:[Un,F(Un),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[Un,F(Un),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[Un,[Un],(n,[e])=>Math.abs(e.evaluate(n))],round:[Un,[Un],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Un,[Un],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Un,[Un],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[se,[Pi,Te],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[se,[Te],(n,[e])=>n.id()===e.value],"filter-type-==":[se,[Pi],(n,[e])=>n.geometryType()===e.value],"filter-<":[se,[Pi,Te],(n,[e,i])=>{const s=n.properties()[e.value],u=i.value;return typeof s==typeof u&&s<u}],"filter-id-<":[se,[Te],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[se,[Pi,Te],(n,[e,i])=>{const s=n.properties()[e.value],u=i.value;return typeof s==typeof u&&s>u}],"filter-id->":[se,[Te],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[se,[Pi,Te],(n,[e,i])=>{const s=n.properties()[e.value],u=i.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[se,[Te],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[se,[Pi,Te],(n,[e,i])=>{const s=n.properties()[e.value],u=i.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[se,[Te],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[se,[Te],(n,[e])=>e.value in n.properties()],"filter-has-id":[se,[],n=>null!==n.id()&&void 0!==n.id()],"filter-type-in":[se,[mn(Pi)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[se,[mn(Te)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[se,[Pi,mn(Te)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[se,[Pi,mn(Te)],(n,[e,i])=>function(s,u,f,g){for(;f<=g;){const y=f+g>>1;if(u[y]===s)return!0;u[y]>s?g=y-1:f=y+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:se,overloads:[[[se,se],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[F(se),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:se,overloads:[[[se,se],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[F(se),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[se,[se],(n,[e])=>!e.evaluate(n)],"is-supported-script":[se,[Pi],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[Pi,[Pi],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Pi,[Pi],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Pi,F(Te),(n,e)=>e.map(i=>Rs(i.evaluate(n))).join("")],"resolved-locale":[Pi,[vt],(n,[e])=>e.evaluate(n).resolvedLocale()]});var X=va;function ye(n){return{result:"success",value:n}}function j(n){return{result:"error",value:n}}function fe(n){return"data-driven"===n["property-type"]}function Xe(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function rn(n){return!!n.expression&&n.expression.interpolated}function _n(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n}function ki(n){return"object"==typeof n&&null!==n&&!Array.isArray(n)}function Gi(n){return n}function Mi(n,e){const i="color"===e.type,s=n.stops&&"object"==typeof n.stops[0][0],u=s||!(s||void 0!==n.property),f=n.type||(rn(e)?"exponential":"interval");if(i&&((n=so({},n)).stops&&(n.stops=n.stops.map(E=>[E[0],cr.parse(E[1])])),n.default=cr.parse(n.default?n.default:e.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!Zs[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let g,y,w;if("exponential"===f)g=wr;else if("interval"===f)g=Xi;else if("categorical"===f){g=Zi,y=Object.create(null);for(const E of n.stops)y[E[0]]=E[1];w=typeof n.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);g=Mr}if(s){const E={},k=[];for(let Y=0;Y<n.stops.length;Y++){const J=n.stops[Y],oe=J[0].zoom;void 0===E[oe]&&(E[oe]={zoom:oe,type:n.type,property:n.property,default:n.default,stops:[]},k.push(oe)),E[oe].stops.push([J[0].value,J[1]])}const z=[];for(const Y of k)z.push([E[Y].zoom,Mi(E[Y],e)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:gs.interpolationFactor.bind(void 0,U),zoomStops:z.map(Y=>Y[0]),evaluate:({zoom:Y},J)=>wr({stops:z,base:n.base},e,Y).evaluate(Y,J)}}if(u){const E="exponential"===f?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:gs.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map(k=>k[0]),evaluate:({zoom:k})=>g(n,e,k,y,w)}}return{kind:"source",evaluate(E,k){const z=k&&k.properties?k.properties[n.property]:void 0;return void 0===z?Qi(n.default,e.default):g(n,e,z,y,w)}}}function Qi(n,e,i){return void 0!==n?n:void 0!==e?e:void 0!==i?i:void 0}function Zi(n,e,i,s,u){return Qi(typeof i===u?s[i]:void 0,n.default,e.default)}function Xi(n,e,i){if("number"!==_n(i))return Qi(n.default,e.default);const s=n.stops.length;if(1===s||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[s-1][0])return n.stops[s-1][1];const u=zs(n.stops.map(f=>f[0]),i);return n.stops[u][1]}function wr(n,e,i){const s=void 0!==n.base?n.base:1;if("number"!==_n(i))return Qi(n.default,e.default);const u=n.stops.length;if(1===u||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[u-1][0])return n.stops[u-1][1];const f=zs(n.stops.map(k=>k[0]),i),g=function(k,z,U,Y){const J=Y-U,oe=k-U;return 0===J?0:1===z?oe/J:(Math.pow(z,oe)-1)/(Math.pow(z,J)-1)}(i,s,n.stops[f][0],n.stops[f+1][0]),y=n.stops[f][1],w=n.stops[f+1][1];let E=S[e.type]||Gi;if(n.colorSpace&&"rgb"!==n.colorSpace){const k=Zs[n.colorSpace];E=(z,U)=>k.reverse(k.interpolate(k.forward(z),k.forward(U),g))}return"function"==typeof y.evaluate?{evaluate(...k){const z=y.evaluate.apply(void 0,k),U=w.evaluate.apply(void 0,k);if(void 0!==z&&void 0!==U)return E(z,U,g)}}:E(y,w,g)}function Mr(n,e,i){return"color"===e.type?i=cr.parse(i):"formatted"===e.type?i=Ii.fromString(i.toString()):"resolvedImage"===e.type?i=Cr.fromString(i.toString()):_n(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),Qi(i,n.default,e.default)}class qo{constructor(e,i){var s;this.expression=e,this._warningHistory={},this._evaluator=new Xr,this._defaultValue=i?"color"===(s=i).type&&(ki(s.default)||Array.isArray(s.default))?new cr(0,0,0,0):"color"===s.type?cr.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=i&&"enum"===i.type?i.values:null}evaluateWithoutErrorHandling(e,i,s,u,f,g,y,w){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,u,f,g,y,w){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=w||null;try{const E=this.expression.evaluate(this._evaluator);if(null==E||"number"==typeof E&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new co(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function Cs(n){return Array.isArray(n)&&n.length>0&&"string"==typeof n[0]&&n[0]in X}function Yo(n,e){const i=new Bo(X,[],e?function(u){const f={color:Oe,string:Pi,number:Un,enum:Pi,boolean:se,formatted:Mt,resolvedImage:sn};return"array"===u.type?mn(f[u.value]||Te,u.length):f[u.type]}(e):void 0),s=i.parse(n,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?ye(new qo(s,e)):j(i.errors)}class Zo{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent="constant"!==e&&!Go(i.expression)}evaluateWithoutErrorHandling(e,i,s,u,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,u,f,g)}evaluate(e,i,s,u,f,g){return this._styleExpression.evaluate(e,i,s,u,f,g)}}class xa{constructor(e,i,s,u){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent="camera"!==e&&!Go(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,s,u,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,u,f,g)}evaluate(e,i,s,u,f,g){return this._styleExpression.evaluate(e,i,s,u,f,g)}interpolationFactor(e,i,s){return this.interpolationType?gs.interpolationFactor(this.interpolationType,e,i,s):0}}function Da(n,e){if("error"===(n=Yo(n,e)).result)return n;const i=n.value.expression,s=aa(i);if(!s&&!fe(e))return j([new Co("","data expressions not supported")]);const u=$o(i,["zoom","pitch","distance-from-center"]);if(!u&&!Xe(e))return j([new Co("","zoom expressions not supported")]);const f=Pa(i);return f||u?f instanceof Co?j([f]):f instanceof gs&&!rn(e)?j([new Co("",'"interpolate" expressions cannot be used with this property')]):ye(f?new xa(s?"camera":"composite",n.value,f.labels,f instanceof gs?f.interpolation:void 0):new Zo(s?"constant":"source",n.value)):j([new Co("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Js{constructor(e,i){this._parameters=e,this._specification=i,so(this,Mi(this._parameters,this._specification))}static deserialize(e){return new Js(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Pa(n){let e=null;if(n instanceof B)e=Pa(n.result);else if(n instanceof ce){for(const i of n.args)if(e=Pa(i),e)break}else(n instanceof T||n instanceof gs)&&n.input instanceof So&&"zoom"===n.input.name&&(e=n);return e instanceof Co||n.eachChild(i=>{const s=Pa(i);s instanceof Co?e=s:!e&&s?e=new Co("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Co("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class ei{constructor(e,i,s,u){this.message=(e?`${e}: `:"")+s,u&&(this.identifier=u),null!=i&&i.__line__&&(this.line=i.__line__)}}function Ra(n){const e=n.key,i=n.value,s=n.valueSpec||{},u=n.objectElementValidators||{},f=n.style,g=n.styleSpec;let y=[];const w=_n(i);if("object"!==w)return[new ei(e,i,`object expected, ${w} found`)];for(const E in i){const k=E.split(".")[0];let z;u[k]?z=u[k]:s[k]?z=ls:u["*"]?z=u["*"]:s["*"]&&(z=ls),z?y=y.concat(z({key:(e&&`${e}.`)+E,value:i[E],valueSpec:s[k]||s["*"],style:f,styleSpec:g,object:i,objectKey:E},i)):y.push(new ei(e,i[E],`unknown property "${E}"`))}for(const E in s)u[E]||s[E].required&&void 0===s[E].default&&void 0===i[E]&&y.push(new ei(e,i,`missing required property "${E}"`));return y}function tu(n){const e=n.value,i=n.valueSpec,s=n.style,u=n.styleSpec,f=n.key,g=n.arrayElementValidator||ls;if("array"!==_n(e))return[new ei(f,e,`array expected, ${_n(e)} found`)];if(i.length&&e.length!==i.length)return[new ei(f,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new ei(f,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let y={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};u.$version<7&&(y.function=i.function),"object"===_n(i.value)&&(y=i.value);let w=[];for(let E=0;E<e.length;E++)w=w.concat(g({array:e,arrayIndex:E,value:e[E],valueSpec:y,style:s,styleSpec:u,key:`${f}[${E}]`}));return w}function wl(n){const e=n.key,i=n.value,s=n.valueSpec;let u=_n(i);if("number"===u&&i!=i&&(u="NaN"),"number"!==u)return[new ei(e,i,`number expected, ${u} found`)];if("minimum"in s){let f=s.minimum;if("array"===_n(s.minimum)&&(f=s.minimum[n.arrayIndex]),i<f)return[new ei(e,i,`${i} is less than the minimum value ${f}`)]}if("maximum"in s){let f=s.maximum;if("array"===_n(s.maximum)&&(f=s.maximum[n.arrayIndex]),i>f)return[new ei(e,i,`${i} is greater than the maximum value ${f}`)]}return[]}function Bl(n){const e=n.valueSpec,i=Rr(n.value.type);let s,u,f,g={};const y="categorical"!==i&&void 0===n.value.property,w=!y,E="array"===_n(n.value.stops)&&"array"===_n(n.value.stops[0])&&"object"===_n(n.value.stops[0][0]),k=Ra({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(Y){if("identity"===i)return[new ei(Y.key,Y.value,'identity function may not have a "stops" property')];let J=[];const oe=Y.value;return J=J.concat(tu({key:Y.key,value:oe,valueSpec:Y.valueSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:z})),"array"===_n(oe)&&0===oe.length&&J.push(new ei(Y.key,oe,"array must have at least one stop")),J},default:function(Y){return ls({key:Y.key,value:Y.value,valueSpec:e,style:Y.style,styleSpec:Y.styleSpec})}}});return"identity"===i&&y&&k.push(new ei(n.key,n.value,'missing required property "property"')),"identity"===i||n.value.stops||k.push(new ei(n.key,n.value,'missing required property "stops"')),"exponential"===i&&n.valueSpec.expression&&!rn(n.valueSpec)&&k.push(new ei(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(w&&!fe(n.valueSpec)?k.push(new ei(n.key,n.value,"property functions not supported")):y&&!Xe(n.valueSpec)&&k.push(new ei(n.key,n.value,"zoom functions not supported"))),"categorical"!==i&&!E||void 0!==n.value.property||k.push(new ei(n.key,n.value,'"property" property is required')),k;function z(Y){let J=[];const oe=Y.value,_e=Y.key;if("array"!==_n(oe))return[new ei(_e,oe,`array expected, ${_n(oe)} found`)];if(2!==oe.length)return[new ei(_e,oe,`array length 2 expected, length ${oe.length} found`)];if(E){if("object"!==_n(oe[0]))return[new ei(_e,oe,`object expected, ${_n(oe[0])} found`)];if(void 0===oe[0].zoom)return[new ei(_e,oe,"object stop key must have zoom")];if(void 0===oe[0].value)return[new ei(_e,oe,"object stop key must have value")];const Pe=Rr(oe[0].zoom);if("number"!=typeof Pe)return[new ei(_e,oe[0].zoom,"stop zoom values must be numbers")];if(f&&f>Pe)return[new ei(_e,oe[0].zoom,"stop zoom values must appear in ascending order")];Pe!==f&&(f=Pe,u=void 0,g={}),J=J.concat(Ra({key:`${_e}[0]`,value:oe[0],valueSpec:{zoom:{}},style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:wl,value:U}}))}else J=J.concat(U({key:`${_e}[0]`,value:oe[0],valueSpec:{},style:Y.style,styleSpec:Y.styleSpec},oe));return Cs(Or(oe[1]))?J.concat([new ei(`${_e}[1]`,oe[1],"expressions are not allowed in function stops.")]):J.concat(ls({key:`${_e}[1]`,value:oe[1],valueSpec:e,style:Y.style,styleSpec:Y.styleSpec}))}function U(Y,J){const oe=_n(Y.value),_e=Rr(Y.value),Pe=null!==Y.value?Y.value:J;if(s){if(oe!==s)return[new ei(Y.key,Pe,`${oe} stop domain type must match previous stop domain type ${s}`)]}else s=oe;if("number"!==oe&&"string"!==oe&&"boolean"!==oe&&"number"!=typeof _e&&"string"!=typeof _e&&"boolean"!=typeof _e)return[new ei(Y.key,Pe,"stop domain value must be a number, string, or boolean")];if("number"!==oe&&"categorical"!==i){let qe=`number expected, ${oe} found`;return fe(e)&&void 0===i&&(qe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ei(Y.key,Pe,qe)]}return"categorical"!==i||"number"!==oe||"number"==typeof _e&&isFinite(_e)&&Math.floor(_e)===_e?"categorical"!==i&&"number"===oe&&"number"==typeof _e&&"number"==typeof u&&void 0!==u&&_e<u?[new ei(Y.key,Pe,"stop domain values must appear in ascending order")]:(u=_e,"categorical"===i&&_e in g?[new ei(Y.key,Pe,"stop domain values must be unique")]:(g[_e]=!0,[])):[new ei(Y.key,Pe,`integer expected, found ${String(_e)}`)]}}function Us(n){const e=("property"===n.expressionContext?Da:Yo)(Or(n.value),n.valueSpec);if("error"===e.result)return e.value.map(s=>new ei(`${n.key}${s.key}`,n.value,s.message));const i=e.value.expression||e.value._styleExpression.expression;if("property"===n.expressionContext&&"text-font"===n.propertyKey&&!i.outputDefined())return[new ei(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===n.expressionContext&&"layout"===n.propertyType&&!Go(i))return[new ei(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===n.expressionContext)return Wi(i,n);if(n.expressionContext&&0===n.expressionContext.indexOf("cluster")){if(!$o(i,["zoom","feature-state"]))return[new ei(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===n.expressionContext&&!aa(i))return[new ei(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wi(n,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)i.delete(u);if(0===i.size)return[];const s=[];return n instanceof So&&i.has(n.name)?[new ei(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(u=>{s.push(...Wi(u,e))}),s)}function El(n){const e=n.key,i=n.value,s=n.valueSpec,u=[];return Array.isArray(s.values)?-1===s.values.indexOf(Rr(i))&&u.push(new ei(e,i,`expected one of [${s.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(s.values).indexOf(Rr(i))&&u.push(new ei(e,i,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function nu(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!nu(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function iu(n,e="fill"){if(null==n)return{filter:()=>!0,needGeometry:!1,needFeature:!1};nu(n)||(n=Tl(n));const i=n;let s=!0;try{s=function(E){if(!Dl(E))return E;let k=Or(E);return Ca(k),k=ru(k),k}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const u=Gt[`filter_${e}`],f=Yo(s,u);let g=null;if("error"===f.result)throw new Error(f.value.map(E=>`${E.key}: ${E.message}`).join(", "));g=(E,k,z)=>f.value.evaluate(E,k,{},z);let y=null,w=null;if(s!==i){const E=Yo(i,u);if("error"===E.result)throw new Error(E.value.map(k=>`${k.key}: ${k.message}`).join(", "));y=(k,z,U,Y,J)=>E.value.evaluate(k,z,{},U,void 0,void 0,Y,J),w=!aa(E.value.expression)}return{filter:g,dynamicFilter:y||void 0,needGeometry:yd(s),needFeature:!!w}}function ru(n){if(!Array.isArray(n))return n;const e=function(i){if(Cl.has(i[0]))for(let s=1;s<i.length;s++)if(Dl(i[s]))return!0;return i}(n);return!0===e?e:e.map(i=>ru(i))}function Ca(n){let e=!1;const i=[];if("case"===n[0]){for(let s=1;s<n.length-1;s+=2)e=e||Dl(n[s]),i.push(n[s+1]);i.push(n[n.length-1])}else if("match"===n[0]){e=e||Dl(n[1]);for(let s=2;s<n.length-1;s+=2)i.push(n[s+1]);i.push(n[n.length-1])}else if("step"===n[0]){e=e||Dl(n[1]);for(let s=1;s<n.length-1;s+=2)i.push(n[s+1])}e&&(n.length=0,n.push("any",...i));for(let s=1;s<n.length;s++)Ca(n[s])}function Dl(n){if(!Array.isArray(n))return!1;if("pitch"===(e=n[0])||"distance-from-center"===e)return!0;var e;for(let i=1;i<n.length;i++)if(Dl(n[i]))return!0;return!1}const Cl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fh(n,e){return n<e?-1:n>e?1:0}function yd(n){if(!Array.isArray(n))return!1;if("within"===n[0])return!0;for(let e=1;e<n.length;e++)if(yd(n[e]))return!0;return!1}function Tl(n){if(!n)return!0;const e=n[0];return n.length<=1?"any"!==e:"=="===e?wc(n[1],n[2],"=="):"!="===e?Ar(wc(n[1],n[2],"==")):"<"===e||">"===e||"<="===e||">="===e?wc(n[1],n[2],e):"any"===e?(i=n.slice(1),["any"].concat(i.map(Tl))):"all"===e?["all"].concat(n.slice(1).map(Tl)):"none"===e?["all"].concat(n.slice(1).map(Tl).map(Ar)):"in"===e?oc(n[1],n.slice(2)):"!in"===e?Ar(oc(n[1],n.slice(2))):"has"===e?Ln(n[1]):"!has"===e?Ar(Ln(n[1])):"within"!==e||n;var i}function wc(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function oc(n,e){if(0===e.length)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(fh)]]:["filter-in-small",n,["literal",e]]}}function Ln(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Ar(n){return["!",n]}function sc(n){return nu(Or(n.value))?Us(so({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):Sl(n)}function Sl(n){const e=n.value,i=n.key;if("array"!==_n(e))return[new ei(i,e,`array expected, ${_n(e)} found`)];const s=n.styleSpec;let u,f=[];if(e.length<1)return[new ei(i,e,"filter array must have at least 1 element")];switch(f=f.concat(El({key:`${i}[0]`,value:e[0],valueSpec:s.filter_operator,style:n.style,styleSpec:n.styleSpec})),Rr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Rr(e[1])&&f.push(new ei(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&f.push(new ei(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=_n(e[1]),"string"!==u&&f.push(new ei(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let g=2;g<e.length;g++)u=_n(e[g]),"$type"===Rr(e[1])?f=f.concat(El({key:`${i}[${g}]`,value:e[g],valueSpec:s.geometry_type,style:n.style,styleSpec:n.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&f.push(new ei(`${i}[${g}]`,e[g],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)f=f.concat(Sl({key:`${i}[${g}]`,value:e[g],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=_n(e[1]),2!==e.length?f.push(new ei(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==u&&f.push(new ei(`${i}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=_n(e[1]),2!==e.length?f.push(new ei(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==u&&f.push(new ei(`${i}[1]`,e[1],`object expected, ${u} found`))}return f}function Ts(n,e){const i=n.key,s=n.style,u=n.styleSpec,f=n.value,g=n.objectKey,y=u[`${e}_${n.layerType}`];if(!y)return[];const w=g.match(/^(.*)-transition$/);if("paint"===e&&w&&y[w[1]]&&y[w[1]].transition)return ls({key:i,value:f,valueSpec:u.transition,style:s,styleSpec:u});const E=n.valueSpec||y[g];if(!E)return[new ei(i,f,`unknown property "${g}"`)];let k;if("string"===_n(f)&&fe(E)&&!E.tokens&&(k=/^{([^}]+)}$/.exec(f))){const U=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new ei(i,f,`"${g}" does not support interpolation syntax\nUse an identity property function instead: ${U}.`)]}const z=[];return"symbol"===n.layerType&&("text-field"===g&&s&&!s.glyphs&&z.push(new ei(i,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===g&&ki(Or(f))&&"identity"===Rr(f.type)&&z.push(new ei(i,f,'"text-font" does not support identity functions'))),z.concat(ls({key:n.key,value:f,valueSpec:E,style:s,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:g}))}function Au(n){return Ts(n,"paint")}function Nl(n){return Ts(n,"layout")}function Va(n){let e=[];const i=n.value,s=n.key,u=n.style,f=n.styleSpec;i.type||i.ref||e.push(new ei(s,i,'either "type" or "ref" is required'));let g=Rr(i.type);const y=Rr(i.ref);if(i.id){const w=Rr(i.id);for(let E=0;E<n.arrayIndex;E++){const k=u.layers[E];Rr(k.id)===w&&e.push(new ei(s,i.id,`duplicate layer id "${i.id}", previously used at line ${k.id.__line__}`))}}if("ref"in i){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in i&&e.push(new ei(s,i[E],`"${E}" is prohibited for ref layers`))}),u.layers.forEach(E=>{Rr(E.id)===y&&(w=E)}),w?w.ref?e.push(new ei(s,i.ref,"ref cannot reference another ref layer")):g=Rr(w.type):"string"==typeof y&&e.push(new ei(s,i.ref,`ref layer "${y}" not found`))}else if("background"!==g&&"sky"!==g)if(i.source){const w=u.sources&&u.sources[i.source],E=w&&Rr(w.type);w?"vector"===E&&"raster"===g?e.push(new ei(s,i.source,`layer "${i.id}" requires a raster source`)):"raster"===E&&"raster"!==g?e.push(new ei(s,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==E||i["source-layer"]?"raster-dem"===E&&"hillshade"!==g?e.push(new ei(s,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==g||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===E&&w.lineMetrics||e.push(new ei(s,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ei(s,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new ei(s,i.source,`source "${i.source}" not found`))}else e.push(new ei(s,i,'missing required property "source"'));return e=e.concat(Ra({key:s,value:i,valueSpec:f.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ls({key:`${s}.type`,value:i.type,valueSpec:f.layer.type,style:n.style,styleSpec:n.styleSpec,object:i,objectKey:"type"}),filter:w=>sc(so({layerType:g},w)),layout:w=>Ra({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>Nl(so({layerType:g},E))}}),paint:w=>Ra({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>Au(so({layerType:g},E))}})}})),e}function Ua(n){const e=n.value,i=n.key,s=_n(e);return"string"!==s?[new ei(i,e,`string expected, ${s} found`)]:[]}const ou={promoteId:function({key:n,value:e}){if("string"===_n(e))return Ua({key:n,value:e});{const i=[];for(const s in e)i.push(...Ua({key:`${n}.${s}`,value:e[s]}));return i}}};function su(n){const e=n.value,i=n.key,s=n.styleSpec,u=n.style;if(!e.type)return[new ei(i,e,'"type" is required')];const f=Rr(e.type);let g;switch(f){case"vector":case"raster":case"raster-dem":return g=Ra({key:i,value:e,valueSpec:s[`source_${f.replace("-","_")}`],style:n.style,styleSpec:s,objectElementValidators:ou}),g;case"geojson":if(g=Ra({key:i,value:e,valueSpec:s.source_geojson,style:u,styleSpec:s,objectElementValidators:ou}),e.cluster)for(const y in e.clusterProperties){const[w,E]=e.clusterProperties[y],k="string"==typeof w?[w,["accumulated"],["get",y]]:w;g.push(...Us({key:`${i}.${y}.map`,value:E,expressionContext:"cluster-map"})),g.push(...Us({key:`${i}.${y}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return g;case"video":return Ra({key:i,value:e,valueSpec:s.source_video,style:u,styleSpec:s});case"image":return Ra({key:i,value:e,valueSpec:s.source_image,style:u,styleSpec:s});case"canvas":return[new ei(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return El({key:`${i}.type`,value:e.type,valueSpec:{values:ph(s)},style:u,styleSpec:s})}}function ph(n){return n.source.reduce((e,i)=>{const s=n[i];return"enum"===s.type.type&&(e=e.concat(Object.keys(s.type.values))),e},[])}function au(n){const e=n.value,i=n.styleSpec,s=i.light,u=n.style;let f=[];const g=_n(e);if(void 0===e)return f;if("object"!==g)return f=f.concat([new ei("light",e,`object expected, ${g} found`)]),f;for(const y in e){const w=y.match(/^(.*)-transition$/);f=f.concat(w&&s[w[1]]&&s[w[1]].transition?ls({key:y,value:e[y],valueSpec:i.transition,style:u,styleSpec:i}):s[y]?ls({key:y,value:e[y],valueSpec:s[y],style:u,styleSpec:i}):[new ei(y,e[y],`unknown property "${y}"`)])}return f}function js(n){const e=n.value,i=n.key,s=n.style,u=n.styleSpec,f=u.terrain;let g=[];const y=_n(e);if(void 0===e)return g;if("object"!==y)return g=g.concat([new ei("terrain",e,`object expected, ${y} found`)]),g;for(const w in e){const E=w.match(/^(.*)-transition$/);g=g.concat(E&&f[E[1]]&&f[E[1]].transition?ls({key:w,value:e[w],valueSpec:u.transition,style:s,styleSpec:u}):f[w]?ls({key:w,value:e[w],valueSpec:f[w],style:s,styleSpec:u}):[new ei(w,e[w],`unknown property "${w}"`)])}if(e.source){const w=s.sources&&s.sources[e.source],E=w&&Rr(w.type);w?"raster-dem"!==E&&g.push(new ei(i,e.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):g.push(new ei(i,e.source,`source "${e.source}" not found`))}else g.push(new ei(i,e,'terrain is missing required property "source"'));return g}function ja(n){const e=n.value,i=n.style,s=n.styleSpec,u=s.fog;let f=[];const g=_n(e);if(void 0===e)return f;if("object"!==g)return f=f.concat([new ei("fog",e,`object expected, ${g} found`)]),f;for(const y in e){const w=y.match(/^(.*)-transition$/);f=f.concat(w&&u[w[1]]&&u[w[1]].transition?ls({key:y,value:e[y],valueSpec:s.transition,style:i,styleSpec:s}):u[y]?ls({key:y,value:e[y],valueSpec:u[y],style:i,styleSpec:s}):[new ei(y,e[y],`unknown property "${y}"`)])}return f}const lu={"*":()=>[],array:tu,boolean:function(n){const e=n.value,i=n.key,s=_n(e);return"boolean"!==s?[new ei(i,e,`boolean expected, ${s} found`)]:[]},number:wl,color:function(n){const e=n.key,i=n.value,s=_n(i);return"string"!==s?[new ei(e,i,`color expected, ${s} found`)]:null===br(i)?[new ei(e,i,`color expected, "${i}" found`)]:[]},enum:El,filter:sc,function:Bl,layer:Va,object:Ra,source:su,light:au,terrain:js,fog:ja,string:Ua,formatted:function(n){return 0===Ua(n).length?[]:Us(n)},resolvedImage:function(n){return 0===Ua(n).length?[]:Us(n)},projection:function(n){const e=n.value,i=n.styleSpec,s=i.projection,u=n.style;let f=[];const g=_n(e);if("object"===g)for(const y in e)f=f.concat(ls({key:y,value:e[y],valueSpec:s[y],style:u,styleSpec:i}));else"string"!==g&&(f=f.concat([new ei("projection",e,`object or string expected, ${g} found`)]));return f}};function ls(n){const e=n.value,i=n.valueSpec,s=n.styleSpec;return i.expression&&ki(Rr(e))?Bl(n):i.expression&&Cs(Or(e))?Us(n):i.type&&lu[i.type]?lu[i.type](n):Ra(so({},n,{valueSpec:i.type?s[i.type]:i}))}function Ja(n){const e=n.value,i=n.key,s=Ua(n);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new ei(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new ei(i,e,'"glyphs" url must include a "{range}" token'))),s}function Pu(n,e=Gt){return Oa(ls({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:Ja,"*":()=>[]}}))}const cu=n=>Oa(Au(n)),vd=n=>Oa(Nl(n));function Oa(n){return n.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function uu(n,e){let i=!1;if(e&&e.length)for(const s of e)n.fire(new Ni(new Error(s.message))),i=!0;return i}var Ru=La,ka=3;function La(n,e,i){var s=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var u=new Int32Array(this.arrayBuffer);n=u[0],this.d=(e=u[1])+2*(i=u[2]);for(var f=0;f<this.d*this.d;f++){var g=u[ka+f],y=u[ka+f+1];s.push(g===y?null:u.subarray(g,y))}var w=u[ka+s.length+1];this.keys=u.subarray(u[ka+s.length],w),this.bboxes=u.subarray(w),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var E=0;E<this.d*this.d;E++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=i,this.scale=e/n,this.uid=0;var k=i/e*n;this.min=-k,this.max=n+k}La.prototype.insert=function(n,e,i,s,u){this._forEachCell(e,i,s,u,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(u)},La.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},La.prototype._insertCell=function(n,e,i,s,u,f){this.cells[u].push(f)},La.prototype.query=function(n,e,i,s,u){var f=this.min,g=this.max;if(n<=f&&e<=f&&g<=i&&g<=s&&!u)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(n,e,i,s,this._queryCell,y,{},u),y},La.prototype._queryCell=function(n,e,i,s,u,f,g,y){var w=this.cells[u];if(null!==w)for(var E=this.keys,k=this.bboxes,z=0;z<w.length;z++){var U=w[z];if(void 0===g[U]){var Y=4*U;(y?y(k[Y+0],k[Y+1],k[Y+2],k[Y+3]):n<=k[Y+2]&&e<=k[Y+3]&&i>=k[Y+0]&&s>=k[Y+1])?(g[U]=!0,f.push(E[U])):g[U]=!1}}},La.prototype._forEachCell=function(n,e,i,s,u,f,g,y){for(var w=this._convertToCellCoord(n),E=this._convertToCellCoord(e),k=this._convertToCellCoord(i),z=this._convertToCellCoord(s),U=w;U<=k;U++)for(var Y=E;Y<=z;Y++){var J=this.d*Y+U;if((!y||y(this._convertFromCellCoord(U),this._convertFromCellCoord(Y),this._convertFromCellCoord(U+1),this._convertFromCellCoord(Y+1)))&&u.call(this,n,e,i,s,J,f,g,y))return}},La.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},La.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},La.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=ka+this.cells.length+1+1,i=0,s=0;s<this.cells.length;s++)i+=this.cells[s].length;var u=new Int32Array(e+i+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var f=e,g=0;g<n.length;g++){var y=n[g];u[ka+g]=f,u.set(y,f),f+=y.length}return u[ka+n.length]=f,u.set(this.keys,f),u[ka+n.length+1]=f+=this.keys.length,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer};var zl=Wt(Ru);const P={};function O(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),P[e]={klass:n,omit:i.omit||[]}}O(Object,"Object"),zl.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.push(i),{buffer:i}},zl.deserialize=function(n){return new zl(n.buffer)},Object.defineProperty(zl,"name",{value:"Grid"}),O(zl,"Grid"),O(cr,"Color"),O(Error,"Error"),O(Sr,"AJAXError"),O(Cr,"ResolvedImage"),O(Js,"StylePropertyFunction"),O(qo,"StyleExpression",{omit:["_evaluator"]}),O(xa,"ZoomDependentExpression"),O(Zo,"ZoomConstantExpression"),O(So,"CompoundExpression",{omit:["_evaluate"]});for(const n in X)P[X[n]._classRegistryKey]||O(X[n],`Expression${n}`);function V(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function L(n){return Me.ImageBitmap&&n instanceof Me.ImageBitmap}function q(n,e){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(V(n)||L(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const i=n;return e&&e.push(i.buffer),i}if(n instanceof Me.ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const s of n)i.push(q(s,e));return i}if("object"==typeof n){const i=n.constructor,s=i._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const u=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const f in n)n.hasOwnProperty(f)&&(P[s].omit.indexOf(f)>=0||(u[f]=q(n[f],e)));n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof n)}function ve(n){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||V(n)||L(n)||ArrayBuffer.isView(n)||n instanceof Me.ImageData)return n;if(Array.isArray(n))return n.map(ve);if("object"==typeof n){const e=n.$name||"Object",{klass:i}=P[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const s=Object.create(i.prototype);for(const u of Object.keys(n))"$name"!==u&&(s[u]=ve(n[u]));return s}throw new Error("can't deserialize object of type "+typeof n)}const me={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function et(n){for(const e of n)if(or(e.charCodeAt(0)))return!0;return!1}function In(n){for(const e of n)if(!Yn(e.charCodeAt(0)))return!1;return!0}function Yn(n){return!(me.Arabic(n)||me["Arabic Supplement"](n)||me["Arabic Extended-A"](n)||me["Arabic Presentation Forms-A"](n)||me["Arabic Presentation Forms-B"](n))}function or(n){return!(746!==n&&747!==n&&(n<4352||!(me["Bopomofo Extended"](n)||me.Bopomofo(n)||me["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||me["CJK Compatibility Ideographs"](n)||me["CJK Compatibility"](n)||me["CJK Radicals Supplement"](n)||me["CJK Strokes"](n)||!(!me["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||12336===n)||me["CJK Unified Ideographs Extension A"](n)||me["CJK Unified Ideographs"](n)||me["Enclosed CJK Letters and Months"](n)||me["Hangul Compatibility Jamo"](n)||me["Hangul Jamo Extended-A"](n)||me["Hangul Jamo Extended-B"](n)||me["Hangul Jamo"](n)||me["Hangul Syllables"](n)||me.Hiragana(n)||me["Ideographic Description Characters"](n)||me.Kanbun(n)||me["Kangxi Radicals"](n)||me["Katakana Phonetic Extensions"](n)||me.Katakana(n)&&12540!==n||!(!me["Halfwidth and Fullwidth Forms"](n)||65288===n||65289===n||65293===n||n>=65306&&n<=65310||65339===n||65341===n||65343===n||n>=65371&&n<=65503||65507===n||n>=65512&&n<=65519)||!(!me["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||me["Unified Canadian Aboriginal Syllabics"](n)||me["Unified Canadian Aboriginal Syllabics Extended"](n)||me["Vertical Forms"](n)||me["Yijing Hexagram Symbols"](n)||me["Yi Syllables"](n)||me["Yi Radicals"](n))))}function ui(n){return!(or(n)||(e=n,me["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||me["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||me["Letterlike Symbols"](e)||me["Number Forms"](e)||me["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||me["Control Pictures"](e)&&9251!==e||me["Optical Character Recognition"](e)||me["Enclosed Alphanumerics"](e)||me["Geometric Shapes"](e)||me["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||me["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||me["CJK Symbols and Punctuation"](e)||me.Katakana(e)||me["Private Use Area"](e)||me["CJK Compatibility Forms"](e)||me["Small Form Variants"](e)||me["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e}function Xo(n){return n>=1424&&n<=2303||me["Arabic Presentation Forms-A"](n)||me["Arabic Presentation Forms-B"](n)}function Ha(n,e){return!(!e&&Xo(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||me.Khmer(n))}function $l(n){for(const e of n)if(Xo(e.charCodeAt(0)))return!0;return!1}const Il="deferred",Vl="loading",Qa="loaded";let Ml=null,h="unavailable",r=null;const c=function(n){n&&"string"==typeof n&&n.indexOf("NetworkError")>-1&&(h="error"),Ml&&Ml(n)};function p(){_.fire(new xr("pluginStateChange",{pluginStatus:h,pluginURL:r}))}const _=new Qo,x=function(){return h},C=function(){if(h!==Il||!r)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");h=Vl,p(),r&&rr({url:r},n=>{n?c(n):(h=Qa,p())})},A={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>h===Qa||null!=A.applyArabicShaping,isLoading:()=>h===Vl,setState(n){h=n.pluginStatus,r=n.pluginURL},isParsed:()=>null!=A.applyArabicShaping&&null!=A.processBidirectionalText&&null!=A.processStyledBidirectionalText,getPluginURL:()=>r};class N{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,s){for(const u of i)if(!Ha(u.charCodeAt(0),s))return!1;return!0}(e,A.isLoaded())}}class G{constructor(e,i){this.property=e,this.value=i,this.expression=function(s,u){if(ki(s))return new Js(s,u);if(Cs(s)){const f=Da(s,u);if("error"===f.result)throw new Error(f.value.map(g=>`${g.key}: ${g.message}`).join(", "));return f.value}{let f=s;return"string"==typeof s&&"color"===u.type&&(f=cr.parse(s)),{kind:"constant",evaluate:()=>f}}}(void 0===i?e.specification.default:i,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,i,s){return this.property.possiblyEvaluate(this,e,i,s)}}class H{constructor(e){this.property=e,this.value=new G(e,void 0)}transitioned(e,i){return new pe(this.property,this.value,i,Re({},e.transition,this.transition),e.now)}untransitioned(){return new pe(this.property,this.value,null,{},0)}}class ie{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return xt(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new H(this._values[e].property)),this._values[e].value=new G(this._values[e].property,null===i?void 0:xt(i))}getTransition(e){return xt(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new H(this._values[e].property)),this._values[e].transition=xt(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);void 0!==s&&(e[i]=s);const u=this.getTransition(i);void 0!==u&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const s=new be(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(e,i._values[u]);return s}untransitioned(){const e=new be(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class pe{constructor(e,i,s,u,f){const g=u.delay||0,y=u.duration||0;f=f||0,this.property=e,this.value=i,this.begin=f+g,this.end=this.begin+y,e.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const u=e.now||0,f=this.value.possiblyEvaluate(e,i,s),g=this.prior;if(g){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return g.possiblyEvaluate(e,i,s);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,i,s),f,ft(y))}}return f}}class be{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const u=new ke(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,s);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ie{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return xt(this._values[e].value)}setValue(e,i){this._values[e]=new G(this._values[e].property,null===i?void 0:xt(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);void 0!==s&&(e[i]=s)}return e}possiblyEvaluate(e,i,s){const u=new ke(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,s);return u}}class Ce{constructor(e,i,s){this.property=e,this.value=i,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,i,s,u){return this.property.evaluate(this.value,this.parameters,e,i,s,u)}}class ke{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class re{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const u=S[this.specification.type];return u?u(e,i,s):e}}class we{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,u){return new Ce(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(i,null,{},s,u)}:e.expression,i)}interpolate(e,i,s){if("constant"!==e.value.kind||"constant"!==i.value.kind)return e;if(void 0===e.value.value||void 0===i.value.value)return new Ce(this,{kind:"constant",value:void 0},e.parameters);const u=S[this.specification.type];return u?new Ce(this,{kind:"constant",value:u(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,u,f,g){return"constant"===e.kind?e.value:e.evaluate(i,s,u,f,g)}}class ze{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,u){return!!e.expression.evaluate(i,null,{},s,u)}interpolate(){return!1}}class $e{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new N(0,{});for(const s in e){const u=e[s];u.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new G(u,void 0),g=this.defaultTransitionablePropertyValues[s]=new H(u);this.defaultTransitioningPropertyValues[s]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate(i)}}}function lt(n,e){return 256*(n=Vt(Math.floor(n),0,255))+Vt(Math.floor(e),0,255)}O(we,"DataDrivenProperty"),O(re,"DataConstantProperty"),O(ze,"ColorRampProperty");const ct={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ut{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class kt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Pt(n,e=1){let i=0,s=0;return{members:n.map(u=>{const f=ct[u.type].BYTES_PER_ELEMENT,g=i=qt(i,Math.max(e,f)),y=u.components||1;return s=Math.max(s,f),i+=f*y,{name:u.name,type:u.type,components:y,offset:g}}),size:qt(i,Math.max(s,e)),alignment:e}}function qt(n,e){return Math.ceil(n/e)*e}class Fn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=s,e}}Fn.prototype.bytesPerElement=4,O(Fn,"StructArrayLayout2i4");class Ut extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=s,this.int16[f+2]=u,e}}Ut.prototype.bytesPerElement=6,O(Ut,"StructArrayLayout3i6");class gn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,u)}emplace(e,i,s,u,f){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=s,this.int16[g+2]=u,this.int16[g+3]=f,e}}gn.prototype.bytesPerElement=8,O(gn,"StructArrayLayout4i8");class Jt extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,s,u,f,g,y)}emplace(e,i,s,u,f,g,y,w){const E=6*e,k=12*e,z=3*e;return this.int16[E+0]=i,this.int16[E+1]=s,this.uint8[k+4]=u,this.uint8[k+5]=f,this.uint8[k+6]=g,this.uint8[k+7]=y,this.float32[z+2]=w,e}}Jt.prototype.bytesPerElement=12,O(Jt,"StructArrayLayout2i4ub1f12");class Rn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,u)}emplace(e,i,s,u,f){const g=4*e;return this.float32[g+0]=i,this.float32[g+1]=s,this.float32[g+2]=u,this.float32[g+3]=f,e}}Rn.prototype.bytesPerElement=16,O(Rn,"StructArrayLayout4f16");class jt extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,u,f)}emplace(e,i,s,u,f,g){const y=6*e,w=3*e;return this.uint16[y+0]=i,this.uint16[y+1]=s,this.uint16[y+2]=u,this.uint16[y+3]=f,this.float32[w+2]=g,e}}jt.prototype.bytesPerElement=12,O(jt,"StructArrayLayout4ui1f12");class vn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,u)}emplace(e,i,s,u,f){const g=4*e;return this.uint16[g+0]=i,this.uint16[g+1]=s,this.uint16[g+2]=u,this.uint16[g+3]=f,e}}vn.prototype.bytesPerElement=8,O(vn,"StructArrayLayout4ui8");class kn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,u,f,g)}emplace(e,i,s,u,f,g,y){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=s,this.int16[w+2]=u,this.int16[w+3]=f,this.int16[w+4]=g,this.int16[w+5]=y,e}}kn.prototype.bytesPerElement=12,O(kn,"StructArrayLayout6i12");class Mn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,g,y,w,E,k,z,U){const Y=this.length;return this.resize(Y+1),this.emplace(Y,e,i,s,u,f,g,y,w,E,k,z,U)}emplace(e,i,s,u,f,g,y,w,E,k,z,U,Y){const J=12*e;return this.int16[J+0]=i,this.int16[J+1]=s,this.int16[J+2]=u,this.int16[J+3]=f,this.uint16[J+4]=g,this.uint16[J+5]=y,this.uint16[J+6]=w,this.uint16[J+7]=E,this.int16[J+8]=k,this.int16[J+9]=z,this.int16[J+10]=U,this.int16[J+11]=Y,e}}Mn.prototype.bytesPerElement=24,O(Mn,"StructArrayLayout4i4ui4i24");class Vn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,u,f,g)}emplace(e,i,s,u,f,g,y){const w=10*e,E=5*e;return this.int16[w+0]=i,this.int16[w+1]=s,this.int16[w+2]=u,this.float32[E+2]=f,this.float32[E+3]=g,this.float32[E+4]=y,e}}Vn.prototype.bytesPerElement=20,O(Vn,"StructArrayLayout3i3f20");class Ei extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Ei.prototype.bytesPerElement=4,O(Ei,"StructArrayLayout1ul4");class Ki extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,g,y,w,E,k,z,U,Y){const J=this.length;return this.resize(J+1),this.emplace(J,e,i,s,u,f,g,y,w,E,k,z,U,Y)}emplace(e,i,s,u,f,g,y,w,E,k,z,U,Y,J){const oe=20*e,_e=10*e;return this.int16[oe+0]=i,this.int16[oe+1]=s,this.int16[oe+2]=u,this.int16[oe+3]=f,this.int16[oe+4]=g,this.float32[_e+3]=y,this.float32[_e+4]=w,this.float32[_e+5]=E,this.float32[_e+6]=k,this.int16[oe+14]=z,this.uint32[_e+8]=U,this.uint16[oe+18]=Y,this.uint16[oe+19]=J,e}}Ki.prototype.bytesPerElement=40,O(Ki,"StructArrayLayout5i4f1i1ul2ui40");class di extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,s,u,f,g,y)}emplace(e,i,s,u,f,g,y,w){const E=8*e;return this.int16[E+0]=i,this.int16[E+1]=s,this.int16[E+2]=u,this.int16[E+4]=f,this.int16[E+5]=g,this.int16[E+6]=y,this.int16[E+7]=w,e}}di.prototype.bytesPerElement=16,O(di,"StructArrayLayout3i2i2i16");class Ri extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,u,f)}emplace(e,i,s,u,f,g){const y=4*e,w=8*e;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=u,this.int16[w+6]=f,this.int16[w+7]=g,e}}Ri.prototype.bytesPerElement=16,O(Ri,"StructArrayLayout2f1f2i16");class _r extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,u)}emplace(e,i,s,u,f){const g=12*e,y=3*e;return this.uint8[g+0]=i,this.uint8[g+1]=s,this.float32[y+1]=u,this.float32[y+2]=f,e}}_r.prototype.bytesPerElement=12,O(_r,"StructArrayLayout2ub2f12");class dr extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=s,this.float32[f+2]=u,e}}dr.prototype.bytesPerElement=12,O(dr,"StructArrayLayout3f12");class mi extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=s,this.uint16[f+2]=u,e}}mi.prototype.bytesPerElement=6,O(mi,"StructArrayLayout3ui6");class Jr extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,g,y,w,E,k,z,U,Y,J,oe,_e,Pe,qe,Ae,He,tt){const Je=this.length;return this.resize(Je+1),this.emplace(Je,e,i,s,u,f,g,y,w,E,k,z,U,Y,J,oe,_e,Pe,qe,Ae,He,tt)}emplace(e,i,s,u,f,g,y,w,E,k,z,U,Y,J,oe,_e,Pe,qe,Ae,He,tt,Je){const Yt=30*e,zt=15*e,dn=60*e;return this.int16[Yt+0]=i,this.int16[Yt+1]=s,this.int16[Yt+2]=u,this.float32[zt+2]=f,this.float32[zt+3]=g,this.uint16[Yt+8]=y,this.uint16[Yt+9]=w,this.uint32[zt+5]=E,this.uint32[zt+6]=k,this.uint32[zt+7]=z,this.uint16[Yt+16]=U,this.uint16[Yt+17]=Y,this.uint16[Yt+18]=J,this.float32[zt+10]=oe,this.float32[zt+11]=_e,this.uint8[dn+48]=Pe,this.uint8[dn+49]=qe,this.uint8[dn+50]=Ae,this.uint32[zt+13]=He,this.int16[Yt+28]=tt,this.uint8[dn+58]=Je,e}}Jr.prototype.bytesPerElement=60,O(Jr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class uo extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,g,y,w,E,k,z,U,Y,J,oe,_e,Pe,qe,Ae,He,tt,Je,Yt,zt,dn,On,Xt,En,Dn,An){const Bn=this.length;return this.resize(Bn+1),this.emplace(Bn,e,i,s,u,f,g,y,w,E,k,z,U,Y,J,oe,_e,Pe,qe,Ae,He,tt,Je,Yt,zt,dn,On,Xt,En,Dn,An)}emplace(e,i,s,u,f,g,y,w,E,k,z,U,Y,J,oe,_e,Pe,qe,Ae,He,tt,Je,Yt,zt,dn,On,Xt,En,Dn,An,Bn){const ln=38*e,Qn=19*e;return this.int16[ln+0]=i,this.int16[ln+1]=s,this.int16[ln+2]=u,this.float32[Qn+2]=f,this.float32[Qn+3]=g,this.int16[ln+8]=y,this.int16[ln+9]=w,this.int16[ln+10]=E,this.int16[ln+11]=k,this.int16[ln+12]=z,this.int16[ln+13]=U,this.uint16[ln+14]=Y,this.uint16[ln+15]=J,this.uint16[ln+16]=oe,this.uint16[ln+17]=_e,this.uint16[ln+18]=Pe,this.uint16[ln+19]=qe,this.uint16[ln+20]=Ae,this.uint16[ln+21]=He,this.uint16[ln+22]=tt,this.uint16[ln+23]=Je,this.uint16[ln+24]=Yt,this.uint16[ln+25]=zt,this.uint16[ln+26]=dn,this.uint16[ln+27]=On,this.uint16[ln+28]=Xt,this.uint32[Qn+15]=En,this.float32[Qn+16]=Dn,this.float32[Qn+17]=An,this.float32[Qn+18]=Bn,e}}uo.prototype.bytesPerElement=76,O(uo,"StructArrayLayout3i2f6i15ui1ul3f76");class ho extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}ho.prototype.bytesPerElement=4,O(ho,"StructArrayLayout1f4");class Zr extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,u,f)}emplace(e,i,s,u,f,g){const y=5*e;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=u,this.float32[y+3]=f,this.float32[y+4]=g,e}}Zr.prototype.bytesPerElement=20,O(Zr,"StructArrayLayout5f20");class pa extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,u)}emplace(e,i,s,u,f){const g=6*e;return this.uint32[3*e+0]=i,this.uint16[g+2]=s,this.uint16[g+3]=u,this.uint16[g+4]=f,e}}pa.prototype.bytesPerElement=12,O(pa,"StructArrayLayout1ul3ui12");class io extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=s,e}}io.prototype.bytesPerElement=4,O(io,"StructArrayLayout2ui4");class Ga extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Ga.prototype.bytesPerElement=2,O(Ga,"StructArrayLayout1ui2");class el extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=s,e}}el.prototype.bytesPerElement=8,O(el,"StructArrayLayout2f8");class Ro extends ut{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ro.prototype.size=40;class bo extends Ki{get(e){return new Ro(this,e)}}O(bo,"CollisionBoxArray");class $r extends ut{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}$r.prototype.size=60;class cs extends Jr{get(e){return new $r(this,e)}}O(cs,"PlacedSymbolArray");class ks extends ut{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ks.prototype.size=76;class ro extends uo{get(e){return new ks(this,e)}}O(ro,"SymbolInstanceArray");class Hs extends ho{getoffsetX(e){return this.float32[1*e+0]}}O(Hs,"GlyphOffsetArray");class du extends Fn{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}O(du,"SymbolLineVertexArray");class Al extends ut{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Al.prototype.size=12;class ul extends pa{get(e){return new Al(this,e)}}O(ul,"FeatureIndexArray");class Ul extends io{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}O(Ul,"FillExtrusionCentroidArray");const jl=Pt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ec=Pt([{name:"a_dash",components:4,type:"Uint16"}]);var xd={exports:{}},l_=function(n,e){var i,s,u,f,g,y,w,E;for(s=n.length-(i=3&n.length),u=e,g=3432918353,y=461845907,E=0;E<s;)w=255&n.charCodeAt(E)|(255&n.charCodeAt(++E))<<8|(255&n.charCodeAt(++E))<<16|(255&n.charCodeAt(++E))<<24,++E,u=27492+(65535&(f=5*(65535&(u=(u^=w=(65535&(w=(w=(65535&w)*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(w=0,i){case 3:w^=(255&n.charCodeAt(E+2))<<16;case 2:w^=(255&n.charCodeAt(E+1))<<8;case 1:u^=w=(65535&(w=(w=(65535&(w^=255&n.charCodeAt(E)))*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*y+(((w>>>16)*y&65535)<<16)&4294967295}return u^=n.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0},ku=function(n,e){for(var i,s=n.length,u=e^s,f=0;s>=4;)i=1540483477*(65535&(i=255&n.charCodeAt(f)|(255&n.charCodeAt(++f))<<8|(255&n.charCodeAt(++f))<<16|(255&n.charCodeAt(++f))<<24))+((1540483477*(i>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),s-=4,++f;switch(s){case 3:u^=(255&n.charCodeAt(f+2))<<16;case 2:u^=(255&n.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&n.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};xd.exports=l_,xd.exports.murmur3=l_,xd.exports.murmur2=ku;var Ff=Wt(xd.exports);class gh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,s,u){this.ids.push(Qs(e)),this.positions.push(i,s,u)}getPositions(e){const i=Qs(e);let s=0,u=this.ids.length-1;for(;s<u;){const g=s+u>>1;this.ids[g]>=i?u=g:s=g+1}const f=[];for(;this.ids[s]===i;)f.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return f}static serialize(e,i){const s=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Bf(s,u,0,s.length-1),i&&i.push(s.buffer,u.buffer),{ids:s,positions:u}}static deserialize(e){const i=new gh;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function Qs(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Ff(String(n))}function Bf(n,e,i,s){for(;i<s;){const u=n[i+s>>1];let f=i-1,g=s+1;for(;;){do{f++}while(n[f]<u);do{g--}while(n[g]>u);if(f>=g)break;Dc(n,f,g),Dc(e,3*f,3*g),Dc(e,3*f+1,3*g+1),Dc(e,3*f+2,3*g+2)}g-i<s-g?(Bf(n,e,i,g),i=g+1):(Bf(n,e,g+1,s),s=g)}}function Dc(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}O(gh,"FeaturePositionMap");class ac{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class Fa extends ac{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class hu extends ac{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class Nf extends ac{constructor(e){super(e),this.current=cr.transparent}set(e,i,s){this.fetchUniformLocation(e,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const _h=new Float32Array(16),bd=new Float32Array(9),c_=new Float32Array(4);function wm(n){return[lt(255*n.r,255*n.g),lt(255*n.b,255*n.a)]}class wd{constructor(e,i,s){this.value=e,this.uniformNames=i.map(u=>`u_${u}`),this.type=s}setUniform(e,i,s,u,f){i.set(e,f,u.constantOr(this.value))}getBinding(e,i){return"color"===this.type?new Nf(e):new Fa(e)}}class Ed{constructor(e,i){this.uniformNames=i.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,s,u,f){const g="u_pattern"===f||"u_dash"===f?this.pattern:"u_pixel_ratio"===f?this.pixelRatio:null;g&&i.set(e,f,g)}getBinding(e,i){return"u_pattern"===i||"u_dash"===i?new hu(e):new Fa(e)}}class Gs{constructor(e,i,s,u){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,s,u,f,g){const y=this.paintVertexArray.length,w=this.expression.evaluate(new N(0),i,{},f,u,g);this.paintVertexArray.resize(e),this._setPaintValue(y,e,w)}updatePaintArray(e,i,s,u,f){const g=this.expression.evaluate({zoom:0},s,u,void 0,f);this._setPaintValue(e,i,g)}_setPaintValue(e,i,s){if("color"===this.type){const u=wm(s);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class tl{constructor(e,i,s,u,f,g){this.expression=e,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,i,s,u,f,g){const y=this.expression.evaluate(new N(this.zoom),i,{},f,u,g),w=this.expression.evaluate(new N(this.zoom+1),i,{},f,u,g),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,y,w)}updatePaintArray(e,i,s,u,f){const g=this.expression.evaluate({zoom:this.zoom},s,u,void 0,f),y=this.expression.evaluate({zoom:this.zoom+1},s,u,void 0,f);this._setPaintValue(e,i,g,y)}_setPaintValue(e,i,s,u){if("color"===this.type){const f=wm(s),g=wm(u);for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,f[0],f[1],g[0],g[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,s,u,f){const g=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,y=Vt(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(e,f,y)}getBinding(e,i){return new Fa(e)}}class nl{constructor(e,i,s,u,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=("array"===s?Ec:jl).members;for(let g=0;g<i.length;++g);this.paintVertexArray=new u}populatePaintArray(e,i,s){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,u,f,g){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],g)}_setPaintValues(e,i,s,u){if(!u||!s)return;const f=u[s];if(!f)return;const{tl:g,br:y,pixelRatio:w}=f;for(let E=e;E<i;E++)this.paintVertexArray.emplace(E,g[0],g[1],y[0],y[1],w)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fu{constructor(e,i,s=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!s(f))continue;const g=e.paint.get(f);if(!(g instanceof Ce&&fe(g.property.specification)))continue;const y=d_(f,e.type),w=g.value,E=g.property.specification.type,k=!!g.property.useIntegerZoom,z="line-dasharray"===f||f.endsWith("pattern"),U="line-dasharray"===f&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==w.kind||U)if("source"===w.kind||U||z){const Y=Em(f,E,"source");this.binders[f]=z?new nl(w,y,E,Y,e.id):new Gs(w,y,E,Y),u.push(`/a_${f}`)}else{const Y=Em(f,E,"composite");this.binders[f]=new tl(w,y,E,k,i,Y),u.push(`/z_${f}`)}else this.binders[f]=z?new Ed(w.value,y):new wd(w.value,y,E),u.push(`/u_${f}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Gs||i instanceof tl?i.maxValue:0}populatePaintArrays(e,i,s,u,f,g){for(const y in this.binders){const w=this.binders[y];(w instanceof Gs||w instanceof tl||w instanceof nl)&&w.populatePaintArray(e,i,s,u,f,g)}}setConstantPatternPositions(e){for(const i in this.binders){const s=this.binders[i];s instanceof Ed&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,i,s,u,f,g){let y=!1;for(const w in e){const E=i.getPositions(w);for(const k of E){const z=s.feature(k.index);for(const U in this.binders){const Y=this.binders[U];if((Y instanceof Gs||Y instanceof tl||Y instanceof nl)&&!0===Y.expression.isStateDependent){const J=u.paint.get(U);Y.expression=J.value,Y.updatePaintArray(k.start,k.end,z,e[w],f,g),y=!0}}}}return y}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof wd||s instanceof Ed)&&e.push(...s.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Gs||s instanceof tl||s instanceof nl)for(let u=0;u<s.paintVertexAttributes.length;u++)e.push(s.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof wd||s instanceof Ed||s instanceof tl)for(const u of s.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof wd||u instanceof Ed||u instanceof tl)for(const f of u.uniformNames)i.push({name:f,property:s,binding:u.getBinding(e,f)})}return i}setUniforms(e,i,s,u,f){for(const{name:g,property:y,binding:w}of s)this.binders[y].setUniform(e,w,f,u.get(y),g)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Gs||i instanceof tl||i instanceof nl)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof Gs||s instanceof tl||s instanceof nl)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Gs||i instanceof tl||i instanceof nl)&&i.destroy()}}}class Cc{constructor(e,i,s=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new fu(u,i,s);this.needsUpload=!1,this._featureMap=new gh,this._bufferOffset=0}populatePaintArrays(e,i,s,u,f,g,y){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,i,u,f,g,y);void 0!==i.id&&this._featureMap.add(i.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,u,f){for(const g of s)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,i,g,u,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const u_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function d_(n,e){return u_[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const h_={"line-pattern":{source:jt,composite:jt},"fill-pattern":{source:jt,composite:jt},"fill-extrusion-pattern":{source:jt,composite:jt},"line-dasharray":{source:vn,composite:vn}},f_={color:{source:el,composite:Rn},number:{source:ho,composite:el}};function Em(n,e,i){const s=h_[n];return s&&s[i]||f_[e][i]}O(wd,"ConstantBinder"),O(Ed,"PatternConstantBinder"),O(Gs,"SourceExpressionBinder"),O(nl,"PatternCompositeBinder"),O(tl,"CompositeExpressionBinder"),O(fu,"ProgramConfiguration",{omit:["_buffers"]}),O(Cc,"ProgramConfigurationSet");const Dm="-transition";class il extends Qo{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new Ie(i.layout)),i.paint)){this._transitionablePaint=new ie(i.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ke(i.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,s={}){null!=i&&this._validate(vd,`layers.${this.id}.layout.${e}`,e,i,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return ri(e,Dm)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,s={}){if(null!=i&&this._validate(cu,`layers.${this.id}.paint.${e}`,e,i,s))return!1;if(ri(e,Dm))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const u=this._transitionablePaint._values[e],f=u.value.isDataDriven(),g=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value,w=y.isDataDriven(),E=ri(e,"pattern")||"line-dasharray"===e;return w||f||E||this._handleOverridablePaintPropertyUpdate(e,g,y)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),nn(e,(i,s)=>!(void 0===i||"layout"===s&&!Object.keys(i).length||"paint"===s&&!Object.keys(i).length))}_validate(e,i,s,u,f={}){return(!f||!1!==f.validate)&&uu(this,e.call(Pu,{key:i,layerType:this.type,objectKey:s,value:u,styleSpec:Gt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ce&&fe(i.property.specification)&&("source"===i.value.kind||"composite"===i.value.kind)&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=iu(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const yh=Pt([{name:"a_pos",components:2,type:"Int16"}],4),p_=Pt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class is{constructor(e=[]){this.segments=e}prepareSegment(e,i,s,u){let f=this.segments[this.segments.length-1];return e>is.MAX_VERTEX_ARRAY_LENGTH&&xn(`Max vertices per segment is ${is.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>is.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:i.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==u&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,u){return new is([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}is.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,O(is,"SegmentVector");var Ai=8192;class Pl{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Qr?new Qr(e.lng,e.lat):Qr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Qr?new Qr(e.lng,e.lat):Qr.convert(e),this}extend(e){const i=this._sw,s=this._ne;let u,f;if(e instanceof Qr)u=e,f=e;else{if(!(e instanceof Pl))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Pl.convert(e)):this.extend(Qr.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Qr.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return i||s?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),s.lng=Math.max(f.lng,s.lng),s.lat=Math.max(f.lat,s.lat)):(this._sw=new Qr(u.lng,u.lat),this._ne=new Qr(f.lng,f.lat)),this}getCenter(){return new Qr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Qr(this.getWest(),this.getNorth())}getSouthEast(){return new Qr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=Qr.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&u}static convert(e){return!e||e instanceof Pl?e:new Pl(e)}}var vh=1e-6,Ba=typeof Float32Array<"u"?Float32Array:Array;function xh(){var n=new Ba(9);return Ba!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Dd(n,e,i){var s=e[0],u=e[1],f=e[2],g=e[3],y=e[4],w=e[5],E=e[6],k=e[7],z=e[8],U=i[0],Y=i[1],J=i[2],oe=i[3],_e=i[4],Pe=i[5],qe=i[6],Ae=i[7],He=i[8];return n[0]=U*s+Y*g+J*E,n[1]=U*u+Y*y+J*k,n[2]=U*f+Y*w+J*z,n[3]=oe*s+_e*g+Pe*E,n[4]=oe*u+_e*y+Pe*k,n[5]=oe*f+_e*w+Pe*z,n[6]=qe*s+Ae*g+He*E,n[7]=qe*u+Ae*y+He*k,n[8]=qe*f+Ae*w+He*z,n}function dl(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function zf(n,e){var i=e[0],s=e[1],u=e[2],f=e[3],g=e[4],y=e[5],w=e[6],E=e[7],k=e[8],z=e[9],U=e[10],Y=e[11],J=e[12],oe=e[13],_e=e[14],Pe=e[15],qe=i*y-s*g,Ae=i*w-u*g,He=i*E-f*g,tt=s*w-u*y,Je=s*E-f*y,Yt=u*E-f*w,zt=k*oe-z*J,dn=k*_e-U*J,On=k*Pe-Y*J,Xt=z*_e-U*oe,En=z*Pe-Y*oe,Dn=U*Pe-Y*_e,An=qe*Dn-Ae*En+He*Xt+tt*On-Je*dn+Yt*zt;return An?(n[0]=(y*Dn-w*En+E*Xt)*(An=1/An),n[1]=(u*En-s*Dn-f*Xt)*An,n[2]=(oe*Yt-_e*Je+Pe*tt)*An,n[3]=(U*Je-z*Yt-Y*tt)*An,n[4]=(w*On-g*Dn-E*dn)*An,n[5]=(i*Dn-u*On+f*dn)*An,n[6]=(_e*He-J*Yt-Pe*Ae)*An,n[7]=(k*Yt-U*He+Y*Ae)*An,n[8]=(g*En-y*On+E*zt)*An,n[9]=(s*On-i*En-f*zt)*An,n[10]=(J*Je-oe*He+Pe*qe)*An,n[11]=(z*He-k*Je-Y*qe)*An,n[12]=(y*dn-g*Xt-w*zt)*An,n[13]=(i*Xt-s*dn+u*zt)*An,n[14]=(oe*Ae-J*tt-_e*qe)*An,n[15]=(k*tt-z*Ae+U*qe)*An,n):null}function pu(n,e,i){var s=e[0],u=e[1],f=e[2],g=e[3],y=e[4],w=e[5],E=e[6],k=e[7],z=e[8],U=e[9],Y=e[10],J=e[11],oe=e[12],_e=e[13],Pe=e[14],qe=e[15],Ae=i[0],He=i[1],tt=i[2],Je=i[3];return n[0]=Ae*s+He*y+tt*z+Je*oe,n[1]=Ae*u+He*w+tt*U+Je*_e,n[2]=Ae*f+He*E+tt*Y+Je*Pe,n[3]=Ae*g+He*k+tt*J+Je*qe,n[4]=(Ae=i[4])*s+(He=i[5])*y+(tt=i[6])*z+(Je=i[7])*oe,n[5]=Ae*u+He*w+tt*U+Je*_e,n[6]=Ae*f+He*E+tt*Y+Je*Pe,n[7]=Ae*g+He*k+tt*J+Je*qe,n[8]=(Ae=i[8])*s+(He=i[9])*y+(tt=i[10])*z+(Je=i[11])*oe,n[9]=Ae*u+He*w+tt*U+Je*_e,n[10]=Ae*f+He*E+tt*Y+Je*Pe,n[11]=Ae*g+He*k+tt*J+Je*qe,n[12]=(Ae=i[12])*s+(He=i[13])*y+(tt=i[14])*z+(Je=i[15])*oe,n[13]=Ae*u+He*w+tt*U+Je*_e,n[14]=Ae*f+He*E+tt*Y+Je*Pe,n[15]=Ae*g+He*k+tt*J+Je*qe,n}function Hl(n,e,i){var s,u,f,g,y,w,E,k,z,U,Y,J,oe=i[0],_e=i[1],Pe=i[2];return e===n?(n[12]=e[0]*oe+e[4]*_e+e[8]*Pe+e[12],n[13]=e[1]*oe+e[5]*_e+e[9]*Pe+e[13],n[14]=e[2]*oe+e[6]*_e+e[10]*Pe+e[14],n[15]=e[3]*oe+e[7]*_e+e[11]*Pe+e[15]):(u=e[1],f=e[2],g=e[3],y=e[4],w=e[5],E=e[6],k=e[7],z=e[8],U=e[9],Y=e[10],J=e[11],n[0]=s=e[0],n[1]=u,n[2]=f,n[3]=g,n[4]=y,n[5]=w,n[6]=E,n[7]=k,n[8]=z,n[9]=U,n[10]=Y,n[11]=J,n[12]=s*oe+y*_e+z*Pe+e[12],n[13]=u*oe+w*_e+U*Pe+e[13],n[14]=f*oe+E*_e+Y*Pe+e[14],n[15]=g*oe+k*_e+J*Pe+e[15]),n}function Rl(n,e,i){var s=i[0],u=i[1],f=i[2];return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*f,n[9]=e[9]*f,n[10]=e[10]*f,n[11]=e[11]*f,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function $f(n,e,i){var s=Math.sin(i),u=Math.cos(i),f=e[4],g=e[5],y=e[6],w=e[7],E=e[8],k=e[9],z=e[10],U=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=f*u+E*s,n[5]=g*u+k*s,n[6]=y*u+z*s,n[7]=w*u+U*s,n[8]=E*u-f*s,n[9]=k*u-g*s,n[10]=z*u-y*s,n[11]=U*u-w*s,n}function Vf(n,e,i){var s=Math.sin(i),u=Math.cos(i),f=e[0],g=e[1],y=e[2],w=e[3],E=e[8],k=e[9],z=e[10],U=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u-E*s,n[1]=g*u-k*s,n[2]=y*u-z*s,n[3]=w*u-U*s,n[8]=f*s+E*u,n[9]=g*s+k*u,n[10]=y*s+z*u,n[11]=w*s+U*u,n}function Uf(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Cm(n,e,i){var s,u,f,g=i[0],y=i[1],w=i[2],E=Math.hypot(g,y,w);return E<vh?null:(g*=E=1/E,y*=E,w*=E,s=Math.sin(e),u=Math.cos(e),n[0]=g*g*(f=1-u)+u,n[1]=y*g*f+w*s,n[2]=w*g*f-y*s,n[3]=0,n[4]=g*y*f-w*s,n[5]=y*y*f+u,n[6]=w*y*f+g*s,n[7]=0,n[8]=g*w*f+y*s,n[9]=y*w*f-g*s,n[10]=w*w*f+u,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var mv=pu;function jf(){var n=new Ba(3);return Ba!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Tm(n){var e=new Ba(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Cd(n){return Math.hypot(n[0],n[1],n[2])}function lc(n,e,i){var s=new Ba(3);return s[0]=n,s[1]=e,s[2]=i,s}function Gl(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function Hf(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function Gf(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function bh(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function Lu(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function hl(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Td(n,e,i,s){return n[0]=e[0]+i[0]*s,n[1]=e[1]+i[1]*s,n[2]=e[2]+i[2]*s,n}function Ta(n,e){var i=e[0],s=e[1],u=e[2],f=i*i+s*s+u*u;return f>0&&(f=1/Math.sqrt(f)),n[0]=e[0]*f,n[1]=e[1]*f,n[2]=e[2]*f,n}function Wa(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Sm(n,e,i){var s=e[0],u=e[1],f=e[2],g=i[0],y=i[1],w=i[2];return n[0]=u*w-f*y,n[1]=f*g-s*w,n[2]=s*y-u*g,n}function Ss(n,e,i){var s=e[0],u=e[1],f=e[2],g=i[3]*s+i[7]*u+i[11]*f+i[15];return n[0]=(i[0]*s+i[4]*u+i[8]*f+i[12])/(g=g||1),n[1]=(i[1]*s+i[5]*u+i[9]*f+i[13])/g,n[2]=(i[2]*s+i[6]*u+i[10]*f+i[14])/g,n}function wh(n,e,i){var s=i[0],u=i[1],f=i[2],g=e[0],y=e[1],w=e[2],E=u*w-f*y,k=f*g-s*w,z=s*y-u*g,U=u*z-f*k,Y=f*E-s*z,J=s*k-u*E,oe=2*i[3];return k*=oe,z*=oe,Y*=2,J*=2,n[0]=g+(E*=oe)+(U*=2),n[1]=y+k+Y,n[2]=w+z+J,n}var Eh,Wl=Hf,gv=Gf,_v=Cd;function m_(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function Im(n,e){var i=e[0],s=e[1],u=e[2],f=e[3],g=i*i+s*s+u*u+f*f;return g>0&&(g=1/Math.sqrt(g)),n[0]=i*g,n[1]=s*g,n[2]=u*g,n[3]=f*g,n}function ql(n,e,i){var s=e[0],u=e[1],f=e[2],g=e[3];return n[0]=i[0]*s+i[4]*u+i[8]*f+i[12]*g,n[1]=i[1]*s+i[5]*u+i[9]*f+i[13]*g,n[2]=i[2]*s+i[6]*u+i[10]*f+i[14]*g,n[3]=i[3]*s+i[7]*u+i[11]*f+i[15]*g,n}function Sd(){var n=new Ba(4);return Ba!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Wf(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function qf(n,e,i){i*=.5;var s=e[0],u=e[1],f=e[2],g=e[3],y=Math.sin(i),w=Math.cos(i);return n[0]=s*w+g*y,n[1]=u*w+f*y,n[2]=f*w-u*y,n[3]=g*w-s*y,n}function Yf(n,e,i){i*=.5;var s=e[0],u=e[1],f=e[2],g=e[3],y=Math.sin(i),w=Math.cos(i);return n[0]=s*w-f*y,n[1]=u*w+g*y,n[2]=f*w+s*y,n[3]=g*w-u*y,n}jf(),Eh=new Ba(4),Ba!=Float32Array&&(Eh[0]=0,Eh[1]=0,Eh[2]=0,Eh[3]=0);var Fu=Im;jf(),lc(1,0,0),lc(0,1,0),Sd(),Sd(),xh();const Mm=Pt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Zf}=Mm,Id=Pt([{name:"a_pos_3",components:3,type:"Int16"}]);var Tc=Pt([{name:"a_pos",type:"Int16",components:2}]);class Bu{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const u=Wa(i,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/u;return s[0]=this.pos[0]+this.dir[0]*f,s[1]=this.pos[1]+this.dir[1]*f,s[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,i,s){if(oe=(Y=this.pos)[0],_e=Y[1],Pe=Y[2],qe=(J=e)[0],Ae=J[1],He=J[2],Math.abs(oe-qe)<=vh*Math.max(1,Math.abs(oe),Math.abs(qe))&&Math.abs(_e-Ae)<=vh*Math.max(1,Math.abs(_e),Math.abs(Ae))&&Math.abs(Pe-He)<=vh*Math.max(1,Math.abs(Pe),Math.abs(He))||0===i)return s[0]=s[1]=s[2]=0,!1;var Y,J,oe,_e,Pe,qe,Ae,He;const[u,f,g]=this.dir,y=this.pos[0]-e[0],w=this.pos[1]-e[1],E=this.pos[2]-e[2],k=u*u+f*f+g*g,z=2*(y*u+w*f+E*g),U=z*z-4*k*(y*y+w*w+E*E-i*i);if(U<0){const Y=Math.max(-z/2,0),J=y+u*Y,oe=w+f*Y,_e=E+g*Y,Pe=Math.hypot(J,oe,_e);return s[0]=J*i/Pe,s[1]=oe*i/Pe,s[2]=_e*i/Pe,!1}{const Y=(-z-Math.sqrt(U))/(2*k);if(Y<0){const J=Math.hypot(y,w,E);return s[0]=y*i/J,s[1]=w*i/J,s[2]=E*i/J,!1}return s[0]=y+u*Y,s[1]=w+f*Y,s[2]=E+g*Y,!0}}}class Xf{constructor(e,i,s,u,f){this.TL=e,this.TR=i,this.BR=s,this.BL=u,this.horizon=f}static fromInvProjectionMatrix(e,i,s){const u=[-1,1,1],f=[1,1,1],g=[1,-1,1],y=[-1,-1,1],w=Ss(u,u,e),E=Ss(f,f,e),k=Ss(g,g,e),z=Ss(y,y,e);return new Xf(w,E,k,z,i/s)}}class Kf{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,s,u){const f=Math.pow(2,s),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const E=ql([],w,e),k=1/E[3]/i*f;return(z=E)[0]=(U=E)[0]*(Y=[k,k,u?1/E[3]:k,k])[0],z[1]=U[1]*Y[1],z[2]=U[2]*Y[2],z[3]=U[3]*Y[3],z;var z,U,Y}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const E=Ta([],Sm([],Wl([],g[w[0]],g[w[1]]),Wl([],g[w[2]],g[w[1]]))),k=-Wa(E,g[w[1]]);return E.concat(k)});return new Kf(g,y)}}class Sa{static fromPoints(e){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const u of e)bh(i,i,u),Lu(s,s,u);return new Sa(i,s)}static applyTransform(e,i){const s=e.getCorners();for(let u=0;u<s.length;++u)Ss(s[u],s[u],i);return Sa.fromPoints(s)}constructor(e,i){this.min=e,this.max=i,this.center=hl([],Gl([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=Tm(this.min),u=Tm(this.max);for(let f=0;f<i.length;f++)s[f]=i[f]?this.min[f]:this.center[f],u[f]=i[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new Sa(s,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let s=!0;for(let u=0;u<e.planes.length;u++){const f=e.planes[u];let g=0;for(let y=0;y<i.length;y++)g+=Wa(f,i[y])+f[3]>=0;if(0===g)return 0;g!==i.length&&(s=!1)}if(s)return 2;for(let u=0;u<3;u++){let f=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){const w=e.points[y][u]-this.min[u];f=Math.min(f,w),g=Math.max(g,w)}if(g<0||f>this.max[u]-this.min[u])return 0}return 1}}const Dh=5,Ch=6,Yl=Ai/Math.PI/2,g_=16383,Nu=[64,32,16],fl=-Yl,pl=Yl,qa=[new Sa([fl,fl,fl],[pl,pl,pl]),new Sa([fl,fl,fl],[0,0,pl]),new Sa([0,fl,fl],[pl,0,pl]),new Sa([fl,0,fl],[0,pl,pl]),new Sa([0,0,fl],[pl,pl,pl])];function zu(n){return n*Yl/Ic}function Jf(n,e,i,s=!0){const u=hl([],n._camera.position,n.worldSize),f=[e,i,1,1];ql(f,f,n.pixelMatrixInverse),m_(f,f,1/f[3]);const g=Ta([],Wl([],f,u)),y=n.globeMatrix,w=[y[12],y[13],y[14]],E=Wl([],w,u),k=Cd(E),z=Ta([],E),U=n.worldSize/(2*Math.PI),Y=Wa(z,g),J=Math.asin(U/k);if(J<Math.acos(Y)){if(!s)return null;const On=[],Xt=[];hl(On,g,k/Y),Ta(Xt,Wl(Xt,On,E)),Ta(g,Gl(g,E,hl(g,Xt,Math.tan(J)*k)))}const oe=[];new Bu(u,g).closestPointOnSphere(w,U,oe);const _e=Ta([],lr(y,0)),Pe=Ta([],lr(y,1)),qe=Ta([],lr(y,2)),Ae=Wa(_e,oe),He=Wa(Pe,oe),tt=Wa(qe,oe),Je=dt(Math.asin(-He/U));let Yt=dt(Math.atan2(Ae,tt));Yt=n.center.lng+function(On,Xt){const En=(Xt-On+180)%360-180;return En<-180?En+360:En}(n.center.lng,Yt);const zt=Xl(Yt),dn=Vt(Kl(Je),0,1);return new Mc(zt,dn)}class Qf{constructor(e,i,s){this.a=Wl([],e,s),this.b=Wl([],i,s),this.center=s;const u=Ta([],this.a),f=Ta([],this.b);this.angle=Math.acos(Wa(u,f))}}function ma(n,e){if(0===n.angle)return null;let i;return i=0===n.a[e]?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(s,u,f,g){const y=Math.sin(f);return s*(Math.sin((1-g)*f)/y)+u*(Math.sin(g*f)/y)}(n.a[e],n.b[e],n.angle,Vt(i,0,1))+n.center[e]}function Ya(n){if(n.z<=1)return qa[n.z+2*n.y+n.x];const e=Sh(Th(n));return Sa.fromPoints(e)}function Sc(n,e,i){return hl(n,n,1-i),Td(n,n,e,i)}function ep(n,e){const i=Uu(e.zoom);if(0===i)return Ya(n);const s=Th(n),u=Sh(s),f=Xl(s.getWest())*e.worldSize,g=Xl(s.getEast())*e.worldSize,y=Kl(s.getNorth())*e.worldSize,w=Kl(s.getSouth())*e.worldSize,E=[f,y,0],k=[g,y,0],z=[f,w,0],U=[g,w,0],Y=zf([],e.globeMatrix);return Ss(E,E,Y),Ss(k,k,Y),Ss(z,z,Y),Ss(U,U,Y),u[0]=Sc(u[0],z,i),u[1]=Sc(u[1],U,i),u[2]=Sc(u[2],k,i),u[3]=Sc(u[3],E,i),Sa.fromPoints(u)}function Am(n,e,i){for(const s of n)Ss(s,s,e),hl(s,s,i)}function Th({x:n,y:e,z:i}){const s=1/(1<<i),u=new Qr(rl(n*s),ga((e+1)*s)),f=new Qr(rl((n+1)*s),ga(e*s));return new Pl(u,f)}function Sh(n){const e=De(n.getNorth()),i=De(n.getSouth()),s=Math.cos(e),u=Math.cos(i),f=Math.sin(e),g=Math.sin(i),y=n.getWest(),w=n.getEast();return[$u(u,g,y),$u(u,g,w),$u(s,f,w),$u(s,f,y)]}function $u(n,e,i,s=Yl){return i=De(i),[n*Math.sin(i)*s,-e*s,n*Math.cos(i)*s]}function gu(n,e,i){return $u(Math.cos(De(n)),Math.sin(De(n)),e,i)}function Md(n,e,i,s){const u=1<<i.z,f=(n/Ai+i.x)/u;return gu(ga((e/Ai+i.y)/u),rl(f),s)}function Ih({min:n,max:e}){return g_/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const Mh=new Float64Array(16);function _u(n){const e=Ih(n),i=Uf(Mh,[e,e,e]);return Hl(i,i,((s=[])[0]=-(u=n.min)[0],s[1]=-u[1],s[2]=-u[2],s));var s,u}function tp(n){const e=(s=n.min,(i=Mh)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i);var i,s;const u=1/Ih(n);return Rl(e,e,[u,u,u])}function Vu(n,e,i,s,u){const f=function(w){const E=Ai/(2*Math.PI);return w/(2*Math.PI)/E}(i),g=[n,e,-i/(2*Math.PI)],y=dl(new Float64Array(16));return Hl(y,y,g),Rl(y,y,[f,f,f]),$f(y,y,De(-u)),Vf(y,y,De(-s)),y}function Uu(n){return Jn(Dh,Ch,n)}function Rm(n,e){const i=gu(e.lat,e.lng);return g=(u=Hf([],function(J){const oe=gu(J._center.lat,J._center.lng);let _e=Sm([],lc(0,1,0),oe);const Pe=Cm([],-J.angle,oe);_e=Ss(_e,_e,Pe),Cm(Pe,-J._pitch,_e);const qe=Ta([],oe);return hl(qe,qe,zu(J.cameraToCenterDistance/J.pixelsPerMeter)),Ss(qe,qe,Pe),Gl([],oe,qe)}(n),i))[0],y=u[1],w=u[2],E=(f=i)[0],k=f[1],z=f[2],Y=(U=Math.sqrt(g*g+y*y+w*w)*Math.sqrt(E*E+k*k+z*z))&&Wa(u,f)/U,Math.acos(Math.min(Math.max(Y,-1),1));var u,f,g,y,w,E,k,z,U,Y}function Ah(n,e){return Rm(n,e)>Math.PI/2*1.01}const np=De(85),Om=Math.cos(np),ju=Math.sin(np),Ic=6371008.8,ip=2*Math.PI*Ic;class Zl{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Zl(Ht(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,u=e.lat*i,f=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return Ic*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new Pl(new Zl(this.lng-s,this.lat-i),new Zl(this.lng+s,this.lat+i))}toEcef(e){const i=zu(e);return gu(this.lat,this.lng,Yl+i)}static convert(e){if(e instanceof Zl)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Zl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Zl(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Qr=Zl;function rp(n){return ip*Math.cos(n*Math.PI/180)}function Xl(n){return(180+n)/360}function Kl(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Ol(n,e){return n/rp(e)}function rl(n){return 360*n-180}function ga(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function op(n,e){return n*rp(ga(e))}const Ws=85.051129;function Ph(n){return 1/Math.cos(n*Math.PI/180)}class Mc{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=Qr.convert(e);return new Mc(Xl(s.lng),Kl(s.lat),Ol(i,s.lat))}toLngLat(){return new Qr(rl(this.x),ga(this.y))}toAltitude(){return op(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ip*Ph(ga(this.y))}}function sp(n,e,i,s,u,f,g,y,w){const E=(e+s)/2,k=(i+u)/2,z=new Fe(E,k);y(z),function(U,Y,J,oe,_e,Pe){const qe=J-_e,Ae=oe-Pe;return Math.abs((oe-Y)*qe-(J-U)*Ae)/Math.hypot(qe,Ae)}(z.x,z.y,f.x,f.y,g.x,g.y)>=w?(sp(n,e,i,E,k,f,z,y,w),sp(n,E,k,s,u,z,g,y,w)):n.push(g)}function km(n,e,i){let s=n[0],u=s.x,f=s.y;e(s);const g=[s];for(let y=1;y<n.length;y++){const w=n[y],{x:E,y:k}=w;e(w),sp(g,u,f,E,k,s,w,e,i),u=E,f=k,s=w}return g}function Ad(n,e,i,s){if(s(e,i)){const u=e.add(i)._mult(.5);Ad(n,e,u,s),Ad(n,u,i,s)}else n.push(i)}function Lm(n,e){let i=n[0];const s=[i];for(let u=1;u<n.length;u++){const f=n[u];Ad(s,i,f,e),i=f}return s}const cc=Math.pow(2,14)-1,ap=-cc-1;function Fm(n,e){const i=Math.round(n.x*e),s=Math.round(n.y*e);return n.x=Vt(i,ap,cc),n.y=Vt(s,ap,cc),(i<n.x||i>n.x+1||s<n.y||s>n.y+1)&&xn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function uc(n,e,i){const s=n.loadGeometry(),u=n.extent,f=Ai/u;if(e&&i&&i.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:y,x:w,y:E,projection:k}=i,z=U=>{const Y=rl((e.x+U.x/u)/g),J=ga((e.y+U.y/u)/g),oe=k.project(Y,J);U.x=(oe.x*y-w)*u,U.y=(oe.y*y-E)*u};for(let U=0;U<s.length;U++)if(1!==n.type)s[U]=km(s[U],z,1);else{const Y=[];for(const J of s[U])J.x<0||J.x>=u||J.y<0||J.y>=u||(z(J),Y.push(J));s[U]=Y}}for(const g of s)for(const y of g)Fm(y,f);return s}function Hu(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?uc(n):[]}}function yu(n,e,i,s,u){n.emplaceBack(2*e+(s+1)/2,2*i+(u+1)/2)}function Rh(n,e,i){n.emplaceBack(e.x,e.y,e.z,16384*i[0],16384*i[1],16384*i[2])}class Oh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Fn,this.indexArray=new mi,this.segments=new is,this.programConfigurations=new Cc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,u){const f=this.layers[0],g=[];let y=null;"circle"===f.type&&(y=f.layout.get("circle-sort-key"));for(const{feature:E,id:k,index:z,sourceLayerIndex:U}of e){const Y=this.layers[0]._featureFilter.needGeometry,J=Hu(E,Y);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),J,s))continue;const oe=y?y.evaluate(J,{},s):void 0,_e={id:k,properties:E.properties,type:E.type,sourceLayerIndex:U,index:z,geometry:Y?J.geometry:uc(E,s,u),patterns:{},sortKey:oe};g.push(_e)}y&&g.sort((E,k)=>E.sortKey-k.sortKey);let w=null;"globe"===u.projection.name&&(this.globeExtVertexArray=new kn,w=u.projection);for(const E of g){const{geometry:k,index:z,sourceLayerIndex:U}=E,Y=e[z].feature;this.addFeature(E,k,z,i.availableImages,s,w),i.featureIndex.insert(Y,k,z,U,this.index)}}update(e,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,p_.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,s,u,f,g){for(const y of i)for(const w of y){const E=w.x,k=w.y;if(E<0||E>=Ai||k<0||k>=Ai)continue;if(g){const Y=g.projectTilePoint(E,k,f),J=g.upVector(f,E,k),oe=this.globeExtVertexArray;Rh(oe,Y,J),Rh(oe,Y,J),Rh(oe,Y,J),Rh(oe,Y,J)}const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),U=z.vertexLength;yu(this.layoutVertexArray,E,k,-1,-1),yu(this.layoutVertexArray,E,k,1,-1),yu(this.layoutVertexArray,E,k,1,1),yu(this.layoutVertexArray,E,k,-1,1),this.indexArray.emplaceBack(U,U+1,U+2),this.indexArray.emplaceBack(U,U+2,U+3),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},u,f)}}function lp(n,e){for(let i=0;i<n.length;i++)if(Ac(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Ac(n,e[i]))return!0;return!!Gu(n,e)}function Bm(n,e,i){return!!Ac(n,e)||!!Lh(e,n,i)}function kh(n,e){if(1===n.length)return Rd(e,n[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let u=0;u<s.length;u++)if(Ac(n,s[u]))return!0}for(let i=0;i<n.length;i++)if(Rd(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Gu(n,e[i]))return!0;return!1}function Nm(n,e,i){if(n.length>1){if(Gu(n,e))return!0;for(let s=0;s<e.length;s++)if(Lh(e[s],n,i))return!0}for(let s=0;s<n.length;s++)if(Lh(n[s],e,i))return!0;return!1}function Gu(n,e){if(0===n.length||0===e.length)return!1;for(let i=0;i<n.length-1;i++){const s=n[i],u=n[i+1];for(let f=0;f<e.length-1;f++)if(Pd(s,u,e[f],e[f+1]))return!0}return!1}function Pd(n,e,i,s){return Hn(n,i,s)!==Hn(e,i,s)&&Hn(n,e,i)!==Hn(n,e,s)}function Lh(n,e,i){const s=i*i;if(1===e.length)return n.distSqr(e[0])<s;for(let u=1;u<e.length;u++)if(Fh(n,e[u-1],e[u])<s)return!0;return!1}function Fh(n,e,i){const s=e.distSqr(i);if(0===s)return n.distSqr(e);const u=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/s;return n.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function Rd(n,e){let i,s,u,f=!1;for(let g=0;g<n.length;g++){i=n[g];for(let y=0,w=i.length-1;y<i.length;w=y++)s=i[y],u=i[w],s.y>e.y!=u.y>e.y&&e.x<(u.x-s.x)*(e.y-s.y)/(u.y-s.y)+s.x&&(f=!f)}return f}function Ac(n,e){let i=!1;for(let s=0,u=n.length-1;s<n.length;u=s++){const f=n[s],g=n[u];f.y>e.y!=g.y>e.y&&e.x<(g.x-f.x)*(e.y-f.y)/(g.y-f.y)+f.x&&(i=!i)}return i}function Bh(n,e,i,s,u){for(const g of n)if(e<=g.x&&i<=g.y&&s>=g.x&&u>=g.y)return!0;const f=[new Fe(e,i),new Fe(e,u),new Fe(s,u),new Fe(s,i)];if(n.length>2)for(const g of f)if(Ac(n,g))return!0;for(let g=0;g<n.length-1;g++)if(Od(n[g],n[g+1],f))return!0;return!1}function Od(n,e,i){const s=i[0],u=i[2];if(n.x<s.x&&e.x<s.x||n.x>u.x&&e.x>u.x||n.y<s.y&&e.y<s.y||n.y>u.y&&e.y>u.y)return!1;const f=Hn(n,e,i[0]);return f!==Hn(n,e,i[1])||f!==Hn(n,e,i[2])||f!==Hn(n,e,i[3])}function Wu(n,e,i){const s=e.paint.get(n).value;return"constant"===s.kind?s.value:i.programConfigurations.get(e.id).getMaxValue(n)}function kd(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function zm(n,e,i,s,u){if(!e[0]&&!e[1])return n;const f=Fe.convert(e)._mult(u);"viewport"===i&&f._rotate(-s);const g=[];for(let y=0;y<n.length;y++)g.push(n[y].sub(f));return g}function $m(n,e,i,s){const u=Fe.convert(n)._mult(s);return"viewport"===e&&u._rotate(-i),u}O(Oh,"CircleBucket",{omit:["layers"]});const __=new $e({"circle-sort-key":new we(Gt.layout_circle["circle-sort-key"])});var Vm={paint:new $e({"circle-radius":new we(Gt.paint_circle["circle-radius"]),"circle-color":new we(Gt.paint_circle["circle-color"]),"circle-blur":new we(Gt.paint_circle["circle-blur"]),"circle-opacity":new we(Gt.paint_circle["circle-opacity"]),"circle-translate":new re(Gt.paint_circle["circle-translate"]),"circle-translate-anchor":new re(Gt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new re(Gt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new re(Gt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new we(Gt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new we(Gt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new we(Gt.paint_circle["circle-stroke-opacity"])}),layout:__};function cp(n,e,i,s,u,f,g,y,w){if(f&&n.queryGeometry.isAboveHorizon)return!1;f&&(w*=n.pixelToTileUnitsFactor);const E=n.tileID.canonical,k=i.projection.upVectorScale(E,i.center.lat,i.worldSize).metersToTile;for(const z of e)for(const U of z){const Y=U.add(y),J=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(Y.x,Y.y,!0):0,oe=i.projection.projectTilePoint(Y.x,Y.y,E);if(J>0){const Ae=i.projection.upVector(E,Y.x,Y.y);oe.x+=Ae[0]*k*J,oe.y+=Ae[1]*k*J,oe.z+=Ae[2]*k*J}const _e=f?Y:Nh(oe.x,oe.y,oe.z,s),Pe=f?n.tilespaceRays.map(Ae=>y_(Ae,J)):n.queryGeometry.screenGeometry,qe=ql([],[oe.x,oe.y,oe.z,1],s);if(!g&&f?w*=qe[3]/i.cameraToCenterDistance:g&&!f&&(w*=i.cameraToCenterDistance/qe[3]),f){const Ae=ga((U.y/Ai+E.y)/(1<<E.z));w/=i.projection.pixelsPerMeter(Ae,1)/Ol(1,Ae)}if(Bm(Pe,_e,w))return!0}return!1}function Nh(n,e,i,s){const u=ql([],[n,e,i,1],s);return new Fe(u[0]/u[3],u[1]/u[3])}const zh=lc(0,0,0),qu=lc(0,0,1);function y_(n,e){const i=jf();return zh[2]=e,n.intersectsPlane(zh,qu,i),new Fe(i[0],i[1])}class Um extends Oh{}function v_(n,{width:e,height:i},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*s)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*s);return n.width=e,n.height=i,n.data=u,n}function jm(n,e,i){const{width:s,height:u}=e;s===n.width&&u===n.height||(Ld(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,s),height:Math.min(n.height,u)},i),n.width=s,n.height=u,n.data=e.data)}function Ld(n,e,i,s,u,f){if(0===u.width||0===u.height)return e;if(u.width>n.width||u.height>n.height||i.x>n.width-u.width||i.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||s.x>e.width-u.width||s.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const g=n.data,y=e.data;for(let w=0;w<u.height;w++){const E=((i.y+w)*n.width+i.x)*f,k=((s.y+w)*e.width+s.x)*f;for(let z=0;z<u.width*f;z++)y[k+z]=g[E+z]}return e}O(Um,"HeatmapBucket",{omit:["layers"]});class dc{constructor(e,i){v_(this,e,1,i)}resize(e){jm(this,new dc(e),1)}clone(){return new dc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,u,f){Ld(e,i,s,u,f,1)}}class la{constructor(e,i){v_(this,e,4,i)}resize(e){jm(this,new la(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new la({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,u,f){Ld(e,i,s,u,f,4)}}O(dc,"AlphaImage"),O(la,"RGBAImage");var $h={paint:new $e({"heatmap-radius":new we(Gt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new we(Gt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new re(Gt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ze(Gt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new re(Gt.paint_heatmap["heatmap-opacity"])})};function Fd(n){const e={},i=n.resolution||256,s=n.clips?n.clips.length:1,u=n.image||new la({width:i,height:s}),f=(g,y,w)=>{e[n.evaluationKey]=w;const E=n.expression.evaluate(e);u.data[g+y+0]=Math.floor(255*E.r/E.a),u.data[g+y+1]=Math.floor(255*E.g/E.a),u.data[g+y+2]=Math.floor(255*E.b/E.a),u.data[g+y+3]=Math.floor(255*E.a)};if(n.clips)for(let g=0,y=0;g<s;++g,y+=4*i)for(let w=0,E=0;w<i;w++,E+=4){const k=w/(i-1),{start:z,end:U}=n.clips[g];f(y,E,z*(1-k)+U*k)}else for(let g=0,y=0;g<i;g++,y+=4)f(0,y,g/(i-1));return u}var Hm={paint:new $e({"hillshade-illumination-direction":new re(Gt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new re(Gt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new re(Gt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new re(Gt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new re(Gt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new re(Gt.paint_hillshade["hillshade-accent-color"])})};const Gm=Pt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Wm}=Gm;var Vh={exports:{}};function Uh(n,e,i){i=i||2;var s,u,f,g,y,w,E,k=e&&e.length,z=k?e[0]*i:n.length,U=qm(n,0,z,i,!0),Y=[];if(!U||U.next===U.prev)return Y;if(k&&(U=function(oe,_e,Pe,qe){var Ae,He,tt,Je=[];for(Ae=0,He=_e.length;Ae<He;Ae++)(tt=qm(oe,_e[Ae]*qe,Ae<He-1?_e[Ae+1]*qe:oe.length,qe,!1))===tt.next&&(tt.steiner=!0),Je.push(bv(tt));for(Je.sort(yv),Ae=0;Ae<Je.length;Ae++)Pe=vv(Je[Ae],Pe);return Pe}(n,e,U,i)),n.length>80*i){s=f=n[0],u=g=n[1];for(var J=i;J<z;J+=i)(y=n[J])<s&&(s=y),(w=n[J+1])<u&&(u=w),y>f&&(f=y),w>g&&(g=w);E=0!==(E=Math.max(f-s,g-u))?32767/E:0}return Bd(U,Y,i,s,u,E,0),Y}function qm(n,e,i,s,u){var f,g;if(u===Km(n,e,i,s)>0)for(f=e;f<i;f+=s)g=dp(f,n[f],n[f+1],g);else for(f=i-s;f>=e;f-=s)g=dp(f,n[f],n[f+1],g);return g&&jh(g,g.next)&&(Zu(g),g=g.next),g}function vu(n,e){if(!n)return n;e||(e=n);var i,s=n;do{if(i=!1,s.steiner||!jh(s,s.next)&&0!==Is(s.prev,s,s.next))s=s.next;else{if(Zu(s),(s=e=s.prev)===s.next)break;i=!0}}while(i||s!==e);return e}function Bd(n,e,i,s,u,f,g){if(n){!g&&f&&function(k,z,U,Y){var J=k;do{0===J.z&&(J.z=Ym(J.x,J.y,z,U,Y)),J.prevZ=J.prev,J.nextZ=J.next,J=J.next}while(J!==k);J.prevZ.nextZ=null,J.prevZ=null,function(oe){var _e,Pe,qe,Ae,He,tt,Je,Yt,zt=1;do{for(Pe=oe,oe=null,He=null,tt=0;Pe;){for(tt++,qe=Pe,Je=0,_e=0;_e<zt&&(Je++,qe=qe.nextZ);_e++);for(Yt=zt;Je>0||Yt>0&&qe;)0!==Je&&(0===Yt||!qe||Pe.z<=qe.z)?(Ae=Pe,Pe=Pe.nextZ,Je--):(Ae=qe,qe=qe.nextZ,Yt--),He?He.nextZ=Ae:oe=Ae,Ae.prevZ=He,He=Ae;Pe=qe}He.nextZ=null,zt*=2}while(tt>1)}(J)}(n,s,u,f);for(var y,w,E=n;n.prev!==n.next;)if(y=n.prev,w=n.next,f?Pc(n,s,u,f):x_(n))e.push(y.i/i|0),e.push(n.i/i|0),e.push(w.i/i|0),Zu(n),n=w.next,E=w.next;else if((n=w)===E){g?1===g?Bd(n=Nd(vu(n),e,i),e,i,s,u,f,2):2===g&&b_(n,e,i,s,u,f):Bd(vu(n),e,i,s,u,f,1);break}}}function x_(n){var e=n.prev,i=n,s=n.next;if(Is(e,i,s)>=0)return!1;for(var u=e.x,f=i.x,g=s.x,y=e.y,w=i.y,E=s.y,k=u<f?u<g?u:g:f<g?f:g,z=y<w?y<E?y:E:w<E?w:E,U=u>f?u>g?u:g:f>g?f:g,Y=y>w?y>E?y:E:w>E?w:E,J=s.next;J!==e;){if(J.x>=k&&J.x<=U&&J.y>=z&&J.y<=Y&&xu(u,y,f,w,g,E,J.x,J.y)&&Is(J.prev,J,J.next)>=0)return!1;J=J.next}return!0}function Pc(n,e,i,s){var u=n.prev,f=n,g=n.next;if(Is(u,f,g)>=0)return!1;for(var y=u.x,w=f.x,E=g.x,k=u.y,z=f.y,U=g.y,Y=y<w?y<E?y:E:w<E?w:E,J=k<z?k<U?k:U:z<U?z:U,oe=y>w?y>E?y:E:w>E?w:E,_e=k>z?k>U?k:U:z>U?z:U,Pe=Ym(Y,J,e,i,s),qe=Ym(oe,_e,e,i,s),Ae=n.prevZ,He=n.nextZ;Ae&&Ae.z>=Pe&&He&&He.z<=qe;){if(Ae.x>=Y&&Ae.x<=oe&&Ae.y>=J&&Ae.y<=_e&&Ae!==u&&Ae!==g&&xu(y,k,w,z,E,U,Ae.x,Ae.y)&&Is(Ae.prev,Ae,Ae.next)>=0||(Ae=Ae.prevZ,He.x>=Y&&He.x<=oe&&He.y>=J&&He.y<=_e&&He!==u&&He!==g&&xu(y,k,w,z,E,U,He.x,He.y)&&Is(He.prev,He,He.next)>=0))return!1;He=He.nextZ}for(;Ae&&Ae.z>=Pe;){if(Ae.x>=Y&&Ae.x<=oe&&Ae.y>=J&&Ae.y<=_e&&Ae!==u&&Ae!==g&&xu(y,k,w,z,E,U,Ae.x,Ae.y)&&Is(Ae.prev,Ae,Ae.next)>=0)return!1;Ae=Ae.prevZ}for(;He&&He.z<=qe;){if(He.x>=Y&&He.x<=oe&&He.y>=J&&He.y<=_e&&He!==u&&He!==g&&xu(y,k,w,z,E,U,He.x,He.y)&&Is(He.prev,He,He.next)>=0)return!1;He=He.nextZ}return!0}function Nd(n,e,i){var s=n;do{var u=s.prev,f=s.next.next;!jh(u,f)&&Zm(u,s,s.next,f)&&hc(u,f)&&hc(f,u)&&(e.push(u.i/i|0),e.push(s.i/i|0),e.push(f.i/i|0),Zu(s),Zu(s.next),s=n=f),s=s.next}while(s!==n);return vu(s)}function b_(n,e,i,s,u,f){var g=n;do{for(var y=g.next.next;y!==g.prev;){if(g.i!==y.i&&w_(g,y)){var w=up(g,y);return g=vu(g,g.next),w=vu(w,w.next),Bd(g,e,i,s,u,f,0),void Bd(w,e,i,s,u,f,0)}y=y.next}g=g.next}while(g!==n)}function yv(n,e){return n.x-e.x}function vv(n,e){var i=function(u,f){var g,y=f,w=u.x,E=u.y,k=-1/0;do{if(E<=y.y&&E>=y.next.y&&y.next.y!==y.y){var z=y.x+(E-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(z<=w&&z>k&&(k=z,g=y.x<y.next.x?y:y.next,z===w))return g}y=y.next}while(y!==f);if(!g)return null;var U,Y=g,J=g.x,oe=g.y,_e=1/0;y=g;do{w>=y.x&&y.x>=J&&w!==y.x&&xu(E<oe?w:k,E,J,oe,E<oe?k:w,E,y.x,y.y)&&(U=Math.abs(E-y.y)/(w-y.x),hc(y,u)&&(U<_e||U===_e&&(y.x>g.x||y.x===g.x&&xv(g,y)))&&(g=y,_e=U)),y=y.next}while(y!==Y);return g}(n,e);if(!i)return e;var s=up(i,n);return vu(s,s.next),vu(i,i.next)}function xv(n,e){return Is(n.prev,n,e.prev)<0&&Is(e.next,n,n.next)<0}function Ym(n,e,i,s,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*u|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function bv(n){var e=n,i=n;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==n);return i}function xu(n,e,i,s,u,f,g,y){return(u-g)*(e-y)>=(n-g)*(f-y)&&(n-g)*(s-y)>=(i-g)*(e-y)&&(i-g)*(f-y)>=(u-g)*(s-y)}function w_(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,s){var u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==s.i&&u.next.i!==s.i&&Zm(u,u.next,i,s))return!0;u=u.next}while(u!==i);return!1}(n,e)&&(hc(n,e)&&hc(e,n)&&function(i,s){var u=i,f=!1,g=(i.x+s.x)/2,y=(i.y+s.y)/2;do{u.y>y!=u.next.y>y&&u.next.y!==u.y&&g<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next}while(u!==i);return f}(n,e)&&(Is(n.prev,n,e.prev)||Is(n,e.prev,e))||jh(n,e)&&Is(n.prev,n,n.next)>0&&Is(e.prev,e,e.next)>0)}function Is(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function jh(n,e){return n.x===e.x&&n.y===e.y}function Zm(n,e,i,s){var u=ml(Is(n,e,i)),f=ml(Is(n,e,s)),g=ml(Is(i,s,n)),y=ml(Is(i,s,e));return u!==f&&g!==y||!(0!==u||!Yu(n,i,e))||!(0!==f||!Yu(n,s,e))||!(0!==g||!Yu(i,n,s))||!(0!==y||!Yu(i,e,s))}function Yu(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function ml(n){return n>0?1:n<0?-1:0}function hc(n,e){return Is(n.prev,n,n.next)<0?Is(n,e,n.next)>=0&&Is(n,n.prev,e)>=0:Is(n,e,n.prev)<0||Is(n,n.next,e)<0}function up(n,e){var i=new Xm(n.i,n.x,n.y),s=new Xm(e.i,e.x,e.y),u=n.next,f=e.prev;return n.next=e,e.prev=n,i.next=u,u.prev=i,s.next=i,i.prev=s,f.next=s,s.prev=f,s}function dp(n,e,i,s){var u=new Xm(n,e,i);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function Zu(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Xm(n,e,i){this.i=n,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Km(n,e,i,s){for(var u=0,f=e,g=i-s;f<i;f+=s)u+=(n[g]-n[f])*(n[f+1]+n[g+1]),g=f;return u}Vh.exports=Uh,Vh.exports.default=Uh,Uh.deviation=function(n,e,i,s){var u=e&&e.length,f=Math.abs(Km(n,0,u?e[0]*i:n.length,i));if(u)for(var g=0,y=e.length;g<y;g++)f-=Math.abs(Km(n,e[g]*i,g<y-1?e[g+1]*i:n.length,i));var w=0;for(g=0;g<s.length;g+=3){var E=s[g]*i,k=s[g+1]*i,z=s[g+2]*i;w+=Math.abs((n[E]-n[z])*(n[k+1]-n[E+1])-(n[E]-n[k])*(n[z+1]-n[E+1]))}return 0===f&&0===w?0:Math.abs((w-f)/f)},Uh.flatten=function(n){for(var e=n[0][0].length,i={vertices:[],holes:[],dimensions:e},s=0,u=0;u<n.length;u++){for(var f=0;f<n[u].length;f++)for(var g=0;g<e;g++)i.vertices.push(n[u][f][g]);u>0&&i.holes.push(s+=n[u-1].length)}return i};var Jm=Wt(Vh.exports);function hp(n,e,i,s,u){Hh(n,e,i||0,s||n.length-1,u||wv)}function Hh(n,e,i,s,u){for(;s>i;){if(s-i>600){var f=s-i+1,g=e-i+1,y=Math.log(f),w=.5*Math.exp(2*y/3),E=.5*Math.sqrt(y*w*(f-w)/f)*(g-f/2<0?-1:1);Hh(n,e,Math.max(i,Math.floor(e-g*w/f+E)),Math.min(s,Math.floor(e+(f-g)*w/f+E)),u)}var k=n[e],z=i,U=s;for(Gh(n,i,e),u(n[s],k)>0&&Gh(n,i,s);z<U;){for(Gh(n,z,U),z++,U--;u(n[z],k)<0;)z++;for(;u(n[U],k)>0;)U--}0===u(n[i],k)?Gh(n,i,U):Gh(n,++U,s),U<=e&&(i=U+1),e<=U&&(s=U-1)}}function Gh(n,e,i){var s=n[e];n[e]=n[i],n[i]=s}function wv(n,e){return n<e?-1:n>e?1:0}function Wh(n,e){const i=n.length;if(i<=1)return[n];const s=[];let u,f;for(let g=0;g<i;g++){const y=yi(n[g]);0!==y&&(n[g].area=Math.abs(y),void 0===f&&(f=y<0),f===y<0?(u&&s.push(u),u=[n[g]]):u.push(n[g]))}if(u&&s.push(u),e>1)for(let g=0;g<s.length;g++)s[g].length<=e||(hp(s[g],e,1,s[g].length-1,E_),s[g]=s[g].slice(0,e));return s}function E_(n,e){return e.area-n.area}function fp(n,e,i){const s=i.patternDependencies;let u=!1;for(const f of e){const g=f.paint.get(`${n}-pattern`);g.isConstant()||(u=!0);const y=g.constantOr(null);y&&(u=!0,s[y]=!0)}return u}function pp(n,e,i,s,u){const f=u.patternDependencies;for(const g of e){const y=g.paint.get(`${n}-pattern`).value;if("constant"!==y.kind){let w=y.evaluate({zoom:s},i,{},u.availableImages);w=w&&w.name?w.name:w,f[w]=!0,i.patterns[g.id]=w}}return i}class qh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Fn,this.indexArray=new mi,this.indexArray2=new io,this.programConfigurations=new Cc(e.layers,e.zoom),this.segments=new is,this.segments2=new is,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,s,u){this.hasPattern=fp("fill",this.layers,i);const f=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:y,id:w,index:E,sourceLayerIndex:k}of e){const z=this.layers[0]._featureFilter.needGeometry,U=Hu(y,z);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),U,s))continue;const Y=f?f.evaluate(U,{},s,i.availableImages):void 0,J={id:w,properties:y.properties,type:y.type,sourceLayerIndex:k,index:E,geometry:z?U.geometry:uc(y,s,u),patterns:{},sortKey:Y};g.push(J)}f&&g.sort((y,w)=>y.sortKey-w.sortKey);for(const y of g){const{geometry:w,index:E,sourceLayerIndex:k}=y;if(this.hasPattern){const z=pp("fill",this.layers,y,this.zoom,i);this.patternFeatures.push(z)}else this.addFeature(y,w,E,s,{},i.availableImages);i.featureIndex.insert(e[E].feature,w,E,k,this.index)}}update(e,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,u)}addFeatures(e,i,s,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,s,u,f,g=[]){for(const y of Wh(i,500)){let w=0;for(const J of y)w+=J.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),k=E.vertexLength,z=[],U=[];for(const J of y){if(0===J.length)continue;J!==y[0]&&U.push(z.length/2);const oe=this.segments2.prepareSegment(J.length,this.layoutVertexArray,this.indexArray2),_e=oe.vertexLength;this.layoutVertexArray.emplaceBack(J[0].x,J[0].y),this.indexArray2.emplaceBack(_e+J.length-1,_e),z.push(J[0].x),z.push(J[0].y);for(let Pe=1;Pe<J.length;Pe++)this.layoutVertexArray.emplaceBack(J[Pe].x,J[Pe].y),this.indexArray2.emplaceBack(_e+Pe-1,_e+Pe),z.push(J[Pe].x),z.push(J[Pe].y);oe.vertexLength+=J.length,oe.primitiveLength+=J.length}const Y=Jm(z,U);for(let J=0;J<Y.length;J+=3)this.indexArray.emplaceBack(k+Y[J],k+Y[J+1],k+Y[J+2]);E.vertexLength+=w,E.primitiveLength+=Y.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,g,u)}}O(qh,"FillBucket",{omit:["layers","patternFeatures"]});const Qm=new $e({"fill-sort-key":new we(Gt.layout_fill["fill-sort-key"])});var Yh={paint:new $e({"fill-antialias":new re(Gt.paint_fill["fill-antialias"]),"fill-opacity":new we(Gt.paint_fill["fill-opacity"]),"fill-color":new we(Gt.paint_fill["fill-color"]),"fill-outline-color":new we(Gt.paint_fill["fill-outline-color"]),"fill-translate":new re(Gt.paint_fill["fill-translate"]),"fill-translate-anchor":new re(Gt.paint_fill["fill-translate-anchor"]),"fill-pattern":new we(Gt.paint_fill["fill-pattern"])}),layout:Qm};const D_=Pt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),mp=Pt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),C_=Pt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Xu}=D_;var Zh={},T_=Tt,gp=bu;function bu(n,e,i,s,u){this.properties={},this.extent=i,this.type=0,this._pbf=n,this._geometry=-1,this._keys=s,this._values=u,n.readFields(S_,this,e)}function S_(n,e,i){1==n?e.id=i.readVarint():2==n?function(s,u){for(var f=s.readVarint()+s.pos;s.pos<f;){var g=u._keys[s.readVarint()],y=u._values[s.readVarint()];u.properties[g]=y}}(i,e):3==n?e.type=i.readVarint():4==n&&(e._geometry=i.pos)}function I_(n){for(var e,i,s=0,u=0,f=n.length,g=f-1;u<f;g=u++)s+=((i=n[g]).x-(e=n[u]).x)*(e.y+i.y);return s}bu.types=["Unknown","Point","LineString","Polygon"],bu.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,i=n.readVarint()+n.pos,s=1,u=0,f=0,g=0,y=[];n.pos<i;){if(u<=0){var w=n.readVarint();s=7&w,u=w>>3}if(u--,1===s||2===s)f+=n.readSVarint(),g+=n.readSVarint(),1===s&&(e&&y.push(e),e=[]),e.push(new T_(f,g));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&y.push(e),y},bu.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,i=1,s=0,u=0,f=0,g=1/0,y=-1/0,w=1/0,E=-1/0;n.pos<e;){if(s<=0){var k=n.readVarint();i=7&k,s=k>>3}if(s--,1===i||2===i)(u+=n.readSVarint())<g&&(g=u),u>y&&(y=u),(f+=n.readSVarint())<w&&(w=f),f>E&&(E=f);else if(7!==i)throw new Error("unknown command "+i)}return[g,w,y,E]},bu.prototype.toGeoJSON=function(n,e,i){var s,u,f=this.extent*Math.pow(2,i),g=this.extent*n,y=this.extent*e,w=this.loadGeometry(),E=bu.types[this.type];function k(Y){for(var J=0;J<Y.length;J++){var oe=Y[J];Y[J]=[360*(oe.x+g)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(oe.y+y)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(s=0;s<w.length;s++)z[s]=w[s][0];k(w=z);break;case 2:for(s=0;s<w.length;s++)k(w[s]);break;case 3:for(w=function(Y){var J=Y.length;if(J<=1)return[Y];for(var oe,_e,Pe=[],qe=0;qe<J;qe++){var Ae=I_(Y[qe]);0!==Ae&&(void 0===_e&&(_e=Ae<0),_e===Ae<0?(oe&&Pe.push(oe),oe=[Y[qe]]):oe.push(Y[qe]))}return oe&&Pe.push(oe),Pe}(w),s=0;s<w.length;s++)for(u=0;u<w[s].length;u++)k(w[s][u])}1===w.length?w=w[0]:E="Multi"+E;var U={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(U.id=this.id),U};var M_=gp,eg=_p;function _p(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(Ev,this,e),this.length=this._features.length}function Ev(n,e,i){15===n?e.version=i.readVarint():1===n?e.name=i.readString():5===n?e.extent=i.readVarint():2===n?e._features.push(i.pos):3===n?e._keys.push(i.readString()):4===n&&e._values.push(function(s){for(var u=null,f=s.readVarint()+s.pos;s.pos<f;){var g=s.readVarint()>>3;u=1===g?s.readString():2===g?s.readFloat():3===g?s.readDouble():4===g?s.readVarint64():5===g?s.readVarint():6===g?s.readSVarint():7===g?s.readBoolean():null}return u}(i))}_p.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new M_(this._pbf,e,this.extent,this._keys,this._values)};var Dv=eg;function zd(n,e,i){if(3===n){var s=new Dv(i,i.readVarint()+i.pos);s.length&&(e[s.name]=s)}}var fo=Zh.VectorTile=function(n,e){this.layers=n.readFields(zd,{},e)},Rc=Zh.VectorTileFeature=gp;function $d(n,e,i,s){const u=[],f=0===s?(g,y,w,E,k,z)=>{g.push(new Fe(z,w+(z-y)/(E-y)*(k-w)))}:(g,y,w,E,k,z)=>{g.push(new Fe(y+(z-w)/(k-w)*(E-y),z))};for(const g of n){const y=[];for(const w of g){if(w.length<=2)continue;const E=[];for(let U=0;U<w.length-1;U++){const Y=w[U].x,J=w[U].y,oe=w[U+1].x,_e=w[U+1].y,Pe=0===s?Y:J,qe=0===s?oe:_e;Pe<e?qe>e&&f(E,Y,J,oe,_e,e):Pe>i?qe<i&&f(E,Y,J,oe,_e,i):E.push(w[U]),qe<e&&Pe>=e&&f(E,Y,J,oe,_e,e),qe>i&&Pe<=i&&f(E,Y,J,oe,_e,i)}let k=w[w.length-1];const z=0===s?k.x:k.y;z>=e&&z<=i&&E.push(k),E.length&&(k=E[E.length-1],E[0].x===k.x&&E[0].y===k.y||E.push(E[0]),y.push(E))}y.length&&u.push(y)}return u}Zh.VectorTileLayer=eg;const tg=Rc.types,yp=Math.pow(2,13);function Ku(n,e,i,s,u,f,g,y){n.emplaceBack((e<<1)+g,(i<<1)+f,(Math.floor(s*yp)<<1)+u,Math.round(y))}function Vd(n,e,i){n.emplaceBack(e.x,e.y,e.z,16384*i[0],16384*i[1],16384*i[2])}class vp{constructor(){this.acc=new Fe(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Fe(e.x,e.y),this.max=new Fe(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,u=this.max;e.x<s.x?s.x=e.x:e.x>u.x&&(u.x=e.x),e.y<s.y?s.y=e.y:e.y>u.y&&(u.y=e.y),((0===e.x||e.x===Ai)&&e.x===i.x)!=((0===e.y||e.y===Ai)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,K(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Ai!=e.x>Ai&&this.addBorderIntersection(1,K(i.y,e.y,(Ai-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,K(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Ai!=e.y>Ai&&this.addBorderIntersection(3,K(i.x,e.x,(Ai-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((i,s)=>i+s.edges,0);return 0!==e?this.acc.div(e)._round():new Fe(0,0)}span(){return new Fe(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class Ju{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new gn,this.centroidVertexArray=new Ul,this.indexArray=new mi,this.programConfigurations=new Cc(e.layers,e.zoom),this.segments=new is,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,s,u){this.features=[],this.hasPattern=fp("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const g=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*g/(g*g+1)/Ai/(1<<f.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:g,index:y,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,k=Hu(f,E);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),k,s))continue;const z={id:g,sourceLayerIndex:w,index:y,geometry:E?k.geometry:uc(f,s,u),properties:f.properties,type:f.type,patterns:{}},U=this.layoutVertexArray.length;this.hasPattern?this.features.push(pp("fill-extrusion",this.layers,z,this.zoom,i)):this.addFeature(z,z.geometry,y,s,{},i.availableImages,u),i.featureIndex.insert(f,z.geometry,y,w,this.index,U)}this.sortBorders()}addFeatures(e,i,s,u,f){for(const g of this.features){const{geometry:y}=g;this.addFeature(g,y,g.index,i,s,u,f)}this.sortBorders()}update(e,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xu),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,C_.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,mp.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,u,f,g,y){const w=[new Fe(0,0),new Fe(Ai,Ai)],E=y.projection,k="globe"===E.name,z=this.enableTerrain&&!k?new vp:null,U="Polygon"===tg[e.type];k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new kn);const Y=Wh(i,500);for(let Pe=Y.length-1;Pe>=0;Pe--){const qe=Y[Pe];(0===qe.length||(J=qe[0]).every(Ae=>Ae.x<=0)||J.every(Ae=>Ae.x>=Ai)||J.every(Ae=>Ae.y<=0)||J.every(Ae=>Ae.y>=Ai))&&Y.splice(Pe,1)}var J;let oe;if(k)oe=Oc(Y,w,u);else{oe=[];for(const Pe of Y)oe.push({polygon:Pe,bounds:w})}const _e=U?this.edgeRadius:0;for(const{polygon:Pe,bounds:qe}of oe){let Ae=0,He=0;for(const Je of Pe)U&&!Je[0].equals(Je[Je.length-1])&&Je.push(Je[0]),He+=U?Je.length-1:Je.length;const tt=this.segments.prepareSegment((U?5:4)*He,this.layoutVertexArray,this.indexArray);if(U){const Je=[],Yt=[];Ae=tt.vertexLength;for(const dn of Pe){let On,Xt;dn.length&&dn!==Pe[0]&&Yt.push(Je.length/2),On=dn[1].sub(dn[0])._perp()._unit();for(let En=1;En<dn.length;En++){const Dn=dn[En],An=dn[En===dn.length-1?1:En+1];let{x:Bn,y:ln}=Dn;if(_e){Xt=An.sub(Dn)._perp()._unit();const Qn=On.add(Xt)._unit(),hi=_e*Math.min(4,1/(On.x*Qn.x+On.y*Qn.y));Bn+=hi*Qn.x,ln+=hi*Qn.y,On=Xt}Ku(this.layoutVertexArray,Bn,ln,0,0,1,1,0),tt.vertexLength++,Je.push(Dn.x,Dn.y),k&&Vd(this.layoutVertexExtArray,E.projectTilePoint(Bn,ln,u),E.upVector(u,Bn,ln))}}const zt=Jm(Je,Yt);for(let dn=0;dn<zt.length;dn+=3)this.indexArray.emplaceBack(Ae+zt[dn],Ae+zt[dn+2],Ae+zt[dn+1]),tt.primitiveLength++}for(const Je of Pe){z&&Je.length&&z.startRing(Je[0]);let Yt,zt,dn,On=Je.length>4&&Kh(Je[Je.length-2],Je[0],Je[1]),Xt=_e?Cv(Je[Je.length-2],Je[0],Je[1],_e):0;zt=Je[1].sub(Je[0])._perp()._unit();let En=!0;for(let Dn=1,An=0;Dn<Je.length;Dn++){let Bn=Je[Dn-1],ln=Je[Dn];const Qn=Je[Dn===Je.length-1?1:Dn+1];if(z&&U&&z.currentPolyCount.top++,ng(ln,Bn,qe)){_e&&(zt=Qn.sub(ln)._perp()._unit(),En=!En);continue}z&&z.append(ln,Bn);const hi=ln.sub(Bn)._perp(),ni=hi.x/(Math.abs(hi.x)+Math.abs(hi.y)),er=hi.y>0?1:0,jn=Bn.dist(ln);if(An+jn>32768&&(An=0),_e){dn=Qn.sub(ln)._perp()._unit();let nr=Xh(Bn,ln,Qn,Ud(zt,dn),_e);isNaN(nr)&&(nr=0);const Li=ln.sub(Bn)._unit();Bn=Bn.add(Li.mult(Xt))._round(),ln=ln.add(Li.mult(-nr))._round(),Xt=nr,zt=dn}const Ci=tt.vertexLength,tr=Je.length>4&&Kh(Bn,ln,Qn);let Nr=xp(An,On,En);if(Ku(this.layoutVertexArray,Bn.x,Bn.y,ni,er,0,0,Nr),Ku(this.layoutVertexArray,Bn.x,Bn.y,ni,er,0,1,Nr),An+=jn,Nr=xp(An,tr,!En),On=tr,Ku(this.layoutVertexArray,ln.x,ln.y,ni,er,0,0,Nr),Ku(this.layoutVertexArray,ln.x,ln.y,ni,er,0,1,Nr),tt.vertexLength+=4,this.indexArray.emplaceBack(Ci+0,Ci+1,Ci+2),this.indexArray.emplaceBack(Ci+1,Ci+3,Ci+2),tt.primitiveLength+=2,_e){const nr=Ae+(1===Dn?Je.length-2:Dn-2),Li=1===Dn?Ae:nr+1;if(this.indexArray.emplaceBack(Ci+1,nr,Ci+3),this.indexArray.emplaceBack(nr,Li,Ci+3),tt.primitiveLength+=2,void 0===Yt&&(Yt=Ci),!ng(Qn,Je[Dn],qe)){const Oo=Dn===Je.length-1?Yt:tt.vertexLength;this.indexArray.emplaceBack(Ci+2,Ci+3,Oo),this.indexArray.emplaceBack(Ci+3,Oo+1,Oo),this.indexArray.emplaceBack(Ci+3,Li,Oo+1),tt.primitiveLength+=3}En=!En}if(k){const nr=this.layoutVertexExtArray,Li=E.projectTilePoint(Bn.x,Bn.y,u),Oo=E.projectTilePoint(ln.x,ln.y,u),hr=E.upVector(u,Bn.x,Bn.y),fr=E.upVector(u,ln.x,ln.y);Vd(nr,Li,hr),Vd(nr,Li,hr),Vd(nr,Oo,fr),Vd(nr,Oo,fr)}}U&&(Ae+=Je.length-1)}}if(z&&z.polyCount.length>0){if(z.borders){z.vertexArrayOffset=this.centroidVertexArray.length;const Pe=z.borders,qe=this.featuresOnBorder.push(z)-1;for(let Ae=0;Ae<4;Ae++)Pe[Ae][0]!==Number.MAX_VALUE&&this.borders[Ae].push(qe)}this.encodeCentroid(z.borders?void 0:z.centroid(),z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,g,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,i,s=!0){let u,f;if(e)if(0!==e.y){const y=i.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else u=Math.ceil(7*(e.x+450)),f=0;else u=0,f=+s;let g=s?this.centroidVertexArray.length:i.vertexArrayOffset;for(const y of i.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let w=0;w<y.top;w++)this.centroidVertexArray.emplace(g++,u,f);for(let w=0;w<2*y.edges;w++)this.centroidVertexArray.emplace(g++,0,f),this.centroidVertexArray.emplace(g++,u,f)}}}function Ud(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function Cv(n,e,i,s){const u=e.sub(n)._perp()._unit(),f=i.sub(e)._perp()._unit();return Xh(n,e,i,Ud(u,f),s)}function Xh(n,e,i,s,u){const f=Math.sqrt(1-s*s);return Math.min(n.dist(e)/3,e.dist(i)/3,u*f/s)}function ng(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function Kh(n,e,i){if(n.x<0||n.x>=Ai||e.x<0||e.x>=Ai||i.x<0||i.x>=Ai)return!1;const s=i.sub(e),u=s.perp(),f=n.sub(e);return(s.x*f.x+s.y*f.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(f.x*f.x+f.y*f.y))>-.866&&u.x*f.x+u.y*f.y<0}function xp(n,e,i){const s=e?2|n:-3&n;return i?1|s:-2&s}function bp(){const n=Math.PI/32,e=Math.tan(n),i=Ic;return i*Math.sqrt(1+2*e*e)-i}function Oc(n,e,i){const s=1<<i.z,u=rl(i.x/s),f=rl((i.x+1)/s),g=ga(i.y/s),y=ga((i.y+1)/s);return function(w,E,k,z,U=0,Y){const J=[];if(!w.length||!k||!z)return J;const oe=(Je,Yt)=>{for(const zt of Je)J.push({polygon:zt,bounds:Yt})},_e=Math.ceil(Math.log2(k)),Pe=Math.ceil(Math.log2(z)),qe=_e-Pe,Ae=[];for(let Je=0;Je<Math.abs(qe);Je++)Ae.push(qe>0?0:1);for(let Je=0;Je<Math.min(_e,Pe);Je++)Ae.push(0),Ae.push(1);let He=w;if(He=$d(He,E[0].y-U,E[1].y+U,1),He=$d(He,E[0].x-U,E[1].x+U,0),!He.length)return J;const tt=[];for(Ae.length?tt.push({polygons:He,bounds:E,depth:0}):oe(He,E);tt.length;){const Je=tt.pop(),Yt=Je.depth,zt=Ae[Yt],dn=Je.bounds[0],On=Je.bounds[1],Xt=0===zt?dn.x:dn.y,En=0===zt?On.x:On.y,Dn=Y?Y(zt,Xt,En):.5*(Xt+En),An=$d(Je.polygons,Xt-U,Dn+U,zt),Bn=$d(Je.polygons,Dn-U,En+U,zt);if(An.length){const ln=[dn,new Fe(0===zt?Dn:On.x,1===zt?Dn:On.y)];Ae.length>Yt+1?tt.push({polygons:An,bounds:ln,depth:Yt+1}):oe(An,ln)}if(Bn.length){const ln=[new Fe(0===zt?Dn:dn.x,1===zt?Dn:dn.y),On];Ae.length>Yt+1?tt.push({polygons:Bn,bounds:ln,depth:Yt+1}):oe(Bn,ln)}}return J}(n,e,Math.ceil((f-u)/11.25),Math.ceil((g-y)/11.25),1,(w,E,k)=>{if(0===w)return.5*(E+k);{const z=ga((i.y+E/Ai)/s);return(Kl(.5*(ga((i.y+k/Ai)/s)+z))*s-i.y)*Ai}})}O(Ju,"FillExtrusionBucket",{omit:["layers","features"]}),O(vp,"PartMetadata");const A_=new $e({"fill-extrusion-edge-radius":new re(Gt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var wp={paint:new $e({"fill-extrusion-opacity":new re(Gt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new we(Gt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new re(Gt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new re(Gt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new we(Gt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new we(Gt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new we(Gt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new re(Gt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new re(Gt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new re(Gt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new re(Gt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:A_};function jd(n,e,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[n*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Jh{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=Za(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const s=(g=this.y,y=this.z,w=jd(256*(f=this.x),256*(g=Math.pow(2,y)-g-1),y),E=jd(256*(f+1),256*(g+1),y),w[0]+","+w[1]+","+E[0]+","+E[1]),u=function(f,g,y){let w,E="";for(let k=f;k>0;k--)w=1<<k-1,E+=(g&w?1:0)+(y&w?2:0);return E}(this.z,this.x,this.y);var f,g,y,w,E;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Qh{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Za(e,i.z,i.z,i.x,i.y)}}class ca{constructor(e,i,s,u,f){this.overscaledZ=e,this.wrap=i,this.canonical=new Jh(s,+u,+f),this.key=0===i&&e===s?this.canonical.key:Za(i,e,s,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new ca(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ca(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Za(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Za(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new ca(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new ca(i,this.wrap,i,s,u),new ca(i,this.wrap,i,s+1,u),new ca(i,this.wrap,i,s,u+1),new ca(i,this.wrap,i,s+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ca(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ca(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Qh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Za(n,e,i,s,u){const f=1<<Math.min(i,22);let g=f*(u%f)+s%f;return n&&i<22&&(g+=f*f*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*g+i)+(e-i)}O(Jh,"CanonicalTileID"),O(ca,"OverscaledTileID",{omit:["projMatrix"]});class fc extends Fe{constructor(e,i,s){super(e,i),this.z=s}}function wu(n,e){return n.x*e.x+n.y*e.y}function ig(n,e){if(1===n.length){let i=0;const s=e[i++];let u;for(;!u||s.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const f=e[i],g=n[0],y=u.sub(s),w=f.sub(s),E=g.sub(s),k=wu(y,y),z=wu(y,w),U=wu(w,w),Y=wu(E,y),J=wu(E,w),oe=k*U-z*z,_e=(U*Y-z*J)/oe,Pe=(k*J-z*Y)/oe,qe=s.z*(1-_e-Pe)+u.z*_e+f.z*Pe;if(isFinite(qe))return qe}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function rg(n,e,i,s,u,f,g,y){const w=g*u.getElevationAt(n,e,!0,!0),E=0!==f[0],k=E?0===f[1]?g*(f[0]/7-450):g*function(z,U,Y){const J=Math.floor(U[0]/8),oe=Math.floor(U[1]/8),_e=10*(U[0]-8*J),Pe=10*(U[1]-8*oe),qe=z.getElevationAt(J,oe,!0,!0),Ae=z.getMeterToDEM(Y),He=Math.floor(.5*(_e*Ae-1)),tt=Math.floor(.5*(Pe*Ae-1)),Je=z.tileCoordToPixel(J,oe),Yt=2*He+1,zt=2*tt+1,dn=(hi=Yt,ni=zt,[(Bn=z).getElevationAtPixel(ln=Je.x-He,Qn=Je.y-tt,!0),Bn.getElevationAtPixel(ln+ni,Qn,!0),Bn.getElevationAtPixel(ln,Qn+ni,!0),Bn.getElevationAtPixel(ln+hi,Qn+ni,!0)]),On=Math.abs(dn[0]-dn[1]),Xt=Math.abs(dn[2]-dn[3]),En=Math.abs(dn[0]-dn[2])+Math.abs(dn[1]-dn[3]),Dn=Math.min(.25,.5*Ae*(On+Xt)/Yt),An=Math.min(.25,.5*Ae*En/zt);var Bn,ln,Qn,hi,ni;return qe+Math.max(Dn*_e,An*Pe)}(u,f,y):w;return{base:w+(0===i)?-1:i,top:E?Math.max(k+s,w+i+2):w+s}}const og=Pt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Qu}=og,P_=Pt([{name:"a_packed",components:4,type:"Float32"}]),{members:R_}=P_,O_=Rc.types,Ep=Math.cos(Math.PI/180*37.5);class Hd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Jt,this.layoutVertexArray2=new Rn,this.indexArray=new mi,this.programConfigurations=new Cc(e.layers,e.zoom),this.segments=new is,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,u){this.hasPattern=fp("line",this.layers,i);const f=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:k,id:z,index:U,sourceLayerIndex:Y}of e){const J=this.layers[0]._featureFilter.needGeometry,oe=Hu(k,J);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),oe,s))continue;const _e=f?f.evaluate(oe,{},s):void 0,Pe={id:z,properties:k.properties,type:k.type,sourceLayerIndex:Y,index:U,geometry:J?oe.geometry:uc(k,s,u),patterns:{},sortKey:_e};g.push(Pe)}f&&g.sort((k,z)=>k.sortKey-z.sortKey);const{lineAtlas:y,featureIndex:w}=i,E=this.addConstantDashes(y);for(const k of g){const{geometry:z,index:U,sourceLayerIndex:Y}=k;if(E&&this.addFeatureDashes(k,y),this.hasPattern){const J=pp("line",this.layers,k,this.zoom,i);this.patternFeatures.push(J)}else this.addFeature(k,z,U,s,y.positions,i.availableImages);w.insert(e[U].feature,z,U,Y,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const u=s.paint.get("line-dasharray").value,f=s.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==f.kind)i=!0;else{const g=f.value,y=u.value;if(!y)continue;e.addDash(y,g)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===g.kind)continue;let y,w;if("constant"===f.kind){if(y=f.value,!y)continue}else y=f.evaluate({zoom:s},e);w="constant"===g.kind?g.value:g.evaluate({zoom:s},e),i.addDash(y,w),e.patterns[u.id]=i.getKey(y,w)}}update(e,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,u)}addFeatures(e,i,s,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,R_)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qu),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,s,u,f,g){const y=this.layers[0].layout,w=y.get("line-join").evaluate(e,{}),E=y.get("line-cap").evaluate(e,{}),k=y.get("line-miter-limit"),z=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const U of i)this.addLine(U,e,w,E,k,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,g,u)}addLine(e,i,s,u,f,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<e.length-1;Pe++)this.totalDistance+=e[Pe].dist(e[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y="Polygon"===O_[i.type];let w=e.length;for(;w>=2&&e[w-1].equals(e[w-2]);)w--;let E=0;for(;E<w-1&&e[E].equals(e[E+1]);)E++;if(w<(y?3:2))return;"bevel"===s&&(f=1.05);const k=this.overscaling<=16?15*Ai/(512*this.overscaling):0,z=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let U,Y,J,oe,_e;this.e1=this.e2=-1,y&&(U=e[w-2],_e=e[E].sub(U)._unit()._perp());for(let Pe=E;Pe<w;Pe++){if(J=Pe===w-1?y?e[E+1]:void 0:e[Pe+1],J&&e[Pe].equals(J))continue;_e&&(oe=_e),U&&(Y=U),U=e[Pe],_e=J?J.sub(U)._unit()._perp():oe,oe=oe||_e;let qe=oe.add(_e);0===qe.x&&0===qe.y||qe._unit();const Ae=oe.x*_e.x+oe.y*_e.y,He=qe.x*_e.x+qe.y*_e.y,tt=0!==He?1/He:1/0,Je=2*Math.sqrt(2-2*He),Yt=He<Ep&&Y&&J,zt=oe.x*_e.y-oe.y*_e.x>0;if(Yt&&Pe>E){const Xt=U.dist(Y);if(Xt>2*k){const En=U.sub(U.sub(Y)._mult(k/Xt)._round());this.updateDistance(Y,En),this.addCurrentVertex(En,oe,0,0,z),Y=En}}const dn=Y&&J;let On=dn?s:y?"butt":u;if(dn&&"round"===On&&(tt<g?On="miter":tt<=2&&(On="fakeround")),"miter"===On&&tt>f&&(On="bevel"),"bevel"===On&&(tt>2&&(On="flipbevel"),tt<f&&(On="miter")),Y&&this.updateDistance(Y,U),"miter"===On)qe._mult(tt),this.addCurrentVertex(U,qe,0,0,z);else if("flipbevel"===On){if(tt>100)qe=_e.mult(-1);else{const Xt=tt*oe.add(_e).mag()/oe.sub(_e).mag();qe._perp()._mult(Xt*(zt?-1:1))}this.addCurrentVertex(U,qe,0,0,z),this.addCurrentVertex(U,qe.mult(-1),0,0,z)}else if("bevel"===On||"fakeround"===On){const Xt=-Math.sqrt(tt*tt-1),En=zt?Xt:0,Dn=zt?0:Xt;if(Y&&this.addCurrentVertex(U,oe,En,Dn,z),"fakeround"===On){const An=Math.round(180*Je/Math.PI/20);for(let Bn=1;Bn<An;Bn++){let ln=Bn/An;if(.5!==ln){const hi=ln-.5;ln+=ln*hi*(ln-1)*((1.0904+Ae*(Ae*(3.55645-1.43519*Ae)-3.2452))*hi*hi+(.848013+Ae*(.215638*Ae-1.06021)))}const Qn=_e.sub(oe)._mult(ln)._add(oe)._unit()._mult(zt?-1:1);this.addHalfVertex(U,Qn.x,Qn.y,!1,zt,0,z)}}J&&this.addCurrentVertex(U,_e,-En,-Dn,z)}else if("butt"===On)this.addCurrentVertex(U,qe,0,0,z);else if("square"===On){const Xt=Y?1:-1;Y||this.addCurrentVertex(U,qe,Xt,Xt,z),this.addCurrentVertex(U,qe,0,0,z),Y&&this.addCurrentVertex(U,qe,Xt,Xt,z)}else"round"===On&&(Y&&(this.addCurrentVertex(U,oe,0,0,z),this.addCurrentVertex(U,oe,1,1,z,!0)),J&&(this.addCurrentVertex(U,_e,-1,-1,z,!0),this.addCurrentVertex(U,_e,0,0,z)));if(Yt&&Pe<w-1){const Xt=U.dist(J);if(Xt>2*k){const En=U.add(J.sub(U)._mult(k/Xt)._round());this.updateDistance(U,En),this.addCurrentVertex(En,_e,0,0,z),U=En}}}}addCurrentVertex(e,i,s,u,f,g=!1){const y=i.y*u-i.x,w=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*s,i.y-i.x*s,g,!1,s,f),this.addHalfVertex(e,y,w,g,!0,-u,f)}addHalfVertex({x:e,y:i},s,u,f,g,y,w){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(g?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(0===y?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),w.primitiveLength++),g?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}O(Hd,"LineBucket",{omit:["layers","patternFeatures"]});const k_=new $e({"line-cap":new we(Gt.layout_line["line-cap"]),"line-join":new we(Gt.layout_line["line-join"]),"line-miter-limit":new re(Gt.layout_line["line-miter-limit"]),"line-round-limit":new re(Gt.layout_line["line-round-limit"]),"line-sort-key":new we(Gt.layout_line["line-sort-key"])});var Dp={paint:new $e({"line-opacity":new we(Gt.paint_line["line-opacity"]),"line-color":new we(Gt.paint_line["line-color"]),"line-translate":new re(Gt.paint_line["line-translate"]),"line-translate-anchor":new re(Gt.paint_line["line-translate-anchor"]),"line-width":new we(Gt.paint_line["line-width"]),"line-gap-width":new we(Gt.paint_line["line-gap-width"]),"line-offset":new we(Gt.paint_line["line-offset"]),"line-blur":new we(Gt.paint_line["line-blur"]),"line-dasharray":new we(Gt.paint_line["line-dasharray"]),"line-pattern":new we(Gt.paint_line["line-pattern"]),"line-gradient":new ze(Gt.paint_line["line-gradient"]),"line-trim-offset":new re(Gt.paint_line["line-trim-offset"])}),layout:k_};const ef=new class extends we{possiblyEvaluate(n,e){return e=new N(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,i,s){return e=Re({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,i,s)}}(Dp.paint.properties["line-width"].specification);function L_(n,e){return e>0?e+2*n:n}ef.useIntegerZoom=!0;const F_=Pt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),B_=Pt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),N_=Pt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Pt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Tv=Pt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Sv=Pt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Pt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Gd=Pt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),z_=Pt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Pt([{name:"triangle",components:3,type:"Uint16"}]),Pt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Pt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Pt([{type:"Float32",name:"offsetX"}]),Pt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var qs=24;const ol=128;function kc(n,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new N(n+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:u}=i;let f=0;for(;f<s.length&&s[f]<=n;)f++;f=Math.max(0,f-1);let g=f;for(;g<s.length&&s[g]<n+1;)g++;g=Math.min(s.length-1,g);const y=s[f],w=s[g];return"composite"===i.kind?{kind:"composite",minZoom:y,maxZoom:w,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:w,minSize:i.evaluate(new N(y)),maxSize:i.evaluate(new N(w)),interpolationType:u}}}function ed(n,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:u}){return"source"===n.kind?s/ol:"composite"===n.kind?K(s/ol,u/ol,i):e}function Lc(n,e){let i=0,s=0;if("constant"===n.kind)s=n.layoutSize;else if("source"!==n.kind){const{interpolationType:u,minZoom:f,maxZoom:g}=n,y=u?Vt(gs.interpolationFactor(u,e,f,g),0,1):0;"camera"===n.kind?s=K(n.minSize,n.maxSize,y):i=y}return{uSizeT:i,uSize:s}}var Wd=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ol,evaluateSizeForFeature:ed,evaluateSizeForZoom:Lc,getSizeData:kc});function tf(n,e,i){return n.sections.forEach(s=>{s.text=function(u,f,g){const y=f.layout.get("text-transform").evaluate(g,{});return"uppercase"===y?u=u.toLocaleUpperCase():"lowercase"===y&&(u=u.toLocaleLowerCase()),A.applyArabicShaping&&(u=A.applyArabicShaping(u)),u}(s.text,e,i)}),n}const pc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function sg(n){return"\ufe36"===n||"\ufe48"===n||"\ufe38"===n||"\ufe44"===n||"\ufe42"===n||"\ufe3e"===n||"\ufe3c"===n||"\ufe3a"===n||"\ufe18"===n||"\ufe40"===n||"\ufe10"===n||"\ufe13"===n||"\ufe14"===n||"\uff40"===n||"\uffe3"===n||"\ufe11"===n||"\ufe12"===n}function Cp(n){return"\ufe35"===n||"\ufe47"===n||"\ufe37"===n||"\ufe43"===n||"\ufe41"===n||"\ufe3d"===n||"\ufe3b"===n||"\ufe39"===n||"\ufe17"===n||"\ufe3f"===n}var qd=eo,$_=function(n,e,i,s,u){var f,g,y=8*u-s-1,w=(1<<y)-1,E=w>>1,k=-7,z=i?u-1:0,U=i?-1:1,Y=n[e+z];for(z+=U,f=Y&(1<<-k)-1,Y>>=-k,k+=y;k>0;f=256*f+n[e+z],z+=U,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=s;k>0;g=256*g+n[e+z],z+=U,k-=8);if(0===f)f=1-E;else{if(f===w)return g?NaN:1/0*(Y?-1:1);g+=Math.pow(2,s),f-=E}return(Y?-1:1)*g*Math.pow(2,f-s)},nf=function(n,e,i,s,u,f){var g,y,w,E=8*f-u-1,k=(1<<E)-1,z=k>>1,U=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,Y=s?0:f-1,J=s?1:-1,oe=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,g=k):(g=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-g))<1&&(g--,w*=2),(e+=g+z>=1?U/w:U*Math.pow(2,1-z))*w>=2&&(g++,w/=2),g+z>=k?(y=0,g=k):g+z>=1?(y=(e*w-1)*Math.pow(2,u),g+=z):(y=e*Math.pow(2,z-1)*Math.pow(2,u),g=0));u>=8;n[i+Y]=255&y,Y+=J,y/=256,u-=8);for(g=g<<u|y,E+=u;E>0;n[i+Y]=255&g,Y+=J,g/=256,E-=8);n[i+Y-J]|=128*oe};function eo(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}eo.Varint=0,eo.Fixed64=1,eo.Bytes=2,eo.Fixed32=5;var Tp=4294967296,Sp=1/Tp,ag=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function mc(n){return n.type===eo.Bytes?n.readVarint()+n.pos:n.pos+1}function Ip(n,e,i){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(s);for(var u=i.pos-1;u>=n;u--)i.buf[u+s]=i.buf[u]}function V_(n,e){for(var i=0;i<n.length;i++)e.writeVarint(n[i])}function U_(n,e){for(var i=0;i<n.length;i++)e.writeSVarint(n[i])}function Iv(n,e){for(var i=0;i<n.length;i++)e.writeFloat(n[i])}function j_(n,e){for(var i=0;i<n.length;i++)e.writeDouble(n[i])}function rf(n,e){for(var i=0;i<n.length;i++)e.writeBoolean(n[i])}function Mp(n,e){for(var i=0;i<n.length;i++)e.writeFixed32(n[i])}function H_(n,e){for(var i=0;i<n.length;i++)e.writeSFixed32(n[i])}function lg(n,e){for(var i=0;i<n.length;i++)e.writeFixed64(n[i])}function Ap(n,e){for(var i=0;i<n.length;i++)e.writeSFixed64(n[i])}function Eu(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function td(n,e,i){n[i]=e,n[i+1]=e>>>8,n[i+2]=e>>>16,n[i+3]=e>>>24}function Pp(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}eo.prototype={destroy:function(){this.buf=null},readFields:function(n,e,i){for(i=i||this.length;this.pos<i;){var s=this.readVarint(),u=s>>3,f=this.pos;this.type=7&s,n(u,e,this),this.pos===f&&this.skip(s)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=Eu(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Pp(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Eu(this.buf,this.pos)+Eu(this.buf,this.pos+4)*Tp;return this.pos+=8,n},readSFixed64:function(){var n=Eu(this.buf,this.pos)+Pp(this.buf,this.pos+4)*Tp;return this.pos+=8,n},readFloat:function(){var n=$_(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=$_(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,i,s=this.buf;return e=127&(i=s[this.pos++]),i<128?e:(e|=(127&(i=s[this.pos++]))<<7,i<128?e:(e|=(127&(i=s[this.pos++]))<<14,i<128?e:(e|=(127&(i=s[this.pos++]))<<21,i<128?e:function(u,f,g){var y,w,E=g.buf;if(y=(112&(w=E[g.pos++]))>>4,w<128||(y|=(127&(w=E[g.pos++]))<<3,w<128)||(y|=(127&(w=E[g.pos++]))<<10,w<128)||(y|=(127&(w=E[g.pos++]))<<17,w<128)||(y|=(127&(w=E[g.pos++]))<<24,w<128)||(y|=(1&(w=E[g.pos++]))<<31,w<128))return function Fc(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}(u,y,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=s[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&ag?ag.decode(this.buf.subarray(e,n)):function(i,s,u){for(var f="",g=s;g<u;){var y,w,E,k=i[g],z=null,U=k>239?4:k>223?3:k>191?2:1;if(g+U>u)break;1===U?k<128&&(z=k):2===U?128==(192&(y=i[g+1]))&&(z=(31&k)<<6|63&y)<=127&&(z=null):3===U?(w=i[g+2],128==(192&(y=i[g+1]))&&128==(192&w)&&((z=(15&k)<<12|(63&y)<<6|63&w)<=2047||z>=55296&&z<=57343)&&(z=null)):4===U&&(w=i[g+2],E=i[g+3],128==(192&(y=i[g+1]))&&128==(192&w)&&128==(192&E)&&((z=(15&k)<<18|(63&y)<<12|(63&w)<<6|63&E)<=65535||z>=1114112)&&(z=null)),null===z?(z=65533,U=1):z>65535&&(z-=65536,f+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),f+=String.fromCharCode(z),g+=U}return f}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==eo.Bytes)return n.push(this.readVarint(e));var i=mc(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==eo.Bytes)return n.push(this.readSVarint());var e=mc(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==eo.Bytes)return n.push(this.readBoolean());var e=mc(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==eo.Bytes)return n.push(this.readFloat());var e=mc(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==eo.Bytes)return n.push(this.readDouble());var e=mc(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==eo.Bytes)return n.push(this.readFixed32());var e=mc(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==eo.Bytes)return n.push(this.readSFixed32());var e=mc(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==eo.Bytes)return n.push(this.readFixed64());var e=mc(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==eo.Bytes)return n.push(this.readSFixed64());var e=mc(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===eo.Varint)for(;this.buf[this.pos++]>127;);else if(e===eo.Bytes)this.pos=this.readVarint()+this.pos;else if(e===eo.Fixed32)this.pos+=4;else{if(e!==eo.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),td(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),td(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),td(this.buf,-1&n,this.pos),td(this.buf,Math.floor(n*Sp),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),td(this.buf,-1&n,this.pos),td(this.buf,Math.floor(n*Sp),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,i){var s,u,f,y;if(e>=0?(s=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,u=u+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),f=s,(y=i).buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7),function(f,g){var y=(7&f)<<4;g.buf[g.pos++]|=y|((f>>>=3)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f)))))}(u,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(s,u,f){for(var g,y,w=0;w<u.length;w++){if((g=u.charCodeAt(w))>55295&&g<57344){if(!y){g>56319||w+1===u.length?(s[f++]=239,s[f++]=191,s[f++]=189):y=g;continue}if(g<56320){s[f++]=239,s[f++]=191,s[f++]=189,y=g;continue}g=y-55296<<10|g-56320|65536,y=null}else y&&(s[f++]=239,s[f++]=191,s[f++]=189,y=null);g<128?s[f++]=g:(g<2048?s[f++]=g>>6|192:(g<65536?s[f++]=g>>12|224:(s[f++]=g>>18|240,s[f++]=g>>12&63|128),s[f++]=g>>6&63|128),s[f++]=63&g|128)}return f}(this.buf,n,this.pos);var i=this.pos-e;i>=128&&Ip(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(n){this.realloc(4),nf(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),nf(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=n[i]},writeRawMessage:function(n,e){this.pos++;var i=this.pos;n(e,this);var s=this.pos-i;s>=128&&Ip(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeMessage:function(n,e,i){this.writeTag(n,eo.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,V_,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,U_,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,rf,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,Iv,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,j_,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,Mp,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,H_,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,lg,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,Ap,e)},writeBytesField:function(n,e){this.writeTag(n,eo.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,eo.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,eo.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,eo.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,eo.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,eo.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,eo.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,eo.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,eo.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,eo.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,!!e)}};var sf=Wt(qd);const af=3;function Mv(n,e,i){e.glyphs=[],1===n&&i.readMessage(G_,e)}function G_(n,e,i){if(3===n){const{id:s,bitmap:u,width:f,height:g,left:y,top:w,advance:E}=i.readMessage(Yd,{});e.glyphs.push({id:s,bitmap:new dc({width:f+2*af,height:g+2*af},u),metrics:{width:f,height:g,left:y,top:w,advance:E}})}else 4===n?e.ascender=i.readSVarint():5===n&&(e.descender=i.readSVarint())}function Yd(n,e,i){1===n?e.id=i.readVarint():2===n?e.bitmap=i.readBytes():3===n?e.width=i.readVarint():4===n?e.height=i.readVarint():5===n?e.left=i.readSVarint():6===n?e.top=i.readSVarint():7===n&&(e.advance=i.readVarint())}const cg=af;function Bc(n){let e=0,i=0;for(const g of n)e+=g.w*g.h,i=Math.max(i,g.w);n.sort((g,y)=>y.h-g.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,f=0;for(const g of n)for(let y=s.length-1;y>=0;y--){const w=s[y];if(!(g.w>w.w||g.h>w.h)){if(g.x=w.x,g.y=w.y,f=Math.max(f,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===w.w&&g.h===w.h){const E=s.pop();y<s.length&&(s[y]=E)}else g.h===w.h?(w.x+=g.w,w.w-=g.w):g.w===w.w?(w.y+=g.h,w.h-=g.h):(s.push({x:w.x+g.w,y:w.y,w:w.w-g.w,h:g.h}),w.y+=g.h,w.h-=g.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}const ua=1;class Rp{constructor(e,{pixelRatio:i,version:s,stretchX:u,stretchY:f,content:g}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=f,this.content=g,this.version=s}get tl(){return[this.paddedRect.x+ua,this.paddedRect.y+ua]}get br(){return[this.paddedRect.x+this.paddedRect.w-ua,this.paddedRect.y+this.paddedRect.h-ua]}get displaySize(){return[(this.paddedRect.w-2*ua)/this.pixelRatio,(this.paddedRect.h-2*ua)/this.pixelRatio]}}class Op{constructor(e,i){const s={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,s,f),this.addImages(i,u,f);const{w:g,h:y}=Bc(f),w=new la({width:g||1,height:y||1});for(const E in e){const k=e[E],z=s[E].paddedRect;la.copy(k.data,w,{x:0,y:0},{x:z.x+ua,y:z.y+ua},k.data)}for(const E in i){const k=i[E],z=u[E].paddedRect,U=z.x+ua,Y=z.y+ua,J=k.data.width,oe=k.data.height;la.copy(k.data,w,{x:0,y:0},{x:U,y:Y},k.data),la.copy(k.data,w,{x:0,y:oe-1},{x:U,y:Y-1},{width:J,height:1}),la.copy(k.data,w,{x:0,y:0},{x:U,y:Y+oe},{width:J,height:1}),la.copy(k.data,w,{x:J-1,y:0},{x:U-1,y:Y},{width:1,height:oe}),la.copy(k.data,w,{x:0,y:0},{x:U+J,y:Y},{width:1,height:oe})}this.image=w,this.iconPositions=s,this.patternPositions=u}addImages(e,i,s){for(const u in e){const f=e[u],g={x:0,y:0,w:f.data.width+2*ua,h:f.data.height+2*ua};s.push(g),i[u]=new Rp(g,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),i),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),i)}patchUpdatedImage(e,i,s){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,f]=e.tl;s.update(i.data,void 0,{x:u,y:f})}}O(Rp,"ImagePosition"),O(Op,"ImageAtlas");const sl={horizontal:1,vertical:2,horizontalOnly:3},ug=-17;class Zd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const s=new Zd;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new Zd;return i.imageName=e,i}}class Du{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const s=new Du;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?s.addImageSection(f):s.addTextSection(f,i)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,s){let u="";for(let f=0;f<i.length;f++){const g=i.charCodeAt(f+1)||null,y=i.charCodeAt(f-1)||null;u+=!s&&(g&&ui(g)&&!pc[i[f+1]]||y&&ui(y)&&!pc[i[f-1]])||!pc[i[f]]?i[f]:pc[i[f]]}return u}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&nd[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&nd[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new Du;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Zd.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(s)}addImageSection(e){const i=e.image?e.image.name:"";if(0===i.length)return void xn("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Zd.forImage(i)),this.sectionIndex.push(this.sections.length-1)):xn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function kp(n,e,i,s,u,f,g,y,w,E,k,z,U,Y,J){const oe=Du.fromFeature(n,u);z===sl.vertical&&oe.verticalizePunctuation(U);let _e=[];const Pe=function(Je,Yt,zt,dn,On,Xt){if(!Je)return[];const En=[],Dn=function(Qn,hi,ni,er,jn,Ci){let tr=0;for(let Nr=0;Nr<Qn.length();Nr++){const nr=Qn.getSection(Nr);tr+=lf(Qn.getCharCode(Nr),nr,er,jn,hi,Ci)}return tr/Math.max(1,Math.ceil(tr/ni))}(Je,Yt,zt,dn,On,Xt),An=Je.text.indexOf("\u200b")>=0;let Bn=0;for(let Qn=0;Qn<Je.length();Qn++){const hi=Je.getSection(Qn),ni=Je.getCharCode(Qn);if(nd[ni]||(Bn+=lf(ni,hi,dn,On,Yt,Xt)),Qn<Je.length()-1){const er=!((ln=ni)<11904||!(me["Bopomofo Extended"](ln)||me.Bopomofo(ln)||me["CJK Compatibility Forms"](ln)||me["CJK Compatibility Ideographs"](ln)||me["CJK Compatibility"](ln)||me["CJK Radicals Supplement"](ln)||me["CJK Strokes"](ln)||me["CJK Symbols and Punctuation"](ln)||me["CJK Unified Ideographs Extension A"](ln)||me["CJK Unified Ideographs"](ln)||me["Enclosed CJK Letters and Months"](ln)||me["Halfwidth and Fullwidth Forms"](ln)||me.Hiragana(ln)||me["Ideographic Description Characters"](ln)||me["Kangxi Radicals"](ln)||me["Katakana Phonetic Extensions"](ln)||me.Katakana(ln)||me["Vertical Forms"](ln)||me["Yi Radicals"](ln)||me["Yi Syllables"](ln)));(Av[ni]||er||hi.imageName)&&En.push(dg(Qn+1,Bn,Dn,En,W_(ni,Je.getCharCode(Qn+1),er&&An),!1))}}var ln;return Fp(dg(Je.length(),Bn,Dn,En,0,!0))}(oe,E,f,e,s,Y),{processBidirectionalText:qe,processStyledBidirectionalText:Ae}=A;if(qe&&1===oe.sections.length){const Je=qe(oe.toString(),Pe);for(const Yt of Je){const zt=new Du;zt.text=Yt,zt.sections=oe.sections;for(let dn=0;dn<Yt.length;dn++)zt.sectionIndex.push(0);_e.push(zt)}}else if(Ae){const Je=Ae(oe.text,oe.sectionIndex,Pe);for(const Yt of Je){const zt=new Du;zt.text=Yt[0],zt.sectionIndex=Yt[1],zt.sections=oe.sections,_e.push(zt)}}else _e=function(Je,Yt){const zt=[],dn=Je.text;let On=0;for(const Xt of Yt)zt.push(Je.substring(On,Xt)),On=Xt;return On<dn.length&&zt.push(Je.substring(On,dn.length)),zt}(oe,Pe);const He=[],tt={positionedLines:He,text:oe.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:z,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Je,Yt,zt,dn,On,Xt,En,Dn,An,Bn,ln,Qn){let hi=0,ni=0,er=0;const jn="right"===Dn?1:"left"===Dn?0:.5;let Ci=!1;for(const hr of On){const fr=hr.getSections();for(const wo of fr){if(wo.imageName)continue;const Io=Yt[wo.fontStack];if(Io&&(Ci=void 0!==Io.ascender&&void 0!==Io.descender,!Ci))break}if(!Ci)break}let tr=0;for(const hr of On){hr.trim();const fr=hr.getMaxScale(),wo=(fr-1)*qs,Io={positionedGlyphs:[],lineOffset:0};Je.positionedLines[tr]=Io;const ko=Io.positionedGlyphs;let Eo=0;if(!hr.length()){ni+=Xt,++tr;continue}let rs=0,us=0;for(let Do=0;Do<hr.length();Do++){const ys=hr.getSection(Do),Ko=hr.getSectionIndex(Do),Vo=hr.getCharCode(Do);let Fr=ys.scale,vs=null,to=null,ba=null,As=qs,Ps=0;const ea=!(An===sl.horizontal||!ln&&!or(Vo)||ln&&(nd[Vo]||(Nr=Vo,me.Arabic(Nr)||me["Arabic Supplement"](Nr)||me["Arabic Extended-A"](Nr)||me["Arabic Presentation Forms-A"](Nr)||me["Arabic Presentation Forms-B"](Nr))));if(ys.imageName){const Ma=dn[ys.imageName];if(!Ma)continue;ba=ys.imageName,Je.iconsInText=Je.iconsInText||!0,to=Ma.paddedRect;const ta=Ma.displaySize;Fr=Fr*qs/Qn,vs={width:ta[0],height:ta[1],left:ua,top:-cg,advance:ea?ta[1]:ta[0],localGlyph:!1},Ps=Ci?-vs.height*Fr:ug+fr*qs-ta[1]*Fr,As=vs.advance;const Fl=(ea?ta[0]:ta[1])*Fr-qs*fr;Fl>0&&Fl>Eo&&(Eo=Fl)}else{const Ma=zt[ys.fontStack];if(!Ma)continue;Ma[Vo]&&(to=Ma[Vo]);const ta=Yt[ys.fontStack];if(!ta)continue;const Fl=ta.glyphs[Vo];if(!Fl)continue;if(vs=Fl.metrics,As=8203!==Vo?qs:0,Ci){const qc=void 0!==ta.ascender?Math.abs(ta.ascender):0,Yc=void 0!==ta.descender?Math.abs(ta.descender):0,Zc=(qc+Yc)*Fr;rs<Zc&&(rs=Zc,us=(qc-Yc)/2*Fr),Ps=-qc*Fr}else Ps=ug+(fr-Fr)*qs}ea?(Je.verticalizable=!0,ko.push({glyph:Vo,imageName:ba,x:hi,y:ni+Ps,vertical:ea,scale:Fr,localGlyph:vs.localGlyph,fontStack:ys.fontStack,sectionIndex:Ko,metrics:vs,rect:to}),hi+=As*Fr+Bn):(ko.push({glyph:Vo,imageName:ba,x:hi,y:ni+Ps,vertical:ea,scale:Fr,localGlyph:vs.localGlyph,fontStack:ys.fontStack,sectionIndex:Ko,metrics:vs,rect:to}),hi+=vs.advance*Fr+Bn)}0!==ko.length&&(er=Math.max(hi-Bn,er),Ci?Np(ko,jn,Eo,us,Xt*fr/2):Np(ko,jn,Eo,0,Xt/2)),hi=0;const Ms=Xt*fr+Eo;Io.lineOffset=Math.max(Eo,wo),ni+=Ms,++tr}var Nr;const nr=ni,{horizontalAlign:Li,verticalAlign:Oo}=Bp(En);(function(hr,fr,wo,Io,ko,Eo){const rs=(fr-wo)*ko,us=-Eo*Io;for(const Ms of hr)for(const Do of Ms.positionedGlyphs)Do.x+=rs,Do.y+=us})(Je.positionedLines,jn,Li,Oo,er,nr),Je.top+=-Oo*nr,Je.bottom=Je.top+nr,Je.left+=-Li*er,Je.right=Je.left+er,Je.hasBaseline=Ci}(tt,e,i,s,_e,g,y,w,z,E,U,J),!function(Je){for(const Yt of Je)if(0!==Yt.positionedGlyphs.length)return!1;return!0}(He)&&tt}const nd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Av={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function lf(n,e,i,s,u,f){if(e.imageName){const g=s[e.imageName];return g?g.displaySize[0]*e.scale*qs/f+u:0}{const g=i[e.fontStack],y=g&&g.glyphs[n];return y?y.metrics.advance*e.scale+u:0}}function Lp(n,e,i,s){const u=Math.pow(n-e,2);return s?n<e?u/2:2*u:u+Math.abs(i)*i}function W_(n,e,i){let s=0;return 10===n&&(s-=1e4),i&&(s+=150),40!==n&&65288!==n||(s+=50),41!==e&&65289!==e||(s+=50),s}function dg(n,e,i,s,u,f){let g=null,y=Lp(e,i,u,f);for(const w of s){const E=Lp(e-w.x,i,u,f)+w.badness;E<=y&&(g=w,y=E)}return{index:n,x:e,priorBreak:g,badness:y}}function Fp(n){return n?Fp(n.priorBreak).concat(n.index):[]}function Bp(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Np(n,e,i,s,u){if(!(e||i||s||u))return;const f=n.length-1,g=n[f],y=(g.x+g.metrics.advance*g.scale)*e;for(let w=0;w<=f;w++)n[w].x-=y,n[w].y+=i+s+u}function q_(n,e,i){const{horizontalAlign:s,verticalAlign:u}=Bp(i),f=e[0]-n.displaySize[0]*s,g=e[1]-n.displaySize[1]*u;return{image:n,top:g,bottom:g+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function hg(n,e,i,s,u,f){const g=n.image;let y;if(g.content){const _e=g.content,Pe=g.pixelRatio||1;y=[_e[0]/Pe,_e[1]/Pe,g.displaySize[0]-_e[2]/Pe,g.displaySize[1]-_e[3]/Pe]}const w=e.left*f,E=e.right*f;let k,z,U,Y;"width"===i||"both"===i?(Y=u[0]+w-s[3],z=u[0]+E+s[1]):(Y=u[0]+(w+E-g.displaySize[0])/2,z=Y+g.displaySize[0]);const J=e.top*f,oe=e.bottom*f;return"height"===i||"both"===i?(k=u[1]+J-s[0],U=u[1]+oe+s[2]):(k=u[1]+(J+oe-g.displaySize[1])/2,U=k+g.displaySize[1]),{image:g,top:k,right:z,bottom:U,left:Y,collisionPadding:y}}class Nc extends Fe{constructor(e,i,s,u,f){super(e,i),this.angle=u,this.z=s,void 0!==f&&(this.segment=f)}clone(){return new Nc(this.x,this.y,this.z,this.angle,this.segment)}}function zp(n,e,i,s,u){if(void 0===e.segment)return!0;let f=e,g=e.segment+1,y=0;for(;y>-i/2;){if(g--,g<0)return!1;y-=n[g].dist(f),f=n[g]}y+=n[g].dist(n[g+1]),g++;const w=[];let E=0;for(;y<i/2;){const k=n[g],z=n[g+1];if(!z)return!1;let U=n[g-1].angleTo(k)-k.angleTo(z);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:y,angleDelta:U}),E+=U;y-w[0].distance>s;)E-=w.shift().angleDelta;if(E>u)return!1;g++,y+=k.dist(z)}return!0}function $p(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function gl(n,e,i){return n?.6*e*i:0}function cf(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function Y_(n,e,i,s,u,f){const g=gl(i,u,f),y=cf(i,s)*f;let w=0;const E=$p(n)/2;for(let k=0;k<n.length-1;k++){const z=n[k],U=n[k+1],Y=z.dist(U);if(w+Y>E){const J=(E-w)/Y,oe=K(z.x,U.x,J),_e=K(z.y,U.y,J),Pe=new Nc(oe,_e,0,U.angleTo(z),k);return!g||zp(n,Pe,y,g,e)?Pe:void 0}w+=Y}}function Pv(n,e,i,s,u,f,g,y,w){const E=gl(s,f,g),k=cf(s,u),z=k*g,U=0===n[0].x||n[0].x===w||0===n[0].y||n[0].y===w;return e-z<e/4&&(e=z+e/4),fg(n,U?e/2*y%e:(k/2+2*f)*g*y%e,e,E,i,z,U,!1,w)}function fg(n,e,i,s,u,f,g,y,w){const E=f/2,k=$p(n);let z=0,U=e-i,Y=[];for(let J=0;J<n.length-1;J++){const oe=n[J],_e=n[J+1],Pe=oe.dist(_e),qe=_e.angleTo(oe);for(;U+i<z+Pe;){U+=i;const Ae=(U-z)/Pe,He=K(oe.x,_e.x,Ae),tt=K(oe.y,_e.y,Ae);if(He>=0&&He<w&&tt>=0&&tt<w&&U-E>=0&&U+E<=k){const Je=new Nc(He,tt,0,qe,J);Je._round(),s&&!zp(n,Je,f,s,u)||Y.push(Je)}}z+=Pe}return y||Y.length||g||(Y=fg(n,z/2,i,s,u,f,g,!0,w)),Y}function pg(n,e,i,s,u){const f=[];for(let g=0;g<n.length;g++){const y=n[g];let w;for(let E=0;E<y.length-1;E++){let k=y[E],z=y[E+1];k.x<e&&z.x<e||(k.x<e?k=new Fe(e,k.y+(e-k.x)/(z.x-k.x)*(z.y-k.y))._round():z.x<e&&(z=new Fe(e,k.y+(e-k.x)/(z.x-k.x)*(z.y-k.y))._round()),k.y<i&&z.y<i||(k.y<i?k=new Fe(k.x+(i-k.y)/(z.y-k.y)*(z.x-k.x),i)._round():z.y<i&&(z=new Fe(k.x+(i-k.y)/(z.y-k.y)*(z.x-k.x),i)._round()),k.x>=s&&z.x>=s||(k.x>=s?k=new Fe(s,k.y+(s-k.x)/(z.x-k.x)*(z.y-k.y))._round():z.x>=s&&(z=new Fe(s,k.y+(s-k.x)/(z.x-k.x)*(z.y-k.y))._round()),k.y>=u&&z.y>=u||(k.y>=u?k=new Fe(k.x+(u-k.y)/(z.y-k.y)*(z.x-k.x),u)._round():z.y>=u&&(z=new Fe(k.x+(u-k.y)/(z.y-k.y)*(z.x-k.x),u)._round()),w&&k.equals(w[w.length-1])||(w=[k],f.push(w)),w.push(z)))))}}return f}O(Nc,"Anchor");const id=1e20;function Cu(n,e,i,s,u,f,g,y,w){for(let E=e;E<e+s;E++)Jl(n,i*f+E,f,u,g,y,w);for(let E=i;E<i+u;E++)Jl(n,E*f+e,1,s,g,y,w)}function Jl(n,e,i,s,u,f,g){f[0]=0,g[0]=-id,g[1]=id,u[0]=n[e];for(let y=1,w=0,E=0;y<s;y++){u[y]=n[e+y*i];const k=y*y;do{const z=f[w];E=(u[y]-u[z]+k-z*z)/(y-z)/2}while(E<=g[w]&&--w>-1);w++,f[w]=y,g[w]=E,g[w+1]=id}for(let y=0,w=0;y<s;y++){for(;g[w+1]<y;)w++;const E=f[w],k=y-E;n[e+y*i]=u[E]+k*k}}const Ia=2,Vp={none:0,ideographs:1,all:2};class rd{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const s=[];for(const u in e)for(const f of e[u])s.push({stack:u,id:f});li(s,({stack:u,id:f},g)=>{let y=this.entries[u];y||(y=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=y.glyphs[f];if(void 0!==w)return void g(null,{stack:u,id:f,glyph:w});if(w=this._tinySDF(y,u,f),w)return y.glyphs[f]=w,void g(null,{stack:u,id:f,glyph:w});const E=Math.floor(f/256);if(256*E>65535)return void g(new Error("glyphs > 65535 not supported"));if(y.ranges[E])return void g(null,{stack:u,id:f,glyph:w});let k=y.requests[E];k||(k=y.requests[E]=[],rd.loadGlyphRange(u,E,this.url,this.requestManager,(z,U)=>{if(U){y.ascender=U.ascender,y.descender=U.descender;for(const Y in U.glyphs)this._doesCharSupportLocalGlyph(+Y)||(y.glyphs[+Y]=U.glyphs[+Y]);y.ranges[E]=!0}for(const Y of k)Y(z,U);delete y.requests[E]})),k.push((z,U)=>{z?g(z):U&&g(null,{stack:u,id:f,glyph:U.glyphs[f]||null})})},(u,f)=>{if(u)i(u);else if(f){const g={};for(const{stack:y,id:w,glyph:E}of f)void 0===g[y]&&(g[y]={}),void 0===g[y].glyphs&&(g[y].glyphs={}),g[y].glyphs[w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},g[y].ascender=this.entries[y].ascender,g[y].descender=this.entries[y].descender;i(null,g)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Vp.none&&(this.localGlyphMode===Vp.all?!!this.localFontFamily:!!this.localFontFamily&&(me["CJK Unified Ideographs"](e)||me["Hangul Syllables"](e)||me.Hiragana(e)||me.Katakana(e)||me["CJK Symbols and Punctuation"](e)))}_tinySDF(e,i,s){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let f=e.tinySDF;if(!f){let oe="400";/bold/i.test(i)?oe="900":/medium/i.test(i)?oe="500":/light/i.test(i)&&(oe="200"),f=e.tinySDF=new rd.TinySDF({fontFamily:u,fontWeight:oe,fontSize:24*Ia,buffer:3*Ia,radius:8*Ia}),f.fontWeight=oe}if(this.localGlyphs[f.fontWeight][s])return this.localGlyphs[f.fontWeight][s];const g=String.fromCharCode(s),{data:y,width:w,height:E,glyphWidth:k,glyphHeight:z,glyphLeft:U,glyphTop:Y,glyphAdvance:J}=f.draw(g);return this.localGlyphs[f.fontWeight][s]={id:s,bitmap:new dc({width:w,height:E},y),metrics:{width:k/Ia,height:z/Ia,left:U/Ia,top:Y/Ia-27,advance:J/Ia,localGlyph:!0}}}}rd.loadGlyphRange=function(n,e,i,s,u){const f=256*e,g=f+255,y=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${f}-${g}`),fi.Glyphs);rr(y,(w,E)=>{if(w)u(w);else if(E){const k={},z=new sf(E).readFields(Mv,{});for(const U of z.glyphs)k[U.id]=U;u(null,{glyphs:k,ascender:z.ascender,descender:z.descender})}})},rd.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=i;const y=this.size=n+4*e,w=this._createCanvas(y),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${g} ${f} ${n}px ${u}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(n),g=Math.ceil(i),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-u))),w=Math.min(this.size-this.buffer,g+Math.ceil(s)),E=y+2*this.buffer,k=w+2*this.buffer,z=Math.max(E*k,0),U=new Uint8ClampedArray(z),Y={data:U,width:E,height:k,glyphWidth:y,glyphHeight:w,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(0===y||0===w)return Y;const{ctx:J,buffer:oe,gridInner:_e,gridOuter:Pe}=this;J.clearRect(oe,oe,y,w),J.fillText(n,oe,oe+g);const qe=J.getImageData(oe,oe,y,w);Pe.fill(id,0,z),_e.fill(0,0,z);for(let Ae=0;Ae<w;Ae++)for(let He=0;He<y;He++){const tt=qe.data[4*(Ae*y+He)+3]/255;if(0===tt)continue;const Je=(Ae+oe)*E+He+oe;if(1===tt)Pe[Je]=0,_e[Je]=id;else{const Yt=.5-tt;Pe[Je]=Yt>0?Yt*Yt:0,_e[Je]=Yt<0?Yt*Yt:0}}Cu(Pe,0,0,E,k,E,this.f,this.v,this.z),Cu(_e,oe,oe,y,w,E,this.f,this.v,this.z);for(let Ae=0;Ae<z;Ae++){const He=Math.sqrt(Pe[Ae])-Math.sqrt(_e[Ae]);U[Ae]=Math.round(255-255*(He/this.radius+this.cutoff))}return Y}};const Tu=ua;function uf(n,e,i,s){const u=[],f=n.image,g=f.pixelRatio,y=f.paddedRect.w-2*Tu,w=f.paddedRect.h-2*Tu,E=n.right-n.left,k=n.bottom-n.top,z=f.stretchX||[[0,y]],U=f.stretchY||[[0,w]],Y=(Xt,En)=>Xt+En[1]-En[0],J=z.reduce(Y,0),oe=U.reduce(Y,0),_e=y-J,Pe=w-oe;let qe=0,Ae=J,He=0,tt=oe,Je=0,Yt=_e,zt=0,dn=Pe;if(f.content&&s){const Xt=f.content;qe=zc(z,0,Xt[0]),He=zc(U,0,Xt[1]),Ae=zc(z,Xt[0],Xt[2]),tt=zc(U,Xt[1],Xt[3]),Je=Xt[0]-qe,zt=Xt[1]-He,Yt=Xt[2]-Xt[0]-Ae,dn=Xt[3]-Xt[1]-tt}const On=(Xt,En,Dn,An)=>{const Bn=jp(Xt.stretch-qe,Ae,E,n.left),ln=od(Xt.fixed-Je,Yt,Xt.stretch,J),Qn=jp(En.stretch-He,tt,k,n.top),hi=od(En.fixed-zt,dn,En.stretch,oe),ni=jp(Dn.stretch-qe,Ae,E,n.left),er=od(Dn.fixed-Je,Yt,Dn.stretch,J),jn=jp(An.stretch-He,tt,k,n.top),Ci=od(An.fixed-zt,dn,An.stretch,oe),tr=new Fe(Bn,Qn),Nr=new Fe(ni,Qn),nr=new Fe(ni,jn),Li=new Fe(Bn,jn),Oo=new Fe(ln/g,hi/g),hr=new Fe(er/g,Ci/g),fr=e*Math.PI/180;if(fr){const ko=Math.sin(fr),Eo=Math.cos(fr),rs=[Eo,-ko,ko,Eo];tr._matMult(rs),Nr._matMult(rs),Li._matMult(rs),nr._matMult(rs)}const wo=Xt.stretch+Xt.fixed,Io=En.stretch+En.fixed;return{tl:tr,tr:Nr,bl:Li,br:nr,tex:{x:f.paddedRect.x+Tu+wo,y:f.paddedRect.y+Tu+Io,w:Dn.stretch+Dn.fixed-wo,h:An.stretch+An.fixed-Io},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Oo,pixelOffsetBR:hr,minFontScaleX:Yt/g/E,minFontScaleY:dn/g/k,isSDF:i}};if(s&&(f.stretchX||f.stretchY)){const Xt=Up(z,_e,J),En=Up(U,Pe,oe);for(let Dn=0;Dn<Xt.length-1;Dn++){const An=Xt[Dn],Bn=Xt[Dn+1];for(let ln=0;ln<En.length-1;ln++)u.push(On(An,En[ln],Bn,En[ln+1]))}}else u.push(On({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:w+1}));return u}function zc(n,e,i){let s=0;for(const u of n)s+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return s}function Up(n,e,i){const s=[{fixed:-Tu,stretch:0}];for(const[u,f]of n){const g=s[s.length-1];s.push({fixed:u-g.stretch,stretch:g.stretch}),s.push({fixed:u-g.stretch,stretch:g.stretch+(f-u)})}return s.push({fixed:e+Tu,stretch:i}),s}function jp(n,e,i,s){return n/e*i+s}function od(n,e,i,s){return n-e*i/s}function sd(n,e,i,s){const u=e+n.positionedLines[s].lineOffset;return 0===s?i+u/2:i+(u+(e+n.positionedLines[s-1].lineOffset))/2}class df{constructor(e=[],i=mg){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,u=i[e];for(;e>0;){const f=e-1>>1,g=i[f];if(s(u,g)>=0)break;i[e]=g,e=f}i[e]=u}_down(e){const{data:i,compare:s}=this,u=this.length>>1,f=i[e];for(;e<u;){let g=1+(e<<1),y=i[g];const w=g+1;if(w<this.length&&s(i[w],y)<0&&(g=w,y=i[w]),s(y,f)>=0)break;i[e]=y,e=g}i[e]=f}}function mg(n,e){return n<e?-1:n>e?1:0}function gg(n,e=1,i=!1){let s=1/0,u=1/0,f=-1/0,g=-1/0;const y=n[0];for(let Y=0;Y<y.length;Y++){const J=y[Y];(!Y||J.x<s)&&(s=J.x),(!Y||J.y<u)&&(u=J.y),(!Y||J.x>f)&&(f=J.x),(!Y||J.y>g)&&(g=J.y)}const w=Math.min(f-s,g-u);let E=w/2;const k=new df([],Z_);if(0===w)return new Fe(s,u);for(let Y=s;Y<f;Y+=w)for(let J=u;J<g;J+=w)k.push(new ad(Y+E,J+E,E,n));let z=function(Y){let J=0,oe=0,_e=0;const Pe=Y[0];for(let qe=0,Ae=Pe.length,He=Ae-1;qe<Ae;He=qe++){const tt=Pe[qe],Je=Pe[He],Yt=tt.x*Je.y-Je.x*tt.y;oe+=(tt.x+Je.x)*Yt,_e+=(tt.y+Je.y)*Yt,J+=3*Yt}return new ad(oe/J,_e/J,0,Y)}(n),U=k.length;for(;k.length;){const Y=k.pop();(Y.d>z.d||!z.d)&&(z=Y,i&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,U)),Y.max-z.d<=e||(E=Y.h/2,k.push(new ad(Y.p.x-E,Y.p.y-E,E,n)),k.push(new ad(Y.p.x+E,Y.p.y-E,E,n)),k.push(new ad(Y.p.x-E,Y.p.y+E,E,n)),k.push(new ad(Y.p.x+E,Y.p.y+E,E,n)),U+=4)}return i&&(console.log(`num probes: ${U}`),console.log(`best distance: ${z.d}`)),z.p}function Z_(n,e){return e.max-n.max}class ad{constructor(e,i,s,u){this.p=new Fe(e,i),this.h=s,this.d=function(f,g){let y=!1,w=1/0;for(let E=0;E<g.length;E++){const k=g[E];for(let z=0,U=k.length,Y=U-1;z<U;Y=z++){const J=k[z],oe=k[Y];J.y>f.y!=oe.y>f.y&&f.x<(oe.x-J.x)*(f.y-J.y)/(oe.y-J.y)+J.x&&(y=!y),w=Math.min(w,Fh(f,J,oe))}}return(y?1:-1)*Math.sqrt(w)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const ld=7,Hp=Number.POSITIVE_INFINITY,_g=Math.sqrt(2);function X_(n,[e,i]){let s=0,u=0;if(i===Hp){e<0&&(e=0);const f=e/_g;switch(n){case"top-right":case"top-left":u=f-ld;break;case"bottom-right":case"bottom-left":u=-f+ld;break;case"bottom":u=-e+ld;break;case"top":u=e-ld}switch(n){case"top-right":case"bottom-right":s=-f;break;case"top-left":case"bottom-left":s=f;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":u=i-ld;break;case"bottom-right":case"bottom-left":case"bottom":u=-i+ld}switch(n){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,u]}function K_(n,e,i,s,u,f,g,y,w,E){n.createArrays(),n.tilePixelRatio=Ai/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const k=n.layers[0].layout,z=n.layers[0]._unevaluatedLayout._values,U={};if("composite"===n.textSizeData.kind){const{minZoom:oe,maxZoom:_e}=n.textSizeData;U.compositeTextSizes=[z["text-size"].possiblyEvaluate(new N(oe),y),z["text-size"].possiblyEvaluate(new N(_e),y)]}if("composite"===n.iconSizeData.kind){const{minZoom:oe,maxZoom:_e}=n.iconSizeData;U.compositeIconSizes=[z["icon-size"].possiblyEvaluate(new N(oe),y),z["icon-size"].possiblyEvaluate(new N(_e),y)]}U.layoutTextSize=z["text-size"].possiblyEvaluate(new N(w+1),y),U.layoutIconSize=z["icon-size"].possiblyEvaluate(new N(w+1),y),U.textMaxSize=z["text-size"].possiblyEvaluate(new N(18),y);const Y="map"===k.get("text-rotation-alignment")&&"point"!==k.get("symbol-placement"),J=k.get("text-size");for(const oe of n.features){const _e=k.get("text-font").evaluate(oe,{},y).join(","),Pe=J.evaluate(oe,{},y),qe=U.layoutTextSize.evaluate(oe,{},y),Ae=(U.layoutIconSize.evaluate(oe,{},y),{horizontal:{},vertical:void 0}),He=oe.text;let tt,Je=[0,0];if(He){const dn=He.toString(),On=k.get("text-letter-spacing").evaluate(oe,{},y)*qs,Xt=k.get("text-line-height").evaluate(oe,{},y)*qs,En=In(dn)?On:0,Dn=k.get("text-anchor").evaluate(oe,{},y),An=k.get("text-variable-anchor");if(!An){const ni=k.get("text-radial-offset").evaluate(oe,{},y);Je=ni?X_(Dn,[ni*qs,Hp]):k.get("text-offset").evaluate(oe,{},y).map(er=>er*qs)}let Bn=Y?"center":k.get("text-justify").evaluate(oe,{},y);const ln="point"===k.get("symbol-placement"),Qn=ln?k.get("text-max-width").evaluate(oe,{},y)*qs:1/0,hi=ni=>{n.allowVerticalPlacement&&et(dn)&&(Ae.vertical=kp(He,e,i,u,_e,Qn,Xt,Dn,ni,En,Je,sl.vertical,!0,qe,Pe))};if(!Y&&An){const ni="auto"===Bn?An.map(jn=>yg(jn)):[Bn];let er=!1;for(let jn=0;jn<ni.length;jn++){const Ci=ni[jn];if(!Ae.horizontal[Ci])if(er)Ae.horizontal[Ci]=Ae.horizontal[0];else{const tr=kp(He,e,i,u,_e,Qn,Xt,"center",Ci,En,Je,sl.horizontal,!1,qe,Pe);tr&&(Ae.horizontal[Ci]=tr,er=1===tr.positionedLines.length)}}hi("left")}else{if("auto"===Bn&&(Bn=yg(Dn)),ln||k.get("text-writing-mode").indexOf("horizontal")>=0||!et(dn)){const ni=kp(He,e,i,u,_e,Qn,Xt,Dn,Bn,En,Je,sl.horizontal,!1,qe,Pe);ni&&(Ae.horizontal[Bn]=ni)}hi(ln?"left":Bn)}}let Yt=!1;if(oe.icon&&oe.icon.name){const dn=s[oe.icon.name];dn&&(tt=q_(u[oe.icon.name],k.get("icon-offset").evaluate(oe,{},y),k.get("icon-anchor").evaluate(oe,{},y)),Yt=dn.sdf,void 0===n.sdfIcons?n.sdfIcons=dn.sdf:n.sdfIcons!==dn.sdf&&xn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(dn.pixelRatio!==n.pixelRatio||0!==k.get("icon-rotate").constantOr(1))&&(n.iconsNeedLinear=!0))}const zt=Gp(Ae.horizontal)||Ae.vertical;n.iconsInText||(n.iconsInText=!!zt&&zt.iconsInText),(zt||tt)&&Rv(n,oe,Ae,tt,s,U,qe,0,Je,Yt,g,y,E)}f&&n.generateCollisionDebugBuffers(w,n.collisionBoxArray)}function yg(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Rv(n,e,i,s,u,f,g,y,w,E,k,z,U){let Y=f.textMaxSize.evaluate(e,{},z);void 0===Y&&(Y=g);const J=n.layers[0].layout,oe=J.get("icon-offset").evaluate(e,{},z),_e=Gp(i.horizontal)||i.vertical,Pe="globe"===U.name,qe=qs,Ae=g/qe,He=n.tilePixelRatio*Y/qe,tt=(Dn=n.overscaling,n.zoom>18&&Dn>2&&(Dn>>=1),Math.max(Ai/(512*Dn),1)*J.get("symbol-spacing")),Je=J.get("text-padding")*n.tilePixelRatio,Yt=J.get("icon-padding")*n.tilePixelRatio,zt=De(J.get("text-max-angle")),dn="map"===J.get("text-rotation-alignment")&&"point"!==J.get("symbol-placement"),On="map"===J.get("icon-rotation-alignment")&&"point"!==J.get("symbol-placement"),Xt=J.get("symbol-placement"),En=tt/2;var Dn;const An=J.get("icon-text-fit");let Bn;s&&"none"!==An&&(n.allowVerticalPlacement&&i.vertical&&(Bn=hg(s,i.vertical,An,J.get("icon-text-fit-padding"),oe,Ae)),_e&&(s=hg(s,_e,An,J.get("icon-text-fit-padding"),oe,Ae)));const ln=(Qn,hi,ni)=>{if(hi.x<0||hi.x>=Ai||hi.y<0||hi.y>=Ai)return;let er=null;if(Pe){const{x:jn,y:Ci,z:tr}=U.projectTilePoint(hi.x,hi.y,ni);er={anchor:new Nc(jn,Ci,tr,0,void 0),up:U.upVector(ni,hi.x,hi.y)}}!function(jn,Ci,tr,Nr,nr,Li,Oo,hr,fr,wo,Io,ko,Eo,rs,us,Ms,Do,ys,Ko,Vo,Fr,vs,to,ba,As){const Ps=jn.addToLineVertexArray(Ci,Nr);let ea,Ma,ta,Fl,qc,Yc,Zc,py=0,$g=0,Vg=0,Df=0,lm=-1,Cf=-1;const ic={};let Ug=Ff("");const Xc=tr?tr.anchor:Ci;let Tf=0,Sf=0;if(void 0===fr._unevaluatedLayout.getValue("text-radial-offset")?[Tf,Sf]=fr.layout.get("text-offset").evaluate(Fr,{},As).map(za=>za*qs):(Tf=fr.layout.get("text-radial-offset").evaluate(Fr,{},As)*qs,Sf=Hp),jn.allowVerticalPlacement&&nr.vertical){const za=nr.vertical;if(us)Yc=hf(za),hr&&(Zc=hf(hr));else{const Aa=fr.layout.get("text-rotate").evaluate(Fr,{},As)+90;ta=Su(wo,Xc,Ci,Io,ko,Eo,za,rs,Aa,Ms),hr&&(Fl=Su(wo,Xc,Ci,Io,ko,Eo,hr,ys,Aa))}}if(Li){const za=fr.layout.get("icon-rotate").evaluate(Fr,{},As),Aa="none"!==fr.layout.get("icon-text-fit"),Iu=uf(Li,za,to,Aa),um=hr?uf(hr,za,to,Aa):void 0;Ma=Su(wo,Xc,Ci,Io,ko,Eo,Li,ys,za),py=4*Iu.length;const lh=jn.iconSizeData;let rc=null;"source"===lh.kind?(rc=[ol*fr.layout.get("icon-size").evaluate(Fr,{},As)],rc[0]>gc&&xn(`${jn.layerIds[0]}: Value for "icon-size" is >= ${cd}. Reduce your "icon-size".`)):"composite"===lh.kind&&(rc=[ol*vs.compositeIconSizes[0].evaluate(Fr,{},As),ol*vs.compositeIconSizes[1].evaluate(Fr,{},As)],(rc[0]>gc||rc[1]>gc)&&xn(`${jn.layerIds[0]}: Value for "icon-size" is >= ${cd}. Reduce your "icon-size".`)),jn.addSymbols(jn.icon,Iu,rc,Vo,Ko,Fr,!1,tr,Ci,Ps.lineStartIndex,Ps.lineLength,-1,ba,As),lm=jn.icon.placedSymbolArray.length-1,um&&($g=4*um.length,jn.addSymbols(jn.icon,um,rc,Vo,Ko,Fr,sl.vertical,tr,Ci,Ps.lineStartIndex,Ps.lineLength,-1,ba,As),Cf=jn.icon.placedSymbolArray.length-1)}for(const za in nr.horizontal){const Aa=nr.horizontal[za];ea||(Ug=Ff(Aa.text),us?qc=hf(Aa):ea=Su(wo,Xc,Ci,Io,ko,Eo,Aa,rs,fr.layout.get("text-rotate").evaluate(Fr,{},As),Ms));const Iu=1===Aa.positionedLines.length;if(Vg+=J_(jn,tr,Ci,Aa,Oo,fr,us,Fr,Ms,Ps,nr.vertical?sl.horizontal:sl.horizontalOnly,Iu?Object.keys(nr.horizontal):[za],ic,lm,vs,ba,As),Iu)break}nr.vertical&&(Df+=J_(jn,tr,Ci,nr.vertical,Oo,fr,us,Fr,Ms,Ps,sl.vertical,["vertical"],ic,Cf,vs,ba,As));let Kc=-1;const cm=(za,Aa)=>za?Math.max(za,Aa):Aa;Kc=cm(qc,Kc),Kc=cm(Yc,Kc),Kc=cm(Zc,Kc);const my=Kc>-1?1:0;jn.glyphOffsetArray.length>=Uc.MAX_GLYPHS&&xn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Fr.sortKey&&jn.addToSortKeyRanges(jn.symbolInstances.length,Fr.sortKey),jn.symbolInstances.emplaceBack(Xc.x,Xc.y,Xc.z,Ci.x,Ci.y,ic.right>=0?ic.right:-1,ic.center>=0?ic.center:-1,ic.left>=0?ic.left:-1,ic.vertical>=0?ic.vertical:-1,lm,Cf,Ug,void 0!==ea?ea:jn.collisionBoxArray.length,void 0!==ea?ea+1:jn.collisionBoxArray.length,void 0!==ta?ta:jn.collisionBoxArray.length,void 0!==ta?ta+1:jn.collisionBoxArray.length,void 0!==Ma?Ma:jn.collisionBoxArray.length,void 0!==Ma?Ma+1:jn.collisionBoxArray.length,Fl||jn.collisionBoxArray.length,Fl?Fl+1:jn.collisionBoxArray.length,Io,Vg,Df,py,$g,my,0,Tf,Sf,Kc)}(n,hi,er,Qn,i,s,u,Bn,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,Je,dn,w,0,Yt,On,oe,e,f,E,k,z)};if("line"===Xt)for(const Qn of pg(e.geometry,0,0,Ai,Ai)){const hi=Pv(Qn,tt,zt,i.vertical||_e,s,qe,He,n.overscaling,Ai);for(const ni of hi)_e&&vg(n,_e.text,En,ni)||ln(Qn,ni,z)}else if("line-center"===Xt){for(const Qn of e.geometry)if(Qn.length>1){const hi=Y_(Qn,zt,i.vertical||_e,s,qe,He);hi&&ln(Qn,hi,z)}}else if("Polygon"===e.type)for(const Qn of Wh(e.geometry,0)){const hi=gg(Qn,16);ln(Qn[0],new Nc(hi.x,hi.y,0,0,void 0),z)}else if("LineString"===e.type)for(const Qn of e.geometry)ln(Qn,new Nc(Qn[0].x,Qn[0].y,0,0,void 0),z);else if("Point"===e.type)for(const Qn of e.geometry)for(const hi of Qn)ln([hi],new Nc(hi.x,hi.y,0,0,void 0),z)}const cd=255,gc=cd*ol;function J_(n,e,i,s,u,f,g,y,w,E,k,z,U,Y,J,oe,_e){const Pe=function(He,tt,Je,Yt,zt,dn,On,Xt){const En=[];if(0===tt.positionedLines.length)return En;const Dn=Yt.layout.get("text-rotate").evaluate(dn,{})*Math.PI/180,An=function(ni){const er=ni[0],jn=ni[1],Ci=er*jn;return Ci>0?[er,-jn]:Ci<0?[-er,jn]:0===er?[jn,er]:[jn,-er]}(Je);let Bn=Math.abs(tt.top-tt.bottom);for(const ni of tt.positionedLines)Bn-=ni.lineOffset;const ln=tt.positionedLines.length,Qn=Bn/ln;let hi=tt.top-Je[1];for(let ni=0;ni<ln;++ni){const er=tt.positionedLines[ni];hi=sd(tt,Qn,hi,ni);for(const jn of er.positionedGlyphs){if(!jn.rect)continue;const Ci=jn.rect||{};let tr=cg+1,Nr=!0,nr=1,Li=0;if(jn.imageName){const to=On[jn.imageName];if(!to)continue;if(to.sdf){xn("SDF images are not supported in formatted text and will be ignored.");continue}Nr=!1,nr=to.pixelRatio,tr=ua/nr}const Oo=(zt||Xt)&&jn.vertical,hr=jn.metrics.advance*jn.scale/2,fr=jn.metrics,wo=jn.rect;if(null===wo)continue;Xt&&tt.verticalizable&&(Li=jn.imageName?hr-jn.metrics.width*jn.scale/2:0);const Io=zt?[jn.x+hr,jn.y]:[0,0];let ko=[0,0],Eo=[0,0],rs=!1;zt||(Oo?(Eo=[jn.x+hr+An[0],jn.y+An[1]-Li],rs=!0):ko=[jn.x+hr+Je[0],jn.y+Je[1]-Li]);const us=wo.w*jn.scale/(nr*(jn.localGlyph?Ia:1)),Ms=wo.h*jn.scale/(nr*(jn.localGlyph?Ia:1));let Do,ys,Ko,Vo;if(Oo){const to=jn.y-hi,ba=new Fe(-hr,hr-to),As=-Math.PI/2,Ps=new Fe(...Eo);Do=new Fe(-hr+ko[0],ko[1]),Do._rotateAround(As,ba)._add(Ps),Do.x+=-to+hr,Do.y-=(fr.left-tr)*jn.scale;const ea=jn.imageName?fr.advance*jn.scale:qs*jn.scale,Ma=String.fromCharCode(jn.glyph);sg(Ma)?Do.x+=(1-tr)*jn.scale:Cp(Ma)?Do.x+=ea-fr.height*jn.scale+(-tr-1)*jn.scale:Do.x+=jn.imageName||fr.width+2*tr===wo.w&&fr.height+2*tr===wo.h?(ea-Ms)/2:(ea-(fr.height+2*tr)*jn.scale)/2,ys=new Fe(Do.x,Do.y-us),Ko=new Fe(Do.x+Ms,Do.y),Vo=new Fe(Do.x+Ms,Do.y-us)}else{const to=(fr.left-tr)*jn.scale-hr+ko[0],ba=(-fr.top-tr)*jn.scale+ko[1],As=to+us,Ps=ba+Ms;Do=new Fe(to,ba),ys=new Fe(As,ba),Ko=new Fe(to,Ps),Vo=new Fe(As,Ps)}if(Dn){let to;to=zt?new Fe(0,0):rs?new Fe(An[0],An[1]):new Fe(Je[0],Je[1]),Do._rotateAround(Dn,to),ys._rotateAround(Dn,to),Ko._rotateAround(Dn,to),Vo._rotateAround(Dn,to)}const Fr=new Fe(0,0),vs=new Fe(0,0);En.push({tl:Do,tr:ys,bl:Ko,br:Vo,tex:Ci,writingMode:tt.writingMode,glyphOffset:Io,sectionIndex:jn.sectionIndex,isSDF:Nr,pixelOffsetTL:Fr,pixelOffsetBR:vs,minFontScaleX:0,minFontScaleY:0})}}return En}(0,s,w,f,g,y,u,n.allowVerticalPlacement),qe=n.textSizeData;let Ae=null;"source"===qe.kind?(Ae=[ol*f.layout.get("text-size").evaluate(y,{},_e)],Ae[0]>gc&&xn(`${n.layerIds[0]}: Value for "text-size" is >= ${cd}. Reduce your "text-size".`)):"composite"===qe.kind&&(Ae=[ol*J.compositeTextSizes[0].evaluate(y,{},_e),ol*J.compositeTextSizes[1].evaluate(y,{},_e)],(Ae[0]>gc||Ae[1]>gc)&&xn(`${n.layerIds[0]}: Value for "text-size" is >= ${cd}. Reduce your "text-size".`)),n.addSymbols(n.text,Pe,Ae,w,g,y,k,e,i,E.lineStartIndex,E.lineLength,Y,oe,_e);for(const He of z)U[He]=n.text.placedSymbolArray.length-1;return 4*Pe.length}function Gp(n){for(const e in n)return n[e];return null}function Su(n,e,i,s,u,f,g,y,w,E){let k=g.top,z=g.bottom,U=g.left,Y=g.right;const J=g.collisionPadding;if(J&&(U-=J[0],k-=J[1],Y+=J[2],z+=J[3]),w){const oe=new Fe(U,k),_e=new Fe(Y,k),Pe=new Fe(U,z),qe=new Fe(Y,z),Ae=De(w);let He=new Fe(0,0);E&&(He=new Fe(E[0],E[1])),oe._rotateAround(Ae,He),_e._rotateAround(Ae,He),Pe._rotateAround(Ae,He),qe._rotateAround(Ae,He),U=Math.min(oe.x,_e.x,Pe.x,qe.x),Y=Math.max(oe.x,_e.x,Pe.x,qe.x),k=Math.min(oe.y,_e.y,Pe.y,qe.y),z=Math.max(oe.y,_e.y,Pe.y,qe.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,U,k,Y,z,y,s,u,f),n.length-1}function hf(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function vg(n,e,i,s){const u=n.compareText;if(e in u){const f=u[e];for(let g=f.length-1;g>=0;g--)if(s.dist(f[g])<i)return!0}else u[e]=[];return u[e].push(s),!1}function Wp(n,e){const i=n.fovAboveCenter,s=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,u=(n._camera.position[2]*n.worldSize-s)/Math.cos(n._pitch),f=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01)),g=Math.sin(n._pitch)*f+u;return Math.min(1.01*g,u*(1/n._horizonShift))}function sr(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),s=n.x*i,u=(n.x+1)*i,f=n.y*i,g=(n.y+1)*i,y=rl(s),w=rl(u),E=ga(f),k=ga(g),z=e.project(y,E),U=e.project(w,E),Y=e.project(w,k),J=e.project(y,k);let oe=Math.min(z.x,U.x,Y.x,J.x),_e=Math.min(z.y,U.y,Y.y,J.y),Pe=Math.max(z.x,U.x,Y.x,J.x),qe=Math.max(z.y,U.y,Y.y,J.y);const Ae=i/16;function He(Je,Yt,zt,dn,On,Xt){const En=(zt+On)/2,Dn=(dn+Xt)/2,An=e.project(rl(En),ga(Dn)),Bn=Math.max(0,oe-An.x,_e-An.y,An.x-Pe,An.y-qe);oe=Math.min(oe,An.x),Pe=Math.max(Pe,An.x),_e=Math.min(_e,An.y),qe=Math.max(qe,An.y),Bn>Ae&&(He(Je,An,zt,dn,En,Dn),He(An,Yt,En,Dn,On,Xt))}He(z,U,s,f,u,f),He(U,Y,u,f,u,g),He(Y,J,u,g,s,g),He(J,z,s,g,s,f),oe-=Ae,_e-=Ae,Pe+=Ae,qe+=Ae;const tt=1/Math.max(Pe-oe,qe-_e);return{scale:tt,x:oe*tt,y:_e*tt,x2:Pe*tt,y2:qe*tt,projection:e}}const xg=dl(new Float32Array(16));class _c{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Qr(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s=!0){return e._coordinatePoint(e.locationCoordinate(i),s)}pixelsPerMeter(e,i){return Ol(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return Wp(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,u){const f=e.horizonLineFromTop(!1),g=new Fe(i,Math.max(f,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,u))}pointCoordinate3D(e,i,s){const u=new Fe(i,s);if(e.elevation)return e.elevation.pointCoordinate(u);{const f=this.pointCoordinate(e,u.x,u.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return xg}createTileMatrix(e,i,s){let u,f,g;const y=s.canonical,w=dl(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=sr(y,this);u=1,f=E.x+s.wrap*E.scale,g=E.y,Rl(w,w,[u/E.scale,u/E.scale,e.pixelsPerMeter/i])}else u=i/e.zoomScale(y.z),f=(y.x+Math.pow(2,y.z)*s.wrap)*u,g=y.y*u;return Hl(w,w,[f,g,0]),Rl(w,w,[u/Ai,u/Ai,1]),w}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class ud extends _c{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(De(i));this.n=(u+Math.sin(De(s)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c:u,r0:f}=this,g=De(e-this.center[0]),y=De(i),w=Math.sqrt(u-2*s*Math.sin(y))/s;return{x:w*Math.sin(g*s),y:w*Math.cos(g*s)-f,z:0}}unproject(e,i){const{n:s,c:u,r0:f}=this,g=f+i;let y=Math.atan2(e,Math.abs(g))*Math.sign(g);g*s<0&&(y-=Math.PI*Math.sign(e)*Math.sign(g));const w=De(this.center[0])*s;y=Ht(y,-Math.PI-w,Math.PI-w);const E=Vt(dt(y/s)+this.center[0],-180,180),k=Math.asin(Vt((u-(e*e+g*g)*s*s)/(2*s),-1,1)),z=Vt(dt(k),-Ws,Ws);return new Qr(E,z)}}const dd=1.340264,Xd=-.081106,$c=893e-6,Ql=.003796,hd=Math.sqrt(3)/2;class Kd extends _c{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(hd*Math.sin(i)),u=s*s,f=u*u*u;return{x:.5*(e*Math.cos(s)/(hd*(dd+3*Xd*u+f*(7*$c+9*Ql*u)))/Math.PI+.5),y:1-.5*(s*(dd+Xd*u+f*($c+Ql*u))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,u=s*s,f=u*u*u;for(let k,z,U,Y=0;Y<12&&(z=s*(dd+Xd*u+f*($c+Ql*u))-i,U=dd+3*Xd*u+f*(7*$c+9*Ql*u),k=z/U,s=Vt(s-k,-Math.PI/3,Math.PI/3),u=s*s,f=u*u*u,!(Math.abs(k)<1e-12));++Y);const g=hd*e*(dd+3*Xd*u+f*(7*$c+9*Ql*u))/Math.cos(s),y=Math.asin(Math.sin(s)/hd),w=Vt(180*g/Math.PI,-180,180),E=Vt(180*y/Math.PI,-Ws,Ws);return new Qr(w,E)}}class bg extends _c{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),u=Vt(360*(.5-i),-Ws,Ws);return new Qr(s,u)}}const Vc=Math.PI/2;function fd(n){return Math.tan((Vc+n)/2)}class qp extends _c{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30];let u=De(i),f=De(s);this.southernCenter=u+f<0,this.southernCenter&&(u=-u,f=-f);const g=Math.cos(u),y=fd(u);this.n=u===f?Math.sin(u):Math.log(g/Math.cos(f))/Math.log(fd(f)/y),this.f=g*Math.pow(fd(u),this.n)/this.n}project(e,i){i=De(i),this.southernCenter&&(i=-i),e=De(e-this.center[0]);const s=1e-6,{n:u,f}=this;f>0?i<-Vc+s&&(i=-Vc+s):i>Vc-s&&(i=Vc-s);const g=f/Math.pow(fd(i),u);let y=g*Math.sin(u*e),w=f-g*Math.cos(u*e);return y=.5*(y/Math.PI+.5),w=.5*(w/Math.PI+.5),{x:y,y:this.southernCenter?w:1-w,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f:u}=this,f=u-i,g=Math.sign(f),y=Math.sign(s)*Math.sqrt(e*e+f*f);let w=Math.atan2(e,Math.abs(f))*g;f*s<0&&(w-=Math.PI*Math.sign(e)*g);const E=Vt(dt(w/s)+this.center[0],-180,180),k=Vt(dt(2*Math.atan(Math.pow(u/y,1/s))-Vc),-Ws,Ws);return new Qr(E,this.southernCenter?-k:k)}}class Yp extends _c{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Xl(e),y:Kl(i),z:0}}unproject(e,i){const s=rl(e),u=ga(i);return new Qr(s,u)}}const ff=De(Ws);class Q_ extends _c{project(e,i){const s=(i=De(i))*i,u=s*s;return{x:.5*((e=De(e))*(.8707-.131979*s+u*(u*(.003971*s-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+u*(.028874*s-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,u=25,f=0,g=s*s;do{g=s*s;const E=g*g;f=(s*(1.007226+g*(.015085+E*(.028874*g-.044475-.005916*E)))-i)/(1.007226+g*(.045255+E*(.259866*g-.311325-.005916*11*E))),s=Vt(s-f,-ff,ff)}while(Math.abs(f)>1e-6&&--u>0);g=s*s;const y=Vt(dt(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),w=dt(s);return new Qr(y,w)}}const wg=De(Ws);class ey extends _c{project(e,i){i=De(i),e=De(e);const s=Math.cos(i),u=2/Math.PI,f=Math.acos(s*Math.cos(e/2)),g=Math.sin(f)/f,y=.5*(e*u+2*s*Math.sin(e/2)/g)||0,w=.5*(i+Math.sin(i)/g)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,f=25;const g=1e-6;let y=0,w=0;do{const E=Math.cos(u),k=Math.sin(u),z=2*k*E,U=k*k,Y=E*E,J=Math.cos(s/2),oe=Math.sin(s/2),_e=2*J*oe,Pe=oe*oe,qe=1-Y*J*J,Ae=qe?1/qe:0,He=qe?Math.acos(E*J)*Math.sqrt(1/qe):0,tt=.5*(2*He*E*oe+2*s/Math.PI)-e,Je=.5*(He*k+u)-i,Yt=.5*Ae*(Y*Pe+He*E*J*U)+1/Math.PI,zt=Ae*(_e*z/4-He*k*oe),dn=.125*Ae*(z*oe-He*k*Y*_e),On=.5*Ae*(U*J+He*Pe*E)+.5,Xt=zt*dn-On*Yt;y=(Je*zt-tt*On)/Xt,w=(tt*dn-Je*Yt)/Xt,s=Vt(s-y,-Math.PI,Math.PI),u=Vt(u-w,-wg,wg)}while((Math.abs(y)>g||Math.abs(w)>g)&&--f>0);return new Qr(dt(s),dt(u))}}class Zp extends _c{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(De(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:u}=this;return{x:De(e)*u*s+.5,y:-Math.sin(De(i))/u*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:u}=this,f=-(i-.5)/s,g=Vt(dt((e-.5)/s)/u,-180,180),y=Math.asin(Vt(f*u,-1,1)),w=Vt(dt(y),-Ws,Ws);return new Qr(g,w)}}class ty extends Yp{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,s){const u=Md(e,i,s);return Ss(u,u,_u(Ya(s))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,i){const s=gu(i.lat,i.lng),u=Ta([],s),f=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Td(s,s,u,Ol(1,0)*Ai*f);const g=dl(new Float64Array(16));return pu(g,e.pixelMatrix,e.globeMatrix),Ss(s,s,g),new Fe(s[0],s[1])}pixelsPerMeter(e,i){return Ol(1,0)*i}pixelSpaceConversion(e,i,s){const u=Ol(1,e)*i,f=K(Ol(1,45)*i,u,s);return this.pixelsPerMeter(e,i)/f}createTileMatrix(e,i,s){const u=tp(Ya(s.canonical));return pu(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,i){const{center:s}=e,u=_u(Ya(i));return Vf(u,u,De(s.lng)),$f(u,u,De(s.lat)),Rl(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,i,s,u){return Jf(e,i,s,!0)||new Mc(0,0)}pointCoordinate3D(e,i,s){const u=this.pointCoordinate(e,i,s,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,i){return!Jf(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(u,f){const g=u.cameraToCenterDistance,y=u._centerAltitude*f,w=u._camera,E=u._camera.forward(),k=Gl([],hl([],E,-g),[0,0,y]),z=u.worldSize/(2*Math.PI),U=[0,0,-z],Y=u.width/u.height,J=Math.tan(u.fovAboveCenter),oe=hl([],w.up(),J),_e=hl([],w.right(),J*Y),Pe=Ta([],Gl([],Gl([],E,oe),_e)),qe=[];let Ae;if(new Bu(k,Pe).closestPointOnSphere(U,z,qe)){const He=Gl([],qe,U),tt=Wl([],He,k);Ae=Math.cos(u.fovAboveCenter)*Cd(tt)}else{const He=Wl([],k,U),tt=Wl([],U,k);Ta(tt,tt);const Je=Cd(He)-z;Ae=Math.sqrt(Je*(Je+2*z));const Yt=Math.acos(Ae/(z+Je))-Math.acos(Wa(E,tt));Ae*=Math.cos(Yt)}return 1.01*Ae}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Uu(e.zoom);if(s>0){const u=Wp(e,Ol(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return K(i,u+f*(1-Math.cos(g)),Math.pow(s,10))}return i}upVector(e,i,s){return Md(i,s,e,1)}upVectorScale(e){return{metersToTile:zu(Ih(Ya(e)))}}}function Eg(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new Yp(n);case"equirectangular":return new bg(n);case"naturalEarth":return new Q_(n);case"equalEarth":return new Kd(n);case"winkelTripel":return new ey(n);case"albers":return i?new Zp(n):new ud(n);case"lambertConformalConic":return i?new Zp(n):new qp(n);case"globe":return new ty(n)}throw new Error(`Invalid projection name: ${n.name}`)}const ny=Rc.types,iy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Jd(n,e,i,s,u,f,g,y,w,E,k,z,U){const Y=y?Math.min(gc,Math.round(y[0])):0,J=y?Math.min(gc,Math.round(y[1])):0;n.emplaceBack(e,i,Math.round(32*s),Math.round(32*u),f,g,(Y<<1)+(w?1:0),J,16*E,16*k,256*z,256*U)}function Qd(n,e,i,s,u,f,g){n.emplaceBack(e,i,s,u,f,g)}function pf(n,e,i,s,u){n.emplaceBack(e,i,s,u),n.emplaceBack(e,i,s,u),n.emplaceBack(e,i,s,u),n.emplaceBack(e,i,s,u)}function ry(n){for(const e of n.sections)if($l(e.text))return!0;return!1}class Na{constructor(e){this.layoutVertexArray=new Mn,this.indexArray=new mi,this.programConfigurations=e,this.segments=new is,this.dynamicLayoutVertexArray=new Rn,this.opacityVertexArray=new Ei,this.placedSymbolArray=new cs,this.globeExtVertexArray=new Vn}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,i,s,u){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,F_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,N_.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,iy,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,B_.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}O(Na,"SymbolBuffers");class Xp{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new is,this.collisionVertexArray=new _r,this.collisionVertexArrayExt=new dr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Tv.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Sv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}O(Xp,"CollisionBuffers");class Uc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=dl([]),this.placementViewportMatrix=dl([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=kc(this.zoom,i["text-size"]),this.iconSizeData=kc(this.zoom,i["icon-size"]);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(g=>sl[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Na(new Cc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Na(new Cc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Hs,this.lineVertexArray=new du,this.symbolInstances=new ro}calculateGlyphDependencies(e,i,s,u,f){for(let g=0;g<e.length;g++)if(i[e.charCodeAt(g)]=!0,u&&f){const y=pc[e.charAt(g)];y&&(i[y.charCodeAt(0)]=!0)}}populate(e,i,s,u){const f=this.layers[0],g=f.layout,y="globe"===this.projection.name,w=g.get("text-font"),E=g.get("text-field"),k=g.get("icon-image"),z=("constant"!==E.value.kind||E.value.value instanceof Ii&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==w.value.kind||w.value.value.length>0),U="constant"!==k.value.kind||!!k.value.value||Object.keys(k.parameters).length>0,Y=g.get("symbol-sort-key");if(this.features=[],!z&&!U)return;const J=i.iconDependencies,oe=i.glyphDependencies,_e=i.availableImages,Pe=new N(this.zoom);for(const{feature:qe,id:Ae,index:He,sourceLayerIndex:tt}of e){const Je=f._featureFilter.needGeometry,Yt=Hu(qe,Je);if(!f._featureFilter.filter(Pe,Yt,s))continue;if(Je||(Yt.geometry=uc(qe,s,u)),y&&1!==qe.type&&s.z<=5){const Xt=Yt.geometry,En=.98078528056,Dn=(An,Bn)=>Wa(Md(An.x,An.y,s,1),Md(Bn.x,Bn.y,s,1))<En;for(let An=0;An<Xt.length;An++)Xt[An]=Lm(Xt[An],Dn)}let zt,dn;if(z){const Xt=f.getValueAndResolveTokens("text-field",Yt,s,_e),En=Ii.factory(Xt);ry(En)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===x()||this.hasRTLText&&A.isParsed())&&(zt=tf(En,f,Yt))}if(U){const Xt=f.getValueAndResolveTokens("icon-image",Yt,s,_e);dn=Xt instanceof Cr?Xt:Cr.fromString(Xt)}if(!zt&&!dn)continue;const On=this.sortFeaturesByKey?Y.evaluate(Yt,{},s):void 0;if(this.features.push({id:Ae,text:zt,icon:dn,index:He,sourceLayerIndex:tt,geometry:Yt.geometry,properties:qe.properties,type:ny[qe.type],sortKey:On}),dn&&(J[dn.name]=!0),zt){const Xt=w.evaluate(Yt,{},s).join(","),En="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(sl.vertical)>=0;for(const Dn of zt.sections)if(Dn.image)J[Dn.image.name]=!0;else{const An=et(zt.toString()),Bn=Dn.fontStack||Xt,ln=oe[Bn]=oe[Bn]||{};this.calculateGlyphDependencies(Dn.text,ln,En,this.allowVerticalPlacement,An)}}}"line"===g.get("symbol-placement")&&(this.features=function(qe){const Ae={},He={},tt=[];let Je=0;function Yt(Xt){tt.push(qe[Xt]),Je++}function zt(Xt,En,Dn){const An=He[Xt];return delete He[Xt],He[En]=An,tt[An].geometry[0].pop(),tt[An].geometry[0]=tt[An].geometry[0].concat(Dn[0]),An}function dn(Xt,En,Dn){const An=Ae[En];return delete Ae[En],Ae[Xt]=An,tt[An].geometry[0].shift(),tt[An].geometry[0]=Dn[0].concat(tt[An].geometry[0]),An}function On(Xt,En,Dn){const An=Dn?En[0][En[0].length-1]:En[0][0];return`${Xt}:${An.x}:${An.y}`}for(let Xt=0;Xt<qe.length;Xt++){const En=qe[Xt],Dn=En.geometry,An=En.text?En.text.toString():null;if(!An){Yt(Xt);continue}const Bn=On(An,Dn),ln=On(An,Dn,!0);if(Bn in He&&ln in Ae&&He[Bn]!==Ae[ln]){const Qn=dn(Bn,ln,Dn),hi=zt(Bn,ln,tt[Qn].geometry);delete Ae[Bn],delete He[ln],He[On(An,tt[hi].geometry,!0)]=hi,tt[Qn].geometry=null}else Bn in He?zt(Bn,ln,Dn):ln in Ae?dn(Bn,ln,Dn):(Yt(Xt),Ae[Bn]=Je-1,He[ln]=Je-1)}return tt.filter(Xt=>Xt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((qe,Ae)=>qe.sortKey-Ae.sortKey)}update(e,i,s,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,s,u),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,s,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Eg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:u,y:f}of i)this.lineVertexArray.emplaceBack(u,f);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,u,f,g,y,w,E,k,z,U,Y,J){const oe=e.indexArray,_e=e.layoutVertexArray,Pe=e.globeExtVertexArray,qe=e.segments.prepareSegment(4*i.length,_e,oe,this.canOverlap?g.sortKey:void 0),Ae=this.glyphOffsetArray.length,He=qe.vertexLength,tt=this.allowVerticalPlacement&&y===sl.vertical?Math.PI/2:0,Je=g.text&&g.text.sections;for(let zt=0;zt<i.length;zt++){const{tl:dn,tr:On,bl:Xt,br:En,tex:Dn,pixelOffsetTL:An,pixelOffsetBR:Bn,minFontScaleX:ln,minFontScaleY:Qn,glyphOffset:hi,isSDF:ni,sectionIndex:er}=i[zt],jn=qe.vertexLength,Ci=hi[1];if(Jd(_e,E.x,E.y,dn.x,Ci+dn.y,Dn.x,Dn.y,s,ni,An.x,An.y,ln,Qn),Jd(_e,E.x,E.y,On.x,Ci+On.y,Dn.x+Dn.w,Dn.y,s,ni,Bn.x,An.y,ln,Qn),Jd(_e,E.x,E.y,Xt.x,Ci+Xt.y,Dn.x,Dn.y+Dn.h,s,ni,An.x,Bn.y,ln,Qn),Jd(_e,E.x,E.y,En.x,Ci+En.y,Dn.x+Dn.w,Dn.y+Dn.h,s,ni,Bn.x,Bn.y,ln,Qn),w){const{x:tr,y:Nr,z:nr}=w.anchor,[Li,Oo,hr]=w.up;Qd(Pe,tr,Nr,nr,Li,Oo,hr),Qd(Pe,tr,Nr,nr,Li,Oo,hr),Qd(Pe,tr,Nr,nr,Li,Oo,hr),Qd(Pe,tr,Nr,nr,Li,Oo,hr),pf(e.dynamicLayoutVertexArray,tr,Nr,nr,tt)}else pf(e.dynamicLayoutVertexArray,E.x,E.y,E.z,tt);oe.emplaceBack(jn,jn+1,jn+2),oe.emplaceBack(jn+1,jn+2,jn+3),qe.vertexLength+=4,qe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(hi[0]),zt!==i.length-1&&er===i[zt+1].sectionIndex||e.programConfigurations.populatePaintArrays(_e.length,g,g.index,{},Y,J,Je&&Je[er])}const Yt=w?w.anchor:E;e.placedSymbolArray.emplaceBack(Yt.x,Yt.y,Yt.z,E.x,E.y,Ae,this.glyphOffsetArray.length-Ae,He,k,z,E.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],y,0,!1,0,U,0)}_commitLayoutVertex(e,i,s,u,f,g,y){e.emplaceBack(i,s,u,f,g,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,i,s,u,f,g,y){const w=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),E=w.vertexLength,k=y.tileAnchorX,z=y.tileAnchorY;for(let Y=0;Y<4;Y++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,u,f,g,k,z,new Fe(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,g,k,z,new Fe(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,g,k,z,new Fe(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,u,f,g,k,z,new Fe(e.x1,e.y2)),w.vertexLength+=4;const U=s.indexArray;U.emplaceBack(E,E+1),U.emplaceBack(E+1,E+2),U.emplaceBack(E+2,E+3),U.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,u,f,g){for(let y=u;y<f;y++){const w=s.get(y),E=this.getSymbolInstanceTextSize(e,g,i,y);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,i,s,u,f,g){for(let y=u;y<f;y++){const w=s.get(y),E=this.getSymbolInstanceIconSize(e,i,g.placedIconSymbolIndex);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Xp(di,Gd.members,io),this.iconCollisionBox=new Xp(di,Gd.members,io);const s=Lc(this.iconSizeData,e),u=Lc(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(u,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(u,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,s,u){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),g=ed(this.textSizeData,e,f)/qs;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,i,s){const u=this.icon.placedSymbolArray.get(s),f=ed(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,i,s){e.emplaceBack(i,-s,-s),e.emplaceBack(i,s,-s),e.emplaceBack(i,s,s),e.emplaceBack(i,-s,s)}_updateTextDebugCollisionBoxes(e,i,s,u,f,g){for(let y=u;y<f;y++){const w=s.get(y),E=this.getSymbolInstanceTextSize(e,g,i,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding)}}_updateIconDebugCollisionBoxes(e,i,s,u,f,g){for(let y=u;y<f;y++){const w=s.get(y),E=this.getSymbolInstanceIconSize(e,i,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Lc(this.iconSizeData,e),u=Lc(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(u,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(u,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(s,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,u,f,g,y,w,E){const k={};if(i<s){const{x1:z,y1:U,x2:Y,y2:J,padding:oe,projectedAnchorX:_e,projectedAnchorY:Pe,projectedAnchorZ:qe,tileAnchorX:Ae,tileAnchorY:He,featureIndex:tt}=e.get(i);k.textBox={x1:z,y1:U,x2:Y,y2:J,padding:oe,projectedAnchorX:_e,projectedAnchorY:Pe,projectedAnchorZ:qe,tileAnchorX:Ae,tileAnchorY:He},k.textFeatureIndex=tt}if(u<f){const{x1:z,y1:U,x2:Y,y2:J,padding:oe,projectedAnchorX:_e,projectedAnchorY:Pe,projectedAnchorZ:qe,tileAnchorX:Ae,tileAnchorY:He,featureIndex:tt}=e.get(u);k.verticalTextBox={x1:z,y1:U,x2:Y,y2:J,padding:oe,projectedAnchorX:_e,projectedAnchorY:Pe,projectedAnchorZ:qe,tileAnchorX:Ae,tileAnchorY:He},k.verticalTextFeatureIndex=tt}if(g<y){const{x1:z,y1:U,x2:Y,y2:J,padding:oe,projectedAnchorX:_e,projectedAnchorY:Pe,projectedAnchorZ:qe,tileAnchorX:Ae,tileAnchorY:He,featureIndex:tt}=e.get(g);k.iconBox={x1:z,y1:U,x2:Y,y2:J,padding:oe,projectedAnchorX:_e,projectedAnchorY:Pe,projectedAnchorZ:qe,tileAnchorX:Ae,tileAnchorY:He},k.iconFeatureIndex=tt}if(w<E){const{x1:z,y1:U,x2:Y,y2:J,padding:oe,projectedAnchorX:_e,projectedAnchorY:Pe,projectedAnchorZ:qe,tileAnchorX:Ae,tileAnchorY:He,featureIndex:tt}=e.get(w);k.verticalIconBox={x1:z,y1:U,x2:Y,y2:J,padding:oe,projectedAnchorX:_e,projectedAnchorY:Pe,projectedAnchorZ:qe,tileAnchorX:Ae,tileAnchorY:He},k.verticalIconFeatureIndex=tt}return k}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),u=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),u=[],f=[],g=[];for(let y=0;y<this.symbolInstances.length;++y){g.push(y);const w=this.symbolInstances.get(y);u.push(0|Math.round(i*w.tileAnchorX+s*w.tileAnchorY)),f.push(w.featureIndex)}return g.sort((y,w)=>u[y]-u[w]||f[w]-f[y]),g}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:E}=s;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),f>=0&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),g>=0&&g!==f&&g!==u&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}O(Uc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Uc.MAX_GLYPHS=65535,Uc.addDynamicAttributes=pf;const Ov=new $e({"symbol-placement":new re(Gt.layout_symbol["symbol-placement"]),"symbol-spacing":new re(Gt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new re(Gt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new we(Gt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new re(Gt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new re(Gt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new re(Gt.layout_symbol["icon-ignore-placement"]),"icon-optional":new re(Gt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new re(Gt.layout_symbol["icon-rotation-alignment"]),"icon-size":new we(Gt.layout_symbol["icon-size"]),"icon-text-fit":new re(Gt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new re(Gt.layout_symbol["icon-text-fit-padding"]),"icon-image":new we(Gt.layout_symbol["icon-image"]),"icon-rotate":new we(Gt.layout_symbol["icon-rotate"]),"icon-padding":new re(Gt.layout_symbol["icon-padding"]),"icon-keep-upright":new re(Gt.layout_symbol["icon-keep-upright"]),"icon-offset":new we(Gt.layout_symbol["icon-offset"]),"icon-anchor":new we(Gt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new re(Gt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new re(Gt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new re(Gt.layout_symbol["text-rotation-alignment"]),"text-field":new we(Gt.layout_symbol["text-field"]),"text-font":new we(Gt.layout_symbol["text-font"]),"text-size":new we(Gt.layout_symbol["text-size"]),"text-max-width":new we(Gt.layout_symbol["text-max-width"]),"text-line-height":new we(Gt.layout_symbol["text-line-height"]),"text-letter-spacing":new we(Gt.layout_symbol["text-letter-spacing"]),"text-justify":new we(Gt.layout_symbol["text-justify"]),"text-radial-offset":new we(Gt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new re(Gt.layout_symbol["text-variable-anchor"]),"text-anchor":new we(Gt.layout_symbol["text-anchor"]),"text-max-angle":new re(Gt.layout_symbol["text-max-angle"]),"text-writing-mode":new re(Gt.layout_symbol["text-writing-mode"]),"text-rotate":new we(Gt.layout_symbol["text-rotate"]),"text-padding":new re(Gt.layout_symbol["text-padding"]),"text-keep-upright":new re(Gt.layout_symbol["text-keep-upright"]),"text-transform":new we(Gt.layout_symbol["text-transform"]),"text-offset":new we(Gt.layout_symbol["text-offset"]),"text-allow-overlap":new re(Gt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new re(Gt.layout_symbol["text-ignore-placement"]),"text-optional":new re(Gt.layout_symbol["text-optional"])});var eh={paint:new $e({"icon-opacity":new we(Gt.paint_symbol["icon-opacity"]),"icon-color":new we(Gt.paint_symbol["icon-color"]),"icon-halo-color":new we(Gt.paint_symbol["icon-halo-color"]),"icon-halo-width":new we(Gt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new we(Gt.paint_symbol["icon-halo-blur"]),"icon-translate":new re(Gt.paint_symbol["icon-translate"]),"icon-translate-anchor":new re(Gt.paint_symbol["icon-translate-anchor"]),"text-opacity":new we(Gt.paint_symbol["text-opacity"]),"text-color":new we(Gt.paint_symbol["text-color"],{runtimeType:Oe,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new we(Gt.paint_symbol["text-halo-color"]),"text-halo-width":new we(Gt.paint_symbol["text-halo-width"]),"text-halo-blur":new we(Gt.paint_symbol["text-halo-blur"]),"text-translate":new re(Gt.paint_symbol["text-translate"]),"text-translate-anchor":new re(Gt.paint_symbol["text-translate-anchor"])}),layout:Ov};class Kp{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Lo,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}O(Kp,"FormatSectionOverride",{omit:["defaultValue"]});class mf extends il{constructor(e){super(e,eh)}recalculate(e,i){super.recalculate(e,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const f of s)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,s,u){const f=this.layout.get(e).evaluate(i,{},s,u),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Cs(g.value)||!f?f:(y=i.properties,f.replace(/{([^{}]+)}/g,(E,k)=>k in y?String(y[k]):""));var y}createBucket(e){return new Uc(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of eh.paint.overridableProperties){if(!mf.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new Kp(i),u=new qo(s,i.property.specification);let f=null;f="constant"===i.value.kind||"source"===i.value.kind?new Zo("source",u):new xa("composite",u,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Ce(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&mf.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),u=eh.paint.properties[i];let f=!1;const g=y=>{for(const w of y)if(u.overrides&&u.overrides.hasOverride(w))return void(f=!0)};if("constant"===s.value.kind&&s.value.value instanceof Ii)g(s.value.value.sections);else if("source"===s.value.kind){const y=E=>{f||(E instanceof hs&&ur(E.value)===Mt?g(E.value.sections):E instanceof Ti?g(E.sections):E.eachChild(y))},w=s.value;w._styleExpression&&y(w._styleExpression.expression)}return f}getProgramConfiguration(e){return new fu(this,e)}}var oy={paint:new $e({"background-color":new re(Gt.paint_background["background-color"]),"background-pattern":new re(Gt.paint_background["background-pattern"]),"background-opacity":new re(Gt.paint_background["background-opacity"])})},sy={paint:new $e({"raster-opacity":new re(Gt.paint_raster["raster-opacity"]),"raster-hue-rotate":new re(Gt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new re(Gt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new re(Gt.paint_raster["raster-brightness-max"]),"raster-saturation":new re(Gt.paint_raster["raster-saturation"]),"raster-contrast":new re(Gt.paint_raster["raster-contrast"]),"raster-resampling":new re(Gt.paint_raster["raster-resampling"]),"raster-fade-duration":new re(Gt.paint_raster["raster-fade-duration"])})};class Dg extends il{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var ay={paint:new $e({"sky-type":new re(Gt.paint_sky["sky-type"]),"sky-atmosphere-sun":new re(Gt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new re(Gt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new re(Gt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new re(Gt.paint_sky["sky-gradient-radius"]),"sky-gradient":new ze(Gt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new re(Gt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new re(Gt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new re(Gt.paint_sky["sky-opacity"])})};function Jp(n,e,i){const s=[0,0,1],u=Wf([]);return Yf(u,u,i?-De(n)+Math.PI:De(n)),qf(u,u,-De(e)),wh(s,s,u),Ta(s,s)}const Qp={circle:class extends il{constructor(n){super(n,Vm)}createBucket(n){return new Oh(n)}queryRadius(n){const e=n;return Wu("circle-radius",this,e)+Wu("circle-stroke-width",this,e)+kd(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,s,u,f,g,y){const w=$m(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return cp(n,s,f,g,y,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),w,E)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new fu(this,n)}},heatmap:class extends il{createBucket(n){return new Um(n)}constructor(n){super(n,$h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"heatmap-color"===n&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Fd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Wu("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,s,u,f,g,y){const w=this.paint.get("heatmap-radius").evaluate(e,i);return cp(n,s,f,g,y,!0,!0,new Fe(0,0),w)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new fu(this,n)}},hillshade:class extends il{constructor(n){super(n,Hm)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends il{constructor(n){super(n,Yh)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(n){return new fu(this,n)}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new qh(n)}queryRadius(){return kd(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,s,u,f){return!n.queryGeometry.isAboveHorizon&&kh(zm(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends il{constructor(n){super(n,wp)}createBucket(n){return new Ju(n)}queryRadius(){return kd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new fu(this,n)}queryIntersectsFeature(n,e,i,s,u,f,g,y,w){const E=$m(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(e,i),z=this.paint.get("fill-extrusion-base").evaluate(e,i),U=[0,0],Y=y&&f.elevation,J=f.elevation?f.elevation.exaggeration():1,oe=n.tile.getBucket(this);if(Y&&oe instanceof Ju){const He=oe.centroidVertexArray,tt=w+1;tt<He.length&&(U[0]=He.geta_centroid_pos0(tt),U[1]=He.geta_centroid_pos1(tt))}if(0===U[0]&&1===U[1])return!1;"globe"===f.projection.name&&(s=Oc([s],[new Fe(0,0),new Fe(Ai,Ai)],n.tileID.canonical).map(He=>He.polygon).flat());const _e=Y?y:null,[Pe,qe]=(tt=s,Je=z,Yt=k,zt=E,dn=g,On=_e,Xt=U,En=J,Dn=f.center.lat,"globe"===(He=f).projection.name?function(Bn,ln,Qn,hi,ni,er,jn,Ci,tr,Nr,nr){const Li=[],Oo=[],hr=Bn.projection.upVectorScale(nr,Bn.center.lat,Bn.worldSize).metersToTile,fr=[0,0,0,1],wo=[0,0,0,1],Io=(Eo,rs,us,Ms)=>{Eo[0]=rs,Eo[1]=us,Eo[2]=Ms,Eo[3]=1},ko=bp();Qn>0&&(Qn+=ko),hi+=ko;for(const Eo of ln){const rs=[],us=[];for(const Ms of Eo){const Do=Ms.x+ni.x,ys=Ms.y+ni.y,Ko=Bn.projection.projectTilePoint(Do,ys,nr),Vo=Bn.projection.upVector(nr,Ms.x,Ms.y);let Fr=Qn,vs=hi;if(jn){const to=rg(Do,ys,Qn,hi,jn,Ci,tr,Nr);Fr+=to.base,vs+=to.top}0!==Qn?Io(fr,Ko.x+Vo[0]*hr*Fr,Ko.y+Vo[1]*hr*Fr,Ko.z+Vo[2]*hr*Fr):Io(fr,Ko.x,Ko.y,Ko.z),Io(wo,Ko.x+Vo[0]*hr*vs,Ko.y+Vo[1]*hr*vs,Ko.z+Vo[2]*hr*vs),Ss(fr,fr,er),Ss(wo,wo,er),rs.push(new fc(fr[0],fr[1],fr[2])),us.push(new fc(wo[0],wo[1],wo[2]))}Li.push(rs),Oo.push(us)}return[Li,Oo]}(He,tt,Je,Yt,zt,dn,On,Xt,En,Dn,n.tileID.canonical):On?function(Bn,ln,Qn,hi,ni,er,jn,Ci,tr){const Nr=[],nr=[],Li=[0,0,0,1];for(const Oo of Bn){const hr=[],fr=[];for(const wo of Oo){const Io=wo.x+hi.x,ko=wo.y+hi.y,Eo=rg(Io,ko,ln,Qn,er,jn,Ci,tr);Li[0]=Io,Li[1]=ko,Li[2]=Eo.base,Li[3]=1,ql(Li,Li,ni),Li[3]=Math.max(Li[3],1e-5);const rs=new fc(Li[0]/Li[3],Li[1]/Li[3],Li[2]/Li[3]);Li[0]=Io,Li[1]=ko,Li[2]=Eo.top,Li[3]=1,ql(Li,Li,ni),Li[3]=Math.max(Li[3],1e-5);const us=new fc(Li[0]/Li[3],Li[1]/Li[3],Li[2]/Li[3]);hr.push(rs),fr.push(us)}Nr.push(hr),nr.push(fr)}return[Nr,nr]}(tt,Je,Yt,zt,dn,On,Xt,En,Dn):function(Bn,ln,Qn,hi,ni){const er=[],jn=[],Ci=ni[8]*ln,tr=ni[9]*ln,Nr=ni[10]*ln,nr=ni[11]*ln,Li=ni[8]*Qn,Oo=ni[9]*Qn,hr=ni[10]*Qn,fr=ni[11]*Qn;for(const wo of Bn){const Io=[],ko=[];for(const Eo of wo){const rs=Eo.x+hi.x,us=Eo.y+hi.y,Ms=ni[0]*rs+ni[4]*us+ni[12],Do=ni[1]*rs+ni[5]*us+ni[13],ys=ni[2]*rs+ni[6]*us+ni[14],Ko=ni[3]*rs+ni[7]*us+ni[15],Vo=Ms+Ci,Fr=Do+tr,vs=ys+Nr,to=Math.max(Ko+nr,1e-5),ba=Ms+Li,As=Do+Oo,Ps=ys+hr,ea=Math.max(Ko+fr,1e-5);Io.push(new fc(Vo/to,Fr/to,vs/to)),ko.push(new fc(ba/ea,As/ea,Ps/ea))}er.push(Io),jn.push(ko)}return[er,jn]}(tt,Je,Yt,zt,dn)),Ae=n.queryGeometry;var He,tt,Je,Yt,zt,dn,On,Xt,En,Dn;return function(He,tt,Je){let Yt=1/0;kh(Je,tt)&&(Yt=ig(Je,tt[0]));for(let zt=0;zt<tt.length;zt++){const dn=tt[zt],On=He[zt];for(let Xt=0;Xt<dn.length-1;Xt++){const En=dn[Xt],Dn=[En,dn[Xt+1],On[Xt+1],On[Xt],En];lp(Je,Dn)&&(Yt=Math.min(Yt,ig(Je,Dn)))}}return Yt!==1/0&&Yt}(Pe,qe,Ae.isPointQuery()?Ae.screenBounds:Ae.screenGeometry)}},line:class extends il{constructor(n){super(n,Dp),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if("line-gradient"===n){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof T,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=ef.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Hd(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new fu(this,n)}queryRadius(n){const e=n,i=L_(Wu("line-width",this,e),Wu("line-gap-width",this,e)),s=Wu("line-offset",this,e);return i/2+Math.abs(s)+kd(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,s,u,f){if(n.queryGeometry.isAboveHorizon)return!1;const g=zm(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),y=n.pixelToTileUnitsFactor/2*L_(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),w=this.paint.get("line-offset").evaluate(e,i);return w&&(s=function(E,k){const z=[],U=new Fe(0,0);for(let Y=0;Y<E.length;Y++){const J=E[Y],oe=[];for(let _e=0;_e<J.length;_e++){const Pe=J[_e],qe=J[_e+1],Ae=0===_e?U:Pe.sub(J[_e-1])._unit()._perp(),He=_e===J.length-1?U:qe.sub(Pe)._unit()._perp(),tt=Ae._add(He)._unit();tt._mult(1/(tt.x*He.x+tt.y*He.y)),oe.push(tt._mult(k)._add(Pe))}z.push(oe)}return z}(s,w*n.pixelToTileUnitsFactor)),function(E,k,z){for(let U=0;U<k.length;U++){const Y=k[U];if(E.length>=3)for(let J=0;J<Y.length;J++)if(Ac(E,Y[J]))return!0;if(Nm(E,Y,z))return!0}return!1}(g,s,y)}isTileClipped(){return!0}},symbol:mf,background:class extends il{constructor(n){super(n,oy)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends il{constructor(n){super(n,sy)}getProgramIds(){return["raster"]}},sky:class extends il{constructor(n){super(n,ay),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"sky-gradient"===n?this._updateColorRamp():"sky-atmosphere-sun"!==n&&"sky-atmosphere-halo-color"!==n&&"sky-atmosphere-color"!==n&&"sky-atmosphere-sun-intensity"!==n||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Fd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),u=!s,f=n.style.light,g=f.properties.get("position");return u&&"viewport"===f.properties.get("anchor")&&xn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Jp(g.azimuthal,90-g.polar,e):Jp(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return Jp(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return"atmosphere"===n?["skyboxCapture","skybox"]:"gradient"===n?["skyboxGradient"]:null}}};class th{constructor(e,i,s,u){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,s){const{width:u,height:f}=e,{context:g}=this,{gl:y}=g,{HTMLImageElement:w,HTMLCanvasElement:E,HTMLVideoElement:k,ImageData:z,ImageBitmap:U}=Me;if(y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!i||!1!==i.premultiply)),s||this.size&&this.size[0]===u&&this.size[1]===f){const{x:Y,y:J}=s||{x:0,y:0};e instanceof w||e instanceof E||e instanceof k||e instanceof z||U&&e instanceof U?y.texSubImage2D(y.TEXTURE_2D,0,Y,J,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,Y,J,u,f,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[u,f],e instanceof w||e instanceof E||e instanceof k||e instanceof z||U&&e instanceof U?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,u,f,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=!!(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,i){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class ly{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class cy{constructor(){this.tasks={},this.taskQueue=[],Zn(["process"],this),this.invoker=new ly(this.process),this.nextId=0}add(e,i){const s=this.nextId++,u=function({type:f,isSymbolTile:g,zoom:y}){return y=y||0,"message"===f?0:"maybePrepare"!==f||g?"parseTile"!==f||g?"parseTile"===f&&g?300-y:"maybePrepare"===f&&g?400-y:500:200-y:100-y}(i);if(0===u){qn();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:i,priority:u,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){qn();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<i&&(i=f.priority,e=u)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class Cg{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const uy=["tile","layer","source","sourceLayer","state"];class kl{constructor(e,i,s,u,f){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=u,this.properties=e.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const i of uy)void 0!==this[i]&&(e[i]=this[i]);return e}}const yc=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,i=0,s=0,u=0,f=0,g=0,y=0;for(1&e?u=f=g=32:i=s=y=32;(e>>=1)>1;){const E=i+u>>1,k=s+f>>1;1&e?(u=i,f=s,i=g,s=y):(i=u,s=f,u=g,f=y),g=E,y=k}const w=4*n;yc[w+0]=i,yc[w+1]=s,yc[w+2]=u,yc[w+3]=f}const tc=new Uint16Array(2178),vc=new Uint8Array(1089),nh=new Uint16Array(1089);function ih(n){return 0===n?-.03125:32===n?.03125:0}var gf=Pt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const dy={type:2,extent:Ai,loadGeometry:()=>[[new Fe(0,0),new Fe(Ai+1,0),new Fe(Ai+1,Ai+1),new Fe(0,Ai+1),new Fe(0,0)]]};class _f{constructor(e,i,s,u,f){this.tileID=e,this.uid=at(),this.uses=0,this.tileSize=i,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Dr.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=sr(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,f){const g={};if(!f)return g;for(const y of u){const w=y.layerIds.map(E=>f.getLayer(E)).filter(Boolean);if(0!==w.length){y.layers=w,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(E=>w.filter(k=>k.id===E)[0]));for(const E of w)g[E.id]=y}}return g}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof Uc){if(this.hasSymbolBuckets=!0,!s)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof Uc&&f.hasRTLText){this.hasRTLText=!0,A.isLoading()||A.isLoaded()||"deferred"!==x()||C();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(u).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new bo}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const u=this.buckets[s];u.uploadPending()&&u.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new th(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new th(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new th(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,s,u,f,g,y,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:y,transform:g,params:f,tileTransform:this.tileTransform},e,i,s):{}}querySourceFeatures(e,i){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const u=s.loadVTLayers(),f=i?i.sourceLayer:"",g=u._geojsonTileLayer||u[f];if(!g)return;const y=iu(i&&i.filter),{z:w,x:E,y:k}=this.tileID.canonical,z={z:w,x:E,y:k};for(let U=0;U<g.length;U++){const Y=g.feature(U);if(y.needGeometry){const _e=Hu(Y,!0);if(!y.filter(new N(this.tileID.overscaledZ),_e,this.tileID.canonical))continue}else if(!y.filter(new N(this.tileID.overscaledZ),Y))continue;const J=s.getId(Y,f),oe=new kl(Y,w,E,k,J);oe.tile=z,e.push(oe)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const s=ti(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let u=!1;if(this.expirationTime>s)u=!1;else if(i)if(this.expirationTime<i)u=!0;else{const f=this.expirationTime-i;f?this.expirationTime=s+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!i)return;const s=this.latestFeatureIndex.loadVTLayers(),u=i.style.listImages();for(const f in this.buckets){if(!i.style.hasLayer(f))continue;const g=this.buckets[f],y=g.layers[0].sourceLayer||"_geojsonTileLayer",w=s[y],E=e[y];if(!w||!E||0===Object.keys(E).length)continue;if(g.update(E,w,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof Hd||g instanceof qh){const z=i.style._getSourceCache(g.layers[0].source);i._terrain&&i._terrain.enabled&&z&&g.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(z.id,this.tileID)}const k=i&&i.style&&i.style.getLayer(f);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(g)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Dr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Dr.now()+e}setTexture(e,i){const s=i.context,u=s.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new th(s,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(e,i){const s={};for(const u of i)s[u]=!0;this.dependencies[e]=s}hasDependency(e,i){for(const s of e){const u=this.dependencies[s];if(u)for(const f of i)if(u[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const s=uc(dy,this.tileID.canonical,this.tileTransform)[0],u=new Fn,f=new Ga;for(let g=0;g<s.length;g++){const{x:y,y:w}=s[g];u.emplaceBack(y,w),f.emplaceBack(g)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(u,Tc.members),this._tileDebugSegments=is.simpleSegment(0,0,u.length,f.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const s=uc(dy,this.tileID.canonical,this.tileTransform)[0];let u,f;if(this.isRaster){const g=function(y,w){const E=sr(y,w),k=Math.pow(2,y.z);for(let _e=0;_e<33;_e++)for(let Pe=0;Pe<33;Pe++){const qe=rl((y.x+(Pe+ih(Pe))/32)/k),Ae=ga((y.y+(_e+ih(_e))/32)/k),He=w.project(qe,Ae),tt=33*_e+Pe;tc[2*tt+0]=Math.round((He.x*E.scale-E.x)*Ai),tc[2*tt+1]=Math.round((He.y*E.scale-E.y)*Ai)}vc.fill(0),nh.fill(0);for(let _e=2045;_e>=0;_e--){const Pe=4*_e,qe=yc[Pe+0],Ae=yc[Pe+1],He=yc[Pe+2],tt=yc[Pe+3],Je=qe+He>>1,Yt=Ae+tt>>1,zt=Je+Yt-Ae,dn=Yt+qe-Je,On=33*Ae+qe,Xt=33*tt+He,En=33*Yt+Je,Dn=Math.hypot((tc[2*On+0]+tc[2*Xt+0])/2-tc[2*En+0],(tc[2*On+1]+tc[2*Xt+1])/2-tc[2*En+1])>=16;vc[En]=vc[En]||(Dn?1:0),_e<1022&&(vc[En]=vc[En]||vc[33*(Ae+dn>>1)+(qe+zt>>1)]||vc[33*(tt+dn>>1)+(He+zt>>1)])}const z=new gn,U=new mi;let Y=0;function J(_e,Pe){const qe=33*Pe+_e;return 0===nh[qe]&&(z.emplaceBack(tc[2*qe+0],tc[2*qe+1],_e*Ai/32,Pe*Ai/32),nh[qe]=++Y),nh[qe]-1}function oe(_e,Pe,qe,Ae,He,tt){const Je=_e+qe>>1,Yt=Pe+Ae>>1;if(Math.abs(_e-He)+Math.abs(Pe-tt)>1&&vc[33*Yt+Je])oe(He,tt,_e,Pe,Je,Yt),oe(qe,Ae,He,tt,Je,Yt);else{const zt=J(_e,Pe),dn=J(qe,Ae),On=J(He,tt);U.emplaceBack(zt,dn,On)}}return oe(0,0,32,32,32,0),oe(32,32,0,0,0,32),{vertices:z,indices:U}}(this.tileID.canonical,i);u=g.vertices,f=g.indices}else{u=new gn,f=new mi;for(const{x:y,y:w}of s)u.emplaceBack(y,w,0,0);const g=Jm(u.int16,void 0,4);for(let y=0;y<g.length;y+=3)f.emplaceBack(g[y],g[y+1],g[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,gf.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=is.simpleSegment(0,0,u.length,f.length)}_makeGlobeTileDebugBuffers(e,i){const s=i.projection;if(!s||"globe"!==s.name||i.freezeTileCoverage)return;const u=this.tileID.canonical,f=_u(ep(u,i)),g=Uu(i.zoom);let y;g>0&&(y=zf(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,i,f,y,g),this._makeGlobeTileDebugTextBuffer(e,u,i,f,y,g)}_globePoint(e,i,s,u,f,g,y){let w=Md(e,i,s);if(g){const E=1<<s.z,k=Xl(u.center.lng),z=Kl(u.center.lat),U=(s.x+.5)/E-k;let Y=0;U>.5?Y=-1:U<-.5&&(Y=1);let J=(e/Ai+s.x)/E+Y,oe=(i/Ai+s.y)/E;J=(J-k)*u._pixelsPerMercatorPixel+k,oe=(oe-z)*u._pixelsPerMercatorPixel+z;const _e=[J*u.worldSize,oe*u.worldSize,0];Ss(_e,_e,g),w=Sc(w,_e,y)}return Ss(w,w,f)}_makeGlobeTileDebugBorderBuffer(e,i,s,u,f,g){const y=new Fn,w=new Ga,E=new Ut,k=(U,Y,J,oe,_e)=>{const Pe=(J-U)/(_e-1),qe=(oe-Y)/(_e-1),Ae=y.length;for(let He=0;He<_e;He++){const tt=U+He*Pe,Je=Y+He*qe;y.emplaceBack(tt,Je);const Yt=this._globePoint(tt,Je,i,s,u,f,g);E.emplaceBack(Yt[0],Yt[1],Yt[2]),w.emplaceBack(Ae+He)}},z=Ai;k(0,0,z,0,16),k(z,0,z,z,16),k(z,z,0,z,16),k(0,z,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(w),this._tileDebugBuffer=e.createVertexBuffer(y,Tc.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(E,Id.members),this._tileDebugSegments=is.simpleSegment(0,0,y.length,w.length)}_makeGlobeTileDebugTextBuffer(e,i,s,u,f,g){const y=Ai/4,w=new Fn,E=new mi,k=new Ut,z=25;E.reserve(32),w.reserve(z),k.reserve(z);const U=(Y,J)=>z*Y+J;for(let Y=0;Y<z;Y++){const J=Y*y;for(let oe=0;oe<z;oe++){const _e=oe*y;w.emplaceBack(_e,J);const Pe=this._globePoint(_e,J,i,s,u,f,g);k.emplaceBack(Pe[0],Pe[1],Pe[2])}}for(let Y=0;Y<4;Y++)for(let J=0;J<4;J++){const oe=U(Y,J),_e=U(Y,J+1),Pe=U(Y+1,J),qe=U(Y+1,J+1);E.emplaceBack(oe,_e,Pe),E.emplaceBack(Pe,_e,qe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(E),this._tileDebugTextBuffer=e.createVertexBuffer(w,Tc.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(k,Id.members),this._tileDebugTextSegments=is.simpleSegment(0,0,z,32)}}class Tg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,s){const u=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Re(this.stateChanges[e][u],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const f in this.state[e])f!==u&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][u]){this.deletedStates[e][u]={};for(const f in this.state[e][u])s[f]||(this.deletedStates[e][u][f]=null)}else for(const f in s)this.deletedStates[e]&&this.deletedStates[e][u]&&null===this.deletedStates[e][u][f]&&delete this.deletedStates[e][u][f]}removeFeatureState(e,i,s){if(null===this.deletedStates[e])return;const u=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==i)null!==this.deletedStates[e][u]&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][s]=null);else if(void 0!==i)if(this.stateChanges[e]&&this.stateChanges[e][u])for(s in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][s]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,i){const s=String(i),u=Re({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const f=this.deletedStates[e][i];if(null===f)return{};for(const g in f)delete u[g]}return u}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const s={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const g in this.stateChanges[u])this.state[u][g]||(this.state[u][g]={}),Re(this.state[u][g],this.stateChanges[u][g]),f[g]=this.state[u][g];s[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(null===this.deletedStates[u])for(const g in this.state[u])f[g]={},this.state[u][g]={};else for(const g in this.deletedStates[u]){if(null===this.deletedStates[u][g])this.state[u][g]={};else if(this.state[u][g])for(const y of Object.keys(this.deletedStates[u][g]))delete this.state[u][g][y];f[g]=this.state[u][g]}s[u]=s[u]||{},Re(s[u],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const u in e)e[u].setFeatureState(s,i)}}class em{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function tm(n,e,i,s){let u=0,f=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(s[g])<1e-15){if(i[g]<n[g]||i[g]>e[g])return null}else{const y=1/s[g];let w=(n[g]-i[g])*y,E=(e[g]-i[g])*y;if(w>E){const k=w;w=E,E=k}if(w>u&&(u=w),E<f&&(f=E),u>f)return null}return u}function yf(n,e,i,s,u,f,g,y,w,E,k){const z=s-n,U=u-e,Y=f-i,J=g-n,oe=y-e,_e=w-i,Pe=k[1]*_e-k[2]*oe,qe=k[2]*J-k[0]*_e,Ae=k[0]*oe-k[1]*J,He=z*Pe+U*qe+Y*Ae;if(Math.abs(He)<1e-15)return null;const tt=1/He,Je=E[0]-n,Yt=E[1]-e,zt=E[2]-i,dn=(Je*Pe+Yt*qe+zt*Ae)*tt;if(dn<0||dn>1)return null;const On=Yt*Y-zt*U,Xt=zt*z-Je*Y,En=Je*U-Yt*z,Dn=(k[0]*On+k[1]*Xt+k[2]*En)*tt;return Dn<0||dn+Dn>1?null:(J*On+oe*Xt+_e*En)*tt}function nc(n,e,i){return(n-e)/(i-e)}function Sg(n,e,i,s,u,f,g,y,w){const E=1<<i,k=f-s,z=g-u,U=(n+1)/E*k+s,Y=(e+0)/E*z+u,J=(e+1)/E*z+u;y[0]=(n+0)/E*k+s,y[1]=Y,w[0]=U,w[1]=J}class Ig{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(f){const g=Math.ceil(Math.log2(f.dim/8)),y=[];let w=Math.ceil(Math.pow(2,g));const E=1/w,k=(Y,J,oe,_e,Pe)=>{const qe=_e?1:0,Ae=(Y+1)*oe-qe,He=J*oe,tt=(J+1)*oe-qe;Pe[0]=Y*oe,Pe[1]=He,Pe[2]=Ae,Pe[3]=tt};let z=new em(w);const U=[];for(let Y=0;Y<w*w;Y++){k(Y%w,Math.floor(Y/w),E,!1,U);const J=jc(U[0],U[1],f),oe=jc(U[2],U[1],f),_e=jc(U[2],U[3],f),Pe=jc(U[0],U[3],f);z.minimums.push(Math.min(J,oe,_e,Pe)),z.maximums.push(Math.max(J,oe,_e,Pe)),z.leaves.push(1)}for(y.push(z),w/=2;w>=1;w/=2){const Y=y[y.length-1];z=new em(w);for(let J=0;J<w*w;J++){k(J%w,Math.floor(J/w),2,!0,U);const oe=Y.getElevation(U[0],U[1]),_e=Y.getElevation(U[2],U[1]),Pe=Y.getElevation(U[2],U[3]),qe=Y.getElevation(U[0],U[3]),Ae=Y.isLeaf(U[0],U[1]),He=Y.isLeaf(U[2],U[1]),tt=Y.isLeaf(U[2],U[3]),Je=Y.isLeaf(U[0],U[3]),Yt=Math.min(oe.min,_e.min,Pe.min,qe.min),zt=Math.max(oe.max,_e.max,Pe.max,qe.max),dn=Ae&&He&&tt&&Je;z.maximums.push(zt),z.minimums.push(Yt),z.leaves.push(zt-Yt<=5&&dn?1:0)}y.push(z)}return y}(this.dem),s=i.length-1,u=i[s];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,u,f,g,y=1){return tm([e,i,-100],[s,u,this.maximums[0]*y],f,g)}raycast(e,i,s,u,f,g,y=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,i,s,u,f,g,y);if(null==w)return null;const E=[],k=[],z=[],U=[],Y=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;Y.length>0;){const{idx:J,t:oe,nodex:_e,nodey:Pe,depth:qe}=Y.pop();if(this.leaves[J]){Sg(_e,Pe,qe,e,i,s,u,z,U);const He=1<<qe,tt=(_e+0)/He,Je=(_e+1)/He,Yt=(Pe+0)/He,zt=(Pe+1)/He,dn=jc(tt,Yt,this.dem)*y,On=jc(Je,Yt,this.dem)*y,Xt=jc(Je,zt,this.dem)*y,En=jc(tt,zt,this.dem)*y,Dn=yf(z[0],z[1],dn,U[0],z[1],On,U[0],U[1],Xt,f,g),An=yf(U[0],U[1],Xt,z[0],U[1],En,z[0],z[1],dn,f,g),Bn=Math.min(null!==Dn?Dn:Number.MAX_VALUE,null!==An?An:Number.MAX_VALUE);if(Bn!==Number.MAX_VALUE)return Bn;{const ln=Td([],f,g,oe);if(vf(dn,On,En,Xt,nc(ln[0],z[0],U[0]),nc(ln[1],z[1],U[1]))>=ln[2])return oe}continue}let Ae=0;for(let He=0;He<this._siblingOffset.length;He++){Sg((_e<<1)+this._siblingOffset[He][0],(Pe<<1)+this._siblingOffset[He][1],qe+1,e,i,s,u,z,U),z[2]=-100,U[2]=this.maximums[this.childOffsets[J]+He]*y;const tt=tm(z,U,f,g);if(null!=tt){const Je=tt;E[He]=Je;let Yt=!1;for(let zt=0;zt<Ae&&!Yt;zt++)Je>=E[k[zt]]&&(k.splice(zt,0,He),Yt=!0);Yt||(k[Ae]=He),Ae++}}for(let He=0;He<Ae;He++){const tt=k[He];Y.push({idx:this.childOffsets[J]+tt,t:E[tt],nodex:(_e<<1)+this._siblingOffset[tt][0],nodey:(Pe<<1)+this._siblingOffset[tt][1],depth:qe+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,u,f){if(1===e[u].isLeaf(i,s))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const g=u-1,y=e[g];let w=0,E=0;for(let k=0;k<this._siblingOffset.length;k++){const z=2*i+this._siblingOffset[k][0],U=2*s+this._siblingOffset[k][1],Y=y.getElevation(z,U),J=y.isLeaf(z,U),oe=this._addNode(Y.min,Y.max,J);J&&(w|=1<<k),E||(E=oe)}for(let k=0;k<this._siblingOffset.length;k++)w&1<<k||this._construct(e,2*i+this._siblingOffset[k][0],2*s+this._siblingOffset[k][1],g,E+k)}}function vf(n,e,i,s,u,f){return K(K(n,i,f),K(e,s,f),u)}function jc(n,e,i){const s=i.dim,u=Vt(n*s-.5,0,s-1),f=Vt(e*s-.5,0,s-1),g=Math.floor(u),y=Math.floor(f),w=Math.min(g+1,s-1),E=Math.min(y+1,s-1);return vf(i.get(g,y),i.get(w,y),i.get(g,E),i.get(w,E),u-g,f-y)}const nm={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function hy(n,e,i){return(256*n*256+256*e+i)/10-1e4}function xf(n,e,i){return 256*n+e+i/256-32768}class Hc{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,u=!1,f=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return xn(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const g=this.dim=i.height-2,y=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=s||"mapbox",this.borderReady=u,!u){for(let w=0;w<g;w++)y[this._idx(-1,w)]=y[this._idx(0,w)],y[this._idx(g,w)]=y[this._idx(g-1,w)],y[this._idx(w,-1)]=y[this._idx(w,0)],y[this._idx(w,g)]=y[this._idx(w,g-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(g,-1)]=y[this._idx(g-1,0)],y[this._idx(-1,g)]=y[this._idx(0,g-1)],y[this._idx(g,g)]=y[this._idx(g-1,g-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Ig(this)}get(e,i,s=!1){s&&(e=Vt(e,-1,this.dim),i=Vt(i,-1,this.dim));const u=4*this._idx(e,i);return("terrarium"===this.encoding?xf:hy)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(e){return nm[e]}get unpackVector(){return nm[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const s=[0,0,0,0],u=Hc.getUnpackVector(i);let f=Math.floor((e+u[3])/u[2]);return s[2]=f%256,f=Math.floor(f/256),s[1]=f%256,f=Math.floor(f/256),s[0]=f,s}getPixels(){return new la({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,f=i*this.dim+this.dim,g=s*this.dim,y=s*this.dim+this.dim;switch(i){case-1:u=f-1;break;case 1:f=u+1}switch(s){case-1:g=y-1;break;case 1:y=g+1}const w=-i*this.dim,E=-s*this.dim;for(let k=g;k<y;k++)for(let z=u;z<f;z++){const U=4*this._idx(z,k),Y=4*this._idx(z+w,k+E);this.pixels[U+0]=e.pixels[Y+0],this.pixels[U+1]=e.pixels[Y+1],this.pixels[U+2]=e.pixels[Y+2],this.pixels[U+3]=e.pixels[Y+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}O(Hc,"DEMData"),O(Ig,"DemMinMaxQuadTree",{omit:["dem"]});class bf{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,s){const u=e.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const f={value:i,timeout:void 0};if(void 0!==s&&(f.timeout=setTimeout(()=>{this.remove(e,f)},s)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const s=e.wrapped().key,u=void 0===i?0:this.data[s].indexOf(i),f=this.data[s][u];return this.data[s].splice(u,1),f.timeout&&clearTimeout(f.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(f.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const s in this.data)for(const u of this.data[s])e(u.value)||i.push(u);for(const s of i)this.remove(s.value.tileID,s)}}class rh{constructor(e,i,s){this.func=e,this.mask=i,this.range=s}}rh.ReadOnly=!1,rh.ReadWrite=!0,rh.disabled=new rh(519,rh.ReadOnly,[0,1]);class wf{constructor(e,i,s,u,f,g){this.test=e,this.ref=i,this.mask=s,this.fail=u,this.depthFail=f,this.pass=g}}wf.disabled=new wf({func:519,mask:0},0,0,7680,7680,7680);class Ll{constructor(e,i,s){this.blendFunction=e,this.blendColor=i,this.mask=s}}Ll.Replace=[1,0],Ll.disabled=new Ll(Ll.Replace,cr.transparent,[!1,!1,!1,!1]),Ll.unblended=new Ll(Ll.Replace,cr.transparent,[!0,!0,!0,!0]),Ll.alphaBlended=new Ll([1,771],cr.transparent,[!0,!0,!0,!0]);class _l{constructor(e,i,s){this.enable=e,this.mode=i,this.frontFace=s}}_l.disabled=new _l(!1,1029,2305),_l.backCCW=new _l(!0,1029,2305),_l.backCW=new _l(!0,1029,2304),_l.frontCW=new _l(!0,1028,2304),_l.frontCCW=new _l(!0,1028,2305);class Gc extends Qo{constructor(e,i,s){super(),this.id=e,this._onlySymbols=s,i.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new bf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Tg,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if("loaded"!==i.state&&"errored"!==i.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const s=this._tiles[i];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return tn(this._tiles).map(e=>e.tileID).sort(pd).map(e=>e.key)}getRenderableIds(e){const i=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&i.push(this._tiles[s]);return e?i.sort((s,u)=>{const f=s.tileID,g=u.tileID,y=new Fe(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),w=new Fe(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-g.overscaledZ||w.y-y.y||w.x-y.x}).map(s=>s.tileID.key):i.map(s=>s.tileID).sort(pd).map(s=>s.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=i),this._loadTile(s,this._tileLoaded.bind(this,s,e,i)))}_tileLoaded(e,i,s,u){if(u)if(e.state="errored",404!==u.status)this._source.fire(new Ni(u,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Dr.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new xr("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let u=0;u<i.length;u++){const f=i[u];if(e.neighboringTiles&&e.neighboringTiles[f]){const g=this.getTileByID(f);s(e,g),s(g,e)}}function s(u,f){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let g=f.tileID.canonical.x-u.tileID.canonical.x;const y=f.tileID.canonical.y-u.tileID.canonical.y,w=Math.pow(2,u.tileID.canonical.z),E=f.tileID.key;0===g&&0===y||Math.abs(y)>1||(Math.abs(g)>1&&(1===Math.abs(g+w)?g+=w:1===Math.abs(g-w)&&(g-=w)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,g,y),u.neighboringTiles&&u.neighboringTiles[E]&&(u.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,s,u){for(const f in this._tiles){let g=this._tiles[f];if(u[f]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>s)continue;let y=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const E=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[E.key],g&&g.hasData()&&(y=E)}let w=y;for(;w.overscaledZ>i;)if(w=w.scaledTo(w.overscaledZ-1),e[w.key]){u[y.key]=y;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=i?s:null}for(let s=e.overscaledZ-1;s>=i;s--){const u=e.scaledTo(s),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const s=Math.ceil(e.width/i)+1,u=Math.ceil(e.height/i)+1,f=Math.floor(s*u*5),g="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,f):f,y="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(y)}handleWrapJump(e){const i=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,i){const s={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+i),s[f.tileID.key]=f}this._tiles=s;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,i,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let u;this.updateCacheSize(e,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new ca(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(u=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(y=>this._source.hasTile(y)))):u=[];const f=this._updateRetainedTiles(u);if(Mg(this._source.type)&&0!==u.length){const y={},w={},E=Object.keys(f);for(const z of E){const U=f[z],Y=this._tiles[z];if(!Y||Y.fadeEndTime&&Y.fadeEndTime<=Dr.now())continue;const J=this.findLoadedParent(U,Math.max(U.overscaledZ-Gc.maxOverzooming,this._source.minzoom));J&&(this._addTile(J.tileID),y[J.tileID.key]=J.tileID),w[z]=U}const k=u[u.length-1].overscaledZ;for(const z in this._tiles){const U=this._tiles[z];if(f[z]||!U.hasData())continue;let Y=U.tileID;for(;Y.overscaledZ>k;){Y=Y.scaledTo(Y.overscaledZ-1);const J=this._tiles[Y.key];if(J&&J.hasData()&&w[Y.key]){f[z]=U.tileID;break}}}for(const z in y)f[z]||(this._coveredTiles[z]=!0,f[z]=y[z])}for(const y in f)this._tiles[y].clearFadeHold();const g=function(y,w){const E=[];for(const k in y)k in w||E.push(k);return E}(this._tiles,f);for(const y of g){const w=this._tiles[y];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(0===e.length)return i;const s={},u=e.reduce((E,k)=>Math.min(E,k.overscaledZ),1/0),f=e[0].overscaledZ,g=Math.max(f-Gc.maxOverzooming,this._source.minzoom),y=Math.max(f+Gc.maxUnderzooming,this._source.minzoom),w={};for(const E of e){const k=this._addTile(E);i[E.key]=E,k.hasData()||u<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,u,y,i);for(const E of e){let k=this._tiles[E.key];if(k.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const U=E.children(this._source.maxzoom)[0],Y=this.getTile(U);if(Y&&Y.hasData()){i[U.key]=U;continue}}else{const U=E.children(this._source.maxzoom);if(i[U[0].key]&&i[U[1].key]&&i[U[2].key]&&i[U[3].key])continue}let z=k.wasRequested();for(let U=E.overscaledZ-1;U>=g;--U){const Y=E.scaledTo(U);if(s[Y.key]||(s[Y.key]=!0,k=this.getTile(Y),!k&&z&&(k=this._addTile(Y)),k&&(i[Y.key]=Y,z=k.wasRequested(),k.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let s,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){s=this._loadedParentTiles[u.key];break}i.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(s=this._getLoadedTile(f),s)break;u=f}for(const f of i)this._loadedParentTiles[f]=s}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const s=!!i;if(!s){const u=this.map?this.map.painter:null;i=new _f(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,s||this._source.fire(new xr("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=i.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&"reloading"!==i.state?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,s){const u=[],f=this.transform;if(!f)return u;const g="globe"===f.projection.name,y=Xl(f.center.lng);for(const w in this._tiles){const E=this._tiles[w];if(s&&E.clearQueryDebugViz(),E.holdingForFade())continue;let k;if(g){const z=E.tileID.canonical;if(0===z.z){const U=[Math.abs(Vt(y,...md(z,-1))-y),Math.abs(Vt(y,...md(z,1))-y)];k=[0,2*U.indexOf(Math.min(...U))-1]}else{const U=[Math.abs(Vt(y,...md(z,-1))-y),Math.abs(Vt(y,...md(z,0))-y),Math.abs(Vt(y,...md(z,1))-y)];k=[U.indexOf(Math.min(...U))-1]}}else k=[0];for(const z of k){const U=e.containsTile(E,f,i,z);U&&u.push(U)}}return u}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of i)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(Mg(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=Dr.now())return!0}return!1}setFeatureState(e,i,s){this._state.updateState(e=e||"_geojsonTileLayer",i,s)}removeFeatureState(e,i,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,s)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,s){const u=this._tiles[e];u&&u.setDependencies(i,s)}reloadTilesForDependencies(e,i){for(const s in this._tiles)this._tiles[s].hasDependency(e,i)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,i))}_preloadTiles(e,i){if(!this._sourceLoaded){const y=()=>{this._sourceLoaded&&(this._source.off("data",y),this._preloadTiles(e,i))};return void this._source.on("data",y)}const s=new Map,u=Array.isArray(e)?e:[e],f=this.map.painter.terrain,g=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const y of u){const w=y.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of w)s.set(E.key,E);this.usedForTerrain&&y.updateElevation(!1)}li(Array.from(s.values()),(y,w)=>{const E=new _f(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,k=>{"raster-dem"===this._source.type&&E.dem&&this._backfillDEM(E),w(k,E)})},i)}}function pd(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||s-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function Mg(n){return"raster"===n||"image"===n||"video"===n||"custom"===n}function md(n,e){const i=1<<n.z;return[n.x/i+e,(n.x+1)/i+e]}Gc.maxOverzooming=10,Gc.maxUnderzooming=3;class oh{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const u=s||e.findDEMTileFor(i);if(!u||!u.dem)return;const f=u.dem,g=u.tileID,y=1<<i.canonical.z-g.canonical.z;return new oh(u,u.tileSize/Ai/y,[(i.canonical.x/y-g.canonical.x)*f.dim,(i.canonical.y/y-g.canonical.y)*f.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(s);return new Fe(u,f)}getElevationAt(e,i,s,u){const f=e*this._scale+this._offset[0],g=i*this._scale+this._offset[1],y=Math.floor(f),w=Math.floor(g),E=this._dem;return u=!!u,s?K(K(E.get(y,w,u),E.get(y,w+1,u),g-w),K(E.get(y+1,w,u),E.get(y+1,w+1,u),g-w),f-y):E.get(y,w,u)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ol(1,e)*this._dem.stride}}class Ag{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new zl(Ai,16,0),this.featureIndexArray=new ul,this.promoteId=i}insert(e,i,s,u,f,g=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,f,g);const w=this.grid;for(let E=0;E<i.length;E++){const k=i[E],z=[1/0,1/0,-1/0,-1/0];for(let U=0;U<k.length;U++){const Y=k[U];z[0]=Math.min(z[0],Y.x),z[1]=Math.min(z[1],Y.y),z[2]=Math.max(z[2],Y.x),z[3]=Math.max(z[3],Y.y)}z[0]<Ai&&z[1]<Ai&&z[2]>=0&&z[3]>=0&&w.insert(y,z[0],z[1],z[2],z[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new fo(new sf(this.rawTileData)).layers,this.sourceLayerCoder=new Cg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,s,u){this.loadVTLayers();const f=e.params||{},g=iu(f.filter),y=e.tileResult,w=e.transform,E=y.bufferedTilespaceBounds,k=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(J,oe,_e,Pe)=>Bh(y.bufferedTilespaceGeometry,J,oe,_e,Pe));k.sort(sh);let z=null;w.elevation&&k.length>0&&(z=oh.create(w.elevation,this.tileID));const U={};let Y;for(let J=0;J<k.length;J++){const oe=k[J];if(oe===Y)continue;Y=oe;const _e=this.featureIndexArray.get(oe);let Pe=null;this.loadMatchingFeature(U,_e,g,f.layers,f.availableImages,i,s,u,(qe,Ae,He,tt=0)=>(Pe||(Pe=uc(qe,this.tileID.canonical,e.tileTransform)),Ae.queryIntersectsFeature(y,qe,He,Pe,this.z,e.transform,e.pixelPosMatrix,z,tt)))}return U}loadMatchingFeature(e,i,s,u,f,g,y,w,E){const{featureIndex:k,bucketIndex:z,sourceLayerIndex:U,layoutVertexArrayOffset:Y}=i,J=this.bucketLayerIDs[z];if(u&&!function(qe,Ae){for(let He=0;He<qe.length;He++)if(Ae.indexOf(qe[He])>=0)return!0;return!1}(u,J))return;const oe=this.sourceLayerCoder.decode(U),_e=this.vtLayers[oe].feature(k);if(s.needGeometry){const qe=Hu(_e,!0);if(!s.filter(new N(this.tileID.overscaledZ),qe,this.tileID.canonical))return}else if(!s.filter(new N(this.tileID.overscaledZ),_e))return;const Pe=this.getId(_e,oe);for(let qe=0;qe<J.length;qe++){const Ae=J[qe];if(u&&u.indexOf(Ae)<0)continue;const He=g[Ae];if(!He)continue;let tt={};void 0!==Pe&&w&&(tt=w.getState(He.sourceLayer||"_geojsonTileLayer",Pe));const Je=Re({},y[Ae]);Je.paint=Pg(Je.paint,He.paint,_e,tt,f),Je.layout=Pg(Je.layout,He.layout,_e,tt,f);const Yt=!E||E(_e,He,tt,Y);if(!Yt)continue;const zt=new kl(_e,this.z,this.x,this.y,Pe);zt.layer=Je;let dn=e[Ae];void 0===dn&&(dn=e[Ae]=[]),dn.push({featureIndex:k,feature:zt,intersectionZ:Yt})}}lookupSymbolFeatures(e,i,s,u,f,g,y,w){const E={};this.loadVTLayers();const k=iu(f);for(const z of e)this.loadMatchingFeature(E,{bucketIndex:s,sourceLayerIndex:u,featureIndex:z,layoutVertexArrayOffset:0},k,g,y,w,i);return E}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(s),f=this.vtFeatures[u];if(f[i])return f[i];const g=this.vtLayers[u].feature(i);return f[i]=g,g}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;if(this.promoteId){const u="string"==typeof this.promoteId?this.promoteId:this.promoteId[i];null!=u&&(s=e.properties[u]),"boolean"==typeof s&&(s=Number(s))}return s}}function Pg(n,e,i,s,u){return Cn(n,(f,g)=>{const y=e instanceof ke?e.get(g):null;return y&&y.evaluate?y.evaluate(i,s,u):y})}function sh(n,e){return e-n}O(Ag,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Rg{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new dc({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=en(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const u=[];let f=e.length%2==1?-e[e.length-1]*s:0,g=e[0]*s,y=!0;u.push({left:f,right:g,isDash:y,zeroLength:0===e[0]});let w=e[0];for(let E=1;E<e.length;E++){y=!y;const k=e[E];f=w*s,w+=k,g=w*s,u.push({left:f,right:g,isDash:y,zeroLength:0===k})}return u}addRoundDash(e,i,s){const u=i/2;for(let f=-s;f<=s;f++){const g=this.width*(this.nextRow+s+f);let y=0,w=e[y];for(let E=0;E<this.width;E++){E/w.right>1&&(w=e[++y]);const k=Math.abs(E-w.left),z=Math.abs(E-w.right),U=Math.min(k,z);let Y;const J=f/s*(u+1);if(w.isDash){const oe=u-Math.abs(J);Y=Math.sqrt(U*U+oe*oe)}else Y=u-Math.sqrt(U*U+J*J);this.image.data[g+E]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(e,i){for(let w=e.length-1;w>=0;--w){const E=e[w],k=e[w+1];E.zeroLength?e.splice(w,1):k&&k.isDash===E.isDash&&(k.left=E.left,e.splice(w,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const f=this.width*this.nextRow;let g=0,y=e[g];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++g]);const E=Math.abs(w-y.left),k=Math.abs(w-y.right),z=Math.min(E,k);this.image.data[f+w]=Math.max(0,Math.min(255,(y.isDash?z:-z)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const u="round"===i,f=u?7:0,g=2*f+1;if(this.nextRow+g>this.height)return xn("LineAtlas out of space"),null;0===e.length&&e.push(1);let y=0;for(let k=0;k<e.length;k++)e[k]<0&&(xn("Negative value is found in line dasharray, replacing values with 0"),e[k]=0),y+=e[k];if(0!==y){const k=this.width/y,z=this.getDashRanges(e,this.width,k);u?this.addRoundDash(z,k,f):this.addRegularDash(z,"square"===i?.5*k:0)}const w=this.nextRow+f;this.nextRow+=g;const E={tl:[w,f],br:[y,0]};return this.positions[s]=E,E}}O(Rg,"LineAtlas");const Og=1*Ia;class kg{constructor(e){const i={},s=[];for(const y in e){const w=e[y],E=i[y]={};for(const k in w.glyphs){const z=w.glyphs[+k];if(!z||0===z.bitmap.width||0===z.bitmap.height)continue;const U=z.metrics.localGlyph?Og:1,Y={x:0,y:0,w:z.bitmap.width+2*U,h:z.bitmap.height+2*U};s.push(Y),E[k]=Y}}const{w:u,h:f}=Bc(s),g=new dc({width:u||1,height:f||1});for(const y in e){const w=e[y];for(const E in w.glyphs){const k=w.glyphs[+E];if(!k||0===k.bitmap.width||0===k.bitmap.height)continue;const z=i[y][E],U=k.metrics.localGlyph?Og:1;dc.copy(k.bitmap,g,{x:0,y:0},{x:z.x+U,y:z.y+U},k.bitmap)}}this.image=g,this.positions=i}}O(kg,"GlyphAtlas");class fy{constructor(e){this.tileID=new ca(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=sr(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,s,u,f){this.status="parsing",this.data=e,this.collisionBoxArray=new bo;const g=new Cg(Object.keys(e.layers).sort()),y=new Ag(this.tileID,this.promoteId);y.bucketLayerIDs=[];const w={},E=new Rg(256,256),k={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:s},z=i.familiesBySource[this.source];for(const tt in z){const Je=e.layers[tt];if(!Je)continue;let Yt=!1,zt=!1;for(const Xt of z[tt])"symbol"===Xt[0].type?Yt=!0:zt=!0;if(!0===this.isSymbolTile&&!Yt||!1===this.isSymbolTile&&!zt)continue;1===Je.version&&xn(`Vector tile source "${this.source}" layer "${tt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const dn=g.encode(tt),On=[];for(let Xt=0;Xt<Je.length;Xt++){const En=Je.feature(Xt),Dn=y.getId(En,tt);On.push({feature:En,id:Dn,index:Xt,sourceLayerIndex:dn})}for(const Xt of z[tt]){const En=Xt[0];void 0!==this.isSymbolTile&&"symbol"===En.type!==this.isSymbolTile||En.minzoom&&this.zoom<Math.floor(En.minzoom)||En.maxzoom&&this.zoom>=En.maxzoom||"none"!==En.visibility&&(sm(Xt,this.zoom,s),(w[En.id]=En.createBucket({index:y.bucketLayerIDs.length,layers:Xt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:dn,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(On,k,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(Xt.map(Dn=>Dn.id)))}}let U,Y,J,oe;E.trim();const _e={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Pe=()=>{if(U)return f(U);if(Y&&J&&oe){const tt=new kg(Y),Je=new Op(J,oe);for(const Yt in w){const zt=w[Yt];zt instanceof Uc?(sm(zt.layers,this.zoom,s),K_(zt,Y,tt.positions,J,Je.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):zt.hasPattern&&(zt instanceof Hd||zt instanceof qh||zt instanceof Ju)&&(sm(zt.layers,this.zoom,s),zt.addFeatures(k,this.tileID.canonical,Je.patternPositions,s,this.tileTransform))}this.status="done",f(null,{buckets:tn(w).filter(Yt=>!Yt.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:tt.image,lineAtlas:E,imageAtlas:Je,glyphMap:this.returnDependencies?Y:null,iconMap:this.returnDependencies?J:null,glyphPositions:this.returnDependencies?tt.positions:null})}},qe=Cn(k.glyphDependencies,tt=>Object.keys(tt).map(Number));Object.keys(qe).length?u.send("getGlyphs",{uid:this.uid,stacks:qe},(tt,Je)=>{U||(U=tt,Y=Je,Pe())},void 0,!1,_e):Y={};const Ae=Object.keys(k.iconDependencies);Ae.length?u.send("getImages",{icons:Ae,source:this.source,tileID:this.tileID,type:"icons"},(tt,Je)=>{U||(U=tt,J=Je,Pe())},void 0,!1,_e):J={};const He=Object.keys(k.patternDependencies);He.length?u.send("getImages",{icons:He,source:this.source,tileID:this.tileID,type:"patterns"},(tt,Je)=>{U||(U=tt,oe=Je,Pe())},void 0,!1,_e):oe={},Pe()}}function sm(n,e,i){const s=new N(e);for(const u of n)u.recalculate(s,i)}class Lg{constructor(e){this.entries={},this.scheduler=e}request(e,i,s,u){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[g,y]=f.result;return this.scheduler?this.scheduler.add(()=>{u(g,y)},i):u(g,y),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=s((g,y)=>{f.result=[g,y];for(const w of f.callbacks)this.scheduler?this.scheduler.add(()=>{w(g,y)},i):w(g,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(g=>g!==u),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function Fg(n,e,i){const s=JSON.stringify(n.request);return n.data&&(this.deduped.entries[s]={result:[null,n.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},u=>{const f=rr(n.request,(g,y,w,E)=>{g?u(g):y&&u(null,{vectorTile:i?void 0:new fo(new sf(y)),rawData:y,cacheControl:w,expires:E})});return()=>{f.cancel(),u()}},e)}const Bg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ef{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(e,0,2);if(219!==i)throw new Error("Data does not appear to be in a KDBush format.");const u=s>>4;if(1!==u)throw new Error(`Got v${u} data when expected v1.`);const f=Bg[15&s];if(!f)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Ef(y,g,f,e)}constructor(e,i=64,s=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=Bg.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${s}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+y+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=i,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return ah(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:g,nodeSize:y}=this,w=[0,f.length-1,0],E=[];for(;w.length;){const k=w.pop()||0,z=w.pop()||0,U=w.pop()||0;if(z-U<=y){for(let _e=U;_e<=z;_e++){const Pe=g[2*_e],qe=g[2*_e+1];Pe>=e&&Pe<=s&&qe>=i&&qe<=u&&E.push(f[_e])}continue}const Y=U+z>>1,J=g[2*Y],oe=g[2*Y+1];J>=e&&J<=s&&oe>=i&&oe<=u&&E.push(f[Y]),(0===k?e<=J:i<=oe)&&(w.push(U),w.push(Y-1),w.push(1-k)),(0===k?s>=J:u>=oe)&&(w.push(Y+1),w.push(z),w.push(1-k))}return E}within(e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:g}=this,y=[0,u.length-1,0],w=[],E=s*s;for(;y.length;){const k=y.pop()||0,z=y.pop()||0,U=y.pop()||0;if(z-U<=g){for(let _e=U;_e<=z;_e++)zg(f[2*_e],f[2*_e+1],e,i)<=E&&w.push(u[_e]);continue}const Y=U+z>>1,J=f[2*Y],oe=f[2*Y+1];zg(J,oe,e,i)<=E&&w.push(u[Y]),(0===k?e-s<=J:i-s<=oe)&&(y.push(U),y.push(Y-1),y.push(1-k)),(0===k?e+s>=J:i+s>=oe)&&(y.push(Y+1),y.push(z),y.push(1-k))}return w}}function ah(n,e,i,s,u,f){if(u-s<=i)return;const g=s+u>>1;Ng(n,e,g,s,u,f),ah(n,e,i,s,g-1,1-f),ah(n,e,i,g+1,u,1-f)}function Ng(n,e,i,s,u,f){for(;u>s;){if(u-s>600){const E=u-s+1,k=i-s+1,z=Math.log(E),U=.5*Math.exp(2*z/3),Y=.5*Math.sqrt(z*U*(E-U)/E)*(k-E/2<0?-1:1);Ng(n,e,i,Math.max(s,Math.floor(i-k*U/E+Y)),Math.min(u,Math.floor(i+(E-k)*U/E+Y)),f)}const g=e[2*i+f];let y=s,w=u;for(Wc(n,e,s,i),e[2*u+f]>g&&Wc(n,e,s,u);y<w;){for(Wc(n,e,y,w),y++,w--;e[2*y+f]<g;)y++;for(;e[2*w+f]>g;)w--}e[2*s+f]===g?Wc(n,e,s,w):(w++,Wc(n,e,w,u)),w<=i&&(s=w+1),i<=w&&(u=w-1)}}function Wc(n,e,i,s){am(n,i,s),am(e,2*i,2*s),am(e,2*i+1,2*s+1)}function am(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}function zg(n,e,i,s){const u=n-i,f=e-s;return u*u+f*f}l.ARRAY_TYPE=Ba,l.AUTH_ERR_MSG=We,l.Aabb=Sa,l.Actor=class{constructor(n,e,i){this.target=n,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},Zn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=qn()?n:Me,this.scheduler=new cy}send(n,e,i,s,u=!1,f){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=f,this.callbacks[g]=i);const y=ar(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:n,hasCallback:!!i,targetMapId:s,mustQueue:u,sourceMapId:this.mapId,data:q(e,y)},y),{cancel:()=>{i&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(n){const e=n.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[i];delete this.cancelCallbacks[i],s&&s.cancel()}else if(e.mustQueue||qn()){const s=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),s&&s.metadata||{type:"message"})}else this.processTask(i,e)}processTask(n,e){if("<response>"===e.type){const i=this.callbacks[n];delete this.callbacks[n],i&&(e.error?i(ve(e.error)):i(null,ve(e.data)))}else{const i=ar(this.globalScope)?void 0:[],s=e.hasCallback?(f,g)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:f?q(f):null,data:q(g,i)},i)}:f=>{},u=ve(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,s);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],u.source)[f[1]](u,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.CanonicalTileID=Jh,l.Color=cr,l.ColorMode=Ll,l.CullFaceMode=_l,l.DEMData=Hc,l.DataConstantProperty=re,l.DedupedRequest=Lg,l.DepthMode=rh,l.EXTENT=Ai,l.Elevation=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,u=Math.floor(n.x),f=Math.floor((n.x-u)*s),g=Math.floor(n.y*s),y=this.findDEMTileFor(new ca(i,u,i,f,g));return!(!y||!y.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const s=this._source();if(!s||n.y<0||n.y>1)return e;const u=s.getSource().maxzoom,f=1<<u,g=Math.floor(n.x),y=n.x-g,w=new ca(u,g,u,Math.floor(y*f),Math.floor(n.y*f)),E=this.findDEMTileFor(w);if(!E||!E.dem)return e;const k=E.dem,z=1<<E.tileID.canonical.z,U=(y*z-E.tileID.canonical.x)*k.dim,Y=(n.y*z-E.tileID.canonical.y)*k.dim,J=Math.floor(U),oe=Math.floor(Y);return(i?this.exaggeration():1)*K(K(k.get(J,oe),k.get(J,oe+1),Y-oe),K(k.get(J+1,oe),k.get(J+1,oe+1),Y-oe),U-J)}getAtTileOffset(n,e,i){const s=1<<n.canonical.z;return this.getAtPointOrZero(new Mc(n.wrap+(n.canonical.x+e/Ai)/s,(n.canonical.y+i/Ai)/s))}getAtTileOffsetFunc(n,e,i,s){return u=>{const f=this.getAtTileOffset(n,u.x,u.y),g=s.upVector(n.canonical,u.x,u.y);return hl(g,g,f*s.upVectorScale(n.canonical,e,i).metersToTile),g}}getForTilePoints(n,e,i,s){if(this.isUsingMockSource())return!1;const u=oh.create(this,n,s);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,u=1<<n.canonical.z-s.canonical.z;let f=n.canonical.x/u-s.canonical.x,g=n.canonical.y/u-s.canonical.y,y=0;for(let w=0;w<n.canonical.z-s.canonical.z&&!i.leaves[y];w++){f*=2,g*=2;const E=2*Math.floor(g)+Math.floor(f);y=i.childOffsets[y]+E,f%=1,g%=1}return{min:this.exaggeration()*i.minimums[y],max:this.exaggeration()*i.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},l.ErrorEvent=Ni,l.EvaluationParameters=N,l.Event=xr,l.Evented=Qo,l.FillExtrusionBucket=Ju,l.Frustum=Kf,l.FrustumCorners=Xf,l.GLOBE_RADIUS=Yl,l.GLOBE_SCALE_MATCH_LATITUDE=45,l.GLOBE_ZOOM_THRESHOLD_MAX=Ch,l.GLOBE_ZOOM_THRESHOLD_MIN=Dh,l.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_fillGridMeshWithLods(n,e){const i=new Fn,s=new mi,u=[],f=n+1+2,g=e[0]+1,y=e[0]+1+(1+e.length),w=(E,k,z)=>{let U=E===f-1?E-2:0===E?E:E-1;return U+=z?24575:0,[U,k]};for(let E=0;E<f;++E)i.emplaceBack(...w(E,0,!0));for(let E=0;E<g;++E)for(let k=0;k<f;++k)i.emplaceBack(...w(k,E,(0===k||k===f-1)&&!0));for(let E=0;E<e.length;++E){const k=e[E];for(let z=0;z<f;++z)i.emplaceBack(...w(z,k,!0))}for(let E=0;E<e.length;++E){const k=s.length,z=e[E]+1+2,U=new mi;for(let oe=0;oe<z-1;oe++){const _e=oe===z-2,Pe=_e?f*(y-e.length+E-oe):f;for(let qe=0;qe<f-1;qe++){const Ae=oe*f+qe;0===oe||_e||0===qe||qe===f-2?(U.emplaceBack(Ae+1,Ae,Ae+Pe),U.emplaceBack(Ae+Pe,Ae+Pe+1,Ae+1)):(s.emplaceBack(Ae+1,Ae,Ae+Pe),s.emplaceBack(Ae+Pe,Ae+Pe+1,Ae+1))}}const Y=is.simpleSegment(0,k,i.length,s.length-k);for(let oe=0;oe<U.uint16.length;oe+=3)s.emplaceBack(U.uint16[oe],U.uint16[oe+1],U.uint16[oe+2]);const J=is.simpleSegment(0,k,i.length,s.length-k);u.push({withoutSkirts:Y,withSkirts:J})}return{vertices:i,indices:s,segments:u}}_createGrid(n){const e=this._fillGridMeshWithLods(64,Nu);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,Tc.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new mi;for(let u=0;u<=64;u++)e.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new Zr,s=new Zr;this._poleSegments=[];for(let u=0,f=0;u<Dh;u++){const g=360/(1<<u);i.emplaceBack(0,-Yl,0,.5,0),s.emplaceBack(0,-Yl,0,.5,1);for(let y=0;y<=64;y++){const w=y/64,E=K(0,g,w),[k,z,U]=$u(Om,ju,E,Yl);i.emplaceBack(k,z,U,w,0),s.emplaceBack(k,z,U,w,1)}this._poleSegments.push(is.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,Zf,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(s,Zf,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,e){if(!this._wireframeSegments){const i=new io,s=64,u=s+1+2,f=1;this._wireframeSegments=[];for(let g=0,y=0;g<Nu.length;g++){const w=Nu[g];for(let k=f;k<w+f;k++)for(let z=f;z<s+f;z++){const U=k*u+z;i.emplaceBack(U,U+1),i.emplaceBack(U,U+u),i.emplaceBack(U,U+u+1)}const E=w*s*3;this._wireframeSegments.push(is.simpleSegment(0,y,(w+1)*u,E)),y+=E}this._wireframeIndexBuffer=n.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},l.GlyphManager=rd,l.ImagePosition=Rp,l.KDBush=Ef,l.LivePerformanceUtils=Gr,l.LngLat=Qr,l.LngLatBounds=Pl,l.LocalGlyphMode=Vp,l.MAX_MERCATOR_LATITUDE=Ws,l.MercatorCoordinate=Mc,l.ONE_EM=qs,l.OverscaledTileID=ca,l.PerformanceMarkers=no,l.Point=Fe,l.Properties=$e,l.RGBAImage=la,l.Ray=Bu,l.RequestManager=class{constructor(n,e,i){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",_t,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!ot(n))return n;const i=Pn(n);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!ot(n))return n;const i=Pn(n);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(n,e,i,s){if(!ot(n))return n;const u=Pn(n);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),i&&u.params.push(`language=${i}`),s&&u.params.push(`worldview=${s}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(n,e,i,s){const u=Pn(n);return ot(n)?(u.path=`/styles/v1${u.path}/sprite${e}${i}`,this._makeAPIURL(u,this._customAccessToken||s)):(u.path+=`${e}${i}`,Ye(u))}normalizeTileURL(n,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!ot(n))return n;const s=Pn(n);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==s.authority&&512===i?"@2x":""}${yt.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${pt.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${pt.TILE_URL_VERSION}${s.path}`);const u=this._customAccessToken||function(f){for(const g of f){const y=g.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(s.params)||pt.ACCESS_TOKEN;return pt.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,u)}canonicalizeTileURL(n,e){const i=Pn(n);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return n;let s="mapbox://";i.path.match(/^\/raster\/v1\//)?s+=`raster/${i.path.replace(`/${pt.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${i.path.replace(`/${pt.TILE_URL_VERSION}/`,"")}`;let u=i.params;return e&&(u=u.filter(f=>!f.match(/^access_token=/))),u.length&&(s+=`?${u.join("&")}`),s}canonicalizeTileset(n,e){const i=!!e&&ot(e),s=[];for(const u of n.tiles||[])Rt(u)?s.push(this.canonicalizeTileURL(u,i)):s.push(u);return s}_makeAPIURL(n,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=Pn(pt.API_URL);if(n.protocol=s.protocol,n.authority=s.authority,"http"===n.protocol){const u=n.params.indexOf("secure");u>=0&&n.params.splice(u,1)}if("/"!==s.path&&(n.path=`${s.path}${n.path}`),!pt.REQUIRE_ACCESS_TOKEN)return Ye(n);if(e=e||pt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return n.params=n.params.filter(u=>-1===u.indexOf("access_token")),n.params.push(`access_token=${e||""}`),Ye(n)}},l.ResourceType=fi,l.SegmentVector=is,l.SourceCache=Gc,l.StencilMode=wf,l.StructArrayLayout1ui2=Ga,l.StructArrayLayout2f1f2i16=Ri,l.StructArrayLayout2i4=Fn,l.StructArrayLayout2ui4=io,l.StructArrayLayout3f12=dr,l.StructArrayLayout3ui6=mi,l.StructArrayLayout4i8=gn,l.StructArrayLayout5f20=Zr,l.Texture=th,l.Tile=_f,l.Transitionable=ie,l.Uniform1f=Fa,l.Uniform1i=class extends ac{constructor(n){super(n),this.current=0}set(n,e,i){this.fetchUniformLocation(n,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},l.Uniform2f=class extends ac{constructor(n){super(n),this.current=[0,0]}set(n,e,i){this.fetchUniformLocation(n,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},l.Uniform3f=class extends ac{constructor(n){super(n),this.current=[0,0,0]}set(n,e,i){this.fetchUniformLocation(n,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},l.Uniform4f=hu,l.UniformColor=Nf,l.UniformMatrix2f=class extends ac{constructor(n){super(n),this.current=c_}set(n,e,i){if(this.fetchUniformLocation(n,e))for(let s=0;s<4;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},l.UniformMatrix3f=class extends ac{constructor(n){super(n),this.current=bd}set(n,e,i){if(this.fetchUniformLocation(n,e))for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},l.UniformMatrix4f=class extends ac{constructor(n){super(n),this.current=_h}set(n,e,i){if(this.fetchUniformLocation(n,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let s=1;s<16;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},l.UnwrappedTileID=Qh,l.ValidationError=ei,l.VectorTileFeature=Rc,l.VectorTileWorkerSource=class extends Qo{constructor(n,e,i,s,u){super(),this.actor=n,this.layerIndex=e,this.availableImages=i,this.loadVectorData=u||Fg,this.loading={},this.loaded={},this.deduped=new Lg(n.scheduler),this.isSpriteLoaded=s,this.scheduler=n.scheduler}loadTile(n,e){const i=n.uid,s=n&&n.request,u=s&&s.collectResourceTiming,f=this.loading[i]=new fy(n);f.abort=this.loadVectorData(n,(g,y)=>{const w=!this.loading[i];if(delete this.loading[i],w||g||!y)return f.status="done",w||(this.loaded[i]=f),e(g);const E=y.rawData,k={};y.expires&&(k.expires=y.expires),y.cacheControl&&(k.cacheControl=y.cacheControl),f.vectorTile=y.vectorTile||new fo(new sf(E));const z=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(U,Y)=>{if(U||!Y)return e(U);const J={};if(u){const oe=Mo(s);oe.length>0&&(J.resourceTiming=JSON.parse(JSON.stringify(oe)))}e(null,Re({rawTileData:E.slice(0)},Y,k,J))})};this.isSpriteLoaded?z():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(z,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):z()}),this.loaded=this.loaded||{},this.loaded[i]=f})}reloadTile(n,e){const i=this.loaded,s=n.uid,u=this;if(i&&i[s]){const f=i[s];f.showCollisionBoxes=n.showCollisionBoxes,f.enableTerrain=!!n.enableTerrain,f.projection=n.projection,f.tileTransform=sr(n.tileID.canonical,n.projection);const g=(y,w)=>{const E=f.reloadCallback;E&&(delete f.reloadCallback,f.parse(f.vectorTile,u.layerIndex,this.availableImages,u.actor,E)),e(y,w)};"parsing"===f.status?f.reloadCallback=g:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(n,e){const i=n.uid,s=this.loading[i];s&&(s.abort&&s.abort(),delete this.loading[i]),e()}removeTile(n,e){const i=this.loaded,s=n.uid;i&&i[s]&&delete i[s],e()}},l.WritingMode=sl,l.ZoomDependentExpression=xa,l.add=Gl,l.addDynamicAttributes=pf,l.adjoint=function(n,e){var i=e[0],s=e[1],u=e[2],f=e[3],g=e[4],y=e[5],w=e[6],E=e[7],k=e[8];return n[0]=g*k-y*E,n[1]=u*E-s*k,n[2]=s*y-u*g,n[3]=y*w-f*k,n[4]=i*k-u*w,n[5]=u*f-i*y,n[6]=f*E-g*w,n[7]=s*w-i*E,n[8]=i*g-s*f,n},l.asyncAll=li,l.bezier=pn,l.bindAll=Zn,l.boundsAttributes=gf,l.bufferConvexPolygon=function(n,e){const i=[];for(let s=0;s<n.length;s++){const u=Ht(s-1,-1,n.length-1),f=Ht(s+1,-1,n.length-1),g=n[s],y=n[f],w=n[u].sub(g).unit(),E=y.sub(g).unit(),k=E.angleWithSep(w.x,w.y),z=w.add(E).unit().mult(-1*e/Math.sin(k/2));i.push(g.add(z))}return i},l.cacheEntryPossiblyAdded=function(n){Er++,Er>oo&&(n.getActor().send("enforceCacheSizeLimit",pr),Er=0)},l.calculateGlobeLabelMatrix=function(n,e){const{x:i,y:s}=n.point,u=Vu(i,s,n.worldSize/n._pixelsPerMercatorPixel,0,0);return pu(u,u,tp(Ya(e)))},l.calculateGlobeMatrix=function(n){const{x:e,y:i}=n.point,{lng:s,lat:u}=n._center;return Vu(e,i,n.worldSize,s,u)},l.calculateGlobeMercatorMatrix=function(n){const e=n.pixelsPerMeter,i=e/Ol(1,n.center.lat),s=dl(new Float64Array(16));return Hl(s,s,[n.point.x,n.point.y,0]),Rl(s,s,[i,i,e]),Float32Array.from(s)},l.circumferenceAtLatitude=rp,l.clamp=Vt,l.clearTileCache=function(n){if(!po())return;const e=Me.caches.delete(Pr);n&&e.catch(n).then(()=>n())},l.clipLine=pg,l.clone=function(n){var e=new Ba(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},l.clone$1=xt,l.collisionCircleLayout=z_,l.config=pt,l.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},l.create=function(){var n=new Ba(16);return Ba!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},l.create$1=xh,l.createExpression=Yo,l.createLayout=Pt,l.createStyleLayer=function(n){return"custom"===n.type?new Dg(n):new Qp[n.type](n)},l.cross=Sm,l.degToRad=De,l.distance=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},l.div=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},l.dot=Wa,l.earthRadius=Ic,l.ease=hn,l.easeCubicInOut=ft,l.ecefToLatLng=function([n,e,i]){const s=Math.hypot(n,e,i),u=Math.atan2(n,i),f=.5*Math.PI-Math.acos(-e/s);return new Qr(dt(u),dt(f))},l.emitValidationErrors=uu,l.endsWith=ri,l.enforceCacheSizeLimit=function(n){wi(),Si&&Si.then(e=>{e.keys().then(i=>{for(let s=0;s<i.length-n;s++)e.delete(i[s])})})},l.evaluateSizeForFeature=ed,l.evaluateSizeForZoom=Lc,l.evaluateVariableOffset=X_,l.evented=_,l.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},l.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},l.exported=Dr,l.exported$1=yt,l.extend=Re,l.extend$1=so,l.fillExtrusionHeightLift=bp,l.filterObject=nn,l.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},l.fromQuat=function(n,e){var i=e[0],s=e[1],u=e[2],f=e[3],g=i+i,y=s+s,w=u+u,E=i*g,k=s*g,z=s*y,U=u*g,Y=u*y,J=u*w,oe=f*g,_e=f*y,Pe=f*w;return n[0]=1-z-J,n[1]=k+Pe,n[2]=U-_e,n[3]=0,n[4]=k-Pe,n[5]=1-E-J,n[6]=Y+oe,n[7]=0,n[8]=U+_e,n[9]=Y-oe,n[10]=1-E-z,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},l.fromRotation=function(n,e){var i=Math.sin(e),s=Math.cos(e);return n[0]=s,n[1]=i,n[2]=0,n[3]=-i,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},l.fromScaling=Uf,l.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return Lt[e]},l.getAABBPointSquareDist=function(n,e,i){let s=0;for(let u=0;u<2;++u){const f=i?i[u]:0;n[u]>f&&(s+=(n[u]-f)*(n[u]-f)),e[u]<f&&(s+=(f-e[u])*(f-e[u]))}return s},l.getAnchorAlignment=Bp,l.getAnchorJustification=yg,l.getBounds=function(n){let e=1/0,i=1/0,s=-1/0,u=-1/0;for(const f of n)e=Math.min(e,f.x),i=Math.min(i,f.y),s=Math.max(s,f.x),u=Math.max(u,f.y);return{min:new Fe(e,i),max:new Fe(s,u)}},l.getColumn=lr,l.getDefaultExportFromCjs=Wt,l.getGridMatrix=function(n,e,i,s){const u=e.getNorth(),f=e.getSouth(),g=e.getWest(),y=e.getEast(),w=1<<n.z,E=y-g,k=u-f,z=E/64,U=-k/Nu[i],Y=[0,z,0,U,0,0,u,g,0];if(n.z>0){const J=180/s;Dd(Y,Y,[J/E+1,0,0,0,J/k+1,0,-.5*J/z,.5*J/U,1])}return Y[2]=w,Y[5]=n.x,Y[8]=n.y,Y},l.getImage=Le,l.getJSON=function(n,e){return ir(Re(n,{type:"json"}),e)},l.getLatitudinalLod=function(n){const e=Ws-5;n=Vt(n,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(De(n))),3);return Math.round(i*(Nu.length-1))},l.getMapSessionAPI=vr,l.getPerformanceMeasurement=Mo,l.getProjection=Eg,l.getRTLTextPluginStatus=x,l.getReferrer=gr,l.getTilePoint=function(n,{x:e,y:i},s=0){return new Fe(((e-s)*n.scale-n.x)*Ai,(i*n.scale-n.y)*Ai)},l.getTileVec3=function(n,e,i=0){return lc(((e.x-i)*n.scale-n.x)*Ai,(e.y*n.scale-n.y)*Ai,op(e.z,e.y))},l.getVideo=function(n,e){const i=Me.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<n.length;s++){const u=Me.document.createElement("source");No(n[s])||(i.crossOrigin="Anonymous"),u.src=n[s],i.appendChild(u)}return{cancel:()=>{}}},l.globeCenterToScreenPoint=function(n){const e=[0,0,0],i=dl(new Float64Array(16));return pu(i,n.pixelMatrix,n.globeMatrix),Ss(e,e,i),new Fe(e[0],e[1])},l.globeDenormalizeECEF=tp,l.globeECEFOrigin=function(n,e){const i=[0,0,0];return Ss(i,i,_u(Ya(e.canonical))),Ss(i,i,n),i},l.globeMetersToEcef=zu,l.globeNormalizeECEF=_u,l.globePixelsToTileUnits=function(n,e){return Ai/(512*Math.pow(2,n))*Ih(Ya(e))},l.globePoleMatrixForTile=function(n,e,i){const s=dl(new Float64Array(16)),u=(e/(1<<n)-.5)*Math.PI*2;return Vf(s,i.globeMatrix,u),Float32Array.from(s)},l.globeTileBounds=Ya,l.globeTiltAtLngLat=Rm,l.globeToMercatorTransition=Uu,l.globeUseCustomAntiAliasing=function(n,e,i){const s=Uu(i.zoom),u=n.style.map._antialias,f=!!e.extStandardDerivatives,g=e.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return 0===s&&!u&&!g&&f},l.identity=dl,l.identity$1=Wf,l.invert=zf,l.isFullscreen=function(){return!!Me.document.fullscreenElement||!!Me.document.webkitFullscreenElement},l.isLngLatBehindGlobe=Ah,l.isMapAuthenticated=function(n){return Di.has(n)},l.isMapboxURL=ot,l.isSafariWithAntialiasingBug=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!ar(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},l.latFromMercatorY=ga,l.latLngToECEF=gu,l.len=_v,l.length=Cd,l.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},l.lngFromMercatorX=rl,l.loadVectorTile=Fg,l.makeRequest=ir,l.mapValue=function(n,e,i,s,u){return Vt((n-e)/(i-e)*(u-s)+s,s,u)},l.mercatorScale=Ph,l.mercatorXfromLng=Xl,l.mercatorYfromLat=Kl,l.mercatorZfromAltitude=Ol,l.mul=mv,l.mul$1=gv,l.multiply=pu,l.multiply$1=Dd,l.multiply$2=Gf,l.nextPowerOfTwo=en,l.normalize=Ta,l.normalize$1=Fu,l.normalize$2=Im,l.number=K,l.ortho=function(n,e,i,s,u,f,g){var y=1/(e-i),w=1/(s-u),E=1/(f-g);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*E,n[11]=0,n[12]=(e+i)*y,n[13]=(u+s)*w,n[14]=(g+f)*E,n[15]=1,n},l.pbf=qd,l.perspective=function(n,e,i,s,u){var f,g=1/Math.tan(e/2);return n[0]=g/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=g,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=u&&u!==1/0?(n[10]=(u+s)*(f=1/(s-u)),n[14]=2*u*s*f):(n[10]=-1,n[14]=-2*s),n},l.pick=function(n,e){const i={};for(let s=0;s<e.length;s++){const u=e[s];u in n&&(i[u]=n[u])}return i},l.plugin=A,l.pointGeometry=Tt,l.polesInViewport=function(n){const e=dl(new Float64Array(16));pu(e,n.pixelMatrix,n.globeMatrix);const i=[0,fl,0],s=[0,pl,0];return Ss(i,i,e),Ss(s,s,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!Ah(n,new Qr(n.center.lat,90)),s[0]>0&&s[0]<=n.width&&s[1]>0&&s[1]<=n.height&&!Ah(n,new Qr(n.center.lat,-90))]},l.polygonContainsPoint=Ac,l.polygonIntersectsBox=Bh,l.polygonIntersectsPolygon=lp,l.polygonizeBounds=function(n,e,i=0,s=!0){const u=new Fe(i,i),f=n.sub(u),g=e.add(u),y=[f,new Fe(g.x,f.y),g,new Fe(f.x,g.y)];return s&&y.push(f.clone()),y},l.posAttributes=Tc,l.postMapLoadEvent=si,l.postPerformanceEvent=Ui,l.postTurnstileEvent=cn,l.potpack=Bc,l.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},l.radToDeg=dt,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.registerForPluginStateChange=function(n){return n({pluginStatus:h,pluginURL:r}),_.on("pluginStateChange",n),n},l.removeAuthState=function(n){Di.delete(n)},l.renderColorRamp=Fd,l.resample=km,l.rotateX=$f,l.rotateX$1=qf,l.rotateY=Vf,l.rotateY$1=Yf,l.rotateZ=function(n,e,i){var s=Math.sin(i),u=Math.cos(i),f=e[0],g=e[1],y=e[2],w=e[3],E=e[4],k=e[5],z=e[6],U=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u+E*s,n[1]=g*u+k*s,n[2]=y*u+z*s,n[3]=w*u+U*s,n[4]=E*u-f*s,n[5]=k*u-g*s,n[6]=z*u-y*s,n[7]=U*u-w*s,n},l.rotateZ$1=function(n,e,i){i*=.5;var s=e[0],u=e[1],f=e[2],g=e[3],y=Math.sin(i),w=Math.cos(i);return n[0]=s*w+u*y,n[1]=u*w-s*y,n[2]=f*w+g*y,n[3]=g*w-f*y,n},l.scale=Rl,l.scale$1=m_,l.scale$2=hl,l.scaleAndAdd=Td,l.set=function(n,e,i,s){return n[0]=e,n[1]=i,n[2]=s,n},l.setCacheLimits=function(n,e){pr=n,oo=e},l.setColumn=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},l.setRTLTextPlugin=function(n,e,i=!1){if(h===Il||h===Vl||h===Qa)throw new Error("setRTLTextPlugin cannot be called multiple times.");r=Dr.resolveURL(n),h=Il,Ml=e,p(),i||C()},l.smoothstep=Jn,l.spec=Gt,l.squaredLength=function(n){var e=n[0],i=n[1],s=n[2];return e*e+i*i+s*s},l.storeAuthState=function(n,e){e?Di.add(n):Di.delete(n)},l.sub=Wl,l.subtract=Hf,l.symbolSize=Wd,l.tileAABB=function(n,e,i,s,u,f,g,y,w){if("globe"===w.name)return function Pm(n,e,i){const s=e/n.worldSize,u=n.globeMatrix;if(i.z<=1){const zt=Ya(i).getCorners();return Am(zt,u,s),Sa.fromPoints(zt)}const f=Th(i),g=Sh(f);Am(g,u,s);const y=Number.MAX_VALUE,w=[-y,-y,-y],E=[y,y,y];if(f.contains(n.center)){for(const On of g)bh(E,E,On),Lu(w,w,On);w[2]=0;const zt=n.point,dn=[zt.x*s,zt.y*s,0];return bh(E,E,dn),Lu(w,w,dn),new Sa(E,w)}const k=[u[12]*s,u[13]*s,u[14]*s],z=f.getCenter(),U=Vt(n.center.lat,-Ws,Ws),Y=Vt(z.lat,-Ws,Ws),J=Xl(n.center.lng),oe=Kl(U);let _e=J-Xl(z.lng);const Pe=oe-Kl(Y);_e>.5?_e-=1:_e<-.5&&(_e+=1);let qe=0;Math.abs(_e)>Math.abs(Pe)?qe=_e>=0?1:3:(qe=Pe>=0?0:2,Td(k,k,[u[4]*s,u[5]*s,u[6]*s],-Math.sin(De(Pe>=0?f.getSouth():f.getNorth()))*Yl));const Ae=g[qe],He=g[(qe+1)%4],tt=new Qf(Ae,He,k),Je=[ma(tt,0)||Ae[0],ma(tt,1)||Ae[1],ma(tt,2)||Ae[2]],Yt=Uu(n.zoom);if(Yt>0){const zt=function({x:On,y:Xt,z:En},Dn,An,Bn,ln){const Qn=1/(1<<En);let hi=On*Qn,ni=hi+Qn,er=Xt*Qn,jn=er+Qn,Ci=0;const tr=(hi+ni)/2-Bn;return tr>.5?Ci=-1:tr<-.5&&(Ci=1),hi=((hi+Ci)*Dn-(Bn*=Dn))*An+Bn,ni=((ni+Ci)*Dn-Bn)*An+Bn,er=(er*Dn-(ln*=Dn))*An+ln,jn=(jn*Dn-ln)*An+ln,[[hi,jn,0],[ni,jn,0],[ni,er,0],[hi,er,0]]}(i,e,n._pixelsPerMercatorPixel,J,oe);for(let On=0;On<g.length;On++)Sc(g[On],zt[On],Yt);const dn=Gl([],zt[qe],zt[(qe+1)%4]);hl(dn,dn,.5),Sc(Je,dn,Yt)}for(const zt of g)bh(E,E,zt),Lu(w,w,zt);return E[2]=Math.min(Ae[2],He[2]),bh(E,E,Je),Lu(w,w,Je),new Sa(E,w)}(n,e,new Jh(i,s,u));const E=sr({z:i,x:s,y:u},w);return new Sa([(f+E.x/E.scale)*e,e*(E.y/E.scale),g],[(f+E.x2/E.scale)*e,e*(E.y2/E.scale),y])},l.tileCornersToBounds=Th,l.tileTransform=sr,l.transformMat3=function(n,e,i){var s=e[0],u=e[1],f=e[2];return n[0]=s*i[0]+u*i[3]+f*i[6],n[1]=s*i[1]+u*i[4]+f*i[7],n[2]=s*i[2]+u*i[5]+f*i[8],n},l.transformMat4=Ss,l.transformMat4$1=ql,l.transformQuat=wh,l.transitionTileAABBinECEF=ep,l.translate=Hl,l.transpose=function(n,e){if(n===e){var i=e[1],s=e[2],u=e[5];n[1]=e[3],n[2]=e[6],n[3]=i,n[5]=e[7],n[6]=s,n[7]=u}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},l.triggerPluginCompletionEvent=c,l.uniqueId=at,l.updateGlobeVertexNormal=function(n,e,i,s,u){const f=5*e+2;n.float32[f+0]=i,n.float32[f+1]=s,n.float32[f+2]=u},l.validateCustomStyleLayer=function(n){const e=[],i=n.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===n.render&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&"2d"!==n.renderingMode&&"3d"!==n.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},l.validateFilter=n=>Oa(sc(n)),l.validateFog=n=>Oa(ja(n)),l.validateLayer=n=>Oa(Va(n)),l.validateLight=n=>Oa(au(n)),l.validateSource=n=>Oa(su(n)),l.validateStyle=Pu,l.validateTerrain=n=>Oa(js(n)),l.values=tn,l.vectorTile=Zh,l.version=ht,l.warnOnce=xn,l.window=Me,l.wrap=Ht}),b(0,function(l){function Me(Ue){if("number"==typeof Ue||"boolean"==typeof Ue||"string"==typeof Ue||null==Ue)return JSON.stringify(Ue);if(Array.isArray(Ue)){let de="[";for(const Le of Ue)de+=`${Me(Le)},`;return`${de}]`}let ae="{";for(const de of Object.keys(Ue).sort())ae+=`${de}:${Me(Ue[de])},`;return`${ae}}`}function ht(Ue){let ae="";for(const de of l.refProperties)ae+=`/${Me(Ue[de])}`;return ae}class Ke{constructor(ae){this.keyCache={},ae&&this.replace(ae)}replace(ae){this._layerConfigs={},this._layers={},this.update(ae,[])}update(ae,de){for(const We of ae)this._layerConfigs[We.id]=We,(this._layers[We.id]=l.createStyleLayer(We)).compileFilter(),this.keyCache[We.id]&&delete this.keyCache[We.id];for(const We of de)delete this.keyCache[We],delete this._layerConfigs[We],delete this._layers[We];this.familiesBySource={};const Le=function(We,ot){const Rt={};for(let rt=0;rt<We.length;rt++){const Bt=ot&&ot[We[rt].id]||ht(We[rt]);ot&&(ot[We[rt].id]=Bt);let bn=Rt[Bt];bn||(bn=Rt[Bt]=[]),bn.push(We[rt])}const It=[];for(const rt in Rt)It.push(Rt[rt]);return It}(l.values(this._layerConfigs),this.keyCache);for(const We of Le){const ot=We.map(Pn=>this._layers[Pn.id]),Rt=ot[0];if("none"===Rt.visibility)continue;const It=Rt.source||"";let rt=this.familiesBySource[It];rt||(rt=this.familiesBySource[It]={});const Bt=Rt.sourceLayer||"_geojsonTileLayer";let bn=rt[Bt];bn||(bn=rt[Bt]=[]),bn.push(ot)}}}class pt{loadTile(ae,de){const{uid:Le,encoding:We,rawImageData:ot,padding:Rt,buildQuadTree:It}=ae,rt=l.window.ImageBitmap&&ot instanceof l.window.ImageBitmap?this.getImageData(ot,Rt):ot;de(null,new l.DEMData(Le,rt,We,Rt<1,It))}getImageData(ae,de){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ae.width,ae.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ae.width,this.offscreenCanvas.height=ae.height,this.offscreenCanvasContext.drawImage(ae,0,0,ae.width,ae.height);const Le=this.offscreenCanvasContext.getImageData(-de,-de,ae.width+2*de,ae.height+2*de);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Le}}function yt(Ue,ae){if(0!==Ue.length){Dt(Ue[0],ae);for(var de=1;de<Ue.length;de++)Dt(Ue[de],!ae)}}function Dt(Ue,ae){for(var de=0,Le=0,We=0,ot=Ue.length,Rt=ot-1;We<ot;Rt=We++){var It=(Ue[We][0]-Ue[Rt][0])*(Ue[Rt][1]+Ue[We][1]),rt=de+It;Le+=Math.abs(de)>=Math.abs(It)?de-rt+It:It-rt+de,de=rt}de+Le>=0!=!!ae&&Ue.reverse()}var st=l.getDefaultExportFromCjs(function Ue(ae,de){var Le,We=ae&&ae.type;if("FeatureCollection"===We)for(Le=0;Le<ae.features.length;Le++)Ue(ae.features[Le],de);else if("GeometryCollection"===We)for(Le=0;Le<ae.geometries.length;Le++)Ue(ae.geometries[Le],de);else if("Feature"===We)Ue(ae.geometry,de);else if("Polygon"===We)yt(ae.coordinates,de);else if("MultiPolygon"===We)for(Le=0;Le<ae.coordinates.length;Le++)yt(ae.coordinates[Le],de);return ae});const bt=l.VectorTileFeature.prototype.toGeoJSON;var mt={exports:{}},Qe=l.pointGeometry,_t=l.vectorTile.VectorTileFeature,Wt=Ct;function Ct(Ue,ae){this.options=ae||{},this.features=Ue,this.length=Ue.length}function it(Ue,ae){this.id="number"==typeof Ue.id?Ue.id:void 0,this.type=Ue.type,this.rawGeometry=1===Ue.type?[Ue.geometry]:Ue.geometry,this.properties=Ue.tags,this.extent=ae||4096}Ct.prototype.feature=function(Ue){return new it(this.features[Ue],this.options.extent)},it.prototype.loadGeometry=function(){var Ue=this.rawGeometry;this.geometry=[];for(var ae=0;ae<Ue.length;ae++){for(var de=Ue[ae],Le=[],We=0;We<de.length;We++)Le.push(new Qe(de[We][0],de[We][1]));this.geometry.push(Le)}return this.geometry},it.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ue=this.geometry,ae=1/0,de=-1/0,Le=1/0,We=-1/0,ot=0;ot<Ue.length;ot++)for(var Rt=Ue[ot],It=0;It<Rt.length;It++){var rt=Rt[It];ae=Math.min(ae,rt.x),de=Math.max(de,rt.x),Le=Math.min(Le,rt.y),We=Math.max(We,rt.y)}return[ae,Le,de,We]},it.prototype.toGeoJSON=_t.prototype.toGeoJSON;var Kt=l.pbf,Tt=Wt;function Ze(Ue){var ae=new Kt;return function(de,Le){for(var We in de.layers)Le.writeMessage(3,Fe,de.layers[We])}(Ue,ae),ae.finish()}function Fe(Ue,ae){var de;ae.writeVarintField(15,Ue.version||1),ae.writeStringField(1,Ue.name||""),ae.writeVarintField(5,Ue.extent||4096);var Le={keys:[],values:[],keycache:{},valuecache:{}};for(de=0;de<Ue.length;de++)Le.feature=Ue.feature(de),ae.writeMessage(2,$t,Le);var We=Le.keys;for(de=0;de<We.length;de++)ae.writeStringField(3,We[de]);var ot=Le.values;for(de=0;de<ot.length;de++)ae.writeMessage(4,ft,ot[de])}function $t(Ue,ae){var de=Ue.feature;void 0!==de.id&&ae.writeVarintField(1,de.id),ae.writeMessage(2,un,Ue),ae.writeVarintField(3,de.type),ae.writeMessage(4,Lt,de)}function un(Ue,ae){var de=Ue.feature,Le=Ue.keys,We=Ue.values,ot=Ue.keycache,Rt=Ue.valuecache;for(var It in de.properties){var rt=de.properties[It],Bt=ot[It];if(null!==rt){void 0===Bt&&(Le.push(It),ot[It]=Bt=Le.length-1),ae.writeVarint(Bt);var bn=typeof rt;"string"!==bn&&"boolean"!==bn&&"number"!==bn&&(rt=JSON.stringify(rt));var Pn=bn+":"+rt,Ye=Rt[Pn];void 0===Ye&&(We.push(rt),Rt[Pn]=Ye=We.length-1),ae.writeVarint(Ye)}}}function De(Ue,ae){return(ae<<3)+(7&Ue)}function dt(Ue){return Ue<<1^Ue>>31}function Lt(Ue,ae){for(var de=Ue.loadGeometry(),Le=Ue.type,We=0,ot=0,Rt=de.length,It=0;It<Rt;It++){var rt=de[It],Bt=1;1===Le&&(Bt=rt.length),ae.writeVarint(De(1,Bt));for(var bn=3===Le?rt.length-1:rt.length,Pn=0;Pn<bn;Pn++){1===Pn&&1!==Le&&ae.writeVarint(De(2,bn-1));var Ye=rt[Pn].x-We,je=rt[Pn].y-ot;ae.writeVarint(dt(Ye)),ae.writeVarint(dt(je)),We+=Ye,ot+=je}3===Le&&ae.writeVarint(De(7,1))}}function ft(Ue,ae){var de=typeof Ue;"string"===de?ae.writeStringField(1,Ue):"boolean"===de?ae.writeBooleanField(7,Ue):"number"===de&&(Ue%1!=0?ae.writeDoubleField(3,Ue):Ue<0?ae.writeSVarintField(6,Ue):ae.writeVarintField(5,Ue))}mt.exports=Ze,mt.exports.fromVectorTileJs=Ze,mt.exports.fromGeojsonVt=function(Ue,ae){ae=ae||{};var de={};for(var Le in Ue)de[Le]=new Tt(Ue[Le].features,ae),de[Le].name=Le,de[Le].version=ae.version,de[Le].extent=ae.extent;return Ze({layers:de})},mt.exports.GeoJSONWrapper=Tt;var pn=l.getDefaultExportFromCjs(mt.exports);const hn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ue=>Ue},Vt=Math.fround||(Jn=new Float32Array(1),Ue=>(Jn[0]=+Ue,Jn[0]));var Jn;const Ht=3,li=5,tn=6;class Re{constructor(ae){this.options=Object.assign(Object.create(hn),ae),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ae){const{log:de,minZoom:Le,maxZoom:We}=this.options;de&&console.time("total time");const ot=`prepare ${ae.length} points`;de&&console.time(ot),this.points=ae;const Rt=[];for(let rt=0;rt<ae.length;rt++){const Bt=ae[rt];if(!Bt.geometry)continue;const[bn,Pn]=Bt.geometry.coordinates,Ye=Vt(At(bn)),je=Vt(en(Pn));Rt.push(Ye,je,1/0,rt,-1,1),this.options.reduce&&Rt.push(0)}let It=this.trees[We+1]=this._createTree(Rt);de&&console.timeEnd(ot);for(let rt=We;rt>=Le;rt--){const Bt=+Date.now();It=this.trees[rt]=this._createTree(this._cluster(It,rt)),de&&console.log("z%d: %d clusters in %dms",rt,It.numItems,+Date.now()-Bt)}return de&&console.timeEnd("total time"),this}getClusters(ae,de){let Le=((ae[0]+180)%360+360)%360-180;const We=Math.max(-90,Math.min(90,ae[1]));let ot=180===ae[2]?180:((ae[2]+180)%360+360)%360-180;const Rt=Math.max(-90,Math.min(90,ae[3]));if(ae[2]-ae[0]>=360)Le=-180,ot=180;else if(Le>ot){const Pn=this.getClusters([Le,We,180,Rt],de),Ye=this.getClusters([-180,We,ot,Rt],de);return Pn.concat(Ye)}const It=this.trees[this._limitZoom(de)],rt=It.range(At(Le),en(Rt),At(ot),en(We)),Bt=It.data,bn=[];for(const Pn of rt){const Ye=this.stride*Pn;bn.push(Bt[Ye+li]>1?Ne(Bt,Ye,this.clusterProps):this.points[Bt[Ye+Ht]])}return bn}getChildren(ae){const de=this._getOriginId(ae),Le=this._getOriginZoom(ae),We="No cluster with the specified id.",ot=this.trees[Le];if(!ot)throw new Error(We);const Rt=ot.data;if(de*this.stride>=Rt.length)throw new Error(We);const It=this.options.radius/(this.options.extent*Math.pow(2,Le-1)),rt=ot.within(Rt[de*this.stride],Rt[de*this.stride+1],It),Bt=[];for(const bn of rt){const Pn=bn*this.stride;Rt[Pn+4]===ae&&Bt.push(Rt[Pn+li]>1?Ne(Rt,Pn,this.clusterProps):this.points[Rt[Pn+Ht]])}if(0===Bt.length)throw new Error(We);return Bt}getLeaves(ae,de,Le){const We=[];return this._appendLeaves(We,ae,de=de||10,Le=Le||0,0),We}getTile(ae,de,Le){const We=this.trees[this._limitZoom(ae)],ot=Math.pow(2,ae),{extent:Rt,radius:It}=this.options,rt=It/Rt,Bt=(Le-rt)/ot,bn=(Le+1+rt)/ot,Pn={features:[]};return this._addTileFeatures(We.range((de-rt)/ot,Bt,(de+1+rt)/ot,bn),We.data,de,Le,ot,Pn),0===de&&this._addTileFeatures(We.range(1-rt/ot,Bt,1,bn),We.data,ot,Le,ot,Pn),de===ot-1&&this._addTileFeatures(We.range(0,Bt,rt/ot,bn),We.data,-1,Le,ot,Pn),Pn.features.length?Pn:null}getClusterExpansionZoom(ae){let de=this._getOriginZoom(ae)-1;for(;de<=this.options.maxZoom;){const Le=this.getChildren(ae);if(de++,1!==Le.length)break;ae=Le[0].properties.cluster_id}return de}_appendLeaves(ae,de,Le,We,ot){const Rt=this.getChildren(de);for(const It of Rt){const rt=It.properties;if(rt&&rt.cluster?ot+rt.point_count<=We?ot+=rt.point_count:ot=this._appendLeaves(ae,rt.cluster_id,Le,We,ot):ot<We?ot++:ae.push(It),ae.length===Le)break}return ot}_createTree(ae){const de=new l.KDBush(ae.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Le=0;Le<ae.length;Le+=this.stride)de.add(ae[Le],ae[Le+1]);return de.finish(),de.data=ae,de}_addTileFeatures(ae,de,Le,We,ot,Rt){for(const It of ae){const rt=It*this.stride,Bt=de[rt+li]>1;let bn,Pn,Ye;if(Bt)bn=at(de,rt,this.clusterProps),Pn=de[rt],Ye=de[rt+1];else{const Ge=this.points[de[rt+Ht]];bn=Ge.properties;const[Ot,cn]=Ge.geometry.coordinates;Pn=At(Ot),Ye=en(cn)}const je={type:1,geometry:[[Math.round(this.options.extent*(Pn*ot-Le)),Math.round(this.options.extent*(Ye*ot-We))]],tags:bn};let wt;wt=Bt||this.options.generateId?de[rt+Ht]:this.points[de[rt+Ht]].id,void 0!==wt&&(je.id=wt),Rt.features.push(je)}}_limitZoom(ae){return Math.max(this.options.minZoom,Math.min(Math.floor(+ae),this.options.maxZoom+1))}_cluster(ae,de){const{radius:Le,extent:We,reduce:ot,minPoints:Rt}=this.options,It=Le/(We*Math.pow(2,de)),rt=ae.data,Bt=[],bn=this.stride;for(let Pn=0;Pn<rt.length;Pn+=bn){if(rt[Pn+2]<=de)continue;rt[Pn+2]=de;const Ye=rt[Pn],je=rt[Pn+1],wt=ae.within(rt[Pn],rt[Pn+1],It),Ge=rt[Pn+li];let Ot=Ge;for(const cn of wt){const $n=cn*bn;rt[$n+2]>de&&(Ot+=rt[$n+li])}if(Ot>Ge&&Ot>=Rt){let cn,$n=Ye*Ge,si=je*Ge,bi=-1;const Ui=((Pn/bn|0)<<5)+(de+1)+this.points.length;for(const ji of wt){const vr=ji*bn;if(rt[vr+2]<=de)continue;rt[vr+2]=de;const Di=rt[vr+li];$n+=rt[vr]*Di,si+=rt[vr+1]*Di,rt[vr+4]=Ui,ot&&(cn||(cn=this._map(rt,Pn,!0),bi=this.clusterProps.length,this.clusterProps.push(cn)),ot(cn,this._map(rt,vr)))}rt[Pn+4]=Ui,Bt.push($n/Ot,si/Ot,1/0,Ui,-1,Ot),ot&&Bt.push(bi)}else{for(let cn=0;cn<bn;cn++)Bt.push(rt[Pn+cn]);if(Ot>1)for(const cn of wt){const $n=cn*bn;if(!(rt[$n+2]<=de)){rt[$n+2]=de;for(let si=0;si<bn;si++)Bt.push(rt[$n+si])}}}}return Bt}_getOriginId(ae){return ae-this.points.length>>5}_getOriginZoom(ae){return(ae-this.points.length)%32}_map(ae,de,Le){if(ae[de+li]>1){const Rt=this.clusterProps[ae[de+tn]];return Le?Object.assign({},Rt):Rt}const We=this.points[ae[de+Ht]].properties,ot=this.options.map(We);return Le&&ot===We?Object.assign({},ot):ot}}function Ne(Ue,ae,de){return{type:"Feature",id:Ue[ae+Ht],properties:at(Ue,ae,de),geometry:{type:"Point",coordinates:[(Le=Ue[ae],360*(Le-.5)),on(Ue[ae+1])]}};var Le}function at(Ue,ae,de){const Le=Ue[ae+li],We=Le>=1e4?`${Math.round(Le/1e3)}k`:Le>=1e3?Math.round(Le/100)/10+"k":Le,ot=Ue[ae+tn],Rt=-1===ot?{}:Object.assign({},de[ot]);return Object.assign(Rt,{cluster:!0,cluster_id:Ue[ae+Ht],point_count:Le,point_count_abbreviated:We})}function At(Ue){return Ue/360+.5}function en(Ue){const ae=Math.sin(Ue*Math.PI/180),de=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return de<0?0:de>1?1:de}function on(Ue){const ae=(180-360*Ue)*Math.PI/180;return 360*Math.atan(Math.exp(ae))/Math.PI-90}function Zn(Ue,ae,de,Le){for(var We,ot=Le,Rt=de-ae>>1,It=de-ae,rt=Ue[ae],Bt=Ue[ae+1],bn=Ue[de],Pn=Ue[de+1],Ye=ae+3;Ye<de;Ye+=3){var je=ri(Ue[Ye],Ue[Ye+1],rt,Bt,bn,Pn);if(je>ot)We=Ye,ot=je;else if(je===ot){var wt=Math.abs(Ye-Rt);wt<It&&(We=Ye,It=wt)}}ot>Le&&(We-ae>3&&Zn(Ue,ae,We,Le),Ue[We+2]=ot,de-We>3&&Zn(Ue,We,de,Le))}function ri(Ue,ae,de,Le,We,ot){var Rt=We-de,It=ot-Le;if(0!==Rt||0!==It){var rt=((Ue-de)*Rt+(ae-Le)*It)/(Rt*Rt+It*It);rt>1?(de=We,Le=ot):rt>0&&(de+=Rt*rt,Le+=It*rt)}return(Rt=Ue-de)*Rt+(It=ae-Le)*It}function Cn(Ue,ae,de,Le){var We={id:void 0===Ue?null:Ue,type:ae,geometry:de,tags:Le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ot){var Rt=ot.geometry,It=ot.type;if("Point"===It||"MultiPoint"===It||"LineString"===It)nn(ot,Rt);else if("Polygon"===It||"MultiLineString"===It)for(var rt=0;rt<Rt.length;rt++)nn(ot,Rt[rt]);else if("MultiPolygon"===It)for(rt=0;rt<Rt.length;rt++)for(var Bt=0;Bt<Rt[rt].length;Bt++)nn(ot,Rt[rt][Bt])}(We),We}function nn(Ue,ae){for(var de=0;de<ae.length;de+=3)Ue.minX=Math.min(Ue.minX,ae[de]),Ue.minY=Math.min(Ue.minY,ae[de+1]),Ue.maxX=Math.max(Ue.maxX,ae[de]),Ue.maxY=Math.max(Ue.maxY,ae[de+1])}function xt(Ue,ae,de,Le){if(ae.geometry){var We=ae.geometry.coordinates,ot=ae.geometry.type,Rt=Math.pow(de.tolerance/((1<<de.maxZoom)*de.extent),2),It=[],rt=ae.id;if(de.promoteId?rt=ae.properties[de.promoteId]:de.generateId&&(rt=Le||0),"Point"===ot)St(We,It);else if("MultiPoint"===ot)for(var Bt=0;Bt<We.length;Bt++)St(We[Bt],It);else if("LineString"===ot)xn(We,It,Rt,!1);else if("MultiLineString"===ot){if(de.lineMetrics){for(Bt=0;Bt<We.length;Bt++)xn(We[Bt],It=[],Rt,!1),Ue.push(Cn(rt,"LineString",It,ae.properties));return}Hn(We,It,Rt,!1)}else if("Polygon"===ot)Hn(We,It,Rt,!0);else{if("MultiPolygon"!==ot){if("GeometryCollection"===ot){for(Bt=0;Bt<ae.geometry.geometries.length;Bt++)xt(Ue,{id:rt,geometry:ae.geometry.geometries[Bt],properties:ae.properties},de,Le);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Bt=0;Bt<We.length;Bt++){var bn=[];Hn(We[Bt],bn,Rt,!0),It.push(bn)}}Ue.push(Cn(rt,ot,It,ae.properties))}}function St(Ue,ae){ae.push(yi(Ue[0])),ae.push(qn(Ue[1])),ae.push(0)}function xn(Ue,ae,de,Le){for(var We,ot,Rt=0,It=0;It<Ue.length;It++){var rt=yi(Ue[It][0]),Bt=qn(Ue[It][1]);ae.push(rt),ae.push(Bt),ae.push(0),It>0&&(Rt+=Le?(We*Bt-rt*ot)/2:Math.sqrt(Math.pow(rt-We,2)+Math.pow(Bt-ot,2))),We=rt,ot=Bt}var bn=ae.length-3;ae[2]=1,Zn(ae,0,bn,de),ae[bn+2]=1,ae.size=Math.abs(Rt),ae.start=0,ae.end=ae.size}function Hn(Ue,ae,de,Le){for(var We=0;We<Ue.length;We++){var ot=[];xn(Ue[We],ot,de,Le),ae.push(ot)}}function yi(Ue){return Ue/360+.5}function qn(Ue){var ae=Math.sin(Ue*Math.PI/180),de=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return de<0?0:de>1?1:de}function ti(Ue,ae,de,Le,We,ot,Rt,It){if(Le/=ae,ot>=(de/=ae)&&Rt<Le)return Ue;if(Rt<de||ot>=Le)return null;for(var rt=[],Bt=0;Bt<Ue.length;Bt++){var bn=Ue[Bt],Pn=bn.geometry,Ye=bn.type,je=0===We?bn.minX:bn.minY,wt=0===We?bn.maxX:bn.maxY;if(je>=de&&wt<Le)rt.push(bn);else if(!(wt<de||je>=Le)){var Ge=[];if("Point"===Ye||"MultiPoint"===Ye)Xn(Pn,Ge,de,Le,We);else if("LineString"===Ye)ar(Pn,Ge,de,Le,We,!1,It.lineMetrics);else if("MultiLineString"===Ye)lr(Pn,Ge,de,Le,We,!1);else if("Polygon"===Ye)lr(Pn,Ge,de,Le,We,!0);else if("MultiPolygon"===Ye)for(var Ot=0;Ot<Pn.length;Ot++){var cn=[];lr(Pn[Ot],cn,de,Le,We,!0),cn.length&&Ge.push(cn)}if(Ge.length){if(It.lineMetrics&&"LineString"===Ye){for(Ot=0;Ot<Ge.length;Ot++)rt.push(Cn(bn.id,Ye,Ge[Ot],bn.tags));continue}"LineString"!==Ye&&"MultiLineString"!==Ye||(1===Ge.length?(Ye="LineString",Ge=Ge[0]):Ye="MultiLineString"),"Point"!==Ye&&"MultiPoint"!==Ye||(Ye=3===Ge.length?"Point":"MultiPoint"),rt.push(Cn(bn.id,Ye,Ge,bn.tags))}}}return rt.length?rt:null}function Xn(Ue,ae,de,Le,We){for(var ot=0;ot<Ue.length;ot+=3){var Rt=Ue[ot+We];Rt>=de&&Rt<=Le&&(ae.push(Ue[ot]),ae.push(Ue[ot+1]),ae.push(Ue[ot+2]))}}function ar(Ue,ae,de,Le,We,ot,Rt){for(var It,rt,Bt=yn(Ue),bn=0===We?pr:oo,Pn=Ue.start,Ye=0;Ye<Ue.length-3;Ye+=3){var je=Ue[Ye],wt=Ue[Ye+1],Ge=Ue[Ye+2],Ot=Ue[Ye+3],cn=Ue[Ye+4],$n=0===We?je:wt,si=0===We?Ot:cn,bi=!1;Rt&&(It=Math.sqrt(Math.pow(je-Ot,2)+Math.pow(wt-cn,2))),$n<de?si>de&&(rt=bn(Bt,je,wt,Ot,cn,de),Rt&&(Bt.start=Pn+It*rt)):$n>Le?si<Le&&(rt=bn(Bt,je,wt,Ot,cn,Le),Rt&&(Bt.start=Pn+It*rt)):Pr(Bt,je,wt,Ge),si<de&&$n>=de&&(rt=bn(Bt,je,wt,Ot,cn,de),bi=!0),si>Le&&$n<=Le&&(rt=bn(Bt,je,wt,Ot,cn,Le),bi=!0),!ot&&bi&&(Rt&&(Bt.end=Pn+It*rt),ae.push(Bt),Bt=yn(Ue)),Rt&&(Pn+=It)}var Ui=Ue.length-3;je=Ue[Ui],wt=Ue[Ui+1],Ge=Ue[Ui+2],($n=0===We?je:wt)>=de&&$n<=Le&&Pr(Bt,je,wt,Ge),Ui=Bt.length-3,ot&&Ui>=3&&(Bt[Ui]!==Bt[0]||Bt[Ui+1]!==Bt[1])&&Pr(Bt,Bt[0],Bt[1],Bt[2]),Bt.length&&ae.push(Bt)}function yn(Ue){var ae=[];return ae.size=Ue.size,ae.start=Ue.start,ae.end=Ue.end,ae}function lr(Ue,ae,de,Le,We,ot){for(var Rt=0;Rt<Ue.length;Rt++)ar(Ue[Rt],ae,de,Le,We,ot,!1)}function Pr(Ue,ae,de,Le){Ue.push(ae),Ue.push(de),Ue.push(Le)}function pr(Ue,ae,de,Le,We,ot){var Rt=(ot-ae)/(Le-ae);return Ue.push(ot),Ue.push(de+(We-de)*Rt),Ue.push(1),Rt}function oo(Ue,ae,de,Le,We,ot){var Rt=(ot-de)/(We-de);return Ue.push(ae+(Le-ae)*Rt),Ue.push(ot),Ue.push(1),Rt}function Si(Ue,ae){for(var de=[],Le=0;Le<Ue.length;Le++){var We,ot=Ue[Le],Rt=ot.type;if("Point"===Rt||"MultiPoint"===Rt||"LineString"===Rt)We=$i(ot.geometry,ae);else if("MultiLineString"===Rt||"Polygon"===Rt){We=[];for(var It=0;It<ot.geometry.length;It++)We.push($i(ot.geometry[It],ae))}else if("MultiPolygon"===Rt)for(We=[],It=0;It<ot.geometry.length;It++){for(var rt=[],Bt=0;Bt<ot.geometry[It].length;Bt++)rt.push($i(ot.geometry[It][Bt],ae));We.push(rt)}de.push(Cn(ot.id,Rt,We,ot.tags))}return de}function $i(Ue,ae){var de=[];de.size=Ue.size,void 0!==Ue.start&&(de.start=Ue.start,de.end=Ue.end);for(var Le=0;Le<Ue.length;Le+=3)de.push(Ue[Le]+ae,Ue[Le+1],Ue[Le+2]);return de}function po(Ue,ae){if(Ue.transformed)return Ue;var de,Le,We,ot=1<<Ue.z,Rt=Ue.x,It=Ue.y;for(de=0;de<Ue.features.length;de++){var rt=Ue.features[de],Bt=rt.geometry,bn=rt.type;if(rt.geometry=[],1===bn)for(Le=0;Le<Bt.length;Le+=2)rt.geometry.push(wi(Bt[Le],Bt[Le+1],ae,ot,Rt,It));else for(Le=0;Le<Bt.length;Le++){var Pn=[];for(We=0;We<Bt[Le].length;We+=2)Pn.push(wi(Bt[Le][We],Bt[Le][We+1],ae,ot,Rt,It));rt.geometry.push(Pn)}}return Ue.transformed=!0,Ue}function wi(Ue,ae,de,Le,We,ot){return[Math.round(de*(Ue*Le-We)),Math.round(de*(ae*Le-ot))]}function Hr(Ue,ae,de,Le,We){for(var ot=ae===We.maxZoom?0:We.tolerance/((1<<ae)*We.extent),Rt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:de,y:Le,z:ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},It=0;It<Ue.length;It++){Rt.numFeatures++,Er(Rt,Ue[It],ot,We);var rt=Ue[It].minX,Bt=Ue[It].minY,bn=Ue[It].maxX,Pn=Ue[It].maxY;rt<Rt.minX&&(Rt.minX=rt),Bt<Rt.minY&&(Rt.minY=Bt),bn>Rt.maxX&&(Rt.maxX=bn),Pn>Rt.maxY&&(Rt.maxY=Pn)}return Rt}function Er(Ue,ae,de,Le){var We=ae.geometry,ot=ae.type,Rt=[];if("Point"===ot||"MultiPoint"===ot)for(var It=0;It<We.length;It+=3)Rt.push(We[It]),Rt.push(We[It+1]),Ue.numPoints++,Ue.numSimplified++;else if("LineString"===ot)fi(Rt,We,Ue,de,!1,!1);else if("MultiLineString"===ot||"Polygon"===ot)for(It=0;It<We.length;It++)fi(Rt,We[It],Ue,de,"Polygon"===ot,0===It);else if("MultiPolygon"===ot)for(var rt=0;rt<We.length;rt++){var Bt=We[rt];for(It=0;It<Bt.length;It++)fi(Rt,Bt[It],Ue,de,!0,0===It)}if(Rt.length){var bn=ae.tags||null;if("LineString"===ot&&Le.lineMetrics){for(var Pn in bn={},ae.tags)bn[Pn]=ae.tags[Pn];bn.mapbox_clip_start=We.start/We.size,bn.mapbox_clip_end=We.end/We.size}var Ye={geometry:Rt,type:"Polygon"===ot||"MultiPolygon"===ot?3:"LineString"===ot||"MultiLineString"===ot?2:1,tags:bn};null!==ae.id&&(Ye.id=ae.id),Ue.features.push(Ye)}}function fi(Ue,ae,de,Le,We,ot){var Rt=Le*Le;if(Le>0&&ae.size<(We?Rt:Le))de.numPoints+=ae.length/3;else{for(var It=[],rt=0;rt<ae.length;rt+=3)(0===Le||ae[rt+2]>Rt)&&(de.numSimplified++,It.push(ae[rt]),It.push(ae[rt+1])),de.numPoints++;We&&function(Bt,bn){for(var Pn=0,Ye=0,je=Bt.length,wt=je-2;Ye<je;wt=Ye,Ye+=2)Pn+=(Bt[Ye]-Bt[wt])*(Bt[Ye+1]+Bt[wt+1]);if(Pn>0===bn)for(Ye=0,je=Bt.length;Ye<je/2;Ye+=2){var Ge=Bt[Ye],Ot=Bt[Ye+1];Bt[Ye]=Bt[je-2-Ye],Bt[Ye+1]=Bt[je-1-Ye],Bt[je-2-Ye]=Ge,Bt[je-1-Ye]=Ot}}(It,ot),Ue.push(It)}}function Sr(Ue,ae){var de=(ae=this.options=function(We,ot){for(var Rt in ot)We[Rt]=ot[Rt];return We}(Object.create(this.options),ae)).debug;if(de&&console.time("preprocess data"),ae.maxZoom<0||ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ae.promoteId&&ae.generateId)throw new Error("promoteId and generateId cannot be used together.");var We,ot,Rt,It,rt,Bt,Le=function(We,ot){var Rt=[];if("FeatureCollection"===We.type)for(var It=0;It<We.features.length;It++)xt(Rt,We.features[It],ot,It);else xt(Rt,"Feature"===We.type?We:{geometry:We},ot);return Rt}(Ue,ae);this.tiles={},this.tileCoords=[],de&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ae.indexMaxZoom,ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),It=We=Le,rt=ti(We,1,-1-(Rt=(ot=ae).buffer/ot.extent),Rt,0,-1,2,ot),Bt=ti(We,1,1-Rt,2+Rt,0,-1,2,ot),(rt||Bt)&&(It=ti(We,1,-Rt,1+Rt,0,-1,2,ot)||[],rt&&(It=Si(rt,1).concat(It)),Bt&&(It=It.concat(Si(Bt,-1)))),(Le=It).length&&this.splitTile(Le,0,0,0),de&&(Le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function gr(Ue,ae,de){return 32*((1<<Ue)*de+ae)+Ue}function ir(Ue,ae){const de=Ue.tileID.canonical;if(!this._geoJSONIndex)return ae(null,null);const Le=this._geoJSONIndex.getTile(de.z,de.x,de.y);if(!Le)return ae(null,null);const We=new class{constructor(Rt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=Rt.length,this._features=Rt}feature(Rt){return new class{constructor(It){this._feature=It,this.extent=l.EXTENT,this.type=It.type,this.properties=It.tags,"id"in It&&!isNaN(It.id)&&(this.id=parseInt(It.id,10))}loadGeometry(){if(1===this._feature.type){const It=[];for(const rt of this._feature.geometry)It.push([new l.Point(rt[0],rt[1])]);return It}{const It=[];for(const rt of this._feature.geometry){const Bt=[];for(const bn of rt)Bt.push(new l.Point(bn[0],bn[1]));It.push(Bt)}return It}}toGeoJSON(It,rt,Bt){return bt.call(this,It,rt,Bt)}}(this._features[Rt])}}(Le.features);let ot=pn(We);0===ot.byteOffset&&ot.byteLength===ot.buffer.byteLength||(ot=new Uint8Array(ot)),ae(null,{vectorTile:We,rawData:ot.buffer})}Sr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Sr.prototype.splitTile=function(Ue,ae,de,Le,We,ot,Rt){for(var It=[Ue,ae,de,Le],rt=this.options,Bt=rt.debug;It.length;){Le=It.pop(),de=It.pop(),ae=It.pop(),Ue=It.pop();var bn=1<<ae,Pn=gr(ae,de,Le),Ye=this.tiles[Pn];if(!Ye&&(Bt>1&&console.time("creation"),Ye=this.tiles[Pn]=Hr(Ue,ae,de,Le,rt),this.tileCoords.push({z:ae,x:de,y:Le}),Bt)){Bt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ae,de,Le,Ye.numFeatures,Ye.numPoints,Ye.numSimplified),console.timeEnd("creation"));var je="z"+ae;this.stats[je]=(this.stats[je]||0)+1,this.total++}if(Ye.source=Ue,We){if(ae===rt.maxZoom||ae===We)continue;var wt=1<<We-ae;if(de!==Math.floor(ot/wt)||Le!==Math.floor(Rt/wt))continue}else if(ae===rt.indexMaxZoom||Ye.numPoints<=rt.indexMaxPoints)continue;if(Ye.source=null,0!==Ue.length){Bt>1&&console.time("clipping");var Ge,Ot,cn,$n,si,bi,Ui=.5*rt.buffer/rt.extent,ji=.5-Ui,vr=.5+Ui,Di=1+Ui;Ge=Ot=cn=$n=null,si=ti(Ue,bn,de-Ui,de+vr,0,Ye.minX,Ye.maxX,rt),bi=ti(Ue,bn,de+ji,de+Di,0,Ye.minX,Ye.maxX,rt),Ue=null,si&&(Ge=ti(si,bn,Le-Ui,Le+vr,1,Ye.minY,Ye.maxY,rt),Ot=ti(si,bn,Le+ji,Le+Di,1,Ye.minY,Ye.maxY,rt),si=null),bi&&(cn=ti(bi,bn,Le-Ui,Le+vr,1,Ye.minY,Ye.maxY,rt),$n=ti(bi,bn,Le+ji,Le+Di,1,Ye.minY,Ye.maxY,rt),bi=null),Bt>1&&console.timeEnd("clipping"),It.push(Ge||[],ae+1,2*de,2*Le),It.push(Ot||[],ae+1,2*de,2*Le+1),It.push(cn||[],ae+1,2*de+1,2*Le),It.push($n||[],ae+1,2*de+1,2*Le+1)}}},Sr.prototype.getTile=function(Ue,ae,de){var Le=this.options,We=Le.extent,ot=Le.debug;if(Ue<0||Ue>24)return null;var Rt=1<<Ue,It=gr(Ue,ae=(ae%Rt+Rt)%Rt,de);if(this.tiles[It])return po(this.tiles[It],We);ot>1&&console.log("drilling down to z%d-%d-%d",Ue,ae,de);for(var rt,Bt=Ue,bn=ae,Pn=de;!rt&&Bt>0;)Bt--,bn=Math.floor(bn/2),Pn=Math.floor(Pn/2),rt=this.tiles[gr(Bt,bn,Pn)];return rt&&rt.source?(ot>1&&console.log("found parent tile z%d-%d-%d",Bt,bn,Pn),ot>1&&console.time("drilling down"),this.splitTile(rt.source,Bt,bn,Pn,Ue,ae,de),ot>1&&console.timeEnd("drilling down"),this.tiles[It]?po(this.tiles[It],We):null):null};class rr extends l.VectorTileWorkerSource{constructor(ae,de,Le,We,ot){super(ae,de,Le,We,ir),ot&&(this.loadGeoJSON=ot)}loadData(ae,de){const Le=ae&&ae.request,We=Le&&Le.collectResourceTiming;this.loadGeoJSON(ae,(ot,Rt)=>{if(ot||!Rt)return de(ot);if("object"!=typeof Rt)return de(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`));{st(Rt,!0);try{if(ae.filter){const rt=l.createExpression(ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===rt.result)throw new Error(rt.value.map(bn=>`${bn.key}: ${bn.message}`).join(", "));Rt={type:"FeatureCollection",features:Rt.features.filter(bn=>rt.value.evaluate({zoom:0},bn))}}this._geoJSONIndex=ae.cluster?new Re(function({superclusterOptions:rt,clusterProperties:Bt}){if(!Bt||!rt)return rt;const bn={},Pn={},Ye={accumulated:null,zoom:0},je={properties:null},wt=Object.keys(Bt);for(const Ge of wt){const[Ot,cn]=Bt[Ge],$n=l.createExpression(cn),si=l.createExpression("string"==typeof Ot?[Ot,["accumulated"],["get",Ge]]:Ot);bn[Ge]=$n.value,Pn[Ge]=si.value}return rt.map=Ge=>{je.properties=Ge;const Ot={};for(const cn of wt)Ot[cn]=bn[cn].evaluate(Ye,je);return Ot},rt.reduce=(Ge,Ot)=>{je.properties=Ot;for(const cn of wt)Ye.accumulated=Ge[cn],Ge[cn]=Pn[cn].evaluate(Ye,je)},rt}(ae)).load(Rt.features):new Sr(rt=Rt,ae.geojsonVtOptions)}catch(rt){return de(rt)}this.loaded={};const It={};if(We){const rt=l.getPerformanceMeasurement(Le);rt&&(It.resourceTiming={},It.resourceTiming[ae.source]=JSON.parse(JSON.stringify(rt)))}de(null,It)}var rt})}reloadTile(ae,de){const Le=this.loaded;return Le&&Le[ae.uid]?super.reloadTile(ae,de):this.loadTile(ae,de)}loadGeoJSON(ae,de){if(ae.request)l.getJSON(ae.request,de);else{if("string"!=typeof ae.data)return de(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`));try{return de(null,JSON.parse(ae.data))}catch{return de(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ae,de){try{de(null,this._geoJSONIndex.getClusterExpansionZoom(ae.clusterId))}catch(Le){de(Le)}}getClusterChildren(ae,de){try{de(null,this._geoJSONIndex.getChildren(ae.clusterId))}catch(Le){de(Le)}}getClusterLeaves(ae,de){try{de(null,this._geoJSONIndex.getLeaves(ae.clusterId,ae.limit,ae.offset))}catch(Le){de(Le)}}}class No{constructor(ae){this.self=ae,this.actor=new l.Actor(ae,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=l.getProjection({name:"mercator"}),this.workerSourceTypes={vector:l.VectorTileWorkerSource,geojson:rr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(de,Le)=>{if(this.workerSourceTypes[de])throw new Error(`Worker source with name "${de}" already registered.`);this.workerSourceTypes[de]=Le},this.self.registerRTLTextPlugin=de=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=de.applyArabicShaping,l.plugin.processBidirectionalText=de.processBidirectionalText,l.plugin.processStyledBidirectionalText=de.processStyledBidirectionalText}}clearCaches(ae,de,Le){delete this.layerIndexes[ae],delete this.availableImages[ae],delete this.workerSources[ae],delete this.demWorkerSources[ae],Le()}checkIfReady(ae,de,Le){Le()}setReferrer(ae,de){this.referrer=de}spriteLoaded(ae,de){this.isSpriteLoaded[ae]=de;for(const Le in this.workerSources[ae]){const We=this.workerSources[ae][Le];for(const ot in We)We[ot]instanceof l.VectorTileWorkerSource&&(We[ot].isSpriteLoaded=de,We[ot].fire(new l.Event("isSpriteLoaded")))}}setImages(ae,de,Le){this.availableImages[ae]=de;for(const We in this.workerSources[ae]){const ot=this.workerSources[ae][We];for(const Rt in ot)ot[Rt].availableImages=de}Le()}enableTerrain(ae,de,Le){this.terrain=de,Le()}setProjection(ae,de){this.projections[ae]=l.getProjection(de)}setLayers(ae,de,Le){this.getLayerIndex(ae).replace(de),Le()}updateLayers(ae,de,Le){this.getLayerIndex(ae).update(de.layers,de.removedIds),Le()}loadTile(ae,de,Le){const We=this.enableTerrain?l.extend({enableTerrain:this.terrain},de):de;We.projection=this.projections[ae]||this.defaultProjection,this.getWorkerSource(ae,de.type,de.source).loadTile(We,Le)}loadDEMTile(ae,de,Le){const We=this.enableTerrain?l.extend({buildQuadTree:this.terrain},de):de;this.getDEMWorkerSource(ae,de.source).loadTile(We,Le)}reloadTile(ae,de,Le){const We=this.enableTerrain?l.extend({enableTerrain:this.terrain},de):de;We.projection=this.projections[ae]||this.defaultProjection,this.getWorkerSource(ae,de.type,de.source).reloadTile(We,Le)}abortTile(ae,de,Le){this.getWorkerSource(ae,de.type,de.source).abortTile(de,Le)}removeTile(ae,de,Le){this.getWorkerSource(ae,de.type,de.source).removeTile(de,Le)}removeSource(ae,de,Le){if(!this.workerSources[ae]||!this.workerSources[ae][de.type]||!this.workerSources[ae][de.type][de.source])return;const We=this.workerSources[ae][de.type][de.source];delete this.workerSources[ae][de.type][de.source],void 0!==We.removeSource?We.removeSource(de,Le):Le()}loadWorkerSource(ae,de,Le){try{this.self.importScripts(de.url),Le()}catch(We){Le(We.toString())}}syncRTLPluginState(ae,de,Le){try{l.plugin.setState(de);const We=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&null!=We){this.self.importScripts(We);const ot=l.plugin.isParsed();Le(ot?void 0:new Error(`RTL Text Plugin failed to import scripts from ${We}`),ot)}}catch(We){Le(We.toString())}}getAvailableImages(ae){let de=this.availableImages[ae];return de||(de=[]),de}getLayerIndex(ae){let de=this.layerIndexes[ae];return de||(de=this.layerIndexes[ae]=new Ke),de}getWorkerSource(ae,de,Le){return this.workerSources[ae]||(this.workerSources[ae]={}),this.workerSources[ae][de]||(this.workerSources[ae][de]={}),this.workerSources[ae][de][Le]||(this.workerSources[ae][de][Le]=new this.workerSourceTypes[de]({send:(ot,Rt,It,rt,Bt,bn)=>{this.actor.send(ot,Rt,It,ae,Bt,bn)},scheduler:this.actor.scheduler},this.getLayerIndex(ae),this.getAvailableImages(ae),this.isSpriteLoaded[ae])),this.workerSources[ae][de][Le]}getDEMWorkerSource(ae,de){return this.demWorkerSources[ae]||(this.demWorkerSources[ae]={}),this.demWorkerSources[ae][de]||(this.demWorkerSources[ae][de]=new pt),this.demWorkerSources[ae][de]}enforceCacheSizeLimit(ae,de){l.enforceCacheSizeLimit(de)}getWorkerPerformanceMetrics(ae,de,Le){Le(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new No(self)),No}),b(0,function(l){function Me(h,r){if(Array.isArray(h)){if(!Array.isArray(r)||h.length!==r.length)return!1;for(let c=0;c<h.length;c++)if(!Me(h[c],r[c]))return!1;return!0}if("object"==typeof h&&null!==h&&null!==r){if("object"!=typeof r||Object.keys(h).length!==Object.keys(r).length)return!1;for(const c in h)if(!Me(h[c],r[c]))return!1;return!0}return h===r}var ht=Ke;function Ke(h){return r=h,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,x=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(x);try{_=new Worker(C),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(C),p}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var x=_.getImageData(0,0,1,1);return x&&x.width===p.width}()||(void 0===pt[c=r&&r.failIfMajorPerformanceCaveat]&&(pt[c]=function(p){var _,C,A,N,x=(C=p,A=document.createElement("canvas"),(N=Object.create(Ke.webGLContextAttributes)).failIfMajorPerformanceCaveat=C,A.getContext("webgl",N)||A.getContext("experimental-webgl",N));if(!x)return!1;try{_=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!_||x.isContextLost())&&(x.shaderSource(_,"void main() {}"),x.compileShader(_),!0===x.getShaderParameter(_,x.COMPILE_STATUS))}(c)),!pt[c]||document.documentMode));var r,c}var pt={};function yt(h,r,c){const p=l.window.document.createElement(h);return void 0!==r&&(p.className=r),c&&c.appendChild(p),p}function Dt(h,r,c){const p=l.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const _ of Object.keys(r))p.setAttributeNS(null,_,r[_]);return c&&c.appendChild(p),p}Ke.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const st=l.window.document&&l.window.document.documentElement.style,bt=st&&void 0!==st.userSelect?"userSelect":"WebkitUserSelect";let mt;function Qe(){st&&bt&&(mt=st[bt],st[bt]="none")}function _t(){st&&bt&&(st[bt]=mt)}function Wt(h){h.preventDefault(),h.stopPropagation(),l.window.removeEventListener("click",Wt,!0)}function Ct(){l.window.addEventListener("click",Wt,!0),l.window.setTimeout(()=>{l.window.removeEventListener("click",Wt,!0)},0)}function it(h,r){const c=h.getBoundingClientRect();return Ze(h,c,r)}function Kt(h,r){const c=h.getBoundingClientRect(),p=[];for(let _=0;_<r.length;_++)p.push(Ze(h,c,r[_]));return p}function Tt(h){return void 0!==l.window.InstallTrigger&&2===h.button&&h.ctrlKey&&l.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function Ze(h,r,c){const p=h.offsetWidth===r.width?1:h.offsetWidth/r.width;return new l.Point((c.clientX-r.left)*p,(c.clientY-r.top)*p)}function Fe(h,r){var c=r[0],p=r[1],_=r[2],x=r[3],C=c*x-_*p;return C?(h[0]=x*(C=1/C),h[1]=-p*C,h[2]=-_*C,h[3]=c*C,h):null}function $t(h){const{userImage:r}=h;return!!(r&&r.render&&r.render())&&(h.data.replace(new Uint8Array(r.data.buffer)),!0)}class un extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:c,callback:p}of this.requestors)this._notify(c,p);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,c){this._validate(r,c)&&(this.images[r]=c)}_validate(r,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new l.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,c){if(!r)return!0;let p=0;for(const _ of r){if(_[0]<p||_[1]<_[0]||c<_[1])return!1;p=_[1]}return!0}_validateContent(r,c){return!(r&&(4!==r.length||r[0]<0||c.data.width<r[0]||r[1]<0||c.data.height<r[1]||r[2]<0||c.data.width<r[2]||r[3]<0||c.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,c){c.version=this.images[r].version+1,this.images[r]=c,this.updatedImages[r]=!0}removeImage(r){const c=this.images[r];delete this.images[r],delete this.patterns[r],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,c){let p=!0;if(!this.isLoaded())for(const _ of r)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(r,c):this.requestors.push({ids:r,callback:c})}_notify(r,c){const p={};for(const _ of r){this.images[_]||this.fire(new l.Event("styleimagemissing",{id:_}));const x=this.images[_];x?p[_]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!(!x.userImage||!x.userImage.render)}:l.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,p)}getPixelSize(){const{width:r,height:c}=this.atlasImage;return{width:r,height:c}}getPattern(r){const c=this.patterns[r],p=this.getImage(r);if(!p)return null;if(c&&c.position.version===p.version)return c.position;if(c)c.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},x=new l.ImagePosition(_,p);this.patterns[r]={bin:_,position:x}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const c=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.Texture(r,this.atlasImage,c.RGBA),this.atlasTexture&&this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const x in this.patterns)r.push(this.patterns[x].bin);const{w:c,h:p}=l.potpack(r),_=this.atlasImage;_.resize({width:c||1,height:p||1});for(const x in this.patterns){const{bin:C}=this.patterns[x],A=C.x+1,N=C.y+1,G=this.images[x].data,H=G.width,ie=G.height;l.RGBAImage.copy(G,_,{x:0,y:0},{x:A,y:N},{width:H,height:ie}),l.RGBAImage.copy(G,_,{x:0,y:ie-1},{x:A,y:N-1},{width:H,height:1}),l.RGBAImage.copy(G,_,{x:0,y:0},{x:A,y:N+ie},{width:H,height:1}),l.RGBAImage.copy(G,_,{x:H-1,y:0},{x:A-1,y:N},{width:1,height:ie}),l.RGBAImage.copy(G,_,{x:0,y:0},{x:A+H,y:N},{width:1,height:ie})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const c of r){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const p=this.images[c];$t(p)&&this.updateImage(c,p)}}}const De=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(h,r){return function([c,p,_]){const x=l.degToRad(p+90),C=l.degToRad(_);return{x:c*Math.cos(x)*Math.sin(C),y:c*Math.sin(x)*Math.sin(C),z:c*Math.cos(C),azimuthal:p,polar:_}}(h.expression.evaluate(r))}interpolate(h,r,c){return{x:l.number(h.x,r.x,c),y:l.number(h.y,r.y,c),z:l.number(h.z,r.z,c),azimuthal:l.number(h.azimuthal,r.azimuthal,c),polar:l.number(h.polar,r.polar,c)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)});class dt extends l.Evented{constructor(r){super(),this._transitionable=new l.Transitionable(De),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,c={}){if(!this._validate(l.validateLight,r,c))for(const p in r){const _=r[p];l.endsWith(p,"-transition")?this._transitionable.setTransition(p.slice(0,-11),_):this._transitionable.setValue(p,_)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,p){return(!p||!1!==p.validate)&&l.emitValidationErrors(this,r.call(l.validateStyle,l.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}const Lt=new l.Properties({source:new l.DataConstantProperty(l.spec.terrain.source),exaggeration:new l.DataConstantProperty(l.spec.terrain.exaggeration)});let ft=class extends l.Evented{constructor(h,r){super(),this._transitionable=new l.Transitionable(Lt),this.set(h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(h){for(const r in h){const c=h[r];l.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-11),c):this._transitionable.setValue(r,c)}}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}};function pn(h,r,c,p){const _=l.smoothstep(45,65,c),[x,C]=hn(h,p),A=l.length(r);let N=1-Math.min(1,Math.exp((A-x)/(C-x)*-6));return N*=N*N,N=Math.min(1,1.00747*N),N*_*h.alpha}function hn(h,r){const c=.5/Math.tan(.5*r);return[h.range[0]+c,h.range[1]+c]}const Vt=new l.Properties({range:new l.DataConstantProperty(l.spec.fog.range),color:new l.DataConstantProperty(l.spec.fog.color),"high-color":new l.DataConstantProperty(l.spec.fog["high-color"]),"space-color":new l.DataConstantProperty(l.spec.fog["space-color"]),"horizon-blend":new l.DataConstantProperty(l.spec.fog["horizon-blend"]),"star-intensity":new l.DataConstantProperty(l.spec.fog["star-intensity"])});class Jn extends l.Evented{constructor(r,c){super(),this._transitionable=new l.Transitionable(Vt),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){const r=this._transform,c="globe"===r.projection.name,p=l.globeToMercatorTransition(r.zoom),_=this.properties.get("range"),x=[.5,3];return{range:c?[l.number(x[0],_[0],p),l.number(x[1],_[1],p)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,c={}){if(!this._validate(l.validateFog,r,c)){for(const p of Object.keys(l.spec.fog))r&&void 0===r[p]&&(r[p]=l.spec.fog[p].default);for(const p in r){const _=r[p];l.endsWith(p,"-transition")?this._transitionable.setTransition(p.slice(0,-11),_):this._transitionable.setValue(p,_)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:l.smoothstep(45,65,r))*c.a}getOpacityAtLatLng(r,c){return this._transform.projection.supportsFog?function(p,_,x){const C=l.MercatorCoordinate.fromLngLat(_),A=x.elevation?x.elevation.getAtPointOrZero(C):0,N=[C.x,C.y,A];return l.transformMat4(N,N,x.mercatorFogMatrix),pn(p,N,x.pitch,x._fov)}(this.state,r,c):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?hn(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,p){return(!p||!1!==p.validate)&&l.emitValidationErrors(this,r.call(l.validateStyle,l.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class Ht{constructor(r,c){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const x=new Ht.Actor(p[_],c,this.id);x.name=`Worker ${_}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,c,p){l.asyncAll(this.actors,(_,x)=>{_.send(r,c,x)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function li(h,r,c){return r*(l.EXTENT/(h.tileSize*Math.pow(2,c-h.tileID.overscaledZ)))}Ht.Actor=l.Actor;class tn{constructor(r,c,p,_){this.screenBounds=r,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(r,c){let p,_;if(r instanceof l.Point||"number"==typeof r[0]){const x=l.Point.convert(r);p=[x],_=c.isPointAboveHorizon(x)}else{const x=l.Point.convert(r[0]),C=l.Point.convert(r[1]);p=[x,C],_=l.polygonizeBounds(x,C).every(A=>c.isPointAboveHorizon(A))}return new tn(p,c.getCameraPoint(),_,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return l.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const c=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new l.Point(1,1)):this.screenBounds[1],_=l.polygonizeBounds(c,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(_[3]=this.cameraPoint)),l.bufferConvexPolygon(_,r)}bufferedCameraGeometryGlobe(r){const c=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new l.Point(1,1)):this.screenBounds[1],_=l.polygonizeBounds(c,p,r),x=this.cameraPoint.clone();switch(3*((x.y>c.y)+(x.y>p.y))+((x.x>c.x)+(x.x>p.x))){case 0:_[0]=x,_[4]=x.clone();break;case 1:_.splice(1,0,x);break;case 2:_[1]=x;break;case 3:_.splice(4,0,x);break;case 5:_.splice(2,0,x);break;case 6:_[3]=x;break;case 7:_.splice(3,0,x);break;case 8:_[2]=x}return _}containsTile(r,c,p,_=0){const x=r.queryPadding/c._pixelsPerMercatorPixel+1,C=p?this._bufferedCameraMercator(x,c):this._bufferedScreenMercator(x,c);let A=r.tileID.wrap+(C.unwrapped?_:0);const N=C.polygon.map(ke=>l.getTilePoint(r.tileTransform,ke,A));if(!l.polygonIntersectsBox(N,0,0,l.EXTENT,l.EXTENT))return;A=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const G=this.screenGeometryMercator.polygon.map(ke=>l.getTileVec3(r.tileTransform,ke,A)),H=G.map(ke=>new l.Point(ke[0],ke[1])),ie=c.getFreeCameraOptions().position||new l.MercatorCoordinate(0,0,0),pe=l.getTileVec3(r.tileTransform,ie,A),be=G.map(ke=>{const re=l.sub(ke,ke,pe);return l.normalize(re,re),new l.Ray(pe,re)}),Ie=li(r,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:H,tilespaceRays:be,bufferedTilespaceGeometry:N,bufferedTilespaceBounds:(Ce=l.getBounds(N),Ce.min.x=l.clamp(Ce.min.x,0,l.EXTENT),Ce.min.y=l.clamp(Ce.min.y,0,l.EXTENT),Ce.max.x=l.clamp(Ce.max.x,0,l.EXTENT),Ce.max.y=l.clamp(Ce.max.y,0,l.EXTENT),Ce),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:Ie};var Ce}_bufferedScreenMercator(r,c){const p=at(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let _;return _="globe"===c.projection.name?this._projectAndResample(this.bufferedScreenGeometry(r),c):{polygon:this.bufferedScreenGeometry(r).map(x=>c.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(r,c){const p=at(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let _;return _="globe"===c.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),c):{polygon:this.bufferedCameraGeometry(r).map(x=>c.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[p]=_,_}}_projectAndResample(r,c){const p=function(x,C){const A=l.multiply([],C.pixelMatrix,C.globeMatrix),N=[0,-l.GLOBE_RADIUS,0,1],G=[0,l.GLOBE_RADIUS,0,1],H=[0,0,0,1];l.transformMat4$1(N,N,A),l.transformMat4$1(G,G,A),l.transformMat4$1(H,H,A);const ie=new l.Point(N[0]/N[3],N[1]/N[3]),pe=new l.Point(G[0]/G[3],G[1]/G[3]),be=l.polygonContainsPoint(x,ie)&&N[3]<H[3],Ie=l.polygonContainsPoint(x,pe)&&G[3]<H[3];if(!be&&!Ie)return null;const Ce=function(ut,kt,Pt){for(let qt=1;qt<ut.length;qt++){const Fn=Ne(kt.pointCoordinate3D(ut[qt-1]).x),Ut=Ne(kt.pointCoordinate3D(ut[qt]).x);if(Pt<0){if(Fn<Ut)return{idx:qt,t:-Fn/(Ut-1-Fn)}}else if(Ut<Fn)return{idx:qt,t:(1-Fn)/(Ut+1-Fn)}}return null}(x,C,be?-1:1);if(!Ce)return null;const{idx:ke,t:re}=Ce;let we=ke>1?Re(x.slice(0,ke),C):[],ze=ke<x.length?Re(x.slice(ke),C):[];we=we.map(ut=>new l.Point(Ne(ut.x),ut.y)),ze=ze.map(ut=>new l.Point(Ne(ut.x),ut.y));const $e=[...we];0===$e.length&&$e.push(ze[ze.length-1]);const lt=l.number($e[$e.length-1].y,(0===ze.length?we[0]:ze[0]).y,re);let ct;return ct=be?[new l.Point(0,lt),new l.Point(0,0),new l.Point(1,0),new l.Point(1,lt)]:[new l.Point(1,lt),new l.Point(1,1),new l.Point(0,1),new l.Point(0,lt)],$e.push(...ct),0===ze.length?$e.push(we[0]):$e.push(...ze),{polygon:$e.map(ut=>new l.MercatorCoordinate(ut.x,ut.y)),unwrapped:!1}}(r,c);if(p)return p;const _=function(x,C){let A=!1,N=-1/0,G=0;for(let ie=0;ie<x.length-1;ie++)x[ie].x>N&&(N=x[ie].x,G=ie);for(let ie=0;ie<x.length-1;ie++){const pe=(G+ie)%(x.length-1),be=x[pe],Ie=x[pe+1];Math.abs(be.x-Ie.x)>.5&&(be.x<Ie.x?(be.x+=1,0===pe&&(x[x.length-1].x+=1)):(Ie.x+=1,pe+1===x.length-1&&(x[0].x+=1)),A=!0)}const H=l.mercatorXfromLng(C.center.lng);return A&&H<Math.abs(H-1)&&x.forEach(ie=>{ie.x-=1}),{polygon:x,unwrapped:A}}(Re(r,c).map(x=>new l.Point(Ne(x.x),x.y)),c);return{polygon:_.polygon.map(x=>new l.MercatorCoordinate(x.x,x.y)),unwrapped:_.unwrapped}}}function Re(h,r){return l.resample(h,c=>{const p=r.pointCoordinate3D(c);c.x=p.x,c.y=p.y},1/256)}function Ne(h){return h<0?1+h%1:h%1}function at(h){return 100*h|0}function At(h,r,c,p,_){const x=function(C,A){if(C)return _(C);if(A){h.url&&A.tiles&&h.tiles&&delete h.tiles;const N=l.pick(l.extend(A,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(N.vectorLayers=A.vector_layers,N.vectorLayerIds=N.vectorLayers.map(G=>G.id)),N.tiles=r.canonicalizeTileset(N,h.url),_(null,N)}};return h.url?l.getJSON(r.transformRequest(r.normalizeSourceURL(h.url,null,c,p),l.ResourceType.Source),x):l.exported.frame(()=>x(null,h))}class en{constructor(r,c,p){this.bounds=l.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=c||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const c=Math.pow(2,r.z),p=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*c),_=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*c),x=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*c),C=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*c);return r.x>=p&&r.x<x&&r.y>=_&&r.y<C}}class on{constructor(r,c,p){this.context=r;const _=r.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Zn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ri{constructor(r,c,p,_){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=_,this.context=r;const x=r.gl;this.buffer=x.createBuffer(),r.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,c){for(let p=0;p<this.attributes.length;p++){const _=c.attributes[this.attributes[p].name];void 0!==_&&r.enableVertexAttribArray(_)}}setVertexAttribPointers(r,c,p){for(let _=0;_<this.attributes.length;_++){const x=this.attributes[_],C=c.attributes[x.name];void 0!==C&&r.vertexAttribPointer(C,x.components,r[Zn[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Cn{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class nn extends Cn{getDefault(){return l.Color.transparent}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class xt extends Cn{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class St extends Cn{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class xn extends Cn{getDefault(){return[!0,!0,!0,!0]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Hn extends Cn{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class yi extends Cn{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class qn extends Cn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const c=this.current;(r.func!==c.func||r.ref!==c.ref||r.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class ti extends Cn{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Xn extends Cn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=r,this.dirty=!1}}class ar extends Cn{getDefault(){return[0,1]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class yn extends Cn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=r,this.dirty=!1}}class lr extends Cn{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Pr extends Cn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.BLEND):c.disable(c.BLEND),this.current=r,this.dirty=!1}}class pr extends Cn{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class oo extends Cn{getDefault(){return l.Color.transparent}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Si extends Cn{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class $i extends Cn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=r,this.dirty=!1}}class po extends Cn{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class wi extends Cn{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Hr,Er=class extends Cn{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class fi extends Cn{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Sr extends Cn{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class gr extends Cn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class ir extends Cn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class rr extends Cn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class No extends Cn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Ue extends Cn{getDefault(){return null}set(r){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class ae extends Cn{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class de extends Cn{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Le extends Cn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class We extends Cn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class ot extends Cn{constructor(r,c){super(r),this.context=r,this.parent=c}getDefault(){return null}}class Rt extends ot{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class It extends ot{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class rt extends It{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Bt{constructor(r,c,p,_){this.context=r,this.width=c,this.height=p;const x=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Rt(r,x),_&&(this.depthAttachment=new It(r,x))}destroy(){const r=this.context.gl,c=this.colorAttachment.get();if(c&&r.deleteTexture(c),this.depthAttachment){const p=this.depthAttachment.get();p&&r.deleteRenderbuffer(p)}r.deleteFramebuffer(this.framebuffer)}}class bn{constructor(r,c=!1){if(this.gl=r,this.isWebGL2=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),c){const p=r;this.extVertexArrayObject={createVertexArrayOES:p.createVertexArray.bind(r),deleteVertexArrayOES:p.deleteVertexArray.bind(r),bindVertexArrayOES:p.bindVertexArray.bind(r)}}this.clearColor=new nn(this),this.clearDepth=new xt(this),this.clearStencil=new St(this),this.colorMask=new xn(this),this.depthMask=new Hn(this),this.stencilMask=new yi(this),this.stencilFunc=new qn(this),this.stencilOp=new ti(this),this.stencilTest=new Xn(this),this.depthRange=new ar(this),this.depthTest=new yn(this),this.depthFunc=new lr(this),this.blend=new Pr(this),this.blendFunc=new pr(this),this.blendColor=new oo(this),this.blendEquation=new Si(this),this.cullFace=new $i(this),this.cullFaceSide=new po(this),this.frontFace=new wi(this),this.program=new Er(this),this.activeTexture=new fi(this),this.viewport=new Sr(this),this.bindFramebuffer=new gr(this),this.bindRenderbuffer=new ir(this),this.bindTexture=new rr(this),this.bindVertexBuffer=new No(this),this.bindElementBuffer=new Ue(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ae(this),this.pixelStoreUnpack=new de(this),this.pixelStoreUnpackPremultiplyAlpha=new Le(this),this.pixelStoreUnpackFlipY=new We(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),c||(this.extTextureHalfFloat=r.getExtension("OES_texture_half_float")),(c||this.extTextureHalfFloat&&r.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=c||r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,c){return new on(this,r,c)}createVertexBuffer(r,c,p){return new ri(this,r,c,p)}createRenderbuffer(r,c,p){const _=this.gl,x=_.createRenderbuffer();return this.bindRenderbuffer.set(x),_.renderbufferStorage(_.RENDERBUFFER,r,c,p),this.bindRenderbuffer.set(null),x}createFramebuffer(r,c,p){return new Bt(this,r,c,p)}clear({color:r,depth:c,stencil:p}){const _=this.gl;let x=0;r&&(x|=_.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(x|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==p&&(x|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(x)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){Me(r.blendFunction,l.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Pn extends l.Evented{constructor(r,c,p,_){if(super(),this.id=r,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(c,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new l.DedupedRequest}load(r){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=At(this._options,this.map._requestManager,c,p,(_,x)=>{this._tileJSONRequest=null,this._loaded=!0,_?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&2!==p.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new l.ErrorEvent(_))):x&&(l.extend(this,x),x.bounds&&(this.tileBounds=new en(x.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(x.tiles,this.map._requestManager._customAccessToken),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(_)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return l.extend({},this._options)}loadTile(r,c){const p=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(p,l.ResourceType.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,r.actor&&"expired"!==r.state)"loading"===r.state?r.reloadCallback=c:r.request=r.actor.send("reloadTile",_,x.bind(this));else if(r.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",_,x.bind(this),void 0,!0);else{const C=l.loadVectorTile.call({deduped:this._deduped},_,(A,N)=>{A||!N?x.call(this,A):(_.data={cacheControl:N.cacheControl,expires:N.expires,rawData:N.rawData.slice(0)},r.actor&&r.actor.send("loadTile",_,x.bind(this),void 0,!0))},!0);r.request={cancel:C}}function x(C,A){return delete r.request,r.aborted?c(null):C&&404!==C.status?c(C):(A&&A.resourceTiming&&(r.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&r.setExpiryData(A),r.loadVectorData(A,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id})}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ye extends l.Evented{constructor(r,c,p,_){super(),this.id=r,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},c),l.extend(this,l.pick(c,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=At(this._options,this.map._requestManager,null,null,(c,p)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new l.ErrorEvent(c)):p&&(l.extend(this,p),p.bounds&&(this.tileBounds=new en(p.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(p.tiles),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(c)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return l.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,c){const p=l.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=l.getImage(this.map._requestManager.transformRequest(_,l.ResourceType.Tile),(x,C,A,N)=>(delete r.request,r.aborted?(r.state="unloaded",c(null)):x?(r.state="errored",c(x)):C?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:A,expires:N}),r.setTexture(C,this.map.painter),r.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(r,c,p){r.setTexture(c,p)}static unloadTileData(r,c){r.texture&&c.saveTileTexture(r.texture)}abortTile(r,c){r.request&&(r.request.cancel(),delete r.request),c()}unloadTile(r,c){r.texture&&this.map.painter.saveTileTexture(r.texture),c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function je(h,r,c,p,_,x,C,A){const N=[h,c,_,r,p,x,1,1,1],G=[C,A,1],H=l.adjoint([],N),[ie,pe,be]=l.transformMat3(G,G,l.transpose(H,H));return l.multiply$1(N,[ie,0,0,0,pe,0,0,0,be],N)}class wt extends l.Evented{constructor(r,c,p,_){super(),this.id=r,this.dispatcher=p,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=c,this._dirty=!1}load(r,c){this._loaded=c||!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(p,_)=>{if(this._imageRequest=null,this._loaded=!0,p)this.fire(new l.ErrorEvent(p));else if(_){const{HTMLImageElement:x}=l.window;this.image=_ instanceof x?l.exported.getImageData(_):_,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const c=r.map(l.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let _=1/0,x=1/0,C=-1/0,A=-1/0;for(const ie of p)_=Math.min(_,ie.x),x=Math.min(x,ie.y),C=Math.max(C,ie.x),A=Math.max(A,ie.y);const N=Math.max(C-_,A-x),G=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),H=Math.pow(2,G);return new l.CanonicalTileID(G,Math.floor((_+C)/2*H),Math.floor((x+A)/2*H))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const N in this.tiles){const G=this.tiles[N];"loaded"!==G.state&&(G.state="loaded",G.texture=this.texture)}if(this._boundsArray)return;const c=l.tileTransform(this.tileID,this.map.transform.projection),[p,_,x,C]=this.coordinates.map(N=>{const G=c.projection.project(N[0],N[1]);return l.getTilePoint(c,G)._round()});this.perspectiveTransform=function(N,G,H,ie,pe,be,Ie,Ce,ke,re){const we=je(0,0,N,0,0,G,N,G),ze=je(H,ie,pe,be,Ie,Ce,ke,re);return l.multiply$1(ze,l.adjoint(we,we),ze),[ze[6]/ze[8]*N/l.EXTENT,ze[7]/ze[8]*G/l.EXTENT]}(this.width,this.height,p.x,p.y,_.x,_.y,C.x,C.y,x.x,x.y);const A=this._boundsArray=new l.StructArrayLayout4i8;A.emplaceBack(p.x,p.y,0,0),A.emplaceBack(_.x,_.y,l.EXTENT,0),A.emplaceBack(C.x,C.y,0,l.EXTENT),A.emplaceBack(x.x,x.y,l.EXTENT,l.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(A,l.boundsAttributes.members),this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const r=this.map.painter.context,c=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new l.Texture(r,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,c){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},c(null)):(r.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ge={vector:Pn,raster:Ye,"raster-dem":class extends Ye{constructor(h,r,c,p){super(h,r,c,p),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(h,r){const c=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,x){_&&(h.state="errored",r(_)),x&&(h.dem=x,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",r(null))}h.request=l.getImage(this.map._requestManager.transformRequest(c,l.ResourceType.Tile),function(_,x,C,A){if(delete h.request,h.aborted)h.state="unloaded",r(null);else if(_)h.state="errored",r(_);else if(x){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:C,expires:A});const N=l.window.ImageBitmap&&x instanceof l.window.ImageBitmap&&(null==Hr&&(Hr=l.window.OffscreenCanvas&&new l.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof l.window.createImageBitmap),Hr),G=1-(x.width-l.prevPowerOfTwo(x.width))/2;G<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const H=N?x:l.exported.getImageData(x,G),ie={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:H,encoding:this.encoding,padding:G};h.actor&&"expired"!==h.state||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",ie,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const r=h.canonical,c=Math.pow(2,r.z),p=(r.x-1+c)%c,_=0===r.x?h.wrap-1:h.wrap,x=(r.x+1+c)%c,C=r.x+1===c?h.wrap+1:h.wrap,A={};return A[new l.OverscaledTileID(h.overscaledZ,_,r.z,p,r.y).key]={backfilled:!1},A[new l.OverscaledTileID(h.overscaledZ,C,r.z,x,r.y).key]={backfilled:!1},r.y>0&&(A[new l.OverscaledTileID(h.overscaledZ,_,r.z,p,r.y-1).key]={backfilled:!1},A[new l.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},A[new l.OverscaledTileID(h.overscaledZ,C,r.z,x,r.y-1).key]={backfilled:!1}),r.y+1<c&&(A[new l.OverscaledTileID(h.overscaledZ,_,r.z,p,r.y+1).key]={backfilled:!1},A[new l.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},A[new l.OverscaledTileID(h.overscaledZ,C,r.z,x,r.y+1).key]={backfilled:!1}),A}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends l.Evented{constructor(h,r,c,p){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(p),this._data=r.data,this._options=l.extend({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const _=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*_,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*_,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:l.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*_,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},r),this}getClusterChildren(h,r){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},r),this}getClusterLeaves(h,r,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:r,offset:c},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new l.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=l.extend({},this.workerOptions),r=this._data;"string"==typeof r?(h.request=this.map._requestManager.transformRequest(l.exported.resolveURL(r),l.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(c,p)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new l.ErrorEvent(c));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),this.fire(new l.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,r){const c=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(c,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,_)=>(delete h.request,h.unloadVectorData(),h.aborted?r(null):p?r(p):(h.loadVectorData(_,this.map.painter,"reloadTile"===c),r(null))),void 0,"loadTile"===c)}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends wt{constructor(h,r,c,p){super(h,r,c,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const r of h.urls)this.urls.push(this.map._requestManager.transformRequest(r,l.ResourceType.Source).url);l.getVideo(this.urls,(r,c)=>{this._loaded=!0,r?this.fire(new l.ErrorEvent(r)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const r=this.video.seekable;h<r.start(0)||h>r.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const h=this.map.painter.context,r=h.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new l.Texture(h,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:wt,canvas:class extends wt{constructor(h,r,c,p){super(h,r,c,p),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(_=>!Array.isArray(_)||2!==_.length||_.some(x=>"number"!=typeof x))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof l.window.HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof l.window.HTMLCanvasElement?this.options.canvas:l.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends l.Evented{constructor(h,r,c,p){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=r,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new l.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new l.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new en(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),l.extend(this,l.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return l.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:r,y:c,z:p}=h.canonical;return this._implementation.hasTile({x:r,y:c,z:p})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,r){const{x:c,y:p,z:_}=h.tileID.canonical,x=new l.window.AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:c,y:p,z:_},{signal:x.signal})).then(function(C){return delete h.request,h.aborted?(h.state="unloaded",r(null)):void 0===C?(h.state="errored",r(null)):null===C?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",r(null)):(A=C)instanceof l.window.ImageData||A instanceof l.window.HTMLCanvasElement||A instanceof l.window.ImageBitmap||A instanceof l.window.HTMLImageElement?(this.loadTileData(h,C),h.state="loaded",void r(null)):(h.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var A}.bind(this)).catch(C=>{20!==C.code&&(h.state="errored",r(C))}),h.request.cancel=()=>x.abort()}loadTileData(h,r){Ye.loadTileData(h,r,this._map.painter)}unloadTileData(h){Ye.unloadTileData(h,this._map.painter)}unloadTile(h,r){if(this.unloadTileData(h),this._implementation.unloadTile){const{x:c,y:p,z:_}=h.tileID.canonical;this._implementation.unloadTile({x:c,y:p,z:_})}r()}abortTile(h,r){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Ot=function(h,r,c,p){const _=new Ge[r.type](h,r,c,p);if(_.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${_.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],_),_};function cn(h,r){const c=l.identity([]);return l.scale(c,c,[.5*h.width,.5*-h.height,1]),l.translate(c,c,[1,-1,0]),l.multiply(c,c,h.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(c)}function $n(h,r,c,p,_,x,C,A=!1){const N=h.tilesIn(p,C,A);N.sort(bi);const G=[];for(const ie of N)G.push({wrappedTileID:ie.tile.tileID.wrapped().key,queryResults:ie.tile.queryRenderedFeatures(r,c,h._state,ie,_,x,cn(h.transform,ie.tile.tileID),A)});const H=function(ie){const pe={},be={};for(const Ie of ie){const Ce=Ie.queryResults,ke=Ie.wrappedTileID,re=be[ke]=be[ke]||{};for(const we in Ce){const ze=Ce[we],$e=re[we]=re[we]||{},lt=pe[we]=pe[we]||[];for(const ct of ze)$e[ct.featureIndex]||($e[ct.featureIndex]=!0,lt.push(ct))}}return pe}(G);for(const ie in H)H[ie].forEach(pe=>{const be=pe.feature,Ie=be.layer;Ie&&"background"!==Ie.type&&"sky"!==Ie.type&&(be.source=Ie.source,Ie["source-layer"]&&(be.sourceLayer=Ie["source-layer"]),be.state=void 0!==be.id?h.getFeatureState(Ie["source-layer"],be.id):{})});return H}function si(h,r){const c=h.getRenderableIds().map(x=>h.getTileByID(x)),p=[],_={};for(let x=0;x<c.length;x++){const C=c[x],A=C.tileID.canonical.key;_[A]||(_[A]=!0,C.querySourceFeatures(p,r))}return p}function bi(h,r){const c=h.tileID,p=r.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function Ui(){return null!=Ml.workerClass?new Ml.workerClass:new l.window.Worker(Ml.workerUrl)}const ji="mapboxgl_preloaded_worker_pool";class vr{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<vr.workerCount;)this.workers.push(new Ui);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ji]}numActive(){return Object.keys(this.active).length}}let Di;function no(){return Di||(Di=new vr),Di}function Gr(h,r){const c={};for(const p in h)"ref"!==p&&(c[p]=h[p]);return l.refProperties.forEach(p=>{p in r&&(c[p]=r[p])}),c}function Wr(h){h=h.slice();const r=Object.create(null);for(let c=0;c<h.length;c++)r[h[c].id]=h[c];for(let c=0;c<h.length;c++)"ref"in h[c]&&(h[c]=Gr(h[c],r[h[c].ref]));return h}vr.workerCount=2;const qi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Mo(h,r,c){c.push({command:qi.addSource,args:[h,r[h]]})}function Uo(h,r,c){r.push({command:qi.removeSource,args:[h]}),c[h]=!0}function qr(h,r,c,p){Uo(h,c,p),Mo(h,r,c)}function Ao(h,r,c){let p;for(p in h[c])if(h[c].hasOwnProperty(p)&&"data"!==p&&!Me(h[c][p],r[c][p]))return!1;for(p in r[c])if(r[c].hasOwnProperty(p)&&"data"!==p&&!Me(h[c][p],r[c][p]))return!1;return!0}function Br(h,r,c,p,_,x){let C;for(C in r=r||{},h=h||{})h.hasOwnProperty(C)&&(Me(h[C],r[C])||c.push({command:x,args:[p,C,r[C],_]}));for(C in r)r.hasOwnProperty(C)&&!h.hasOwnProperty(C)&&(Me(h[C],r[C])||c.push({command:x,args:[p,C,r[C],_]}))}function Dr(h){return h.id}function Hi(h,r){return h[r.id]=r,h}class Ur{constructor(r,c){this.reset(r,c)}reset(r,c){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=l.clamp(r,0,1);let c=1,p=this._distances[c];const _=r*this.paddedLength+this.padding;for(;p<_&&c<this._distances.length;)p=this._distances[++c];const x=c-1,C=this._distances[x],A=p-C,N=A>0?(_-C)/A:0;return this.points[x].mult(1-N).add(this.points[c].mult(N))}}class xr{constructor(r,c,p){const _=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(c/p);for(let C=0;C<this.xCellCount*this.yCellCount;C++)_.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=c,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,c,p,_,x){this._forEachCell(c,p,_,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(x)}insertCircle(r,c,p,_){this._forEachCell(c-_,p-_,c+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(c),this.circles.push(p),this.circles.push(_)}_insertBoxCell(r,c,p,_,x,C){this.boxCells[x].push(C)}_insertCircleCell(r,c,p,_,x,C){this.circleCells[x].push(C)}_query(r,c,p,_,x,C){if(p<0||r>this.width||_<0||c>this.height)return!x&&[];const A=[];if(r<=0&&c<=0&&this.width<=p&&this.height<=_){if(x)return!0;for(let N=0;N<this.boxKeys.length;N++)A.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(let N=0;N<this.circleKeys.length;N++){const G=this.circles[3*N],H=this.circles[3*N+1],ie=this.circles[3*N+2];A.push({key:this.circleKeys[N],x1:G-ie,y1:H-ie,x2:G+ie,y2:H+ie})}return C?A.filter(C):A}return this._forEachCell(r,c,p,_,this._queryCell,A,{hitTest:x,seenUids:{box:{},circle:{}}},C),x?A.length>0:A}_queryCircle(r,c,p,_,x){const C=r-p,A=r+p,N=c-p,G=c+p;if(A<0||C>this.width||G<0||N>this.height)return!_&&[];const H=[];return this._forEachCell(C,N,A,G,this._queryCellCircle,H,{hitTest:_,circle:{x:r,y:c,radius:p},seenUids:{box:{},circle:{}}},x),_?H.length>0:H}query(r,c,p,_,x){return this._query(r,c,p,_,!1,x)}hitTest(r,c,p,_,x){return this._query(r,c,p,_,!0,x)}hitTestCircle(r,c,p,_){return this._queryCircle(r,c,p,!0,_)}_queryCell(r,c,p,_,x,C,A,N){const G=A.seenUids,H=this.boxCells[x];if(null!==H){const pe=this.bboxes;for(const be of H)if(!G.box[be]){G.box[be]=!0;const Ie=4*be;if(r<=pe[Ie+2]&&c<=pe[Ie+3]&&p>=pe[Ie+0]&&_>=pe[Ie+1]&&(!N||N(this.boxKeys[be]))){if(A.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[be],x1:pe[Ie],y1:pe[Ie+1],x2:pe[Ie+2],y2:pe[Ie+3]})}}}const ie=this.circleCells[x];if(null!==ie){const pe=this.circles;for(const be of ie)if(!G.circle[be]){G.circle[be]=!0;const Ie=3*be;if(this._circleAndRectCollide(pe[Ie],pe[Ie+1],pe[Ie+2],r,c,p,_)&&(!N||N(this.circleKeys[be]))){if(A.hitTest)return C.push(!0),!0;{const Ce=pe[Ie],ke=pe[Ie+1],re=pe[Ie+2];C.push({key:this.circleKeys[be],x1:Ce-re,y1:ke-re,x2:Ce+re,y2:ke+re})}}}}}_queryCellCircle(r,c,p,_,x,C,A,N){const G=A.circle,H=A.seenUids,ie=this.boxCells[x];if(null!==ie){const be=this.bboxes;for(const Ie of ie)if(!H.box[Ie]){H.box[Ie]=!0;const Ce=4*Ie;if(this._circleAndRectCollide(G.x,G.y,G.radius,be[Ce+0],be[Ce+1],be[Ce+2],be[Ce+3])&&(!N||N(this.boxKeys[Ie])))return C.push(!0),!0}}const pe=this.circleCells[x];if(null!==pe){const be=this.circles;for(const Ie of pe)if(!H.circle[Ie]){H.circle[Ie]=!0;const Ce=3*Ie;if(this._circlesCollide(be[Ce],be[Ce+1],be[Ce+2],G.x,G.y,G.radius)&&(!N||N(this.circleKeys[Ie])))return C.push(!0),!0}}}_forEachCell(r,c,p,_,x,C,A,N){const G=this._convertToXCellCoord(r),H=this._convertToYCellCoord(c),ie=this._convertToXCellCoord(p),pe=this._convertToYCellCoord(_);for(let be=G;be<=ie;be++)for(let Ie=H;Ie<=pe;Ie++)if(x.call(this,r,c,p,_,this.xCellCount*Ie+be,C,A,N))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,c,p,_,x,C){const A=_-r,N=x-c,G=p+C;return G*G>A*A+N*N}_circleAndRectCollide(r,c,p,_,x,C,A){const N=(C-_)/2,G=Math.abs(r-(_+N));if(G>N+p)return!1;const H=(A-x)/2,ie=Math.abs(c-(x+H));if(ie>H+p)return!1;if(G<=N||ie<=H)return!0;const pe=G-N,be=ie-H;return pe*pe+be*be<=p*p}}const Ni={unknown:0,flipRequired:1,flipNotRequired:2},Qo=Math.tan(85*Math.PI/180);function Gt(h,r,c,p,_,x,C){const A=l.create();if(c)if("globe"===x.name){const N=l.calculateGlobeLabelMatrix(_,r);l.multiply(A,A,N)}else{const N=Fe([],C);A[0]=N[0],A[1]=N[1],A[4]=N[2],A[5]=N[3],p||l.rotateZ(A,A,_.angle)}else l.multiply(A,_.labelPlaneMatrix,h);return A}function so(h,r,c,p,_,x,C){const A=Gt(h,r,c,p,_,x,C);return"globe"===x.name&&c||(A[2]=A[6]=A[10]=A[14]=0),A}function Rr(h,r,c,p,_,x,C){if(c){if("globe"===x.name){const A=Gt(h,r,c,p,_,x,C);return l.invert(A,A),l.multiply(A,h,A),A}{const A=l.clone(h),N=l.identity([]);return N[0]=C[0],N[1]=C[1],N[4]=C[2],N[5]=C[3],l.multiply(A,A,N),p||l.rotateZ(A,A,-_.angle),A}}return _.glCoordMatrix}function Or(h,r,c,p){const _=[h,r,c,1];c?l.transformMat4$1(_,_,p):Te(_,_,p);const x=_[3];return _[0]/=x,_[1]/=x,_[2]/=x,_}function es(h,r){return Math.min(.5+h/r*.5,1.5)}function Co(h,r){const c=h[0]/h[3],p=h[1]/h[3];return c>=-r[0]&&c<=r[0]&&p>=-r[1]&&p<=r[1]}function os(h,r,c,p,_,x,C,A,N,G){const H=c.transform,ie=p?h.textSizeData:h.iconSizeData,pe=l.evaluateSizeForZoom(ie,c.transform.zoom),be="globe"===H.projection.name,Ie=[256/c.width*2+1,256/c.height*2+1],Ce=p?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;Ce.clear();let ke=null;be&&(ke=p?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const re=h.lineVertexArray,we=p?h.text.placedSymbolArray:h.icon.placedSymbolArray,ze=c.transform.width/c.transform.height;let $e,lt=!1;for(let ct=0;ct<we.length;ct++){const ut=we.get(ct),{numGlyphs:kt,writingMode:Pt}=ut;if(Pt!==l.WritingMode.vertical||lt||$e===l.WritingMode.horizontal||(lt=!0),$e=Pt,(ut.hidden||Pt===l.WritingMode.vertical)&&!lt){ge(kt,Ce);continue}lt=!1;const qt=new l.Point(ut.tileAnchorX,ut.tileAnchorY);let{x:Fn,y:Ut,z:gn}=H.projection.projectTilePoint(qt.x,qt.y,G.canonical);if(N){const[Ki,di,Ri]=N(qt);Fn+=Ki,Ut+=di,gn+=Ri}const Jt=[Fn,Ut,gn,1];if(l.transformMat4$1(Jt,Jt,r),!Co(Jt,Ie)){ge(kt,Ce);continue}const Rn=es(c.transform.cameraToCenterDistance,Jt[3]),jt=l.evaluateSizeForFeature(ie,pe,ut),vn=C?jt/Rn:jt*Rn,kn=Or(Fn,Ut,gn,_);if(kn[3]<=0){ge(kt,Ce);continue}let Mn={};const Vn=C?null:N,Ei=Un(ut,vn,!1,A,r,_,x,h.glyphOffsetArray,re,Ce,ke,kn,qt,Mn,ze,Vn,H.projection,G,C);lt=Ei.useVertical,Vn&&Ei.needsFlipping&&(Mn={}),(Ei.notEnoughRoom||lt||Ei.needsFlipping&&Un(ut,vn,!0,A,r,_,x,h.glyphOffsetArray,re,Ce,ke,kn,qt,Mn,ze,Vn,H.projection,G,C).notEnoughRoom)&&ge(kt,Ce)}p?(h.text.dynamicLayoutVertexBuffer.updateData(Ce),ke&&h.text.globeExtVertexBuffer.updateData(ke)):(h.icon.dynamicLayoutVertexBuffer.updateData(Ce),ke&&h.icon.globeExtVertexBuffer.updateData(ke))}function Yr(h,r,c,p,_,x,C,A,N,G,H,ie,pe,be,Ie,Ce){const{lineStartIndex:ke,glyphStartIndex:re,segment:we}=A,ze=re+A.numGlyphs,$e=ke+A.lineLength,lt=r.getoffsetX(re),ct=r.getoffsetX(ze-1),ut=Oe(h*lt,c,p,_,x,C,we,ke,$e,N,G,H,ie,pe,!0,be,Ie,Ce);if(!ut)return null;const kt=Oe(h*ct,c,p,_,x,C,we,ke,$e,N,G,H,ie,pe,!0,be,Ie,Ce);return kt?{first:ut,last:kt}:null}function Lo(h,r,c,p){return h===l.WritingMode.horizontal&&Math.abs(p)>Math.abs(c)?{useVertical:!0}:h===l.WritingMode.vertical?p>0?{needsFlipping:!0}:null:r!==Ni.unknown&&(0===(_=c)||Math.abs(p/_)>Qo)?r===Ni.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null;var _}function Un(h,r,c,p,_,x,C,A,N,G,H,ie,pe,be,Ie,Ce,ke,re,we){const ze=r/24,$e=h.lineOffsetX*ze,lt=h.lineOffsetY*ze,{lineStartIndex:ct,glyphStartIndex:ut,numGlyphs:kt,segment:Pt,writingMode:qt,flipState:Fn}=h,Ut=ct+h.lineLength,gn=Jt=>{if(H){const[kn,Mn,Vn]=Jt.up,Ei=G.length;l.updateGlobeVertexNormal(H,Ei+0,kn,Mn,Vn),l.updateGlobeVertexNormal(H,Ei+1,kn,Mn,Vn),l.updateGlobeVertexNormal(H,Ei+2,kn,Mn,Vn),l.updateGlobeVertexNormal(H,Ei+3,kn,Mn,Vn)}const[Rn,jt,vn]=Jt.point;l.addDynamicAttributes(G,Rn,jt,vn,Jt.angle)};if(kt>1){const Jt=Yr(ze,A,$e,lt,c,ie,pe,h,N,x,be,Ce,!1,ke,re,we);if(!Jt)return{notEnoughRoom:!0};if(p&&!c){let[Rn,jt,vn]=Jt.first.point,[kn,Mn,Vn]=Jt.last.point;[Rn,jt]=Or(Rn,jt,vn,C),[kn,Mn]=Or(kn,Mn,Vn,C);const Ei=Lo(qt,Fn,(kn-Rn)*Ie,Mn-jt);if(h.flipState=Ei&&Ei.needsFlipping?Ni.flipRequired:Ni.flipNotRequired,Ei)return Ei}gn(Jt.first);for(let Rn=ut+1;Rn<ut+kt-1;Rn++){const jt=Oe(ze*A.getoffsetX(Rn),$e,lt,c,ie,pe,Pt,ct,Ut,N,x,be,Ce,!1,!1,ke,re,we);if(!jt)return G.length-=4*(Rn-ut),{notEnoughRoom:!0};gn(jt)}gn(Jt.last)}else{if(p&&!c){const Rn=Or(pe.x,pe.y,0,_),jt=ct+Pt+1,vn=new l.Point(N.getx(jt),N.gety(jt)),kn=Or(vn.x,vn.y,0,_),Mn=kn[3]>0?kn:se(pe,vn,Rn,1,_,void 0,ke,re.canonical),Vn=Lo(qt,Fn,(Mn[0]-Rn[0])*Ie,Mn[1]-Rn[1]);if(h.flipState=Vn&&Vn.needsFlipping?Ni.flipRequired:Ni.flipNotRequired,Vn)return Vn}const Jt=Oe(ze*A.getoffsetX(ut),$e,lt,c,ie,pe,Pt,ct,Ut,N,x,be,Ce,!1,!1,ke,re,we);if(!Jt)return{notEnoughRoom:!0};gn(Jt)}return{}}function Pi(h,r,c,p,_){const{x,y:C,z:A}=p.projectTilePoint(h.x,h.y,r);if(!_)return Or(x,C,A,c);const[N,G,H]=_(h);return Or(x+N,C+G,A+H,c)}function se(h,r,c,p,_,x,C,A){const N=Pi(h.sub(r)._unit()._add(h),A,_,C,x);return l.sub(N,c,N),l.normalize(N,N),l.scaleAndAdd(N,c,N,p)}function Oe(h,r,c,p,_,x,C,A,N,G,H,ie,pe,be,Ie,Ce,ke,re){const we=p?h-r:h+r;let ze=we>0?1:-1,$e=0;p&&(ze*=-1,$e=Math.PI),ze<0&&($e+=Math.PI);let lt=A+C+(ze>0?0:1)|0,ct=_,ut=_,kt=0,Pt=0;const qt=Math.abs(we),Fn=[],Ut=[];let gn=x,Jt=gn;const Rn=()=>se(Jt,gn,ut,qt-kt+1,H,pe,Ce,ke.canonical);for(;kt+Pt<=qt;){if(lt+=ze,lt<A||lt>=N)return null;if(ut=ct,Jt=gn,Fn.push(ut),be&&Ut.push(Jt),gn=new l.Point(G.getx(lt),G.gety(lt)),ct=ie[lt],!ct){const Ri=Pi(gn,ke.canonical,H,Ce,pe);ct=Ri[3]>0?ie[lt]=Ri:Rn()}kt+=Pt,Pt=l.distance(ut,ct)}Ie&&pe&&(ie[lt]&&(ct=Rn(),Pt=l.distance(ut,ct)),ie[lt]=ct);const jt=(qt-kt)/Pt,vn=gn.sub(Jt)._mult(jt)._add(Jt),kn=l.sub([],ct,ut),Mn=l.scaleAndAdd([],ut,kn,jt);let Vn=[0,0,1],Ei=kn[0],Ki=kn[1];if(re&&(Vn=Ce.upVector(ke.canonical,vn.x,vn.y),0!==Vn[0]||0!==Vn[1]||1!==Vn[2])){const Ri=[Vn[2],0,-Vn[0]],_r=l.cross([],Vn,Ri);l.normalize(Ri,Ri),l.normalize(_r,_r),Ei=l.dot(kn,Ri),Ki=l.dot(kn,_r)}if(c){const Ri=l.cross([],Vn,kn);l.normalize(Ri,Ri),l.scaleAndAdd(Mn,Mn,Ri,c*ze)}const di=$e+Math.atan2(Ki,Ei);return Fn.push(Mn),be&&Ut.push(vn),{point:Mn,angle:di,path:Fn,tilePath:Ut,up:Vn}}function ge(h,r){const c=r.length,p=c+4*h;r.resize(p),r.float32.fill(-1/0,4*c,4*p)}function Te(h,r,c){const p=r[0],_=r[1];return h[0]=c[0]*p+c[4]*_+c[12],h[1]=c[1]*p+c[5]*_+c[13],h[3]=c[3]*p+c[7]*_+c[15],h}const vt=100;class Mt{constructor(r,c,p=new xr(r.width+200,r.height+200,25),_=new xr(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+vt,this.screenBottomBoundary=r.height+vt,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=c}placeCollisionBox(r,c,p,_,x,C,A,N){let G=p.projectedAnchorX,H=p.projectedAnchorY,ie=p.projectedAnchorZ;const pe=p.elevation,be=p.tileID,Ie=r.getProjection();if(pe&&be){const[ct,ut,kt]=Ie.upVector(be.canonical,p.tileAnchorX,p.tileAnchorY),Pt=Ie.upVectorScale(be.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;G+=ct*pe*Pt,H+=ut*pe*Pt,ie+=kt*pe*Pt}const Ce=this.projectAndGetPerspectiveRatio(A,G,H,ie,p.tileID,"globe"===Ie.name||!!pe||this.transform.pitch>0,Ie),ke=C*Ce.perspectiveRatio,re=(p.x1*c+_.x-p.padding)*ke+Ce.point.x,we=(p.y1*c+_.y-p.padding)*ke+Ce.point.y,ze=(p.x2*c+_.x+p.padding)*ke+Ce.point.x,$e=(p.y2*c+_.y+p.padding)*ke+Ce.point.y,lt=Ce.perspectiveRatio<=.55||Ce.occluded;return!this.isInsideGrid(re,we,ze,$e)||!x&&this.grid.hitTest(re,we,ze,$e,N)||lt?{box:[],offscreen:!1,occluded:Ce.occluded}:{box:[re,we,ze,$e],offscreen:this.isOffscreen(re,we,ze,$e),occluded:!1}}placeCollisionCircles(r,c,p,_,x,C,A,N,G,H,ie,pe,be,Ie,Ce){const ke=[],re=this.transform.elevation,we=r.getProjection(),ze=re?re.getAtTileOffsetFunc(Ce,this.transform.center.lat,this.transform.worldSize,we):null,$e=new l.Point(p.tileAnchorX,p.tileAnchorY);let{x:lt,y:ct,z:ut}=we.projectTilePoint($e.x,$e.y,Ce.canonical);if(ze){const[vn,kn,Mn]=ze($e);lt+=vn,ct+=kn,ut+=Mn}const kt="globe"===we.name,Pt=this.projectAndGetPerspectiveRatio(A,lt,ct,ut,Ce,kt||!!re||this.transform.pitch>0,we),{perspectiveRatio:qt}=Pt,Fn=(ie?C/qt:C*qt)/l.ONE_EM,Ut=Or(lt,ct,ut,N),gn=Pt.signedDistanceFromCamera>0?Yr(Fn,x,p.lineOffsetX*Fn,p.lineOffsetY*Fn,!1,Ut,$e,p,_,N,{},re&&!ie?ze:null,ie&&!!re,we,Ce,ie):null;let Jt=!1,Rn=!1,jt=!0;if(gn&&!Pt.occluded){const vn=.5*be*qt+Ie,kn=new l.Point(-100,-100),Mn=new l.Point(this.screenRightBoundary,this.screenBottomBoundary),Vn=new Ur,{first:Ei,last:Ki}=gn,di=Ei.path.length;let Ri=[];for(let mi=di-1;mi>=1;mi--)Ri.push(Ei.path[mi]);for(let mi=1;mi<Ki.path.length;mi++)Ri.push(Ki.path[mi]);const _r=2.5*vn;G&&(Ri=Ri.map(([mi,Jr,uo],ho)=>(ze&&!kt&&(uo=ze(ho<di-1?Ei.tilePath[di-1-ho]:Ki.tilePath[ho-di+2])[2]),Or(mi,Jr,uo,G))),Ri.some(mi=>mi[3]<=0)&&(Ri=[]));let dr=[];if(Ri.length>0){let mi=1/0,Jr=-1/0,uo=1/0,ho=-1/0;for(const Zr of Ri)mi=Math.min(mi,Zr[0]),uo=Math.min(uo,Zr[1]),Jr=Math.max(Jr,Zr[0]),ho=Math.max(ho,Zr[1]);Jr>=kn.x&&mi<=Mn.x&&ho>=kn.y&&uo<=Mn.y&&(dr=[Ri.map(Zr=>new l.Point(Zr[0],Zr[1]))],(mi<kn.x||Jr>Mn.x||uo<kn.y||ho>Mn.y)&&(dr=l.clipLine(dr,kn.x,kn.y,Mn.x,Mn.y)))}for(const mi of dr){Vn.reset(mi,.25*vn);let Jr=0;Jr=Vn.length<=.5*vn?1:Math.ceil(Vn.paddedLength/_r)+1;for(let uo=0;uo<Jr;uo++){const ho=uo/Math.max(Jr-1,1),Zr=Vn.lerp(ho),pa=Zr.x+vt,io=Zr.y+vt;ke.push(pa,io,vn,0);const Ga=pa-vn,el=io-vn,Ro=pa+vn,bo=io+vn;if(jt=jt&&this.isOffscreen(Ga,el,Ro,bo),Rn=Rn||this.isInsideGrid(Ga,el,Ro,bo),!c&&this.grid.hitTestCircle(pa,io,vn,pe)&&(Jt=!0,!H))return{circles:[],offscreen:!1,collisionDetected:Jt,occluded:!1}}}}return{circles:!H&&Jt||!Rn?[]:ke,offscreen:jt,collisionDetected:Jt,occluded:Pt.occluded}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let p=1/0,_=1/0,x=-1/0,C=-1/0;for(const H of r){const ie=new l.Point(H.x+vt,H.y+vt);p=Math.min(p,ie.x),_=Math.min(_,ie.y),x=Math.max(x,ie.x),C=Math.max(C,ie.y),c.push(ie)}const A=this.grid.query(p,_,x,C).concat(this.ignoredGrid.query(p,_,x,C)),N={},G={};for(const H of A){const ie=H.key;if(void 0===N[ie.bucketInstanceId]&&(N[ie.bucketInstanceId]={}),N[ie.bucketInstanceId][ie.featureIndex])continue;const pe=[new l.Point(H.x1,H.y1),new l.Point(H.x2,H.y1),new l.Point(H.x2,H.y2),new l.Point(H.x1,H.y2)];l.polygonIntersectsPolygon(c,pe)&&(N[ie.bucketInstanceId][ie.featureIndex]=!0,void 0===G[ie.bucketInstanceId]&&(G[ie.bucketInstanceId]=[]),G[ie.bucketInstanceId].push(ie.featureIndex))}return G}insertCollisionBox(r,c,p,_,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:x},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,c,p,_,x){const C=c?this.ignoredGrid:this.grid,A={bucketInstanceId:p,featureIndex:_,collisionGroupID:x};for(let N=0;N<r.length;N+=4)C.insertCircle(A,r[N],r[N+1],r[N+2])}projectAndGetPerspectiveRatio(r,c,p,_,x,C,A){const N=[c,p,_,1];let G=!1;_||this.transform.pitch>0?(l.transformMat4$1(N,N,r),this.fogState&&x&&"globe"!==A.name&&(G=function(pe,be,Ie,Ce,ke,re){const we=re.calculateFogTileMatrix(ke),ze=[be,Ie,Ce];return l.transformMat4(ze,ze,we),pn(pe,ze,re.pitch,re._fov)}(this.fogState,c,p,_,x.toUnwrapped(),this.transform)>.9)):Te(N,N,r);const H=N[3];return{point:new l.Point((N[0]/H+1)/2*this.transform.width+vt,(-N[1]/H+1)/2*this.transform.height+vt),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/H*.5,1.5),signedDistanceFromCamera:H,occluded:C&&N[2]>H||G}}isOffscreen(r,c,p,_){return p<vt||r>=this.screenRightBoundary||_<vt||c>this.screenBottomBoundary}isInsideGrid(r,c,p,_){return p>=0&&r<this.gridRightBoundary&&_>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const r=l.identity([]);return l.translate(r,r,[-100,-100,0]),r}}function sn(h,r,c){const p=r.createTileMatrix(h,h.worldSize,c.toUnwrapped());return l.multiply(new Float32Array(16),h.projMatrix,p)}function mn(h,r,c){if(r.projection.name===c.projection.name)return h.projMatrix;const p=c.clone();return p.setProjection(r.projection),sn(p,r.getProjection(),h)}function an(h,r,c){return r.name===c.projection.name?h.projMatrix:sn(c,r,h)}class Tn{constructor(r,c,p,_){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?c:-c))):_&&p?1:0,this.placed=p}isHidden(){return 0===this.opacity&&!this.placed}}class ii{constructor(r,c,p,_,x,C=!1){this.text=new Tn(r?r.text:null,c,p,x),this.icon=new Tn(r?r.icon:null,c,_,x),this.clipped=C}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class vi{constructor(r,c,p,_=!1){this.text=r,this.icon=c,this.skipFade=p,this.clipped=_}}class Fi{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class br{constructor(r,c,p,_,x){this.bucketInstanceId=r,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=x}}class jo{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const c=++this.maxGroupID;this.collisionGroups[r]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[r]}}function mo(h,r,c,p,_){const{horizontalAlign:x,verticalAlign:C}=l.getAnchorAlignment(h),A=-(x-.5)*r,N=-(C-.5)*c,G=l.evaluateVariableOffset(h,p);return new l.Point(A+G[0]*_,N+G[1]*_)}function To(h,r,c,p,_){const x=new l.Point(h,r);return c&&x._rotate(p?_:-_),x}class go{constructor(r,c,p,_,x){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Mt(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new jo(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,c,p,_){const x=p.getBucket(c),C=p.latestFeatureIndex;if(!x||!C||c.id!==x.layerIds[0])return;const A=x.layers[0].layout,N=p.collisionBoxArray,G=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),H=p.tileSize/l.EXTENT,ie=p.tileID.toUnwrapped();this.transform.setProjection(x.projection);const pe=(be=p.tileID,Ie=x.getProjection(),Ce=this.transform,Ie.name===this.projection?Ce.calculateProjMatrix(be.toUnwrapped()):sn(Ce,Ie,be));var be,Ie,Ce;const ke="map"===A.get("text-pitch-alignment"),re="map"===A.get("text-rotation-alignment");c.compileFilter();const we=c.dynamicFilter(),ze=c.dynamicFilterNeedsFeature(),$e=this.transform.calculatePixelsToTileUnitsMatrix(p),lt=so(pe,p.tileID.canonical,ke,re,this.transform,x.getProjection(),$e);let ct=null;if(ke){const Pt=Rr(pe,p.tileID.canonical,ke,re,this.transform,x.getProjection(),$e);ct=l.multiply([],this.transform.labelPlaneMatrix,Pt)}let ut=null;we&&p.latestFeatureIndex&&(ut={unwrappedTileID:ie,dynamicFilter:we,dynamicFilterNeedsFeature:ze,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new br(x.bucketInstanceId,C,x.sourceLayerIndex,x.index,p.tileID);const kt={bucket:x,layout:A,posMatrix:pe,textLabelPlaneMatrix:lt,labelToScreenMatrix:ct,clippingData:ut,scale:G,textPixelRatio:H,holdingForFade:p.holdingForFade(),collisionBoxArray:N,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:l.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(_)for(const Pt of x.sortKeyRanges){const{sortKey:qt,symbolInstanceStart:Fn,symbolInstanceEnd:Ut}=Pt;r.push({sortKey:qt,symbolInstanceStart:Fn,symbolInstanceEnd:Ut,parameters:kt})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:kt})}attemptAnchorPlacement(r,c,p,_,x,C,A,N,G,H,ie,pe,be,Ie,Ce,ke,re,we){const{textOffset0:ze,textOffset1:$e,crossTileID:lt}=pe,ct=[ze,$e],ut=mo(r,p,_,ct,x),kt=this.collisionIndex.placeCollisionBox(Ie,x,c,To(ut.x,ut.y,C,A,this.transform.angle),ie,N,G,H.predicate);if(ke){const Pt=Ie.getSymbolInstanceIconSize(we,this.transform.zoom,pe.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(Ie,Pt,ke,To(ut.x,ut.y,C,A,this.transform.angle),ie,N,G,H.predicate).box.length)return}if(kt.box.length>0){let Pt;return this.prevPlacement&&this.prevPlacement.variableOffsets[lt]&&this.prevPlacement.placements[lt]&&this.prevPlacement.placements[lt].text&&(Pt=this.prevPlacement.variableOffsets[lt].anchor),this.variableOffsets[lt]={textOffset:ct,width:p,height:_,anchor:r,textScale:x,prevAnchor:Pt},this.markUsedJustification(Ie,r,pe,Ce),Ie.allowVerticalPlacement&&(this.markUsedOrientation(Ie,Ce,pe),this.placedOrientations[lt]=Ce),{shift:ut,placedGlyphBoxes:kt}}}placeLayerBucketPart(r,c,p,_){const{bucket:x,layout:C,posMatrix:A,textLabelPlaneMatrix:N,labelToScreenMatrix:G,clippingData:H,textPixelRatio:ie,holdingForFade:pe,collisionBoxArray:be,partiallyEvaluatedTextSize:Ie,partiallyEvaluatedIconSize:Ce,collisionGroup:ke}=r.parameters,re=C.get("text-optional"),we=C.get("icon-optional"),ze=C.get("text-allow-overlap"),$e=C.get("icon-allow-overlap"),lt="map"===C.get("text-rotation-alignment"),ct="map"===C.get("text-pitch-alignment"),ut="none"!==C.get("icon-text-fit"),kt="viewport-y"===C.get("symbol-z-order");this.transform.setProjection(x.projection);let Pt=ze&&($e||!x.hasIconData()||we),qt=$e&&(ze||!x.hasTextData()||re);!x.collisionArrays&&be&&x.deserializeCollisionBoxes(be),p&&_&&x.updateCollisionDebugBuffers(this.transform.zoom,be);const Fn=(Ut,gn,Jt)=>{const{crossTileID:Rn,numVerticalGlyphVertices:jt}=Ut;if(H){const Ro={zoom:this.transform.zoom,pitch:this.transform.pitch};let bo=null;if(H.dynamicFilterNeedsFeature){const $r=this.retainedQueryData[x.bucketInstanceId];bo=H.featureIndex.loadFeature({featureIndex:Ut.featureIndex,bucketIndex:$r.bucketIndex,sourceLayerIndex:$r.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,H.dynamicFilter)(Ro,bo,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new l.Point(Ut.tileAnchorX,Ut.tileAnchorY),this.transform.calculateDistanceTileData(H.unwrappedTileID)))return this.placements[Rn]=new vi(!1,!1,!1,!0),void c.add(Rn)}if(c.has(Rn))return;if(pe)return void(this.placements[Rn]=new vi(!1,!1,!1));let vn=!1,kn=!1,Mn=!0,Vn=!1,Ei=!1,Ki=null,di={box:null,offscreen:null,occluded:null},Ri={box:null,offscreen:null,occluded:null},_r=null,dr=null,mi=null,Jr=0,uo=0,ho=0;Jt.textFeatureIndex?Jr=Jt.textFeatureIndex:Ut.useRuntimeCollisionCircles&&(Jr=Ut.featureIndex),Jt.verticalTextFeatureIndex&&(uo=Jt.verticalTextFeatureIndex);const Zr=Ro=>{Ro.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const bo=this.transform.elevation;(bo||Ro.elevation)&&(Ro.elevation=bo?bo.getAtTileOffset(Ro.tileID,Ro.tileAnchorX,Ro.tileAnchorY):0)},pa=Jt.textBox;if(pa){Zr(pa);const Ro=$r=>{let cs=l.WritingMode.horizontal;if(x.allowVerticalPlacement&&!$r&&this.prevPlacement){const ks=this.prevPlacement.placedOrientations[Rn];ks&&(this.placedOrientations[Rn]=ks,cs=ks,this.markUsedOrientation(x,cs,Ut))}return cs},bo=($r,cs)=>{if(x.allowVerticalPlacement&&jt>0&&Jt.verticalTextBox){for(const ks of x.writingModes)if(ks===l.WritingMode.vertical?(di=cs(),Ri=di):di=$r(),di&&di.box&&di.box.length)break}else di=$r()};if(C.get("text-variable-anchor")){let $r=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Rn]){const ro=this.prevPlacement.variableOffsets[Rn];$r.indexOf(ro.anchor)>0&&($r=$r.filter(Hs=>Hs!==ro.anchor),$r.unshift(ro.anchor))}const cs=(ro,Hs,du)=>{const Al=x.getSymbolInstanceTextSize(Ie,Ut,this.transform.zoom,gn),ul=(ro.x2-ro.x1)*Al+2*ro.padding,Ul=(ro.y2-ro.y1)*Al+2*ro.padding,jl=ut&&!$e?Hs:null;jl&&Zr(jl);let Ec={box:[],offscreen:!1,occluded:!1};const xd=ze?2*$r.length:$r.length;for(let Ou=0;Ou<xd;++Ou){const mh=this.attemptAnchorPlacement($r[Ou%$r.length],ro,ul,Ul,Al,lt,ct,ie,A,ke,Ou>=$r.length,Ut,gn,x,du,jl,Ie,Ce);if(mh&&(Ec=mh.placedGlyphBoxes,Ec&&Ec.box&&Ec.box.length)){vn=!0,Ki=mh.shift;break}}return Ec};bo(()=>cs(pa,Jt.iconBox,l.WritingMode.horizontal),()=>{const ro=Jt.verticalTextBox;return ro&&Zr(ro),x.allowVerticalPlacement&&!(di&&di.box&&di.box.length)&&jt>0&&ro?cs(ro,Jt.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),di&&(vn=di.box,Mn=di.offscreen,Vn=di.occluded);const ks=Ro(!(!di||!di.box));if(!vn&&this.prevPlacement){const ro=this.prevPlacement.variableOffsets[Rn];ro&&(this.variableOffsets[Rn]=ro,this.markUsedJustification(x,ro.anchor,Ut,ks))}}else{const $r=(cs,ks)=>{const ro=x.getSymbolInstanceTextSize(Ie,Ut,this.transform.zoom,gn),Hs=this.collisionIndex.placeCollisionBox(x,ro,cs,new l.Point(0,0),ze,ie,A,ke.predicate);return Hs&&Hs.box&&Hs.box.length&&(this.markUsedOrientation(x,ks,Ut),this.placedOrientations[Rn]=ks),Hs};bo(()=>$r(pa,l.WritingMode.horizontal),()=>{const cs=Jt.verticalTextBox;return x.allowVerticalPlacement&&jt>0&&cs?(Zr(cs),$r(cs,l.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Ro(!!(di&&di.box&&di.box.length))}}if(_r=di,vn=_r&&_r.box&&_r.box.length>0,Mn=_r&&_r.offscreen,Vn=_r&&_r.occluded,Ut.useRuntimeCollisionCircles){const Ro=x.text.placedSymbolArray.get(Ut.centerJustifiedTextSymbolIndex>=0?Ut.centerJustifiedTextSymbolIndex:Ut.verticalPlacedTextSymbolIndex),bo=l.evaluateSizeForFeature(x.textSizeData,Ie,Ro),$r=C.get("text-padding");dr=this.collisionIndex.placeCollisionCircles(x,ze,Ro,x.lineVertexArray,x.glyphOffsetArray,bo,A,N,G,p,ct,ke.predicate,Ut.collisionCircleDiameter*bo/l.ONE_EM,$r,this.retainedQueryData[x.bucketInstanceId].tileID),vn=ze||dr.circles.length>0&&!dr.collisionDetected,Mn=Mn&&dr.offscreen,Vn=dr.occluded}if(Jt.iconFeatureIndex&&(ho=Jt.iconFeatureIndex),Jt.iconBox){const Ro=bo=>{Zr(bo);const $r=ut&&Ki?To(Ki.x,Ki.y,lt,ct,this.transform.angle):new l.Point(0,0),cs=x.getSymbolInstanceIconSize(Ce,this.transform.zoom,Ut.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,cs,bo,$r,$e,ie,A,ke.predicate)};Ri&&Ri.box&&Ri.box.length&&Jt.verticalIconBox?(mi=Ro(Jt.verticalIconBox),kn=mi.box.length>0):(mi=Ro(Jt.iconBox),kn=mi.box.length>0),Mn=Mn&&mi.offscreen,Ei=mi.occluded}const io=re||0===Ut.numHorizontalGlyphVertices&&0===jt,Ga=we||0===Ut.numIconVertices;if(io||Ga?Ga?io||(kn=kn&&vn):vn=kn&&vn:kn=vn=kn&&vn,vn&&_r&&_r.box&&this.collisionIndex.insertCollisionBox(_r.box,C.get("text-ignore-placement"),x.bucketInstanceId,Ri&&Ri.box&&uo?uo:Jr,ke.ID),kn&&mi&&this.collisionIndex.insertCollisionBox(mi.box,C.get("icon-ignore-placement"),x.bucketInstanceId,ho,ke.ID),dr&&(vn&&this.collisionIndex.insertCollisionCircles(dr.circles,C.get("text-ignore-placement"),x.bucketInstanceId,Jr,ke.ID),p)){const Ro=x.bucketInstanceId;let bo=this.collisionCircleArrays[Ro];void 0===bo&&(bo=this.collisionCircleArrays[Ro]=new Fi);for(let $r=0;$r<dr.circles.length;$r+=4)bo.circles.push(dr.circles[$r+0]),bo.circles.push(dr.circles[$r+1]),bo.circles.push(dr.circles[$r+2]),bo.circles.push(dr.collisionDetected?1:0)}const el="globe"!==x.projection.name;Pt=Pt&&(el||!Vn),qt=qt&&(el||!Ei),this.placements[Rn]=new vi(vn||Pt,kn||qt,Mn||x.justReloaded),c.add(Rn)};if(kt){const Ut=x.getSortedSymbolIndexes(this.transform.angle);for(let gn=Ut.length-1;gn>=0;--gn){const Jt=Ut[gn];Fn(x.symbolInstances.get(Jt),Jt,x.collisionArrays[Jt])}}else for(let Ut=r.symbolInstanceStart;Ut<r.symbolInstanceEnd;Ut++)Fn(x.symbolInstances.get(Ut),Ut,x.collisionArrays[Ut]);if(p&&x.bucketInstanceId in this.collisionCircleArrays){const Ut=this.collisionCircleArrays[x.bucketInstanceId];l.invert(Ut.invProjMatrix,A),Ut.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(r,c,p,_){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:N,crossTileID:G}=p,H=l.getAnchorJustification(c),ie=_===l.WritingMode.vertical?N:"left"===H?x:"center"===H?C:"right"===H?A:-1;x>=0&&(r.text.placedSymbolArray.get(x).crossTileID=ie>=0&&x!==ie?0:G),C>=0&&(r.text.placedSymbolArray.get(C).crossTileID=ie>=0&&C!==ie?0:G),A>=0&&(r.text.placedSymbolArray.get(A).crossTileID=ie>=0&&A!==ie?0:G),N>=0&&(r.text.placedSymbolArray.get(N).crossTileID=ie>=0&&N!==ie?0:G)}markUsedOrientation(r,c,p){const _=c===l.WritingMode.horizontal||c===l.WritingMode.horizontalOnly?c:0,x=c===l.WritingMode.vertical?c:0,{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:N,verticalPlacedTextSymbolIndex:G}=p,H=r.text.placedSymbolArray;C>=0&&(H.get(C).placedOrientation=_),A>=0&&(H.get(A).placedOrientation=_),N>=0&&(H.get(N).placedOrientation=_),G>=0&&(H.get(G).placedOrientation=x)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const _=c?c.symbolFadeChange(r):1,x=c?c.opacities:{},C=c?c.variableOffsets:{},A=c?c.placedOrientations:{};for(const N in this.placements){const G=this.placements[N],H=x[N];H?(this.opacities[N]=new ii(H,_,G.text,G.icon,null,G.clipped),p=p||G.text!==H.text.placed||G.icon!==H.icon.placed):(this.opacities[N]=new ii(null,_,G.text,G.icon,G.skipFade,G.clipped),p=p||G.text||G.icon)}for(const N in x){const G=x[N];if(!this.opacities[N]){const H=new ii(G,_,!1,!1);H.isHidden()||(this.opacities[N]=H,p=p||G.text.placed||G.icon.placed)}}for(const N in C)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=C[N]);for(const N in A)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=A[N]);p?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:r)}updateLayerOpacities(r,c){const p=new Set;for(const _ of c){const x=_.getBucket(r);x&&_.latestFeatureIndex&&r.id===x.layerIds[0]&&this.updateBucketOpacities(x,p,_.collisionBoxArray)}}updateBucketOpacities(r,c,p){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const _=r.layers[0].layout,x=!!r.layers[0].dynamicFilter(),C=new ii(null,0,!1,!1,!0),A=_.get("text-allow-overlap"),N=_.get("icon-allow-overlap"),G=_.get("text-variable-anchor"),H="map"===_.get("text-rotation-alignment"),ie="map"===_.get("text-pitch-alignment"),pe="none"!==_.get("icon-text-fit"),be=new ii(null,0,A&&(N||!r.hasIconData()||_.get("icon-optional")),N&&(A||!r.hasTextData()||_.get("text-optional")),!0);!r.collisionArrays&&p&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(p);const Ie=(ke,re,we)=>{for(let ze=0;ze<re/4;ze++)ke.opacityVertexArray.emplaceBack(we)};let Ce=0;for(let ke=0;ke<r.symbolInstances.length;ke++){const re=r.symbolInstances.get(ke),{numHorizontalGlyphVertices:we,numVerticalGlyphVertices:ze,crossTileID:$e,numIconVertices:lt}=re,ct=c.has($e);let ut=this.opacities[$e];ct?ut=C:ut||(ut=be,this.opacities[$e]=ut),c.add($e);const kt=we>0||ze>0,Pt=lt>0,qt=this.placedOrientations[$e],Fn=qt===l.WritingMode.vertical,Ut=qt===l.WritingMode.horizontal||qt===l.WritingMode.horizontalOnly;if(!kt&&!Pt||ut.isHidden()||Ce++,kt){const gn=ds(ut.text);Ie(r.text,we,Fn?ur:gn),Ie(r.text,ze,Ut?ur:gn);const Jt=ut.text.isHidden(),{leftJustifiedTextSymbolIndex:Rn,centerJustifiedTextSymbolIndex:jt,rightJustifiedTextSymbolIndex:vn,verticalPlacedTextSymbolIndex:kn}=re,Mn=r.text.placedSymbolArray,Vn=Jt||Fn?1:0;Rn>=0&&(Mn.get(Rn).hidden=Vn),jt>=0&&(Mn.get(jt).hidden=Vn),vn>=0&&(Mn.get(vn).hidden=Vn),kn>=0&&(Mn.get(kn).hidden=Jt||Ut?1:0);const Ei=this.variableOffsets[$e];Ei&&this.markUsedJustification(r,Ei.anchor,re,qt);const Ki=this.placedOrientations[$e];Ki&&(this.markUsedJustification(r,"left",re,Ki),this.markUsedOrientation(r,Ki,re))}if(Pt){const gn=ds(ut.icon),{placedIconSymbolIndex:Jt,verticalPlacedIconSymbolIndex:Rn}=re,jt=r.icon.placedSymbolArray,vn=ut.icon.isHidden()?1:0;Jt>=0&&(Ie(r.icon,lt,Fn?ur:gn),jt.get(Jt).hidden=vn),Rn>=0&&(Ie(r.icon,re.numVerticalIconVertices,Ut?ur:gn),jt.get(Rn).hidden=vn)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const gn=r.collisionArrays[ke];if(gn){let Jt=new l.Point(0,0),Rn=!0;if(gn.textBox||gn.verticalTextBox){if(G){const vn=this.variableOffsets[$e];vn?(Jt=mo(vn.anchor,vn.width,vn.height,vn.textOffset,vn.textScale),H&&Jt._rotate(ie?this.transform.angle:-this.transform.angle)):Rn=!1}x&&(Rn=!ut.clipped),gn.textBox&&ao(r.textCollisionBox.collisionVertexArray,ut.text.placed,!Rn||Fn,Jt.x,Jt.y),gn.verticalTextBox&&ao(r.textCollisionBox.collisionVertexArray,ut.text.placed,!Rn||Ut,Jt.x,Jt.y)}const jt=Rn&&!(Ut||!gn.verticalIconBox);gn.iconBox&&ao(r.iconCollisionBox.collisionVertexArray,ut.icon.placed,jt,pe?Jt.x:0,pe?Jt.y:0),gn.verticalIconBox&&ao(r.iconCollisionBox.collisionVertexArray,ut.icon.placed,!jt,pe?Jt.x:0,pe?Jt.y:0)}}}if(r.fullyClipped=0===Ce,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const ke=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=ke.invProjMatrix,r.placementViewportMatrix=ke.viewportMatrix,r.collisionCircleArray=ke.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function ao(h,r,c,p,_){h.emplaceBack(r?1:0,c?1:0,p||0,_||0),h.emplaceBack(r?1:0,c?1:0,p||0,_||0),h.emplaceBack(r?1:0,c?1:0,p||0,_||0),h.emplaceBack(r?1:0,c?1:0,p||0,_||0)}const Po=Math.pow(2,25),cr=Math.pow(2,24),Ls=Math.pow(2,17),Ys=Math.pow(2,16),Ii=Math.pow(2,9),Cr=Math.pow(2,8),lo=Math.pow(2,1);function ds(h){if(0===h.opacity&&!h.placed)return 0;if(1===h.opacity&&h.placed)return 4294967295;const r=h.placed?1:0,c=Math.floor(127*h.opacity);return c*Po+r*cr+c*Ls+r*Ys+c*Ii+r*Cr+c*lo+r}const ur=0;class Rs{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,c,p,_,x){const C=this._bucketParts;for(;this._currentTileIndex<r.length;)if(c.getBucketParts(C,_,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((A,N)=>A.sortKey-N.sortKey));this._currentPartIndex<C.length;){const A=C[this._currentPartIndex];if(c.placeLayerBucketPart(A,this._seenCrossTileIDs,p,0===A.symbolInstanceStart),this._currentPartIndex++,x())return!0}return!1}}class na{constructor(r,c,p,_,x,C,A,N){this.placement=new go(r,x,C,A,N),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(r,c,p){const _=l.exported.now(),x=()=>{const C=l.exported.now()-_;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=c[r[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===C.type&&(!C.minzoom||C.minzoom<=A)&&(!C.maxzoom||C.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new Rs(C)),this._inProgressLayer.continuePlacement(p[C.source],this.placement,this._showCollisionBoxes,C,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const hs=512/l.EXTENT/2;class co{constructor(r,c,p){this.tileID=r,this.bucketInstanceId=p,this.index=new l.KDBush(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=r.canonical.x*l.EXTENT,x=r.canonical.y*l.EXTENT;for(let C=0;C<c.length;C++){const{key:A,crossTileID:N,tileAnchorX:G,tileAnchorY:H}=c.get(C),ie=Math.floor((_+G)*hs),pe=Math.floor((x+H)*hs);this.index.add(ie,pe),this.keys.push(A),this.crossTileIDs.push(N)}this.index.finish()}findMatches(r,c,p){const _=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),x=hs/Math.pow(2,c.canonical.z-this.tileID.canonical.z),C=c.canonical.x*l.EXTENT,A=c.canonical.y*l.EXTENT;for(let N=0;N<r.length;N++){const G=r.get(N);if(G.crossTileID)continue;const{key:H,tileAnchorX:ie,tileAnchorY:pe}=G,be=Math.floor((C+ie)*x),Ie=Math.floor((A+pe)*x),Ce=this.index.range(be-_,Ie-_,be+_,Ie+_);for(const ke of Ce){const re=this.crossTileIDs[ke];if(this.keys[ke]===H&&!p.has(re)){p.add(re),G.crossTileID=re;break}}}}}class ia{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ir{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const c=Math.round((r-this.lng)/360);if(0!==c)for(const p in this.indexes){const _=this.indexes[p],x={};for(const C in _){const A=_[C];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+c),x[A.tileID.key]=A}this.indexes[p]=x}this.lng=r}addBucket(r,c,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let x=0;x<c.symbolInstances.length;x++)c.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const _=this.usedCrossTileIDs[r.overscaledZ];for(const x in this.indexes){const C=this.indexes[x];if(Number(x)>r.overscaledZ)for(const A in C){const N=C[A];N.tileID.isChildOf(r)&&N.findMatches(c.symbolInstances,r,_)}else{const A=C[r.scaledTo(Number(x)).key];A&&A.findMatches(c.symbolInstances,r,_)}}for(let x=0;x<c.symbolInstances.length;x++){const C=c.symbolInstances.get(x);C.crossTileID||(C.crossTileID=p.generate(),_.add(C.crossTileID))}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new co(r,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(r,c){for(const p of c.crossTileIDs)this.usedCrossTileIDs[r].delete(p)}removeStaleBuckets(r){let c=!1;for(const p in this.indexes){const _=this.indexes[p];for(const x in _)r[_[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[x]),delete _[x],c=!0)}return c}}class Kn{constructor(){this.layerIndexes={},this.crossTileIDs=new ia,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,c,p,_){let x=this.layerIndexes[r.id];void 0===x&&(x=this.layerIndexes[r.id]=new Ir);let C=!1;const A={};"globe"!==_.name&&x.handleWrapJump(p);for(const N of c){const G=N.getBucket(r);G&&r.id===G.layerIds[0]&&(G.bucketInstanceId||(G.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(N.tileID,G,this.crossTileIDs)&&(C=!0),A[G.bucketInstanceId]=!0)}return x.removeStaleBuckets(A)&&(C=!0),C}pruneUnusedLayers(r){const c={};r.forEach(p=>{c[p]=!0});for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const Ti=(h,r)=>l.emitValidationErrors(h,r&&r.filter(c=>"source.canvas"!==c.identifier)),Tr=l.pick(qi,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ts=l.pick(qi,["setCenter","setZoom","setBearing","setPitch"]),Os={version:8,layers:[],sources:{}},zr={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class zo extends l.Evented{constructor(r,c={}){super(),this.map=r,this.dispatcher=new Ht(no(),this),this.imageManager=new un,this.imageManager.setEventedParent(this),this.glyphManager=new l.GlyphManager(r._requestManager,c.localFontFamily?l.LocalGlyphMode.all:c.localIdeographFontFamily?l.LocalGlyphMode.ideographs:l.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.crossTileSymbolIndex=new Kn,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const p=this;this._rtlTextPluginCallback=zo.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(x,C)=>{if(l.triggerPluginCompletionEvent(x),C&&C.every(A=>A))for(const A in p._sourceCaches){const N=p._sourceCaches[A],G=N.getSource().type;"vector"!==G&&"geojson"!==G||N.reload()}})}),this.on("data",_=>{if("source"!==_.dataType||"metadata"!==_.sourceDataType)return;const x=this.getSource(_.sourceId);if(x&&x.vectorLayerIds)for(const C in this._layers){const A=this._layers[C];A.source===x.id&&this._validateLayer(A)}})}loadURL(r,c={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const p="boolean"==typeof c.validate?c.validate:!l.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,c.accessToken);const _=this.map._requestManager.transformRequest(r,l.ResourceType.Style);this._request=l.getJSON(_,(x,C)=>{this._request=null,x?this.fire(new l.ErrorEvent(x)):C&&this._load(C,p)})}loadJSON(r,c={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(r,!1!==c.validate)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(Os,!1)}_updateLayerCount(r,c){const p=c?1:-1;r.is3D()&&(this._num3DLayers+=p),"circle"===r.type&&(this._numCircleLayers+=p),"symbol"===r.type&&(this._numSymbolLayers+=p)}_load(r,c){if(c&&Ti(this,l.validateStyle(r)))return;this._loaded=!0,this.stylesheet=l.clone$1(r),this._updateMapProjection();for(const _ in r.sources)this.addSource(_,r.sources[_],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const p=Wr(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(const _ of p){const x=l.createStyleLayer(_);x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new dt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(c,p,_){let x,C,A;const N=l.exported.devicePixelRatio>1?"@2x":"";let G=l.getJSON(p.transformRequest(p.normalizeSpriteURL(c,N,".json"),l.ResourceType.SpriteJSON),(pe,be)=>{G=null,A||(A=pe,x=be,ie())}),H=l.getImage(p.transformRequest(p.normalizeSpriteURL(c,N,".png"),l.ResourceType.SpriteImage),(pe,be)=>{H=null,A||(A=pe,C=be,ie())});function ie(){if(A)_(A);else if(x&&C){const pe=l.exported.getImageData(C),be={};for(const Ie in x){const{width:Ce,height:ke,x:re,y:we,sdf:ze,pixelRatio:$e,stretchX:lt,stretchY:ct,content:ut}=x[Ie],kt=new l.RGBAImage({width:Ce,height:ke});l.RGBAImage.copy(pe,kt,{x:re,y:we},{x:0,y:0},{width:Ce,height:ke}),be[Ie]={data:kt,pixelRatio:$e,sdf:ze,stretchX:lt,stretchY:ct,content:ut}}_(null,be)}}return{cancel(){G&&(G.cancel(),G=null),H&&(H.cancel(),H=null)}}}(r,this.map._requestManager,(c,p)=>{if(this._spriteRequest=null,c)this.fire(new l.ErrorEvent(c));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(r){const c=this.getSource(r.source);if(!c)return;const p=r.sourceLayer;p&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(p))&&this.fire(new l.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${c.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const c=[];for(const p of r){const _=this._layers[p];"custom"!==_.type&&c.push(_.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&("function"==typeof r.isLayerDraped?r.isLayerDraped():zr[r.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const c=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(_.length||x.length)&&this._updateWorkerLayers(_,x);for(const C in this._updatedSources){const A=this._updatedSources[C];"reload"===A?this._reloadSource(C):"clear"===A&&this._clearSource(C)}this._updateTilesForChangedImages();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const p={};for(const _ in this._sourceCaches){const x=this._sourceCaches[_];p[_]=x.used,x.used=!1}for(const _ of this._order){const x=this._layers[_];if(x.recalculate(r,this._availableImages),!x.isHidden(r.zoom)){const A=this._getLayerSourceCache(x);A&&(A.used=!0)}const C=this.map.painter;if(C){const A=x.getProgramIds();if(!A)continue;const N=x.getProgramConfiguration(r.zoom);for(const G of A)C.useProgram(G,N)}}for(const _ in p){const x=this._sourceCaches[_];p[_]!==x.used&&x.getSource().fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),Ti(this,l.validateStyle(r)))return!1;(r=l.clone$1(r)).layers=Wr(r.layers);const c=function(_,x){if(!_)return[{command:qi.setStyle,args:[x]}];let C=[];try{if(!Me(_.version,x.version))return[{command:qi.setStyle,args:[x]}];Me(_.center,x.center)||C.push({command:qi.setCenter,args:[x.center]}),Me(_.zoom,x.zoom)||C.push({command:qi.setZoom,args:[x.zoom]}),Me(_.bearing,x.bearing)||C.push({command:qi.setBearing,args:[x.bearing]}),Me(_.pitch,x.pitch)||C.push({command:qi.setPitch,args:[x.pitch]}),Me(_.sprite,x.sprite)||C.push({command:qi.setSprite,args:[x.sprite]}),Me(_.glyphs,x.glyphs)||C.push({command:qi.setGlyphs,args:[x.glyphs]}),Me(_.transition,x.transition)||C.push({command:qi.setTransition,args:[x.transition]}),Me(_.light,x.light)||C.push({command:qi.setLight,args:[x.light]}),Me(_.fog,x.fog)||C.push({command:qi.setFog,args:[x.fog]}),Me(_.projection,x.projection)||C.push({command:qi.setProjection,args:[x.projection]});const A={},N=[];!function(ie,pe,be,Ie){let Ce;for(Ce in pe=pe||{},ie=ie||{})ie.hasOwnProperty(Ce)&&(pe.hasOwnProperty(Ce)||Uo(Ce,be,Ie));for(Ce in pe){if(!pe.hasOwnProperty(Ce))continue;const ke=pe[Ce];ie.hasOwnProperty(Ce)?Me(ie[Ce],ke)||("geojson"===ie[Ce].type&&"geojson"===ke.type&&Ao(ie,pe,Ce)?be.push({command:qi.setGeoJSONSourceData,args:[Ce,ke.data]}):qr(Ce,pe,be,Ie)):Mo(Ce,pe,be)}}(_.sources,x.sources,N,A);const G=[];_.layers&&_.layers.forEach(ie=>{ie.source&&A[ie.source]?C.push({command:qi.removeLayer,args:[ie.id]}):G.push(ie)});let H=_.terrain;H&&A[H.source]&&(C.push({command:qi.setTerrain,args:[void 0]}),H=void 0),C=C.concat(N),Me(H,x.terrain)||C.push({command:qi.setTerrain,args:[x.terrain]}),function(ie,pe,be){pe=pe||[];const Ie=(ie=ie||[]).map(Dr),Ce=pe.map(Dr),ke=ie.reduce(Hi,{}),re=pe.reduce(Hi,{}),we=Ie.slice(),ze=Object.create(null);let $e,lt,ct,ut,kt,Pt,qt;for($e=0,lt=0;$e<Ie.length;$e++)ct=Ie[$e],re.hasOwnProperty(ct)?lt++:(be.push({command:qi.removeLayer,args:[ct]}),we.splice(we.indexOf(ct,lt),1));for($e=0,lt=0;$e<Ce.length;$e++)ct=Ce[Ce.length-1-$e],we[we.length-1-$e]!==ct&&(ke.hasOwnProperty(ct)?(be.push({command:qi.removeLayer,args:[ct]}),we.splice(we.lastIndexOf(ct,we.length-lt),1)):lt++,Pt=we[we.length-$e],be.push({command:qi.addLayer,args:[re[ct],Pt]}),we.splice(we.length-$e,0,ct),ze[ct]=!0);for($e=0;$e<Ce.length;$e++)if(ct=Ce[$e],ut=ke[ct],kt=re[ct],!ze[ct]&&!Me(ut,kt))if(Me(ut.source,kt.source)&&Me(ut["source-layer"],kt["source-layer"])&&Me(ut.type,kt.type)){for(qt in Br(ut.layout,kt.layout,be,ct,null,qi.setLayoutProperty),Br(ut.paint,kt.paint,be,ct,null,qi.setPaintProperty),Me(ut.filter,kt.filter)||be.push({command:qi.setFilter,args:[ct,kt.filter]}),Me(ut.minzoom,kt.minzoom)&&Me(ut.maxzoom,kt.maxzoom)||be.push({command:qi.setLayerZoomRange,args:[ct,kt.minzoom,kt.maxzoom]}),ut)ut.hasOwnProperty(qt)&&"layout"!==qt&&"paint"!==qt&&"filter"!==qt&&"metadata"!==qt&&"minzoom"!==qt&&"maxzoom"!==qt&&(0===qt.indexOf("paint.")?Br(ut[qt],kt[qt],be,ct,qt.slice(6),qi.setPaintProperty):Me(ut[qt],kt[qt])||be.push({command:qi.setLayerProperty,args:[ct,qt,kt[qt]]}));for(qt in kt)kt.hasOwnProperty(qt)&&!ut.hasOwnProperty(qt)&&"layout"!==qt&&"paint"!==qt&&"filter"!==qt&&"metadata"!==qt&&"minzoom"!==qt&&"maxzoom"!==qt&&(0===qt.indexOf("paint.")?Br(ut[qt],kt[qt],be,ct,qt.slice(6),qi.setPaintProperty):Me(ut[qt],kt[qt])||be.push({command:qi.setLayerProperty,args:[ct,qt,kt[qt]]}))}else be.push({command:qi.removeLayer,args:[ct]}),Pt=we[we.lastIndexOf(ct)+1],be.push({command:qi.addLayer,args:[kt,Pt]})}(G,x.layers,C)}catch(A){console.warn("Unable to compute style diff:",A),C=[{command:qi.setStyle,args:[x]}]}return C}(this.serialize(),r).filter(_=>!(_.command in ts));if(0===c.length)return!1;const p=c.filter(_=>!(_.command in Tr));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return c.forEach(_=>{"setTransition"!==_.command&&"setProjection"!==_.command&&this[_.command].apply(this,_.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,c){return this.getImage(r)?this.fire(new l.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,c),this._afterImageUpdated(r),this)}updateImage(r,c){this.imageManager.updateImage(r,c)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new l.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,c,p={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(l.validateSource,`sources.${r}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const _=Ot(r,c,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:_.serialize(),sourceId:r}));const x=C=>{const A=(C?"symbol:":"other:")+r,N=this._sourceCaches[A]=new l.SourceCache(A,_,C);(C?this._symbolSourceCaches:this._otherSourceCaches)[r]=N,N.style=this,N.onAdd(this.map)};x(!1),"vector"!==c.type&&"geojson"!==c.type||x(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const c=this.getSource(r);if(!c)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===r)return this.fire(new l.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new l.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(r);for(const _ of p)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,c){this._checkLoaded(),this.getSource(r).setData(c),this._changed=!0}getSource(r){const c=this._getSourceCache(r);return c&&c.getSource()}_getSources(){const r=[];for(const c in this._otherSourceCaches){const p=this._getSourceCache(c);p&&r.push(p.getSource())}return r}addLayer(r,c,p={}){this._checkLoaded();const _=r.id;if(this.getLayer(_))return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let x;if("custom"===r.type){if(Ti(this,l.validateCustomStyleLayer(r)))return;x=l.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(_,r.source),r=l.clone$1(r),r=l.extend(r,{source:_})),this._validate(l.validateLayer,`layers.${_}`,r,{arrayIndex:-1},p))return;x=l.createStyleLayer(r),this._validateLayer(x),x.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}const C=c?this._order.indexOf(c):this._order.length;if(c&&-1===C)return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(C,0,_),this._layerOrderChanged=!0,this._layers[_]=x;const A=this._getLayerSourceCache(x);if(this._removedLayers[_]&&x.source&&A&&"custom"!==x.type){const N=this._removedLayers[_];delete this._removedLayers[_],N.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",A.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,c){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new l.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===c)return;const p=this._order.indexOf(r);this._order.splice(p,1);const _=c?this._order.indexOf(c):this._order.length;c&&-1===_?this.fire(new l.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(_,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const c=this._layers[r];if(!c)return void this.fire(new l.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const p=this._order.indexOf(r);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=c,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const c in this._layers)if(this._layers[c].type===r)return!0;return!1}setLayerZoomRange(r,c,p){this._checkLoaded();const _=this.getLayer(r);_?_.minzoom===c&&_.maxzoom===p||(null!=c&&(_.minzoom=c),null!=p&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new l.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,c,p={}){this._checkLoaded();const _=this.getLayer(r);if(_){if(!Me(_.filter,c))return null==c?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(l.validateFilter,`layers.${_.id}.filter`,c,{layerType:_.type},p)||(_.filter=l.clone$1(c),this._updateLayer(_)))}else this.fire(new l.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const c=this.getLayer(r);return c&&l.clone$1(c.filter)}setLayoutProperty(r,c,p,_={}){this._checkLoaded();const x=this.getLayer(r);x?Me(x.getLayoutProperty(c),p)||(x.setLayoutProperty(c,p,_),this._updateLayer(x)):this.fire(new l.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,c){const p=this.getLayer(r);if(p)return p.getLayoutProperty(c);this.fire(new l.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,c,p,_={}){this._checkLoaded();const x=this.getLayer(r);x?Me(x.getPaintProperty(c),p)||(x.setPaintProperty(c,p,_)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new l.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,c){const p=this.getLayer(r);return p&&p.getPaintProperty(c)}setFeatureState(r,c){this._checkLoaded();const p=r.source,_=r.sourceLayer,x=this.getSource(p);if(!x)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const C=x.type;if("geojson"===C&&_)return void this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===C&&!_)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(p);for(const N of A)N.setFeatureState(_,r.id,c)}removeFeatureState(r,c){this._checkLoaded();const p=r.source,_=this.getSource(p);if(!_)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const x=_.type,C="vector"===x?r.sourceLayer:void 0;if("vector"===x&&!C)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(p);for(const N of A)N.removeFeatureState(C,r.id,c)}getFeatureState(r){this._checkLoaded();const c=r.source,p=r.sourceLayer,_=this.getSource(c);if(_){if("vector"!==_.type||p)return void 0===r.id&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(p,r.id);this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new l.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const c in this._sourceCaches){const p=this._sourceCaches[c].getSource();r[p.id]||(r[p.id]=p.serialize())}return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(r){this._updatedLayers[r.id]=!0;const c=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[r.source]="reload",c.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const c=C=>"fill-extrusion"===this._layers[C].type,p={},_=[];for(let C=this._order.length-1;C>=0;C--){const A=this._order[C];if(c(A)){p[A]=C;for(const N of r){const G=N[A];if(G)for(const H of G)_.push(H)}}}_.sort((C,A)=>A.intersectionZ-C.intersectionZ);const x=[];for(let C=this._order.length-1;C>=0;C--){const A=this._order[C];if(c(A))for(let N=_.length-1;N>=0;N--){const G=_[N].feature;if(p[G.layer.id]<C)break;x.push(G),_.pop()}else for(const N of r){const G=N[A];if(G)for(const H of G)x.push(H.feature)}}return x}queryRenderedFeatures(r,c,p){c&&c.filter&&this._validate(l.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);const _={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const N of c.layers){const G=this._layers[N];if(!G)return this.fire(new l.ErrorEvent(new Error(`The layer '${N}' does not exist in the map's style and cannot be queried for features.`))),[];_[G.source]=!0}}const x=[];c.availableImages=this._availableImages;const C=c&&c.layers?c.layers.some(N=>{const G=this.getLayer(N);return G&&G.is3D()}):this.has3DLayers(),A=tn.createFromScreenPoints(r,p);for(const N in this._sourceCaches){const G=this._sourceCaches[N].getSource().id;c.layers&&!_[G]||x.push($n(this._sourceCaches[N],this._layers,this._serializedLayers,A,c,p,C,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(N,G,H,ie,pe,be,Ie){const Ce={},ke=be.queryRenderedSymbols(ie),re=[];for(const we of Object.keys(ke).map(Number))re.push(Ie[we]);re.sort(bi);for(const we of re){const ze=we.featureIndex.lookupSymbolFeatures(ke[we.bucketInstanceId],G,we.bucketIndex,we.sourceLayerIndex,pe.filter,pe.layers,pe.availableImages,N);for(const $e in ze){const lt=Ce[$e]=Ce[$e]||[],ct=ze[$e];ct.sort((ut,kt)=>{const Pt=we.featureSortOrder;if(Pt){const qt=Pt.indexOf(ut.featureIndex);return Pt.indexOf(kt.featureIndex)-qt}return kt.featureIndex-ut.featureIndex});for(const ut of ct)lt.push(ut)}}for(const we in Ce)Ce[we].forEach(ze=>{const $e=ze.feature,lt=H(N[we]);if(!lt)return;const ct=lt.getFeatureState($e.layer["source-layer"],$e.id);$e.source=$e.layer.source,$e.layer["source-layer"]&&($e.sourceLayer=$e.layer["source-layer"]),$e.state=ct});return Ce}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(r,c){c&&c.filter&&this._validate(l.validateFilter,"querySourceFeatures.filter",c.filter,null,c);const p=this._getSourceCaches(r);let _=[];for(const x of p)_=_.concat(si(x,c));return _}addSourceType(r,c,p){return zo.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(zo.setSourceType(r,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:c.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(r,c={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const C in r)if(!Me(r[C],p[C])){_=!0;break}if(!_)return;const x=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,c),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,c=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let p=r;if(1===c){if("object"==typeof p.source){const _="terrain-dem-src";this.addSource(_,p.source),p=l.clone$1(p),p=l.extend(p,{source:_})}if(this._validate(l.validateTerrain,"terrain",p))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,c)}else{const _=this.terrain,x=_.get();for(const C of Object.keys(l.spec.terrain))!p.hasOwnProperty(C)&&l.spec.terrain[C].default&&(p[C]=l.spec.terrain[C].default);for(const C in p)if(!Me(p[C],x[C])){_.set(p),this.stylesheet.terrain=p;const A=this._setTransitionParameters({duration:0});_.updateTransitions(A);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const c=this.fog=new Jn(r,this.map.transform);this.stylesheet.fog=r;const p=this._setTransitionParameters({duration:0});c.updateTransitions(p)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,p=c.get();0===Object.keys(r).length&&c.set(r);for(const _ in r)if(!Me(r[_],p[_])){c.set(r),this.stylesheet.fog=r;const x=this._setTransitionParameters({duration:0});c.updateTransitions(x);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:l.exported.now(),transition:l.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(p=>this.isLayerDraped(this._layers[p])),c=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...c)}_createTerrain(r,c){const p=this.terrain=new ft(r,c);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const _=this._setTransitionParameters({duration:0});p.updateTransitions(_)}_force3DLayerUpdate(){for(const r in this._layers){const c=this._layers[r];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const c=this._layers[r];"symbol"===c.type&&this._updateLayer(c)}}_validate(r,c,p,_,x={}){return(!x||!1!==x.validate)&&Ti(this,r.call(l.validateStyle,l.extend({key:c,style:this.serialize(),value:p,styleSpec:l.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const c=this._getSourceCaches(r);for(const p of c)p.clearTiles()}_reloadSource(r){const c=this._getSourceCaches(r);for(const p of c)p.resume(),p.reload()}_reloadSources(){for(const r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(const c in this._sourceCaches)this._sourceCaches[c].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const c=this._sourceCaches[r];c.resume(),c.reload()}}_updatePlacement(r,c,p,_,x=!1){let C=!1,A=!1;const N={};for(const G of this._order){const H=this._layers[G];if("symbol"!==H.type)continue;if(!N[H.source]){const pe=this._getLayerSourceCache(H);if(!pe)continue;N[H.source]=pe.getRenderableIds(!0).map(be=>pe.getTileByID(be)).sort((be,Ie)=>Ie.tileID.overscaledZ-be.tileID.overscaledZ||(be.tileID.isLessThan(Ie.tileID)?-1:1))}const ie=this.crossTileSymbolIndex.addLayer(H,N[H.source],r.center.lng,r.projection);C=C||ie}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||0===p,this._layerOrderChanged&&this.fire(new l.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),r.zoom))&&(this.pauseablePlacement=new na(r,this._order,x,c,p,_,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),A=!0),C&&this.pauseablePlacement.placement.setStale()),A||C)for(const G of this._order){const H=this._layers[G];"symbol"===H.type&&this.placement.updateLayerOpacities(H,N[H.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,c,p){this.imageManager.getImages(c.icons,p),this._updateTilesForChangedImages();const _=x=>{x&&x.setDependencies(c.tileID.key,c.type,c.icons)};_(this._otherSourceCaches[c.source]),_(this._symbolSourceCaches[c.source])}getGlyphs(r,c,p){this.glyphManager.getGlyphs(c.stacks,p)}getResource(r,c,p){return l.makeRequest(c,p)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const c=[];return this._otherSourceCaches[r]&&c.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&c.push(this._symbolSourceCaches[r]),c}_isSourceCacheLoaded(r){const c=this._getSourceCaches(r);return 0===c.length?(this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):c.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}zo.getSourceType=function(h){return Ge[h]},zo.setSourceType=function(h,r){Ge[h]=r},zo.registerForPluginStateChange=l.registerForPluginStateChange;var Xr="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",_o="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",So="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",xi="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Fo="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Fs={},ss={};const kr=[];ps(Xr,kr),ps(So,kr),ps(xi,kr),ps(Fo,kr),Fs=Ji("",So),ss=Ji(Fo,xi);const _a=Ji("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),xs=Xr,fs="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var bs={background:Ji("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Ji("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Ji("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Ji("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ji("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Ji("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ji("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ji("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ji("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Ji("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Ji("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Ji("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Ji("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Ji("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Ji("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Ji("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ji("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Ji("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Ji("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Ji("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Ji("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Ji("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Ji("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Ji("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Ji("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ji("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",_o),skyboxGradient:Ji("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",_o),skyboxCapture:Ji("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ji("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Ji("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function ps(h,r){const c=h.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let p of c)if(p=p.trim(),"#"===p[0]&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=p.split(" ");for(const x of _)r.includes(x)||r.push(x)}}function Ji(h,r){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),_={},x=[...kr];return ps(h,x),ps(r,x),{fragmentSource:h=h.replace(c,(C,A,N,G,H)=>(_[H]=!0,"define"===A?`\n#ifndef HAS_UNIFORM_u_${H}\nvarying ${N} ${G} ${H};\n#else\nuniform ${N} ${G} u_${H};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${H}\n    ${N} ${G} ${H} = u_${H};\n#endif\n`)),vertexSource:r=r.replace(c,(C,A,N,G,H)=>{const ie="float"===G?"vec2":"vec4",pe=H.match(/color/)?"color":ie;return _[H]?"define"===A?`\n#ifndef HAS_UNIFORM_u_${H}\nuniform lowp float u_${H}_t;\nattribute ${N} ${ie} a_${H};\nvarying ${N} ${G} ${H};\n#else\nuniform ${N} ${G} u_${H};\n#endif\n`:"vec4"===pe?`\n#ifndef HAS_UNIFORM_u_${H}\n    ${H} = a_${H};\n#else\n    ${N} ${G} ${H} = u_${H};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${H}\n    ${H} = unpack_mix_${pe}(a_${H}, u_${H}_t);\n#else\n    ${N} ${G} ${H} = u_${H};\n#endif\n`:"define"===A?`\n#ifndef HAS_UNIFORM_u_${H}\nuniform lowp float u_${H}_t;\nattribute ${N} ${ie} a_${H};\n#else\nuniform ${N} ${G} u_${H};\n#endif\n`:"vec4"===pe?`\n#ifndef HAS_UNIFORM_u_${H}\n    ${N} ${G} ${H} = a_${H};\n#else\n    ${N} ${G} ${H} = u_${H};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${H}\n    ${N} ${G} ${H} = unpack_mix_${pe}(a_${H}, u_${H}_t);\n#else\n    ${N} ${G} ${H} = u_${H};\n#endif\n`}),staticAttributes:p,usedDefines:x}}class Bs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,c,p,_,x,C,A){this.context=r;let N=this.boundPaintVertexBuffers.length!==_.length;for(let H=0;!N&&H<_.length;H++)this.boundPaintVertexBuffers[H]!==_[H]&&(N=!0);let G=this.boundDynamicVertexBuffers.length!==A.length;for(let H=0;!G&&H<A.length;H++)this.boundDynamicVertexBuffers[H]!==A[H]&&(G=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==p||N||G||this.boundIndexBuffer!==x||this.boundVertexOffset!==C)this.freshBind(c,p,_,x,C,A);else{r.bindVertexArrayOES.set(this.vao);for(const H of A)H&&H.bind();x&&x.dynamicDraw&&x.bind()}}freshBind(r,c,p,_,x,C){let A;const N=r.numAttributes,G=this.context,H=G.gl;if(G.extVertexArrayObject)this.vao&&this.destroy(),this.vao=G.extVertexArrayObject.createVertexArrayOES(),G.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=r,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=C;else{A=G.currentNumAttributes||0;for(let ie=N;ie<A;ie++)H.disableVertexAttribArray(ie)}c.enableAttributes(H,r),c.bind(),c.setVertexAttribPointers(H,r,x);for(const ie of p)ie.enableAttributes(H,r),ie.bind(),ie.setVertexAttribPointers(H,r,x);for(const ie of C)ie&&(ie.enableAttributes(H,r),ie.bind(),ie.setVertexAttribPointers(H,r,x));_&&_.bind(),G.currentNumAttributes=N}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ra(h,r){const c=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new l.MercatorCoordinate(0,p/c).toLngLat().lat,new l.MercatorCoordinate(0,(p+1)/c).toLngLat().lat]}function oa(h,r,c,p,_,x,C){const A=h.context,N=A.gl,G=c.fbo;if(!G)return;h.prepareDrawTile();const H=h.useProgram("hillshade");A.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,G.colorAttachment.get());const ie=((Ce,ke,re,we)=>{const ze=re.paint.get("hillshade-shadow-color"),$e=re.paint.get("hillshade-highlight-color"),lt=re.paint.get("hillshade-accent-color");let ct=re.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===re.paint.get("hillshade-illumination-anchor")&&(ct-=Ce.transform.angle);const ut=!Ce.options.moving;return{u_matrix:we||Ce.transform.calculateProjMatrix(ke.tileID.toUnwrapped(),ut),u_image:0,u_latrange:ra(0,ke.tileID),u_light:[re.paint.get("hillshade-exaggeration"),ct],u_shadow:ze,u_highlight:$e,u_accent:lt}})(h,c,p,h.terrain?r.projMatrix:null);h.prepareDrawProgram(A,H,r.toUnwrapped());const{tileBoundsBuffer:pe,tileBoundsIndexBuffer:be,tileBoundsSegments:Ie}=h.getTileBoundsBuffers(c);H.draw(A,N.TRIANGLES,_,x,C,l.CullFaceMode.disabled,ie,p.id,pe,be,Ie)}function _i(h,r,c){if(!r.needsDEMTextureUpload)return;const p=h.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||h.getTileTexture(c.stride);const x=c.getPixels();r.demTexture?r.demTexture.update(x,{premultiply:!1}):r.demTexture=new l.Texture(p,x,_.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function sa(h,r,c,p,_,x){const C=h.context,A=C.gl;if(!r.dem)return;const N=r.dem;if(C.activeTexture.set(A.TEXTURE1),_i(h,r,N),!r.demTexture)return;r.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const G=N.dim;C.activeTexture.set(A.TEXTURE0);let H=r.fbo;if(!H){const Ie=new l.Texture(C,{width:G,height:G,data:null},A.RGBA);Ie.bind(A.LINEAR,A.CLAMP_TO_EDGE),H=r.fbo=C.createFramebuffer(G,G,!0),H.colorAttachment.set(Ie.texture)}C.bindFramebuffer.set(H.framebuffer),C.viewport.set([0,0,G,G]);const{tileBoundsBuffer:ie,tileBoundsIndexBuffer:pe,tileBoundsSegments:be}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(C,A.TRIANGLES,p,_,x,l.CullFaceMode.disabled,((Ie,Ce)=>{const ke=Ce.stride,re=l.create();return l.ortho(re,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(re,re,[0,-l.EXTENT,0]),{u_matrix:re,u_image:1,u_dimension:[ke,ke],u_zoom:Ie.overscaledZ,u_unpack:Ce.unpackVector}})(r.tileID,N),c.id,ie,pe,be),r.needsHillshadePrepare=!1}const Ns=h=>({u_matrix:new l.UniformMatrix4f(h),u_image0:new l.Uniform1i(h),u_skirt_height:new l.Uniform1f(h)}),da=(h,r)=>({u_matrix:h,u_image0:0,u_skirt_height:r}),Ho=(h,r,c,p,_,x,C,A,N,G,H,ie,pe,be,Ie)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:c,u_zoom_transition:_,u_merc_center:x,u_image0:0,u_frustum_tl:C,u_frustum_tr:A,u_frustum_br:N,u_frustum_bl:G,u_globe_pos:H,u_globe_radius:ie,u_viewport:pe,u_grid_matrix:Ie?Float32Array.from(Ie):new Float32Array(9),u_skirt_height:be});function aa(h,r){return null!=h&&null!=r&&!(!h.hasData()||!r.hasData())&&null!=h.demTexture&&null!=r.demTexture&&h.tileID.key!==r.tileID.key}const Go=new class{constructor(){this.operations={}}newMorphing(h,r,c,p,_){if(h in this.operations){const x=this.operations[h];x.to.tileID.key!==c.tileID.key&&(x.queued=c)}else this.operations[h]={startTime:p,phase:0,duration:_,from:r,to:c,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const r=this.operations[h];return{from:r.from,to:r.to,phase:r.phase}}update(h){for(const r in this.operations){const c=this.operations[r];for(c.phase=(h-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,h)){delete this.operations[r];break}}}_nextOp(h,r){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=r,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},$o={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function yo(h){return 6*Math.pow(1.5,22-h)}function Ka(h,r){const c=1<<h.z;return!r&&(0===h.x||h.x===c-1)||0===h.y||h.y===c-1}const jr=h=>({u_matrix:h});function Bo(h,r,c,p,_){if(_>0){const x=l.exported.now(),C=(x-h.timeAdded)/_,A=r?(x-r.timeAdded)/_:-1,N=c.getSource(),G=p.coveringZoomLevel({tileSize:N.tileSize,roundZoom:N.roundZoom}),H=!r||Math.abs(r.tileID.overscaledZ-G)>Math.abs(h.tileID.overscaledZ-G),ie=H&&h.refreshedUponExpiration?1:l.clamp(H?C:1-A,0,1);return h.refreshedUponExpiration&&C>=1&&(h.refreshedUponExpiration=!1),r?{opacity:1,mix:1-ie}:{opacity:ie,mix:0}}return{opacity:1,mix:0}}class Ea extends l.SourceCache{constructor(r){const c={type:"raster-dem",maxzoom:r.transform.maxZoom},p=new Ht(no(),null),_=Ot("mock-dem",c,p,r.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,c){r.state="loaded",c(null)}}class zs extends l.SourceCache{constructor(r){const c=Ot("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Ht(no(),null),r.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,c,p){if(r.freezeTileCoverage)return;this.transform=r;const _=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,C)=>{if(x[C.key]="",!this._tiles[C.key]){const A=new l.Tile(C,this._source.tileSize*C.overscaleFactor(),r.tileZoom);A.state="loaded",this._tiles[C.key]=A}return x},{});for(const x in this._tiles)x in _||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(r){const c=this.proxyCachedFBO[r];if(void 0!==c){const p=Object.values(c);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ms extends l.OverscaledTileID{constructor(r,c,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=c,this.projMatrix=p}}class T extends l.Elevation{constructor(r,c){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,_,x]=function(N){const G=new l.StructArrayLayout2i4,H=new l.StructArrayLayout3ui6;G.reserve(17161),H.reserve(33800);const pe=l.EXTENT/128,be=l.EXTENT+pe/2,Ie=be+pe;for(let ke=-pe;ke<Ie;ke+=pe)for(let re=-pe;re<Ie;re+=pe){const we=re<0||re>be||ke<0||ke>be?24575:0,ze=l.clamp(Math.round(re),0,l.EXTENT),$e=l.clamp(Math.round(ke),0,l.EXTENT);G.emplaceBack(ze+we,$e)}const Ce=(ke,re)=>{const we=131*re+ke;H.emplaceBack(we+1,we,we+131),H.emplaceBack(we+131,we+131+1,we+1)};for(let ke=1;ke<129;ke++)for(let re=1;re<129;re++)Ce(re,ke);return[0,129].forEach(ke=>{for(let re=0;re<130;re++)Ce(re,ke),Ce(ke,re)}),[G,H,32768]}(),C=r.context;this.gridBuffer=C.createVertexBuffer(p,l.posAttributes.members),this.gridIndexBuffer=C.createIndexBuffer(_),this.gridSegments=l.SegmentVector.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=l.SegmentVector.simpleSegment(0,0,p.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new zs(c.map),this.orthoMatrix=l.create(),l.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,l.EXTENT,0,l.EXTENT,0,1);const A=C.gl;this._overlapStencilMode=new l.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ea(c.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,c,p){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const _=r.terrain.properties;this.sourceCache=0===r.terrain.drapeRenderMode?this._mockSourceCache:r._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const x=()=>{this.sourceCache.used&&l.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const C=this.getScaledDemTileSize();this.sourceCache.update(c,C,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),c.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==r.efficiency&&l.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=0===p._centerAltitude&&-1===this.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(p.center),-1),this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=c.getIds().map(N=>{const G=c.getTileByID(N).tileID;return G.projMatrix=p.calculateProjMatrix(G.toUnwrapped()),G});(function(N,G){const H=G.transform.pointCoordinate(G.transform.getCameraPoint()),ie=new l.Point(H.x,H.y);N.sort((pe,be)=>{if(be.overscaledZ-pe.overscaledZ)return be.overscaledZ-pe.overscaledZ;const Ie=new l.Point(pe.canonical.x+(1<<pe.canonical.z)*pe.wrap,pe.canonical.y),Ce=new l.Point(be.canonical.x+(1<<be.canonical.z)*be.wrap,be.canonical.y),ke=ie.mult(1<<pe.canonical.z);return ke.x-=.5,ke.y-=.5,ke.distSqr(Ie)-ke.distSqr(Ce)})})(_,this.painter),this._previousZoom=p.zoom;const x=this.proxyToSource||{};this.proxyToSource={},_.forEach(N=>{this.proxyToSource[N.key]={}}),this.terrainTileForTile={};const C=this._style._sourceCaches;for(const N in C){const G=C[N];if(!G.used||(G!==this.sourceCache&&this.resetTileLookupCache(G.id),this._setupProxiedCoordsForOrtho(G,r[N],x),G.usedForTerrain))continue;const H=r[N];G.getSource().reparseOverscaled&&this._assignTerrainTiles(H)}this.proxiedCoords[c.id]=_.map(N=>new ms(N,N.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=l.exported.now();const A={};this._visibleDemTiles=[];for(const N of this.proxyCoords){const G=this.terrainTileForTile[N.key];if(!G)continue;const H=G.tileID.key;H in A||(this._visibleDemTiles.push(G),A[H]=H)}}_assignTerrainTiles(r){this._initializing||r.forEach(c=>{if(this.terrainTileForTile[c.key])return;const p=this._findTileCoveringTileID(c,this.sourceCache);p&&(this.terrainTileForTile[c.key]=p)})}_prepareDEMTextures(){const r=this.painter.context,c=r.gl;for(const p in this.terrainTileForTile){const _=this.terrainTileForTile[p],x=_.dem;!x||_.demTexture&&!_.needsDEMTextureUpload||(r.activeTexture.set(c.TEXTURE1),_i(this.painter,_,x))}}_prepareDemTileUniforms(r,c,p,_){if(!c||null==c.demTexture)return!1;const x=r.tileID.canonical,C=Math.pow(2,c.tileID.canonical.z-x.z),A=_||"";return p[`u_dem_tl${A}`]=[x.x*C%1,x.y*C%1],p[`u_dem_scale${A}`]=C,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,c=r.gl;if(!this._emptyDepthBufferTexture){const p=new l.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new l.Texture(r,p,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const c=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;const x=_.dem.tree.minimums[0];return x>0&&r++,p+x},0);return r?c/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,c=r.gl;r.activeTexture.set(c.TEXTURE2);const p=this._getLoadedAreaMinimum(),_=new l.RGBAImage({width:1,height:1},new Uint8Array(l.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(_,{premultiply:!1}):x=this._emptyDEMTexture=new l.Texture(r,_,c.RGBA,{premultiply:!1}),x}setupElevationDraw(r,c,p){const _=this.painter.context,x=_.gl,C=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:l.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var A;C.u_dem_size=this.sourceCache.getSource().tileSize,C.u_exaggeration=this.exaggeration();let N=null,G=null,H=1;if(p&&p.morphing&&this._useVertexMorphing){const ie=p.morphing.srcDemTile,pe=p.morphing.dstDemTile;H=p.morphing.phase,ie&&pe&&(this._prepareDemTileUniforms(r,ie,C,"_prev")&&(G=ie),this._prepareDemTileUniforms(r,pe,C)&&(N=pe))}if(G&&N?(_.activeTexture.set(x.TEXTURE2),N.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),_.activeTexture.set(x.TEXTURE4),G.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),C.u_dem_lerp=H):(N=this.terrainTileForTile[r.tileID.key],_.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(r,N,C)?N.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE)),_.activeTexture.set(x.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(C.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),C.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&N){const ie=(1<<N.tileID.canonical.z)*l.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;C.u_meter_to_dem=ie}if(p&&p.labelPlaneMatrixInv&&(C.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),c.setTerrainUniformValues(_,C),"globe"===this.painter.transform.projection.name){const ie=this.globeUniformValues(this.painter.transform,r.tileID.canonical,p&&p.useDenormalizedUpVectorScale);c.setGlobeUniformValues(_,ie)}}globeUniformValues(r,c,p){const _=r.projection;return{u_tile_tl_up:_.upVector(c,0,0),u_tile_tr_up:_.upVector(c,l.EXTENT,0),u_tile_br_up:_.upVector(c,l.EXTENT,l.EXTENT),u_tile_bl_up:_.upVector(c,0,l.EXTENT),u_tile_up_scale:p?l.globeMetersToEcef(1):_.upVectorScale(c,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const c=this.painter,p=this.painter.context;0!==r.length&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,x,C,A,N){if("globe"===_.transform.projection.name)!function(G,H,ie,pe,be){const Ie=G.context,Ce=Ie.gl;let ke,re;const we=G.options.showTerrainWireframe?2:0,ze=G.transform,$e=l.globeUseCustomAntiAliasing(G,Ie,ze),lt=(Rn,jt)=>{if(re===Rn)return;const vn=[$o[Rn],"PROJECTION_GLOBE_VIEW"];$e&&vn.push("CUSTOM_ANTIALIASING"),jt&&vn.push($o[we]),ke=G.useProgram("globeRaster",null,vn),re=Rn},ct=G.colorModeForRenderPass(),ut=new l.DepthMode(Ce.LEQUAL,l.DepthMode.ReadWrite,G.depthRangeFor3D);Go.update(be);const kt=l.calculateGlobeMercatorMatrix(ze),Pt=[l.mercatorXfromLng(ze.center.lng),l.mercatorYfromLat(ze.center.lat)],qt=we?[!1,!0]:[!1],Fn=G.globeSharedBuffers,Ut=[ze.width*l.exported.devicePixelRatio,ze.height*l.exported.devicePixelRatio],gn=Float32Array.from(ze.globeMatrix),Jt={useDenormalizedUpVectorScale:!0};if(qt.forEach(Rn=>{const jt=G.transform,vn=yo(jt.zoom)*H.exaggeration();re=-1;const kn=Rn?Ce.LINES:Ce.TRIANGLES;for(const Mn of pe){const Vn=ie.getTile(Mn),Ei=l.StencilMode.disabled,Ki=H.prevTerrainTileForTile[Mn.key],di=H.terrainTileForTile[Mn.key];aa(Ki,di)&&Go.newMorphing(Mn.key,Ki,di,be,250),Ie.activeTexture.set(Ce.TEXTURE0),Vn.texture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE);const Ri=Go.getMorphValuesForProxy(Mn.key),_r=Ri?1:0;Ri&&l.extend$1(Jt,{morphing:{srcDemTile:Ri.from,dstDemTile:Ri.to,phase:l.easeCubicInOut(Ri.phase)}});const dr=l.tileCornersToBounds(Mn.canonical),mi=l.getLatitudinalLod(dr.getCenter().lat),Jr=l.getGridMatrix(Mn.canonical,dr,mi,jt.worldSize/jt._pixelsPerMercatorPixel),uo=l.globeNormalizeECEF(l.globeTileBounds(Mn.canonical)),ho=Ho(jt.projMatrix,gn,kt,uo,l.globeToMercatorTransition(jt.zoom),Pt,jt.frustumCorners.TL,jt.frustumCorners.TR,jt.frustumCorners.BR,jt.frustumCorners.BL,jt.globeCenterInViewSpace,jt.globeRadius,Ut,vn,Jr);if(lt(_r,Rn),H.setupElevationDraw(Vn,ke,Jt),G.prepareDrawProgram(Ie,ke,Mn.toUnwrapped()),Fn){const[Zr,pa,io]=Rn?Fn.getWirefameBuffers(G.context,mi):Fn.getGridBuffers(mi,0!==vn);ke.draw(Ie,kn,ut,Ei,ct,l.CullFaceMode.backCCW,ho,"globe_raster",Zr,pa,io)}}}),Fn){const Rn=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];$e&&Rn.push("CUSTOM_ANTIALIASING"),ke=G.useProgram("globeRaster",null,Rn);for(const jt of pe){const{x:vn,y:kn,z:Mn}=jt.canonical,Vn=0===kn,Ei=kn===(1<<Mn)-1,[Ki,di,Ri,_r]=Fn.getPoleBuffers(Mn);if(_r&&(Vn||Ei)){const dr=ie.getTile(jt);Ie.activeTexture.set(Ce.TEXTURE0),dr.texture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE);let mi=l.globePoleMatrixForTile(Mn,vn,ze);const Jr=l.globeNormalizeECEF(l.globeTileBounds(jt.canonical)),uo=(ho,Zr)=>ho.draw(Ie,Ce.TRIANGLES,ut,l.StencilMode.disabled,ct,l.CullFaceMode.disabled,Ho(ze.projMatrix,mi,mi,Jr,0,Pt,ze.frustumCorners.TL,ze.frustumCorners.TR,ze.frustumCorners.BR,ze.frustumCorners.BL,ze.globeCenterInViewSpace,ze.globeRadius,Ut,0),"globe_pole_raster",Zr,Ri,_r);H.setupElevationDraw(dr,ke,Jt),G.prepareDrawProgram(Ie,ke,jt.toUnwrapped()),Vn&&uo(ke,Ki),Ei&&(mi=l.scale(l.create(),mi,[1,-1,1]),uo(ke,di))}}}}(_,x,C,A,N);else{const G=_.context,H=G.gl;let ie,pe;const be=_.options.showTerrainWireframe?2:0,Ie=(ze,$e)=>{if(pe===ze)return;const lt=[$o[ze]];$e&&lt.push($o[be]),ie=_.useProgram("terrainRaster",null,lt),pe=ze},Ce=_.colorModeForRenderPass(),ke=new l.DepthMode(H.LEQUAL,l.DepthMode.ReadWrite,_.depthRangeFor3D);Go.update(N);const re=_.transform,we=yo(re.zoom)*x.exaggeration();(be?[!1,!0]:[!1]).forEach(ze=>{pe=-1;const $e=ze?H.LINES:H.TRIANGLES,[lt,ct]=ze?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(const ut of A){const kt=C.getTile(ut),Pt=l.StencilMode.disabled,qt=x.prevTerrainTileForTile[ut.key],Fn=x.terrainTileForTile[ut.key];aa(qt,Fn)&&Go.newMorphing(ut.key,qt,Fn,N,250),G.activeTexture.set(H.TEXTURE0),kt.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST);const Ut=Go.getMorphValuesForProxy(ut.key),gn=Ut?1:0;let Jt;Ut&&(Jt={morphing:{srcDemTile:Ut.from,dstDemTile:Ut.to,phase:l.easeCubicInOut(Ut.phase)}});const Rn=da(ut.projMatrix,Ka(ut.canonical,re.renderWorldCopies)?we/10:we);Ie(gn,ze),x.setupElevationDraw(kt,ie,Jt),_.prepareDrawProgram(G,ie,ut.toUnwrapped()),ie.draw(G,$e,ke,Pt,Ce,l.CullFaceMode.backCCW,Rn,"terrain_raster",x.gridBuffer,lt,ct)}})}}(c,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const c=this.painter,p=this.painter.context,_=this.proxySourceCache,x=this.proxiedCoords[_.id],C=this._drapedRenderBatches.shift(),A=[],N=c.style.order;let G=0;for(const H of x){const ie=_.getTileByID(H.proxyTileKey),pe=_.proxyCachedFBO[H.key]?_.proxyCachedFBO[H.key][r]:void 0,be=void 0!==pe?_.renderCache[pe]:this.pool[G++],Ie=void 0!==pe;if(ie.texture=be.tex,Ie&&!be.dirty){A.push(ie.tileID);continue}let Ce;p.bindFramebuffer.set(be.fb.framebuffer),this.renderedToTile=!1,be.dirty&&(p.clear({color:l.Color.transparent,stencil:0}),be.dirty=!1);for(let ke=C.start;ke<=C.end;++ke){const re=c.style._layers[N[ke]];if(re.isHidden(c.transform.zoom))continue;const we=c.style._getLayerSourceCache(re),ze=we?this.proxyToSource[H.key][we.id]:[H];if(!ze)continue;const $e=ze;p.viewport.set([0,0,be.fb.width,be.fb.height]),Ce!==(we?we.id:null)&&(this._setupStencil(be,ze,re,we),Ce=we?we.id:null),c.renderLayer(c,we,re,$e)}this.renderedToTile?(be.dirty=!0,A.push(ie.tileID)):Ie||--G,5===G&&(G=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),C.end+1}postRender(){}renderCacheEfficiency(r){const c=r.order.length;if(0===c)return{efficiency:100};let p,_=0,x=0,C=!1;for(let A=0;A<c;++A){const N=r._layers[r.order[A]];this._style.isLayerDraped(N)?(C&&++_,++x):C||(C=!0,p=N.id)}return 0===x?{efficiency:100}:{efficiency:100*(1-_/x),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{r=Math.min(r,c.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,c,p){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const C=x.tileID,A=1<<C.overscaledZ,{x:N,y:G}=C.canonical,H=N/A,ie=(N+1)/A,pe=G/A,be=(G+1)/A;return{minx:H,miny:pe,maxx:ie,maxy:be,t:x.dem.tree.raycastRoot(H,pe,ie,be,r,c,p),tile:x}});_.sort((x,C)=>(null!==x.t?x.t:Number.MAX_VALUE)-(null!==C.t?C.t:Number.MAX_VALUE));for(const x of _){if(null==x.t)return null;const C=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,r,c,p);if(null!=C)return C}return null}_createFBO(){const r=this.painter.context,c=r.gl,p=this.drapeBufferSize;r.activeTexture.set(c.TEXTURE0);const _=new l.Texture(r,{width:p[0],height:p[1],data:null},c.RGBA);_.bind(c.LINEAR,c.CLAMP_TO_EDGE);const x=r.createFramebuffer(p[0],p[1],!1);return x.colorAttachment.set(_.texture),x.depthAttachment=new rt(r,x.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:x,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const c=this._style._layers[r],p=c.isHidden(this.painter.transform.zoom);return"custom"===c.type?!p&&c.shouldRedrape():!p&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const p of this._style._getSources())if(p instanceof Pn){r=!0;break}if(!r)return;const c={};for(let p=0;p<this._style.order.length;++p){const _=this._style._layers[this._style.order[p]],x=this._style._getLayerSourceCache(_);if(x&&!c[x.id]&&!_.isHidden(this.painter.transform.zoom)&&"line"===_.type&&_.widthExpression()instanceof l.ZoomDependentExpression){c[x.id]=!0;for(const C of this.proxyCoords){const A=this.proxyToSource[C.key][x.id];if(A)for(const N of A)this._clearRenderCacheForTile(x.id,N)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const p in this._style._sourceCaches)if(this._style._sourceCaches[p]._source instanceof Ye){r=!0;break}if(!r)return;const c={};for(let p=0;p<this._style.order.length;++p){const _=this._style._layers[this._style.order[p]],x=this._style._getLayerSourceCache(_);if(!x||c[x.id]||_.isHidden(this.painter.transform.zoom)||"raster"!==_.type)continue;const C=_.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const N=this.proxyToSource[A.key][x.id];if(N)for(const G of N){const H=Bo(x.getTile(G),x.findLoadedParent(G,0),x,this.painter.transform,C);(1!==H.opacity||0!==H.mix)&&this._clearRenderCacheForTile(x.id,G)}}}}_setupDrapedRenderBatches(){const r=this._style.order,c=r.length;if(0===c)return;const p=[];let _,x=0,C=this._style._layers[r[x]];for(;!this._style.isLayerDraped(C)&&C.isHidden(this.painter.transform.zoom)&&++x<c;)C=this._style._layers[r[x]];for(;x<c;++x){const A=this._style._layers[r[x]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===_&&(_=x):void 0!==_&&(p.push({start:_,end:x-1}),_=void 0))}void 0!==_&&p.push({start:_,end:x-1}),this._drapedRenderBatches=p}_setupRenderCache(r){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const C=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let A=0;A<C.length;++A){const N=Object.values(C[A]);c.renderCachePool.push(...N)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,_=this._tilesDirty;for(let C=p.length-1;C>=0;C--){const A=p[C];if(c.getTileByID(A.key),void 0!==c.proxyCachedFBO[A.key]){const N=r[A.key],G=this.proxyToSource[A.key];let H=0;for(const ie in G){const pe=G[ie],be=N[ie];if(!be||be.length!==pe.length||pe.some((Ie,Ce)=>Ie!==be[Ce]||_[ie]&&_[ie].hasOwnProperty(Ie.key))){H=-1;break}++H}for(const ie in c.proxyCachedFBO[A.key])c.renderCache[c.proxyCachedFBO[A.key][ie]].dirty=H<0||H!==Object.values(N).length}}const x=[...this._drapedRenderBatches];x.sort((C,A)=>A.end-A.start-(C.end-C.start));for(const C of x)for(const A of p){if(c.proxyCachedFBO[A.key])continue;let N=c.renderCachePool.pop();void 0===N&&c.renderCache.length<50&&(N=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==N&&(c.proxyCachedFBO[A.key]={},c.proxyCachedFBO[A.key][C.start]=N,c.renderCache[N].dirty=!0)}this._tilesDirty={}}_setupStencil(r,c,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,C=x.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let A;if(p.isTileClipped())A=c.length,this._overlapStencilMode.test={func:C.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:C.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):l.StencilMode.disabled}_renderTileClippingMasks(r,c){const p=this.painter,_=this.painter.context,x=_.gl;p._tileClippingMaskIDs={},_.setColorMode(l.ColorMode.disabled),_.setDepthMode(l.DepthMode.disabled);const C=p.useProgram("clippingMask");for(const A of r){const N=p._tileClippingMaskIDs[A.key]=--c;C.draw(_,x.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:x.ALWAYS,mask:0},N,255,x.KEEP,x.KEEP,x.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,jr(A.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){const c=this.painter.transform;if(r.x<0||r.x>c.width||r.y<0||r.y>c.height)return null;const p=[r.x,r.y,1,1];l.transformMat4$1(p,p,c.pixelMatrixInverse),l.scale$1(p,p,1/p[3]),p[0]/=c.worldSize,p[1]/=c.worldSize;const _=c._camera.position,x=l.mercatorZfromAltitude(1,c.center.lat),C=[_[0],_[1],_[2]/x,0],A=l.subtract([],p.slice(0,3),C);l.normalize(A,A);const N=this.raycast(C,A,this._exaggeration);return null!==N&&N?(l.scaleAndAdd(C,C,A,N),C[3]=C[2],C[2]*=x,C):null}drawDepth(){const r=this.painter,c=r.context,p=this.proxySourceCache,_=Math.ceil(r.width),x=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const C=c.gl,A=c.createFramebuffer(_,x,!0);c.activeTexture.set(C.TEXTURE0);const N=new l.Texture(c,{width:_,height:x,data:null},C.RGBA);N.bind(C.NEAREST,C.CLAMP_TO_EDGE),A.colorAttachment.set(N.texture);const G=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,_,x);A.depthAttachment.set(G),this._depthFBO=A,this._depthTexture=N}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,_,x]),function(C,A,N,G){if("globe"===C.transform.projection.name)return;const H=C.context,ie=H.gl;H.clear({depth:1});const pe=C.useProgram("terrainDepth"),be=new l.DepthMode(ie.LESS,l.DepthMode.ReadWrite,C.depthRangeFor3D);for(const Ie of G){const Ce=N.getTile(Ie),ke=da(Ie.projMatrix,0);A.setupElevationDraw(Ce,pe),pe.draw(H,ie.TRIANGLES,be,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.backCCW,ke,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(r,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,c,p){if(r.getSource()instanceof wt)return this._setupProxiedCoordsForImageSource(r,c,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const _=this.proxiedCoords[r.id]=[],x=this.proxyCoords;for(let A=0;A<x.length;A++){const N=x[A],G=this._findTileCoveringTileID(N,r);if(G){const H=this._createProxiedId(N,G,p[N.key]&&p[N.key][r.id]);_.push(H),this.proxyToSource[N.key][r.id]=[H]}}let C=!1;for(let A=0;A<c.length;A++){const N=r.getTile(c[A]);if(!N||!N.hasData())continue;const G=this._findTileCoveringTileID(N.tileID,this.proxySourceCache);if(G&&G.tileID.canonical.z!==N.tileID.canonical.z){const H=this.proxyToSource[G.tileID.key][r.id],ie=this._createProxiedId(G.tileID,N,p[G.tileID.key]&&p[G.tileID.key][r.id]);H?H.splice(H.length-1,0,ie):this.proxyToSource[G.tileID.key][r.id]=[ie],_.push(ie),C=!0}}this._sourceTilesOverlap[r.id]=C}_setupProxiedCoordsForImageSource(r,c,p){if(!r.getSource().loaded())return;const _=this.proxiedCoords[r.id]=[],x=this.proxyCoords,C=r.getSource(),A=new l.Point(C.tileID.x,C.tileID.y)._div(1<<C.tileID.z),N=C.coordinates.map(l.MercatorCoordinate.fromLngLat).reduce((H,ie)=>(H.min.x=Math.min(H.min.x,ie.x-A.x),H.min.y=Math.min(H.min.y,ie.y-A.y),H.max.x=Math.max(H.max.x,ie.x-A.x),H.max.y=Math.max(H.max.y,ie.y-A.y),H),{min:new l.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new l.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),G=(H,ie)=>{const pe=H.wrap+H.canonical.x/(1<<H.canonical.z),be=H.canonical.y/(1<<H.canonical.z),Ie=l.EXTENT/(1<<H.canonical.z),Ce=ie.wrap+ie.canonical.x/(1<<ie.canonical.z),ke=ie.canonical.y/(1<<ie.canonical.z);return pe+Ie<Ce+N.min.x||pe>Ce+N.max.x||be+Ie<ke+N.min.y||be>ke+N.max.y};for(let H=0;H<x.length;H++){const ie=x[H];for(let pe=0;pe<c.length;pe++){const be=r.getTile(c[pe]);if(!be||!be.hasData()||G(ie,be.tileID))continue;const Ie=this._createProxiedId(ie,be,p[ie.key]&&p[ie.key][r.id]),Ce=this.proxyToSource[ie.key][r.id];Ce?Ce.push(Ie):this.proxyToSource[ie.key][r.id]=[Ie],_.push(Ie)}}}_createProxiedId(r,c,p){let _=this.orthoMatrix;if(p){const x=p.find(C=>C.key===c.tileID.key);if(x)return x}if(c.tileID.key!==r.key){const x=r.canonical.z-c.tileID.canonical.z;let C,A,N;_=l.create();const G=c.tileID.wrap-r.wrap<<r.overscaledZ;x>0?(C=l.EXTENT>>x,A=C*((c.tileID.canonical.x<<x)-r.canonical.x+G),N=C*((c.tileID.canonical.y<<x)-r.canonical.y)):(C=l.EXTENT<<-x,A=l.EXTENT*(c.tileID.canonical.x-(r.canonical.x+G<<-x)),N=l.EXTENT*(c.tileID.canonical.y-(r.canonical.y<<-x))),l.ortho(_,0,C,0,C,0,1),l.translate(_,_,[A,N,0])}return new ms(c.tileID,r.key,_)}_findTileCoveringTileID(r,c){let p=c.getTile(r);if(p&&p.hasData())return p;const _=this._findCoveringTileCache[c.id],x=_[r.key];if(p=x?c.getTileByID(x):null,p&&p.hasData()||null===x)return p;let C=p?p.tileID:r,A=C.overscaledZ;const N=c.getSource().minzoom,G=[];if(!x){const ie=c.getSource().maxzoom;if(r.canonical.z>=ie){const pe=r.canonical.z-ie;c.getSource().reparseOverscaled?(A=Math.max(r.canonical.z+2,c.transform.tileZoom),C=new l.OverscaledTileID(A,r.wrap,ie,r.canonical.x>>pe,r.canonical.y>>pe)):0!==pe&&(A=ie,C=new l.OverscaledTileID(A,r.wrap,ie,r.canonical.x>>pe,r.canonical.y>>pe))}C.key!==r.key&&(G.push(C.key),p=c.getTile(C))}const H=ie=>{G.forEach(pe=>{_[pe]=ie}),G.length=0};for(A-=1;A>=N&&(!p||!p.hasData());A--){p&&H(p.tileID.key);const ie=C.calculateScaledKey(A);if(p=c.getTileByID(ie),p&&p.hasData())break;const pe=_[ie];if(null===pe)break;void 0===pe?G.push(ie):p=c.getTileByID(pe)}return H(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,c){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(c){let p=0;const _=new l.StructArrayLayout2ui4,x=131;for(let C=1;C<129;C++){for(let A=1;A<129;A++)p=C*x+A,_.emplaceBack(p,p+1),_.emplaceBack(p,p+x),_.emplaceBack(p+1,p+x),128===C&&_.emplaceBack(p+x,p+x+1);_.emplaceBack(p+1,p+1+x)}return _}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=l.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class K{static cacheKey(r,c,p,_){let x=`${c}${_?_.cacheKey:""}`;for(const C of p)r.usedDefines.includes(C)&&(x+=`/${C}`);return x}constructor(r,c,p,_,x,C){const A=r.gl;this.program=A.createProgram();const N=function(re){const we=[];for(let ze=0;ze<re.length;ze++){if(null===re[ze])continue;const $e=re[ze].split(" ");we.push($e.pop())}return we}(p.staticAttributes),G=_?_.getBinderAttributes():[],H=N.concat(G);let ie=_?_.defines():[];ie=ie.concat(C.map(re=>`#define ${re}`));const pe=r.isWebGL2?"#version 300 es\n":"",be=pe+ie.concat(r.extStandardDerivatives&&0===pe.length?"#extension GL_OES_standard_derivatives : enable\n".concat(fs):fs,fs,xs,_a.fragmentSource,ss.fragmentSource,p.fragmentSource).join("\n"),Ie=pe+ie.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",xs,_a.vertexSource,ss.vertexSource,Fs.vertexSource,p.vertexSource).join("\n"),Ce=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(Ce,be),A.compileShader(Ce),A.attachShader(this.program,Ce);const ke=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(ke,Ie),A.compileShader(ke),A.attachShader(this.program,ke),this.attributes={},this.numAttributes=H.length;for(let re=0;re<this.numAttributes;re++)H[re]&&(A.bindAttribLocation(this.program,re,H[re]),this.attributes[H[re]]=re);A.linkProgram(this.program),A.deleteShader(ke),A.deleteShader(Ce),this.fixedUniforms=x(r),this.binderUniforms=_?_.getUniforms(r):[],C.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new l.Uniform1i(re=r),u_dem_prev:new l.Uniform1i(re),u_dem_unpack:new l.Uniform4f(re),u_dem_tl:new l.Uniform2f(re),u_dem_scale:new l.Uniform1f(re),u_dem_tl_prev:new l.Uniform2f(re),u_dem_scale_prev:new l.Uniform1f(re),u_dem_size:new l.Uniform1f(re),u_dem_lerp:new l.Uniform1f(re),u_exaggeration:new l.Uniform1f(re),u_depth:new l.Uniform1i(re),u_depth_size_inv:new l.Uniform2f(re),u_meter_to_dem:new l.Uniform1f(re),u_label_plane_matrix_inv:new l.UniformMatrix4f(re)}),C.includes("GLOBE")&&(this.globeUniforms=(re=>({u_tile_tl_up:new l.Uniform3f(re),u_tile_tr_up:new l.Uniform3f(re),u_tile_br_up:new l.Uniform3f(re),u_tile_bl_up:new l.Uniform3f(re),u_tile_up_scale:new l.Uniform1f(re)}))(r)),C.includes("FOG")&&(this.fogUniforms=(re=>({u_fog_matrix:new l.UniformMatrix4f(re),u_fog_range:new l.Uniform2f(re),u_fog_color:new l.Uniform4f(re),u_fog_horizon_blend:new l.Uniform1f(re),u_fog_temporal_offset:new l.Uniform1f(re),u_frustum_tl:new l.Uniform3f(re),u_frustum_tr:new l.Uniform3f(re),u_frustum_br:new l.Uniform3f(re),u_frustum_bl:new l.Uniform3f(re),u_globe_pos:new l.Uniform3f(re),u_globe_radius:new l.Uniform1f(re),u_globe_transition:new l.Uniform1f(re),u_is_globe:new l.Uniform1i(re),u_viewport:new l.Uniform2f(re)}))(r))}var re}setTerrainUniformValues(r,c){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in c)p[_]&&p[_].set(this.program,_,c[_])}}setGlobeUniformValues(r,c){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in c)p[_]&&p[_].set(this.program,_,c[_])}}setFogUniformValues(r,c){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in c)p[_].set(this.program,_,c[_])}}draw(r,c,p,_,x,C,A,N,G,H,ie,pe,be,Ie,Ce){const ke=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(p),r.setStencilMode(_),r.setColorMode(x),r.setCullFace(C);for(const we of Object.keys(this.fixedUniforms))this.fixedUniforms[we].set(this.program,we,A[we]);Ie&&Ie.setUniforms(this.program,r,this.binderUniforms,pe,{zoom:be});const re={[ke.LINES]:2,[ke.TRIANGLES]:3,[ke.LINE_STRIP]:1}[c];for(const we of ie.get()){const ze=we.vaos||(we.vaos={});(ze[N]||(ze[N]=new Bs)).bind(r,this,G,Ie?Ie.getPaintVertexBuffers():[],H,we.vertexOffset,Ce||[]),ke.drawElements(c,we.primitiveLength*re,ke.UNSIGNED_SHORT,we.primitiveOffset*re*2)}}}function S(h,r){const c=Math.pow(2,r.tileID.overscaledZ),p=r.tileSize*Math.pow(2,h.transform.tileZoom)/c,_=p*(r.tileID.canonical.x+r.tileID.wrap*c),x=p*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_tile_units_to_pixels:1/li(r,1,h.transform.tileZoom),u_pixel_coord_upper:[_>>16,x>>16],u_pixel_coord_lower:[65535&_,65535&x]}}const Q=l.create(),Ee=(h,r,c,p,_,x,C,A,N,G,H)=>{const ie=r.style.light,pe=ie.properties.get("position"),be=[pe.x,pe.y,pe.z],Ie=l.create$1();"viewport"===ie.properties.get("anchor")&&(l.fromRotation(Ie,-r.transform.angle),l.transformMat3(be,be,Ie));const Ce=ie.properties.get("color"),ke=r.transform,re={u_matrix:h,u_lightpos:be,u_lightintensity:ie.properties.get("intensity"),u_lightcolor:[Ce.r,Ce.g,Ce.b],u_vertical_gradient:+c,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Q,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:x};return"globe"===ke.projection.name&&(re.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],re.u_zoom_transition=N,re.u_inv_rot_matrix=H,re.u_merc_center=G,re.u_up_dir=ke.projection.upVector(new l.CanonicalTileID(0,0,0),G[0]*l.EXTENT,G[1]*l.EXTENT),re.u_height_lift=A),re},wn=(h,r,c,p,_,x,C,A,N,G,H,ie)=>{const pe=Ee(h,r,c,p,_,x,C,N,G,H,ie),be={u_height_factor:-Math.pow(2,C.overscaledZ)/A.tileSize/8};return l.extend(pe,S(r,A),be)},ai=h=>({u_matrix:h}),oi=(h,r,c)=>l.extend(ai(h),S(r,c)),Lr=(h,r)=>({u_matrix:h,u_world:r}),vo=(h,r,c,p)=>l.extend(oi(h,r,c),{u_world:p}),ee=l.create(),Z=(h,r,c,p,_,x)=>{const C=h.transform,A="globe"===C.projection.name;let N;if("map"===x.paint.get("circle-pitch-alignment"))if(A){const H=l.globePixelsToTileUnits(C.zoom,r.canonical)*C._pixelsPerMercatorPixel;N=Float32Array.from([H,0,0,H])}else N=C.calculatePixelsToTileUnitsMatrix(c);else N=new Float32Array([C.pixelsToGLUnits[0],0,0,C.pixelsToGLUnits[1]]);const G={u_camera_to_center_distance:C.cameraToCenterDistance,u_matrix:h.translatePosMatrix(r.projMatrix,c,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:l.exported.devicePixelRatio,u_extrude_scale:N,u_inv_rot_matrix:ee,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){G.u_inv_rot_matrix=p,G.u_merc_center=_,G.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],G.u_zoom_transition=l.globeToMercatorTransition(C.zoom);const H=_[0]*l.EXTENT,ie=_[1]*l.EXTENT;G.u_up_dir=C.projection.upVector(new l.CanonicalTileID(0,0,0),H,ie)}return G},xe=h=>{const r=[];return"map"===h.paint.get("circle-pitch-alignment")&&r.push("PITCH_WITH_MAP"),"map"===h.paint.get("circle-pitch-scale")&&r.push("SCALE_WITH_MAP"),r},te=(h,r,c,p)=>{const _=l.EXTENT/c.tileSize;return{u_matrix:h,u_camera_to_center_distance:r.getCameraToCenterDistance(p),u_extrude_scale:[r.pixelsToGLUnits[0]/_,r.pixelsToGLUnits[1]/_]}},Be=(h,r,c=1)=>({u_matrix:h,u_color:r,u_overlay:0,u_overlay_scale:c}),zn=l.create(),zi=(h,r,c,p,_,x,C)=>{const A=h.transform,N="globe"===A.projection.name,G=N?l.globePixelsToTileUnits(A.zoom,r.canonical)*A._pixelsPerMercatorPixel:li(c,1,x),H={u_matrix:r.projMatrix,u_extrude_scale:G,u_intensity:C,u_inv_rot_matrix:zn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(N){H.u_inv_rot_matrix=p,H.u_merc_center=_,H.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],H.u_zoom_transition=l.globeToMercatorTransition(A.zoom);const ie=_[0]*l.EXTENT,pe=_[1]*l.EXTENT;H.u_up_dir=A.projection.upVector(new l.CanonicalTileID(0,0,0),ie,pe)}return H},ns=(h,r,c,p,_,x,C)=>{const A=h.transform,N=A.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:Zs(h,r,c,p),u_pixels_to_tile_units:N,u_device_pixel_ratio:x,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:ya(c)?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Es(r,h.transform),u_alpha_discard_threshold:0,u_trim_offset:C}},ws=(h,r,c,p,_)=>{const x=h.transform;return{u_matrix:Zs(h,r,c,p),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:_,u_image:0,u_tile_units_to_pixels:Es(r,x),u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Es(h,r){return 1/li(h,1,r.tileZoom)}function Zs(h,r,c,p){return h.translatePosMatrix(p||r.tileID.projMatrix,r,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function ya(h){const r=h.paint.get("line-dasharray").value;return r.value||"constant"!==r.kind}const $a=(h,r,c,p,_,x)=>{return{u_matrix:h,u_tl_parent:r,u_scale_parent:c,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(A=_.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(C=_.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:gs(_.paint.get("raster-hue-rotate")),u_perspective_transform:x};var C,A};function gs(h){h*=Math.PI/180;const r=Math.sin(h),c=Math.cos(h);return[(2*c+1)/3,(-Math.sqrt(3)*r-c+1)/3,(Math.sqrt(3)*r-c+1)/3]}const ha=l.create(),ce=(h,r,c,p,_,x,C,A,N,G,H,ie,pe,be,Ie,Ce)=>{const ke=_.transform,re={u_is_size_zoom_constant:+("constant"===h||"source"===h),u_is_size_feature_constant:+("constant"===h||"camera"===h),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:ke.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:ke.width/ke.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:C,u_coord_matrix:A,u_is_text:+N,u_pitch_with_map:+p,u_texsize:G,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ha,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ha,u_up_vector:[0,-1,0]};return"globe"===Ce.name&&(re.u_tile_id=[H.canonical.x,H.canonical.y,1<<H.canonical.z],re.u_zoom_transition=ie,re.u_inv_rot_matrix=be,re.u_merc_center=pe,re.u_camera_forward=ke._camera.forward(),re.u_ecef_origin=l.globeECEFOrigin(ke.globeMatrix,H.toUnwrapped()),re.u_tile_matrix=Float32Array.from(ke.globeMatrix),re.u_up_vector=Ie),re},I=(h,r,c,p,_,x,C,A,N,G,H,ie,pe,be,Ie,Ce,ke)=>l.extend(ce(h,r,c,p,_,x,C,A,N,G,ie,pe,be,Ie,Ce,ke),{u_gamma_scale:p?_.transform.cameraToCenterDistance*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:l.exported.devicePixelRatio,u_is_halo:+H}),B=(h,r,c,p,_,x,C,A,N,G,H,ie,pe,be,Ie,Ce)=>l.extend(I(h,r,c,p,_,x,C,A,!0,N,!0,H,ie,pe,be,Ie,Ce),{u_texsize_icon:G,u_texture_icon:1}),W=(h,r,c)=>({u_matrix:h,u_opacity:r,u_color:c}),ue=(h,r,c,p,_)=>l.extend(function(x,C,A){const N=C.imageManager.getPattern(x.toString()),{width:G,height:H}=C.imageManager.getPixelSize(),ie=Math.pow(2,A.tileID.overscaledZ),pe=A.tileSize*Math.pow(2,C.transform.tileZoom)/ie,be=pe*(A.tileID.canonical.x+A.tileID.wrap*ie),Ie=pe*A.tileID.canonical.y;return{u_image:0,u_pattern_tl:N.tl,u_pattern_br:N.br,u_texsize:[G,H],u_pattern_size:N.displaySize,u_tile_units_to_pixels:1/li(A,1,C.transform.tileZoom),u_pixel_coord_upper:[be>>16,Ie>>16],u_pixel_coord_lower:[65535&be,65535&Ie]}}(p,c,_),{u_matrix:h,u_opacity:r}),Se={fillExtrusion:h=>({u_matrix:new l.UniformMatrix4f(h),u_lightpos:new l.Uniform3f(h),u_lightintensity:new l.Uniform1f(h),u_lightcolor:new l.Uniform3f(h),u_vertical_gradient:new l.Uniform1f(h),u_opacity:new l.Uniform1f(h),u_edge_radius:new l.Uniform1f(h),u_ao:new l.Uniform2f(h),u_tile_id:new l.Uniform3f(h),u_zoom_transition:new l.Uniform1f(h),u_inv_rot_matrix:new l.UniformMatrix4f(h),u_merc_center:new l.Uniform2f(h),u_up_dir:new l.Uniform3f(h),u_height_lift:new l.Uniform1f(h)}),fillExtrusionPattern:h=>({u_matrix:new l.UniformMatrix4f(h),u_lightpos:new l.Uniform3f(h),u_lightintensity:new l.Uniform1f(h),u_lightcolor:new l.Uniform3f(h),u_vertical_gradient:new l.Uniform1f(h),u_height_factor:new l.Uniform1f(h),u_edge_radius:new l.Uniform1f(h),u_ao:new l.Uniform2f(h),u_tile_id:new l.Uniform3f(h),u_zoom_transition:new l.Uniform1f(h),u_inv_rot_matrix:new l.UniformMatrix4f(h),u_merc_center:new l.Uniform2f(h),u_up_dir:new l.Uniform3f(h),u_height_lift:new l.Uniform1f(h),u_image:new l.Uniform1i(h),u_texsize:new l.Uniform2f(h),u_pixel_coord_upper:new l.Uniform2f(h),u_pixel_coord_lower:new l.Uniform2f(h),u_tile_units_to_pixels:new l.Uniform1f(h),u_opacity:new l.Uniform1f(h)}),fill:h=>({u_matrix:new l.UniformMatrix4f(h)}),fillPattern:h=>({u_matrix:new l.UniformMatrix4f(h),u_image:new l.Uniform1i(h),u_texsize:new l.Uniform2f(h),u_pixel_coord_upper:new l.Uniform2f(h),u_pixel_coord_lower:new l.Uniform2f(h),u_tile_units_to_pixels:new l.Uniform1f(h)}),fillOutline:h=>({u_matrix:new l.UniformMatrix4f(h),u_world:new l.Uniform2f(h)}),fillOutlinePattern:h=>({u_matrix:new l.UniformMatrix4f(h),u_world:new l.Uniform2f(h),u_image:new l.Uniform1i(h),u_texsize:new l.Uniform2f(h),u_pixel_coord_upper:new l.Uniform2f(h),u_pixel_coord_lower:new l.Uniform2f(h),u_tile_units_to_pixels:new l.Uniform1f(h)}),circle:h=>({u_camera_to_center_distance:new l.Uniform1f(h),u_extrude_scale:new l.UniformMatrix2f(h),u_device_pixel_ratio:new l.Uniform1f(h),u_matrix:new l.UniformMatrix4f(h),u_inv_rot_matrix:new l.UniformMatrix4f(h),u_merc_center:new l.Uniform2f(h),u_tile_id:new l.Uniform3f(h),u_zoom_transition:new l.Uniform1f(h),u_up_dir:new l.Uniform3f(h)}),collisionBox:h=>({u_matrix:new l.UniformMatrix4f(h),u_camera_to_center_distance:new l.Uniform1f(h),u_extrude_scale:new l.Uniform2f(h)}),collisionCircle:h=>({u_matrix:new l.UniformMatrix4f(h),u_inv_matrix:new l.UniformMatrix4f(h),u_camera_to_center_distance:new l.Uniform1f(h),u_viewport_size:new l.Uniform2f(h)}),debug:h=>({u_color:new l.UniformColor(h),u_matrix:new l.UniformMatrix4f(h),u_overlay:new l.Uniform1i(h),u_overlay_scale:new l.Uniform1f(h)}),clippingMask:h=>({u_matrix:new l.UniformMatrix4f(h)}),heatmap:h=>({u_extrude_scale:new l.Uniform1f(h),u_intensity:new l.Uniform1f(h),u_matrix:new l.UniformMatrix4f(h),u_inv_rot_matrix:new l.UniformMatrix4f(h),u_merc_center:new l.Uniform2f(h),u_tile_id:new l.Uniform3f(h),u_zoom_transition:new l.Uniform1f(h),u_up_dir:new l.Uniform3f(h)}),heatmapTexture:h=>({u_image:new l.Uniform1i(h),u_color_ramp:new l.Uniform1i(h),u_opacity:new l.Uniform1f(h)}),hillshade:h=>({u_matrix:new l.UniformMatrix4f(h),u_image:new l.Uniform1i(h),u_latrange:new l.Uniform2f(h),u_light:new l.Uniform2f(h),u_shadow:new l.UniformColor(h),u_highlight:new l.UniformColor(h),u_accent:new l.UniformColor(h)}),hillshadePrepare:h=>({u_matrix:new l.UniformMatrix4f(h),u_image:new l.Uniform1i(h),u_dimension:new l.Uniform2f(h),u_zoom:new l.Uniform1f(h),u_unpack:new l.Uniform4f(h)}),line:h=>({u_matrix:new l.UniformMatrix4f(h),u_pixels_to_tile_units:new l.UniformMatrix2f(h),u_device_pixel_ratio:new l.Uniform1f(h),u_units_to_pixels:new l.Uniform2f(h),u_dash_image:new l.Uniform1i(h),u_gradient_image:new l.Uniform1i(h),u_image_height:new l.Uniform1f(h),u_texsize:new l.Uniform2f(h),u_tile_units_to_pixels:new l.Uniform1f(h),u_alpha_discard_threshold:new l.Uniform1f(h),u_trim_offset:new l.Uniform2f(h)}),linePattern:h=>({u_matrix:new l.UniformMatrix4f(h),u_texsize:new l.Uniform2f(h),u_pixels_to_tile_units:new l.UniformMatrix2f(h),u_device_pixel_ratio:new l.Uniform1f(h),u_image:new l.Uniform1i(h),u_units_to_pixels:new l.Uniform2f(h),u_tile_units_to_pixels:new l.Uniform1f(h),u_alpha_discard_threshold:new l.Uniform1f(h)}),raster:h=>({u_matrix:new l.UniformMatrix4f(h),u_tl_parent:new l.Uniform2f(h),u_scale_parent:new l.Uniform1f(h),u_fade_t:new l.Uniform1f(h),u_opacity:new l.Uniform1f(h),u_image0:new l.Uniform1i(h),u_image1:new l.Uniform1i(h),u_brightness_low:new l.Uniform1f(h),u_brightness_high:new l.Uniform1f(h),u_saturation_factor:new l.Uniform1f(h),u_contrast_factor:new l.Uniform1f(h),u_spin_weights:new l.Uniform3f(h),u_perspective_transform:new l.Uniform2f(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new l.Uniform1i(h),u_is_size_feature_constant:new l.Uniform1i(h),u_size_t:new l.Uniform1f(h),u_size:new l.Uniform1f(h),u_camera_to_center_distance:new l.Uniform1f(h),u_rotate_symbol:new l.Uniform1i(h),u_aspect_ratio:new l.Uniform1f(h),u_fade_change:new l.Uniform1f(h),u_matrix:new l.UniformMatrix4f(h),u_label_plane_matrix:new l.UniformMatrix4f(h),u_coord_matrix:new l.UniformMatrix4f(h),u_is_text:new l.Uniform1i(h),u_pitch_with_map:new l.Uniform1i(h),u_texsize:new l.Uniform2f(h),u_tile_id:new l.Uniform3f(h),u_zoom_transition:new l.Uniform1f(h),u_inv_rot_matrix:new l.UniformMatrix4f(h),u_merc_center:new l.Uniform2f(h),u_camera_forward:new l.Uniform3f(h),u_tile_matrix:new l.UniformMatrix4f(h),u_up_vector:new l.Uniform3f(h),u_ecef_origin:new l.Uniform3f(h),u_texture:new l.Uniform1i(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new l.Uniform1i(h),u_is_size_feature_constant:new l.Uniform1i(h),u_size_t:new l.Uniform1f(h),u_size:new l.Uniform1f(h),u_camera_to_center_distance:new l.Uniform1f(h),u_rotate_symbol:new l.Uniform1i(h),u_aspect_ratio:new l.Uniform1f(h),u_fade_change:new l.Uniform1f(h),u_matrix:new l.UniformMatrix4f(h),u_label_plane_matrix:new l.UniformMatrix4f(h),u_coord_matrix:new l.UniformMatrix4f(h),u_is_text:new l.Uniform1i(h),u_pitch_with_map:new l.Uniform1i(h),u_texsize:new l.Uniform2f(h),u_texture:new l.Uniform1i(h),u_gamma_scale:new l.Uniform1f(h),u_device_pixel_ratio:new l.Uniform1f(h),u_tile_id:new l.Uniform3f(h),u_zoom_transition:new l.Uniform1f(h),u_inv_rot_matrix:new l.UniformMatrix4f(h),u_merc_center:new l.Uniform2f(h),u_camera_forward:new l.Uniform3f(h),u_tile_matrix:new l.UniformMatrix4f(h),u_up_vector:new l.Uniform3f(h),u_ecef_origin:new l.Uniform3f(h),u_is_halo:new l.Uniform1i(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new l.Uniform1i(h),u_is_size_feature_constant:new l.Uniform1i(h),u_size_t:new l.Uniform1f(h),u_size:new l.Uniform1f(h),u_camera_to_center_distance:new l.Uniform1f(h),u_rotate_symbol:new l.Uniform1i(h),u_aspect_ratio:new l.Uniform1f(h),u_fade_change:new l.Uniform1f(h),u_matrix:new l.UniformMatrix4f(h),u_label_plane_matrix:new l.UniformMatrix4f(h),u_coord_matrix:new l.UniformMatrix4f(h),u_is_text:new l.Uniform1i(h),u_pitch_with_map:new l.Uniform1i(h),u_texsize:new l.Uniform2f(h),u_texsize_icon:new l.Uniform2f(h),u_texture:new l.Uniform1i(h),u_texture_icon:new l.Uniform1i(h),u_gamma_scale:new l.Uniform1f(h),u_device_pixel_ratio:new l.Uniform1f(h),u_is_halo:new l.Uniform1i(h)}),background:h=>({u_matrix:new l.UniformMatrix4f(h),u_opacity:new l.Uniform1f(h),u_color:new l.UniformColor(h)}),backgroundPattern:h=>({u_matrix:new l.UniformMatrix4f(h),u_opacity:new l.Uniform1f(h),u_image:new l.Uniform1i(h),u_pattern_tl:new l.Uniform2f(h),u_pattern_br:new l.Uniform2f(h),u_texsize:new l.Uniform2f(h),u_pattern_size:new l.Uniform2f(h),u_pixel_coord_upper:new l.Uniform2f(h),u_pixel_coord_lower:new l.Uniform2f(h),u_tile_units_to_pixels:new l.Uniform1f(h)}),terrainRaster:Ns,terrainDepth:Ns,skybox:h=>({u_matrix:new l.UniformMatrix4f(h),u_sun_direction:new l.Uniform3f(h),u_cubemap:new l.Uniform1i(h),u_opacity:new l.Uniform1f(h),u_temporal_offset:new l.Uniform1f(h)}),skyboxGradient:h=>({u_matrix:new l.UniformMatrix4f(h),u_color_ramp:new l.Uniform1i(h),u_center_direction:new l.Uniform3f(h),u_radius:new l.Uniform1f(h),u_opacity:new l.Uniform1f(h),u_temporal_offset:new l.Uniform1f(h)}),skyboxCapture:h=>({u_matrix_3f:new l.UniformMatrix3f(h),u_sun_direction:new l.Uniform3f(h),u_sun_intensity:new l.Uniform1f(h),u_color_tint_r:new l.Uniform4f(h),u_color_tint_m:new l.Uniform4f(h),u_luminance:new l.Uniform1f(h)}),globeRaster:h=>({u_proj_matrix:new l.UniformMatrix4f(h),u_globe_matrix:new l.UniformMatrix4f(h),u_normalize_matrix:new l.UniformMatrix4f(h),u_merc_matrix:new l.UniformMatrix4f(h),u_zoom_transition:new l.Uniform1f(h),u_merc_center:new l.Uniform2f(h),u_image0:new l.Uniform1i(h),u_grid_matrix:new l.UniformMatrix3f(h),u_skirt_height:new l.Uniform1f(h),u_frustum_tl:new l.Uniform3f(h),u_frustum_tr:new l.Uniform3f(h),u_frustum_br:new l.Uniform3f(h),u_frustum_bl:new l.Uniform3f(h),u_globe_pos:new l.Uniform3f(h),u_globe_radius:new l.Uniform1f(h),u_viewport:new l.Uniform2f(h)}),globeAtmosphere:h=>({u_frustum_tl:new l.Uniform3f(h),u_frustum_tr:new l.Uniform3f(h),u_frustum_br:new l.Uniform3f(h),u_frustum_bl:new l.Uniform3f(h),u_horizon:new l.Uniform1f(h),u_transition:new l.Uniform1f(h),u_fadeout_range:new l.Uniform1f(h),u_color:new l.Uniform4f(h),u_high_color:new l.Uniform4f(h),u_space_color:new l.Uniform4f(h),u_star_intensity:new l.Uniform1f(h),u_star_density:new l.Uniform1f(h),u_star_size:new l.Uniform1f(h),u_temporal_offset:new l.Uniform1f(h),u_horizon_angle:new l.Uniform1f(h),u_rotation_matrix:new l.UniformMatrix4f(h)})};let nt;function gt(h,r,c,p,_,x,C){const A=h.context,N=A.gl,G=h.transform,H=h.useProgram("collisionBox"),ie=[];let pe=0,be=0;for(let $e=0;$e<p.length;$e++){const lt=p[$e],ct=r.getTile(lt),ut=ct.getBucket(c);if(!ut)continue;const kt=mn(lt,ut,G);let Pt=kt;0===_[0]&&0===_[1]||(Pt=h.translatePosMatrix(kt,ct,_,x));const qt=C?ut.textCollisionBox:ut.iconCollisionBox,Fn=ut.collisionCircleArray;if(Fn.length>0){const Ut=l.create(),gn=Pt;l.mul(Ut,ut.placementInvProjMatrix,G.glCoordMatrix),l.mul(Ut,Ut,ut.placementViewportMatrix),ie.push({circleArray:Fn,circleOffset:be,transform:gn,invTransform:Ut,projection:ut.getProjection()}),pe+=Fn.length/4,be=pe}qt&&(h.terrain&&h.terrain.setupElevationDraw(ct,H),H.draw(A,N.LINES,l.DepthMode.disabled,l.StencilMode.disabled,h.colorModeForRenderPass(),l.CullFaceMode.disabled,te(Pt,G,ct,ut.getProjection()),c.id,qt.layoutVertexBuffer,qt.indexBuffer,qt.segments,null,G.zoom,null,[qt.collisionVertexBuffer,qt.collisionVertexBufferExt]))}if(!C||!ie.length)return;const Ie=h.useProgram("collisionCircle"),Ce=new l.StructArrayLayout2f1f2i16;Ce.resize(4*pe),Ce._trim();let ke=0;for(const $e of ie)for(let lt=0;lt<$e.circleArray.length/4;lt++){const ct=4*lt,ut=$e.circleArray[ct+0],kt=$e.circleArray[ct+1],Pt=$e.circleArray[ct+2],qt=$e.circleArray[ct+3];Ce.emplace(ke++,ut,kt,Pt,qt,0),Ce.emplace(ke++,ut,kt,Pt,qt,1),Ce.emplace(ke++,ut,kt,Pt,qt,2),Ce.emplace(ke++,ut,kt,Pt,qt,3)}(!nt||nt.length<2*pe)&&(nt=function($e){const lt=2*$e,ct=new l.StructArrayLayout3ui6;ct.resize(lt),ct._trim();for(let ut=0;ut<lt;ut++){const kt=6*ut;ct.uint16[kt+0]=4*ut+0,ct.uint16[kt+1]=4*ut+1,ct.uint16[kt+2]=4*ut+2,ct.uint16[kt+3]=4*ut+2,ct.uint16[kt+4]=4*ut+3,ct.uint16[kt+5]=4*ut+0}return ct}(pe));const re=A.createIndexBuffer(nt,!0),we=A.createVertexBuffer(Ce,l.collisionCircleLayout.members,!0);for(const $e of ie){const lt={u_matrix:$e.transform,u_inv_matrix:$e.invTransform,u_camera_to_center_distance:(ze=G).getCameraToCenterDistance($e.projection),u_viewport_size:[ze.width,ze.height]};Ie.draw(A,N.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,h.colorModeForRenderPass(),l.CullFaceMode.disabled,lt,c.id,we,re,l.SegmentVector.simpleSegment(0,2*$e.circleOffset,$e.circleArray.length,$e.circleArray.length/2),null,G.zoom)}var ze;we.destroy(),re.destroy()}const Zt=l.create();function fn({width:h,height:r,anchor:c,textOffset:p,textScale:_},x){const{horizontalAlign:C,verticalAlign:A}=l.getAnchorAlignment(c),N=-(C-.5)*h,G=-(A-.5)*r,H=l.evaluateVariableOffset(c,p);return new l.Point((N/_+H[0])*x,(G/_+H[1])*x)}function gi(h,r,c,p,_,x,C,A,N,G,H){const ie=h.text.placedSymbolArray,pe=h.text.dynamicLayoutVertexArray,be=h.icon.dynamicLayoutVertexArray,Ie={},Ce=h.getProjection(),ke=an(A,Ce,x),re=x.elevation,we=Ce.upVectorScale(A.canonical,x.center.lat,x.worldSize).metersToTile;pe.clear();for(let ze=0;ze<ie.length;ze++){const $e=ie.get(ze),{tileAnchorX:lt,tileAnchorY:ct,numGlyphs:ut}=$e,kt=$e.hidden||!$e.crossTileID||h.allowVerticalPlacement&&!$e.placedOrientation?null:p[$e.crossTileID];if(kt){let Pt=0,qt=0,Fn=0;if(re){const Vn=re?re.getAtTileOffset(A,lt,ct):0,[Ei,Ki,di]=Ce.upVector(A.canonical,lt,ct);Pt=Vn*Ei*we,qt=Vn*Ki*we,Fn=Vn*di*we}let[Ut,gn,Jt,Rn]=Or($e.projectedAnchorX+Pt,$e.projectedAnchorY+qt,$e.projectedAnchorZ+Fn,c?ke:C);const jt=es(x.getCameraToCenterDistance(Ce),Rn);let vn=_.evaluateSizeForFeature(h.textSizeData,G,$e)*jt/l.ONE_EM;c&&(vn*=h.tilePixelRatio/N);const kn=fn(kt,vn);c?(({x:Ut,y:gn,z:Jt}=Ce.projectTilePoint(lt+kn.x,ct+kn.y,A.canonical)),[Ut,gn,Jt]=Or(Ut+Pt,gn+qt,Jt+Fn,C)):(r&&kn._rotate(-x.angle),Ut+=kn.x,gn+=kn.y,Jt=0);const Mn=h.allowVerticalPlacement&&$e.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let Vn=0;Vn<ut;Vn++)l.addDynamicAttributes(pe,Ut,gn,Jt,Mn);H&&$e.associatedIconIndex>=0&&(Ie[$e.associatedIconIndex]={x:Ut,y:gn,z:Jt,angle:Mn})}else ge(ut,pe)}if(H){be.clear();const ze=h.icon.placedSymbolArray;for(let $e=0;$e<ze.length;$e++){const lt=ze.get($e),{numGlyphs:ct}=lt,ut=Ie[$e];if(lt.hidden||!ut)ge(ct,be);else{const{x:kt,y:Pt,z:qt,angle:Fn}=ut;for(let Ut=0;Ut<ct;Ut++)l.addDynamicAttributes(be,kt,Pt,qt,Fn)}}h.icon.dynamicLayoutVertexBuffer.updateData(be)}h.text.dynamicLayoutVertexBuffer.updateData(pe)}function Wn(h,r,c){return c.iconsInText&&r?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function mr(h,r,c,p,_,x,C,A,N,G,H,ie){const pe=h.context,be=pe.gl,Ie=h.transform,Ce="map"===A,ke="map"===N,re=Ce&&"point"!==c.layout.get("symbol-placement"),we=Ce&&!ke&&!re,ze=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let $e=!1;const lt=h.depthModeForSublayer(0,l.DepthMode.ReadOnly),ct=[l.mercatorXfromLng(Ie.center.lng),l.mercatorYfromLat(Ie.center.lat)],ut=c.layout.get("text-variable-anchor"),kt="globe"===Ie.projection.name,Pt=[],qt=[0,-1,0];let Fn=qt;!kt&&!Ie.mercatorFromTransition||Ce||(Fn=function(Ut){const gn=Ut._camera.getWorldToCamera(Ut.worldSize,1),Jt=l.multiply([],gn,Ut.globeMatrix);l.invert(Jt,Jt);const Rn=[0,0,0],jt=[0,1,0,0];return l.transformMat4$1(jt,jt,Jt),Rn[0]=jt[0],Rn[1]=jt[1],Rn[2]=jt[2],l.normalize(Rn,Rn),Rn}(Ie));for(const Ut of p){const gn=r.getTile(Ut),Jt=gn.getBucket(c);if(!Jt||"mercator"===Jt.projection.name&&kt)continue;const Rn=_?Jt.text:Jt.icon;if(!Rn||Jt.fullyClipped||!Rn.segments.get().length)continue;const jt=Rn.programConfigurations.get(c.id),vn=_||Jt.sdfIcons,kn=_?Jt.textSizeData:Jt.iconSizeData,Mn=ke||0!==Ie.pitch,Vn=l.evaluateSizeForZoom(kn,Ie.zoom);let Ei,Ki,di,Ri,_r=[0,0],dr=null;if(_)Ki=gn.glyphAtlasTexture,di=be.LINEAR,Ei=gn.glyphAtlasTexture.size,Jt.iconsInText&&(_r=gn.imageAtlasTexture.size,dr=gn.imageAtlasTexture,Ri=Mn||h.options.rotating||h.options.zooming||"composite"===kn.kind||"camera"===kn.kind?be.LINEAR:be.NEAREST);else{const Ul=1!==c.layout.get("icon-size").constantOr(0)||Jt.iconsNeedLinear;Ki=gn.imageAtlasTexture,di=vn||h.options.rotating||h.options.zooming||Ul||Mn?be.LINEAR:be.NEAREST,Ei=gn.imageAtlasTexture.size}const mi="globe"===Jt.projection.name,Jr=mi?Fn:qt,uo=mi?l.globeToMercatorTransition(Ie.zoom):0,ho=an(Ut,Jt.getProjection(),Ie),Zr=Ie.calculatePixelsToTileUnitsMatrix(gn),pa=Gt(ho,gn.tileID.canonical,ke,Ce,Ie,Jt.getProjection(),Zr),io=h.terrain&&ke&&re?l.invert(l.create(),pa):Zt,Ga=Rr(ho,gn.tileID.canonical,ke,Ce,Ie,Jt.getProjection(),Zr),el=ut&&Jt.hasTextData(),Ro="none"!==c.layout.get("icon-text-fit")&&el&&Jt.hasIconData();if(re){const Ul=Ie.elevation,jl=Ul?Ul.getAtTileOffsetFunc(Ut,Ie.center.lat,Ie.worldSize,Jt.getProjection()):null,Ec=so(ho,gn.tileID.canonical,ke,Ce,Ie,Jt.getProjection(),Zr);os(Jt,ho,h,_,Ec,Ga,ke,G,jl,Ut)}const bo=re||_&&ut||Ro,$r=h.translatePosMatrix(ho,gn,x,C),cs=bo?Zt:pa,ks=h.translatePosMatrix(Ga,gn,x,C,!0),ro=Jt.getProjection().createInversionMatrix(Ie,Ut.canonical),Hs=[];h.terrainRenderModeElevated()&&ke&&Hs.push("PITCH_WITH_MAP_TERRAIN"),mi&&Hs.push("PROJECTION_GLOBE_VIEW"),bo&&Hs.push("PROJECTED_POS_ON_VIEWPORT");const du=vn&&0!==c.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1);let Al;Al=vn?Jt.iconsInText?B(kn.kind,Vn,we,ke,h,$r,cs,ks,Ei,_r,Ut,uo,ct,ro,Jr,Jt.getProjection()):I(kn.kind,Vn,we,ke,h,$r,cs,ks,_,Ei,!0,Ut,uo,ct,ro,Jr,Jt.getProjection()):ce(kn.kind,Vn,we,ke,h,$r,cs,ks,_,Ei,Ut,uo,ct,ro,Jr,Jt.getProjection());const ul={program:h.useProgram(Wn(vn,_,Jt),jt,Hs),buffers:Rn,uniformValues:Al,atlasTexture:Ki,atlasTextureIcon:dr,atlasInterpolation:di,atlasInterpolationIcon:Ri,isSDF:vn,hasHalo:du,tile:gn,labelPlaneMatrixInv:io};if(ze&&Jt.canOverlap){$e=!0;const Ul=Rn.segments.get();for(const jl of Ul)Pt.push({segments:new l.SegmentVector([jl]),sortKey:jl.sortKey,state:ul})}else Pt.push({segments:Rn.segments,sortKey:0,state:ul})}$e&&Pt.sort((Ut,gn)=>Ut.sortKey-gn.sortKey);for(const Ut of Pt){const gn=Ut.state;if(h.terrain&&h.terrain.setupElevationDraw(gn.tile,gn.program,{useDepthForOcclusion:!kt,labelPlaneMatrixInv:gn.labelPlaneMatrixInv}),pe.activeTexture.set(be.TEXTURE0),gn.atlasTexture.bind(gn.atlasInterpolation,be.CLAMP_TO_EDGE),gn.atlasTextureIcon&&(pe.activeTexture.set(be.TEXTURE1),gn.atlasTextureIcon&&gn.atlasTextureIcon.bind(gn.atlasInterpolationIcon,be.CLAMP_TO_EDGE)),gn.isSDF){const Jt=gn.uniformValues;gn.hasHalo&&(Jt.u_is_halo=1,Yi(gn.buffers,Ut.segments,c,h,gn.program,lt,H,ie,Jt)),Jt.u_is_halo=0}Yi(gn.buffers,Ut.segments,c,h,gn.program,lt,H,ie,gn.uniformValues)}}function Yi(h,r,c,p,_,x,C,A,N){const G=p.context,H=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.globeExtVertexBuffer];_.draw(G,G.gl.TRIANGLES,x,C,A,l.CullFaceMode.disabled,N,c.id,h.layoutVertexBuffer,h.indexBuffer,r,c.paint,p.transform.zoom,h.programConfigurations.get(c.id),H)}function Oi(h,r,c,p,_,x,C){const A=h.context.gl,N=c.paint.get("fill-pattern"),G=N&&N.constantOr(1);let H,ie,pe,be,Ie;C?(ie=G&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=A.LINES):(ie=G?"fillPattern":"fill",H=A.TRIANGLES);for(const Ce of p){const ke=r.getTile(Ce);if(G&&!ke.patternsLoaded())continue;const re=ke.getBucket(c);if(!re)continue;h.prepareDrawTile();const we=re.programConfigurations.get(c.id),ze=h.useProgram(ie,we);G&&(h.context.activeTexture.set(A.TEXTURE0),ke.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),we.updatePaintBuffers());const $e=N.constantOr(null);if($e&&ke.imageAtlas){const ct=ke.imageAtlas.patternPositions[$e.toString()];ct&&we.setConstantPatternPositions(ct)}const lt=h.translatePosMatrix(Ce.projMatrix,ke,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(C){be=re.indexBuffer2,Ie=re.segments2;const ct=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];pe="fillOutlinePattern"===ie&&G?vo(lt,h,ke,ct):Lr(lt,ct)}else be=re.indexBuffer,Ie=re.segments,pe=G?oi(lt,h,ke):ai(lt);h.prepareDrawProgram(h.context,ze,Ce.toUnwrapped()),ze.draw(h.context,H,_,h.stencilModeForClipping(Ce),x,l.CullFaceMode.disabled,pe,c.id,re.layoutVertexBuffer,be,Ie,c.paint,h.transform.zoom,we)}}function Vi(h,r,c,p,_,x,C){const A=h.context,N=A.gl,G=h.transform,H=c.paint.get("fill-extrusion-pattern"),ie=H.constantOr(1),pe=c.paint.get("fill-extrusion-opacity"),be=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),c.paint.get("fill-extrusion-ambient-occlusion-radius")],Ie=c.layout.get("fill-extrusion-edge-radius"),Ce=Ie>0&&!c.paint.get("fill-extrusion-rounded-roof"),ke=Ce?0:Ie,re="globe"===G.projection.name?l.fillExtrusionHeightLift():0,we="globe"===G.projection.name,ze=we?l.globeToMercatorTransition(G.zoom):0,$e=[l.mercatorXfromLng(G.center.lng),l.mercatorYfromLat(G.center.lat)],lt=[];we&&lt.push("PROJECTION_GLOBE_VIEW"),be[0]>0&&lt.push("FAUX_AO"),Ce&&lt.push("ZERO_ROOF_RADIUS");for(const ct of p){const ut=r.getTile(ct),kt=ut.getBucket(c);if(!kt||kt.projection.name!==G.projection.name)continue;const Pt=kt.programConfigurations.get(c.id),qt=h.useProgram(ie?"fillExtrusionPattern":"fillExtrusion",Pt,lt);if(h.terrain){const vn=h.terrain;if(h.style.terrainSetForDrapingOnly())vn.setupElevationDraw(ut,qt,{useMeterToDem:!0});else{if(!kt.enableTerrain)continue;if(vn.setupElevationDraw(ut,qt,{useMeterToDem:!0}),Kr(A,r,ct,kt,c,vn),!kt.centroidVertexBuffer){const kn=qt.attributes.a_centroid_pos;void 0!==kn&&N.vertexAttrib2f(kn,0,0)}}}ie&&(h.context.activeTexture.set(N.TEXTURE0),ut.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Pt.updatePaintBuffers());const Fn=H.constantOr(null);if(Fn&&ut.imageAtlas){const vn=ut.imageAtlas.patternPositions[Fn.toString()];vn&&Pt.setConstantPatternPositions(vn)}const Ut=h.translatePosMatrix(ct.projMatrix,ut,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),gn=G.projection.createInversionMatrix(G,ct.canonical),Jt=c.paint.get("fill-extrusion-vertical-gradient"),Rn=ie?wn(Ut,h,Jt,pe,be,ke,ct,ut,re,ze,$e,gn):Ee(Ut,h,Jt,pe,be,ke,ct,re,ze,$e,gn);h.prepareDrawProgram(A,qt,ct.toUnwrapped());const jt=[];h.terrain&&jt.push(kt.centroidVertexBuffer),we&&jt.push(kt.layoutVertexExtBuffer),qt.draw(A,A.gl.TRIANGLES,_,x,C,l.CullFaceMode.backCCW,Rn,c.id,kt.layoutVertexBuffer,kt.indexBuffer,kt.segments,c.paint,h.transform.zoom,Pt,jt)}}function Kr(h,r,c,p,_,x){const C=[re=>{let we=re.canonical.x-1,ze=re.wrap;return we<0&&(we=(1<<re.canonical.z)-1,ze--),new l.OverscaledTileID(re.overscaledZ,ze,re.canonical.z,we,re.canonical.y)},re=>{let we=re.canonical.x+1,ze=re.wrap;return we===1<<re.canonical.z&&(we=0,ze++),new l.OverscaledTileID(re.overscaledZ,ze,re.canonical.z,we,re.canonical.y)},re=>new l.OverscaledTileID(re.overscaledZ,re.wrap,re.canonical.z,re.canonical.x,(0===re.canonical.y?1<<re.canonical.z:re.canonical.y)-1),re=>new l.OverscaledTileID(re.overscaledZ,re.wrap,re.canonical.z,re.canonical.x,re.canonical.y===(1<<re.canonical.z)-1?0:re.canonical.y+1)],A=re=>{const we=r.getSource().minzoom,ze=lt=>{const ct=r.getTileByID(lt);if(ct&&ct.hasData())return ct.getBucket(_)},$e=[0,-1,1];for(const lt of $e){if(re.overscaledZ+lt<we)continue;const ct=ze(re.calculateScaledKey(re.overscaledZ+lt));if(ct)return ct}},N=[0,0,0],G=(re,we)=>(N[0]=Math.min(re.min.y,we.min.y),N[1]=Math.max(re.max.y,we.max.y),N[2]=l.EXTENT-we.min.x>re.max.x?we.min.x-l.EXTENT:re.max.x,N),H=(re,we)=>(N[0]=Math.min(re.min.x,we.min.x),N[1]=Math.max(re.max.x,we.max.x),N[2]=l.EXTENT-we.min.y>re.max.y?we.min.y-l.EXTENT:re.max.y,N),ie=[(re,we)=>G(re,we),(re,we)=>G(we,re),(re,we)=>H(re,we),(re,we)=>H(we,re)],pe=new l.Point(0,0);let be,Ie,Ce;const ke=(re,we,ze,$e,lt)=>{const ct=[[$e?ze:re,$e?re:ze,0],[$e?ze:we,$e?we:ze,0]],ut=lt<0?l.EXTENT+lt:lt,kt=[$e?ut:(re+we)/2,$e?(re+we)/2:ut,0];return 0===ze&&lt<0||0!==ze&&lt>0?x.getForTilePoints(Ce,[kt],!0,Ie):ct.push(kt),x.getForTilePoints(c,ct,!0,be),Math.max(ct[0][2],ct[1][2],kt[2])/x.exaggeration()};for(let re=0;re<4;re++){const we=(re<2?1:5)-re,ze=p.borders[re];if(0===ze.length)continue;const $e=Ce=C[re](c),lt=A($e);if(!(lt&&lt instanceof l.FillExtrusionBucket&&lt.enableTerrain)||p.borderDoneWithNeighborZ[re]===lt.canonical.z&&lt.borderDoneWithNeighborZ[we]===p.canonical.z||(Ie=x.findDEMTileFor($e),!Ie||!Ie.dem))continue;if(!be){const Pt=x.findDEMTileFor(c);if(!Pt||!Pt.dem)return;be=Pt}const ct=lt.borders[we];let ut=0;const kt=lt.borderDoneWithNeighborZ[we]!==p.canonical.z;if(p.canonical.z===lt.canonical.z){for(let Pt=0;Pt<ze.length;Pt++){const qt=p.featuresOnBorder[ze[Pt]],Fn=qt.borders[re];let Ut;for(;ut<ct.length&&(Ut=lt.featuresOnBorder[ct[ut]],!(Ut.borders[we][1]>Fn[0]+3));)kt&&lt.encodeCentroid(void 0,Ut,!1),ut++;if(Ut&&ut<ct.length){const gn=ut;let Jt=0;for(;!(Ut.borders[we][0]>Fn[1]-3)&&(Jt++,++ut!==ct.length);)Ut=lt.featuresOnBorder[ct[ut]];if(Ut=lt.featuresOnBorder[ct[gn]],qt.intersectsCount()>1||Ut.intersectsCount()>1||1!==Jt){1!==Jt&&(ut=gn),p.encodeCentroid(void 0,qt,!1),kt&&lt.encodeCentroid(void 0,Ut,!1);continue}const Rn=ie[re](qt,Ut),jt=re%2?l.EXTENT-1:0;pe.x=ke(Rn[0],Math.min(l.EXTENT-1,Rn[1]),jt,re<2,Rn[2]),pe.y=0,p.encodeCentroid(pe,qt,!1),kt&&lt.encodeCentroid(pe,Ut,!1)}else p.encodeCentroid(void 0,qt,!1)}p.borderDoneWithNeighborZ[re]=lt.canonical.z,p.needsCentroidUpdate=!0,kt&&(lt.borderDoneWithNeighborZ[we]=p.canonical.z,lt.needsCentroidUpdate=!0)}else{for(const Pt of ze)p.encodeCentroid(void 0,p.featuresOnBorder[Pt],!1);if(kt){for(const Pt of ct)lt.encodeCentroid(void 0,lt.featuresOnBorder[Pt],!1);lt.borderDoneWithNeighborZ[we]=p.canonical.z,lt.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[re]=lt.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&0!==p.centroidVertexArray.length)&&p.uploadCentroid(h)}const xo=new l.Color(1,0,0,1),as=new l.Color(0,1,0,1),Ds=new l.Color(0,0,1,1),Wo=new l.Color(1,0,1,1),cl=new l.Color(0,1,1,1);function $s(h,r,c){const p=h.context,_=h.transform,x=p.gl,C="globe"===_.projection.name,A=C?["PROJECTION_GLOBE_VIEW"]:null;let N=c.projMatrix;if(C&&l.globeToMercatorTransition(_.zoom)>0){const qt=l.transitionTileAABBinECEF(c.canonical,_),Fn=l.globeDenormalizeECEF(qt);N=l.multiply(new Float32Array(16),_.globeMatrix,Fn),l.multiply(N,_.projMatrix,N)}const G=h.useProgram("debug",null,A),H=r.getTileByID(c.key);h.terrain&&h.terrain.setupElevationDraw(H,G);const ie=l.DepthMode.disabled,pe=l.StencilMode.disabled,be=h.colorModeForRenderPass();p.activeTexture.set(x.TEXTURE0),h.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),C?H._makeGlobeTileDebugBuffers(h.context,_):H._makeDebugTileBoundsBuffers(h.context,_.projection);const Ce=H._tileDebugBuffer||h.debugBuffer,ke=H._tileDebugIndexBuffer||h.debugIndexBuffer,re=H._tileDebugSegments||h.debugSegments;G.draw(p,x.LINE_STRIP,ie,pe,be,l.CullFaceMode.disabled,Be(N,l.Color.red),"$debug",Ce,ke,re,null,null,null,[H._globeTileDebugBorderBuffer]);const we=H.latestRawTileData,ze=Math.floor((we&&we.byteLength||0)/1024),$e=r.getTile(c).tileSize,lt=512/Math.min($e,512)*(c.overscaledZ/_.zoom)*.5;let ct=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(ct+=` => ${c.overscaledZ}`),ct+=` ${ze}kb`,function(qt,Fn){qt.initDebugOverlayCanvas();const Ut=qt.debugOverlayCanvas,gn=qt.context.gl,Jt=qt.debugOverlayCanvas.getContext("2d");Jt.clearRect(0,0,Ut.width,Ut.height),Jt.shadowColor="white",Jt.shadowBlur=2,Jt.lineWidth=1.5,Jt.strokeStyle="white",Jt.textBaseline="top",Jt.font="bold 36px Open Sans, sans-serif",Jt.fillText(Fn,5,5),Jt.strokeText(Fn,5,5),qt.debugOverlayTexture.update(Ut),qt.debugOverlayTexture.bind(gn.LINEAR,gn.CLAMP_TO_EDGE)}(h,ct);const ut=H._tileDebugTextBuffer||h.debugBuffer,kt=H._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,Pt=H._tileDebugTextSegments||h.debugSegments;G.draw(p,x.TRIANGLES,ie,pe,l.ColorMode.alphaBlended,l.CullFaceMode.disabled,Be(N,l.Color.transparent,lt),"$debug",ut,kt,Pt,null,null,null,[H._globeTileDebugTextBuffer])}function _s(h,r,c,p){Xs(h,0,r+c/2,h.transform.width,c,p)}function fa(h,r,c,p){Xs(h,r-c/2,0,c,h.transform.height,p)}function Xs(h,r,c,p,_,x){const C=h.context,A=C.gl;A.enable(A.SCISSOR_TEST),A.scissor(r*l.exported.devicePixelRatio,c*l.exported.devicePixelRatio,p*l.exported.devicePixelRatio,_*l.exported.devicePixelRatio),C.clear({color:x}),A.disable(A.SCISSOR_TEST)}const va=l.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:bl}=va;function Ks(h,r,c,p){h.emplaceBack(r,c,p)}class Vs{constructor(r){this.vertexArray=new l.StructArrayLayout3f12,this.indices=new l.StructArrayLayout3ui6,Ks(this.vertexArray,-1,-1,1),Ks(this.vertexArray,1,-1,1),Ks(this.vertexArray,-1,1,1),Ks(this.vertexArray,1,1,1),Ks(this.vertexArray,-1,-1,-1),Ks(this.vertexArray,1,-1,-1),Ks(this.vertexArray,-1,1,-1),Ks(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,bl),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=l.SegmentVector.simpleSegment(0,0,36,12)}}function F(h,r,c,p,_,x){const C=h.gl,A=r.paint.get("sky-atmosphere-color"),N=r.paint.get("sky-atmosphere-halo-color"),G=r.paint.get("sky-atmosphere-sun-intensity"),H={u_matrix_3f:l.fromMat4(l.create$1(),p),u_sun_direction:_,u_sun_intensity:G,u_color_tint_r:[(Ie=A).r,Ie.g,Ie.b,Ie.a],u_color_tint_m:[(Ce=N).r,Ce.g,Ce.b,Ce.a],u_luminance:5e-5};var Ie,Ce;C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+x,r.skyboxTexture,0),c.draw(h,C.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.frontCW,H,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const X=l.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ye{constructor(r){const c=new l.StructArrayLayout5f20;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const p=new l.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(c,X.members),this.indexBuffer=r.createIndexBuffer(p),this.segments=l.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const j={symbol:function(h,r,c,p,_){if("translucent"!==h.renderPass)return;const x=l.StencilMode.disabled,C=h.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(A,N,G,H,ie,pe,be){const Ie=N.transform,Ce="map"===ie,ke="map"===pe;for(const re of A){const we=H.getTile(re),ze=we.getBucket(G);if(!ze||!ze.text||!ze.text.segments.get().length)continue;const $e=l.evaluateSizeForZoom(ze.textSizeData,Ie.zoom),lt=an(re,ze.getProjection(),Ie),ct=Ie.calculatePixelsToTileUnitsMatrix(we),ut=Gt(lt,we.tileID.canonical,ke,Ce,Ie,ze.getProjection(),ct),kt="none"!==G.layout.get("icon-text-fit")&&ze.hasIconData();if($e){const Pt=Math.pow(2,Ie.zoom-we.tileID.overscaledZ);gi(ze,Ce,ke,be,l.symbolSize,Ie,ut,re,Pt,$e,kt)}}}(p,h,c,r,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),_),0!==c.paint.get("icon-opacity").constantOr(1)&&mr(h,r,c,p,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),x,C),0!==c.paint.get("text-opacity").constantOr(1)&&mr(h,r,c,p,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),x,C),r.map.showCollisionBoxes&&(gt(h,r,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),gt(h,r,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(h,r,c,p){if("translucent"!==h.renderPass)return;const _=c.paint.get("circle-opacity"),x=c.paint.get("circle-stroke-width"),C=c.paint.get("circle-stroke-opacity"),A=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===_.constantOr(1)&&(0===x.constantOr(1)||0===C.constantOr(1)))return;const N=h.context,G=N.gl,H=h.transform,ie=h.depthModeForSublayer(0,l.DepthMode.ReadOnly),pe=l.StencilMode.disabled,be=h.colorModeForRenderPass(),Ie="globe"===H.projection.name,Ce=[l.mercatorXfromLng(H.center.lng),l.mercatorYfromLat(H.center.lat)],ke=[];for(let we=0;we<p.length;we++){const ze=p[we],$e=r.getTile(ze),lt=$e.getBucket(c);if(!lt||lt.projection.name!==H.projection.name)continue;const ct=lt.programConfigurations.get(c.id),ut=xe(c);Ie&&ut.push("PROJECTION_GLOBE_VIEW");const kt=h.useProgram("circle",ct,ut),Pt=lt.layoutVertexBuffer,qt=lt.globeExtVertexBuffer,Fn=lt.indexBuffer,Ut=H.projection.createInversionMatrix(H,ze.canonical),gn={programConfiguration:ct,program:kt,layoutVertexBuffer:Pt,globeExtVertexBuffer:qt,indexBuffer:Fn,uniformValues:Z(h,ze,$e,Ut,Ce,c),tile:$e};if(A){const Jt=lt.segments.get();for(const Rn of Jt)ke.push({segments:new l.SegmentVector([Rn]),sortKey:Rn.sortKey,state:gn})}else ke.push({segments:lt.segments,sortKey:0,state:gn})}A&&ke.sort((we,ze)=>we.sortKey-ze.sortKey);const re={useDepthForOcclusion:!Ie};for(const we of ke){const{programConfiguration:ze,program:$e,layoutVertexBuffer:lt,globeExtVertexBuffer:ct,indexBuffer:ut,uniformValues:kt,tile:Pt}=we.state,qt=we.segments;h.terrain&&h.terrain.setupElevationDraw(Pt,$e,re),h.prepareDrawProgram(N,$e,Pt.tileID.toUnwrapped()),$e.draw(N,G.TRIANGLES,ie,pe,be,l.CullFaceMode.disabled,kt,c.id,lt,ut,qt,c.paint,H.zoom,ze,[ct])}},heatmap:function(h,r,c,p){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===h.renderPass){const _=h.context,x=_.gl,C=l.StencilMode.disabled,A=new l.ColorMode([x.ONE,x.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(be,Ie,Ce,ke){const re=be.gl,we=Ie.width*ke,ze=Ie.height*ke;be.activeTexture.set(re.TEXTURE1),be.viewport.set([0,0,we,ze]);let $e=Ce.heatmapFbo;if(!$e||$e&&($e.width!==we||$e.height!==ze)){$e&&$e.destroy();const lt=re.createTexture();re.bindTexture(re.TEXTURE_2D,lt),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MAG_FILTER,re.LINEAR),$e=Ce.heatmapFbo=be.createFramebuffer(we,ze,!1),function(ct,ut,kt,Pt,qt,Fn){const Ut=ct.gl;Ut.texImage2D(Ut.TEXTURE_2D,0,ct.isWebGL2&&ct.extRenderToTextureHalfFloat?Ut.RGBA16F:Ut.RGBA,qt,Fn,0,Ut.RGBA,ct.extRenderToTextureHalfFloat?ct.isWebGL2?Ut.HALF_FLOAT:ct.extTextureHalfFloat.HALF_FLOAT_OES:Ut.UNSIGNED_BYTE,null),Pt.colorAttachment.set(kt)}(be,0,lt,$e,we,ze)}else re.bindTexture(re.TEXTURE_2D,$e.colorAttachment.get()),be.bindFramebuffer.set($e.framebuffer)})(_,h,c,"globe"===h.transform.projection.name?.5:.25),_.clear({color:l.Color.transparent});const N=h.transform,G="globe"===N.projection.name,H=G?["PROJECTION_GLOBE_VIEW"]:null,ie=G?l.CullFaceMode.frontCCW:l.CullFaceMode.disabled,pe=[l.mercatorXfromLng(N.center.lng),l.mercatorYfromLat(N.center.lat)];for(let be=0;be<p.length;be++){const Ie=p[be];if(r.hasRenderableParent(Ie))continue;const Ce=r.getTile(Ie),ke=Ce.getBucket(c);if(!ke||ke.projection.name!==N.projection.name)continue;const re=ke.programConfigurations.get(c.id),we=h.useProgram("heatmap",re,H),{zoom:ze}=h.transform;h.terrain&&h.terrain.setupElevationDraw(Ce,we),h.prepareDrawProgram(_,we,Ie.toUnwrapped());const $e=N.projection.createInversionMatrix(N,Ie.canonical);we.draw(_,x.TRIANGLES,l.DepthMode.disabled,C,A,ie,zi(h,Ie,Ce,$e,pe,ze,c.paint.get("heatmap-intensity")),c.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,c.paint,h.transform.zoom,re,G?[ke.globeExtVertexBuffer]:null)}_.viewport.set([0,0,h.width,h.height])}else"translucent"===h.renderPass&&(h.context.setColorMode(h.colorModeForRenderPass()),function(_,x){const C=_.context,A=C.gl,N=x.heatmapFbo;if(!N)return;C.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,N.colorAttachment.get()),C.activeTexture.set(A.TEXTURE1);let G=x.colorRampTexture;G||(G=x.colorRampTexture=new l.Texture(C,x.colorRamp,A.RGBA)),G.bind(A.LINEAR,A.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(C,A.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,_.colorModeForRenderPass(),l.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:x.paint.get("heatmap-opacity")},x.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,x.paint,_.transform.zoom)}(h,c))},line:function(h,r,c,p){if("translucent"!==h.renderPass)return;const _=c.paint.get("line-opacity"),x=c.paint.get("line-width");if(0===_.constantOr(1)||0===x.constantOr(1))return;const C=h.depthModeForSublayer(0,l.DepthMode.ReadOnly),A=h.colorModeForRenderPass(),N=h.terrain&&h.terrain.renderingToTexture?1:l.exported.devicePixelRatio,G=c.paint.get("line-dasharray"),H=G.constantOr(1),ie=c.layout.get("line-cap"),pe=c.paint.get("line-pattern"),be=pe.constantOr(1),Ie=c.paint.get("line-gradient"),Ce=be?"linePattern":"line",ke=h.context,re=ke.gl,we=($e=>{const lt=[];ya($e)&&lt.push("RENDER_LINE_DASH"),$e.paint.get("line-gradient")&&lt.push("RENDER_LINE_GRADIENT");const ct=$e.paint.get("line-trim-offset");0===ct[0]&&0===ct[1]||lt.push("RENDER_LINE_TRIM_OFFSET");const ut=$e.paint.get("line-pattern").constantOr(1),kt=1!==$e.paint.get("line-opacity").constantOr(1);return!ut&&kt&&lt.push("RENDER_LINE_ALPHA_DISCARD"),lt})(c);let ze=we.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(ze=!1);for(const $e of p){const lt=r.getTile($e);if(be&&!lt.patternsLoaded())continue;const ct=lt.getBucket(c);if(!ct)continue;h.prepareDrawTile();const ut=ct.programConfigurations.get(c.id),kt=h.useProgram(Ce,ut,we),Pt=pe.constantOr(null);if(Pt&&lt.imageAtlas){const vn=lt.imageAtlas.patternPositions[Pt.toString()];vn&&ut.setConstantPatternPositions(vn)}const qt=G.constantOr(null),Fn=ie.constantOr(null);if(!be&&qt&&Fn&&lt.lineAtlas){const vn=lt.lineAtlas.getDash(qt,Fn);vn&&ut.setConstantPatternPositions(vn)}let[Ut,gn]=c.paint.get("line-trim-offset");("round"===Fn||"square"===Fn)&&Ut!==gn&&(0===Ut&&(Ut-=1),1===gn&&(gn+=1));const Jt=h.terrain?$e.projMatrix:null,Rn=be?ws(h,lt,c,Jt,N):ns(h,lt,c,Jt,ct.lineClipsArray.length,N,[Ut,gn]);if(Ie){const vn=ct.gradients[c.id];let kn=vn.texture;if(c.gradientVersion!==vn.version){let Mn=256;if(c.stepInterpolant){const Vn=r.getSource().maxzoom,Ei=$e.canonical.z===Vn?Math.ceil(1<<h.transform.maxZoom-$e.canonical.z):1;Mn=l.clamp(l.nextPowerOfTwo(ct.maxLineLength/l.EXTENT*1024*Ei),256,ke.maxTextureSize)}vn.gradient=l.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Mn,image:vn.gradient||void 0,clips:ct.lineClipsArray}),vn.texture?vn.texture.update(vn.gradient):vn.texture=new l.Texture(ke,vn.gradient,re.RGBA),vn.version=c.gradientVersion,kn=vn.texture}ke.activeTexture.set(re.TEXTURE1),kn.bind(c.stepInterpolant?re.NEAREST:re.LINEAR,re.CLAMP_TO_EDGE)}H&&(ke.activeTexture.set(re.TEXTURE0),lt.lineAtlasTexture.bind(re.LINEAR,re.REPEAT),ut.updatePaintBuffers()),be&&(ke.activeTexture.set(re.TEXTURE0),lt.imageAtlasTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE),ut.updatePaintBuffers()),h.prepareDrawProgram(ke,kt,$e.toUnwrapped());const jt=vn=>{kt.draw(ke,re.TRIANGLES,C,vn,A,l.CullFaceMode.disabled,Rn,c.id,ct.layoutVertexBuffer,ct.indexBuffer,ct.segments,c.paint,h.transform.zoom,ut,[ct.layoutVertexBuffer2])};if(ze){const vn=h.stencilModeForClipping($e).ref;0===vn&&h.terrain&&ke.clear({stencil:0});const kn={func:re.EQUAL,mask:255};Rn.u_alpha_discard_threshold=.8,jt(new l.StencilMode(kn,vn,255,re.KEEP,re.KEEP,re.INVERT)),Rn.u_alpha_discard_threshold=0,jt(new l.StencilMode(kn,vn,255,re.KEEP,re.KEEP,re.KEEP))}else jt(h.stencilModeForClipping($e))}ze&&(h.resetStencilClippingMasks(),h.terrain&&ke.clear({stencil:0}))},fill:function(h,r,c,p){const _=c.paint.get("fill-color"),x=c.paint.get("fill-opacity");if(0===x.constantOr(1))return;const C=h.colorModeForRenderPass(),A=c.paint.get("fill-pattern"),N=h.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===_.constantOr(l.Color.transparent).a&&1===x.constantOr(0)?"opaque":"translucent";if(h.renderPass===N){const G=h.depthModeForSublayer(1,"opaque"===h.renderPass?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly);Oi(h,r,c,p,G,C,!1)}if("translucent"===h.renderPass&&c.paint.get("fill-antialias")){const G=h.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,l.DepthMode.ReadOnly);Oi(h,r,c,p,G,C,!0)}},"fill-extrusion":function(h,r,c,p){const _=c.paint.get("fill-extrusion-opacity");if(0!==_&&"translucent"===h.renderPass){const x=new l.DepthMode(h.context.gl.LEQUAL,l.DepthMode.ReadWrite,h.depthRangeFor3D);if(1!==_||c.paint.get("fill-extrusion-pattern").constantOr(1))Vi(h,r,c,p,x,l.StencilMode.disabled,l.ColorMode.disabled),Vi(h,r,c,p,x,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const C=h.colorModeForRenderPass();Vi(h,r,c,p,x,l.StencilMode.disabled,C)}}},hillshade:function(h,r,c,p){if("offscreen"!==h.renderPass&&"translucent"!==h.renderPass)return;const _=h.context,x=h.depthModeForSublayer(0,l.DepthMode.ReadOnly),C=h.colorModeForRenderPass(),A=h.terrain&&h.terrain.renderingToTexture,[N,G]="translucent"!==h.renderPass||A?[{},p]:h.stencilConfigForOverlap(p);for(const H of G){const ie=r.getTile(H);if(ie.needsHillshadePrepare&&"offscreen"===h.renderPass)sa(h,ie,c,x,l.StencilMode.disabled,C);else if("translucent"===h.renderPass){const pe=A&&h.terrain?h.terrain.stencilModeForRTTOverlap(H):N[H.overscaledZ];oa(h,H,ie,c,x,pe,C)}}_.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,r,c,p,_,x){if("translucent"!==h.renderPass||0===c.paint.get("raster-opacity")||!p.length)return;const C=h.context,A=C.gl,N=r.getSource(),G=h.useProgram("raster"),H=h.colorModeForRenderPass(),ie=h.terrain&&h.terrain.renderingToTexture,[pe,be]=N instanceof wt||ie?[{},p]:h.stencilConfigForOverlap(p),Ie=be[be.length-1].overscaledZ,Ce=!h.options.moving;for(const ke of be){const re=ie?l.DepthMode.disabled:h.depthModeForSublayer(ke.overscaledZ-Ie,1===c.paint.get("raster-opacity")?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly,A.LESS),we=ke.toUnwrapped(),ze=r.getTile(ke);if(ie&&(!ze||!ze.hasData()))continue;const $e=ie?ke.projMatrix:h.transform.calculateProjMatrix(we,Ce),lt=h.terrain&&ie?h.terrain.stencilModeForRTTOverlap(ke):pe[ke.overscaledZ],ct=x?0:c.paint.get("raster-fade-duration");ze.registerFadeDuration(ct);const ut=r.findLoadedParent(ke,0),kt=Bo(ze,ut,r,h.transform,ct);let Pt,qt;h.terrain&&h.terrain.prepareDrawTile();const Fn="nearest"===c.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;C.activeTexture.set(A.TEXTURE0),ze.texture.bind(Fn,A.CLAMP_TO_EDGE),C.activeTexture.set(A.TEXTURE1),ut?(ut.texture.bind(Fn,A.CLAMP_TO_EDGE),Pt=Math.pow(2,ut.tileID.overscaledZ-ze.tileID.overscaledZ),qt=[ze.tileID.canonical.x*Pt%1,ze.tileID.canonical.y*Pt%1]):ze.texture.bind(Fn,A.CLAMP_TO_EDGE),ze.texture.useMipmap&&C.extTextureFilterAnisotropic&&h.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);const Ut=$a($e,qt||[0,0],Pt||1,kt,c,N instanceof wt?N.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(C,G,we),N instanceof wt)N.boundsBuffer&&N.boundsSegments&&G.draw(C,A.TRIANGLES,re,l.StencilMode.disabled,H,l.CullFaceMode.disabled,Ut,c.id,N.boundsBuffer,h.quadTriangleIndexBuffer,N.boundsSegments);else{const{tileBoundsBuffer:gn,tileBoundsIndexBuffer:Jt,tileBoundsSegments:Rn}=h.getTileBoundsBuffers(ze);G.draw(C,A.TRIANGLES,re,lt,H,l.CullFaceMode.disabled,Ut,c.id,gn,Jt,Rn)}}h.resetStencilClippingMasks()},background:function(h,r,c,p){const _=c.paint.get("background-color"),x=c.paint.get("background-opacity");if(0===x)return;const C=h.context,A=C.gl,N=h.transform,G=N.tileSize,H=c.paint.get("background-pattern");if(h.isPatternMissing(H))return;const ie=!H&&1===_.a&&1===x&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==ie)return;const pe=l.StencilMode.disabled,be=h.depthModeForSublayer(0,"opaque"===ie?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly),Ie=h.colorModeForRenderPass(),Ce=h.useProgram(H?"backgroundPattern":"background");let ke,re=p;re||(ke=h.getBackgroundTiles(),re=Object.values(ke).map(we=>we.tileID)),H&&(C.activeTexture.set(A.TEXTURE0),h.imageManager.bind(h.context));for(const we of re){const ze=we.toUnwrapped(),$e=p?we.projMatrix:h.transform.calculateProjMatrix(ze);h.prepareDrawTile();const lt=r?r.getTile(we):ke?ke[we.key]:new l.Tile(we,G,N.zoom,h),ct=H?ue($e,x,h,H,{tileID:we,tileSize:G}):W($e,x,_);h.prepareDrawProgram(C,Ce,ze);const{tileBoundsBuffer:ut,tileBoundsIndexBuffer:kt,tileBoundsSegments:Pt}=h.getTileBoundsBuffers(lt);Ce.draw(C,A.TRIANGLES,be,pe,Ie,l.CullFaceMode.disabled,ct,c.id,ut,kt,Pt)}},sky:function(h,r,c){const p=h.transform,_="mercator"===p.projection.name||"globe"===p.projection.name?1:l.smoothstep(7,8,p.zoom),x=c.paint.get("sky-opacity")*_;if(0===x)return;const C=h.context,A=c.paint.get("sky-type"),N=new l.DepthMode(C.gl.LEQUAL,l.DepthMode.ReadOnly,[0,1]),G=h.frameCounter/1e3%1;"atmosphere"===A?"offscreen"===h.renderPass?c.needsSkyboxCapture(h)&&(function(H,ie,pe,be){const Ie=H.context,Ce=Ie.gl;let ke=ie.skyboxFbo;if(!ke){ke=ie.skyboxFbo=Ie.createFramebuffer(32,32,!1),ie.skyboxGeometry=new Vs(Ie),ie.skyboxTexture=Ie.gl.createTexture(),Ce.bindTexture(Ce.TEXTURE_CUBE_MAP,ie.skyboxTexture),Ce.texParameteri(Ce.TEXTURE_CUBE_MAP,Ce.TEXTURE_WRAP_S,Ce.CLAMP_TO_EDGE),Ce.texParameteri(Ce.TEXTURE_CUBE_MAP,Ce.TEXTURE_WRAP_T,Ce.CLAMP_TO_EDGE),Ce.texParameteri(Ce.TEXTURE_CUBE_MAP,Ce.TEXTURE_MIN_FILTER,Ce.LINEAR),Ce.texParameteri(Ce.TEXTURE_CUBE_MAP,Ce.TEXTURE_MAG_FILTER,Ce.LINEAR);for(let $e=0;$e<6;++$e)Ce.texImage2D(Ce.TEXTURE_CUBE_MAP_POSITIVE_X+$e,0,Ce.RGBA,32,32,0,Ce.RGBA,Ce.UNSIGNED_BYTE,null)}Ie.bindFramebuffer.set(ke.framebuffer),Ie.viewport.set([0,0,32,32]);const re=ie.getCenter(H,!0),we=H.useProgram("skyboxCapture"),ze=new Float64Array(16);l.identity(ze),l.rotateY(ze,ze,.5*-Math.PI),F(Ie,ie,we,ze,re,0),l.identity(ze),l.rotateY(ze,ze,.5*Math.PI),F(Ie,ie,we,ze,re,1),l.identity(ze),l.rotateX(ze,ze,.5*-Math.PI),F(Ie,ie,we,ze,re,2),l.identity(ze),l.rotateX(ze,ze,.5*Math.PI),F(Ie,ie,we,ze,re,3),l.identity(ze),F(Ie,ie,we,ze,re,4),l.identity(ze),l.rotateY(ze,ze,Math.PI),F(Ie,ie,we,ze,re,5),Ie.viewport.set([0,0,H.width,H.height])}(h,c),c.markSkyboxValid(h)):"sky"===h.renderPass&&function(H,ie,pe,be,Ie){const Ce=H.context,ke=Ce.gl,re=H.transform,we=H.useProgram("skybox");Ce.activeTexture.set(ke.TEXTURE0),ke.bindTexture(ke.TEXTURE_CUBE_MAP,ie.skyboxTexture);const ze={u_matrix:re.skyboxMatrix,u_sun_direction:ie.getCenter(H,!1),u_cubemap:0,u_opacity:be,u_temporal_offset:Ie};H.prepareDrawProgram(Ce,we),we.draw(Ce,ke.TRIANGLES,pe,l.StencilMode.disabled,H.colorModeForRenderPass(),l.CullFaceMode.backCW,ze,"skybox",ie.skyboxGeometry.vertexBuffer,ie.skyboxGeometry.indexBuffer,ie.skyboxGeometry.segment)}(h,c,N,x,G):"gradient"===A&&"sky"===h.renderPass&&function(H,ie,pe,be,Ie){const Ce=H.context,ke=Ce.gl,re=H.transform,we=H.useProgram("skyboxGradient");ie.skyboxGeometry||(ie.skyboxGeometry=new Vs(Ce)),Ce.activeTexture.set(ke.TEXTURE0);let ze=ie.colorRampTexture;ze||(ze=ie.colorRampTexture=new l.Texture(Ce,ie.colorRamp,ke.RGBA)),ze.bind(ke.LINEAR,ke.CLAMP_TO_EDGE);const $e=(lt=re.skyboxMatrix,ct=ie.getCenter(H,!1),ut=ie.paint.get("sky-gradient-radius"),kt=be,Pt=Ie,{u_matrix:lt,u_color_ramp:0,u_center_direction:ct,u_radius:l.degToRad(ut),u_opacity:kt,u_temporal_offset:Pt});var lt,ct,ut,kt,Pt;H.prepareDrawProgram(Ce,we),we.draw(Ce,ke.TRIANGLES,pe,l.StencilMode.disabled,H.colorModeForRenderPass(),l.CullFaceMode.backCW,$e,"skyboxGradient",ie.skyboxGeometry.vertexBuffer,ie.skyboxGeometry.indexBuffer,ie.skyboxGeometry.segment)}(h,c,N,x,G)},debug:function(h,r,c){for(let p=0;p<c.length;p++)$s(h,r,c[p])},custom:function(h,r,c,p){const _=h.context,x=c.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||"offscreen"===h.renderPass)&&c.isLayerDraped()){if("offscreen"===h.renderPass){const C=x.prerender;if(C){if(h.setCustomLayerDefaults(),_.setColorMode(h.colorModeForRenderPass()),"globe"===h.transform.projection.name){const A=h.transform.pointMerc;C.call(x,_.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),l.globeToMercatorTransition(h.transform.zoom),[A.x,A.y],h.transform.pixelsPerMeterRatio)}else C.call(x,_.gl,h.transform.customLayerMatrix());_.setDirty(),h.setBaseState()}}else if("translucent"===h.renderPass){if(h.terrain&&h.terrain.renderingToTexture){const A=x.renderToTile;if(A){const N=p[0].canonical,G=new l.MercatorCoordinate(N.x+p[0].wrap*(1<<N.z),N.y,N.z);_.setDepthMode(l.DepthMode.disabled),_.setStencilMode(l.StencilMode.disabled),_.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),A.call(x,_.gl,G),_.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),_.setColorMode(h.colorModeForRenderPass()),_.setStencilMode(l.StencilMode.disabled);const C="3d"===x.renderingMode?new l.DepthMode(h.context.gl.LEQUAL,l.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,l.DepthMode.ReadOnly);if(_.setDepthMode(C),"globe"===h.transform.projection.name){const A=h.transform.pointMerc;x.render(_.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),l.globeToMercatorTransition(h.transform.zoom),[A.x,A.y],h.transform.pixelsPerMeterRatio)}else x.render(_.gl,h.transform.customLayerMatrix());_.setDirty(),h.setBaseState(),_.bindFramebuffer.set(null)}}else l.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class fe{constructor(r,c,p=!1){this.context=new bn(r,p),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=l.SourceCache.maxUnderzooming+l.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,c){const p=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new T(this,r));const _=this._terrain;this.transform.elevation=p?_:null,_.update(r,this.transform,c)}_updateFog(r){const c=r.fog;if(!c||"globe"===this.transform.projection.name||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,_]=c.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);const x=p+.78*(_-p);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,c){if(this.width=r*l.exported.devicePixelRatio,this.height=c*l.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const r=this.context,c=new l.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(l.EXTENT,0),c.emplaceBack(0,l.EXTENT),c.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(c,l.posAttributes.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const p=new l.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(l.EXTENT,0),p.emplaceBack(0,l.EXTENT),p.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=r.createVertexBuffer(p,l.posAttributes.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const _=new l.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(_,l.posAttributes.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const x=new l.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(l.EXTENT,0,l.EXTENT,0),x.emplaceBack(0,l.EXTENT,0,l.EXTENT),x.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(x,l.boundsAttributes.members),this.mercatorBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const C=new l.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(C);const A=new l.StructArrayLayout1ui2;for(const G of[0,1,3,2,0])A.emplaceBack(G);this.debugIndexBuffer=r.createIndexBuffer(A),this.emptyTexture=new l.Texture(r,new l.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=l.create();const N=this.context.gl;this.stencilClearMode=new l.StencilMode({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO),this.loadTimeStamps.push(l.window.performance.now()),this.atmosphereBuffer=new ye(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,c=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,c.TRIANGLES,l.DepthMode.disabled,this.stencilClearMode,l.ColorMode.disabled,l.CullFaceMode.disabled,jr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,c,p){if(!c||this.currentStencilSource===c.id||!r.isTileClipped()||!p||0===p.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const N of p)if(void 0===this._tileClippingMaskIDs[N.key]){A=!0;break}if(!A)return}this.currentStencilSource=c.id;const _=this.context,x=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(l.ColorMode.disabled),_.setDepthMode(l.DepthMode.disabled);const C=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of p){const N=c.getTile(A),G=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:H,tileBoundsIndexBuffer:ie,tileBoundsSegments:pe}=this.getTileBoundsBuffers(N);C.draw(_,x.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:x.ALWAYS,mask:0},G,255,x.KEEP,x.KEEP,x.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,jr(A.projMatrix),"$clipping",H,ie,pe)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,c=this.context.gl;return new l.StencilMode({func:c.NOTEQUAL,mask:255},r,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const c=this.context.gl;return new l.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(r){const c=this.context.gl,p=r.sort((C,A)=>A.overscaledZ-C.overscaledZ),_=p[p.length-1].overscaledZ,x=p[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const C={};for(let A=0;A<x;A++)C[A+_]=new l.StencilMode({func:c.GEQUAL,mask:255},A+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=x,[C,p]}return[{[_]:l.StencilMode.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new l.ColorMode([r.CONSTANT_COLOR,r.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?l.ColorMode.unblended:l.ColorMode.alphaBlended}depthModeForSublayer(r,c,p){if(!this.opaquePassEnabledForLayer())return l.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new l.DepthMode(p||this.context.gl.LEQUAL,c,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,c){this.style=r,this.options=c,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const p=this.style.order,_=this.style._sourceCaches;for(const G in _){const H=_[G];H.used&&H.prepare(this.context)}const x={},C={},A={};for(const G in _){const H=_[G];x[G]=H.getVisibleCoordinates(),C[G]=x[G].slice().reverse(),A[G]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let G=0;G<p.length;G++)if(this.style._layers[p[G]].is3D()){this.opaquePassCutoff=G;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new l.GlobeSharedBuffers(this.context)),!l.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const G of p){const H=this.style._layers[G],ie=r._getLayerSourceCache(H);if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const pe=ie?C[ie.id]:void 0;("custom"===H.type||H.isSky()||pe&&pe.length)&&this.renderLayer(this,ie,H,pe)}this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon];const N=this.terrain;if(N&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&N.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:c.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const G=this.style._layers[p[this.currentLayer]],H=r._getLayerSourceCache(G);if(G.isSky())continue;const ie=H?C[H.id]:void 0;this._renderTileClippingMasks(G,H,ie),this.renderLayer(this,H,G,ie)}if(this.style.fog&&this.transform.projection.supportsFog&&function(G,H){const ie=G.context,pe=ie.gl,be=G.transform,Ie=new l.DepthMode(pe.LEQUAL,l.DepthMode.ReadOnly,[0,1]),Ce=G.useProgram("globeAtmosphere",null,"globe"===be.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ke=l.globeToMercatorTransition(be.zoom),re=H.properties.get("color").toArray01(),we=H.properties.get("high-color").toArray01(),ze=H.properties.get("space-color").toArray01PremultipliedAlpha(),$e=l.identity$1([]);l.rotateY$1($e,$e,-l.degToRad(be._center.lng)),l.rotateX$1($e,$e,l.degToRad(be._center.lat)),l.rotateZ$1($e,$e,be.angle),l.rotateX$1($e,$e,-be._pitch);const lt=l.fromQuat(new Float32Array(16),$e),ct=l.mapValue(H.properties.get("star-intensity"),0,1,0,.25),kt=l.mapValue(H.properties.get("horizon-blend"),0,1,5e-4,.25),Pt=l.globeUseCustomAntiAliasing(G,ie,be)&&5e-4===kt?be.worldSize/(2*Math.PI*1.025)-1:be.globeRadius,qt=G.frameCounter/1e3%1,Fn=l.length(be.globeCenterInViewSpace),Ut=Math.sqrt(Math.pow(Fn,2)-Math.pow(Pt,2)),gn=Math.acos(Ut/Fn),Jt={u_frustum_tl:be.frustumCorners.TL,u_frustum_tr:be.frustumCorners.TR,u_frustum_br:be.frustumCorners.BR,u_frustum_bl:be.frustumCorners.BL,u_horizon:be.frustumCorners.horizon,u_transition:ke,u_fadeout_range:kt,u_color:re,u_high_color:we,u_space_color:ze,u_star_intensity:ct,u_star_size:5*l.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:qt,u_horizon_angle:gn,u_rotation_matrix:lt};G.prepareDrawProgram(ie,Ce);const Rn=G.atmosphereBuffer;Rn&&Ce.draw(ie,pe.TRIANGLES,Ie,l.StencilMode.disabled,l.ColorMode.alphaBlended,l.CullFaceMode.backCW,Jt,"skybox",Rn.vertexBuffer,Rn.indexBuffer,Rn.segments)}(this,this.style.fog),this.renderPass="sky",(l.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const G=this.style._layers[p[this.currentLayer]],H=r._getLayerSourceCache(G);G.isSky()&&this.renderLayer(this,H,G,H?C[H.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const G=this.style._layers[p[this.currentLayer]],H=r._getLayerSourceCache(G);if(G.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(G)){if(G.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const ie=H?("symbol"===G.type?A:C)[H.id]:void 0;this._renderTileClippingMasks(G,H,H?x[H.id]:void 0),this.renderLayer(this,H,G,ie),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let G=null;l.values(this.style._layers).forEach(H=>{const ie=r._getLayerSourceCache(H);ie&&!H.isHidden(this.transform.zoom)&&(!G||G.getSource().maxzoom<ie.getSource().maxzoom)&&(G=ie)}),G&&this.options.showTileBoundaries&&j.debug(this,G,G.getVisibleCoordinates())}this.options.showPadding&&function(G){const H=G.transform.padding;_s(G,G.transform.height-(H.top||0),3,xo),_s(G,H.bottom||0,3,as),fa(G,H.left||0,3,Ds),fa(G,G.transform.width-(H.right||0),3,Wo);const ie=G.transform.centerPoint;var pe,be,Ie,Ce;Xs(pe=G,(be=ie.x)-1,(Ie=G.transform.height-ie.y)-10,2,20,Ce=cl),Xs(pe,be-10,Ie-1,20,2,Ce)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(l.window.performance.now()),this.saveCanvasCopy())}renderLayer(r,c,p,_){p.isHidden(this.transform.zoom)||("background"===p.type||"sky"===p.type||"custom"===p.type||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),(!r.transform.projection.unsupportedLayers||!r.transform.projection.unsupportedLayers.includes(p.type)||r.terrain&&"custom"===p.type)&&j[p.type](r,c,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let p=this.gpuTimers[r.id];p||(p=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),p.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,c=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(c),r.beginQueryEXT(r.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const c={};for(const p in r){const _=r[p],x=this.context.extTimerQuery,C=x.getQueryObjectEXT(_.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(_.query),c[p]=C}return c}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery;let p=0;for(const _ of r)p+=c.getQueryObjectEXT(_,c.QUERY_RESULT_EXT)/1e6,c.deleteQueryEXT(_);return p}translatePosMatrix(r,c,p,_,x){if(!p[0]&&!p[1])return r;const C=x?"map"===_?this.transform.angle:0:"viewport"===_?-this.transform.angle:0;if(C){const G=Math.sin(C),H=Math.cos(C);p=[p[0]*H-p[1]*G,p[0]*G+p[1]*H]}const A=[x?p[0]:li(c,p[0],this.transform.zoom),x?p[1]:li(c,p[1],this.transform.zoom),0],N=new Float32Array(16);return l.translate(N,r,A),N}saveTileTexture(r){const c=this._tileTextures[r.size[0]];c?c.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const c=this._tileTextures[r];return c&&c.length>0?c.pop():null}isPatternMissing(r){return null===r||void 0!==r&&!this.imageManager.getPattern(r.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,c=this.terrain&&0===this.terrain.exaggeration(),p=this.style&&this.style.fog,_=[];return this.terrainRenderModeElevated()&&_.push("TERRAIN"),"globe"===this.transform.projection.name&&_.push("GLOBE"),c&&_.push("ZERO_EXAGGERATION"),p&&!r&&0!==p.getOpacity(this.transform.pitch)&&_.push("FOG"),r&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(r,c,p){this.cache=this.cache||{};const _=p||[],x=this.currentGlobalDefines().concat(_),C=K.cacheKey(bs[r],r,x,c);return this.cache[C]||(this.cache[C]=new K(this.context,r,bs[r],c,Se[r],x)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=l.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,c,p){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const x=_.getOpacity(this.transform.pitch),C=((A,N,G,H,ie,pe,be,Ie,Ce,ke,re)=>{const we=A.transform,ze=N.properties.get("color").toArray01();ze[3]=H;const $e=A.frameCounter/1e3%1;return{u_fog_matrix:G?we.calculateFogTileMatrix(G):A.identityMat,u_fog_range:N.getFovAdjustedRange(we._fov),u_fog_color:ze,u_fog_horizon_blend:N.properties.get("horizon-blend"),u_fog_temporal_offset:$e,u_frustum_tl:ie,u_frustum_tr:pe,u_frustum_br:be,u_frustum_bl:Ie,u_globe_pos:Ce,u_globe_radius:ke,u_viewport:re,u_globe_transition:l.globeToMercatorTransition(we.zoom),u_is_globe:+("globe"===we.projection.name)}})(this,_,p,x,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*l.exported.devicePixelRatio,this.transform.height*l.exported.devicePixelRatio]);c.setFogUniformValues(r,C)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,c=r.createTexture();return r.bindTexture(r.TEXTURE_2D,c),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}getBackgroundTiles(){const r=this._backgroundTiles,c=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const _ of p)c[_.key]=r[_.key]||new l.Tile(_,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class Xe{constructor(r=0,c=0,p=0,_=0){if(isNaN(r)||r<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=c,this.left=p,this.right=_}interpolate(r,c,p){return null!=c.top&&null!=r.top&&(this.top=l.number(r.top,c.top,p)),null!=c.bottom&&null!=r.bottom&&(this.bottom=l.number(r.bottom,c.bottom,p)),null!=c.left&&null!=r.left&&(this.left=l.number(r.left,c.left,p)),null!=c.right&&null!=r.right&&(this.right=l.number(r.right,c.right,p)),this}getCenter(r,c){const p=l.clamp((this.left+r-this.right)/2,0,r),_=l.clamp((this.top+c-this.bottom)/2,0,c);return new l.Point(p,_)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Xe(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function rn(h,r){const c=l.getColumn(h,3);l.fromQuat(h,r),l.setColumn(h,3,c)}function _n(h,r){const c=l.identity$1([]);return l.rotateZ$1(c,c,-r),l.rotateX$1(c,c,-h),c}function ki(h,r){const c=[h[0],h[1],0],p=[r[0],r[1],0];if(l.length(c)>=1e-15){const C=l.normalize([],c);l.scale$2(p,C,l.dot(p,C)),r[0]=p[0],r[1]=p[1]}const _=l.cross([],r,h);if(l.len(_)<1e-15)return null;const x=Math.atan2(-_[1],_[0]);return _n(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),x)}class Gi{constructor(r,c){this.position=r,this.orientation=c}get position(){return this._position}set position(r){if(r){const c=r instanceof l.MercatorCoordinate?r:new l.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(c.x=l.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(r,c){if(this.orientation=null,!this.position)return;const p=this.position,_=this._elevation?this._elevation.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(r)):0,x=l.MercatorCoordinate.fromLngLat(r,_),C=[x.x-p.x,x.y-p.y,x.z-p.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=ki(C,c)}setPitchBearing(r,c){this.orientation=_n(l.degToRad(r),l.degToRad(-c))}}class Mi{constructor(r,c){this._transform=l.identity([]),this.orientation=c,this.position=r}get mercatorPosition(){const r=this.position;return new l.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=l.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var c;r&&l.setColumn(this._transform,3,[(c=r)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||l.identity$1([]),r&&rn(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,c){this._orientation=_n(r,c),rn(this._transform,this._orientation)}forward(){const r=l.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=l.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=l.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,c){const p=new Float64Array(16);return l.invert(p,this.getWorldToCamera(r,c)),p}getWorldToCameraPosition(r,c,p){const _=this.position;l.scale$2(_,_,-r);const x=new Float64Array(16);return l.fromScaling(x,[p,p,p]),l.translate(x,x,_),x[10]*=c,x}getWorldToCamera(r,c){const p=new Float64Array(16),_=new Float64Array(4),x=this.position;return l.conjugate(_,this._orientation),l.scale$2(x,x,-r),l.fromQuat(p,_),l.translate(p,p,x),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=c,p[9]*=c,p[10]*=c,p[11]*=c,p}getCameraToClipPerspective(r,c,p,_){const x=new Float64Array(16);return l.perspective(x,r,c,p,_),x}getDistanceToElevation(r,c=!1){const p=0===r?0:l.mercatorZfromAltitude(r,c?l.latFromMercatorY(this.position[1]):this.position[1]),_=this.forward();return(p-this.position[2])/_[2]}clone(){return new Mi([...this.position],[...this.orientation])}}function Qi(h,r){const c=Xi(h.projection,h.zoom,h.width,h.height),p=function(x,C,A,N,G){const H=new l.LngLat(A.lng-180*wr,A.lat),ie=new l.LngLat(A.lng+180*wr,A.lat),pe=x.project(H.lng,H.lat),be=x.project(ie.lng,ie.lat),Ie=-Math.atan2(be.y-pe.y,be.x-pe.x),Ce=l.MercatorCoordinate.fromLngLat(A);Ce.y=l.clamp(Ce.y,-1+wr,1-wr);const ke=Ce.toLngLat(),re=x.project(ke.lng,ke.lat),we=l.MercatorCoordinate.fromLngLat(ke);we.x+=wr;const ze=we.toLngLat(),$e=x.project(ze.lng,ze.lat),lt=qo($e.x-re.x,$e.y-re.y,Ie),ct=l.MercatorCoordinate.fromLngLat(ke);ct.y+=wr;const ut=ct.toLngLat(),kt=x.project(ut.lng,ut.lat),Pt=qo(kt.x-re.x,kt.y-re.y,Ie),qt=Math.abs(lt.x)/Math.abs(Pt.y),Fn=l.identity([]);l.rotateZ(Fn,Fn,-Ie*(1-(G?0:N)));const Ut=l.identity([]);return l.scale(Ut,Ut,[1,1-(1-qt)*N,1]),Ut[4]=-Pt.x/Pt.y*N,l.rotateZ(Ut,Ut,Ie),l.multiply(Ut,Fn,Ut),Ut}(h.projection,0,h.center,c,r),_=Zi(h);return l.scale(p,p,[_,_,1]),p}function Zi(h){const r=h.projection,c=Xi(h.projection,h.zoom,h.width,h.height),p=Mr(r,h.center),_=Mr(r,l.LngLat.convert(r.center));return Math.pow(2,p*c+(1-c)*_)}function Xi(h,r,c,p,_=1/0){const x=h.range;if(!x)return 0;const C=Math.min(_,Math.max(c,p)),A=Math.log(C/1024)/Math.LN2;return l.smoothstep(x[0]+A,x[1]+A,r)}const wr=1/4e4;function Mr(h,r){const c=l.clamp(r.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),p=new l.LngLat(r.lng-180*wr,c),_=new l.LngLat(r.lng+180*wr,c),x=h.project(p.lng,c),C=h.project(_.lng,c),A=l.MercatorCoordinate.fromLngLat(p),N=l.MercatorCoordinate.fromLngLat(_),G=C.x-x.x,H=C.y-x.y,ie=N.x-A.x,pe=N.y-A.y,be=Math.sqrt((ie*ie+pe*pe)/(G*G+H*H));return Math.log(be)/Math.LN2}function qo(h,r,c){const p=Math.cos(c),_=Math.sin(c);return{x:h*p-r*_,y:h*_+r*p}}class Cs{constructor(r,c,p,_,x,C,A){this.tileSize=512,this._renderWorldCopies=void 0===x||x,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=_??60,this.setProjection(C),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Xe,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Mi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new Cs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r,c=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||p)&&this._updateCameraOnTerrain(),(r||p)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return l.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=l.getProjection(this.projectionOptions);const p=!Me(c,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=l.getProjection({name:"mercator"});const c=r!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return l.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.Point(this.width,this.height)}get bearing(){return l.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const c=-r*Math.PI/180;var p,_,x,C,A,N,G,H,ie,pe;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(p=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),_=this.rotationMatrix,C=this.angle,A=(x=this.rotationMatrix)[0],N=x[1],G=x[2],H=x[3],ie=Math.sin(C),pe=Math.cos(C),_[0]=A*pe+G*ie,_[1]=N*pe+H*ie,_[2]=A*-ie+G*pe,_[3]=N*-ie+H*pe)}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const c=l.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=l.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const c=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let _=0,x=0;for(let C=0;C<c.length;C++){const A=new l.Point(c[C][0]*this.width,p+c[C][1]*(this.height-p)),N=r.pointCoordinate(A);if(!N)continue;const G=1/Math.hypot(N[0]-this._camera.position[0],N[1]-this._camera.position[1]);_+=N[3]*G,x+=G}return 0===x?NaN:_/x}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const r=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*c,_=this._mercatorZfromZoom(r),x=this._mercatorZfromZoom(this._maxZoom),C=Math.max(_-p,x);this._setZoom(this._zoomFromMercatorZ(C))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let p;p=r.z<this._camera.position[2]?[c.x,c.y,c.z]:[r.x,r.y,r.z];const _=l.length(l.sub([],this._camera.position,p));return l.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let c=!1;if(r.orientation&&!l.exactEquals(r.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(r.orientation)),r.position){const p=[r.position.x,r.position.y,r.position.z];l.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,c=new Gi;return c.position=new l.MercatorCoordinate(r[0],r[1],r[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(r){if(!l.length$1(r))return!1;l.normalize$1(r,r);const c=l.transformQuat([],[0,0,-1],r),p=l.transformQuat([],[0,-1,0],r);if(p[2]<0)return!1;const _=ki(c,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(r){const c=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;r[2]=l.clamp(r[2],_/p,_/c),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,c,p){this._unmodified=!1,this._edgeInsets.interpolate(r,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const c=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(r){const c=[new l.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const p=this.pointCoordinate(new l.Point(0,0)),_=this.pointCoordinate(new l.Point(this.width,0)),x=this.pointCoordinate(new l.Point(this.width,this.height)),C=this.pointCoordinate(new l.Point(0,this.height)),A=Math.floor(Math.min(p.x,_.x,x.x,C.x)),N=Math.floor(Math.max(p.x,_.x,x.x,C.x)),G=1;for(let H=A-G;H<=N+G;H++)0!==H&&c.push(new l.UnwrappedTileID(H,r))}return c}coveringTiles(r){let c=this.coveringZoomLevel(r);const p=c,_=this.elevation&&!r.isTerrainDEM,x="mercator"===this.projection.name;if(void 0!==r.minzoom&&c<r.minzoom)return[];void 0!==r.maxzoom&&c>r.maxzoom&&(c=r.maxzoom);const C=this.locationCoordinate(this.center),A=this.center.lat,N=1<<c,G=[N*C.x,N*C.y,0],H="globe"===this.projection.name,ie=!H,pe=l.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,ie),be=H?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Ie=N*l.mercatorZfromAltitude(1,this.center.lat),Ce=this._camera.position[2]/l.mercatorZfromAltitude(1,this.center.lat),ke=[N*be.x,N*be.y,Ce*(ie?1:Ie)],re=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),we=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,ze=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,$e=r.isTerrainDEM?-ze:this._elevation?this._elevation.getMinElevationBelowMSL():0,lt=this.projection.isReprojectedInTileSpace?Zi(this):1,ct=jt=>{const kn=new l.MercatorCoordinate(jt.x+25e-6,jt.y,jt.z),Mn=new l.MercatorCoordinate(jt.x,jt.y+25e-6,jt.z),Vn=jt.toLngLat(),Ei=kn.toLngLat(),Ki=Mn.toLngLat(),di=this.locationCoordinate(Vn),Ri=this.locationCoordinate(Ei),_r=this.locationCoordinate(Ki),dr=Math.hypot(Ri.x-di.x,Ri.y-di.y),mi=Math.hypot(_r.x-di.x,_r.y-di.y);return Math.sqrt(dr*mi)*lt/25e-6},ut=jt=>{const vn=ze,kn=$e;return{aabb:l.tileAABB(this,N,0,0,0,jt,kn,vn,this.projection),zoom:0,x:0,y:0,minZ:kn,maxZ:vn,wrap:jt,fullyVisible:!1}},kt=[];let Pt=[];const qt=c,Fn=r.reparseOverscaled?p:c,Ut=jt=>jt*jt,gn=Ut((Ce-this._centerAltitude)*Ie),Jt=jt=>{if(!this._elevation||!jt.tileID||!x)return;const vn=this._elevation.getMinMaxForTile(jt.tileID),kn=jt.aabb;vn?(kn.min[2]=vn.min,kn.max[2]=vn.max,kn.center[2]=(kn.min[2]+kn.max[2])/2):(jt.shouldSplit=Rn(jt),jt.shouldSplit||(kn.min[2]=kn.max[2]=kn.center[2]=this._centerAltitude))},Rn=jt=>{if(jt.zoom<we)return!0;if(jt.zoom===qt)return!1;if(null!=jt.shouldSplit)return jt.shouldSplit;const vn=jt.aabb.distanceX(ke),kn=jt.aabb.distanceY(ke);let Mn=gn,Vn=1;if(H){Mn=Ut(jt.aabb.distanceZ(ke));const di=Math.pow(2,jt.zoom),Ri=l.latFromMercatorY((jt.y+1)/di),_r=l.latFromMercatorY(jt.y/di),dr=Math.min(Math.max(A,Ri),_r),mi=l.circumferenceAtLatitude(dr)/l.circumferenceAtLatitude(A);if(Vn=dr===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,mi/this._mercatorScaleRatio),this.zoom<=l.GLOBE_ZOOM_THRESHOLD_MIN&&jt.zoom===qt-1&&mi>=.9)return!0}else if(_&&(Mn=Ut(jt.aabb.distanceZ(ke)*Ie)),this.projection.isReprojectedInTileSpace&&p<=5){const di=Math.pow(2,jt.zoom),Ri=ct(new l.MercatorCoordinate((jt.x+.5)/di,(jt.y+.5)/di));Vn=Ri>.85?1:Ri}const Ei=vn*vn+kn*kn+Mn;return Ei<Ut((1<<qt-jt.zoom)*re*Vn*((di,Ri)=>{if(Ri*Ut(.707)<di)return 1;const _r=Math.sqrt(Ri/di);return _r/(1.4144271570014144+(Math.pow(1.1,_r-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Mn,gn),Ei))};if(this.renderWorldCopies)for(let jt=1;jt<=3;jt++)kt.push(ut(-jt)),kt.push(ut(jt));for(kt.push(ut(0));kt.length>0;){const jt=kt.pop(),vn=jt.x,kn=jt.y;let Mn=jt.fullyVisible;if(!Mn){const Vn=jt.aabb.intersects(pe);if(0===Vn)continue;Mn=2===Vn}if(jt.zoom!==qt&&Rn(jt))for(let Vn=0;Vn<4;Vn++){const Ei=(vn<<1)+Vn%2,Ki=(kn<<1)+(Vn>>1),di={aabb:x?jt.aabb.quadrant(Vn):l.tileAABB(this,N,jt.zoom+1,Ei,Ki,jt.wrap,jt.minZ,jt.maxZ,this.projection),zoom:jt.zoom+1,x:Ei,y:Ki,wrap:jt.wrap,fullyVisible:Mn,tileID:void 0,shouldSplit:void 0,minZ:jt.minZ,maxZ:jt.maxZ};_&&!H&&(di.tileID=new l.OverscaledTileID(jt.zoom+1===qt?Fn:jt.zoom+1,jt.wrap,jt.zoom+1,Ei,Ki),Jt(di)),kt.push(di)}else{const Vn=jt.zoom===qt?Fn:jt.zoom;if(r.minzoom&&r.minzoom>Vn)continue;const Ei=G[0]-(.5+vn+(jt.wrap<<jt.zoom))*(1<<c-jt.zoom),Ki=G[1]-.5-kn,di=jt.tileID?jt.tileID:new l.OverscaledTileID(Vn,jt.wrap,jt.zoom,vn,kn);Pt.push({tileID:di,distanceSq:Ei*Ei+Ki*Ki})}}if(this.fogCullDistSq){const jt=this.fogCullDistSq,vn=this.horizonLineFromTop();Pt=Pt.filter(kn=>{const Mn=[0,0,0,1],Vn=[l.EXTENT,l.EXTENT,0,1],Ei=this.calculateFogTileMatrix(kn.tileID.toUnwrapped());l.transformMat4$1(Mn,Mn,Ei),l.transformMat4$1(Vn,Vn,Ei);const Ki=l.getAABBPointSquareDist(Mn,Vn);if(0===Ki)return!0;let di=!1;const Ri=this._elevation;if(Ri&&Ki>jt&&0!==vn){const _r=this.calculateProjMatrix(kn.tileID.toUnwrapped());let dr;r.isTerrainDEM||(dr=Ri.getMinMaxForTile(kn.tileID)),dr||(dr={min:$e,max:ze});const mi=l.furthestTileCorner(this.rotation),Jr=[mi[0]*l.EXTENT,mi[1]*l.EXTENT,dr.max];l.transformMat4(Jr,Jr,_r),di=(1-Jr[1])*this.height*.5<vn}return Ki<jt||di})}return Pt.sort((jt,vn)=>jt.distanceSq-vn.distanceSq).map(jt=>jt.tileID)}resize(r,c){this.width=r,this.height=c,this.pixelsToGLUnits=[2/r,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const c=l.clamp(r.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),p=this.projection.project(r.lng,c);return new l.Point(p.x*this.worldSize,p.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/l.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,c){let p,_;const x=this.centerPoint;if("globe"===this.projection.name){const A=this.worldSize;p=(c.x-x.x)/A,_=(c.y-x.y)/A}else{const A=this.pointCoordinate(c),N=this.pointCoordinate(x);p=A.x-N.x,_=A.y-N.y}const C=this.locationCoordinate(r);this.setLocation(new l.MercatorCoordinate(C.x-p,C.y-_))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,c){const p=c?l.mercatorZfromAltitude(c,r.lat):void 0,_=this.projection.project(r.lng,r.lat);return new l.MercatorCoordinate(_.x,_.y,p)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,c){const p=c??this._centerAltitude,_=[r.x,r.y,0,1],x=[r.x,r.y,1,1];l.transformMat4$1(_,_,this.pixelMatrixInverse),l.transformMat4$1(x,x,this.pixelMatrixInverse);const C=x[3];l.scale$1(_,_,1/_[3]),l.scale$1(x,x,1/C);const A=_[2],N=x[2];return{p0:_,p1:x,t:A===N?0:(p-A)/(N-A)}}screenPointToMercatorRay(r){const c=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return l.transformMat4$1(c,c,this.pixelMatrixInverse),l.transformMat4$1(p,p,this.pixelMatrixInverse),l.scale$1(c,c,1/c[3]),l.scale$1(p,p,1/p[3]),c[2]=l.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,p[2]=l.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,l.scale$1(c,c,1/this.worldSize),l.scale$1(p,p,1/this.worldSize),new l.Ray([c[0],c[1],c[2]],l.normalize([],l.sub([],p,c)))}rayIntersectionCoordinate(r){const{p0:c,p1:p,t:_}=r,x=l.mercatorZfromAltitude(c[2],this._center.lat),C=l.mercatorZfromAltitude(p[2],this._center.lat);return new l.MercatorCoordinate(l.number(c[0],p[0],_)/this.worldSize,l.number(c[1],p[1],_)/this.worldSize,l.number(x,C,_))}pointCoordinate(r,c=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,c)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let c=this.projection.pointCoordinate3D(this,r.x,r.y);if(c)return new l.MercatorCoordinate(c[0],c[1],c[2]);let p=0,_=this.horizonLineFromTop();if(r.y>_)return this.pointCoordinate(r);const x=.02*_,C=r.clone();for(let A=0;A<10&&_-p>x;A++){C.y=l.number(p,_,.66);const N=this.projection.pointCoordinate3D(this,C.x,C.y);N?(_=C.y,c=N):p=C.y}return c?new l.MercatorCoordinate(c[0],c[1],c[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=l.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(r);const c=this.pointCoordinate(r);return c.y>=0&&c.y<=1}_coordinatePoint(r,c){const p=c&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,_=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return l.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new l.Point(_[0]/_[3],_[1]/_[3]):new l.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:c}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,x=this.pointLocation3D(new l.Point(c,r)),C=this.pointLocation3D(new l.Point(_,r)),A=this.pointLocation3D(new l.Point(_,p)),N=this.pointLocation3D(new l.Point(c,p));let G=Math.min(x.lng,C.lng,A.lng,N.lng),H=Math.max(x.lng,C.lng,A.lng,N.lng),ie=Math.min(x.lat,C.lat,A.lat,N.lat),pe=Math.max(x.lat,C.lat,A.lat,N.lat);const be=Math.pow(2,-this.zoom)/16*270,Ie="globe"===this.projection.name?1:4,Ce=(ke,re,we,ze,$e)=>{const lt=(ke+we)/2,ct=(re+ze)/2,ut=new l.Point(lt,ct),{lng:kt,lat:Pt}=this.pointLocation3D(ut),qt=Math.max(0,G-kt,ie-Pt,kt-H,Pt-pe);G=Math.min(G,kt),H=Math.max(H,kt),ie=Math.min(ie,Pt),pe=Math.max(pe,Pt),($e<Ie||qt>be)&&(Ce(ke,re,lt,ct,$e+1),Ce(lt,ct,we,ze,$e+1))};if(Ce(c,r,_,r,1),Ce(_,r,_,p,1),Ce(_,p,c,p,1),Ce(c,p,c,r,1),"globe"===this.projection.name){const[ke,re]=l.polesInViewport(this);ke?(pe=90,H=180,G=-180):re&&(ie=-90,H=180,G=-180)}return new l.LngLatBounds(new l.LngLat(G,ie),new l.LngLat(H,pe))}_getBoundsRectangular(r,c){const{top:p,left:_}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,C=this.width-this._edgeInsets.right,A=new l.Point(_,p),N=new l.Point(C,p),G=new l.Point(C,x),H=new l.Point(_,x);let ie=this.pointCoordinate(A,r),pe=this.pointCoordinate(N,r);const be=this.pointCoordinate(G,c),Ie=this.pointCoordinate(H,c),Ce=(ke,re)=>(re.y-ke.y)/(re.x-ke.x);return ie.y>1&&pe.y>=0?ie=new l.MercatorCoordinate((1-Ie.y)/Ce(Ie,ie)+Ie.x,1):ie.y<0&&pe.y<=1&&(ie=new l.MercatorCoordinate(-Ie.y/Ce(Ie,ie)+Ie.x,0)),pe.y>1&&ie.y>=0?pe=new l.MercatorCoordinate((1-be.y)/Ce(be,pe)+be.x,1):pe.y<0&&ie.y<=1&&(pe=new l.MercatorCoordinate(-be.y/Ce(be,pe)+be.x,0)),(new l.LngLatBounds).extend(this.coordinateLocation(ie)).extend(this.coordinateLocation(pe)).extend(this.coordinateLocation(Ie)).extend(this.coordinateLocation(be))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=r.visibleDemTiles.reduce((p,_)=>{if(_.dem){const x=_.dem.tree;p.min=Math.min(p.min,x.minimums[0]),p.max=Math.max(p.max,x.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*r.exaggeration(),c.max*r.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-c*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-l.MAX_MERCATOR_LATITUDE,this.maxLat=l.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=l.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=l.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=l.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=l.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,c){return this.projection.createTileMatrix(this,c,r)}calculateDistanceTileData(r){const c=r.key,p=this._distanceTileDataCache;if(p[c])return p[c];const _=r.canonical,x=1/this.height,C=this.cameraWorldSize,A=C/this.zoomScale(_.z),N=(_.x+Math.pow(2,_.z)*r.wrap)*A,G=_.y*A,H=this.point;H.x*=C/this.worldSize,H.y*=C/this.worldSize;const ie=this.angle,pe=Math.sin(-ie),be=-Math.cos(-ie);return p[c]={bearing:[pe,be],center:[(H.x-N)*x,(H.y-G)*x],scale:A/l.EXTENT*x},p[c]}calculateFogTileMatrix(r){const c=r.key,p=this._fogTileMatrixCache;if(p[c])return p[c];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return l.multiply(_,this.worldToFogMatrix,_),p[c]=new Float32Array(_),p[c]}calculateProjMatrix(r,c=!1){const p=r.key,_=c?this._alignedProjMatrixCache:this._projMatrixCache;if(_[p])return _[p];const x=this.calculatePosMatrix(r,this.worldSize);return l.multiply(x,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,x),_[p]=new Float32Array(x),_[p]}calculatePixelsToTileUnitsMatrix(r){const c=r.tileID.key,p=this._pixelsToTileUnitsCache;if(p[c])return p[c];const _=function(x,C){const{scale:A}=x.tileTransform,N=A*l.EXTENT/(x.tileSize*Math.pow(2,C.zoom-x.tileID.overscaledZ+x.tileID.canonical.z));return G=new Float32Array(4),pe=(H=C.inverseAdjustmentMatrix)[1],be=H[2],Ie=H[3],ke=(ie=[N,N])[1],G[0]=H[0]*(Ce=ie[0]),G[1]=pe*Ce,G[2]=be*ke,G[3]=Ie*ke,G;var G,H,ie,pe,be,Ie,Ce,ke}(r,this);return p[c]=_,p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const r=1/this.worldSize,c=l.fromScaling([],[r,r,r]);return l.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const r=this._elevation;this._updateCameraState();const c=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(c),_=this._camera.forward(),x=l.mercatorZfromAltitude(1,this._center.lat);p[2]/=x,_[2]/=x,l.normalize(_,_);const C=r.raycast(p,_,r.exaggeration());if(C){const A=l.scaleAndAdd([],p,_,C),N=new l.MercatorCoordinate(A[0],A[1],l.mercatorZfromAltitude(A[2],l.latFromMercatorY(A[1]))),G=(N.z+l.length([N.x-p[0],N.y-p[1],N.z-p[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(G),this._centerAltitude=N.toAltitude(),this._center=this.coordinateLocation(N),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const c=this._elevation,p=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(p),x=c.getAtPointOrZero(new l.MercatorCoordinate(..._)),C=this.pixelsPerMeter/this.worldSize*x,A=this._minimumHeightOverTerrain(),N=_[2]-C;if(N<=A)if(N<0||r){const G=this.locationCoordinate(this._center,this._centerAltitude),H=[_[0],_[1],G.z-_[2]],ie=l.length(H);H[2]-=(A-N)/this._pixelsPerMercatorPixel;const pe=l.length(H);if(0===pe)return;l.scale$2(H,H,ie/pe*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],G.z*this._pixelsPerMercatorPixel-H[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const pe=this.center;return pe.lat=l.clamp(pe.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(pe.lng=l.clamp(pe.lng,this.minLng,this.maxLng)),this.center=pe,void(this._constraining=!1)}const c=this._unmodified,{x:p,y:_}=this.point;let x=0,C=p,A=_;const N=this.width/2,G=this.height/2,H=this.worldMinY*this.scale,ie=this.worldMaxY*this.scale;if(_-G<H&&(A=H+G),_+G>ie&&(A=ie-G),ie-H<this.height&&(x=Math.max(x,this.height/(ie-H)),A=(ie+H)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const pe=this.worldMinX*this.scale,be=this.worldMaxX*this.scale,Ie=this.worldSize/2-(pe+be)/2;C=(p+Ie+this.worldSize)%this.worldSize-Ie,C-N<pe&&(C=pe+N),C+N>be&&(C=be-N),be-pe<this.width&&(x=Math.max(x,this.width/(be-pe)),C=(be+pe)/2)}C===p&&A===_||(this.center=this.unproject(new l.Point(C,A))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,c=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=l.mercatorZfromAltitude(1,this.center.lat)/l.mercatorZfromAltitude(1,l.GLOBE_SCALE_MATCH_LATITUDE));const p=Xi(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _="meters"===this.projection.zAxisUnit?c:1,x=this._camera.getWorldToCamera(this.worldSize,_),C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);C[8]=2*-r.x/this.width,C[9]=2*r.y/this.height;let A=l.mul([],C,x);if(this.projection.isReprojectedInTileSpace){const ct=this.locationCoordinate(this.center),ut=l.identity([]);l.translate(ut,ut,[ct.x*this.worldSize,ct.y*this.worldSize,0]),l.multiply(ut,ut,Qi(this)),l.translate(ut,ut,[-ct.x*this.worldSize,-ct.y*this.worldSize,0]),l.multiply(A,A,ut),this.inverseAdjustmentMatrix=function(kt){const Pt=Qi(kt,!0);return Fe([],[Pt[0],Pt[1],Pt[4],Pt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=l.scale([],A,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=A,this.invProjMatrix=l.invert(new Float64Array(16),this.projMatrix);const N=l.invert([],C);this.frustumCorners=l.FrustumCorners.fromInvProjectionMatrix(N,this.horizonLineFromTop(),this.height);const G=new Float32Array(16);l.identity(G),l.scale(G,G,[1,-1,1]),l.rotateX(G,G,this._pitch),l.rotateZ(G,G,this.angle);const H=l.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),ie=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;H[8]=2*-r.x/this.width,H[9]=2*(r.y+ie)/this.height,this.skyboxMatrix=l.multiply(G,H,G);const pe=this.point,be=pe.x,Ie=pe.y,Ce=this.width%2/2,ke=this.height%2/2,re=Math.cos(this.angle),we=Math.sin(this.angle),ze=be-Math.round(be)+re*Ce+we*ke,$e=Ie-Math.round(Ie)+re*ke+we*Ce,lt=new Float64Array(A);if(l.translate(lt,lt,[ze>.5?ze-1:ze,$e>.5?$e-1:$e,0]),this.alignedProjMatrix=lt,A=l.create(),l.scale(A,A,[this.width/2,-this.height/2,1]),l.translate(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=l.create(),l.scale(A,A,[1,-1,1]),l.translate(A,A,[-1,-1,0]),l.scale(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},A=l.invert(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=l.calculateGlobeMatrix(this);const ct=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=l.transformMat4(ct,ct,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,x=[r,r,c];l.scale$2(x,x,_),l.scale$2(p,p,-1),l.multiply$2(p,p,x);const C=l.create();l.translate(C,C,p),l.scale(C,C,x),this.mercatorFogMatrix=C,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,c,_)}_computeCameraPosition(r){const c=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-r/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*x,_.y/this.worldSize-p[1]*x,r/this.worldSize*this._centerAltitude-p[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],_=r[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(x=Math.min((c-p)/_,1)),this._camera.position=l.scaleAndAdd([],this._camera.position,r,x),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,c=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),x=l.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,C=this._mercatorZfromZoom(this._maxZoom)*Math.cos(l.degToRad(this._maxPitch)),A=Math.max((r[2]-x)/Math.cos(p),C),N=this._zoomFromMercatorZ(A);l.scaleAndAdd(r,r,c,A),this._pitch=l.clamp(p,l.degToRad(this.minPitch),l.degToRad(this.maxPitch)),this.angle=l.wrap(_,-Math.PI,Math.PI),this._setZoom(l.clamp(N,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new l.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let c=0,p=l.GLOBE_ZOOM_THRESHOLD_MAX,_=0,x=1/0;for(;p-c>1e-6&&p>c;){const C=c+.5*(p-c),A=this.tileSize*Math.pow(2,C),N=this.getCameraToCenterDistance(this.projection,C,A),G=this.scaleZoom(N/(r*this.tileSize)),H=Math.abs(C-G);H<x&&(x=H,_=C),C<G?c=C:p=C}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(l.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,c){const p=Math.min(r.x,c.x),_=Math.max(r.x,c.x),x=Math.min(r.y,c.y),C=Math.max(r.y,c.y);if(x<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const A=[new l.Point(p,x),new l.Point(_,C),new l.Point(p,C),new l.Point(_,x)],N=this.renderWorldCopies?-3:0,G=this.renderWorldCopies?4:1;for(const H of A){const ie=this.pointRayIntersection(H);if(ie.t<0)return!0;const pe=this.rayIntersectionCoordinate(ie);if(pe.x<N||pe.y<0||pe.x>G||pe.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+l.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new l.Point(0,0),new l.Point(this.width,this.height))}zoomDeltaToMovement(r,c){const p=l.length(l.sub([],this._camera.position,r)),_=this._zoomFromMercatorZ(p)+c;return p-this._mercatorZfromZoom(_)}getCameraPoint(){if("globe"===this.projection.name){const r=function([c,p,_],x){const C=[c,p,_,1];l.transformMat4$1(C,C,x);const A=C[3]=Math.max(C[3],1e-6);return C[0]/=A,C[1]/=A,C[2]/=A,C}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new l.Point(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.Point(0,r))}}getCameraToCenterDistance(r,c=this.zoom,p=this.worldSize){const _=Xi(r,c,this.width,this.height,1024),x=r.pixelSpaceConversion(this.center.lat,p,_);return.5/Math.tan(.5*this._fov)*this.height*x}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&l.multiply(r,r,this.globeMatrix),r}}function Yo(h,r){let c=!1,p=null;const _=()=>{p=null,c&&(h(),p=setTimeout(_,r),c=!1)};return()=>(c=!0,p||_(),p)}class Zo{constructor(r){this._hashName=r&&encodeURIComponent(r),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Yo(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,l.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),l.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const c=xa(r);if(this._hashName){const p=this._hashName;let _=!1;const x=l.window.location.hash.slice(1).split("&").map(C=>{const A=C.split("=")[0];return A===p?(_=!0,`${A}=${c}`):C}).filter(C=>C);return _||x.push(`${p}=${c}`),`#${x.join("&")}`}return`#${c}`}_getCurrentHash(){const r=l.window.location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(p=>isNaN(p))){const p=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(c[3]||0):r.getBearing();return r.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=l.window.location.href.replace(/(#.+)?$/,this.getHashString());l.window.history.replaceState(l.window.history.state,null,r)}}function xa(h,r){const c=h.getCenter(),p=Math.round(100*h.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),C=Math.round(c.lng*x)/x,A=Math.round(c.lat*x)/x,N=h.getBearing(),G=h.getPitch();let H=r?`/${C}/${A}/${p}`:`${p}/${A}/${C}`;return(N||G)&&(H+="/"+Math.round(10*N)/10),G&&(H+=`/${Math.round(G)}`),H}const Da={linearity:.3,easing:l.bezier(0,0,.3,1)},Js=l.extend({deceleration:2500,maxSpeed:1400},Da),Pa=l.extend({deceleration:20,maxSpeed:1400},Da),ei=l.extend({deceleration:1e3,maxSpeed:360},Da),Ra=l.extend({deceleration:1e3,maxSpeed:90},Da);class tu{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,c=l.exported.now();for(;r.length>0&&c-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new l.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)c.zoom+=x.zoomDelta||0,c.bearing+=x.bearingDelta||0,c.pitch+=x.pitchDelta||0,x.panDelta&&c.pan._add(x.panDelta),x.around&&(c.around=x.around),x.pinchAround&&(c.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(c.pan.mag()){const x=Bl(c.pan.mag(),p,l.extend({},Js,r||{}));_.offset=c.pan.mult(x.amount/c.pan.mag()),_.center=this._map.transform.center,wl(_,x)}if(c.zoom){const x=Bl(c.zoom,p,Pa);_.zoom=this._map.transform.zoom+x.amount,wl(_,x)}if(c.bearing){const x=Bl(c.bearing,p,ei);_.bearing=this._map.transform.bearing+l.clamp(x.amount,-179,179),wl(_,x)}if(c.pitch){const x=Bl(c.pitch,p,Ra);_.pitch=this._map.transform.pitch+x.amount,wl(_,x)}if(_.zoom||_.bearing){const x=void 0===c.pinchAround?c.around:c.pinchAround;_.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function wl(h,r){(!h.duration||h.duration<r.duration)&&(h.duration=r.duration,h.easing=r.easing)}function Bl(h,r,c){const{maxSpeed:p,linearity:_,deceleration:x}=c,C=l.clamp(h*_/(r/1e3),-p,p),A=Math.abs(C)/(x*_);return{easing:c.easing,duration:1e3*A,amount:C*(A/2)}}class Us extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p,_={}){const x=it(c.getCanvasContainer(),p),C=c.unproject(x);super(r,l.extend({point:x,lngLat:C,originalEvent:p},_)),this._defaultPrevented=!1,this.target=c}}class Wi extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p){const _="touchend"===r?p.changedTouches:p.touches,x=Kt(c.getCanvasContainer(),_),C=x.map(N=>c.unproject(N)),A=x.reduce((N,G,H,ie)=>N.add(G.div(ie.length)),new l.Point(0,0));super(r,{points:x,point:A,lngLats:C,lngLat:c.unproject(A),originalEvent:p}),this._defaultPrevented=!1}}class El extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p){super(r,{originalEvent:p}),this._defaultPrevented=!1}}class nu{constructor(r,c){this._map=r,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new El(r.type,this._map,r))}mousedown(r,c){return this._mousedownPos=c,this._firePreventable(new Us(r.type,this._map,r))}mouseup(r){this._map.fire(new Us(r.type,this._map,r))}preclick(r){const c=l.extend({},r);c.type="preclick",this._map.fire(new Us(c.type,this._map,c))}click(r,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Us(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Us(r.type,this._map,r))}mouseover(r){this._map.fire(new Us(r.type,this._map,r))}mouseout(r){this._map.fire(new Us(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Wi(r.type,this._map,r))}touchmove(r){this._map.fire(new Wi(r.type,this._map,r))}touchend(r){this._map.fire(new Wi(r.type,this._map,r))}touchcancel(r){this._map.fire(new Wi(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class iu{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Us(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Us("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Us(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ru{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,c){this.isEnabled()&&r.shiftKey&&0===r.button&&(Qe(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(r,c){if(!this._active)return;const p=c,_=this._startPos,x=this._lastPos;if(!_||!x||x.equals(p)||!this._box&&p.dist(_)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=yt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const C=Math.min(_.x,p.x),A=Math.max(_.x,p.x),N=Math.min(_.y,p.y),G=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${C}px,${N}px)`,this._box.style.width=A-C+"px",this._box.style.height=G-N+"px")})}mouseupWindow(r,c){if(!this._active)return;const p=this._startPos,_=c;if(p&&0===r.button){if(this.reset(),Ct(),p.x!==_.x||p.y!==_.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:x=>x.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),_t(),delete this._startPos,delete this._lastPos}_fireEvent(r,c){return this._map.fire(new l.Event(r,{originalEvent:c}))}}function Ca(h,r){const c={};for(let p=0;p<h.length;p++)c[h[p].identifier]=r[p];return c}class Dl{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const x=new l.Point(0,0);for(const C of _)x._add(C);return x.div(_.length)}(c),this.touches=Ca(p,c)))}touchmove(r,c,p){if(this.aborted||!this.centroid)return;const _=Ca(p,c);for(const x in this.touches){const C=_[x];(!C||C.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(r,c,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===p.length){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Cl{constructor(r){this.singleTap=new Dl(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,c,p){this.singleTap.touchstart(r,c,p)}touchmove(r,c,p){this.singleTap.touchmove(r,c,p)}touchend(r,c,p){const _=this.singleTap.touchend(r,c,p);if(_){const x=r.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(_)<30;if(x&&C||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class fh{constructor(){this._zoomIn=new Cl({numTouches:1,numTaps:2}),this._zoomOut=new Cl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,c,p){this._zoomIn.touchstart(r,c,p),this._zoomOut.touchstart(r,c,p)}touchmove(r,c,p){this._zoomIn.touchmove(r,c,p),this._zoomOut.touchmove(r,c,p)}touchend(r,c,p){const _=this._zoomIn.touchend(r,c,p),x=this._zoomOut.touchend(r,c,p);return _?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(_)},{originalEvent:r})}):x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(x)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const yd={0:1,2:2};class Tl{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,c){return!1}_move(r,c){return{}}mousedown(r,c){if(this._lastPoint)return;const p=Tt(r);this._correctButton(r,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(r,c){const p=this._lastPoint;if(p)if(r.preventDefault(),null!=this._eventButton&&function(_,x){const C=yd[x];return void 0===_.buttons||(_.buttons&C)!==C}(r,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}mouseupWindow(r){this._lastPoint&&Tt(r)===this._eventButton&&(this._moved&&Ct(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wc extends Tl{mousedown(r,c){super.mousedown(r,c),this._lastPoint&&(this._active=!0)}_correctButton(r,c){return 0===c&&!r.ctrlKey}_move(r,c){return{around:c,panDelta:c.sub(r)}}}class oc extends Tl{_correctButton(r,c){return 0===c&&r.ctrlKey||2===c}_move(r,c){const p=.8*(c.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){r.preventDefault()}}class Ln extends Tl{_correctButton(r,c){return 0===c&&r.ctrlKey||2===c}_move(r,c){const p=-.5*(c.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){r.preventDefault()}}class Ar{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),l.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new l.Point(0,0)}touchstart(r,c,p){return this._calculateTransform(r,c,p)}touchmove(r,c,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===p.length&&!l.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,c,p)}}touchend(r,c,p){this._calculateTransform(r,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,c,p){p.length>0&&(this._active=!0);const _=Ca(p,c),x=new l.Point(0,0),C=new l.Point(0,0);let A=0;for(const G in _){const H=_[G],ie=this._touches[G];ie&&(x._add(H),C._add(H.sub(ie)),A++,_[G]=H)}if(this._touches=_,A<this._minTouches||!C.mag())return;const N=C.div(A);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(A),panDelta:N}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=yt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class sc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,c,p){return{}}touchstart(r,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(r,c,p){const _=this._firstTwoTouches;if(!_)return;r.preventDefault();const[x,C]=_,A=Sl(p,c,x),N=Sl(p,c,C);if(!A||!N)return;const G=this._aroundCenter?null:A.add(N).div(2);return this._move([A,N],G,r)}touchend(r,c,p){if(!this._firstTwoTouches)return;const[_,x]=this._firstTwoTouches,C=Sl(p,c,_),A=Sl(p,c,x);C&&A||(this._active&&Ct(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Sl(h,r,c){for(let p=0;p<h.length;p++)if(h[p].identifier===c)return r[p]}function Ts(h,r){return Math.log(h/r)/Math.LN2}class Au extends sc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,c){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Ts(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ts(this._distance,p),pinchAround:c}}}function Nl(h,r){return 180*h.angleWith(r)/Math.PI}class Va extends sc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,c){const p=this._vector;if(this._vector=r[0].sub(r[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Nl(this._vector,p),pinchAround:c}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const c=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const _=Nl(r,p);return Math.abs(_)<c}}function Ua(h){return Math.abs(h.y)>Math.abs(h.x)}class ou extends sc{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Ua(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,c,p){const _=this._lastPoints;if(!_)return;const x=r[0].sub(_[0]),C=r[1].sub(_[1]);return this._map._cooperativeGestures&&!l.isFullscreen()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(x,C,p.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(x.y+C.y)/2*-.5})}gestureBeginsVertically(r,c,p){if(void 0!==this._valid)return this._valid;const _=r.mag()>=2,x=c.mag()>=2;if(!_&&!x)return;if(!_||!x)return null==this._firstMove&&(this._firstMove=p),p-this._firstMove<100&&void 0;const C=r.y>0==c.y>0;return Ua(r)&&Ua(c)&&C}}const su={panStep:100,bearingStep:15,pitchStep:10};class ph{constructor(){const r=su;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let c=0,p=0,_=0,x=0,C=0;switch(r.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),x=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),x=1);break;case 38:r.shiftKey?_=1:(r.preventDefault(),C=-1);break;case 40:r.shiftKey?_=-1:(r.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:A=>{const N=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:au,zoom:c?Math.round(N)+c*(r.shiftKey?2:1):N,bearing:A.getBearing()+p*this._bearingStep,pitch:A.getPitch()+_*this._pitchStep,offset:[-x*this._panStep,-C*this._panStep],center:A.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function au(h){return h*(2-h)}const js=4.000244140625;class ja{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||l.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=r.deltaMode===l.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=l.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,0!==c&&c%js==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(_*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),r.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=r,this._delta-=c,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=it(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;"wheel"===this._type&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const N="wheel"===this._type&&Math.abs(this._delta)>js?this._wheelZoomRate:this._defaultZoomRate;let G=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&0!==G&&(G=1/G);const H=c(),ie=Math.pow(2,H),pe="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):ie;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(pe*G))),"wheel"===this._type&&(this._startZoom=H,this._easing=this._smoothOutEasing(200)),this._delta=0}const p="number"==typeof this._targetZoom?this._targetZoom:c(),_=this._startZoom,x=this._easing;let C,A=!1;if("wheel"===this._type&&_&&x){const N=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),G=x(N);C=l.number(_,p,G),N<1?this._frameId||(this._frameId=!0):A=!0}else C=p,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:C-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let c=l.ease;if(this._prevEase){const p=this._prevEase,_=(l.exported.now()-p.start)/p.duration,x=p.easing(_+.01)-p.easing(_),C=.27/Math.sqrt(x*x+1e-4)*.01,A=Math.sqrt(.0729-C*C);c=l.bezier(C,A,.25,1)}return this._prevEase={start:l.exported.now(),duration:r,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=yt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(l.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class lu{constructor(r,c){this._clickZoom=r,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ls{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,c){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ja{constructor(){this._tap=new Cl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,c,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,c,p))}touchmove(r,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=c[0],x=_.y-this._swipePoint.y;return this._swipePoint=_,r.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(r,c,p)}touchend(r,c,p){this._tapTime?this._swipePoint&&0===p.length&&this.reset():this._tap.touchend(r,c,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pu{constructor(r,c,p){this._el=r,this._mousePan=c,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class cu{constructor(r,c,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class vd{constructor(r,c,p,_){this._el=r,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Oa=h=>h.zoom||h.drag||h.pitch||h.rotate;class uu extends l.Event{}class Ru{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,c){const p=l.sub([],c,r);this.radius=l.length(p[2]<0?l.div([],p,this.constants):[p[0],p[1],0])}projectRay(r){l.div(r,r,this.constants),l.normalize(r,r),l.mul$1(r,r,this.constants);const c=l.scale$2([],r,this.radius);if(c[2]>0){const p=l.scale$2([],[0,0,1],l.dot(c,[0,0,1])),_=l.scale$2([],l.normalize([],[c[0],c[1],0]),this.radius),x=l.add([],c,l.scale$2([],l.sub([],l.add([],_,p),c),2));c[0]=x[0],c[1]=x[1]}return c}}function ka(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class La{constructor(r,c){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tu(r),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ru,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),l.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[l.window.document,"mousemove",{capture:!0}],[l.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[l.window,"blur",void 0]];for(const[_,x,C]of this._listeners)_.addEventListener(x,_===l.window.document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[r,c,p]of this._listeners)r.removeEventListener(c,r===l.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(r){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new nu(c,r));const _=c.boxZoom=new ru(c,r);this._add("boxZoom",_);const x=new fh,C=new ls;c.doubleClickZoom=new lu(C,x),this._add("tapZoom",x),this._add("clickZoom",C);const A=new Ja;this._add("tapDragZoom",A);const N=c.touchPitch=new ou(c);this._add("touchPitch",N);const G=new oc(r),H=new Ln(r);c.dragRotate=new cu(r,G,H),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);const ie=new wc(r),pe=new Ar(c,r);c.dragPan=new Pu(p,ie,pe),this._add("mousePan",ie),this._add("touchPan",pe,["touchZoom","touchRotate"]);const be=new Va,Ie=new Au;c.touchZoomRotate=new vd(p,Ie,be,A),this._add("touchRotate",be,["touchPan","touchZoom"]),this._add("touchZoom",Ie,["touchPan","touchRotate"]),this._add("blockableMapEvent",new iu(c));const Ce=c.scrollZoom=new ja(c,this);this._add("scrollZoom",Ce,["mousePan"]);const ke=c.keyboard=new ph;this._add("keyboard",ke);for(const re of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[re]&&c[re].enable(r[re])}_add(r,c,p){this._handlers.push({handlerName:r,handler:c,allowed:p}),this._handlersById[r]=c}stop(r){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Oa(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,c,p){for(const _ in r)if(_!==p&&(!c||c.indexOf(_)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const c=[];for(const p of r)this._el.contains(p.target)&&c.push(p);return c}handleEvent(r,c){this._updatingCamera=!0;const p="renderFrame"===r.type,_=p?void 0:r,x={needsRenderFrame:!1},C={},A={},N=r.touches?this._getMapTouches(r.touches):void 0,G=N?Kt(this._el,N):p?void 0:it(this._el,r);for(const{handlerName:pe,handler:be,allowed:Ie}of this._handlers){if(!be.isEnabled())continue;let Ce;this._blockedByActive(A,Ie,pe)?be.reset():be[c||r.type]&&(Ce=be[c||r.type](r,G,N),this.mergeHandlerResult(x,C,Ce,pe,_),Ce&&Ce.needsRenderFrame&&this._triggerRenderFrame()),(Ce||be.isActive())&&(A[pe]=be)}const H={};for(const pe in this._previousActiveHandlers)A[pe]||(H[pe]=_);this._previousActiveHandlers=A,(Object.keys(H).length||ka(x))&&(this._changes.push([x,C,H]),this._triggerRenderFrame()),(Object.keys(A).length||ka(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ie}=x;ie&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ie(this._map))}mergeHandlerResult(r,c,p,_,x){if(!p)return;l.extend(r,p);const C={handlerName:_,originalEvent:p.originalEvent||x};void 0!==p.zoomDelta&&(c.zoom=C),void 0!==p.panDelta&&(c.drag=C),void 0!==p.pitchDelta&&(c.pitch=C),void 0!==p.bearingDelta&&(c.rotate=C)}_applyChanges(){const r={},c={},p={};for(const[_,x,C]of this._changes)_.panDelta&&(r.panDelta=(r.panDelta||new l.Point(0,0))._add(_.panDelta)),_.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+_.pitchDelta),void 0!==_.around&&(r.around=_.around),void 0!==_.aroundCoord&&(r.aroundCoord=_.aroundCoord),void 0!==_.pinchAround&&(r.pinchAround=_.pinchAround),_.noInertia&&(r.noInertia=_.noInertia),l.extend(c,x),l.extend(p,C);this._updateMapTransform(r,c,p),this._changes=[]}_updateMapTransform(r,c,p){const _=this._map,x=_.transform,C=we=>[we.x,we.y,we.z];if((we=>{const ze=this._eventsInProgress.drag;return ze&&!this._handlersById[ze.handlerName].isActive()})()&&!ka(r)){const we=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",we!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&_._stop(!0),!ka(r))return void this._fireEvents(c,p,!0);let{panDelta:A,zoomDelta:N,bearingDelta:G,pitchDelta:H,around:ie,aroundCoord:pe,pinchAround:be}=r;x._isCameraConstrained&&(N>0&&(N=0),x._isCameraConstrained=!1),void 0!==be&&(ie=be),(N||(we=>c.drag&&!this._eventsInProgress.drag)())&&ie&&(this._dragOrigin=C(x.pointCoordinate3D(ie)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",_._stop(!0),ie=ie||_.transform.centerPoint,G&&(x.bearing+=G),H&&(x.pitch+=H),x._updateCameraState();const Ie=[0,0,0];if(A)if("mercator"===x.projection.name){const we=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(ie).dir),ze=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(ie.sub(A)).dir);Ie[0]=ze[0]-we[0],Ie[1]=ze[1]-we[1]}else{const we=x.pointCoordinate(ie);if("globe"===x.projection.name){A=A.rotate(-x.angle);const ze=x._pixelsPerMercatorPixel/x.worldSize;Ie[0]=-A.x*l.mercatorScale(l.latFromMercatorY(we.y))*ze,Ie[1]=-A.y*l.mercatorScale(x.center.lat)*ze}else{const ze=x.pointCoordinate(ie.sub(A));we&&ze&&(Ie[0]=ze.x-we.x,Ie[1]=ze.y-we.y)}}const Ce=x.zoom,ke=[0,0,0];if(N){const we=C(pe||x.pointCoordinate3D(ie)),ze={dir:l.normalize([],l.sub([],we,x._camera.position))};if(ze.dir[2]<0){const $e=x.zoomDeltaToMovement(we,N);l.scale$2(ke,ze.dir,$e)}}const re=l.add(Ie,Ie,ke);x._translateCameraConstrained(re),N&&Math.abs(x.zoom-Ce)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(c,p,!0)}_fireEvents(r,c,p){const _=Oa(this._eventsInProgress),x=Oa(r),C={};for(const H in r){const{originalEvent:ie}=r[H];this._eventsInProgress[H]||(C[`${H}start`]=ie),this._eventsInProgress[H]=r[H]}!_&&x&&this._fireEvent("movestart",x.originalEvent);for(const H in C)this._fireEvent(H,C[H]);x&&this._fireEvent("move",x.originalEvent);for(const H in r){const{originalEvent:ie}=r[H];this._fireEvent(H,ie)}const A={};let N;for(const H in this._eventsInProgress){const{handlerName:ie,originalEvent:pe}=this._eventsInProgress[H];this._handlersById[ie].isActive()||(delete this._eventsInProgress[H],N=c[ie]||pe,A[`${H}end`]=N)}for(const H in A)this._fireEvent(H,A[H]);const G=Oa(this._eventsInProgress);if(p&&(_||x)&&!G){this._updatingCamera=!0;const H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ie=pe=>0!==pe&&-this._bearingSnap<pe&&pe<this._bearingSnap;H?(ie(H.bearing||this._map.getBearing())&&(H.bearing=0),this._map.easeTo(H,{originalEvent:N})):(this._map.fire(new l.Event("moveend",{originalEvent:N})),ie(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,c){this._map.fire(new l.Event(r,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new uu("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const zl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class P extends l.Evented{constructor(r,c){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=!1!==c.respectPrefersReducedMotion,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,c){return this.jumpTo({center:r},c)}panBy(r,c,p){return r=l.Point.convert(r).mult(-1),this.panTo(this.transform.center,l.extend({offset:r},c),p)}panTo(r,c,p){return this.easeTo(l.extend({center:r},c),p)}getZoom(){return this.transform.zoom}setZoom(r,c){return this.jumpTo({zoom:r},c),this}zoomTo(r,c,p){return this.easeTo(l.extend({zoom:r},c),p)}zoomIn(r,c){return this.zoomTo(this.getZoom()+1,r,c),this}zoomOut(r,c){return this.zoomTo(this.getZoom()-1,r,c),this}getBearing(){return this.transform.bearing}setBearing(r,c){return this.jumpTo({bearing:r},c),this}getPadding(){return this.transform.padding}setPadding(r,c){return this.jumpTo({padding:r},c),this}rotateTo(r,c,p){return this.easeTo(l.extend({bearing:r},c),p)}resetNorth(r,c){return this.rotateTo(0,l.extend({duration:1e3},r),c),this}resetNorthPitch(r,c){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},r),c),this}snapToNorth(r,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,c):this}getPitch(){return this.transform.pitch}setPitch(r,c){return this.jumpTo({pitch:r},c),this}cameraForBounds(r,c){r=l.LngLatBounds.convert(r);const p=c&&c.bearing||0,_=c&&c.pitch||0,x=r.getNorthWest(),C=r.getSouthEast();return this._cameraForBounds(this.transform,x,C,p,_,c)}_extendCameraOptions(r){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=l.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const p=r.padding;r.padding={top:p,bottom:p,right:p,left:p}}return r.padding=l.extend(c,r.padding),r}_minimumAABBFrustumDistance(r,c){const p=c.max[0]-c.min[0],_=c.max[1]-c.min[1];return p/_>r.aspect?p/(2*Math.tan(.5*r.fovX)*r.aspect):_/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,c,p,_,x,C){const A=r.clone(),N=this._extendCameraOptions(C);A.bearing=_,A.pitch=x;const G=l.LngLat.convert(c),H=l.LngLat.convert(p),ie=.5*(G.lat+H.lat),pe=.5*(G.lng+H.lng),be=l.latLngToECEF(ie,pe),Ie=l.normalize([],be),Ce=l.normalize([],l.cross([],Ie,[0,1,0])),ke=l.cross([],Ce,Ie),re=[Ce[0],Ce[1],Ce[2],0,ke[0],ke[1],ke[2],0,Ie[0],Ie[1],Ie[2],0,0,0,0,1],we=[be,l.latLngToECEF(G.lat,G.lng),l.latLngToECEF(H.lat,G.lng),l.latLngToECEF(H.lat,H.lng),l.latLngToECEF(G.lat,H.lng),l.latLngToECEF(ie,G.lng),l.latLngToECEF(ie,H.lng),l.latLngToECEF(G.lat,pe),l.latLngToECEF(H.lat,pe)];let ze=l.Aabb.fromPoints(we.map(Mn=>[l.dot(Ce,Mn),l.dot(ke,Mn),l.dot(Ie,Mn)]));const $e=l.transformMat4([],ze.center,re);0===l.squaredLength($e)&&l.set($e,0,0,1),l.normalize($e,$e),l.scale$2($e,$e,l.GLOBE_RADIUS),A.center=l.ecefToLatLng($e);const lt=A.getWorldToCameraMatrix(),ct=l.invert(new Float64Array(16),lt);ze=l.Aabb.applyTransform(ze,l.multiply([],lt,re)),l.transformMat4($e,$e,lt);const ut=.5*(ze.max[2]-ze.min[2]),kt=this._minimumAABBFrustumDistance(A,ze),Pt=l.scale$2([],[0,0,1],ut),qt=l.add(Pt,$e,Pt),Fn=kt+(0===A.pitch?0:l.distance($e,qt)),Ut=A.globeCenterInViewSpace,gn=l.sub([],$e,[Ut[0],Ut[1],Ut[2]]);l.normalize(gn,gn),l.scale$2(gn,gn,Fn);const Jt=l.add([],$e,gn);l.transformMat4(Jt,Jt,ct);const Rn=l.earthRadius/l.GLOBE_RADIUS,jt=l.length(Jt),vn=l.mercatorZfromAltitude(Math.max(jt*Rn-l.earthRadius,Number.EPSILON),0),kn=Math.min(A.zoomFromMercatorZAdjusted(vn),N.maxZoom);return kn>.5*(l.GLOBE_ZOOM_THRESHOLD_MIN+l.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"mercator"}),A.zoom=kn,this._cameraForBounds(A,c,p,_,x,C)):{center:A.center,zoom:kn,bearing:_,pitch:x}}queryTerrainElevation(r,c){const p=this.transform.elevation;return p?(c=l.extend({},{exaggerated:!0},c),p.getAtPoint(l.MercatorCoordinate.fromLngLat(r),null,c.exaggerated)):null}_cameraForBounds(r,c,p,_,x,C){if("globe"===r.projection.name)return this._cameraForBoundsOnGlobe(r,c,p,_,x,C);const A=r.clone(),N=this._extendCameraOptions(C),G=A.padding;A.bearing=_,A.pitch=x;const H=l.LngLat.convert(c),ie=l.LngLat.convert(p),pe=new l.LngLat(H.lng,ie.lat),be=new l.LngLat(ie.lng,H.lat),Ie=A.project(H),Ce=A.project(ie),ke=this.queryTerrainElevation(H),re=this.queryTerrainElevation(ie),we=this.queryTerrainElevation(pe),ze=this.queryTerrainElevation(be),$e=[[Ie.x,Ie.y,Math.min(ke||0,re||0,we||0,ze||0)],[Ce.x,Ce.y,Math.max(ke||0,re||0,we||0,ze||0)]];let lt=l.Aabb.fromPoints($e);const ct=A.getWorldToCameraMatrix(),ut=l.invert(new Float64Array(16),ct);lt=l.Aabb.applyTransform(lt,ct);const kt=l.sub([],lt.max,lt.min),Pt=G.left||0,qt=G.right||0,Fn=G.bottom||0,Ut=G.top||0,{left:gn,right:Jt,top:Rn,bottom:jt}=N.padding,vn=.5*(Pt+qt),kn=.5*(Ut+Fn),Mn=Math.min(A.scaleZoom(A.scale*Math.min((A.width-(Pt+qt+gn+Jt))/kt[0],(A.height-(Fn+Ut+jt+Rn))/kt[1])),N.maxZoom),Vn=A.scale/A.zoomScale(Mn);lt=new l.Aabb([lt.min[0]-(gn+vn)*Vn,lt.min[1]-(jt+kn)*Vn,lt.min[2]],[lt.max[0]+(Jt+vn)*Vn,lt.max[1]+(Rn+kn)*Vn,lt.max[2]]);const Ei=.5*kt[2],Ki=this._minimumAABBFrustumDistance(A,lt),di=[0,0,1,0];l.transformMat4$1(di,di,ct),l.normalize$2(di,di);const Ri=l.scale$2([],di,Ki+Ei),_r=l.add([],lt.center,Ri),dr=("number"==typeof N.offset.x&&"number"==typeof N.offset.y?new l.Point(N.offset.x,N.offset.y):l.Point.convert(N.offset)).rotate(-l.degToRad(_));lt.center[0]-=dr.x*Vn,lt.center[1]+=dr.y*Vn,l.transformMat4(lt.center,lt.center,ut),l.transformMat4(_r,_r,ut);const mi=[lt.center[0],lt.center[1],_r[2]*A.pixelsPerMeter];l.scale$2(mi,mi,1/A.worldSize);const Jr=l.lngFromMercatorX(mi[0]),uo=l.latFromMercatorY(mi[1]),ho=Math.min(A._zoomFromMercatorZ(mi[2]),N.maxZoom),Zr=new l.LngLat(Jr,uo);return A.mercatorFromTransition&&ho<.5*(l.GLOBE_ZOOM_THRESHOLD_MIN+l.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"globe"}),A.zoom=ho,this._cameraForBounds(A,c,p,_,x,C)):{center:Zr,zoom:ho,bearing:_,pitch:x}}fitBounds(r,c,p){const _=this.cameraForBounds(r,c);return this._fitInternal(_,c,p)}fitScreenCoordinates(r,c,p,_,x){const C=l.Point.convert(r),A=l.Point.convert(c),N=new l.Point(Math.min(C.x,A.x),Math.min(C.y,A.y)),G=new l.Point(Math.max(C.x,A.x),Math.max(C.y,A.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(C,A))return this;const H=this.transform.pointLocation3D(N),ie=this.transform.pointLocation3D(G),pe=this.transform.pointLocation3D(new l.Point(N.x,G.y)),be=this.transform.pointLocation3D(new l.Point(G.x,N.y)),Ie=[Math.min(H.lng,ie.lng,pe.lng,be.lng),Math.min(H.lat,ie.lat,pe.lat,be.lat)],Ce=[Math.max(H.lng,ie.lng,pe.lng,be.lng),Math.max(H.lat,ie.lat,pe.lat,be.lat)],ke=_&&_.pitch?_.pitch:this.getPitch(),re=this._cameraForBounds(this.transform,Ie,Ce,p,ke,_);return this._fitInternal(re,_,x)}_fitInternal(r,c,p){return r?(delete(c=l.extend(r,c)).padding,c.linear?this.easeTo(c,p):this.flyTo(c,p)):this}jumpTo(r,c){this.stop();const p=r.preloadOnly?this.transform.clone():this.transform;let _=!1,x=!1,C=!1;return"zoom"in r&&p.zoom!==+r.zoom&&(_=!0,p.zoom=+r.zoom),void 0!==r.center&&(p.center=l.LngLat.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(x=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(C=!0,p.pitch=+r.pitch),null==r.padding||p.isPaddingEqual(r.padding)||(p.padding=r.padding),r.preloadOnly?(this._preloadTiles(p),this):(this.fire(new l.Event("movestart",c)).fire(new l.Event("move",c)),_&&this.fire(new l.Event("zoomstart",c)).fire(new l.Event("zoom",c)).fire(new l.Event("zoomend",c)),x&&this.fire(new l.Event("rotatestart",c)).fire(new l.Event("rotate",c)).fire(new l.Event("rotateend",c)),C&&this.fire(new l.Event("pitchstart",c)).fire(new l.Event("pitch",c)).fire(new l.Event("pitchend",c)),this.fire(new l.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||l.warnOnce(zl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,c){const p=this.transform;if(!p.projection.supportsFreeCamera)return l.warnOnce(zl),this;this.stop();const _=p.zoom,x=p.pitch,C=p.bearing;p.setFreeCameraOptions(r);const A=_!==p.zoom,N=x!==p.pitch,G=C!==p.bearing;return this.fire(new l.Event("movestart",c)).fire(new l.Event("move",c)),A&&this.fire(new l.Event("zoomstart",c)).fire(new l.Event("zoom",c)).fire(new l.Event("zoomend",c)),G&&this.fire(new l.Event("rotatestart",c)).fire(new l.Event("rotate",c)).fire(new l.Event("rotateend",c)),N&&this.fire(new l.Event("pitchstart",c)).fire(new l.Event("pitch",c)).fire(new l.Event("pitchend",c)),this.fire(new l.Event("moveend",c)),this}easeTo(r,c){this._stop(!1,r.easeId),(!1===(r=l.extend({offset:[0,0],duration:500,easing:l.ease},r)).animate||this._prefersReducedMotion(r))&&(r.duration=0);const p=this.transform,_=this.getZoom(),x=this.getBearing(),C=this.getPitch(),A=this.getPadding(),N="zoom"in r?+r.zoom:_,G="bearing"in r?this._normalizeBearing(r.bearing,x):x,H="pitch"in r?+r.pitch:C,ie="padding"in r?r.padding:p.padding,pe=l.Point.convert(r.offset);let be,Ie,Ce;if("globe"===p.projection.name){const Pt=l.MercatorCoordinate.fromLngLat(p.center),qt=pe.rotate(-p.angle);Pt.x+=qt.x/p.worldSize,Pt.y+=qt.y/p.worldSize;const Fn=Pt.toLngLat(),Ut=l.LngLat.convert(r.center||Fn);this._normalizeCenter(Ut),be=p.centerPoint.add(qt),Ie=new l.Point(Pt.x,Pt.y).mult(p.worldSize),Ce=new l.Point(l.mercatorXfromLng(Ut.lng),l.mercatorYfromLat(Ut.lat)).mult(p.worldSize).sub(Ie)}else{be=p.centerPoint.add(pe);const Pt=p.pointLocation(be),qt=l.LngLat.convert(r.center||Pt);this._normalizeCenter(qt),Ie=p.project(Pt),Ce=p.project(qt).sub(Ie)}const ke=p.zoomScale(N-_);let re,we;r.around&&(re=l.LngLat.convert(r.around),we=p.locationPoint(re));const ze=this._zooming||N!==_,$e=this._rotating||x!==G,lt=this._pitching||H!==C,ct=!p.isPaddingEqual(ie),ut=Pt=>qt=>{if(ze&&(Pt.zoom=l.number(_,N,qt)),$e&&(Pt.bearing=l.number(x,G,qt)),lt&&(Pt.pitch=l.number(C,H,qt)),ct&&(Pt.interpolatePadding(A,ie,qt),be=Pt.centerPoint.add(pe)),re)Pt.setLocationAtPoint(re,we);else{const Fn=Pt.zoomScale(Pt.zoom-_),Ut=N>_?Math.min(2,ke):Math.max(.5,ke),gn=Math.pow(Ut,1-qt),Jt=Pt.unproject(Ie.add(Ce.mult(qt*gn)).mult(Fn));Pt.setLocationAtPoint(Pt.renderWorldCopies?Jt.wrap():Jt,be)}return r.preloadOnly||this._fireMoveEvents(c),Pt};if(r.preloadOnly){const Pt=this._emulate(ut,r.duration,p);return this._preloadTiles(Pt),this}const kt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ze,this._rotating=$e,this._pitching=lt,this._padding=ct,this._easeId=r.easeId,this._prepareEase(c,r.noMoveStart,kt),this._ease(ut(p),Pt=>{p.recenterOnTerrain(),this._afterEase(c,Pt)},r),this}_prepareEase(r,c,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||p.moving||this.fire(new l.Event("movestart",r)),this._zooming&&!p.zooming&&this.fire(new l.Event("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new l.Event("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new l.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new l.Event("move",r)),this._zooming&&this.fire(new l.Event("zoom",r)),this._rotating&&this.fire(new l.Event("rotate",r)),this._pitching&&this.fire(new l.Event("pitch",r))}_afterEase(r,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,_=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.Event("zoomend",r)),_&&this.fire(new l.Event("rotateend",r)),x&&this.fire(new l.Event("pitchend",r)),this.fire(new l.Event("moveend",r))}flyTo(r,c){if(this._prefersReducedMotion(r)){const Mn=l.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Mn,c)}this.stop(),r=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},r);const p=this.transform,_=this.getZoom(),x=this.getBearing(),C=this.getPitch(),A=this.getPadding(),N="zoom"in r?l.clamp(+r.zoom,p.minZoom,p.maxZoom):_,G="bearing"in r?this._normalizeBearing(r.bearing,x):x,H="pitch"in r?+r.pitch:C,ie="padding"in r?r.padding:p.padding,pe=p.zoomScale(N-_),be=l.Point.convert(r.offset);let Ie=p.centerPoint.add(be);const Ce=p.pointLocation(Ie),ke=l.LngLat.convert(r.center||Ce);this._normalizeCenter(ke);const re=p.project(Ce),we=p.project(ke).sub(re);let ze=r.curve;const $e=Math.max(p.width,p.height),lt=$e/pe,ct=we.mag();if("minZoom"in r){const Mn=l.clamp(Math.min(r.minZoom,_,N),p.minZoom,p.maxZoom),Vn=$e/p.zoomScale(Mn-_);ze=Math.sqrt(Vn/ct*2)}const ut=ze*ze;function kt(Mn){const Vn=(lt*lt-$e*$e+(Mn?-1:1)*ut*ut*ct*ct)/(2*(Mn?lt:$e)*ut*ct);return Math.log(Math.sqrt(Vn*Vn+1)-Vn)}function Pt(Mn){return(Math.exp(Mn)-Math.exp(-Mn))/2}function qt(Mn){return(Math.exp(Mn)+Math.exp(-Mn))/2}const Fn=kt(0);let Ut=function(Mn){return qt(Fn)/qt(Fn+ze*Mn)},gn=function(Mn){return $e*((qt(Fn)*(Pt(Vn=Fn+ze*Mn)/qt(Vn))-Pt(Fn))/ut)/ct;var Vn},Jt=(kt(1)-Fn)/ze;if(Math.abs(ct)<1e-6||!isFinite(Jt)){if(Math.abs($e-lt)<1e-6)return this.easeTo(r,c);const Mn=lt<$e?-1:1;Jt=Math.abs(Math.log(lt/$e))/ze,gn=function(){return 0},Ut=function(Vn){return Math.exp(Mn*ze*Vn)}}r.duration="duration"in r?+r.duration:1e3*Jt/("screenSpeed"in r?+r.screenSpeed/ze:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Rn=x!==G,jt=H!==C,vn=!p.isPaddingEqual(ie),kn=Mn=>Vn=>{const Ei=Vn*Jt,Ki=1/Ut(Ei);Mn.zoom=1===Vn?N:_+Mn.scaleZoom(Ki),Rn&&(Mn.bearing=l.number(x,G,Vn)),jt&&(Mn.pitch=l.number(C,H,Vn)),vn&&(Mn.interpolatePadding(A,ie,Vn),Ie=Mn.centerPoint.add(be));const di=1===Vn?ke:Mn.unproject(re.add(we.mult(gn(Ei))).mult(Ki));return Mn.setLocationAtPoint(Mn.renderWorldCopies?di.wrap():di,Ie),Mn._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(c),Mn};if(r.preloadOnly){const Mn=this._emulate(kn,r.duration,p);return this._preloadTiles(Mn),this}return this._zooming=!0,this._rotating=Rn,this._pitching=jt,this._padding=vn,this._prepareEase(c,!1),this._ease(kn(p),()=>this._afterEase(c),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,c)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,c,p){!1===p.animate||0===p.duration?(r(1),c()):(this._easeStart=l.exported.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,c){r=l.wrap(r,-180,180);const p=Math.abs(r-c);return Math.abs(r-360-c)<p&&(r-=360),Math.abs(r+360-c)<p&&(r+=360),r}_normalizeCenter(r){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const p=r.lng-c.center.lng;r.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&l.exported.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,c,p){const _=Math.ceil(15*c/1e3),x=[],C=r(p.clone());for(let A=0;A<=_;A++){const N=C(A/_);x.push(N.clone())}return x}}class O{constructor(r={}){this.options=r,l.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const c=this.options&&this.options.compact;return this._map=r,this._container=yt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=yt("button","mapboxgl-ctrl-attrib-button",this._container),yt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=yt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,c){const p=this._map._getUIString(`AttributionControl.${c}`);r.setAttribute("aria-label",p),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||l.config.ACCESS_TOKEN}];if(r){const p=c.reduce((_,x,C)=>(x.value&&(_+=`${x.key}=${x.value}${C<c.length-1?"&":""}`),_),"?");r.href=`${l.config.FEEDBACK_URL}/${p}#${xa(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const c=this._map.style._sourceCaches;for(const _ in c){const x=c[_];if(x.used){const C=x.getSource();C.attribution&&r.indexOf(C.attribution)<0&&r.push(C.attribution)}}r.sort((_,x)=>_.length-x.length),r=r.filter((_,x)=>{for(let C=x+1;C<r.length;C++)if(r[C].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class V{constructor(){l.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=yt("div","mapboxgl-ctrl");const c=yt("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const c in r){const p=r[c].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class L{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const c=++this._id;return this._queue.push({callback:r,id:c,cancelled:!1}),c}remove(r){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const _ of p)if(_.id===r)return void(_.cancelled=!0)}run(r=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function q(h,r,c){if(h=new l.LngLat(h.lng,h.lat),r){const p=new l.LngLat(h.lng-360,h.lat),_=new l.LngLat(h.lng+360,h.lat),x=360*Math.ceil(Math.abs(h.lng-c.center.lng)/360),C=c.locationPoint(h).distSqr(r),A=r.x<0||r.y<0||r.x>c.width||r.y>c.height;c.locationPoint(p).distSqr(r)<C&&(A||Math.abs(p.lng-c.center.lng)<x)?h=p:c.locationPoint(_).distSqr(r)<C&&(A||Math.abs(_.lng-c.center.lng)<x)&&(h=_)}for(;Math.abs(h.lng-c.center.lng)>180;){const p=c.locationPoint(h);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;h.lng>c.center.lng?h.lng-=360:h.lng+=360}return h}const ve={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class me extends l.Evented{constructor(r,c){if(super(),(r instanceof l.window.HTMLElement||c)&&(r=l.extend({element:r},c)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=l.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=yt("div");const _=41,x=27,C=Dt("svg",{display:"block",height:_*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${_}`},this._element),A=Dt("radialGradient",{id:"shadowGradient"},Dt("defs",{},C));Dt("stop",{offset:"10%","stop-opacity":.4},A),Dt("stop",{offset:"100%","stop-opacity":.05},A),Dt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),Dt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),Dt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),Dt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=l.Point.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const p=this._element.classList;for(const _ in ve)p.remove(`mapboxgl-marker-anchor-${_}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=l.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(24.6+_)],"bottom-right":[-_,-1*(24.6+_)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const c=r.code,p=r.charCode||r.keyCode;"Space"!==c&&"Enter"!==c&&32!==p&&13!==p||this.togglePopup()}_onMapClick(r){const c=r.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,c=this._pos;if(!r||!c)return!1;const p=r.unproject(c),_=r.getFreeCameraOptions();if(!_.position)return!1;const x=_.position.toLngLat();return x.distanceTo(p)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const c=this._pos;if(!c||c.x<0||c.x>r.transform.width||c.y<0||c.y>r.transform.height)return void this._clearFadeTimer();const p=r.unproject(c);let _;r._showingGlobe()&&l.isLngLatBehindGlobe(r.transform,this._lngLat)?_=0:(_=1-r._queryFogOpacity(p),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${r.x}px,${r.y}px)\n            ${ve[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${c.x}px,${c.y}px)\n        `}_calculateXYTransform(){const r=this._pos,c=this._map,p=this.getPitchAlignment();if(!c||!r||"map"!==p)return"";if(!c._showingGlobe()){const N=c.getPitch();return N?`rotateX(${N}deg)`:""}const _=l.radToDeg(l.globeTiltAtLngLat(c.transform,this._lngLat)),x=r.sub(l.globeCenterToScreenPoint(c.transform)),C=Math.abs(x.x)+Math.abs(x.y);if(0===C)return"";const A=_/C;return`rotateX(${-x.y*A}deg) rotateY(${x.x*A}deg)`}_calculateZTransform(){const r=this._pos,c=this._map;if(!c||!r)return"";let p=0;const _=this.getRotationAlignment();if("map"===_)if(c._showingGlobe()){const x=c.project(new l.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),C=c.project(new l.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);p=l.radToDeg(Math.atan2(C.y,C.x))-90}else p=-c.getBearing();else if("horizon"===_){const x=l.smoothstep(4,6,c.getZoom()),C=l.globeCenterToScreenPoint(c.transform);C.y+=x*c.transform.height;const A=r.sub(C),N=l.radToDeg(Math.atan2(A.y,A.x));p=(N>90?N-270:N+90)*(1-x)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(r){l.window.cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=q(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),!0===r?this._updateFrameId=l.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=l.Point.convert(r),this._update(),this}_onMove(r){const c=this._map;if(!c)return;const p=this._pointerdownPos,_=this._positionDelta;if(p&&_){if(!this._isDragging){const x=this._clickTolerance||c._clickTolerance;if(r.point.dist(p)<x)return;this._isDragging=!0}this._pos=r.point.sub(_),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(r){const c=this._map,p=this._pos;c&&p&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(p),this._pointerdownPos=r.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const c=this._map;return c&&(r?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const et={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},In=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Yn(h=new l.Point(0,0),r="bottom"){if("number"==typeof h){const c=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(r){case"top":return new l.Point(0,h);case"top-left":return new l.Point(c,c);case"top-right":return new l.Point(-c,c);case"bottom":return new l.Point(0,-h);case"bottom-left":return new l.Point(c,-c);case"bottom-right":return new l.Point(-c,-c);case"left":return new l.Point(h,0);case"right":return new l.Point(-h,0)}return new l.Point(0,0)}return h instanceof l.Point||Array.isArray(h)?l.Point.convert(h):l.Point.convert(h[r]||[0,0])}class or{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const c=l.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,c,p){this._start=this.getValue(c),this._end=r,this._startTime=c,this._endTime=c+p}}const ui={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Xo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Ha={showCompass:!0,showZoom:!0,visualizePitch:!1};class $l{constructor(r,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new oc({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new Ln({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(r,c){this.mouseRotate.mousedown(r,c),this.mousePitch&&this.mousePitch.mousedown(r,c),Qe()}move(r,c){const p=this.map,_=this.mouseRotate.mousemoveWindow(r,c),x=_&&_.bearingDelta;if(x&&p.setBearing(p.getBearing()+x),this.mousePitch){const C=this.mousePitch.mousemoveWindow(r,c),A=C&&C.pitchDelta;A&&p.setPitch(p.getPitch()+A)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){_t(),l.window.removeEventListener("mousemove",this.mousemove),l.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(l.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),it(this.element,r)),l.window.addEventListener("mousemove",this.mousemove),l.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,it(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=Kt(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=Kt(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Il={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Vl={maxWidth:100,unit:"metric"},Qa={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ml={version:l.version,supported:ht,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends P{constructor(h){if(l.LivePerformanceUtils.mark(l.PerformanceMarkers.create),null!=(h=l.extend({},Xo,h)).minZoom&&null!=h.maxZoom&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=h.minPitch&&null!=h.maxPitch&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=h.minPitch&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=h.maxPitch&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&l.isSafariWithAntialiasingBug(l.window)&&(h.antialias=!1,l.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Cs(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._useWebGL2=h.useWebGL2,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new L,this._domRenderTaskQueue=new L,this._controls=[],this._markers=[],this._popups=[],this._mapId=l.uniqueId(),this._locale=l.extend({},ui,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new or(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new l.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,"string"==typeof h.container){if(this._container=l.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof l.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&l.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==l.window&&(l.window.addEventListener("online",this._onWindowOnline,!1),l.window.addEventListener("resize",this._onWindowResize,!1),l.window.addEventListener("orientationchange",this._onWindowResize,!1),l.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),l.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new La(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new Zo("string"==typeof h.hash&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,l.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new O({customAttribution:h.customAttribution})),this._logoControl=new V,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new l.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new l.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(h,r){if(void 0===r&&(r=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=h.onAdd(this);this._controls.push(h);const p=this._controlPositions[r];return-1!==r.indexOf("bottom")?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(h);return r>-1&&this._controls.splice(r,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h)),this.fire(new l.Event("resize",h)),r&&this.fire(new l.Event("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(l.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return"auto"===h?l.window.navigator.language:Array.isArray(h)?0===h.length?void 0:h.map(r=>"auto"===r?l.window.navigator.language:r):h}setLanguage(h){const r=this._parseLanguage(h);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(h){return this._lazyInitEmptyStyle(),h?"string"==typeof h&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const h=this.transform,r=h.projection.name;let c;"globe"===r&&h.zoom>=l.GLOBE_ZOOM_THRESHOLD_MAX?(h.setMercatorFromTransition(),c=!0):"mercator"===r&&h.zoom<l.GLOBE_ZOOM_THRESHOLD_MAX&&(h.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,r){return this._updateProjection(h||r||{name:"mercator"})}_updateProjection(h){let r;if(r="globe"===h.name&&this.transform.zoom>=l.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const c in this.style._sourceCaches)this.style._sourceCaches[c].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(h){return this.transform.locationPoint3D(l.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(l.Point.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,r,c){if("mouseenter"===h||"mouseover"===h){let p=!1;const _=C=>{const A=r.filter(G=>this.getLayer(G)),N=A.length?this.queryRenderedFeatures(C.point,{layers:A}):[];N.length?p||(p=!0,c.call(this,new Us(h,this,C.originalEvent,{features:N}))):p=!1},x=()=>{p=!1};return{layers:new Set(r),listener:c,delegates:{mousemove:_,mouseout:x}}}if("mouseleave"===h||"mouseout"===h){let p=!1;const _=C=>{const A=r.filter(N=>this.getLayer(N));(A.length?this.queryRenderedFeatures(C.point,{layers:A}):[]).length?p=!0:p&&(p=!1,c.call(this,new Us(h,this,C.originalEvent)))},x=C=>{p&&(p=!1,c.call(this,new Us(h,this,C.originalEvent)))};return{layers:new Set(r),listener:c,delegates:{mousemove:_,mouseout:x}}}{const p=_=>{const x=r.filter(A=>this.getLayer(A)),C=x.length?this.queryRenderedFeatures(_.point,{layers:x}):[];C.length&&(_.features=C,c.call(this,_),delete _.features)};return{layers:new Set(r),listener:c,delegates:{[h]:p}}}}on(h,r,c){if(void 0===c)return super.on(h,r);Array.isArray(r)||(r=[r]);const p=this._createDelegatedListener(h,r,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(h,r,c){if(void 0===c)return super.once(h,r);Array.isArray(r)||(r=[r]);const p=this._createDelegatedListener(h,r,c);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(h,r,c){if(void 0===c)return super.off(h,r);r=new Set(Array.isArray(r)?r:[r]);const p=(x,C)=>{if(x.size!==C.size)return!1;for(const A of x)if(!C.has(A))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[h]:void 0;return _&&(x=>{for(let C=0;C<x.length;C++){const A=x[C];if(A.listener===c&&p(A.layers,r)){for(const N in A.delegates)this.off(N,A.delegates[N]);return x.splice(C,1),this}}})(_),this}queryRenderedFeatures(h,r){return this.style?(void 0!==r||void 0===h||h instanceof l.Point||Array.isArray(h)||(r=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(h,r){return this.style.querySourceFeatures(h,r)}isPointOnSurface(h){const{name:r}=this.transform.projection;return"globe"!==r&&"mercator"!==r&&l.warnOnce(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(l.Point.convert(h))}setStyle(h,r){return!1!==(r=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(h,r))}_getUIString(h){const r=this._locale[h];if(null==r)throw new Error(`Missing UI string '${h}'`);return r}_updateStyle(h,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new zo(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof h?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new zo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,r){if("string"==typeof h){const c=this._requestManager.normalizeStyleURL(h),p=this._requestManager.transformRequest(c,l.ResourceType.Style);l.getJSON(p,(_,x)=>{_?this.fire(new l.ErrorEvent(_)):x&&this._updateDiff(x,r)})}else"object"==typeof h&&this._updateDiff(h,r)}_updateDiff(h,r){try{this.style.setState(h)&&this._update(!0)}catch(c){l.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(h,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(l.warnOnce("There is no style added to the map."),!1)}addSource(h,r){return this._lazyInitEmptyStyle(),this.style.addSource(h,r),this._update(!0)}isSourceLoaded(h){return!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const r in h){const c=h[r]._tiles;for(const p in c){const _=c[p];if("loaded"!==_.state&&"errored"!==_.state)return!1}}return!0}addSourceType(h,r,c){this._lazyInitEmptyStyle(),this.style.addSourceType(h,r,c)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,r,{pixelRatio:c=1,sdf:p=!1,stretchX:_,stretchY:x,content:C}={}){if(this._lazyInitEmptyStyle(),r instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&r instanceof l.window.ImageBitmap){const{width:A,height:N,data:G}=l.exported.getImageData(r);this.style.addImage(h,{data:new l.RGBAImage({width:A,height:N},G),pixelRatio:c,stretchX:_,stretchY:x,content:C,sdf:p,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:N}=r,G=r;this.style.addImage(h,{data:new l.RGBAImage({width:A,height:N},new Uint8Array(G.data)),pixelRatio:c,stretchX:_,stretchY:x,content:C,sdf:p,version:0,userImage:G}),G.onAdd&&G.onAdd(this,h)}}updateImage(h,r){const c=this.style.getImage(h);if(!c)return void this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=r instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&r instanceof l.window.ImageBitmap?l.exported.getImageData(r):r,{width:_,height:x}=p;void 0!==_&&void 0!==x?_===c.data.width&&x===c.data.height?(c.data.replace(p.data,!(r instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&r instanceof l.window.ImageBitmap)),this.style.updateImage(h,c)):this.fire(new l.ErrorEvent(new Error(`The width and height of the updated image (${_}, ${x})\n                must be that same as the previous version of the image\n                (${c.data.width}, ${c.data.height})`))):this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,r){l.getImage(this._requestManager.transformRequest(h,l.ResourceType.Image),(c,p)=>{r(c,p instanceof l.window.HTMLImageElement?l.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(h,r){return this._lazyInitEmptyStyle(),this.style.addLayer(h,r),this._update(!0)}moveLayer(h,r){return this.style.moveLayer(h,r),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,r,c){return this.style.setLayerZoomRange(h,r,c),this._update(!0)}setFilter(h,r,c={}){return this.style.setFilter(h,r,c),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,r,c,p={}){return this.style.setPaintProperty(h,r,c,p),this._update(!0)}getPaintProperty(h,r){return this.style.getPaintProperty(h,r)}setLayoutProperty(h,r,c,p={}){return this.style.setLayoutProperty(h,r,c,p),this._update(!0)}getLayoutProperty(h,r){return this.style.getLayoutProperty(h,r)}setLight(h,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(l.LngLat.convert(h),this.transform):0}setFeatureState(h,r){return this.style.setFeatureState(h,r),this._update()}removeFeatureState(h,r){return this.style.removeFeatureState(h,r),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let c,p,_,x=this._container;for(;x&&(!p||!_);){const C=l.window.getComputedStyle(x).transform;C&&"none"!==C&&(c=C.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&"0"!==c[0]&&"1"!==c[0]&&(p=c[0]),c[3]&&"0"!==c[3]&&"1"!==c[3]&&(_=c[3])),x=x.parentElement}this._containerWidth=p?Math.abs(h/p):h,this._containerHeight=_?Math.abs(r/_):r}_detectMissingCSS(){"rgb(250, 128, 114)"!==l.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&l.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=yt("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=yt("div","mapboxgl-canvas-container",h);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=yt("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=yt("div","mapboxgl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{p[_]=yt("div",`mapboxgl-ctrl-${_}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,r){const c=l.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(h),this._canvas.height=c*Math.ceil(r),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${r}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const r=this._markers.indexOf(h);-1!==r&&this._markers.splice(r,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const r=this._popups.indexOf(h);-1!==r&&this._popups.splice(r,1)}_setupPainter(){const h=l.extend({},ht.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._useWebGL2&&this._canvas.getContext("webgl2",h),c=r||this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);c?(this._useWebGL2&&!r&&l.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),l.storeAuthState(c,!0),this.painter=new fe(c,this.transform,!!r),this.on("data",p=>{"source"===p.dataType&&this.painter.setTileLoadedFlag(!0)}),l.exported$1.testSupport(c)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let r;const c=this.painter.context.extTimerQuery,p=l.exported.now();if(this.listens("gpu-timing-frame")&&(r=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],l.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],l.window.performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,N=this.transform.pitch,G=l.exported.now(),H=new l.EvaluationParameters(A,{now:G,fadeDuration:_,pitch:N,transition:this.style.getTransition()});this.style.update(H)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new l.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const A=l.exported.now()-p;c.endQueryEXT(c.TIME_ELAPSED_EXT,r),setTimeout(()=>{const N=c.getQueryObjectEXT(r,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(r),this.fire(new l.Event("gpu-timing-frame",{cpuTime:A,gpuTime:N})),l.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:N}})},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const N=this.painter.queryGpuTimers(A);this.fire(new l.Event("gpu-timing-layer",{layerTimes:N}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const N=this.painter.queryGpuTimeDeferredRender(A);this.fire(new l.Event("gpu-timing-deferred-render",{gpuTime:N}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(C||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(x=this._updateAverageElevation(p,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new l.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const N=this._calculateSpeedIndex();this.fire(new l.Event("speedindexcompleted",{speedIndex:N})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,l.LivePerformanceUtils.mark(l.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&l.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const r of this._markers)h&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!h||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(h,r=!1){const c=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((r||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation(),x=!1;this.transform.elevation&&(x=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=h;const C=Math.abs(p-_);if(C>1){if(this._isInitialLoad||x)return this._averageElevation.jumpTo(_),c(_);this._averageElevation.easeTo(_,h,300)}else if(C>1e-4)return this._averageElevation.jumpTo(_),c(_)}return!!this._averageElevation.isEasing(h)&&c(this._averageElevation.getValue(h))}_authenticate(){l.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===l.AUTH_ERR_MSG||401===h.status)){const r=this.painter.context.gl;l.storeAuthState(r,!1),this._logoControl instanceof V&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new l.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),l.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const c=this.painter.context.gl,p=c.createFramebuffer();function _(x){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,x,0);const C=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,C),C}return c.bindFramebuffer(c.FRAMEBUFFER,p),this._canvasPixelComparison(_(h),r.canvasCopies.map(_),r.timeStamps)}_canvasPixelComparison(h,r,c){let p=c[1]-c[0];const _=h.length/4;for(let x=0;x<r.length;x++){const C=r[x];let A=0;for(let N=0;N<C.length;N+=4)C[N]===h[N]&&C[N+1]===h[N+1]&&C[N+2]===h[N+2]&&C[N+3]===h[N+3]&&(A+=1);p+=(c[x+2]-c[x+1])*(1-A/_)}return p}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==l.window&&(l.window.removeEventListener("resize",this._onWindowResize,!1),l.window.removeEventListener("orientationchange",this._onWindowResize,!1),l.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),l.window.removeEventListener("online",this._onWindowOnline,!1),l.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),l.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=l.exported.frame(r=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(r)}))}_preloadTiles(h){const r=this.style?Object.values(this.style._sourceCaches):[];return l.asyncAll(r,(c,p)=>c._preloadTiles(h,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){"hidden"===l.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,r){l.setCacheLimits(h,r)}get version(){return l.version}},NavigationControl:class{constructor(h){this.options=l.extend({},Ha,h),this._container=yt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),yt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),yt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:r}):c.resetNorth({},{originalEvent:r}))}),this._compassIcon=yt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const r=h.getZoom(),c=r===h.getMaxZoom(),p=r===h.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new $l(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,r){const c=yt("button",h,this._container);return c.type="button",c.addEventListener("click",r),c}_setButtonTitle(h,r){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${r}`);h.setAttribute("aria-label",c),h.firstElementChild&&h.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends l.Evented{constructor(h){super(),this.options=l.extend({geolocation:l.window.navigator.geolocation},Il,h),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Yo(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=yt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const r=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,h(c)};void 0!==this._supportsGeolocation?h(this._supportsGeolocation):void 0!==l.window.navigator.permissions?l.window.navigator.permissions.query({name:"geolocation"}).then(c=>r("denied"!==c.state)).catch(()=>r()):r()}_isOutOfMapMaxBounds(h){const r=this._map.getMaxBounds(),c=h.coords;return!!r&&(c.longitude<r.getWest()||c.longitude>r.getEast()||c.latitude<r.getSouth()||c.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(h),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",h)),this._finish()}}_updateCamera(h){const r=new l.LngLat(h.coords.longitude,h.coords.latitude),c=h.coords.accuracy,p=this._map.getBearing(),_=l.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(c),_,{geolocateSource:!0})}_updateMarker(h){if(h){const r=new l.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,r=l.mercatorZfromAltitude(1,h._center.lat)*h.worldSize,c=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(1===h.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===h.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=yt("button","mapboxgl-ctrl-geolocate",this._container),yt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===h){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=yt("div","mapboxgl-user-location"),this._dotElement.appendChild(yt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(yt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new me({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=yt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new me({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:!0===h.absolute&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{l.window.addEventListener("ondeviceorientationabsolute"in l.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==l.window.DeviceMotionEvent&&"function"==typeof l.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),l.window.removeEventListener("deviceorientation",this._onDeviceOrientation),l.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:O,ScaleControl:class{constructor(h){this.options=l.extend({},Vl,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),l.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,r=this._map,c=r._containerHeight/2,p=r._containerWidth/2-h/2,_=r.unproject([p,c]),x=r.unproject([p+h,c]),C=_.distanceTo(x);if("imperial"===this.options.unit){const A=3.2808*C;A>5280?this._setScale(h,A/5280,"mile"):this._setScale(h,A,"foot")}else"nautical"===this.options.unit?this._setScale(h,C/1852,"nautical-mile"):C>=1e3?this._setScale(h,C/1e3,"kilometer"):this._setScale(h,C,"meter")}_setScale(h,r,c){this._map._requestDomTask(()=>{const p=function(x){const C=Math.pow(10,`${Math.floor(x)}`.length-1);let A=x/C;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(N){const G=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*G)/G}(A),C*A}(r),_=p/r;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==c?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(p):`${p}&nbsp;${Qa[c]}`,this._container.style.width=h*_+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=yt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof l.window.HTMLElement?this._container=h.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in l.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in l.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=yt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,l.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!l.window.document.fullscreenEnabled&&!l.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=yt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);yt("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),l.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(l.window.document.fullscreenElement||l.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?l.window.document.exitFullscreen?l.window.document.exitFullscreen():l.window.document.webkitCancelFullScreen&&l.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends l.Evented{constructor(h){super(),this.options=l.extend(Object.create(et),h),l.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=l.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(l.window.document.createTextNode(h))}setHTML(h){const r=l.window.document.createDocumentFragment(),c=l.window.document.createElement("body");let p;for(c.innerHTML=h;p=c.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=yt("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(h),this.options.closeButton){const c=this._closeButton=yt("button","mapboxgl-popup-close-button",r);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let r;return this._classList.delete(h)?r=!1:(this._classList.add(h),r=!0),this._updateClassList(),r}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const r=this._map,c=this._container,p=this._pos;if(!r||!c||!p)return"bottom";const _=c.offsetWidth,x=c.offsetHeight,C=p.x<_/2,A=p.x>r.transform.width-_/2;if(p.y+h<x)return C?"top-left":A?"top-right":"top";if(p.y>r.transform.height-x){if(C)return"bottom-left";if(A)return"bottom-right"}return C?"left":A?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),h.className=r.join(" ")}_update(h){const r=this._map,c=this._content;if(!r||!this._lngLat&&!this._trackPointer||!c)return;let p=this._container;if(p||(p=this._container=yt("div","mapboxgl-popup",r.getContainer()),this._tip=yt("div","mapboxgl-popup-tip",p),p.appendChild(c)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=q(this._lngLat,this._pos,r.transform)),!this._trackPointer||h){const _=this._pos=this._trackPointer&&h?h:r.project(this._lngLat),x=Yn(this.options.offset),C=this._anchor=this._getAnchor(x.y),A=Yn(this.options.offset,C),N=_.add(A).round();r._requestDomTask(()=>{this._container&&C&&(this._container.style.transform=`${ve[C]} translate(${N.x}px,${N.y}px)`)})}if(!this._marker&&r._showingGlobe()){const _=l.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(In);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:me,Style:zo,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.Point,MercatorCoordinate:l.MercatorCoordinate,FreeCameraOptions:Gi,Evented:l.Evented,config:l.config,prewarm:function(){no().acquire(ji)},clearPrewarmedResources:function(){const h=Di;h&&(h.isPreloaded()&&1===h.numActive()?(h.release(ji),Di=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return l.config.ACCESS_TOKEN},set accessToken(h){l.config.ACCESS_TOKEN=h},get baseApiUrl(){return l.config.API_URL},set baseApiUrl(h){l.config.API_URL=h},get workerCount(){return vr.workerCount},set workerCount(h){vr.workerCount=h},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){l.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){l.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:l.exported.setNow,restoreNow:l.exported.restoreNow};return Ml}),M}()},5619:(ci,Qt,le)=>{"use strict";le.d(Qt,{X:()=>b});var M=le(8645);class b extends M.x{constructor(l){super(),this._value=l}get value(){return this.getValue()}_subscribe(l){const Me=super._subscribe(l);return!Me.closed&&l.next(this._value),Me}getValue(){const{hasError:l,thrownError:Me,_value:ht}=this;if(l)throw Me;return this._throwIfClosed(),ht}next(l){super.next(this._value=l)}}},5592:(ci,Qt,le)=>{"use strict";le.d(Qt,{y:()=>pt});var M=le(305),b=le(7394),Ft=le(4850),l=le(8407),Me=le(2653),ht=le(4674),Ke=le(1441);let pt=(()=>{class bt{constructor(Qe){Qe&&(this._subscribe=Qe)}lift(Qe){const _t=new bt;return _t.source=this,_t.operator=Qe,_t}subscribe(Qe,_t,Wt){const Ct=function st(bt){return bt&&bt instanceof M.Lv||function Dt(bt){return bt&&(0,ht.m)(bt.next)&&(0,ht.m)(bt.error)&&(0,ht.m)(bt.complete)}(bt)&&(0,b.Nn)(bt)}(Qe)?Qe:new M.Hp(Qe,_t,Wt);return(0,Ke.x)(()=>{const{operator:it,source:Kt}=this;Ct.add(it?it.call(Ct,Kt):Kt?this._subscribe(Ct):this._trySubscribe(Ct))}),Ct}_trySubscribe(Qe){try{return this._subscribe(Qe)}catch(_t){Qe.error(_t)}}forEach(Qe,_t){return new(_t=yt(_t))((Wt,Ct)=>{const it=new M.Hp({next:Kt=>{try{Qe(Kt)}catch(Tt){Ct(Tt),it.unsubscribe()}},error:Ct,complete:Wt});this.subscribe(it)})}_subscribe(Qe){var _t;return null===(_t=this.source)||void 0===_t?void 0:_t.subscribe(Qe)}[Ft.L](){return this}pipe(...Qe){return(0,l.U)(Qe)(this)}toPromise(Qe){return new(Qe=yt(Qe))((_t,Wt)=>{let Ct;this.subscribe(it=>Ct=it,it=>Wt(it),()=>_t(Ct))})}}return bt.create=mt=>new bt(mt),bt})();function yt(bt){var mt;return null!==(mt=bt??Me.config.Promise)&&void 0!==mt?mt:Promise}},8645:(ci,Qt,le)=>{"use strict";le.d(Qt,{x:()=>Ke});var M=le(5592),b=le(7394);const l=(0,le(2306).d)(yt=>function(){yt(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Me=le(9039),ht=le(1441);let Ke=(()=>{class yt extends M.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(st){const bt=new pt(this,this);return bt.operator=st,bt}_throwIfClosed(){if(this.closed)throw new l}next(st){(0,ht.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const bt of this.currentObservers)bt.next(st)}})}error(st){(0,ht.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=st;const{observers:bt}=this;for(;bt.length;)bt.shift().error(st)}})}complete(){(0,ht.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:st}=this;for(;st.length;)st.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var st;return(null===(st=this.observers)||void 0===st?void 0:st.length)>0}_trySubscribe(st){return this._throwIfClosed(),super._trySubscribe(st)}_subscribe(st){return this._throwIfClosed(),this._checkFinalizedStatuses(st),this._innerSubscribe(st)}_innerSubscribe(st){const{hasError:bt,isStopped:mt,observers:Qe}=this;return bt||mt?b.Lc:(this.currentObservers=null,Qe.push(st),new b.w0(()=>{this.currentObservers=null,(0,Me.P)(Qe,st)}))}_checkFinalizedStatuses(st){const{hasError:bt,thrownError:mt,isStopped:Qe}=this;bt?st.error(mt):Qe&&st.complete()}asObservable(){const st=new M.y;return st.source=this,st}}return yt.create=(Dt,st)=>new pt(Dt,st),yt})();class pt extends Ke{constructor(Dt,st){super(),this.destination=Dt,this.source=st}next(Dt){var st,bt;null===(bt=null===(st=this.destination)||void 0===st?void 0:st.next)||void 0===bt||bt.call(st,Dt)}error(Dt){var st,bt;null===(bt=null===(st=this.destination)||void 0===st?void 0:st.error)||void 0===bt||bt.call(st,Dt)}complete(){var Dt,st;null===(st=null===(Dt=this.destination)||void 0===Dt?void 0:Dt.complete)||void 0===st||st.call(Dt)}_subscribe(Dt){var st,bt;return null!==(bt=null===(st=this.source)||void 0===st?void 0:st.subscribe(Dt))&&void 0!==bt?bt:b.Lc}}},305:(ci,Qt,le)=>{"use strict";le.d(Qt,{Hp:()=>Wt,Lv:()=>bt});var M=le(4674),b=le(7394),Ft=le(2653),l=le(3894),Me=le(2420);const ht=yt("C",void 0,void 0);function yt(Ze,Fe,$t){return{kind:Ze,value:Fe,error:$t}}var Dt=le(7599),st=le(1441);class bt extends b.w0{constructor(Fe){super(),this.isStopped=!1,Fe?(this.destination=Fe,(0,b.Nn)(Fe)&&Fe.add(this)):this.destination=Tt}static create(Fe,$t,un){return new Wt(Fe,$t,un)}next(Fe){this.isStopped?Kt(function pt(Ze){return yt("N",Ze,void 0)}(Fe),this):this._next(Fe)}error(Fe){this.isStopped?Kt(function Ke(Ze){return yt("E",void 0,Ze)}(Fe),this):(this.isStopped=!0,this._error(Fe))}complete(){this.isStopped?Kt(ht,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(Fe){this.destination.next(Fe)}_error(Fe){try{this.destination.error(Fe)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const mt=Function.prototype.bind;function Qe(Ze,Fe){return mt.call(Ze,Fe)}class _t{constructor(Fe){this.partialObserver=Fe}next(Fe){const{partialObserver:$t}=this;if($t.next)try{$t.next(Fe)}catch(un){Ct(un)}}error(Fe){const{partialObserver:$t}=this;if($t.error)try{$t.error(Fe)}catch(un){Ct(un)}else Ct(Fe)}complete(){const{partialObserver:Fe}=this;if(Fe.complete)try{Fe.complete()}catch($t){Ct($t)}}}class Wt extends bt{constructor(Fe,$t,un){let De;if(super(),(0,M.m)(Fe)||!Fe)De={next:Fe??void 0,error:$t??void 0,complete:un??void 0};else{let dt;this&&Ft.config.useDeprecatedNextContext?(dt=Object.create(Fe),dt.unsubscribe=()=>this.unsubscribe(),De={next:Fe.next&&Qe(Fe.next,dt),error:Fe.error&&Qe(Fe.error,dt),complete:Fe.complete&&Qe(Fe.complete,dt)}):De=Fe}this.destination=new _t(De)}}function Ct(Ze){Ft.config.useDeprecatedSynchronousErrorHandling?(0,st.O)(Ze):(0,l.h)(Ze)}function Kt(Ze,Fe){const{onStoppedNotification:$t}=Ft.config;$t&&Dt.z.setTimeout(()=>$t(Ze,Fe))}const Tt={closed:!0,next:Me.Z,error:function it(Ze){throw Ze},complete:Me.Z}},7394:(ci,Qt,le)=>{"use strict";le.d(Qt,{Lc:()=>ht,w0:()=>Me,Nn:()=>Ke});var M=le(4674);const Ft=(0,le(2306).d)(yt=>function(st){yt(this),this.message=st?`${st.length} errors occurred during unsubscription:\n${st.map((bt,mt)=>`${mt+1}) ${bt.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=st});var l=le(9039);class Me{constructor(Dt){this.initialTeardown=Dt,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let Dt;if(!this.closed){this.closed=!0;const{_parentage:st}=this;if(st)if(this._parentage=null,Array.isArray(st))for(const Qe of st)Qe.remove(this);else st.remove(this);const{initialTeardown:bt}=this;if((0,M.m)(bt))try{bt()}catch(Qe){Dt=Qe instanceof Ft?Qe.errors:[Qe]}const{_finalizers:mt}=this;if(mt){this._finalizers=null;for(const Qe of mt)try{pt(Qe)}catch(_t){Dt=Dt??[],_t instanceof Ft?Dt=[...Dt,..._t.errors]:Dt.push(_t)}}if(Dt)throw new Ft(Dt)}}add(Dt){var st;if(Dt&&Dt!==this)if(this.closed)pt(Dt);else{if(Dt instanceof Me){if(Dt.closed||Dt._hasParent(this))return;Dt._addParent(this)}(this._finalizers=null!==(st=this._finalizers)&&void 0!==st?st:[]).push(Dt)}}_hasParent(Dt){const{_parentage:st}=this;return st===Dt||Array.isArray(st)&&st.includes(Dt)}_addParent(Dt){const{_parentage:st}=this;this._parentage=Array.isArray(st)?(st.push(Dt),st):st?[st,Dt]:Dt}_removeParent(Dt){const{_parentage:st}=this;st===Dt?this._parentage=null:Array.isArray(st)&&(0,l.P)(st,Dt)}remove(Dt){const{_finalizers:st}=this;st&&(0,l.P)(st,Dt),Dt instanceof Me&&Dt._removeParent(this)}}Me.EMPTY=(()=>{const yt=new Me;return yt.closed=!0,yt})();const ht=Me.EMPTY;function Ke(yt){return yt instanceof Me||yt&&"closed"in yt&&(0,M.m)(yt.remove)&&(0,M.m)(yt.add)&&(0,M.m)(yt.unsubscribe)}function pt(yt){(0,M.m)(yt)?yt():yt.unsubscribe()}},2653:(ci,Qt,le)=>{"use strict";le.d(Qt,{config:()=>M});const M={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},2572:(ci,Qt,le)=>{"use strict";le.d(Qt,{a:()=>Dt});var M=le(5592),b=le(7453),Ft=le(7715),l=le(2737),Me=le(7400),ht=le(9940),Ke=le(2714),pt=le(8251),yt=le(7103);function Dt(...mt){const Qe=(0,ht.yG)(mt),_t=(0,ht.jO)(mt),{args:Wt,keys:Ct}=(0,b.D)(mt);if(0===Wt.length)return(0,Ft.D)([],Qe);const it=new M.y(function st(mt,Qe,_t=l.y){return Wt=>{bt(Qe,()=>{const{length:Ct}=mt,it=new Array(Ct);let Kt=Ct,Tt=Ct;for(let Ze=0;Ze<Ct;Ze++)bt(Qe,()=>{const Fe=(0,Ft.D)(mt[Ze],Qe);let $t=!1;Fe.subscribe((0,pt.x)(Wt,un=>{it[Ze]=un,$t||($t=!0,Tt--),Tt||Wt.next(_t(it.slice()))},()=>{--Kt||Wt.complete()}))},Wt)},Wt)}}(Wt,Qe,Ct?Kt=>(0,Ke.n)(Ct,Kt):l.y));return _t?it.pipe((0,Me.Z)(_t)):it}function bt(mt,Qe,_t){mt?(0,yt.f)(_t,mt,Qe):Qe()}},5211:(ci,Qt,le)=>{"use strict";le.d(Qt,{z:()=>Me});var M=le(7537),Ft=le(9940),l=le(7715);function Me(...ht){return function b(){return(0,M.J)(1)}()((0,l.D)(ht,(0,Ft.yG)(ht)))}},4911:(ci,Qt,le)=>{"use strict";le.d(Qt,{P:()=>Ft});var M=le(5592),b=le(4829);function Ft(l){return new M.y(Me=>{(0,b.Xf)(l()).subscribe(Me)})}},6232:(ci,Qt,le)=>{"use strict";le.d(Qt,{E:()=>b});const b=new(le(5592).y)(Me=>Me.complete())},7715:(ci,Qt,le)=>{"use strict";le.d(Qt,{D:()=>un});var M=le(4829),b=le(7103),Ft=le(9360),l=le(8251);function Me(De,dt=0){return(0,Ft.e)((Lt,ft)=>{Lt.subscribe((0,l.x)(ft,pn=>(0,b.f)(ft,De,()=>ft.next(pn),dt),()=>(0,b.f)(ft,De,()=>ft.complete(),dt),pn=>(0,b.f)(ft,De,()=>ft.error(pn),dt)))})}function ht(De,dt=0){return(0,Ft.e)((Lt,ft)=>{ft.add(De.schedule(()=>Lt.subscribe(ft),dt))})}var yt=le(5592),st=le(4971),bt=le(4674);function Qe(De,dt){if(!De)throw new Error("Iterable cannot be null");return new yt.y(Lt=>{(0,b.f)(Lt,dt,()=>{const ft=De[Symbol.asyncIterator]();(0,b.f)(Lt,dt,()=>{ft.next().then(pn=>{pn.done?Lt.complete():Lt.next(pn.value)})},0,!0)})})}var _t=le(8382),Wt=le(4026),Ct=le(4266),it=le(3664),Kt=le(5726),Tt=le(9853),Ze=le(541);function un(De,dt){return dt?function $t(De,dt){if(null!=De){if((0,_t.c)(De))return function Ke(De,dt){return(0,M.Xf)(De).pipe(ht(dt),Me(dt))}(De,dt);if((0,Ct.z)(De))return function Dt(De,dt){return new yt.y(Lt=>{let ft=0;return dt.schedule(function(){ft===De.length?Lt.complete():(Lt.next(De[ft++]),Lt.closed||this.schedule())})})}(De,dt);if((0,Wt.t)(De))return function pt(De,dt){return(0,M.Xf)(De).pipe(ht(dt),Me(dt))}(De,dt);if((0,Kt.D)(De))return Qe(De,dt);if((0,it.T)(De))return function mt(De,dt){return new yt.y(Lt=>{let ft;return(0,b.f)(Lt,dt,()=>{ft=De[st.h](),(0,b.f)(Lt,dt,()=>{let pn,hn;try{({value:pn,done:hn}=ft.next())}catch(Vt){return void Lt.error(Vt)}hn?Lt.complete():Lt.next(pn)},0,!0)}),()=>(0,bt.m)(ft?.return)&&ft.return()})}(De,dt);if((0,Ze.L)(De))return function Fe(De,dt){return Qe((0,Ze.Q)(De),dt)}(De,dt)}throw(0,Tt.z)(De)}(De,dt):(0,M.Xf)(De)}},2438:(ci,Qt,le)=>{"use strict";le.d(Qt,{R:()=>Dt});var M=le(4829),b=le(5592),Ft=le(1631),l=le(4266),Me=le(4674),ht=le(7400);const Ke=["addListener","removeListener"],pt=["addEventListener","removeEventListener"],yt=["on","off"];function Dt(_t,Wt,Ct,it){if((0,Me.m)(Ct)&&(it=Ct,Ct=void 0),it)return Dt(_t,Wt,Ct).pipe((0,ht.Z)(it));const[Kt,Tt]=function Qe(_t){return(0,Me.m)(_t.addEventListener)&&(0,Me.m)(_t.removeEventListener)}(_t)?pt.map(Ze=>Fe=>_t[Ze](Wt,Fe,Ct)):function bt(_t){return(0,Me.m)(_t.addListener)&&(0,Me.m)(_t.removeListener)}(_t)?Ke.map(st(_t,Wt)):function mt(_t){return(0,Me.m)(_t.on)&&(0,Me.m)(_t.off)}(_t)?yt.map(st(_t,Wt)):[];if(!Kt&&(0,l.z)(_t))return(0,Ft.z)(Ze=>Dt(Ze,Wt,Ct))((0,M.Xf)(_t));if(!Kt)throw new TypeError("Invalid event target");return new b.y(Ze=>{const Fe=(...$t)=>Ze.next(1<$t.length?$t:$t[0]);return Kt(Fe),()=>Tt(Fe)})}function st(_t,Wt){return Ct=>it=>_t[Ct](Wt,it)}},4829:(ci,Qt,le)=>{"use strict";le.d(Qt,{Xf:()=>mt});var M=le(7582),b=le(4266),Ft=le(4026),l=le(5592),Me=le(8382),ht=le(5726),Ke=le(9853),pt=le(3664),yt=le(541),Dt=le(4674),st=le(3894),bt=le(4850);function mt(Ze){if(Ze instanceof l.y)return Ze;if(null!=Ze){if((0,Me.c)(Ze))return function Qe(Ze){return new l.y(Fe=>{const $t=Ze[bt.L]();if((0,Dt.m)($t.subscribe))return $t.subscribe(Fe);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(Ze);if((0,b.z)(Ze))return function _t(Ze){return new l.y(Fe=>{for(let $t=0;$t<Ze.length&&!Fe.closed;$t++)Fe.next(Ze[$t]);Fe.complete()})}(Ze);if((0,Ft.t)(Ze))return function Wt(Ze){return new l.y(Fe=>{Ze.then($t=>{Fe.closed||(Fe.next($t),Fe.complete())},$t=>Fe.error($t)).then(null,st.h)})}(Ze);if((0,ht.D)(Ze))return it(Ze);if((0,pt.T)(Ze))return function Ct(Ze){return new l.y(Fe=>{for(const $t of Ze)if(Fe.next($t),Fe.closed)return;Fe.complete()})}(Ze);if((0,yt.L)(Ze))return function Kt(Ze){return it((0,yt.Q)(Ze))}(Ze)}throw(0,Ke.z)(Ze)}function it(Ze){return new l.y(Fe=>{(function Tt(Ze,Fe){var $t,un,De,dt;return(0,M.mG)(this,void 0,void 0,function*(){try{for($t=(0,M.KL)(Ze);!(un=yield $t.next()).done;)if(Fe.next(un.value),Fe.closed)return}catch(Lt){De={error:Lt}}finally{try{un&&!un.done&&(dt=$t.return)&&(yield dt.call($t))}finally{if(De)throw De.error}}Fe.complete()})})(Ze,Fe).catch($t=>Fe.error($t))})}},3019:(ci,Qt,le)=>{"use strict";le.d(Qt,{T:()=>ht});var M=le(7537),b=le(4829),Ft=le(6232),l=le(9940),Me=le(7715);function ht(...Ke){const pt=(0,l.yG)(Ke),yt=(0,l._6)(Ke,1/0),Dt=Ke;return Dt.length?1===Dt.length?(0,b.Xf)(Dt[0]):(0,M.J)(yt)((0,Me.D)(Dt,pt)):Ft.E}},2096:(ci,Qt,le)=>{"use strict";le.d(Qt,{of:()=>Ft});var M=le(9940),b=le(7715);function Ft(...l){const Me=(0,M.yG)(l);return(0,b.D)(l,Me)}},8251:(ci,Qt,le)=>{"use strict";le.d(Qt,{x:()=>b});var M=le(305);function b(l,Me,ht,Ke,pt){return new Ft(l,Me,ht,Ke,pt)}class Ft extends M.Lv{constructor(Me,ht,Ke,pt,yt,Dt){super(Me),this.onFinalize=yt,this.shouldUnsubscribe=Dt,this._next=ht?function(st){try{ht(st)}catch(bt){Me.error(bt)}}:super._next,this._error=pt?function(st){try{pt(st)}catch(bt){Me.error(bt)}finally{this.unsubscribe()}}:super._error,this._complete=Ke?function(){try{Ke()}catch(st){Me.error(st)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var Me;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:ht}=this;super.unsubscribe(),!ht&&(null===(Me=this.onFinalize)||void 0===Me||Me.call(this))}}}},3997:(ci,Qt,le)=>{"use strict";le.d(Qt,{x:()=>l});var M=le(2737),b=le(9360),Ft=le(8251);function l(ht,Ke=M.y){return ht=ht??Me,(0,b.e)((pt,yt)=>{let Dt,st=!0;pt.subscribe((0,Ft.x)(yt,bt=>{const mt=Ke(bt);(st||!ht(Dt,mt))&&(st=!1,Dt=mt,yt.next(bt))}))})}function Me(ht,Ke){return ht===Ke}},2181:(ci,Qt,le)=>{"use strict";le.d(Qt,{h:()=>Ft});var M=le(9360),b=le(8251);function Ft(l,Me){return(0,M.e)((ht,Ke)=>{let pt=0;ht.subscribe((0,b.x)(Ke,yt=>l.call(Me,yt,pt++)&&Ke.next(yt)))})}},7398:(ci,Qt,le)=>{"use strict";le.d(Qt,{U:()=>Ft});var M=le(9360),b=le(8251);function Ft(l,Me){return(0,M.e)((ht,Ke)=>{let pt=0;ht.subscribe((0,b.x)(Ke,yt=>{Ke.next(l.call(Me,yt,pt++))}))})}},7537:(ci,Qt,le)=>{"use strict";le.d(Qt,{J:()=>Ft});var M=le(1631),b=le(2737);function Ft(l=1/0){return(0,M.z)(b.y,l)}},1631:(ci,Qt,le)=>{"use strict";le.d(Qt,{z:()=>pt});var M=le(7398),b=le(4829),Ft=le(9360),l=le(7103),Me=le(8251),Ke=le(4674);function pt(yt,Dt,st=1/0){return(0,Ke.m)(Dt)?pt((bt,mt)=>(0,M.U)((Qe,_t)=>Dt(bt,Qe,mt,_t))((0,b.Xf)(yt(bt,mt))),st):("number"==typeof Dt&&(st=Dt),(0,Ft.e)((bt,mt)=>function ht(yt,Dt,st,bt,mt,Qe,_t,Wt){const Ct=[];let it=0,Kt=0,Tt=!1;const Ze=()=>{Tt&&!Ct.length&&!it&&Dt.complete()},Fe=un=>it<bt?$t(un):Ct.push(un),$t=un=>{Qe&&Dt.next(un),it++;let De=!1;(0,b.Xf)(st(un,Kt++)).subscribe((0,Me.x)(Dt,dt=>{mt?.(dt),Qe?Fe(dt):Dt.next(dt)},()=>{De=!0},void 0,()=>{if(De)try{for(it--;Ct.length&&it<bt;){const dt=Ct.shift();_t?(0,l.f)(Dt,_t,()=>$t(dt)):$t(dt)}Ze()}catch(dt){Dt.error(dt)}}))};return yt.subscribe((0,Me.x)(Dt,Fe,()=>{Tt=!0,Ze()})),()=>{Wt?.()}}(bt,mt,yt,st)))}},7921:(ci,Qt,le)=>{"use strict";le.d(Qt,{O:()=>l});var M=le(5211),b=le(9940),Ft=le(9360);function l(...Me){const ht=(0,b.yG)(Me);return(0,Ft.e)((Ke,pt)=>{(ht?(0,M.z)(Me,Ke,ht):(0,M.z)(Me,Ke)).subscribe(pt)})}},4664:(ci,Qt,le)=>{"use strict";le.d(Qt,{w:()=>l});var M=le(4829),b=le(9360),Ft=le(8251);function l(Me,ht){return(0,b.e)((Ke,pt)=>{let yt=null,Dt=0,st=!1;const bt=()=>st&&!yt&&pt.complete();Ke.subscribe((0,Ft.x)(pt,mt=>{yt?.unsubscribe();let Qe=0;const _t=Dt++;(0,M.Xf)(Me(mt,_t)).subscribe(yt=(0,Ft.x)(pt,Wt=>pt.next(ht?ht(mt,Wt,_t,Qe++):Wt),()=>{yt=null,bt()}))},()=>{st=!0,bt()}))})}},8180:(ci,Qt,le)=>{"use strict";le.d(Qt,{q:()=>l});var M=le(6232),b=le(9360),Ft=le(8251);function l(Me){return Me<=0?()=>M.E:(0,b.e)((ht,Ke)=>{let pt=0;ht.subscribe((0,Ft.x)(Ke,yt=>{++pt<=Me&&(Ke.next(yt),Me<=pt&&Ke.complete())}))})}},9397:(ci,Qt,le)=>{"use strict";le.d(Qt,{b:()=>Me});var M=le(4674),b=le(9360),Ft=le(8251),l=le(2737);function Me(ht,Ke,pt){const yt=(0,M.m)(ht)||Ke||pt?{next:ht,error:Ke,complete:pt}:ht;return yt?(0,b.e)((Dt,st)=>{var bt;null===(bt=yt.subscribe)||void 0===bt||bt.call(yt);let mt=!0;Dt.subscribe((0,Ft.x)(st,Qe=>{var _t;null===(_t=yt.next)||void 0===_t||_t.call(yt,Qe),st.next(Qe)},()=>{var Qe;mt=!1,null===(Qe=yt.complete)||void 0===Qe||Qe.call(yt),st.complete()},Qe=>{var _t;mt=!1,null===(_t=yt.error)||void 0===_t||_t.call(yt,Qe),st.error(Qe)},()=>{var Qe,_t;mt&&(null===(Qe=yt.unsubscribe)||void 0===Qe||Qe.call(yt)),null===(_t=yt.finalize)||void 0===_t||_t.call(yt)}))}):l.y}},7599:(ci,Qt,le)=>{"use strict";le.d(Qt,{z:()=>M});const M={setTimeout(b,Ft,...l){const{delegate:Me}=M;return Me?.setTimeout?Me.setTimeout(b,Ft,...l):setTimeout(b,Ft,...l)},clearTimeout(b){const{delegate:Ft}=M;return(Ft?.clearTimeout||clearTimeout)(b)},delegate:void 0}},4971:(ci,Qt,le)=>{"use strict";le.d(Qt,{h:()=>b});const b=function M(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},4850:(ci,Qt,le)=>{"use strict";le.d(Qt,{L:()=>M});const M="function"==typeof Symbol&&Symbol.observable||"@@observable"},9940:(ci,Qt,le)=>{"use strict";le.d(Qt,{_6:()=>ht,jO:()=>l,yG:()=>Me});var M=le(4674),b=le(671);function Ft(Ke){return Ke[Ke.length-1]}function l(Ke){return(0,M.m)(Ft(Ke))?Ke.pop():void 0}function Me(Ke){return(0,b.K)(Ft(Ke))?Ke.pop():void 0}function ht(Ke,pt){return"number"==typeof Ft(Ke)?Ke.pop():pt}},7453:(ci,Qt,le)=>{"use strict";le.d(Qt,{D:()=>Me});const{isArray:M}=Array,{getPrototypeOf:b,prototype:Ft,keys:l}=Object;function Me(Ke){if(1===Ke.length){const pt=Ke[0];if(M(pt))return{args:pt,keys:null};if(function ht(Ke){return Ke&&"object"==typeof Ke&&b(Ke)===Ft}(pt)){const yt=l(pt);return{args:yt.map(Dt=>pt[Dt]),keys:yt}}}return{args:Ke,keys:null}}},9039:(ci,Qt,le)=>{"use strict";function M(b,Ft){if(b){const l=b.indexOf(Ft);0<=l&&b.splice(l,1)}}le.d(Qt,{P:()=>M})},2306:(ci,Qt,le)=>{"use strict";function M(b){const l=b(Me=>{Error.call(Me),Me.stack=(new Error).stack});return l.prototype=Object.create(Error.prototype),l.prototype.constructor=l,l}le.d(Qt,{d:()=>M})},2714:(ci,Qt,le)=>{"use strict";function M(b,Ft){return b.reduce((l,Me,ht)=>(l[Me]=Ft[ht],l),{})}le.d(Qt,{n:()=>M})},1441:(ci,Qt,le)=>{"use strict";le.d(Qt,{O:()=>l,x:()=>Ft});var M=le(2653);let b=null;function Ft(Me){if(M.config.useDeprecatedSynchronousErrorHandling){const ht=!b;if(ht&&(b={errorThrown:!1,error:null}),Me(),ht){const{errorThrown:Ke,error:pt}=b;if(b=null,Ke)throw pt}}else Me()}function l(Me){M.config.useDeprecatedSynchronousErrorHandling&&b&&(b.errorThrown=!0,b.error=Me)}},7103:(ci,Qt,le)=>{"use strict";function M(b,Ft,l,Me=0,ht=!1){const Ke=Ft.schedule(function(){l(),ht?b.add(this.schedule(null,Me)):this.unsubscribe()},Me);if(b.add(Ke),!ht)return Ke}le.d(Qt,{f:()=>M})},2737:(ci,Qt,le)=>{"use strict";function M(b){return b}le.d(Qt,{y:()=>M})},4266:(ci,Qt,le)=>{"use strict";le.d(Qt,{z:()=>M});const M=b=>b&&"number"==typeof b.length&&"function"!=typeof b},5726:(ci,Qt,le)=>{"use strict";le.d(Qt,{D:()=>b});var M=le(4674);function b(Ft){return Symbol.asyncIterator&&(0,M.m)(Ft?.[Symbol.asyncIterator])}},4674:(ci,Qt,le)=>{"use strict";function M(b){return"function"==typeof b}le.d(Qt,{m:()=>M})},8382:(ci,Qt,le)=>{"use strict";le.d(Qt,{c:()=>Ft});var M=le(4850),b=le(4674);function Ft(l){return(0,b.m)(l[M.L])}},3664:(ci,Qt,le)=>{"use strict";le.d(Qt,{T:()=>Ft});var M=le(4971),b=le(4674);function Ft(l){return(0,b.m)(l?.[M.h])}},4026:(ci,Qt,le)=>{"use strict";le.d(Qt,{t:()=>b});var M=le(4674);function b(Ft){return(0,M.m)(Ft?.then)}},541:(ci,Qt,le)=>{"use strict";le.d(Qt,{L:()=>l,Q:()=>Ft});var M=le(7582),b=le(4674);function Ft(Me){return(0,M.FC)(this,arguments,function*(){const Ke=Me.getReader();try{for(;;){const{value:pt,done:yt}=yield(0,M.qq)(Ke.read());if(yt)return yield(0,M.qq)(void 0);yield yield(0,M.qq)(pt)}}finally{Ke.releaseLock()}})}function l(Me){return(0,b.m)(Me?.getReader)}},671:(ci,Qt,le)=>{"use strict";le.d(Qt,{K:()=>b});var M=le(4674);function b(Ft){return Ft&&(0,M.m)(Ft.schedule)}},9360:(ci,Qt,le)=>{"use strict";le.d(Qt,{A:()=>b,e:()=>Ft});var M=le(4674);function b(l){return(0,M.m)(l?.lift)}function Ft(l){return Me=>{if(b(Me))return Me.lift(function(ht){try{return l(ht,this)}catch(Ke){this.error(Ke)}});throw new TypeError("Unable to lift unknown Observable type")}}},7400:(ci,Qt,le)=>{"use strict";le.d(Qt,{Z:()=>l});var M=le(7398);const{isArray:b}=Array;function l(Me){return(0,M.U)(ht=>function Ft(Me,ht){return b(ht)?Me(...ht):Me(ht)}(Me,ht))}},2420:(ci,Qt,le)=>{"use strict";function M(){}le.d(Qt,{Z:()=>M})},8407:(ci,Qt,le)=>{"use strict";le.d(Qt,{U:()=>Ft,z:()=>b});var M=le(2737);function b(...l){return Ft(l)}function Ft(l){return 0===l.length?M.y:1===l.length?l[0]:function(ht){return l.reduce((Ke,pt)=>pt(Ke),ht)}}},3894:(ci,Qt,le)=>{"use strict";le.d(Qt,{h:()=>Ft});var M=le(2653),b=le(7599);function Ft(l){b.z.setTimeout(()=>{const{onUnhandledError:Me}=M.config;if(!Me)throw l;Me(l)})}},9853:(ci,Qt,le)=>{"use strict";function M(b){return new TypeError(`You provided ${null!==b&&"object"==typeof b?"an invalid object":`'${b}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}le.d(Qt,{z:()=>M})},863:(ci,Qt,le)=>{var M={"./ion-accordion_2.entry.js":[8484,8592,8484],"./ion-action-sheet.entry.js":[9882,8592,9882],"./ion-alert.entry.js":[6304,8592,6304],"./ion-app_8.entry.js":[5860,8592,5860],"./ion-avatar_3.entry.js":[3544,3544],"./ion-back-button.entry.js":[505,8592,505],"./ion-backdrop.entry.js":[469,469],"./ion-breadcrumb_2.entry.js":[9857,8592,9857],"./ion-button_2.entry.js":[1372,1372],"./ion-card_5.entry.js":[3150,3150],"./ion-checkbox.entry.js":[7635,8592,7635],"./ion-chip.entry.js":[6673,6673],"./ion-col_3.entry.js":[1315,1315],"./ion-datetime-button.entry.js":[433,982,433],"./ion-datetime_3.entry.js":[7059,982,8592,7059],"./ion-fab_3.entry.js":[4087,8592,4087],"./ion-img.entry.js":[1745,1745],"./ion-infinite-scroll_2.entry.js":[9352,8592,9352],"./ion-input.entry.js":[4530,8592,4530],"./ion-item-option_3.entry.js":[8633,8592,8633],"./ion-item_8.entry.js":[5962,8592,5962],"./ion-loading.entry.js":[3483,3483],"./ion-menu_3.entry.js":[2939,8592,8382],"./ion-modal.entry.js":[8577,8592,8577],"./ion-nav_2.entry.js":[5675,8592,5675],"./ion-picker-column-internal.entry.js":[9992,8592,9992],"./ion-picker-internal.entry.js":[9820,9820],"./ion-popover.entry.js":[185,185],"./ion-progress-bar.entry.js":[5454,5454],"./ion-radio_2.entry.js":[4458,8592,4458],"./ion-range.entry.js":[7666,8592,7666],"./ion-refresher_2.entry.js":[7219,8592,7219],"./ion-reorder_2.entry.js":[2975,8592,2975],"./ion-ripple-effect.entry.js":[7465,7465],"./ion-route_4.entry.js":[4764,4764],"./ion-searchbar.entry.js":[3998,8592,3998],"./ion-segment_2.entry.js":[3672,8592,3672],"./ion-select_3.entry.js":[6754,8592,6754],"./ion-spinner.entry.js":[9588,8592,9588],"./ion-split-pane.entry.js":[9793,9793],"./ion-tab-bar_2.entry.js":[4090,8592,4090],"./ion-tab_2.entry.js":[2841,2841],"./ion-text.entry.js":[8811,8811],"./ion-textarea.entry.js":[3734,8592,3734],"./ion-toast.entry.js":[6642,6642],"./ion-toggle.entry.js":[8866,8592,8866]};function b(Ft){if(!le.o(M,Ft))return Promise.resolve().then(()=>{var ht=new Error("Cannot find module '"+Ft+"'");throw ht.code="MODULE_NOT_FOUND",ht});var l=M[Ft],Me=l[0];return Promise.all(l.slice(1).map(le.e)).then(()=>le(Me))}b.keys=()=>Object.keys(M),b.id=863,ci.exports=b},6825:(ci,Qt,le)=>{"use strict";le.d(Qt,{IO:()=>_t,LC:()=>b,SB:()=>yt,X$:()=>l,ZE:()=>it,ZN:()=>Ct,_j:()=>M,eR:()=>st,jt:()=>Me,k1:()=>Kt,l3:()=>Ft,oB:()=>pt,pV:()=>mt,vP:()=>Ke});class M{}class b{}const Ft="*";function l(Tt,Ze){return{type:7,name:Tt,definitions:Ze,options:{}}}function Me(Tt,Ze=null){return{type:4,styles:Ze,timings:Tt}}function Ke(Tt,Ze=null){return{type:2,steps:Tt,options:Ze}}function pt(Tt){return{type:6,styles:Tt,offset:null}}function yt(Tt,Ze,Fe){return{type:0,name:Tt,styles:Ze,options:Fe}}function st(Tt,Ze,Fe=null){return{type:1,expr:Tt,animation:Ze,options:Fe}}function mt(Tt=null){return{type:9,options:Tt}}function _t(Tt,Ze,Fe=null){return{type:11,selector:Tt,animation:Ze,options:Fe}}class Ct{constructor(Ze=0,Fe=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=Ze+Fe}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(Ze=>Ze()),this._onDoneFns=[])}onStart(Ze){this._originalOnStartFns.push(Ze),this._onStartFns.push(Ze)}onDone(Ze){this._originalOnDoneFns.push(Ze),this._onDoneFns.push(Ze)}onDestroy(Ze){this._onDestroyFns.push(Ze)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(Ze=>Ze()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(Ze=>Ze()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(Ze){this._position=this.totalTime?Ze*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(Ze){const Fe="start"==Ze?this._onStartFns:this._onDoneFns;Fe.forEach($t=>$t()),Fe.length=0}}class it{constructor(Ze){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=Ze;let Fe=0,$t=0,un=0;const De=this.players.length;0==De?queueMicrotask(()=>this._onFinish()):this.players.forEach(dt=>{dt.onDone(()=>{++Fe==De&&this._onFinish()}),dt.onDestroy(()=>{++$t==De&&this._onDestroy()}),dt.onStart(()=>{++un==De&&this._onStart()})}),this.totalTime=this.players.reduce((dt,Lt)=>Math.max(dt,Lt.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(Ze=>Ze()),this._onDoneFns=[])}init(){this.players.forEach(Ze=>Ze.init())}onStart(Ze){this._onStartFns.push(Ze)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(Ze=>Ze()),this._onStartFns=[])}onDone(Ze){this._onDoneFns.push(Ze)}onDestroy(Ze){this._onDestroyFns.push(Ze)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(Ze=>Ze.play())}pause(){this.players.forEach(Ze=>Ze.pause())}restart(){this.players.forEach(Ze=>Ze.restart())}finish(){this._onFinish(),this.players.forEach(Ze=>Ze.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(Ze=>Ze.destroy()),this._onDestroyFns.forEach(Ze=>Ze()),this._onDestroyFns=[])}reset(){this.players.forEach(Ze=>Ze.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(Ze){const Fe=Ze*this.totalTime;this.players.forEach($t=>{const un=$t.totalTime?Math.min(1,Fe/$t.totalTime):1;$t.setPosition(un)})}getPosition(){const Ze=this.players.reduce((Fe,$t)=>null===Fe||$t.totalTime>Fe.totalTime?$t:Fe,null);return null!=Ze?Ze.getPosition():0}beforeDestroy(){this.players.forEach(Ze=>{Ze.beforeDestroy&&Ze.beforeDestroy()})}triggerCallback(Ze){const Fe="start"==Ze?this._onStartFns:this._onDoneFns;Fe.forEach($t=>$t()),Fe.length=0}}const Kt="!"},6814:(ci,Qt,le)=>{"use strict";le.d(Qt,{Do:()=>Wt,ED:()=>ge,EM:()=>ss,HT:()=>l,JF:()=>fs,K0:()=>ht,Mx:()=>xr,NF:()=>_o,O5:()=>Yr,PM:()=>So,RF:()=>se,S$:()=>mt,V_:()=>pt,Ye:()=>Ct,b0:()=>_t,bD:()=>Os,ez:()=>ts,mk:()=>Gt,n9:()=>Oe,q:()=>Ft,sg:()=>es,tP:()=>mn,w_:()=>Me});var M=le(9468);let b=null;function Ft(){return b}function l(F){b||(b=F)}class Me{}const ht=new M.OlP("DocumentToken");let Ke=(()=>{var F;class X{historyGo(j){throw new Error("Not implemented")}}return(F=X).\u0275fac=function(j){return new(j||F)},F.\u0275prov=M.Yz7({token:F,factory:function(){return(0,M.f3M)(yt)},providedIn:"platform"}),X})();const pt=new M.OlP("Location Initialized");let yt=(()=>{var F;class X extends Ke{constructor(){super(),this._doc=(0,M.f3M)(ht),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ft().getBaseHref(this._doc)}onPopState(j){const fe=Ft().getGlobalEventTarget(this._doc,"window");return fe.addEventListener("popstate",j,!1),()=>fe.removeEventListener("popstate",j)}onHashChange(j){const fe=Ft().getGlobalEventTarget(this._doc,"window");return fe.addEventListener("hashchange",j,!1),()=>fe.removeEventListener("hashchange",j)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(j){this._location.pathname=j}pushState(j,fe,Xe){this._history.pushState(j,fe,Xe)}replaceState(j,fe,Xe){this._history.replaceState(j,fe,Xe)}forward(){this._history.forward()}back(){this._history.back()}historyGo(j=0){this._history.go(j)}getState(){return this._history.state}}return(F=X).\u0275fac=function(j){return new(j||F)},F.\u0275prov=M.Yz7({token:F,factory:function(){return new F},providedIn:"platform"}),X})();function Dt(F,X){if(0==F.length)return X;if(0==X.length)return F;let ye=0;return F.endsWith("/")&&ye++,X.startsWith("/")&&ye++,2==ye?F+X.substring(1):1==ye?F+X:F+"/"+X}function st(F){const X=F.match(/#|\?|$/),ye=X&&X.index||F.length;return F.slice(0,ye-("/"===F[ye-1]?1:0))+F.slice(ye)}function bt(F){return F&&"?"!==F[0]?"?"+F:F}let mt=(()=>{var F;class X{historyGo(j){throw new Error("Not implemented")}}return(F=X).\u0275fac=function(j){return new(j||F)},F.\u0275prov=M.Yz7({token:F,factory:function(){return(0,M.f3M)(_t)},providedIn:"root"}),X})();const Qe=new M.OlP("appBaseHref");let _t=(()=>{var F;class X extends mt{constructor(j,fe){super(),this._platformLocation=j,this._removeListenerFns=[],this._baseHref=fe??this._platformLocation.getBaseHrefFromDOM()??(0,M.f3M)(ht).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(j){this._removeListenerFns.push(this._platformLocation.onPopState(j),this._platformLocation.onHashChange(j))}getBaseHref(){return this._baseHref}prepareExternalUrl(j){return Dt(this._baseHref,j)}path(j=!1){const fe=this._platformLocation.pathname+bt(this._platformLocation.search),Xe=this._platformLocation.hash;return Xe&&j?`${fe}${Xe}`:fe}pushState(j,fe,Xe,rn){const _n=this.prepareExternalUrl(Xe+bt(rn));this._platformLocation.pushState(j,fe,_n)}replaceState(j,fe,Xe,rn){const _n=this.prepareExternalUrl(Xe+bt(rn));this._platformLocation.replaceState(j,fe,_n)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(j=0){this._platformLocation.historyGo?.(j)}}return(F=X).\u0275fac=function(j){return new(j||F)(M.LFG(Ke),M.LFG(Qe,8))},F.\u0275prov=M.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"}),X})(),Wt=(()=>{var F;class X extends mt{constructor(j,fe){super(),this._platformLocation=j,this._baseHref="",this._removeListenerFns=[],null!=fe&&(this._baseHref=fe)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(j){this._removeListenerFns.push(this._platformLocation.onPopState(j),this._platformLocation.onHashChange(j))}getBaseHref(){return this._baseHref}path(j=!1){let fe=this._platformLocation.hash;return null==fe&&(fe="#"),fe.length>0?fe.substring(1):fe}prepareExternalUrl(j){const fe=Dt(this._baseHref,j);return fe.length>0?"#"+fe:fe}pushState(j,fe,Xe,rn){let _n=this.prepareExternalUrl(Xe+bt(rn));0==_n.length&&(_n=this._platformLocation.pathname),this._platformLocation.pushState(j,fe,_n)}replaceState(j,fe,Xe,rn){let _n=this.prepareExternalUrl(Xe+bt(rn));0==_n.length&&(_n=this._platformLocation.pathname),this._platformLocation.replaceState(j,fe,_n)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(j=0){this._platformLocation.historyGo?.(j)}}return(F=X).\u0275fac=function(j){return new(j||F)(M.LFG(Ke),M.LFG(Qe,8))},F.\u0275prov=M.Yz7({token:F,factory:F.\u0275fac}),X})(),Ct=(()=>{var F;class X{constructor(j){this._subject=new M.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=j;const fe=this._locationStrategy.getBaseHref();this._basePath=function Ze(F){if(new RegExp("^(https?:)?//").test(F)){const[,ye]=F.split(/\/\/[^\/]+/);return ye}return F}(st(Tt(fe))),this._locationStrategy.onPopState(Xe=>{this._subject.emit({url:this.path(!0),pop:!0,state:Xe.state,type:Xe.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(j=!1){return this.normalize(this._locationStrategy.path(j))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(j,fe=""){return this.path()==this.normalize(j+bt(fe))}normalize(j){return X.stripTrailingSlash(function Kt(F,X){if(!F||!X.startsWith(F))return X;const ye=X.substring(F.length);return""===ye||["/",";","?","#"].includes(ye[0])?ye:X}(this._basePath,Tt(j)))}prepareExternalUrl(j){return j&&"/"!==j[0]&&(j="/"+j),this._locationStrategy.prepareExternalUrl(j)}go(j,fe="",Xe=null){this._locationStrategy.pushState(Xe,"",j,fe),this._notifyUrlChangeListeners(this.prepareExternalUrl(j+bt(fe)),Xe)}replaceState(j,fe="",Xe=null){this._locationStrategy.replaceState(Xe,"",j,fe),this._notifyUrlChangeListeners(this.prepareExternalUrl(j+bt(fe)),Xe)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(j=0){this._locationStrategy.historyGo?.(j)}onUrlChange(j){return this._urlChangeListeners.push(j),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(fe=>{this._notifyUrlChangeListeners(fe.url,fe.state)})),()=>{const fe=this._urlChangeListeners.indexOf(j);this._urlChangeListeners.splice(fe,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(j="",fe){this._urlChangeListeners.forEach(Xe=>Xe(j,fe))}subscribe(j,fe,Xe){return this._subject.subscribe({next:j,error:fe,complete:Xe})}}return(F=X).normalizeQueryParams=bt,F.joinWithSlash=Dt,F.stripTrailingSlash=st,F.\u0275fac=function(j){return new(j||F)(M.LFG(mt))},F.\u0275prov=M.Yz7({token:F,factory:function(){return function it(){return new Ct((0,M.LFG)(mt))}()},providedIn:"root"}),X})();function Tt(F){return F.replace(/\/index.html$/,"")}function xr(F,X){X=encodeURIComponent(X);for(const ye of F.split(";")){const j=ye.indexOf("="),[fe,Xe]=-1==j?[ye,""]:[ye.slice(0,j),ye.slice(j+1)];if(fe.trim()===X)return decodeURIComponent(Xe)}return null}const Ni=/\s+/,Qo=[];let Gt=(()=>{var F;class X{constructor(j,fe,Xe,rn){this._iterableDiffers=j,this._keyValueDiffers=fe,this._ngEl=Xe,this._renderer=rn,this.initialClasses=Qo,this.stateMap=new Map}set klass(j){this.initialClasses=null!=j?j.trim().split(Ni):Qo}set ngClass(j){this.rawClass="string"==typeof j?j.trim().split(Ni):j}ngDoCheck(){for(const fe of this.initialClasses)this._updateState(fe,!0);const j=this.rawClass;if(Array.isArray(j)||j instanceof Set)for(const fe of j)this._updateState(fe,!0);else if(null!=j)for(const fe of Object.keys(j))this._updateState(fe,!!j[fe]);this._applyStateDiff()}_updateState(j,fe){const Xe=this.stateMap.get(j);void 0!==Xe?(Xe.enabled!==fe&&(Xe.changed=!0,Xe.enabled=fe),Xe.touched=!0):this.stateMap.set(j,{enabled:fe,changed:!0,touched:!0})}_applyStateDiff(){for(const j of this.stateMap){const fe=j[0],Xe=j[1];Xe.changed?(this._toggleClass(fe,Xe.enabled),Xe.changed=!1):Xe.touched||(Xe.enabled&&this._toggleClass(fe,!1),this.stateMap.delete(fe)),Xe.touched=!1}}_toggleClass(j,fe){(j=j.trim()).length>0&&j.split(Ni).forEach(Xe=>{fe?this._renderer.addClass(this._ngEl.nativeElement,Xe):this._renderer.removeClass(this._ngEl.nativeElement,Xe)})}}return(F=X).\u0275fac=function(j){return new(j||F)(M.Y36(M.ZZ4),M.Y36(M.aQg),M.Y36(M.SBq),M.Y36(M.Qsj))},F.\u0275dir=M.lG2({type:F,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),X})();class Or{constructor(X,ye,j,fe){this.$implicit=X,this.ngForOf=ye,this.index=j,this.count=fe}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let es=(()=>{var F;class X{set ngForOf(j){this._ngForOf=j,this._ngForOfDirty=!0}set ngForTrackBy(j){this._trackByFn=j}get ngForTrackBy(){return this._trackByFn}constructor(j,fe,Xe){this._viewContainer=j,this._template=fe,this._differs=Xe,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(j){j&&(this._template=j)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const j=this._ngForOf;!this._differ&&j&&(this._differ=this._differs.find(j).create(this.ngForTrackBy))}if(this._differ){const j=this._differ.diff(this._ngForOf);j&&this._applyChanges(j)}}_applyChanges(j){const fe=this._viewContainer;j.forEachOperation((Xe,rn,_n)=>{if(null==Xe.previousIndex)fe.createEmbeddedView(this._template,new Or(Xe.item,this._ngForOf,-1,-1),null===_n?void 0:_n);else if(null==_n)fe.remove(null===rn?void 0:rn);else if(null!==rn){const ki=fe.get(rn);fe.move(ki,_n),Co(ki,Xe)}});for(let Xe=0,rn=fe.length;Xe<rn;Xe++){const ki=fe.get(Xe).context;ki.index=Xe,ki.count=rn,ki.ngForOf=this._ngForOf}j.forEachIdentityChange(Xe=>{Co(fe.get(Xe.currentIndex),Xe)})}static ngTemplateContextGuard(j,fe){return!0}}return(F=X).\u0275fac=function(j){return new(j||F)(M.Y36(M.s_b),M.Y36(M.Rgc),M.Y36(M.ZZ4))},F.\u0275dir=M.lG2({type:F,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),X})();function Co(F,X){F.context.$implicit=X.item}let Yr=(()=>{var F;class X{constructor(j,fe){this._viewContainer=j,this._context=new Lo,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=fe}set ngIf(j){this._context.$implicit=this._context.ngIf=j,this._updateView()}set ngIfThen(j){Un("ngIfThen",j),this._thenTemplateRef=j,this._thenViewRef=null,this._updateView()}set ngIfElse(j){Un("ngIfElse",j),this._elseTemplateRef=j,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(j,fe){return!0}}return(F=X).\u0275fac=function(j){return new(j||F)(M.Y36(M.s_b),M.Y36(M.Rgc))},F.\u0275dir=M.lG2({type:F,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),X})();class Lo{constructor(){this.$implicit=null,this.ngIf=null}}function Un(F,X){if(X&&!X.createEmbeddedView)throw new Error(`${F} must be a TemplateRef, but received '${(0,M.AaK)(X)}'.`)}class Pi{constructor(X,ye){this._viewContainerRef=X,this._templateRef=ye,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(X){X&&!this._created?this.create():!X&&this._created&&this.destroy()}}let se=(()=>{var F;class X{constructor(){this._defaultViews=[],this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(j){this._ngSwitch=j,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(j){this._defaultViews.push(j)}_matchCase(j){const fe=j==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||fe,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),fe}_updateDefaultCases(j){if(this._defaultViews.length>0&&j!==this._defaultUsed){this._defaultUsed=j;for(const fe of this._defaultViews)fe.enforceState(j)}}}return(F=X).\u0275fac=function(j){return new(j||F)},F.\u0275dir=M.lG2({type:F,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0}),X})(),Oe=(()=>{var F;class X{constructor(j,fe,Xe){this.ngSwitch=Xe,Xe._addCase(),this._view=new Pi(j,fe)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return(F=X).\u0275fac=function(j){return new(j||F)(M.Y36(M.s_b),M.Y36(M.Rgc),M.Y36(se,9))},F.\u0275dir=M.lG2({type:F,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0}),X})(),ge=(()=>{var F;class X{constructor(j,fe,Xe){Xe._addDefault(new Pi(j,fe))}}return(F=X).\u0275fac=function(j){return new(j||F)(M.Y36(M.s_b),M.Y36(M.Rgc),M.Y36(se,9))},F.\u0275dir=M.lG2({type:F,selectors:[["","ngSwitchDefault",""]],standalone:!0}),X})(),mn=(()=>{var F;class X{constructor(j){this._viewContainerRef=j,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(j){if(j.ngTemplateOutlet||j.ngTemplateOutletInjector){const fe=this._viewContainerRef;if(this._viewRef&&fe.remove(fe.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:Xe,ngTemplateOutletContext:rn,ngTemplateOutletInjector:_n}=this;this._viewRef=fe.createEmbeddedView(Xe,rn,_n?{injector:_n}:void 0)}else this._viewRef=null}else this._viewRef&&j.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return(F=X).\u0275fac=function(j){return new(j||F)(M.Y36(M.s_b))},F.\u0275dir=M.lG2({type:F,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[M.TTD]}),X})(),ts=(()=>{var F;class X{}return(F=X).\u0275fac=function(j){return new(j||F)},F.\u0275mod=M.oAB({type:F}),F.\u0275inj=M.cJS({}),X})();const Os="browser",zr="server";function _o(F){return F===Os}function So(F){return F===zr}let ss=(()=>{var F;class X{}return(F=X).\u0275prov=(0,M.Yz7)({token:F,providedIn:"root",factory:()=>new kr((0,M.LFG)(ht),window)}),X})();class kr{constructor(X,ye){this.document=X,this.window=ye,this.offset=()=>[0,0]}setOffset(X){this.offset=Array.isArray(X)?()=>X:X}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(X){this.supportsScrolling()&&this.window.scrollTo(X[0],X[1])}scrollToAnchor(X){if(!this.supportsScrolling())return;const ye=function _a(F,X){const ye=F.getElementById(X)||F.getElementsByName(X)[0];if(ye)return ye;if("function"==typeof F.createTreeWalker&&F.body&&"function"==typeof F.body.attachShadow){const j=F.createTreeWalker(F.body,NodeFilter.SHOW_ELEMENT);let fe=j.currentNode;for(;fe;){const Xe=fe.shadowRoot;if(Xe){const rn=Xe.getElementById(X)||Xe.querySelector(`[name="${X}"]`);if(rn)return rn}fe=j.nextNode()}}return null}(this.document,X);ye&&(this.scrollToElement(ye),ye.focus())}setHistoryScrollRestoration(X){this.supportsScrolling()&&(this.window.history.scrollRestoration=X)}scrollToElement(X){const ye=X.getBoundingClientRect(),j=ye.left+this.window.pageXOffset,fe=ye.top+this.window.pageYOffset,Xe=this.offset();this.window.scrollTo(j-Xe[0],fe-Xe[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class fs{}},9468:(ci,Qt,le)=>{"use strict";le.d(Qt,{QbO:()=>F_,tb:()=>ov,AFp:()=>Hd,ip1:()=>ab,hGG:()=>hC,z2F:()=>kf,Ojb:()=>B_,sBO:()=>XD,Sil:()=>hD,_Vd:()=>Yd,EJc:()=>cD,Xts:()=>Rc,SBq:()=>ua,lqb:()=>Za,qLn:()=>sd,vpe:()=>eu,XFs:()=>wi,OlP:()=>fo,zs3:()=>gl,ZZ4:()=>dv,aQg:()=>hv,soG:()=>t_,YKP:()=>dx,h0i:()=>dh,PXZ:()=>VD,R0b:()=>ll,FiY:()=>is,Lbi:()=>ef,g9A:()=>Dp,n_E:()=>Xg,Qsj:()=>sl,FYo:()=>Op,JOm:()=>Bu,tp0:()=>Pl,Rgc:()=>vm,dDg:()=>BD,eoX:()=>xb,GfV:()=>Du,s_b:()=>Qg,ifc:()=>Br,VuI:()=>EC,LMc:()=>CC,MMx:()=>fx,Lck:()=>Gw,eFA:()=>Db,G48:()=>ZD,Gpc:()=>Kt,f3M:()=>Di,$WT:()=>ds,_c5:()=>dC,qFp:()=>TC,rg0:()=>va,c2e:()=>lb,zSh:()=>wp,HDt:()=>cb,wAp:()=>Af,vHH:()=>De,lri:()=>yb,rWj:()=>vb,cg1:()=>Ay,kL8:()=>F0,dqk:()=>ir,Z0I:()=>yn,eJc:()=>qy,QGY:()=>xy,F4k:()=>Bv,RDi:()=>dc,AaK:()=>Wt,qOj:()=>ah,Xq5:()=>k,TTD:()=>F,_Bn:()=>ux,jDz:()=>px,xp6:()=>xg,uIk:()=>Yt,Gre:()=>C0,ekj:()=>Ty,Suo:()=>$x,Xpm:()=>jo,lG2:()=>Ls,Yz7:()=>qn,cJS:()=>Xn,oAB:()=>ao,Yjl:()=>Ys,Y36:()=>ud,_UZ:()=>gy,GkF:()=>vy,qZA:()=>rc,TgZ:()=>lh,EpF:()=>Fv,n5z:()=>el,Ikx:()=>My,LFG:()=>ji,$8M:()=>cs,$Z:()=>dd,NdJ:()=>by,CRH:()=>Vx,kcU:()=>$l,O4$:()=>Xo,oxw:()=>Uv,Hsn:()=>Hv,F$t:()=>jv,Q6J:()=>Aa,DdM:()=>bx,iGM:()=>Nx,MAs:()=>za,KtG:()=>Sl,CHM:()=>sc,P3R:()=>_p,YNc:()=>Xc,_uU:()=>m0,Oqu:()=>Iy,hij:()=>Gg,Gf:()=>zx});var M=le(8645),b=le(7394),Ft=le(5619),l=le(5592),Me=le(3019),ht=le(2096),Ke=le(4829),pt=le(305),yt=le(9360);function Dt(t={}){const{connector:o=(()=>new M.x),resetOnError:a=!0,resetOnComplete:d=!0,resetOnRefCountZero:m=!0}=t;return v=>{let D,R,$,ne=0,he=!1,Ve=!1;const Et=()=>{R?.unsubscribe(),R=void 0},Nt=()=>{Et(),D=$=void 0,he=Ve=!1},Sn=()=>{const Gn=D;Nt(),Gn?.unsubscribe()};return(0,yt.e)((Gn,pi)=>{ne++,!Ve&&!he&&Et();const Bi=$=$??o();pi.add(()=>{ne--,0===ne&&!Ve&&!he&&(R=st(Sn,m))}),Bi.subscribe(pi),!D&&ne>0&&(D=new pt.Hp({next:Nn=>Bi.next(Nn),error:Nn=>{Ve=!0,Et(),R=st(Nt,a,Nn),Bi.error(Nn)},complete:()=>{he=!0,Et(),R=st(Nt,d),Bi.complete()}}),(0,Ke.Xf)(Gn).subscribe(D))})(v)}}function st(t,o,...a){if(!0===o)return void t();if(!1===o)return;const d=new pt.Hp({next:()=>{d.unsubscribe(),t()}});return(0,Ke.Xf)(o(...a)).subscribe(d)}var bt=le(4664),mt=le(3997);function Qe(t){for(let o in t)if(t[o]===Qe)return o;throw Error("Could not find renamed property on target object.")}function _t(t,o){for(const a in o)o.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(t[a]=o[a])}function Wt(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(Wt).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const o=t.toString();if(null==o)return""+o;const a=o.indexOf("\n");return-1===a?o:o.substring(0,a)}function Ct(t,o){return null==t||""===t?null===o?"":o:null==o||""===o?t:t+" "+o}const it=Qe({__forward_ref__:Qe});function Kt(t){return t.__forward_ref__=Kt,t.toString=function(){return Wt(this())},t}function Tt(t){return Ze(t)?t():t}function Ze(t){return"function"==typeof t&&t.hasOwnProperty(it)&&t.__forward_ref__===Kt}function Fe(t){return t&&!!t.\u0275providers}const un="https://g.co/ng/security#xss";class De extends Error{constructor(o,a){super(function dt(t,o){return`NG0${Math.abs(t)}${o?": "+o:""}`}(o,a)),this.code=o}}function Lt(t){return"string"==typeof t?t:null==t?"":String(t)}function Jn(t,o){throw new De(-201,!1)}function xt(t,o){null==t&&function St(t,o,a,d){throw new Error(`ASSERTION ERROR: ${t}`+(null==d?"":` [Expected=> ${a} ${d} ${o} <=Actual]`))}(o,t,null,"!=")}function qn(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Xn(t){return{providers:t.providers||[],imports:t.imports||[]}}function ar(t){return lr(t,oo)||lr(t,$i)}function yn(t){return null!==ar(t)}function lr(t,o){return t.hasOwnProperty(o)?t[o]:null}function pr(t){return t&&(t.hasOwnProperty(Si)||t.hasOwnProperty(po))?t[Si]:null}const oo=Qe({\u0275prov:Qe}),Si=Qe({\u0275inj:Qe}),$i=Qe({ngInjectableDef:Qe}),po=Qe({ngInjectorDef:Qe});var wi=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(wi||{});let Hr;function fi(t){const o=Hr;return Hr=t,o}function Sr(t,o,a){const d=ar(t);return d&&"root"==d.providedIn?void 0===d.value?d.value=d.factory():d.value:a&wi.Optional?null:void 0!==o?o:void Jn(Wt(t))}const ir=globalThis,Pn={},Ye="__NG_DI_FLAG__",je="ngTempTokenPath",Ge=/\n/gm,cn="__source";let $n;function bi(t){const o=$n;return $n=t,o}function Ui(t,o=wi.Default){if(void 0===$n)throw new De(-203,!1);return null===$n?Sr(t,void 0,o):$n.get(t,o&wi.Optional?null:void 0,o)}function ji(t,o=wi.Default){return(function Er(){return Hr}()||Ui)(Tt(t),o)}function Di(t,o=wi.Default){return ji(t,no(o))}function no(t){return typeof t>"u"||"number"==typeof t?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function Gr(t){const o=[];for(let a=0;a<t.length;a++){const d=Tt(t[a]);if(Array.isArray(d)){if(0===d.length)throw new De(900,!1);let m,v=wi.Default;for(let D=0;D<d.length;D++){const R=d[D],$=qi(R);"number"==typeof $?-1===$?m=R.token:v|=$:m=R}o.push(ji(m,v))}else o.push(ji(d))}return o}function Wr(t,o){return t[Ye]=o,t.prototype[Ye]=o,t}function qi(t){return t[Ye]}function qr(t){return{toString:t}.toString()}var Ao=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(Ao||{}),Br=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(Br||{});const Dr={},Hi=[],Ur=Qe({\u0275cmp:Qe}),xr=Qe({\u0275dir:Qe}),Ni=Qe({\u0275pipe:Qe}),Qo=Qe({\u0275mod:Qe}),Gt=Qe({\u0275fac:Qe}),so=Qe({__NG_ELEMENT_ID__:Qe}),Rr=Qe({__NG_ENV_ID__:Qe});function Or(t,o,a){let d=t.length;for(;;){const m=t.indexOf(o,a);if(-1===m)return m;if(0===m||t.charCodeAt(m-1)<=32){const v=o.length;if(m+v===d||t.charCodeAt(m+v)<=32)return m}a=m+1}}function es(t,o,a){let d=0;for(;d<a.length;){const m=a[d];if("number"==typeof m){if(0!==m)break;d++;const v=a[d++],D=a[d++],R=a[d++];t.setAttribute(o,D,R,v)}else{const v=m,D=a[++d];os(v)?t.setProperty(o,v,D):t.setAttribute(o,v,D),d++}}return d}function Co(t){return 3===t||4===t||6===t}function os(t){return 64===t.charCodeAt(0)}function Yr(t,o){if(null!==o&&0!==o.length)if(null===t||0===t.length)t=o.slice();else{let a=-1;for(let d=0;d<o.length;d++){const m=o[d];"number"==typeof m?a=m:0===a||Lo(t,a,m,null,-1===a||2===a?o[++d]:null)}}return t}function Lo(t,o,a,d,m){let v=0,D=t.length;if(-1===o)D=-1;else for(;v<t.length;){const R=t[v++];if("number"==typeof R){if(R===o){D=-1;break}if(R>o){D=v-1;break}}}for(;v<t.length;){const R=t[v];if("number"==typeof R)break;if(R===a){if(null===d)return void(null!==m&&(t[v+1]=m));if(d===t[v+1])return void(t[v+2]=m)}v++,null!==d&&v++,null!==m&&v++}-1!==D&&(t.splice(D,0,o),v=D+1),t.splice(v++,0,a),null!==d&&t.splice(v++,0,d),null!==m&&t.splice(v++,0,m)}const Un="ng-template";function Pi(t,o,a){let d=0,m=!0;for(;d<t.length;){let v=t[d++];if("string"==typeof v&&m){const D=t[d++];if(a&&"class"===v&&-1!==Or(D.toLowerCase(),o,0))return!0}else{if(1===v){for(;d<t.length&&"string"==typeof(v=t[d++]);)if(v.toLowerCase()===o)return!0;return!1}"number"==typeof v&&(m=!1)}}return!1}function se(t){return 4===t.type&&t.value!==Un}function Oe(t,o,a){return o===(4!==t.type||a?t.value:Un)}function ge(t,o,a){let d=4;const m=t.attrs||[],v=function mn(t){for(let o=0;o<t.length;o++)if(Co(t[o]))return o;return t.length}(m);let D=!1;for(let R=0;R<o.length;R++){const $=o[R];if("number"!=typeof $){if(!D)if(4&d){if(d=2|1&d,""!==$&&!Oe(t,$,a)||""===$&&1===o.length){if(Te(d))return!1;D=!0}}else{const ne=8&d?$:o[++R];if(8&d&&null!==t.attrs){if(!Pi(t.attrs,ne,a)){if(Te(d))return!1;D=!0}continue}const Ve=vt(8&d?"class":$,m,se(t),a);if(-1===Ve){if(Te(d))return!1;D=!0;continue}if(""!==ne){let Et;Et=Ve>v?"":m[Ve+1].toLowerCase();const Nt=8&d?Et:null;if(Nt&&-1!==Or(Nt,ne,0)||2&d&&ne!==Et){if(Te(d))return!1;D=!0}}}}else{if(!D&&!Te(d)&&!Te($))return!1;if(D&&Te($))continue;D=!1,d=$|1&d}}return Te(d)||D}function Te(t){return 0==(1&t)}function vt(t,o,a,d){if(null===o)return-1;let m=0;if(d||!a){let v=!1;for(;m<o.length;){const D=o[m];if(D===t)return m;if(3===D||6===D)v=!0;else{if(1===D||2===D){let R=o[++m];for(;"string"==typeof R;)R=o[++m];continue}if(4===D)break;if(0===D){m+=4;continue}}m+=v?1:2}return-1}return function an(t,o){let a=t.indexOf(4);if(a>-1)for(a++;a<t.length;){const d=t[a];if("number"==typeof d)return-1;if(d===o)return a;a++}return-1}(o,t)}function Mt(t,o,a=!1){for(let d=0;d<o.length;d++)if(ge(t,o[d],a))return!0;return!1}function Tn(t,o){e:for(let a=0;a<o.length;a++){const d=o[a];if(t.length===d.length){for(let m=0;m<t.length;m++)if(t[m]!==d[m])continue e;return!0}}return!1}function ii(t,o){return t?":not("+o.trim()+")":o}function vi(t){let o=t[0],a=1,d=2,m="",v=!1;for(;a<t.length;){let D=t[a];if("string"==typeof D)if(2&d){const R=t[++a];m+="["+D+(R.length>0?'="'+R+'"':"")+"]"}else 8&d?m+="."+D:4&d&&(m+=" "+D);else""!==m&&!Te(D)&&(o+=ii(v,m),m=""),d=D,v=v||!Te(d);a++}return""!==m&&(o+=ii(v,m)),o}function jo(t){return qr(()=>{const o=Rs(t),a={...o,decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===Ao.OnPush,directiveDefs:null,pipeDefs:null,dependencies:o.standalone&&t.dependencies||null,getStandaloneInjector:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||Br.Emulated,styles:t.styles||Hi,_:null,schemas:t.schemas||null,tView:null,id:""};na(a);const d=t.dependencies;return a.directiveDefs=hs(d,!1),a.pipeDefs=hs(d,!0),a.id=function ia(t){let o=0;const a=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,t.consts,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery].join("|");for(const m of a)o=Math.imul(31,o)+m.charCodeAt(0)<<0;return o+=2147483648,"c"+o}(a),a})}function To(t){return Ii(t)||Cr(t)}function go(t){return null!==t}function ao(t){return qr(()=>({type:t.type,bootstrap:t.bootstrap||Hi,declarations:t.declarations||Hi,imports:t.imports||Hi,exports:t.exports||Hi,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function cr(t,o){if(null==t)return Dr;const a={};for(const d in t)if(t.hasOwnProperty(d)){let m=t[d],v=m;Array.isArray(m)&&(v=m[1],m=m[0]),a[m]=d,o&&(o[m]=v)}return a}function Ls(t){return qr(()=>{const o=Rs(t);return na(o),o})}function Ys(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,standalone:!0===t.standalone,onDestroy:t.type.prototype.ngOnDestroy||null}}function Ii(t){return t[Ur]||null}function Cr(t){return t[xr]||null}function lo(t){return t[Ni]||null}function ds(t){const o=Ii(t)||Cr(t)||lo(t);return null!==o&&o.standalone}function ur(t,o){const a=t[Qo]||null;if(!a&&!0===o)throw new Error(`Type ${Wt(t)} does not have '\u0275mod' property.`);return a}function Rs(t){const o={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:o,inputTransforms:null,inputConfig:t.inputs||Dr,exportAs:t.exportAs||null,standalone:!0===t.standalone,signals:!0===t.signals,selectors:t.selectors||Hi,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:cr(t.inputs,o),outputs:cr(t.outputs)}}function na(t){t.features?.forEach(o=>o(t))}function hs(t,o){if(!t)return null;const a=o?lo:To;return()=>("function"==typeof t?t():t).map(d=>a(d)).filter(go)}const Ir=0,Kn=1,Ti=2,Tr=3,ts=4,Os=5,zr=6,zo=7,Xr=8,_o=9,So=10,xi=11,Fo=12,Fs=13,ss=14,kr=15,_a=16,xs=17,fs=18,bs=19,ps=20,Ji=21,Bs=22,ra=23,oa=24,_i=25,Ns=1,da=2,Ho=7,Go=9,yo=11;function jr(t){return Array.isArray(t)&&"object"==typeof t[Ns]}function Bo(t){return Array.isArray(t)&&!0===t[Ns]}function Ea(t){return 0!=(4&t.flags)}function zs(t){return t.componentOffset>-1}function ms(t){return 1==(1&t.flags)}function T(t){return!!t.template}function K(t){return 0!=(512&t[Ti])}function ha(t,o){return t.hasOwnProperty(Gt)?t[Gt]:null}let Se=ir.WeakRef??class ue{constructor(o){this.ref=o}deref(){return this.ref}},Zt=0,fn=null,gi=!1;function Wn(t){const o=fn;return fn=t,o}class mr{constructor(){this.id=Zt++,this.ref=function nt(t){return new Se(t)}(this),this.producers=new Map,this.consumers=new Map,this.trackingVersion=0,this.valueVersion=0}consumerPollProducersForChange(){for(const[o,a]of this.producers){const d=a.producerNode.deref();if(null!=d&&a.atTrackingVersion===this.trackingVersion){if(d.producerPollStatus(a.seenValueVersion))return!0}else this.producers.delete(o),d?.consumers.delete(this.id)}return!1}producerMayHaveChanged(){const o=gi;gi=!0;try{for(const[a,d]of this.consumers){const m=d.consumerNode.deref();null!=m&&m.trackingVersion===d.atTrackingVersion?m.onConsumerDependencyMayHaveChanged():(this.consumers.delete(a),m?.producers.delete(this.id))}}finally{gi=o}}producerAccessed(){if(gi)throw new Error("");if(null===fn)return;let o=fn.producers.get(this.id);void 0===o?(o={consumerNode:fn.ref,producerNode:this.ref,seenValueVersion:this.valueVersion,atTrackingVersion:fn.trackingVersion},fn.producers.set(this.id,o),this.consumers.set(fn.id,o)):(o.seenValueVersion=this.valueVersion,o.atTrackingVersion=fn.trackingVersion)}get hasProducers(){return this.producers.size>0}get producerUpdatesAllowed(){return!1!==fn?.consumerAllowSignalWrites}producerPollStatus(o){return this.valueVersion!==o||(this.onProducerUpdateValueVersion(),this.valueVersion!==o)}}let Ds=null;function va(t){const o=Wn(null);try{return t()}finally{Wn(o)}}const bl=()=>{};class Ks extends mr{constructor(o,a,d){super(),this.watch=o,this.schedule=a,this.dirty=!1,this.cleanupFn=bl,this.registerOnCleanup=m=>{this.cleanupFn=m},this.consumerAllowSignalWrites=d}notify(){this.dirty||this.schedule(this),this.dirty=!0}onConsumerDependencyMayHaveChanged(){this.notify()}onProducerUpdateValueVersion(){}run(){if(this.dirty=!1,0!==this.trackingVersion&&!this.consumerPollProducersForChange())return;const o=Wn(this);this.trackingVersion++;try{this.cleanupFn(),this.cleanupFn=bl,this.watch(this.registerOnCleanup)}finally{Wn(o)}}cleanup(){this.cleanupFn()}}class Vs{constructor(o,a,d){this.previousValue=o,this.currentValue=a,this.firstChange=d}isFirstChange(){return this.firstChange}}function F(){return X}function X(t){return t.type.prototype.ngOnChanges&&(t.setInput=j),ye}function ye(){const t=Xe(this),o=t?.current;if(o){const a=t.previous;if(a===Dr)t.previous=o;else for(let d in o)a[d]=o[d];t.current=null,this.ngOnChanges(o)}}function j(t,o,a,d){const m=this.declaredInputs[a],v=Xe(t)||function rn(t,o){return t[fe]=o}(t,{previous:Dr,current:null}),D=v.current||(v.current={}),R=v.previous,$=R[m];D[m]=new Vs($&&$.currentValue,o,R===Dr),t[d]=o}F.ngInherit=!0;const fe="__ngSimpleChanges__";function Xe(t){return t[fe]||null}const Gi=function(t,o,a){},Mi="svg";function Zi(t){for(;Array.isArray(t);)t=t[Ir];return t}function wr(t,o){return Zi(o[t])}function Mr(t,o){return Zi(o[t.index])}function Cs(t,o){return t.data[o]}function Zo(t,o){const a=o[t];return jr(a)?a:a[Ir]}function Pa(t,o){return null==o?null:t[o]}function ei(t){t[xs]=0}function Ra(t){1024&t[Ti]||(t[Ti]|=1024,wl(t,1))}function tu(t){1024&t[Ti]&&(t[Ti]&=-1025,wl(t,-1))}function wl(t,o){let a=t[Tr];if(null===a)return;a[Os]+=o;let d=a;for(a=a[Tr];null!==a&&(1===o&&1===d[Os]||-1===o&&0===d[Os]);)a[Os]+=o,d=a,a=a[Tr]}const Wi={lFrame:L(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Dl(){return Wi.bindingsEnabled}function Cl(){return null!==Wi.skipHydrationRootTNode}function Ln(){return Wi.lFrame.lView}function Ar(){return Wi.lFrame.tView}function sc(t){return Wi.lFrame.contextLView=t,t[Xr]}function Sl(t){return Wi.lFrame.contextLView=null,t}function Ts(){let t=Au();for(;null!==t&&64===t.type;)t=t.parent;return t}function Au(){return Wi.lFrame.currentTNode}function Va(t,o){const a=Wi.lFrame;a.currentTNode=t,a.isParent=o}function Ua(){return Wi.lFrame.isParent}function ou(){Wi.lFrame.isParent=!1}function ls(){return Wi.lFrame.bindingIndex++}function Ja(t){const o=Wi.lFrame,a=o.bindingIndex;return o.bindingIndex=o.bindingIndex+t,a}function vd(t,o){const a=Wi.lFrame;a.bindingIndex=a.bindingRootIndex=t,uu(o)}function uu(t){Wi.lFrame.currentDirectiveIndex=t}function ka(){return Wi.lFrame.currentQueryIndex}function La(t){Wi.lFrame.currentQueryIndex=t}function zl(t){const o=t[Kn];return 2===o.type?o.declTNode:1===o.type?t[zr]:null}function P(t,o,a){if(a&wi.SkipSelf){let m=o,v=t;for(;!(m=m.parent,null!==m||a&wi.Host||(m=zl(v),null===m||(v=v[ss],10&m.type))););if(null===m)return!1;o=m,t=v}const d=Wi.lFrame=V();return d.currentTNode=o,d.lView=t,!0}function O(t){const o=V(),a=t[Kn];Wi.lFrame=o,o.currentTNode=a.firstChild,o.lView=t,o.tView=a,o.contextLView=t,o.bindingIndex=a.bindingStartIndex,o.inI18n=!1}function V(){const t=Wi.lFrame,o=null===t?null:t.child;return null===o?L(t):o}function L(t){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=o),o}function q(){const t=Wi.lFrame;return Wi.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const ve=q;function me(){const t=q();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function Yn(){return Wi.lFrame.selectedIndex}function or(t){Wi.lFrame.selectedIndex=t}function ui(){const t=Wi.lFrame;return Cs(t.tView,t.selectedIndex)}function Xo(){Wi.lFrame.currentNamespace=Mi}function $l(){!function Il(){Wi.lFrame.currentNamespace=null}()}let Qa=!0;function Ml(){return Qa}function h(t){Qa=t}function c(t,o){for(let a=o.directiveStart,d=o.directiveEnd;a<d;a++){const v=t.data[a].type.prototype,{ngAfterContentInit:D,ngAfterContentChecked:R,ngAfterViewInit:$,ngAfterViewChecked:ne,ngOnDestroy:he}=v;D&&(t.contentHooks??=[]).push(-a,D),R&&((t.contentHooks??=[]).push(a,R),(t.contentCheckHooks??=[]).push(a,R)),$&&(t.viewHooks??=[]).push(-a,$),ne&&((t.viewHooks??=[]).push(a,ne),(t.viewCheckHooks??=[]).push(a,ne)),null!=he&&(t.destroyHooks??=[]).push(a,he)}}function p(t,o,a){C(t,o,3,a)}function _(t,o,a,d){(3&t[Ti])===a&&C(t,o,a,d)}function x(t,o){let a=t[Ti];(3&a)===o&&(a&=8191,a+=1,t[Ti]=a)}function C(t,o,a,d){const v=d??-1,D=o.length-1;let R=0;for(let $=void 0!==d?65535&t[xs]:0;$<D;$++)if("number"==typeof o[$+1]){if(R=o[$],null!=d&&R>=d)break}else o[$]<0&&(t[xs]+=65536),(R<v||-1==v)&&(N(t,a,o,$),t[xs]=(4294901760&t[xs])+$+2),$++}function A(t,o){Gi(4,t,o);const a=Wn(null);try{o.call(t)}finally{Wn(a),Gi(5,t,o)}}function N(t,o,a,d){const m=a[d]<0,v=a[d+1],R=t[m?-a[d]:a[d]];m?t[Ti]>>13<t[xs]>>16&&(3&t[Ti])===o&&(t[Ti]+=8192,A(R,v)):A(R,v)}const G=-1;class H{constructor(o,a,d){this.factory=o,this.resolving=!1,this.canSeeViewProviders=a,this.injectImpl=d}}function ze(t){return t!==G}function $e(t){return 32767&t}function ct(t,o){let a=function lt(t){return t>>16}(t),d=o;for(;a>0;)d=d[ss],a--;return d}let ut=!0;function kt(t){const o=ut;return ut=t,o}const qt=255,Fn=5;let Ut=0;const gn={};function Rn(t,o){const a=vn(t,o);if(-1!==a)return a;const d=o[Kn];d.firstCreatePass&&(t.injectorIndex=o.length,jt(d.data,t),jt(o,null),jt(d.blueprint,null));const m=kn(t,o),v=t.injectorIndex;if(ze(m)){const D=$e(m),R=ct(m,o),$=R[Kn].data;for(let ne=0;ne<8;ne++)o[v+ne]=R[D+ne]|$[D+ne]}return o[v+8]=m,v}function jt(t,o){t.push(0,0,0,0,0,0,0,0,o)}function vn(t,o){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===o[t.injectorIndex+8]?-1:t.injectorIndex}function kn(t,o){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let a=0,d=null,m=o;for(;null!==m;){if(d=$r(m),null===d)return G;if(a++,m=m[ss],-1!==d.injectorIndex)return d.injectorIndex|a<<16}return G}function Mn(t,o,a){!function Jt(t,o,a){let d;"string"==typeof a?d=a.charCodeAt(0)||0:a.hasOwnProperty(so)&&(d=a[so]),null==d&&(d=a[so]=Ut++);const m=d&qt;o.data[t+(m>>Fn)]|=1<<m}(t,o,a)}function Ei(t,o,a){if(a&wi.Optional||void 0!==t)return t;Jn()}function Ki(t,o,a,d){if(a&wi.Optional&&void 0===d&&(d=null),!(a&(wi.Self|wi.Host))){const m=t[_o],v=fi(void 0);try{return m?m.get(o,d,a&wi.Optional):Sr(o,d,a&wi.Optional)}finally{fi(v)}}return Ei(d,0,a)}function di(t,o,a,d=wi.Default,m){if(null!==t){if(2048&o[Ti]&&!(d&wi.Self)){const D=function bo(t,o,a,d,m){let v=t,D=o;for(;null!==v&&null!==D&&2048&D[Ti]&&!(512&D[Ti]);){const R=Ri(v,D,a,d|wi.Self,gn);if(R!==gn)return R;let $=v.parent;if(!$){const ne=D[ps];if(ne){const he=ne.get(a,gn,d);if(he!==gn)return he}$=$r(D),D=D[ss]}v=$}return m}(t,o,a,d,gn);if(D!==gn)return D}const v=Ri(t,o,a,d,gn);if(v!==gn)return v}return Ki(o,a,d,m)}function Ri(t,o,a,d,m){const v=function Jr(t){if("string"==typeof t)return t.charCodeAt(0)||0;const o=t.hasOwnProperty(so)?t[so]:void 0;return"number"==typeof o?o>=0?o&qt:Ga:o}(a);if("function"==typeof v){if(!P(o,t,d))return d&wi.Host?Ei(m,0,d):Ki(o,a,d,m);try{let D;if(D=v(d),null!=D||d&wi.Optional)return D;Jn()}finally{ve()}}else if("number"==typeof v){let D=null,R=vn(t,o),$=G,ne=d&wi.Host?o[kr][zr]:null;for((-1===R||d&wi.SkipSelf)&&($=-1===R?kn(t,o):o[R+8],$!==G&&ho(d,!1)?(D=o[Kn],R=$e($),o=ct($,o)):R=-1);-1!==R;){const he=o[Kn];if(uo(v,R,he.data)){const Ve=_r(R,o,a,D,d,ne);if(Ve!==gn)return Ve}$=o[R+8],$!==G&&ho(d,o[Kn].data[R+8]===ne)&&uo(v,R,o)?(D=he,R=$e($),o=ct($,o)):R=-1}}return m}function _r(t,o,a,d,m,v){const D=o[Kn],R=D.data[t+8],he=dr(R,D,a,null==d?zs(R)&&ut:d!=D&&0!=(3&R.type),m&wi.Host&&v===R);return null!==he?mi(o,D,he,R):gn}function dr(t,o,a,d,m){const v=t.providerIndexes,D=o.data,R=1048575&v,$=t.directiveStart,he=v>>20,Et=m?R+he:t.directiveEnd;for(let Nt=d?R:R+he;Nt<Et;Nt++){const Sn=D[Nt];if(Nt<$&&a===Sn||Nt>=$&&Sn.type===a)return Nt}if(m){const Nt=D[$];if(Nt&&T(Nt)&&Nt.type===a)return $}return null}function mi(t,o,a,d){let m=t[a];const v=o.data;if(function ie(t){return t instanceof H}(m)){const D=m;D.resolving&&function pn(t,o){const a=o?`. Dependency path: ${o.join(" > ")} > ${t}`:"";throw new De(-200,`Circular dependency in DI detected for ${t}${a}`)}(function ft(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():Lt(t)}(v[a]));const R=kt(D.canSeeViewProviders);D.resolving=!0;const ne=D.injectImpl?fi(D.injectImpl):null;P(t,d,wi.Default);try{m=t[a]=D.factory(void 0,v,t,d),o.firstCreatePass&&a>=d.directiveStart&&function r(t,o,a){const{ngOnChanges:d,ngOnInit:m,ngDoCheck:v}=o.type.prototype;if(d){const D=X(o);(a.preOrderHooks??=[]).push(t,D),(a.preOrderCheckHooks??=[]).push(t,D)}m&&(a.preOrderHooks??=[]).push(0-t,m),v&&((a.preOrderHooks??=[]).push(t,v),(a.preOrderCheckHooks??=[]).push(t,v))}(a,v[a],o)}finally{null!==ne&&fi(ne),kt(R),D.resolving=!1,ve()}}return m}function uo(t,o,a){return!!(a[o+(t>>Fn)]&1<<t)}function ho(t,o){return!(t&wi.Self||t&wi.Host&&o)}class io{constructor(o,a){this._tNode=o,this._lView=a}get(o,a,d){return di(this._tNode,this._lView,o,no(d),a)}}function Ga(){return new io(Ts(),Ln())}function el(t){return qr(()=>{const o=t.prototype.constructor,a=o[Gt]||Ro(o),d=Object.prototype;let m=Object.getPrototypeOf(t.prototype).constructor;for(;m&&m!==d;){const v=m[Gt]||Ro(m);if(v&&v!==a)return v;m=Object.getPrototypeOf(m)}return v=>new v})}function Ro(t){return Ze(t)?()=>{const o=Ro(Tt(t));return o&&o()}:ha(t)}function $r(t){const o=t[Kn],a=o.type;return 2===a?o.declTNode:1===a?t[zr]:null}function cs(t){return function Vn(t,o){if("class"===o)return t.classes;if("style"===o)return t.styles;const a=t.attrs;if(a){const d=a.length;let m=0;for(;m<d;){const v=a[m];if(Co(v))break;if(0===v)m+=2;else if("number"==typeof v)for(m++;m<d&&"string"==typeof a[m];)m++;else{if(v===o)return a[m+1];m+=2}}}return null}(Ts(),t)}const ro="__parameters__";function ul(t,o,a){return qr(()=>{const d=function Al(t){return function(...a){if(t){const d=t(...a);for(const m in d)this[m]=d[m]}}}(o);function m(...v){if(this instanceof m)return d.apply(this,v),this;const D=new m(...v);return R.annotation=D,R;function R($,ne,he){const Ve=$.hasOwnProperty(ro)?$[ro]:Object.defineProperty($,ro,{value:[]})[ro];for(;Ve.length<=he;)Ve.push(null);return(Ve[he]=Ve[he]||[]).push(D),$}}return a&&(m.prototype=Object.create(a.prototype)),m.prototype.ngMetadataName=t,m.annotationCls=m,m})}function hu(t,o){t.forEach(a=>Array.isArray(a)?hu(a,o):o(a))}function Nf(t,o,a){o>=t.length?t.push(a):t.splice(o,0,a)}function _h(t,o){return o>=t.length-1?t.pop():t.splice(o,1)[0]}function bd(t,o){const a=[];for(let d=0;d<t;d++)a.push(o);return a}function Gs(t,o,a){let d=nl(t,o);return d>=0?t[1|d]=a:(d=~d,function wd(t,o,a,d){let m=t.length;if(m==o)t.push(a,d);else if(1===m)t.push(d,t[0]),t[0]=a;else{for(m--,t.push(t[m-1],t[m]);m>o;)t[m]=t[m-2],m--;t[o]=a,t[o+1]=d}}(t,d,o,a)),d}function tl(t,o){const a=nl(t,o);if(a>=0)return t[1|a]}function nl(t,o){return function Cc(t,o,a){let d=0,m=t.length>>a;for(;m!==d;){const v=d+(m-d>>1),D=t[v<<a];if(o===D)return v<<a;D>o?m=v:d=v+1}return~(m<<a)}(t,o,1)}const is=Wr(ul("Optional"),8),Pl=Wr(ul("SkipSelf"),4);function Id(t){return 128==(128&t.flags)}var Bu=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(Bu||{});const Xf=/^>|^->|<!--|-->|--!>|<!-$/g,Kf=/(<|>)/,Sa="\u200b$1\u200b";const Ch=new Map;let Yl=0;const Qf="__ngContext__";function ma(t,o){jr(o)?(t[Qf]=o[bs],function mu(t){Ch.set(t[bs],t)}(o)):t[Qf]=o}let Mh;function _u(t,o){return Mh(t,o)}function Vu(t){const o=t[Tr];return Bo(o)?o[Tr]:o}function Ah(t){return Om(t[Fo])}function np(t){return Om(t[ts])}function Om(t){for(;null!==t&&!Bo(t);)t=t[ts];return t}function ju(t,o,a,d,m){if(null!=d){let v,D=!1;Bo(d)?v=d:jr(d)&&(D=!0,d=d[Ir]);const R=Zi(d);0===t&&null!==a?null==m?ap(o,a,R):cc(o,a,R,m||null,!0):1===t&&null!==a?cc(o,a,R,m||null,!0):2===t?function Rd(t,o,a){const d=yu(t,o);d&&function uc(t,o,a,d){t.removeChild(o,a,d)}(t,d,o,a)}(o,R,D):3===t&&o.destroyNode(R),null!=v&&function zm(t,o,a,d,m){const v=a[Ho];v!==Zi(a)&&ju(o,t,d,v,m);for(let R=yo;R<a.length;R++){const $=a[R];Od($[Kn],$,t,o,d,v)}}(o,t,v,a,m)}}function Zl(t,o){return t.createComment(function Dh(t){return t.replace(Xf,o=>o.replace(Kf,Sa))}(o))}function Qr(t,o,a){return t.createElement(o,a)}function op(t,o){const a=t[Go],d=a.indexOf(o);tu(o),a.splice(d,1)}function Ws(t,o){if(t.length<=yo)return;const a=yo+o,d=t[a];if(d){const m=d[_a];null!==m&&m!==t&&op(m,d),o>0&&(t[a-1][ts]=d[ts]);const v=_h(t,yo+o);!function rp(t,o){Od(t,o,o[xi],2,null,null),o[Ir]=null,o[zr]=null}(d[Kn],d);const D=v[fs];null!==D&&D.detachView(v[Kn]),d[Tr]=null,d[ts]=null,d[Ti]&=-129}return d}function Ph(t,o){if(!(256&o[Ti])){const a=o[xi];o[ra]?.destroy(),o[oa]?.destroy(),a.destroyNode&&Od(t,o,a,3,null,null),function Ol(t){let o=t[Fo];if(!o)return Mc(t[Kn],t);for(;o;){let a=null;if(jr(o))a=o[Fo];else{const d=o[yo];d&&(a=d)}if(!a){for(;o&&!o[ts]&&o!==t;)jr(o)&&Mc(o[Kn],o),o=o[Tr];null===o&&(o=t),jr(o)&&Mc(o[Kn],o),a=o&&o[ts]}o=a}}(o)}}function Mc(t,o){if(!(256&o[Ti])){o[Ti]&=-129,o[Ti]|=256,function km(t,o){let a;if(null!=t&&null!=(a=t.destroyHooks))for(let d=0;d<a.length;d+=2){const m=o[a[d]];if(!(m instanceof H)){const v=a[d+1];if(Array.isArray(v))for(let D=0;D<v.length;D+=2){const R=m[v[D]],$=v[D+1];Gi(4,R,$);try{$.call(R)}finally{Gi(5,R,$)}}else{Gi(4,m,v);try{v.call(m)}finally{Gi(5,m,v)}}}}}(t,o),function sp(t,o){const a=t.cleanup,d=o[zo];if(null!==a)for(let v=0;v<a.length-1;v+=2)if("string"==typeof a[v]){const D=a[v+3];D>=0?d[D]():d[-D].unsubscribe(),v+=2}else a[v].call(d[a[v+1]]);null!==d&&(o[zo]=null);const m=o[Ji];if(null!==m){o[Ji]=null;for(let v=0;v<m.length;v++)(0,m[v])()}}(t,o),1===o[Kn].type&&o[xi].destroy();const a=o[_a];if(null!==a&&Bo(o[Tr])){a!==o[Tr]&&op(a,o);const d=o[fs];null!==d&&d.detachView(t)}!function fl(t){Ch.delete(t[bs])}(o)}}function Ad(t,o,a){return function Lm(t,o,a){let d=o;for(;null!==d&&40&d.type;)d=(o=d).parent;if(null===d)return a[Ir];{const{componentOffset:m}=d;if(m>-1){const{encapsulation:v}=t.data[d.directiveStart+m];if(v===Br.None||v===Br.Emulated)return null}return Mr(d,a)}}(t,o.parent,a)}function cc(t,o,a,d,m){t.insertBefore(o,a,d,m)}function ap(t,o,a){t.appendChild(o,a)}function Fm(t,o,a,d,m){null!==d?cc(t,o,a,d,m):ap(t,o,a)}function yu(t,o){return t.parentNode(o)}function Oh(t,o,a){return Bm(t,o,a)}let kh,Ld,$h,Bm=function lp(t,o,a){return 40&t.type?Mr(t,a):null};function Gu(t,o,a,d){const m=Ad(t,d,o),v=o[xi],R=Oh(d.parent||o[zr],d,o);if(null!=m)if(Array.isArray(a))for(let $=0;$<a.length;$++)Fm(v,m,a[$],R,!1);else Fm(v,m,a,R,!1);void 0!==kh&&kh(v,d,o,a,m)}function Pd(t,o){if(null!==o){const a=o.type;if(3&a)return Mr(o,t);if(4&a)return Fh(-1,t[o.index]);if(8&a){const d=o.child;if(null!==d)return Pd(t,d);{const m=t[o.index];return Bo(m)?Fh(-1,m):Zi(m)}}if(32&a)return _u(o,t)()||Zi(t[o.index]);{const d=Lh(t,o);return null!==d?Array.isArray(d)?d[0]:Pd(Vu(t[kr]),d):Pd(t,o.next)}}return null}function Lh(t,o){return null!==o?t[kr][zr].projection[o.projection]:null}function Fh(t,o){const a=yo+t+1;if(a<o.length){const d=o[a],m=d[Kn].firstChild;if(null!==m)return Pd(d,m)}return o[Ho]}function Bh(t,o,a,d,m,v,D){for(;null!=a;){const R=d[a.index],$=a.type;if(D&&0===o&&(R&&ma(Zi(R),d),a.flags|=2),32!=(32&a.flags))if(8&$)Bh(t,o,a.child,d,m,v,!1),ju(o,t,m,R,v);else if(32&$){const ne=_u(a,d);let he;for(;he=ne();)ju(o,t,m,he,v);ju(o,t,m,R,v)}else 16&$?kd(t,o,d,a,m,v):ju(o,t,m,R,v);a=D?a.projectionNext:a.next}}function Od(t,o,a,d,m,v){Bh(a,d,t.firstChild,o,m,v,!1)}function kd(t,o,a,d,m,v){const D=a[kr],$=D[zr].projection[d.projection];if(Array.isArray($))for(let ne=0;ne<$.length;ne++)ju(o,t,m,$[ne],v);else{let ne=$;const he=D[Tr];Id(d)&&(ne.flags|=128),Bh(t,o,ne,he,m,v,!0)}}function Vm(t,o,a){""===a?t.removeAttribute(o,"class"):t.setAttribute(o,"class",a)}function cp(t,o,a){const{mergedAttrs:d,classes:m,styles:v}=a;null!==d&&es(t,o,d),null!==m&&Vm(t,o,m),null!==v&&function __(t,o,a){t.setAttribute(o,"style",a)}(t,o,v)}function dc(t){Ld=t}function Wm(t){return function Fd(){if(void 0===$h&&($h=null,ir.trustedTypes))try{$h=ir.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return $h}()?.createScriptURL(t)||t}class Vh{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${un})`}}function Pc(t){return t instanceof Vh?t.changingThisBreaksApplicationSecurity:t}function Nd(t,o){const a=function b_(t){return t instanceof Vh&&t.getTypeName()||null}(t);if(null!=a&&a!==o){if("ResourceURL"===a&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${a} (see ${un})`)}return a===o}const Zm=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Xu=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}(Xu||{});function gp(t){const o=zd();return o?o.sanitize(Xu.URL,t)||"":Nd(t,"URL")?Pc(t):function Yu(t){return(t=String(t)).match(Zm)?t:"unsafe:"+t}(Lt(t))}function bu(t){const o=zd();if(o)return Wm(o.sanitize(Xu.RESOURCE_URL,t)||"");if(Nd(t,"ResourceURL"))return Wm(Pc(t));throw new De(904,!1)}function _p(t,o,a){return function eg(t,o){return"src"===o&&("embed"===t||"frame"===t||"iframe"===t||"media"===t||"script"===t)||"href"===o&&("base"===t||"link"===t)?bu:gp}(o,a)(t)}function zd(){const t=Ln();return t&&t[So].sanitizer}class fo{constructor(o,a){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof a?this.__NG_ELEMENT_ID__=a:void 0!==a&&(this.\u0275prov=qn({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Rc=new fo("ENVIRONMENT_INITIALIZER"),$d=new fo("INJECTOR",-1),tg=new fo("INJECTOR_DEF_TYPES");class yp{get(o,a=Pn){if(a===Pn){const d=new Error(`NullInjectorError: No provider for ${Wt(o)}!`);throw d.name="NullInjectorError",d}return a}}function Vd(...t){return{\u0275providers:vp(0,t),\u0275fromNgModule:!0}}function vp(t,...o){const a=[],d=new Set;let m;const v=D=>{a.push(D)};return hu(o,D=>{const R=D;Ud(R,v,[],d)&&(m||=[],m.push(R))}),void 0!==m&&Ju(m,v),a}function Ju(t,o){for(let a=0;a<t.length;a++){const{ngModule:d,providers:m}=t[a];Xh(m,v=>{o(v,d)})}}function Ud(t,o,a,d){if(!(t=Tt(t)))return!1;let m=null,v=pr(t);const D=!v&&Ii(t);if(v||D){if(D&&!D.standalone)return!1;m=t}else{const $=t.ngModule;if(v=pr($),!v)return!1;m=$}const R=d.has(m);if(D){if(R)return!1;if(d.add(m),D.dependencies){const $="function"==typeof D.dependencies?D.dependencies():D.dependencies;for(const ne of $)Ud(ne,o,a,d)}}else{if(!v)return!1;{if(null!=v.imports&&!R){let ne;d.add(m);try{hu(v.imports,he=>{Ud(he,o,a,d)&&(ne||=[],ne.push(he))})}finally{}void 0!==ne&&Ju(ne,o)}if(!R){const ne=ha(m)||(()=>new m);o({provide:m,useFactory:ne,deps:Hi},m),o({provide:tg,useValue:m,multi:!0},m),o({provide:Rc,useValue:()=>ji(m),multi:!0},m)}const $=v.providers;if(null!=$&&!R){const ne=t;Xh($,he=>{o(he,ne)})}}}return m!==t&&void 0!==t.providers}function Xh(t,o){for(let a of t)Fe(a)&&(a=a.\u0275providers),Array.isArray(a)?Xh(a,o):o(a)}const ng=Qe({provide:String,useValue:Qe});function Kh(t){return null!==t&&"object"==typeof t&&ng in t}function Oc(t){return"function"==typeof t}const wp=new fo("Set Injector scope."),jd={},Jh={};let Qh;function ca(){return void 0===Qh&&(Qh=new yp),Qh}class Za{}class fc extends Za{get destroyed(){return this._destroyed}constructor(o,a,d,m){super(),this.parent=a,this.source=d,this.scopes=m,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Ep(o,D=>this.processProvider(D)),this.records.set($d,Qu(void 0,this)),m.has("environment")&&this.records.set(Za,Qu(void 0,this));const v=this.records.get(wp);null!=v&&"string"==typeof v.value&&this.scopes.add(v.value),this.injectorDefTypes=new Set(this.get(tg.multi,Hi,wi.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const a of this._ngOnDestroyHooks)a.ngOnDestroy();const o=this._onDestroyHooks;this._onDestroyHooks=[];for(const a of o)a()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(o){return this.assertNotDestroyed(),this._onDestroyHooks.push(o),()=>this.removeOnDestroy(o)}runInContext(o){this.assertNotDestroyed();const a=bi(this),d=fi(void 0);try{return o()}finally{bi(a),fi(d)}}get(o,a=Pn,d=wi.Default){if(this.assertNotDestroyed(),o.hasOwnProperty(Rr))return o[Rr](this);d=no(d);const v=bi(this),D=fi(void 0);try{if(!(d&wi.SkipSelf)){let $=this.records.get(o);if(void 0===$){const ne=function O_(t){return"function"==typeof t||"object"==typeof t&&t instanceof fo}(o)&&ar(o);$=ne&&this.injectableDefInScope(ne)?Qu(wu(o),jd):null,this.records.set(o,$)}if(null!=$)return this.hydrate(o,$)}return(d&wi.Self?ca():this.parent).get(o,a=d&wi.Optional&&a===Pn?null:a)}catch(R){if("NullInjectorError"===R.name){if((R[je]=R[je]||[]).unshift(Wt(o)),v)throw R;return function Mo(t,o,a,d){const m=t[je];throw o[cn]&&m.unshift(o[cn]),t.message=function Uo(t,o,a,d=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.slice(2):t;let m=Wt(o);if(Array.isArray(o))m=o.map(Wt).join(" -> ");else if("object"==typeof o){let v=[];for(let D in o)if(o.hasOwnProperty(D)){let R=o[D];v.push(D+":"+("string"==typeof R?JSON.stringify(R):Wt(R)))}m=`{${v.join(", ")}}`}return`${a}${d?"("+d+")":""}[${m}]: ${t.replace(Ge,"\n  ")}`}("\n"+t.message,m,a,d),t.ngTokenPath=m,t[je]=null,t}(R,o,"R3InjectorError",this.source)}throw R}finally{fi(D),bi(v)}}resolveInjectorInitializers(){const o=bi(this),a=fi(void 0);try{const m=this.get(Rc.multi,Hi,wi.Self);for(const v of m)v()}finally{bi(o),fi(a)}}toString(){const o=[],a=this.records;for(const d of a.keys())o.push(Wt(d));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new De(205,!1)}processProvider(o){let a=Oc(o=Tt(o))?o:Tt(o&&o.provide);const d=function rg(t){return Kh(t)?Qu(void 0,t.useValue):Qu(og(t),jd)}(o);if(Oc(o)||!0!==o.multi)this.records.get(a);else{let m=this.records.get(a);m||(m=Qu(void 0,jd,!0),m.factory=()=>Gr(m.multi),this.records.set(a,m)),a=o,m.multi.push(o)}this.records.set(a,d)}hydrate(o,a){return a.value===jd&&(a.value=Jh,a.value=a.factory()),"object"==typeof a.value&&a.value&&function R_(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(a.value)&&this._ngOnDestroyHooks.add(a.value),a.value}injectableDefInScope(o){if(!o.providedIn)return!1;const a=Tt(o.providedIn);return"string"==typeof a?"any"===a||this.scopes.has(a):this.injectorDefTypes.has(a)}removeOnDestroy(o){const a=this._onDestroyHooks.indexOf(o);-1!==a&&this._onDestroyHooks.splice(a,1)}}function wu(t){const o=ar(t),a=null!==o?o.factory:ha(t);if(null!==a)return a;if(t instanceof fo)throw new De(204,!1);if(t instanceof Function)return function ig(t){const o=t.length;if(o>0)throw bd(o,"?"),new De(204,!1);const a=function Pr(t){return t&&(t[oo]||t[$i])||null}(t);return null!==a?()=>a.factory(t):()=>new t}(t);throw new De(204,!1)}function og(t,o,a){let d;if(Oc(t)){const m=Tt(t);return ha(m)||wu(m)}if(Kh(t))d=()=>Tt(t.useValue);else if(function bp(t){return!(!t||!t.useFactory)}(t))d=()=>t.useFactory(...Gr(t.deps||[]));else if(function xp(t){return!(!t||!t.useExisting)}(t))d=()=>ji(Tt(t.useExisting));else{const m=Tt(t&&(t.useClass||t.provide));if(!function P_(t){return!!t.deps}(t))return ha(m)||wu(m);d=()=>new m(...Gr(t.deps))}return d}function Qu(t,o,a=!1){return{factory:t,value:o,multi:a?[]:void 0}}function Ep(t,o){for(const a of t)Array.isArray(a)?Ep(a,o):a&&Fe(a)?Ep(a.\u0275providers,o):o(a)}const Hd=new fo("AppId",{providedIn:"root",factory:()=>k_}),k_="ng",Dp=new fo("Platform Initializer"),ef=new fo("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),F_=new fo("AnimationModuleType"),B_=new fo("CSP nonce",{providedIn:"root",factory:()=>function la(){if(void 0!==Ld)return Ld;if(typeof document<"u")return document;throw new De(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let Sp=(t,o,a)=>null;function Fc(t,o,a=!1){return Sp(t,o,a)}class td{}class Pp{}class G_{resolveComponentFactory(o){throw function sf(t){const o=Error(`No component factory found for ${Wt(t)}.`);return o.ngComponent=t,o}(o)}}let Yd=(()=>{class o{}return o.NULL=new G_,o})();function cg(){return Bc(Ts(),Ln())}function Bc(t,o){return new ua(Mr(t,o))}let ua=(()=>{class o{constructor(d){this.nativeElement=d}}return o.__NG_ELEMENT_ID__=cg,o})();function Rp(t){return t instanceof ua?t.nativeElement:t}class Op{}let sl=(()=>{class o{constructor(){this.destroyNode=null}}return o.__NG_ELEMENT_ID__=()=>function ug(){const t=Ln(),a=Zo(Ts().index,t);return(jr(a)?a:t)[xi]}(),o})(),Zd=(()=>{var t;class o{}return(t=o).\u0275prov=qn({token:t,providedIn:"root",factory:()=>null}),o})();class Du{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const kp=new Du("16.2.0"),nd={};function zp(t,o=null,a=null,d){const m=$p(t,o,a,d);return m.resolveInjectorInitializers(),m}function $p(t,o=null,a=null,d,m=new Set){const v=[a||Hi,Vd(t)];return d=d||("object"==typeof t?void 0:Wt(t)),new fc(v,o||ca(),d||null,m)}let gl=(()=>{var t;class o{static create(d,m){if(Array.isArray(d))return zp({name:""},m,d,"");{const v=d.name??"";return zp({name:v},d.parent,d.providers,v)}}}return(t=o).THROW_IF_NOT_FOUND=Pn,t.NULL=new yp,t.\u0275prov=qn({token:t,providedIn:"any",factory:()=>ji($d)}),t.__NG_ELEMENT_ID__=-1,o})();function Jl(t){return t instanceof Function?t():t}let uf=(()=>{var t;class o{constructor(){this.callbacks=new Set,this.deferredCallbacks=new Set,this.renderDepth=0,this.runningCallbacks=!1}begin(){if(this.runningCallbacks)throw new De(102,!1);this.renderDepth++}end(){if(this.renderDepth--,0===this.renderDepth)try{this.runningCallbacks=!0;for(const d of this.callbacks)d.invoke()}finally{this.runningCallbacks=!1;for(const d of this.deferredCallbacks)this.callbacks.add(d);this.deferredCallbacks.clear()}}register(d){(this.runningCallbacks?this.deferredCallbacks:this.callbacks).add(d)}unregister(d){this.callbacks.delete(d),this.deferredCallbacks.delete(d)}ngOnDestroy(){this.callbacks.clear(),this.deferredCallbacks.clear()}}return(t=o).\u0275prov=qn({token:t,providedIn:"root",factory:()=>new t}),o})();function zc(t){for(;t;){t[Ti]|=64;const o=Vu(t);if(K(t)&&!o)return t;t=o}return null}function od(t){return t.ngOriginalError}class sd{constructor(){this._console=console}handleError(o){const a=this._findOriginalError(o);this._console.error("ERROR",o),a&&this._console.error("ORIGINAL ERROR",a)}_findOriginalError(o){let a=o&&od(o);for(;a&&od(a);)a=od(a);return a||null}}const gg=new fo("",{providedIn:"root",factory:()=>!1});class Gp extends mr{constructor(){super(...arguments),this.consumerAllowSignalWrites=!1,this._lView=null}set lView(o){this._lView=o}onConsumerDependencyMayHaveChanged(){zc(this._lView)}onProducerUpdateValueVersion(){}get hasReadASignal(){return this.hasProducers}runInContext(o,a,d){const m=Wn(this);this.trackingVersion++;try{o(a,d)}finally{Wn(m)}}destroy(){this.trackingVersion++}}let Su=null;function hf(){return Su??=new Gp,Su}function vg(t,o){return t[o]??hf()}function Wp(t,o){const a=hf();a.hasReadASignal&&(t[o]=Su,a.lView=t,Su=new Gp)}const sr={};function xg(t){_c(Ar(),Ln(),Yn()+t,!1)}function _c(t,o,a,d){if(!d)if(3==(3&o[Ti])){const v=t.preOrderCheckHooks;null!==v&&p(o,v,a)}else{const v=t.preOrderHooks;null!==v&&_(o,v,0,a)}or(a)}function ud(t,o=wi.Default){const a=Ln();return null===a?ji(t,o):di(Ts(),a,Tt(t),o)}function dd(){throw new Error("invalid")}function $c(t,o,a,d,m,v,D,R,$,ne,he){const Ve=o.blueprint.slice();return Ve[Ir]=m,Ve[Ti]=140|d,(null!==ne||t&&2048&t[Ti])&&(Ve[Ti]|=2048),ei(Ve),Ve[Tr]=Ve[ss]=t,Ve[Xr]=a,Ve[So]=D||t&&t[So],Ve[xi]=R||t&&t[xi],Ve[_o]=$||t&&t[_o]||null,Ve[zr]=v,Ve[bs]=function g_(){return Yl++}(),Ve[Bs]=he,Ve[ps]=ne,Ve[kr]=2==o.type?t[kr]:Ve,Ve}function Ql(t,o,a,d,m){let v=t.data[o];if(null===v)v=function hd(t,o,a,d,m){const v=Au(),D=Ua(),$=t.data[o]=function iy(t,o,a,d,m,v){let D=o?o.injectorIndex:-1,R=0;return Cl()&&(R|=128),{type:a,index:d,insertBeforeIndex:null,injectorIndex:D,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:R,providerIndexes:0,value:m,attrs:v,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,D?v:v&&v.parent,a,o,d,m);return null===t.firstChild&&(t.firstChild=$),null!==v&&(D?null==v.child&&null!==$.parent&&(v.child=$):null===v.next&&(v.next=$,$.prev=v)),$}(t,o,a,d,m),function Pu(){return Wi.lFrame.inI18n}()&&(v.flags|=32);else if(64&v.type){v.type=a,v.value=d,v.attrs=m;const D=function Nl(){const t=Wi.lFrame,o=t.currentTNode;return t.isParent?o:o.parent}();v.injectorIndex=null===D?-1:D.injectorIndex}return Va(v,!0),v}function Kd(t,o,a,d){if(0===a)return-1;const m=o.length;for(let v=0;v<a;v++)o.push(d),t.blueprint.push(d),t.data.push(null);return m}function bg(t,o,a,d,m){const v=vg(o,ra),D=Yn(),R=2&d;try{if(or(-1),R&&o.length>_i&&_c(t,o,_i,!1),Gi(R?2:0,m),R)v.runInContext(a,d,m);else{const ne=Wn(null);try{a(d,m)}finally{Wn(ne)}}}finally{R&&null===o[ra]&&Wp(o,ra),or(D),Gi(R?3:1,m)}}function Vc(t,o,a){if(Ea(o)){const d=Wn(null);try{const v=o.directiveEnd;for(let D=o.directiveStart;D<v;D++){const R=t.data[D];R.contentQueries&&R.contentQueries(1,a[D],D)}}finally{Wn(d)}}}function fd(t,o,a){Dl()&&(function sy(t,o,a,d){const m=a.directiveStart,v=a.directiveEnd;zs(a)&&function uy(t,o,a){const d=Mr(o,t),m=Yp(a);let D=16;a.signals?D=4096:a.onPush&&(D=64);const R=ih(t,$c(t,m,null,D,d,o,null,t[So].rendererFactory.createRenderer(d,a),null,null,null));t[o.index]=R}(o,a,t.data[m+a.componentOffset]),t.firstCreatePass||Rn(a,o),ma(d,o);const D=a.initialInputs;for(let R=m;R<v;R++){const $=t.data[R],ne=mi(o,t,R,a);ma(ne,o),null!==D&&ec(0,R-m,ne,$,0,D),T($)&&(Zo(a.index,o)[Xr]=mi(o,t,R,a))}}(t,o,a,Mr(a,o)),64==(64&a.flags)&&Dg(t,o,a))}function qp(t,o,a=Mr){const d=o.localNames;if(null!==d){let m=o.index+1;for(let v=0;v<d.length;v+=2){const D=d[v+1],R=-1===D?a(o,t):t[D];t[m++]=R}}}function Yp(t){const o=t.tView;return null===o||o.incompleteFirstPass?t.tView=ff(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):o}function ff(t,o,a,d,m,v,D,R,$,ne,he){const Ve=_i+d,Et=Ve+m,Nt=function Q_(t,o){const a=[];for(let d=0;d<o;d++)a.push(d<t?null:sr);return a}(Ve,Et),Sn="function"==typeof ne?ne():ne;return Nt[Kn]={type:t,blueprint:Nt,template:a,queries:null,viewQuery:R,declTNode:o,data:Nt.slice().fill(null,Ve),bindingStartIndex:Ve,expandoStartIndex:Et,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof v?v():v,pipeRegistry:"function"==typeof D?D():D,firstChild:null,schemas:$,consts:Sn,incompleteFirstPass:!1,ssrId:he}}let Zp=t=>null;function Jd(t,o,a,d){for(let m in t)if(t.hasOwnProperty(m)){a=null===a?{}:a;const v=t[m];null===d?Qd(a,o,m,v):d.hasOwnProperty(m)&&Qd(a,o,d[m],v)}return a}function Qd(t,o,a,d){t.hasOwnProperty(a)?t[a].push(o,d):t[a]=[o,d]}function Na(t,o,a,d,m,v,D,R){const $=Mr(o,a);let he,ne=o.inputs;!R&&null!=ne&&(he=ne[d])?(yf(t,a,he,d,m),zs(o)&&function Xp(t,o){const a=Zo(o,t);16&a[Ti]||(a[Ti]|=64)}(a,o.index)):3&o.type&&(d=function ry(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(d),m=null!=D?D(m,o.value||"",d):m,v.setProperty($,d,m))}function eh(t,o,a,d){if(Dl()){const m=null===d?null:{"":-1},v=function Jp(t,o){const a=t.directiveRegistry;let d=null,m=null;if(a)for(let v=0;v<a.length;v++){const D=a[v];if(Mt(o,D.selectors,!1))if(d||(d=[]),T(D))if(null!==D.findHostDirectiveDefs){const R=[];m=m||new Map,D.findHostDirectiveDefs(D,R,m),d.unshift(...R,D),Qp(t,o,R.length)}else d.unshift(D),Qp(t,o,0);else m=m||new Map,D.findHostDirectiveDefs?.(D,d,m),d.push(D)}return null===d?null:[d,m]}(t,a);let D,R;null===v?D=R=null:[D,R]=v,null!==D&&Kp(t,o,a,D,m,R),m&&function th(t,o,a){if(o){const d=t.localNames=[];for(let m=0;m<o.length;m+=2){const v=a[o[m+1]];if(null==v)throw new De(-301,!1);d.push(o[m],v)}}}(a,d,m)}a.mergedAttrs=Yr(a.mergedAttrs,a.attrs)}function Kp(t,o,a,d,m,v){for(let ne=0;ne<d.length;ne++)Mn(Rn(a,o),t,d[ne].type);!function cy(t,o,a){t.flags|=1,t.directiveStart=o,t.directiveEnd=o+a,t.providerIndexes=o}(a,t.data.length,d.length);for(let ne=0;ne<d.length;ne++){const he=d[ne];he.providersResolver&&he.providersResolver(he)}let D=!1,R=!1,$=Kd(t,o,d.length,null);for(let ne=0;ne<d.length;ne++){const he=d[ne];a.mergedAttrs=Yr(a.mergedAttrs,he.hostAttrs),Cg(t,a,o,$,he),ly($,he,m),null!==he.contentQueries&&(a.flags|=4),(null!==he.hostBindings||null!==he.hostAttrs||0!==he.hostVars)&&(a.flags|=64);const Ve=he.type.prototype;!D&&(Ve.ngOnChanges||Ve.ngOnInit||Ve.ngDoCheck)&&((t.preOrderHooks??=[]).push(a.index),D=!0),!R&&(Ve.ngOnChanges||Ve.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(a.index),R=!0),$++}!function pf(t,o,a){const m=o.directiveEnd,v=t.data,D=o.attrs,R=[];let $=null,ne=null;for(let he=o.directiveStart;he<m;he++){const Ve=v[he],Et=a?a.get(Ve):null,Sn=Et?Et.outputs:null;$=Jd(Ve.inputs,he,$,Et?Et.inputs:null),ne=Jd(Ve.outputs,he,ne,Sn);const Gn=null===$||null===D||se(o)?null:tc($,he,D);R.push(Gn)}null!==$&&($.hasOwnProperty("class")&&(o.flags|=8),$.hasOwnProperty("style")&&(o.flags|=16)),o.initialInputs=R,o.inputs=$,o.outputs=ne}(t,a,v)}function Dg(t,o,a){const d=a.directiveStart,m=a.directiveEnd,v=a.index,D=function Oa(){return Wi.lFrame.currentDirectiveIndex}();try{or(v);for(let R=d;R<m;R++){const $=t.data[R],ne=o[R];uu(R),(null!==$.hostBindings||0!==$.hostVars||null!==$.hostAttrs)&&ay($,ne)}}finally{or(-1),uu(D)}}function ay(t,o){null!==t.hostBindings&&t.hostBindings(1,o)}function Qp(t,o,a){o.componentOffset=a,(t.components??=[]).push(o.index)}function ly(t,o,a){if(a){if(o.exportAs)for(let d=0;d<o.exportAs.length;d++)a[o.exportAs[d]]=t;T(o)&&(a[""]=t)}}function Cg(t,o,a,d,m){t.data[d]=m;const v=m.factory||(m.factory=ha(m.type)),D=new H(v,T(m),ud);t.blueprint[d]=D,a[d]=D,function mf(t,o,a,d,m){const v=m.hostBindings;if(v){let D=t.hostBindingOpCodes;null===D&&(D=t.hostBindingOpCodes=[]);const R=~o.index;(function oy(t){let o=t.length;for(;o>0;){const a=t[--o];if("number"==typeof a&&a<0)return a}return 0})(D)!=R&&D.push(R),D.push(a,d,v)}}(t,o,d,Kd(t,a,m.hostVars,sr),m)}function kl(t,o,a,d,m,v){const D=Mr(t,o);!function Xa(t,o,a,d,m,v,D){if(null==v)t.removeAttribute(o,m,a);else{const R=null==D?Lt(v):D(v,d||"",m);t.setAttribute(o,m,R,a)}}(o[xi],D,v,t.value,a,d,m)}function ec(t,o,a,d,m,v){const D=v[o];if(null!==D)for(let R=0;R<D.length;)yc(d,a,D[R++],D[R++],D[R++])}function yc(t,o,a,d,m){const v=Wn(null);try{const D=t.inputTransforms;null!==D&&D.hasOwnProperty(d)&&(m=D[d].call(o,m)),null!==t.setInput?t.setInput(o,m,a,d):o[d]=m}finally{Wn(v)}}function tc(t,o,a){let d=null,m=0;for(;m<a.length;){const v=a[m];if(0!==v)if(5!==v){if("number"==typeof v)break;if(t.hasOwnProperty(v)){null===d&&(d=[]);const D=t[v];for(let R=0;R<D.length;R+=2)if(D[R]===o){d.push(v,D[R+1],a[m+1]);break}}m+=2}else m+=2;else m+=4}return d}function vc(t,o,a,d){return[t,!0,!1,o,null,0,d,a,null,null,null]}function nh(t,o){const a=t.contentQueries;if(null!==a)for(let d=0;d<a.length;d+=2){const v=a[d+1];if(-1!==v){const D=t.data[v];La(a[d]),D.contentQueries(2,o[v],v)}}}function ih(t,o){return t[Fo]?t[Fs][ts]=o:t[Fo]=o,t[Fs]=o,o}function gf(t,o,a){La(0);const d=Wn(null);try{o(t,a)}finally{Wn(d)}}function _f(t){return t[zo]||(t[zo]=[])}function Tg(t){return t.cleanup||(t.cleanup=[])}function tm(t,o){const a=t[_o],d=a?a.get(sd,null):null;d&&d.handleError(o)}function yf(t,o,a,d,m){for(let v=0;v<a.length;){const D=a[v++],R=a[v++];yc(t.data[D],o[D],d,R,m)}}function Sg(t,o){const a=Zo(o,t),d=a[Kn];!function Ig(t,o){for(let a=o.length;a<t.blueprint.length;a++)o.push(t.blueprint[a])}(d,a);const m=a[Ir];null!==m&&null===a[Bs]&&(a[Bs]=Fc(m,a[_o])),vf(d,a,a[Xr])}function vf(t,o,a){O(o);try{const d=t.viewQuery;null!==d&&gf(1,d,a);const m=t.template;null!==m&&bg(t,o,m,1,a),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&nh(t,o),t.staticViewQueries&&gf(2,t.viewQuery,a);const v=t.components;null!==v&&function jc(t,o){for(let a=0;a<o.length;a++)Sg(t,o[a])}(o,v)}catch(d){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),d}finally{o[Ti]&=-5,me()}}let nm=(()=>{var t;class o{constructor(){this.all=new Set,this.queue=new Map}create(d,m,v){const D=typeof Zone>"u"?null:Zone.current,R=new Ks(d,he=>{this.all.has(he)&&this.queue.set(he,D)},v);let $;this.all.add(R),R.notify();const ne=()=>{R.cleanup(),$?.(),this.all.delete(R),this.queue.delete(R)};return $=m?.onDestroy(ne),{destroy:ne}}flush(){if(0!==this.queue.size)for(const[d,m]of this.queue)this.queue.delete(d),m?m.run(()=>d.run()):d.run()}get isQueueEmpty(){return 0===this.queue.size}}return(t=o).\u0275prov=qn({token:t,providedIn:"root",factory:()=>new t}),o})();function xf(t,o,a){let d=a?t.styles:null,m=a?t.classes:null,v=0;if(null!==o)for(let D=0;D<o.length;D++){const R=o[D];"number"==typeof R?v=R:1==v?m=Ct(m,R):2==v&&(d=Ct(d,R+": "+o[++D]+";"))}a?t.styles=d:t.stylesWithoutHost=d,a?t.classes=m:t.classesWithoutHost=m}function Hc(t,o,a,d,m=!1){for(;null!==a;){const v=o[a.index];if(null!==v&&d.push(Zi(v)),Bo(v)){for(let R=yo;R<v.length;R++){const $=v[R],ne=$[Kn].firstChild;null!==ne&&Hc($[Kn],$,ne,d)}v[Ho]!==v[Ir]&&d.push(v[Ho])}const D=a.type;if(8&D)Hc(t,o,a.child,d);else if(32&D){const R=_u(a,o);let $;for(;$=R();)d.push($)}else if(16&D){const R=Lh(o,a);if(Array.isArray(R))d.push(...R);else{const $=Vu(o[kr]);Hc($[Kn],$,R,d,!0)}}a=m?a.projectionNext:a.next}return d}function bf(t,o,a,d=!0){const m=o[So],v=m.rendererFactory,D=m.afterRenderEventManager;v.begin?.(),D?.begin();try{wf(t,o,t.template,a)}catch($){throw d&&tm(o,$),$}finally{v.end?.(),m.effectManager?.flush(),D?.end()}}function wf(t,o,a,d){const m=o[Ti];if(256!=(256&m)){o[So].effectManager?.flush(),O(o);try{ei(o),function lu(t){return Wi.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==a&&bg(t,o,a,2,d);const D=3==(3&m);if(D){const ne=t.preOrderCheckHooks;null!==ne&&p(o,ne,null)}else{const ne=t.preOrderHooks;null!==ne&&_(o,ne,0,null),x(o,0)}if(function rm(t){for(let o=Ah(t);null!==o;o=np(o)){if(!o[da])continue;const a=o[Go];for(let d=0;d<a.length;d++){Ra(a[d])}}}(o),Ll(o,2),null!==t.contentQueries&&nh(t,o),D){const ne=t.contentCheckHooks;null!==ne&&p(o,ne)}else{const ne=t.contentHooks;null!==ne&&_(o,ne,1),x(o,1)}!function Xd(t,o){const a=t.hostBindingOpCodes;if(null===a)return;const d=vg(o,oa);try{for(let m=0;m<a.length;m++){const v=a[m];if(v<0)or(~v);else{const D=v,R=a[++m],$=a[++m];vd(R,D),d.runInContext($,2,o[D])}}}finally{null===o[oa]&&Wp(o,oa),or(-1)}}(t,o);const R=t.components;null!==R&&Gc(o,R,0);const $=t.viewQuery;if(null!==$&&gf(2,$,d),D){const ne=t.viewCheckHooks;null!==ne&&p(o,ne)}else{const ne=t.viewHooks;null!==ne&&_(o,ne,2),x(o,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),o[Ti]&=-73,tu(o)}finally{me()}}}function Ll(t,o){for(let a=Ah(t);null!==a;a=np(a))for(let d=yo;d<a.length;d++)_l(a[d],o)}function om(t,o,a){_l(Zo(o,t),a)}function _l(t,o){if(!function Da(t){return 128==(128&t[Ti])}(t))return;const a=t[Kn];if(80&t[Ti]&&0===o||1024&t[Ti]||2===o)wf(a,t,a.template,t[Xr]);else if(t[Os]>0){Ll(t,1);const m=t[Kn].components;null!==m&&Gc(t,m,1)}}function Gc(t,o,a){for(let d=0;d<o.length;d++)om(t,o[d],a)}class pd{get rootNodes(){const o=this._lView,a=o[Kn];return Hc(a,o,a.firstChild,[])}constructor(o,a){this._lView=o,this._cdRefInjectingView=a,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Xr]}set context(o){this._lView[Xr]=o}get destroyed(){return 256==(256&this._lView[Ti])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[Tr];if(Bo(o)){const a=o[8],d=a?a.indexOf(this):-1;d>-1&&(Ws(o,d),_h(a,d))}this._attachedToViewContainer=!1}Ph(this._lView[Kn],this._lView)}onDestroy(o){!function Bl(t,o){if(256==(256&t[Ti]))throw new De(911,!1);null===t[Ji]&&(t[Ji]=[]),t[Ji].push(o)}(this._lView,o)}markForCheck(){zc(this._cdRefInjectingView||this._lView)}detach(){this._lView[Ti]&=-129}reattach(){this._lView[Ti]|=128}detectChanges(){bf(this._lView[Kn],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new De(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Kl(t,o){Od(t,o,o[xi],2,null,null)}(this._lView[Kn],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new De(902,!1);this._appRef=o}}class Mg extends pd{constructor(o){super(o),this._view=o}detectChanges(){const o=this._view;bf(o[Kn],o,o[Xr],!1)}checkNoChanges(){}get context(){return null}}class md extends Yd{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const a=Ii(o);return new sh(a,this.ngModule)}}function oh(t){const o=[];for(let a in t)t.hasOwnProperty(a)&&o.push({propName:t[a],templateName:a});return o}class Pg{constructor(o,a){this.injector=o,this.parentInjector=a}get(o,a,d){d=no(d);const m=this.injector.get(o,nd,d);return m!==nd||a===nd?m:this.parentInjector.get(o,a,d)}}class sh extends Pp{get inputs(){const o=this.componentDef,a=o.inputTransforms,d=oh(o.inputs);if(null!==a)for(const m of d)a.hasOwnProperty(m.propName)&&(m.transform=a[m.propName]);return d}get outputs(){return oh(this.componentDef.outputs)}constructor(o,a){super(),this.componentDef=o,this.ngModule=a,this.componentType=o.type,this.selector=function Fi(t){return t.map(vi).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!a}create(o,a,d,m){let v=(m=m||this.ngModule)instanceof Za?m:m?.injector;v&&null!==this.componentDef.getStandaloneInjector&&(v=this.componentDef.getStandaloneInjector(v)||v);const D=v?new Pg(o,v):o,R=D.get(Op,null);if(null===R)throw new De(407,!1);const Ve={rendererFactory:R,sanitizer:D.get(Zd,null),effectManager:D.get(nm,null),afterRenderEventManager:D.get(uf,null)},Et=R.createRenderer(null,this.componentDef),Nt=this.componentDef.selectors[0][0]||"div",Sn=d?function wg(t,o,a,d){const v=d.get(gg,!1)||a===Br.ShadowDom,D=t.selectRootElement(o,v);return function ey(t){Zp(t)}(D),D}(Et,d,this.componentDef.encapsulation,D):Qr(Et,Nt,function Ag(t){const o=t.toLowerCase();return"svg"===o?Mi:"math"===o?"math":null}(Nt)),Bi=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let Nn=null;null!==Sn&&(Nn=Fc(Sn,D,!0));const yr=ff(0,null,null,1,0,null,null,null,null,null,null),Vr=$c(null,yr,null,Bi,null,null,Ve,Et,D,null,Nn);let Jo,xl;O(Vr);try{const Mu=this.componentDef;let Lf,pv=null;Mu.findHostDirectiveDefs?(Lf=[],pv=new Map,Mu.findHostDirectiveDefs(Mu,Lf,pv),Lf.push(Mu)):Lf=[Mu];const SC=function Og(t,o){const a=t[Kn],d=_i;return t[d]=o,Ql(a,d,2,"#host",null)}(Vr,Sn),IC=function kg(t,o,a,d,m,v,D){const R=m[Kn];!function fy(t,o,a,d){for(const m of t)o.mergedAttrs=Yr(o.mergedAttrs,m.hostAttrs);null!==o.mergedAttrs&&(xf(o,o.mergedAttrs,!0),null!==a&&cp(d,a,o))}(d,t,o,D);let $=null;null!==o&&($=Fc(o,m[_o]));const ne=v.rendererFactory.createRenderer(o,a);let he=16;a.signals?he=4096:a.onPush&&(he=64);const Ve=$c(m,Yp(a),null,he,m[t.index],t,v,ne,null,null,$);return R.firstCreatePass&&Qp(R,t,d.length-1),ih(m,Ve),m[t.index]=Ve}(SC,Sn,Mu,Lf,Vr,Ve,Et);xl=Cs(yr,_i),Sn&&function Lg(t,o,a,d){if(d)es(t,a,["ng-version",kp.full]);else{const{attrs:m,classes:v}=function br(t){const o=[],a=[];let d=1,m=2;for(;d<t.length;){let v=t[d];if("string"==typeof v)2===m?""!==v&&o.push(v,t[++d]):8===m&&a.push(v);else{if(!Te(m))break;m=v}d++}return{attrs:o,classes:a}}(o.selectors[0]);m&&es(t,a,m),v&&v.length>0&&Vm(t,a,v.join(" "))}}(Et,Mu,Sn,d),void 0!==a&&function Fg(t,o,a){const d=t.projection=[];for(let m=0;m<o.length;m++){const v=a[m];d.push(null!=v?Array.from(v):null)}}(xl,this.ngContentSelectors,a),Jo=function sm(t,o,a,d,m,v){const D=Ts(),R=m[Kn],$=Mr(D,m);Kp(R,m,D,a,null,d);for(let he=0;he<a.length;he++)ma(mi(m,R,D.directiveStart+he,D),m);Dg(R,m,D),$&&ma($,m);const ne=mi(m,R,D.directiveStart+D.componentOffset,D);if(t[Xr]=m[Xr]=ne,null!==v)for(const he of v)he(ne,o);return Vc(R,D,t),ne}(IC,Mu,Lf,pv,Vr,[Bg]),vf(yr,Vr,null)}finally{me()}return new Rg(this.componentType,Jo,Bc(xl,Vr),Vr,xl)}}class Rg extends td{constructor(o,a,d,m,v){super(),this.location=d,this._rootLView=m,this._tNode=v,this.previousInputValues=null,this.instance=a,this.hostView=this.changeDetectorRef=new Mg(m),this.componentType=o}setInput(o,a){const d=this._tNode.inputs;let m;if(null!==d&&(m=d[o])){if(this.previousInputValues??=new Map,this.previousInputValues.has(o)&&Object.is(this.previousInputValues.get(o),a))return;const v=this._rootLView;yf(v[Kn],v,m,o,a),this.previousInputValues.set(o,a),zc(Zo(this._tNode.index,v))}}get injector(){return new io(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function Bg(){const t=Ts();c(Ln()[Kn],t)}function ah(t){let o=function Ef(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),a=!0;const d=[t];for(;o;){let m;if(T(t))m=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new De(903,!1);m=o.\u0275dir}if(m){if(a){d.push(m);const D=t;D.inputs=Wc(t.inputs),D.inputTransforms=Wc(t.inputTransforms),D.declaredInputs=Wc(t.declaredInputs),D.outputs=Wc(t.outputs);const R=m.hostBindings;R&&n(t,R);const $=m.viewQuery,ne=m.contentQueries;if($&&am(t,$),ne&&zg(t,ne),_t(t.inputs,m.inputs),_t(t.declaredInputs,m.declaredInputs),_t(t.outputs,m.outputs),null!==m.inputTransforms&&(null===D.inputTransforms&&(D.inputTransforms={}),_t(D.inputTransforms,m.inputTransforms)),T(m)&&m.data.animation){const he=t.data;he.animation=(he.animation||[]).concat(m.data.animation)}}const v=m.features;if(v)for(let D=0;D<v.length;D++){const R=v[D];R&&R.ngInherit&&R(t),R===ah&&(a=!1)}}o=Object.getPrototypeOf(o)}!function Ng(t){let o=0,a=null;for(let d=t.length-1;d>=0;d--){const m=t[d];m.hostVars=o+=m.hostVars,m.hostAttrs=Yr(m.hostAttrs,a=Yr(a,m.hostAttrs))}}(d)}function Wc(t){return t===Dr?{}:t===Hi?[]:t}function am(t,o){const a=t.viewQuery;t.viewQuery=a?(d,m)=>{o(d,m),a(d,m)}:o}function zg(t,o){const a=t.contentQueries;t.contentQueries=a?(d,m,v)=>{o(d,m,v),a(d,m,v)}:o}function n(t,o){const a=t.hostBindings;t.hostBindings=a?(d,m)=>{o(d,m),a(d,m)}:o}function k(t){const o=t.inputConfig,a={};for(const d in o)if(o.hasOwnProperty(d)){const m=o[d];Array.isArray(m)&&m[2]&&(a[d]=m[2])}t.inputTransforms=a}function U(t){return!!oe(t)&&(Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t)}function oe(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function Ae(t,o,a){return!Object.is(t[o],a)&&(t[o]=a,!0)}function Yt(t,o,a,d){const m=Ln();return Ae(m,ls(),o)&&(Ar(),kl(ui(),m,t,o,a,d)),Yt}function dn(t,o,a,d){return Ae(t,ls(),a)?o+Lt(a)+d:sr}function Xc(t,o,a,d,m,v,D,R){const $=Ln(),ne=Ar(),he=t+_i,Ve=ne.firstCreatePass?function Ug(t,o,a,d,m,v,D,R,$){const ne=o.consts,he=Ql(o,t,4,D||null,Pa(ne,R));eh(o,a,he,Pa(ne,$)),c(o,he);const Ve=he.tView=ff(2,he,d,m,v,o.directiveRegistry,o.pipeRegistry,null,o.schemas,ne,null);return null!==o.queries&&(o.queries.template(o,he),Ve.queries=o.queries.embeddedTView(he)),he}(he,ne,$,o,a,d,m,v,D):ne.data[he];Va(Ve,!1);const Et=Tf(ne,$,Ve,t);Ml()&&Gu(ne,$,Et,Ve),ma(Et,$),ih($,$[he]=vc(Et,$,Et,Ve)),ms(Ve)&&fd(ne,$,Ve),null!=D&&qp($,Ve,R)}let Tf=function Sf(t,o,a,d){return h(!0),o[xi].createComment("")};function za(t){return function Yo(t,o){return t[o]}(function su(){return Wi.lFrame.contextLView}(),_i+t)}function Aa(t,o,a){const d=Ln();return Ae(d,ls(),o)&&Na(Ar(),ui(),d,t,o,d[xi],a,!1),Aa}function Iu(t,o,a,d,m){const D=m?"class":"style";yf(t,a,o.inputs[D],D,d)}function lh(t,o,a,d){const m=Ln(),v=Ar(),D=_i+t,R=m[xi],$=v.firstCreatePass?function um(t,o,a,d,m,v){const D=o.consts,$=Ql(o,t,2,d,Pa(D,m));return eh(o,a,$,Pa(D,v)),null!==$.attrs&&xf($,$.attrs,!1),null!==$.mergedAttrs&&xf($,$.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,$),$}(D,v,m,o,a,d):v.data[D],ne=kv(v,m,$,R,o,t);m[D]=ne;const he=ms($);return Va($,!0),cp(R,ne,$),32!=(32&$.flags)&&Ml()&&Gu(v,m,ne,$),0===function iu(){return Wi.lFrame.elementDepthCount}()&&ma(ne,m),function ru(){Wi.lFrame.elementDepthCount++}(),he&&(fd(v,m,$),Vc(v,$,m)),null!==d&&qp(m,$),lh}function rc(){let t=Ts();Ua()?ou():(t=t.parent,Va(t,!1));const o=t;(function fh(t){return Wi.skipHydrationRootTNode===t})(o)&&function oc(){Wi.skipHydrationRootTNode=null}(),function Ca(){Wi.lFrame.elementDepthCount--}();const a=Ar();return a.firstCreatePass&&(c(a,t),Ea(t)&&a.queries.elementEnd(t)),null!=o.classesWithoutHost&&function Ce(t){return 0!=(8&t.flags)}(o)&&Iu(a,o,Ln(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function ke(t){return 0!=(16&t.flags)}(o)&&Iu(a,o,Ln(),o.stylesWithoutHost,!1),rc}function gy(t,o,a,d){return lh(t,o,a,d),rc(),gy}let kv=(t,o,a,d,m,v)=>(h(!0),Qr(d,m,function Vl(){return Wi.lFrame.currentNamespace}()));function _y(t,o,a){const d=Ln(),m=Ar(),v=t+_i,D=m.firstCreatePass?function Jb(t,o,a,d,m){const v=o.consts,D=Pa(v,d),R=Ql(o,t,8,"ng-container",D);return null!==D&&xf(R,D,!0),eh(o,a,R,Pa(v,m)),null!==o.queries&&o.queries.elementStart(o,R),R}(v,m,d,o,a):m.data[v];Va(D,!0);const R=Lv(m,d,D,t);return d[v]=R,Ml()&&Gu(m,d,R,D),ma(R,d),ms(D)&&(fd(m,d,D),Vc(m,D,d)),null!=a&&qp(d,D),_y}function yy(){let t=Ts();const o=Ar();return Ua()?ou():(t=t.parent,Va(t,!1)),o.firstCreatePass&&(c(o,t),Ea(t)&&o.queries.elementEnd(t)),yy}function vy(t,o,a){return _y(t,o,a),yy(),vy}let Lv=(t,o,a,d)=>(h(!0),Zl(o[xi],""));function Fv(){return Ln()}function xy(t){return!!t&&"function"==typeof t.then}function Bv(t){return!!t&&"function"==typeof t.subscribe}function by(t,o,a,d){const m=Ln(),v=Ar(),D=Ts();return function zv(t,o,a,d,m,v,D){const R=ms(d),ne=t.firstCreatePass&&Tg(t),he=o[Xr],Ve=_f(o);let Et=!0;if(3&d.type||D){const Gn=Mr(d,o),pi=D?D(Gn):Gn,Bi=Ve.length,Nn=D?Vr=>D(Zi(Vr[d.index])):d.index;let yr=null;if(!D&&R&&(yr=function t1(t,o,a,d){const m=t.cleanup;if(null!=m)for(let v=0;v<m.length-1;v+=2){const D=m[v];if(D===a&&m[v+1]===d){const R=o[zo],$=m[v+2];return R.length>$?R[$]:null}"string"==typeof D&&(v+=2)}return null}(t,o,m,d.index)),null!==yr)(yr.__ngLastListenerFn__||yr).__ngNextListenerFn__=v,yr.__ngLastListenerFn__=v,Et=!1;else{v=Vv(d,o,he,v,!1);const Vr=a.listen(pi,m,v);Ve.push(v,Vr),ne&&ne.push(m,Nn,Bi,Bi+1)}}else v=Vv(d,o,he,v,!1);const Nt=d.outputs;let Sn;if(Et&&null!==Nt&&(Sn=Nt[m])){const Gn=Sn.length;if(Gn)for(let pi=0;pi<Gn;pi+=2){const Jo=o[Sn[pi]][Sn[pi+1]].subscribe(v),xl=Ve.length;Ve.push(v,Jo),ne&&ne.push(m,d.index,xl,-(xl+1))}}}(v,m,m[xi],D,t,o,d),by}function $v(t,o,a,d){try{return Gi(6,o,a),!1!==a(d)}catch(m){return tm(t,m),!1}finally{Gi(7,o,a)}}function Vv(t,o,a,d,m){return function v(D){if(D===Function)return d;zc(t.componentOffset>-1?Zo(t.index,o):o);let $=$v(o,a,d,D),ne=v.__ngNextListenerFn__;for(;ne;)$=$v(o,a,ne,D)&&$,ne=ne.__ngNextListenerFn__;return m&&!1===$&&D.preventDefault(),$}}function Uv(t=1){return function et(t){return(Wi.lFrame.contextLView=function In(t,o){for(;t>0;)o=o[ss],t--;return o}(t,Wi.lFrame.contextLView))[Xr]}(t)}function n1(t,o){let a=null;const d=function sn(t){const o=t.attrs;if(null!=o){const a=o.indexOf(5);if(!(1&a))return o[a+1]}return null}(t);for(let m=0;m<o.length;m++){const v=o[m];if("*"!==v){if(null===d?Mt(t,v,!0):Tn(d,v))return m}else a=m}return a}function jv(t){const o=Ln()[kr][zr];if(!o.projection){const d=o.projection=bd(t?t.length:1,null),m=d.slice();let v=o.child;for(;null!==v;){const D=t?n1(v,t):0;null!==D&&(m[D]?m[D].projectionNext=v:d[D]=v,m[D]=v),v=v.next}}}function Hv(t,o=0,a){const d=Ln(),m=Ar(),v=Ql(m,_i+t,16,null,a||null);null===v.projection&&(v.projection=o),ou(),(!d[Bs]||Cl())&&32!=(32&v.flags)&&function Wu(t,o,a){kd(o[xi],0,o,a,Ad(t,a,o),Oh(a.parent||o[zr],a,o))}(m,d,v)}function jg(t,o){return t<<17|o<<2}function gd(t){return t>>17&32767}function Ey(t){return 2|t}function ch(t){return(131068&t)>>2}function Dy(t,o){return-131069&t|o<<2}function Cy(t){return 1|t}function e0(t,o,a,d,m){const v=t[a+1],D=null===o;let R=d?gd(v):ch(v),$=!1;for(;0!==R&&(!1===$||D);){const he=t[R+1];l1(t[R],o)&&($=!0,t[R+1]=d?Cy(he):Ey(he)),R=d?gd(he):ch(he)}$&&(t[a+1]=d?Ey(v):Cy(v))}function l1(t,o){return null===t||null==o||(Array.isArray(t)?t[1]:t)===o||!(!Array.isArray(t)||"string"!=typeof o)&&nl(t,o)>=0}const wa={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function t0(t){return t.substring(wa.key,wa.keyEnd)}function n0(t,o){const a=wa.textEnd;return a===o?-1:(o=wa.keyEnd=function h1(t,o,a){for(;o<a&&t.charCodeAt(o)>32;)o++;return o}(t,wa.key=o,a),If(t,o,a))}function If(t,o,a){for(;o<a&&t.charCodeAt(o)<=32;)o++;return o}function Ty(t,o){return function xc(t,o,a,d){const m=Ln(),v=Ar(),D=Ja(2);v.firstUpdatePass&&u0(v,t,D,d),o!==sr&&Ae(m,D,o)&&h0(v,v.data[Yn()],m,m[xi],t,m[D+1]=function D1(t,o){return null==t||""===t||("string"==typeof o?t+=o:"object"==typeof t&&(t=Wt(Pc(t)))),t}(o,a),d,D)}(t,o,null,!0),Ty}function Qc(t,o){for(let a=function u1(t){return function o0(t){wa.key=0,wa.keyEnd=0,wa.value=0,wa.valueEnd=0,wa.textEnd=t.length}(t),n0(t,If(t,0,wa.textEnd))}(o);a>=0;a=n0(o,a))Gs(t,t0(o),!0)}function c0(t,o){return o>=t.expandoStartIndex}function u0(t,o,a,d){const m=t.data;if(null===m[a+1]){const v=m[Yn()],D=c0(t,a);p0(v,d)&&null===o&&!D&&(o=!1),o=function _1(t,o,a,d){const m=function Ru(t){const o=Wi.lFrame.currentDirectiveIndex;return-1===o?null:t[o]}(t);let v=d?o.residualClasses:o.residualStyles;if(null===m)0===(d?o.classBindings:o.styleBindings)&&(a=dm(a=Sy(null,t,o,a,d),o.attrs,d),v=null);else{const D=o.directiveStylingLast;if(-1===D||t[D]!==m)if(a=Sy(m,t,o,a,d),null===v){let $=function y1(t,o,a){const d=a?o.classBindings:o.styleBindings;if(0!==ch(d))return t[gd(d)]}(t,o,d);void 0!==$&&Array.isArray($)&&($=Sy(null,t,o,$[1],d),$=dm($,o.attrs,d),function v1(t,o,a,d){t[gd(a?o.classBindings:o.styleBindings)]=d}(t,o,d,$))}else v=function x1(t,o,a){let d;const m=o.directiveEnd;for(let v=1+o.directiveStylingLast;v<m;v++)d=dm(d,t[v].hostAttrs,a);return dm(d,o.attrs,a)}(t,o,d)}return void 0!==v&&(d?o.residualClasses=v:o.residualStyles=v),a}(m,v,o,d),function s1(t,o,a,d,m,v){let D=v?o.classBindings:o.styleBindings,R=gd(D),$=ch(D);t[d]=a;let he,ne=!1;if(Array.isArray(a)?(he=a[1],(null===he||nl(a,he)>0)&&(ne=!0)):he=a,m)if(0!==$){const Et=gd(t[R+1]);t[d+1]=jg(Et,R),0!==Et&&(t[Et+1]=Dy(t[Et+1],d)),t[R+1]=function r1(t,o){return 131071&t|o<<17}(t[R+1],d)}else t[d+1]=jg(R,0),0!==R&&(t[R+1]=Dy(t[R+1],d)),R=d;else t[d+1]=jg($,0),0===R?R=d:t[$+1]=Dy(t[$+1],d),$=d;ne&&(t[d+1]=Ey(t[d+1])),e0(t,he,d,!0),e0(t,he,d,!1),function a1(t,o,a,d,m){const v=m?t.residualClasses:t.residualStyles;null!=v&&"string"==typeof o&&nl(v,o)>=0&&(a[d+1]=Cy(a[d+1]))}(o,he,t,d,v),D=jg(R,$),v?o.classBindings=D:o.styleBindings=D}(m,v,o,a,D,d)}}function Sy(t,o,a,d,m){let v=null;const D=a.directiveEnd;let R=a.directiveStylingLast;for(-1===R?R=a.directiveStart:R++;R<D&&(v=o[R],d=dm(d,v.hostAttrs,m),v!==t);)R++;return null!==t&&(a.directiveStylingLast=R),d}function dm(t,o,a){const d=a?1:2;let m=-1;if(null!==o)for(let v=0;v<o.length;v++){const D=o[v];"number"==typeof D?m=D:m===d&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),Gs(t,D,!!a||o[++v]))}return void 0===t?null:t}function h0(t,o,a,d,m,v,D,R){if(!(3&o.type))return;const $=t.data,ne=$[R+1],he=function o1(t){return 1==(1&t)}(ne)?f0($,o,a,m,ch(ne),D):void 0;Hg(he)||(Hg(v)||function i1(t){return 2==(2&t)}(ne)&&(v=f0($,null,a,m,R,D)),function $m(t,o,a,d,m){if(o)m?t.addClass(a,d):t.removeClass(a,d);else{let v=-1===d.indexOf("-")?void 0:Bu.DashCase;null==m?t.removeStyle(a,d,v):("string"==typeof m&&m.endsWith("!important")&&(m=m.slice(0,-10),v|=Bu.Important),t.setStyle(a,d,m,v))}}(d,D,wr(Yn(),a),m,v))}function f0(t,o,a,d,m,v){const D=null===o;let R;for(;m>0;){const $=t[m],ne=Array.isArray($),he=ne?$[1]:$,Ve=null===he;let Et=a[m+1];Et===sr&&(Et=Ve?Hi:void 0);let Nt=Ve?tl(Et,d):he===d?Et:void 0;if(ne&&!Hg(Nt)&&(Nt=tl($,d)),Hg(Nt)&&(R=Nt,D))return R;const Sn=t[m+1];m=D?gd(Sn):ch(Sn)}if(null!==o){let $=v?o.residualClasses:o.residualStyles;null!=$&&(R=tl($,d))}return R}function Hg(t){return void 0!==t}function p0(t,o){return 0!=(t.flags&(o?8:16))}function m0(t,o=""){const a=Ln(),d=Ar(),m=t+_i,v=d.firstCreatePass?Ql(d,m,1,o,null):d.data[m],D=g0(d,a,v,o,t);a[m]=D,Ml()&&Gu(d,a,D,v),Va(v,!1)}let g0=(t,o,a,d,m)=>(h(!0),function Ic(t,o){return t.createText(o)}(o[xi],d));function Iy(t){return Gg("",t,""),Iy}function Gg(t,o,a){const d=Ln(),m=dn(d,t,o,a);return m!==sr&&function nc(t,o,a){const d=wr(o,t);!function ip(t,o,a){t.setValue(o,a)}(t[xi],d,a)}(d,Yn(),m),Gg}function C0(t,o,a){!function bc(t,o,a,d){const m=Ar(),v=Ja(2);m.firstUpdatePass&&u0(m,null,v,d);const D=Ln();if(a!==sr&&Ae(D,v,a)){const R=m.data[Yn()];if(p0(R,d)&&!c0(m,v)){let $=d?R.classesWithoutHost:R.stylesWithoutHost;null!==$&&(a=Ct($,a||"")),Iu(m,R,D,a,d)}else!function E1(t,o,a,d,m,v,D,R){m===sr&&(m=Hi);let $=0,ne=0,he=0<m.length?m[0]:null,Ve=0<v.length?v[0]:null;for(;null!==he||null!==Ve;){const Et=$<m.length?m[$+1]:void 0,Nt=ne<v.length?v[ne+1]:void 0;let Gn,Sn=null;he===Ve?($+=2,ne+=2,Et!==Nt&&(Sn=Ve,Gn=Nt)):null===Ve||null!==he&&he<Ve?($+=2,Sn=he):(ne+=2,Sn=Ve,Gn=Nt),null!==Sn&&h0(t,o,a,d,Sn,Gn,D,R),he=$<m.length?m[$]:null,Ve=ne<v.length?v[ne]:null}}(m,R,D,D[xi],D[v+1],D[v+1]=function b1(t,o,a){if(null==a||""===a)return Hi;const d=[],m=Pc(a);if(Array.isArray(m))for(let v=0;v<m.length;v++)t(d,m[v],!0);else if("object"==typeof m)for(const v in m)m.hasOwnProperty(v)&&t(d,v,m[v]);else"string"==typeof m&&o(d,m);return d}(t,o,a),d,v)}}(Gs,Qc,dn(Ln(),t,o,a),!0)}function My(t,o,a){const d=Ln();return Ae(d,ls(),o)&&Na(Ar(),ui(),d,t,o,d[xi],a,!0),My}const uh=void 0;var G1=["en",[["a","p"],["AM","PM"],uh],[["AM","PM"],uh,uh],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],uh,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],uh,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",uh,"{1} 'at' {0}",uh],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function H1(t){const a=Math.floor(Math.abs(t)),d=t.toString().replace(/^[^.]*\.?/,"").length;return 1===a&&0===d?1:5}];let Mf={};function Ay(t){const o=function W1(t){return t.toLowerCase().replace(/_/g,"-")}(t);let a=B0(o);if(a)return a;const d=o.split("-")[0];if(a=B0(d),a)return a;if("en"===d)return G1;throw new De(701,!1)}function F0(t){return Ay(t)[Af.PluralCase]}function B0(t){return t in Mf||(Mf[t]=ir.ng&&ir.ng.common&&ir.ng.common.locales&&ir.ng.common.locales[t]),Mf[t]}var Af=function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t}(Af||{});const Pf="en-US";let N0=Pf;function Oy(t,o,a,d,m){if(t=Tt(t),Array.isArray(t))for(let v=0;v<t.length;v++)Oy(t[v],o,a,d,m);else{const v=Ar(),D=Ln(),R=Ts();let $=Oc(t)?t:Tt(t.provide);const ne=og(t),he=1048575&R.providerIndexes,Ve=R.directiveStart,Et=R.providerIndexes>>20;if(Oc(t)||!t.multi){const Nt=new H(ne,m,ud),Sn=Ly($,o,m?he:he+Et,Ve);-1===Sn?(Mn(Rn(R,D),v,$),ky(v,t,o.length),o.push($),R.directiveStart++,R.directiveEnd++,m&&(R.providerIndexes+=1048576),a.push(Nt),D.push(Nt)):(a[Sn]=Nt,D[Sn]=Nt)}else{const Nt=Ly($,o,he+Et,Ve),Sn=Ly($,o,he,he+Et),pi=Sn>=0&&a[Sn];if(m&&!pi||!m&&!(Nt>=0&&a[Nt])){Mn(Rn(R,D),v,$);const Bi=function Hw(t,o,a,d,m){const v=new H(t,a,ud);return v.multi=[],v.index=o,v.componentProviders=0,cx(v,m,d&&!a),v}(m?jw:Uw,a.length,m,d,ne);!m&&pi&&(a[Sn].providerFactory=Bi),ky(v,t,o.length,0),o.push($),R.directiveStart++,R.directiveEnd++,m&&(R.providerIndexes+=1048576),a.push(Bi),D.push(Bi)}else ky(v,t,Nt>-1?Nt:Sn,cx(a[m?Sn:Nt],ne,!m&&d));!m&&d&&pi&&a[Sn].componentProviders++}}}function ky(t,o,a,d){const m=Oc(o),v=function A_(t){return!!t.useClass}(o);if(m||v){const $=(v?Tt(o.useClass):o).prototype.ngOnDestroy;if($){const ne=t.destroyHooks||(t.destroyHooks=[]);if(!m&&o.multi){const he=ne.indexOf(a);-1===he?ne.push(a,[d,$]):ne[he+1].push(d,$)}else ne.push(a,$)}}}function cx(t,o,a){return a&&t.componentProviders++,t.multi.push(o)-1}function Ly(t,o,a,d){for(let m=a;m<d;m++)if(o[m]===t)return m;return-1}function Uw(t,o,a,d){return Fy(this.multi,[])}function jw(t,o,a,d){const m=this.multi;let v;if(this.providerFactory){const D=this.providerFactory.componentProviders,R=mi(a,a[Kn],this.providerFactory.index,d);v=R.slice(0,D),Fy(m,v);for(let $=D;$<R.length;$++)v.push(R[$])}else v=[],Fy(m,v);return v}function Fy(t,o){for(let a=0;a<t.length;a++)o.push((0,t[a])());return o}function ux(t,o=[]){return a=>{a.providersResolver=(d,m)=>function Vw(t,o,a){const d=Ar();if(d.firstCreatePass){const m=T(t);Oy(a,d.data,d.blueprint,m,!0),Oy(o,d.data,d.blueprint,m,!1)}}(d,m?m(t):t,o)}}class dh{}class dx{}function Gw(t,o){return new By(t,o??null,[])}class By extends dh{constructor(o,a,d){super(),this._parent=a,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new md(this);const m=ur(o);this._bootstrapComponents=Jl(m.bootstrap),this._r3Injector=$p(o,a,[{provide:dh,useValue:this},{provide:Yd,useValue:this.componentFactoryResolver},...d],Wt(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class Ny extends dx{constructor(o){super(),this.moduleType=o}create(o){return new By(this.moduleType,o,[])}}class hx extends dh{constructor(o){super(),this.componentFactoryResolver=new md(this),this.instance=null;const a=new fc([...o.providers,{provide:dh,useValue:this},{provide:Yd,useValue:this.componentFactoryResolver}],o.parent||ca(),o.debugName,new Set(["environment"]));this.injector=a,o.runEnvironmentInitializers&&a.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function fx(t,o,a=null){return new hx({providers:t,parent:o,debugName:a,runEnvironmentInitializers:!0}).injector}let qw=(()=>{var t;class o{constructor(d){this._injector=d,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(d){if(!d.standalone)return null;if(!this.cachedInjectors.has(d)){const m=vp(0,d.type),v=m.length>0?fx([m],this._injector,`Standalone[${d.type.name}]`):null;this.cachedInjectors.set(d,v)}return this.cachedInjectors.get(d)}ngOnDestroy(){try{for(const d of this.cachedInjectors.values())null!==d&&d.destroy()}finally{this.cachedInjectors.clear()}}}return(t=o).\u0275prov=qn({token:t,providedIn:"environment",factory:()=>new t(ji(Za))}),o})();function px(t){t.getStandaloneInjector=o=>o.get(qw).getOrCreateStandaloneInjector(t)}function bx(t,o,a){const d=function js(){const t=Wi.lFrame;let o=t.bindingRootIndex;return-1===o&&(o=t.bindingRootIndex=t.tView.bindingStartIndex),o}()+t,m=Ln();return m[d]===sr?function Pe(t,o,a){return t[o]=a}(m,d,a?o.call(a):o()):function qe(t,o){return t[o]}(m,d)}function $y(t){return o=>{setTimeout(t,void 0,o)}}const eu=class yE extends M.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,a,d){let m=o,v=a||(()=>null),D=d;if(o&&"object"==typeof o){const $=o;m=$.next?.bind($),v=$.error?.bind($),D=$.complete?.bind($)}this.__isAsync&&(v=$y(v),m&&(m=$y(m)),D&&(D=$y(D)));const R=super.subscribe({next:m,error:v,complete:D});return o instanceof b.w0&&o.add(R),R}};function vE(){return this._results[Symbol.iterator]()}class Xg{get changes(){return this._changes||(this._changes=new eu)}constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const a=Xg.prototype;a[Symbol.iterator]||(a[Symbol.iterator]=vE)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,a){return this._results.reduce(o,a)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,a){const d=this;d.dirty=!1;const m=function Fa(t){return t.flat(Number.POSITIVE_INFINITY)}(o);(this._changesDetected=!function ac(t,o,a){if(t.length!==o.length)return!1;for(let d=0;d<t.length;d++){let m=t[d],v=o[d];if(a&&(m=a(m),v=a(v)),v!==m)return!1}return!0}(d._results,m,a))&&(d._results=m,d.length=m.length,d.last=m[this.length-1],d.first=m[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function bE(t,o,a,d=!0){const m=o[Kn];if(function rl(t,o,a,d){const m=yo+d,v=a.length;d>0&&(a[m-1][ts]=o),d<v-yo?(o[ts]=a[m],Nf(a,yo+d,o)):(a.push(o),o[ts]=null),o[Tr]=a;const D=o[_a];null!==D&&a!==D&&function ga(t,o){const a=t[Go];o[kr]!==o[Tr][Tr][kr]&&(t[da]=!0),null===a?t[Go]=[o]:a.push(o)}(D,o);const R=o[fs];null!==R&&R.insertView(t),o[Ti]|=128}(m,o,t,a),d){const v=Fh(a,t),D=o[xi],R=yu(D,t[Ho]);null!==R&&function Xl(t,o,a,d,m,v){d[Ir]=m,d[zr]=o,Od(t,d,a,1,m,v)}(m,t[zr],D,o,R,v)}}let vm=(()=>{class o{}return o.__NG_ELEMENT_ID__=DE,o})();const wE=vm,EE=class extends wE{constructor(o,a,d){super(),this._declarationLView=o,this._declarationTContainer=a,this.elementRef=d}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(o,a){return this.createEmbeddedViewImpl(o,a)}createEmbeddedViewImpl(o,a,d){const m=function xE(t,o,a,d){const m=o.tView,R=$c(t,m,a,4096&t[Ti]?4096:16,null,o,null,null,null,d?.injector??null,d?.hydrationInfo??null);R[_a]=t[o.index];const ne=t[fs];return null!==ne&&(R[fs]=ne.createEmbeddedView(m)),vf(m,R,a),R}(this._declarationLView,this._declarationTContainer,o,{injector:a,hydrationInfo:d});return new pd(m)}};function DE(){return Kg(Ts(),Ln())}function Kg(t,o){return 4&t.type?new EE(o,t,Bc(t,o)):null}let Qg=(()=>{class o{}return o.__NG_ELEMENT_ID__=AE,o})();function AE(){return Ox(Ts(),Ln())}const PE=Qg,Px=class extends PE{constructor(o,a,d){super(),this._lContainer=o,this._hostTNode=a,this._hostLView=d}get element(){return Bc(this._hostTNode,this._hostLView)}get injector(){return new io(this._hostTNode,this._hostLView)}get parentInjector(){const o=kn(this._hostTNode,this._hostLView);if(ze(o)){const a=ct(o,this._hostLView),d=$e(o);return new io(a[Kn].data[d+8],a)}return new io(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const a=Rx(this._lContainer);return null!==a&&a[o]||null}get length(){return this._lContainer.length-yo}createEmbeddedView(o,a,d){let m,v;"number"==typeof d?m=d:null!=d&&(m=d.index,v=d.injector);const R=o.createEmbeddedViewImpl(a||{},v,null);return this.insertImpl(R,m,false),R}createComponent(o,a,d,m,v){const D=o&&!function Dc(t){return"function"==typeof t}(o);let R;if(D)R=a;else{const Gn=a||{};R=Gn.index,d=Gn.injector,m=Gn.projectableNodes,v=Gn.environmentInjector||Gn.ngModuleRef}const $=D?o:new sh(Ii(o)),ne=d||this.parentInjector;if(!v&&null==$.ngModule){const pi=(D?ne:this.parentInjector).get(Za,null);pi&&(v=pi)}Ii($.componentType??{});const Nt=$.create(ne,m,null,v);return this.insertImpl(Nt.hostView,R,false),Nt}insert(o,a){return this.insertImpl(o,a,!1)}insertImpl(o,a,d){const m=o._lView;if(function Js(t){return Bo(t[Tr])}(m)){const $=this.indexOf(o);if(-1!==$)this.detach($);else{const ne=m[Tr],he=new Px(ne,ne[zr],ne[Tr]);he.detach(he.indexOf(o))}}const D=this._adjustIndex(a),R=this._lContainer;return bE(R,m,D,!d),o.attachToViewContainerRef(),Nf(Vy(R),D,o),o}move(o,a){return this.insert(o,a)}indexOf(o){const a=Rx(this._lContainer);return null!==a?a.indexOf(o):-1}remove(o){const a=this._adjustIndex(o,-1),d=Ws(this._lContainer,a);d&&(_h(Vy(this._lContainer),a),Ph(d[Kn],d))}detach(o){const a=this._adjustIndex(o,-1),d=Ws(this._lContainer,a);return d&&null!=_h(Vy(this._lContainer),a)?new pd(d):null}_adjustIndex(o,a=0){return o??this.length+a}};function Rx(t){return t[8]}function Vy(t){return t[8]||(t[8]=[])}function Ox(t,o){let a;const d=o[t.index];return Bo(d)?a=d:(a=vc(d,o,null,t),o[t.index]=a,ih(o,a)),kx(a,o,t,d),new Px(a,t,o)}let kx=function Lx(t,o,a,d){if(t[Ho])return;let m;m=8&a.type?Zi(d):function RE(t,o){const a=t[xi],d=a.createComment(""),m=Mr(o,t);return cc(a,yu(a,m),d,function Rh(t,o){return t.nextSibling(o)}(a,m),!1),d}(o,a),t[Ho]=m};class Uy{constructor(o){this.queryList=o,this.matches=null}clone(){return new Uy(this.queryList)}setDirty(){this.queryList.setDirty()}}class jy{constructor(o=[]){this.queries=o}createEmbeddedView(o){const a=o.queries;if(null!==a){const d=null!==o.contentQueries?o.contentQueries[0]:a.length,m=[];for(let v=0;v<d;v++){const D=a.getByIndex(v);m.push(this.queries[D.indexInDeclarationView].clone())}return new jy(m)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let a=0;a<this.queries.length;a++)null!==Hx(o,a).matches&&this.queries[a].setDirty()}}class Fx{constructor(o,a,d=null){this.predicate=o,this.flags=a,this.read=d}}class Hy{constructor(o=[]){this.queries=o}elementStart(o,a){for(let d=0;d<this.queries.length;d++)this.queries[d].elementStart(o,a)}elementEnd(o){for(let a=0;a<this.queries.length;a++)this.queries[a].elementEnd(o)}embeddedTView(o){let a=null;for(let d=0;d<this.length;d++){const m=null!==a?a.length:0,v=this.getByIndex(d).embeddedTView(o,m);v&&(v.indexInDeclarationView=d,null!==a?a.push(v):a=[v])}return null!==a?new Hy(a):null}template(o,a){for(let d=0;d<this.queries.length;d++)this.queries[d].template(o,a)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class Gy{constructor(o,a=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=a}elementStart(o,a){this.isApplyingToNode(a)&&this.matchTNode(o,a)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,a){this.elementStart(o,a)}embeddedTView(o,a){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,a),new Gy(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const a=this._declarationNodeIndex;let d=o.parent;for(;null!==d&&8&d.type&&d.index!==a;)d=d.parent;return a===(null!==d?d.index:-1)}return this._appliesToNextNode}matchTNode(o,a){const d=this.metadata.predicate;if(Array.isArray(d))for(let m=0;m<d.length;m++){const v=d[m];this.matchTNodeWithReadOption(o,a,LE(a,v)),this.matchTNodeWithReadOption(o,a,dr(a,o,v,!1,!1))}else d===vm?4&a.type&&this.matchTNodeWithReadOption(o,a,-1):this.matchTNodeWithReadOption(o,a,dr(a,o,d,!1,!1))}matchTNodeWithReadOption(o,a,d){if(null!==d){const m=this.metadata.read;if(null!==m)if(m===ua||m===Qg||m===vm&&4&a.type)this.addMatch(a.index,-2);else{const v=dr(a,o,m,!1,!1);null!==v&&this.addMatch(a.index,v)}else this.addMatch(a.index,d)}}addMatch(o,a){null===this.matches?this.matches=[o,a]:this.matches.push(o,a)}}function LE(t,o){const a=t.localNames;if(null!==a)for(let d=0;d<a.length;d+=2)if(a[d]===o)return a[d+1];return null}function BE(t,o,a,d){return-1===a?function FE(t,o){return 11&t.type?Bc(t,o):4&t.type?Kg(t,o):null}(o,t):-2===a?function NE(t,o,a){return a===ua?Bc(o,t):a===vm?Kg(o,t):a===Qg?Ox(o,t):void 0}(t,o,d):mi(t,t[Kn],a,o)}function Bx(t,o,a,d){const m=o[fs].queries[d];if(null===m.matches){const v=t.data,D=a.matches,R=[];for(let $=0;$<D.length;$+=2){const ne=D[$];R.push(ne<0?null:BE(o,v[ne],D[$+1],a.metadata.read))}m.matches=R}return m.matches}function Wy(t,o,a,d){const m=t.queries.getByIndex(a),v=m.matches;if(null!==v){const D=Bx(t,o,m,a);for(let R=0;R<v.length;R+=2){const $=v[R];if($>0)d.push(D[R/2]);else{const ne=v[R+1],he=o[-$];for(let Ve=yo;Ve<he.length;Ve++){const Et=he[Ve];Et[_a]===Et[Tr]&&Wy(Et[Kn],Et,ne,d)}if(null!==he[Go]){const Ve=he[Go];for(let Et=0;Et<Ve.length;Et++){const Nt=Ve[Et];Wy(Nt[Kn],Nt,ne,d)}}}}}return d}function Nx(t){const o=Ln(),a=Ar(),d=ka();La(d+1);const m=Hx(a,d);if(t.dirty&&function xa(t){return 4==(4&t[Ti])}(o)===(2==(2&m.metadata.flags))){if(null===m.matches)t.reset([]);else{const v=m.crossesNgTemplate?Wy(a,o,d,[]):Bx(a,o,m,d);t.reset(v,Rp),t.notifyOnChanges()}return!0}return!1}function zx(t,o,a){const d=Ar();d.firstCreatePass&&(jx(d,new Fx(t,o,a),-1),2==(2&o)&&(d.staticViewQueries=!0)),Ux(d,Ln(),o)}function $x(t,o,a,d){const m=Ar();if(m.firstCreatePass){const v=Ts();jx(m,new Fx(o,a,d),v.index),function $E(t,o){const a=t.contentQueries||(t.contentQueries=[]);o!==(a.length?a[a.length-1]:-1)&&a.push(t.queries.length-1,o)}(m,t),2==(2&a)&&(m.staticContentQueries=!0)}Ux(m,Ln(),a)}function Vx(){return function zE(t,o){return t[fs].queries[o].queryList}(Ln(),ka())}function Ux(t,o,a){const d=new Xg(4==(4&a));(function ny(t,o,a,d){const m=_f(o);m.push(a),t.firstCreatePass&&Tg(t).push(d,m.length-1)})(t,o,d,d.destroy),null===o[fs]&&(o[fs]=new jy),o[fs].queries.push(new Uy(d))}function jx(t,o,a){null===t.queries&&(t.queries=new Hy),t.queries.track(new Gy(o,a))}function Hx(t,o){return t.queries.getByIndex(o)}function qy(t){return!!ur(t)}const ab=new fo("Application Initializer");let Jy=(()=>{var t;class o{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((d,m)=>{this.resolve=d,this.reject=m}),this.appInits=Di(ab,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const d=[];for(const v of this.appInits){const D=v();if(xy(D))d.push(D);else if(Bv(D)){const R=new Promise(($,ne)=>{D.subscribe({complete:$,error:ne})});d.push(R)}}const m=()=>{this.done=!0,this.resolve()};Promise.all(d).then(()=>{m()}).catch(v=>{this.reject(v)}),0===d.length&&m(),this.initialized=!0}}return(t=o).\u0275fac=function(d){return new(d||t)},t.\u0275prov=qn({token:t,factory:t.\u0275fac,providedIn:"root"}),o})(),lb=(()=>{var t;class o{log(d){console.log(d)}warn(d){console.warn(d)}}return(t=o).\u0275fac=function(d){return new(d||t)},t.\u0275prov=qn({token:t,factory:t.\u0275fac,providedIn:"platform"}),o})();const t_=new fo("LocaleId",{providedIn:"root",factory:()=>Di(t_,wi.Optional|wi.SkipSelf)||function lD(){return typeof $localize<"u"&&$localize.locale||Pf}()}),cD=new fo("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});let cb=(()=>{var t;class o{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Ft.X(!1)}add(){this.hasPendingTasks.next(!0);const d=this.taskId++;return this.pendingTasks.add(d),d}remove(d){this.pendingTasks.delete(d),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}}return(t=o).\u0275fac=function(d){return new(d||t)},t.\u0275prov=qn({token:t,factory:t.\u0275fac,providedIn:"root"}),o})();class dD{constructor(o,a){this.ngModuleFactory=o,this.componentFactories=a}}let hD=(()=>{var t;class o{compileModuleSync(d){return new Ny(d)}compileModuleAsync(d){return Promise.resolve(this.compileModuleSync(d))}compileModuleAndAllComponentsSync(d){const m=this.compileModuleSync(d),D=Jl(ur(d).declarations).reduce((R,$)=>{const ne=Ii($);return ne&&R.push(new sh(ne)),R},[]);return new dD(m,D)}compileModuleAndAllComponentsAsync(d){return Promise.resolve(this.compileModuleAndAllComponentsSync(d))}clearCache(){}clearCacheFor(d){}getModuleId(d){}}return(t=o).\u0275fac=function(d){return new(d||t)},t.\u0275prov=qn({token:t,factory:t.\u0275fac,providedIn:"root"}),o})();function fb(...t){}class ll{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:d=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new eu(!1),this.onMicrotaskEmpty=new eu(!1),this.onStable=new eu(!1),this.onError=new eu(!1),typeof Zone>"u")throw new De(908,!1);Zone.assertZonePatched();const m=this;m._nesting=0,m._outer=m._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(m._inner=m._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(m._inner=m._inner.fork(Zone.longStackTraceZoneSpec)),m.shouldCoalesceEventChangeDetection=!d&&a,m.shouldCoalesceRunChangeDetection=d,m.lastRequestAnimationFrameId=-1,m.nativeRequestAnimationFrame=function RD(){const t="function"==typeof ir.requestAnimationFrame;let o=ir[t?"requestAnimationFrame":"setTimeout"],a=ir[t?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&o&&a){const d=o[Zone.__symbol__("OriginalDelegate")];d&&(o=d);const m=a[Zone.__symbol__("OriginalDelegate")];m&&(a=m)}return{nativeRequestAnimationFrame:o,nativeCancelAnimationFrame:a}}().nativeRequestAnimationFrame,function LD(t){const o=()=>{!function kD(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(ir,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,nv(t),t.isCheckStableRunning=!0,tv(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),nv(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(a,d,m,v,D,R)=>{try{return pb(t),a.invokeTask(m,v,D,R)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===v.type||t.shouldCoalesceRunChangeDetection)&&o(),mb(t)}},onInvoke:(a,d,m,v,D,R,$)=>{try{return pb(t),a.invoke(m,v,D,R,$)}finally{t.shouldCoalesceRunChangeDetection&&o(),mb(t)}},onHasTask:(a,d,m,v)=>{a.hasTask(m,v),d===m&&("microTask"==v.change?(t._hasPendingMicrotasks=v.microTask,nv(t),tv(t)):"macroTask"==v.change&&(t.hasPendingMacrotasks=v.macroTask))},onHandleError:(a,d,m,v)=>(a.handleError(m,v),t.runOutsideAngular(()=>t.onError.emit(v)),!1)})}(m)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ll.isInAngularZone())throw new De(909,!1)}static assertNotInAngularZone(){if(ll.isInAngularZone())throw new De(909,!1)}run(o,a,d){return this._inner.run(o,a,d)}runTask(o,a,d,m){const v=this._inner,D=v.scheduleEventTask("NgZoneEvent: "+m,o,OD,fb,fb);try{return v.runTask(D,a,d)}finally{v.cancelTask(D)}}runGuarded(o,a,d){return this._inner.runGuarded(o,a,d)}runOutsideAngular(o){return this._outer.run(o)}}const OD={};function tv(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function nv(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function pb(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function mb(t){t._nesting--,tv(t)}class FD{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new eu,this.onMicrotaskEmpty=new eu,this.onStable=new eu,this.onError=new eu}run(o,a,d){return o.apply(a,d)}runGuarded(o,a,d){return o.apply(a,d)}runOutsideAngular(o){return o()}runTask(o,a,d,m){return o.apply(a,d)}}const gb=new fo("",{providedIn:"root",factory:_b});function _b(){const t=Di(ll);let o=!0;const a=new l.y(m=>{o=t.isStable&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks,t.runOutsideAngular(()=>{m.next(o),m.complete()})}),d=new l.y(m=>{let v;t.runOutsideAngular(()=>{v=t.onStable.subscribe(()=>{ll.assertNotInAngularZone(),queueMicrotask(()=>{!o&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks&&(o=!0,m.next(!0))})})});const D=t.onUnstable.subscribe(()=>{ll.assertInAngularZone(),o&&(o=!1,t.runOutsideAngular(()=>{m.next(!1)}))});return()=>{v.unsubscribe(),D.unsubscribe()}});return(0,Me.T)(a,d.pipe(Dt()))}const yb=new fo(""),vb=new fo("");let iv,BD=(()=>{var t;class o{constructor(d,m,v){this._ngZone=d,this.registry=m,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,iv||(function ND(t){iv=t}(v),v.addToWindow(m)),this._watchAngularEvents(),d.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ll.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let d=this._callbacks.pop();clearTimeout(d.timeoutId),d.doneCb(this._didWork)}this._didWork=!1});else{let d=this.getPendingTasks();this._callbacks=this._callbacks.filter(m=>!m.updateCb||!m.updateCb(d)||(clearTimeout(m.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(d=>({source:d.source,creationLocation:d.creationLocation,data:d.data})):[]}addCallback(d,m,v){let D=-1;m&&m>0&&(D=setTimeout(()=>{this._callbacks=this._callbacks.filter(R=>R.timeoutId!==D),d(this._didWork,this.getPendingTasks())},m)),this._callbacks.push({doneCb:d,timeoutId:D,updateCb:v})}whenStable(d,m,v){if(v&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(d,m,v),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(d){this.registry.registerApplication(d,this)}unregisterApplication(d){this.registry.unregisterApplication(d)}findProviders(d,m,v){return[]}}return(t=o).\u0275fac=function(d){return new(d||t)(ji(ll),ji(xb),ji(vb))},t.\u0275prov=qn({token:t,factory:t.\u0275fac}),o})(),xb=(()=>{var t;class o{constructor(){this._applications=new Map}registerApplication(d,m){this._applications.set(d,m)}unregisterApplication(d){this._applications.delete(d)}unregisterAllApplications(){this._applications.clear()}getTestability(d){return this._applications.get(d)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(d,m=!0){return iv?.findTestabilityInTree(this,d,m)??null}}return(t=o).\u0275fac=function(d){return new(d||t)},t.\u0275prov=qn({token:t,factory:t.\u0275fac,providedIn:"platform"}),o})(),_d=null;const bb=new fo("AllowMultipleToken"),rv=new fo("PlatformDestroyListeners"),ov=new fo("appBootstrapListener");class VD{constructor(o,a){this.name=o,this.token=a}}function Db(t,o,a=[]){const d=`Platform: ${o}`,m=new fo(d);return(v=[])=>{let D=sv();if(!D||D.injector.get(bb,!1)){const R=[...a,...v,{provide:m,useValue:!0}];t?t(R):function UD(t){if(_d&&!_d.get(bb,!1))throw new De(400,!1);(function wb(){!function cl(t){Ds=t}(()=>{throw new De(600,!1)})})(),_d=t;const o=t.get(Tb);(function Eb(t){t.get(Dp,null)?.forEach(a=>a())})(t)}(function Cb(t=[],o){return gl.create({name:o,providers:[{provide:wp,useValue:"platform"},{provide:rv,useValue:new Set([()=>_d=null])},...t]})}(R,d))}return function HD(t){const o=sv();if(!o)throw new De(401,!1);return o}()}}function sv(){return _d?.get(Tb)??null}let Tb=(()=>{var t;class o{constructor(d){this._injector=d,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(d,m){const v=function GD(t="zone.js",o){return"noop"===t?new FD:"zone.js"===t?new ll(o):t}(m?.ngZone,function Sb(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}({eventCoalescing:m?.ngZoneEventCoalescing,runCoalescing:m?.ngZoneRunCoalescing}));return v.run(()=>{const D=function Ww(t,o,a){return new By(t,o,a)}(d.moduleType,this.injector,function Rb(t){return[{provide:ll,useFactory:t},{provide:Rc,multi:!0,useFactory:()=>{const o=Di(qD,{optional:!0});return()=>o.initialize()}},{provide:Pb,useFactory:WD},{provide:gb,useFactory:_b}]}(()=>v)),R=D.injector.get(sd,null);return v.runOutsideAngular(()=>{const $=v.onError.subscribe({next:ne=>{R.handleError(ne)}});D.onDestroy(()=>{i_(this._modules,D),$.unsubscribe()})}),function Ib(t,o,a){try{const d=a();return xy(d)?d.catch(m=>{throw o.runOutsideAngular(()=>t.handleError(m)),m}):d}catch(d){throw o.runOutsideAngular(()=>t.handleError(d)),d}}(R,v,()=>{const $=D.injector.get(Jy);return $.runInitializers(),$.donePromise.then(()=>(function z0(t){xt(t,"Expected localeId to be defined"),"string"==typeof t&&(N0=t.toLowerCase().replace(/_/g,"-"))}(D.injector.get(t_,Pf)||Pf),this._moduleDoBootstrap(D),D))})})}bootstrapModule(d,m=[]){const v=Mb({},m);return function zD(t,o,a){const d=new Ny(a);return Promise.resolve(d)}(0,0,d).then(D=>this.bootstrapModuleFactory(D,v))}_moduleDoBootstrap(d){const m=d.injector.get(kf);if(d._bootstrapComponents.length>0)d._bootstrapComponents.forEach(v=>m.bootstrap(v));else{if(!d.instance.ngDoBootstrap)throw new De(-403,!1);d.instance.ngDoBootstrap(m)}this._modules.push(d)}onDestroy(d){this._destroyListeners.push(d)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new De(404,!1);this._modules.slice().forEach(m=>m.destroy()),this._destroyListeners.forEach(m=>m());const d=this._injector.get(rv,null);d&&(d.forEach(m=>m()),d.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return(t=o).\u0275fac=function(d){return new(d||t)(ji(gl))},t.\u0275prov=qn({token:t,factory:t.\u0275fac,providedIn:"platform"}),o})();function Mb(t,o){return Array.isArray(o)?o.reduce(Mb,t):{...t,...o}}let kf=(()=>{var t;class o{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Di(Pb),this.zoneIsStable=Di(gb),this.componentTypes=[],this.components=[],this.isStable=Di(cb).hasPendingTasks.pipe((0,bt.w)(d=>d?(0,ht.of)(!1):this.zoneIsStable),(0,mt.x)(),Dt()),this._injector=Di(Za)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(d,m){const v=d instanceof Pp;if(!this._injector.get(Jy).done)throw!v&&ds(d),new De(405,!1);let R;R=v?d:this._injector.get(Yd).resolveComponentFactory(d),this.componentTypes.push(R.componentType);const $=function $D(t){return t.isBoundToModule}(R)?void 0:this._injector.get(dh),he=R.create(gl.NULL,[],m||R.selector,$),Ve=he.location.nativeElement,Et=he.injector.get(yb,null);return Et?.registerApplication(Ve),he.onDestroy(()=>{this.detachView(he.hostView),i_(this.components,he),Et?.unregisterApplication(Ve)}),this._loadComponent(he),he}tick(){if(this._runningTick)throw new De(101,!1);try{this._runningTick=!0;for(let d of this._views)d.detectChanges()}catch(d){this.internalErrorHandler(d)}finally{this._runningTick=!1}}attachView(d){const m=d;this._views.push(m),m.attachToAppRef(this)}detachView(d){const m=d;i_(this._views,m),m.detachFromAppRef()}_loadComponent(d){this.attachView(d.hostView),this.tick(),this.components.push(d);const m=this._injector.get(ov,[]);m.push(...this._bootstrapListeners),m.forEach(v=>v(d))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(d=>d()),this._views.slice().forEach(d=>d.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(d){return this._destroyListeners.push(d),()=>i_(this._destroyListeners,d)}destroy(){if(this._destroyed)throw new De(406,!1);const d=this._injector;d.destroy&&!d.destroyed&&d.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return(t=o).\u0275fac=function(d){return new(d||t)},t.\u0275prov=qn({token:t,factory:t.\u0275fac,providedIn:"root"}),o})();function i_(t,o){const a=t.indexOf(o);a>-1&&t.splice(a,1)}const Pb=new fo("",{providedIn:"root",factory:()=>Di(sd).handleError.bind(void 0)});function WD(){const t=Di(ll),o=Di(sd);return a=>t.runOutsideAngular(()=>o.handleError(a))}let qD=(()=>{var t;class o{constructor(){this.zone=Di(ll),this.applicationRef=Di(kf)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}}return(t=o).\u0275fac=function(d){return new(d||t)},t.\u0275prov=qn({token:t,factory:t.\u0275fac,providedIn:"root"}),o})();function ZD(){}let XD=(()=>{class o{}return o.__NG_ELEMENT_ID__=KD,o})();function KD(t){return function JD(t,o,a){if(zs(t)&&!a){const d=Zo(t.index,o);return new pd(d,d)}return 47&t.type?new pd(o[kr],o):null}(Ts(),Ln(),16==(16&t))}class Fb{constructor(){}supports(o){return U(o)}create(o){return new rC(o)}}const iC=(t,o)=>o;class rC{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||iC}forEachItem(o){let a;for(a=this._itHead;null!==a;a=a._next)o(a)}forEachOperation(o){let a=this._itHead,d=this._removalsHead,m=0,v=null;for(;a||d;){const D=!d||a&&a.currentIndex<Nb(d,m,v)?a:d,R=Nb(D,m,v),$=D.currentIndex;if(D===d)m--,d=d._nextRemoved;else if(a=a._next,null==D.previousIndex)m++;else{v||(v=[]);const ne=R-m,he=$-m;if(ne!=he){for(let Et=0;Et<ne;Et++){const Nt=Et<v.length?v[Et]:v[Et]=0,Sn=Nt+Et;he<=Sn&&Sn<ne&&(v[Et]=Nt+1)}v[D.previousIndex]=he-ne}}R!==$&&o(D,R,$)}}forEachPreviousItem(o){let a;for(a=this._previousItHead;null!==a;a=a._nextPrevious)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachMovedItem(o){let a;for(a=this._movesHead;null!==a;a=a._nextMoved)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}forEachIdentityChange(o){let a;for(a=this._identityChangesHead;null!==a;a=a._nextIdentityChange)o(a)}diff(o){if(null==o&&(o=[]),!U(o))throw new De(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let m,v,D,a=this._itHead,d=!1;if(Array.isArray(o)){this.length=o.length;for(let R=0;R<this.length;R++)v=o[R],D=this._trackByFn(R,v),null!==a&&Object.is(a.trackById,D)?(d&&(a=this._verifyReinsertion(a,v,D,R)),Object.is(a.item,v)||this._addIdentityChange(a,v)):(a=this._mismatch(a,v,D,R),d=!0),a=a._next}else m=0,function J(t,o){if(Array.isArray(t))for(let a=0;a<t.length;a++)o(t[a]);else{const a=t[Symbol.iterator]();let d;for(;!(d=a.next()).done;)o(d.value)}}(o,R=>{D=this._trackByFn(m,R),null!==a&&Object.is(a.trackById,D)?(d&&(a=this._verifyReinsertion(a,R,D,m)),Object.is(a.item,R)||this._addIdentityChange(a,R)):(a=this._mismatch(a,R,D,m),d=!0),a=a._next,m++}),this.length=m;return this._truncate(a),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,a,d,m){let v;return null===o?v=this._itTail:(v=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(d,null))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._reinsertAfter(o,v,m)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(d,m))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._moveAfter(o,v,m)):o=this._addAfter(new oC(a,d),v,m),o}_verifyReinsertion(o,a,d,m){let v=null===this._unlinkedRecords?null:this._unlinkedRecords.get(d,null);return null!==v?o=this._reinsertAfter(v,o._prev,m):o.currentIndex!=m&&(o.currentIndex=m,this._addToMoves(o,m)),o}_truncate(o){for(;null!==o;){const a=o._next;this._addToRemovals(this._unlink(o)),o=a}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,a,d){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const m=o._prevRemoved,v=o._nextRemoved;return null===m?this._removalsHead=v:m._nextRemoved=v,null===v?this._removalsTail=m:v._prevRemoved=m,this._insertAfter(o,a,d),this._addToMoves(o,d),o}_moveAfter(o,a,d){return this._unlink(o),this._insertAfter(o,a,d),this._addToMoves(o,d),o}_addAfter(o,a,d){return this._insertAfter(o,a,d),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,a,d){const m=null===a?this._itHead:a._next;return o._next=m,o._prev=a,null===m?this._itTail=o:m._prev=o,null===a?this._itHead=o:a._next=o,null===this._linkedRecords&&(this._linkedRecords=new Bb),this._linkedRecords.put(o),o.currentIndex=d,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const a=o._prev,d=o._next;return null===a?this._itHead=d:a._next=d,null===d?this._itTail=a:d._prev=a,o}_addToMoves(o,a){return o.previousIndex===a||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Bb),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,a){return o.item=a,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class oC{constructor(o,a){this.item=o,this.trackById=a,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class sC{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,a){let d;for(d=this._head;null!==d;d=d._nextDup)if((null===a||a<=d.currentIndex)&&Object.is(d.trackById,o))return d;return null}remove(o){const a=o._prevDup,d=o._nextDup;return null===a?this._head=d:a._nextDup=d,null===d?this._tail=a:d._prevDup=a,null===this._head}}class Bb{constructor(){this.map=new Map}put(o){const a=o.trackById;let d=this.map.get(a);d||(d=new sC,this.map.set(a,d)),d.add(o)}get(o,a){const m=this.map.get(o);return m?m.get(o,a):null}remove(o){const a=o.trackById;return this.map.get(a).remove(o)&&this.map.delete(a),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Nb(t,o,a){const d=t.previousIndex;if(null===d)return d;let m=0;return a&&d<a.length&&(m=a[d]),d+o+m}class zb{constructor(){}supports(o){return o instanceof Map||oe(o)}create(){return new aC}}class aC{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let a;for(a=this._mapHead;null!==a;a=a._next)o(a)}forEachPreviousItem(o){let a;for(a=this._previousMapHead;null!==a;a=a._nextPrevious)o(a)}forEachChangedItem(o){let a;for(a=this._changesHead;null!==a;a=a._nextChanged)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}diff(o){if(o){if(!(o instanceof Map||oe(o)))throw new De(900,!1)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let a=this._mapHead;if(this._appendAfter=null,this._forEach(o,(d,m)=>{if(a&&a.key===m)this._maybeAddToChanges(a,d),this._appendAfter=a,a=a._next;else{const v=this._getOrCreateRecordForKey(m,d);a=this._insertBeforeOrAppend(a,v)}}),a){a._prev&&(a._prev._next=null),this._removalsHead=a;for(let d=a;null!==d;d=d._nextRemoved)d===this._mapHead&&(this._mapHead=null),this._records.delete(d.key),d._nextRemoved=d._next,d.previousValue=d.currentValue,d.currentValue=null,d._prev=null,d._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,a){if(o){const d=o._prev;return a._next=o,a._prev=d,o._prev=a,d&&(d._next=a),o===this._mapHead&&(this._mapHead=a),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=a,a._prev=this._appendAfter):this._mapHead=a,this._appendAfter=a,null}_getOrCreateRecordForKey(o,a){if(this._records.has(o)){const m=this._records.get(o);this._maybeAddToChanges(m,a);const v=m._prev,D=m._next;return v&&(v._next=D),D&&(D._prev=v),m._next=null,m._prev=null,m}const d=new lC(o);return this._records.set(o,d),d.currentValue=a,this._addToAdditions(d),d}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,a){Object.is(a,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=a,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,a){o instanceof Map?o.forEach(a):Object.keys(o).forEach(d=>a(o[d],d))}}class lC{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function $b(){return new dv([new Fb])}let dv=(()=>{var t;class o{constructor(d){this.factories=d}static create(d,m){if(null!=m){const v=m.factories.slice();d=d.concat(v)}return new o(d)}static extend(d){return{provide:o,useFactory:m=>o.create(d,m||$b()),deps:[[o,new Pl,new is]]}}find(d){const m=this.factories.find(v=>v.supports(d));if(null!=m)return m;throw new De(901,!1)}}return(t=o).\u0275prov=qn({token:t,providedIn:"root",factory:$b}),o})();function Vb(){return new hv([new zb])}let hv=(()=>{var t;class o{constructor(d){this.factories=d}static create(d,m){if(m){const v=m.factories.slice();d=d.concat(v)}return new o(d)}static extend(d){return{provide:o,useFactory:m=>o.create(d,m||Vb()),deps:[[o,new Pl,new is]]}}find(d){const m=this.factories.find(v=>v.supports(d));if(m)return m;throw new De(901,!1)}}return(t=o).\u0275prov=qn({token:t,providedIn:"root",factory:Vb}),o})();const dC=Db(null,"core",[]);let hC=(()=>{var t;class o{constructor(d){}}return(t=o).\u0275fac=function(d){return new(d||t)(ji(kf))},t.\u0275mod=ao({type:t}),t.\u0275inj=Xn({}),o})();function EC(t){return"boolean"==typeof t?t:null!=t&&"false"!==t}function CC(t,o){const a=Ii(t),d=o.elementInjector||ca();return new sh(a).create(d,o.projectableNodes,o.hostElement,o.environmentInjector)}function TC(t){const o=Ii(t);if(!o)return null;const a=new sh(o);return{get selector(){return a.selector},get type(){return a.componentType},get inputs(){return a.inputs},get outputs(){return a.outputs},get ngContentSelectors(){return a.ngContentSelectors},get isStandalone(){return o.standalone},get isSignal(){return o.signals}}}},95:(ci,Qt,le)=>{"use strict";le.d(Qt,{sg:()=>co,u5:()=>Lr,JU:()=>_t,a5:()=>lr,JJ:()=>Si,F:()=>Oe,On:()=>To,kI:()=>Lt});var M=le(9468),b=le(6814),Ft=le(7715),l=le(5592),Me=le(7453),ht=le(4829),Ke=le(9940),pt=le(8251),yt=le(7400),Dt=le(2714),bt=le(7398);let mt=(()=>{var ee;class Z{constructor(te,Be){this._renderer=te,this._elementRef=Be,this.onChange=zn=>{},this.onTouched=()=>{}}setProperty(te,Be){this._renderer.setProperty(this._elementRef.nativeElement,te,Be)}registerOnTouched(te){this.onTouched=te}registerOnChange(te){this.onChange=te}setDisabledState(te){this.setProperty("disabled",te)}}return(ee=Z).\u0275fac=function(te){return new(te||ee)(M.Y36(M.Qsj),M.Y36(M.SBq))},ee.\u0275dir=M.lG2({type:ee}),Z})(),Qe=(()=>{var ee;class Z extends mt{}return(ee=Z).\u0275fac=function(){let xe;return function(Be){return(xe||(xe=M.n5z(ee)))(Be||ee)}}(),ee.\u0275dir=M.lG2({type:ee,features:[M.qOj]}),Z})();const _t=new M.OlP("NgValueAccessor"),it={provide:_t,useExisting:(0,M.Gpc)(()=>Ze),multi:!0},Tt=new M.OlP("CompositionEventMode");let Ze=(()=>{var ee;class Z extends mt{constructor(te,Be,zn){super(te,Be),this._compositionMode=zn,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function Kt(){const ee=(0,b.q)()?(0,b.q)().getUserAgent():"";return/android (\d+)/.test(ee.toLowerCase())}())}writeValue(te){this.setProperty("value",te??"")}_handleInput(te){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(te)}_compositionStart(){this._composing=!0}_compositionEnd(te){this._composing=!1,this._compositionMode&&this.onChange(te)}}return(ee=Z).\u0275fac=function(te){return new(te||ee)(M.Y36(M.Qsj),M.Y36(M.SBq),M.Y36(Tt,8))},ee.\u0275dir=M.lG2({type:ee,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(te,Be){1&te&&M.NdJ("input",function(zi){return Be._handleInput(zi.target.value)})("blur",function(){return Be.onTouched()})("compositionstart",function(){return Be._compositionStart()})("compositionend",function(zi){return Be._compositionEnd(zi.target.value)})},features:[M._Bn([it]),M.qOj]}),Z})();function Fe(ee){return null==ee||("string"==typeof ee||Array.isArray(ee))&&0===ee.length}function $t(ee){return null!=ee&&"number"==typeof ee.length}const un=new M.OlP("NgValidators"),De=new M.OlP("NgAsyncValidators"),dt=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Lt{static min(Z){return function ft(ee){return Z=>{if(Fe(Z.value)||Fe(ee))return null;const xe=parseFloat(Z.value);return!isNaN(xe)&&xe<ee?{min:{min:ee,actual:Z.value}}:null}}(Z)}static max(Z){return function pn(ee){return Z=>{if(Fe(Z.value)||Fe(ee))return null;const xe=parseFloat(Z.value);return!isNaN(xe)&&xe>ee?{max:{max:ee,actual:Z.value}}:null}}(Z)}static required(Z){return function hn(ee){return Fe(ee.value)?{required:!0}:null}(Z)}static requiredTrue(Z){return function Vt(ee){return!0===ee.value?null:{required:!0}}(Z)}static email(Z){return function Jn(ee){return Fe(ee.value)||dt.test(ee.value)?null:{email:!0}}(Z)}static minLength(Z){return function Ht(ee){return Z=>Fe(Z.value)||!$t(Z.value)?null:Z.value.length<ee?{minlength:{requiredLength:ee,actualLength:Z.value.length}}:null}(Z)}static maxLength(Z){return function li(ee){return Z=>$t(Z.value)&&Z.value.length>ee?{maxlength:{requiredLength:ee,actualLength:Z.value.length}}:null}(Z)}static pattern(Z){return function tn(ee){if(!ee)return Re;let Z,xe;return"string"==typeof ee?(xe="","^"!==ee.charAt(0)&&(xe+="^"),xe+=ee,"$"!==ee.charAt(ee.length-1)&&(xe+="$"),Z=new RegExp(xe)):(xe=ee.toString(),Z=ee),te=>{if(Fe(te.value))return null;const Be=te.value;return Z.test(Be)?null:{pattern:{requiredPattern:xe,actualValue:Be}}}}(Z)}static nullValidator(Z){return null}static compose(Z){return ri(Z)}static composeAsync(Z){return nn(Z)}}function Re(ee){return null}function Ne(ee){return null!=ee}function at(ee){return(0,M.QGY)(ee)?(0,Ft.D)(ee):ee}function At(ee){let Z={};return ee.forEach(xe=>{Z=null!=xe?{...Z,...xe}:Z}),0===Object.keys(Z).length?null:Z}function en(ee,Z){return Z.map(xe=>xe(ee))}function Zn(ee){return ee.map(Z=>function on(ee){return!ee.validate}(Z)?Z:xe=>Z.validate(xe))}function ri(ee){if(!ee)return null;const Z=ee.filter(Ne);return 0==Z.length?null:function(xe){return At(en(xe,Z))}}function Cn(ee){return null!=ee?ri(Zn(ee)):null}function nn(ee){if(!ee)return null;const Z=ee.filter(Ne);return 0==Z.length?null:function(xe){return function st(...ee){const Z=(0,Ke.jO)(ee),{args:xe,keys:te}=(0,Me.D)(ee),Be=new l.y(zn=>{const{length:zi}=xe;if(!zi)return void zn.complete();const ns=new Array(zi);let ws=zi,Es=zi;for(let Zs=0;Zs<zi;Zs++){let ya=!1;(0,ht.Xf)(xe[Zs]).subscribe((0,pt.x)(zn,$a=>{ya||(ya=!0,Es--),ns[Zs]=$a},()=>ws--,void 0,()=>{(!ws||!ya)&&(Es||zn.next(te?(0,Dt.n)(te,ns):ns),zn.complete())}))}});return Z?Be.pipe((0,yt.Z)(Z)):Be}(en(xe,Z).map(at)).pipe((0,bt.U)(At))}}function xt(ee){return null!=ee?nn(Zn(ee)):null}function St(ee,Z){return null===ee?[Z]:Array.isArray(ee)?[...ee,Z]:[ee,Z]}function xn(ee){return ee._rawValidators}function Hn(ee){return ee._rawAsyncValidators}function yi(ee){return ee?Array.isArray(ee)?ee:[ee]:[]}function qn(ee,Z){return Array.isArray(ee)?ee.includes(Z):ee===Z}function ti(ee,Z){const xe=yi(Z);return yi(ee).forEach(Be=>{qn(xe,Be)||xe.push(Be)}),xe}function Xn(ee,Z){return yi(Z).filter(xe=>!qn(ee,xe))}class ar{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(Z){this._rawValidators=Z||[],this._composedValidatorFn=Cn(this._rawValidators)}_setAsyncValidators(Z){this._rawAsyncValidators=Z||[],this._composedAsyncValidatorFn=xt(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(Z){this._onDestroyCallbacks.push(Z)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(Z=>Z()),this._onDestroyCallbacks=[]}reset(Z=void 0){this.control&&this.control.reset(Z)}hasError(Z,xe){return!!this.control&&this.control.hasError(Z,xe)}getError(Z,xe){return this.control?this.control.getError(Z,xe):null}}class yn extends ar{get formDirective(){return null}get path(){return null}}class lr extends ar{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Pr{constructor(Z){this._cd=Z}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Si=(()=>{var ee;class Z extends Pr{constructor(te){super(te)}}return(ee=Z).\u0275fac=function(te){return new(te||ee)(M.Y36(lr,2))},ee.\u0275dir=M.lG2({type:ee,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(te,Be){2&te&&M.ekj("ng-untouched",Be.isUntouched)("ng-touched",Be.isTouched)("ng-pristine",Be.isPristine)("ng-dirty",Be.isDirty)("ng-valid",Be.isValid)("ng-invalid",Be.isInvalid)("ng-pending",Be.isPending)},features:[M.qOj]}),Z})();const It="VALID",rt="INVALID",Bt="PENDING",bn="DISABLED";function Pn(ee){return(Ge(ee)?ee.validators:ee)||null}function je(ee,Z){return(Ge(Z)?Z.asyncValidators:ee)||null}function Ge(ee){return null!=ee&&!Array.isArray(ee)&&"object"==typeof ee}class $n{constructor(Z,xe){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(Z),this._assignAsyncValidators(xe)}get validator(){return this._composedValidatorFn}set validator(Z){this._rawValidators=this._composedValidatorFn=Z}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(Z){this._rawAsyncValidators=this._composedAsyncValidatorFn=Z}get parent(){return this._parent}get valid(){return this.status===It}get invalid(){return this.status===rt}get pending(){return this.status==Bt}get disabled(){return this.status===bn}get enabled(){return this.status!==bn}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(Z){this._assignValidators(Z)}setAsyncValidators(Z){this._assignAsyncValidators(Z)}addValidators(Z){this.setValidators(ti(Z,this._rawValidators))}addAsyncValidators(Z){this.setAsyncValidators(ti(Z,this._rawAsyncValidators))}removeValidators(Z){this.setValidators(Xn(Z,this._rawValidators))}removeAsyncValidators(Z){this.setAsyncValidators(Xn(Z,this._rawAsyncValidators))}hasValidator(Z){return qn(this._rawValidators,Z)}hasAsyncValidator(Z){return qn(this._rawAsyncValidators,Z)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(Z={}){this.touched=!0,this._parent&&!Z.onlySelf&&this._parent.markAsTouched(Z)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(Z=>Z.markAllAsTouched())}markAsUntouched(Z={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(xe=>{xe.markAsUntouched({onlySelf:!0})}),this._parent&&!Z.onlySelf&&this._parent._updateTouched(Z)}markAsDirty(Z={}){this.pristine=!1,this._parent&&!Z.onlySelf&&this._parent.markAsDirty(Z)}markAsPristine(Z={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(xe=>{xe.markAsPristine({onlySelf:!0})}),this._parent&&!Z.onlySelf&&this._parent._updatePristine(Z)}markAsPending(Z={}){this.status=Bt,!1!==Z.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!Z.onlySelf&&this._parent.markAsPending(Z)}disable(Z={}){const xe=this._parentMarkedDirty(Z.onlySelf);this.status=bn,this.errors=null,this._forEachChild(te=>{te.disable({...Z,onlySelf:!0})}),this._updateValue(),!1!==Z.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...Z,skipPristineCheck:xe}),this._onDisabledChange.forEach(te=>te(!0))}enable(Z={}){const xe=this._parentMarkedDirty(Z.onlySelf);this.status=It,this._forEachChild(te=>{te.enable({...Z,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:Z.emitEvent}),this._updateAncestors({...Z,skipPristineCheck:xe}),this._onDisabledChange.forEach(te=>te(!1))}_updateAncestors(Z){this._parent&&!Z.onlySelf&&(this._parent.updateValueAndValidity(Z),Z.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(Z){this._parent=Z}getRawValue(){return this.value}updateValueAndValidity(Z={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===It||this.status===Bt)&&this._runAsyncValidator(Z.emitEvent)),!1!==Z.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!Z.onlySelf&&this._parent.updateValueAndValidity(Z)}_updateTreeValidity(Z={emitEvent:!0}){this._forEachChild(xe=>xe._updateTreeValidity(Z)),this.updateValueAndValidity({onlySelf:!0,emitEvent:Z.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?bn:It}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(Z){if(this.asyncValidator){this.status=Bt,this._hasOwnPendingAsyncValidator=!0;const xe=at(this.asyncValidator(this));this._asyncValidationSubscription=xe.subscribe(te=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(te,{emitEvent:Z})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(Z,xe={}){this.errors=Z,this._updateControlsErrors(!1!==xe.emitEvent)}get(Z){let xe=Z;return null==xe||(Array.isArray(xe)||(xe=xe.split(".")),0===xe.length)?null:xe.reduce((te,Be)=>te&&te._find(Be),this)}getError(Z,xe){const te=xe?this.get(xe):this;return te&&te.errors?te.errors[Z]:null}hasError(Z,xe){return!!this.getError(Z,xe)}get root(){let Z=this;for(;Z._parent;)Z=Z._parent;return Z}_updateControlsErrors(Z){this.status=this._calculateStatus(),Z&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(Z)}_initObservables(){this.valueChanges=new M.vpe,this.statusChanges=new M.vpe}_calculateStatus(){return this._allControlsDisabled()?bn:this.errors?rt:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Bt)?Bt:this._anyControlsHaveStatus(rt)?rt:It}_anyControlsHaveStatus(Z){return this._anyControls(xe=>xe.status===Z)}_anyControlsDirty(){return this._anyControls(Z=>Z.dirty)}_anyControlsTouched(){return this._anyControls(Z=>Z.touched)}_updatePristine(Z={}){this.pristine=!this._anyControlsDirty(),this._parent&&!Z.onlySelf&&this._parent._updatePristine(Z)}_updateTouched(Z={}){this.touched=this._anyControlsTouched(),this._parent&&!Z.onlySelf&&this._parent._updateTouched(Z)}_registerOnCollectionChange(Z){this._onCollectionChange=Z}_setUpdateStrategy(Z){Ge(Z)&&null!=Z.updateOn&&(this._updateOn=Z.updateOn)}_parentMarkedDirty(Z){return!Z&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(Z){return null}_assignValidators(Z){this._rawValidators=Array.isArray(Z)?Z.slice():Z,this._composedValidatorFn=function Ye(ee){return Array.isArray(ee)?Cn(ee):ee||null}(this._rawValidators)}_assignAsyncValidators(Z){this._rawAsyncValidators=Array.isArray(Z)?Z.slice():Z,this._composedAsyncValidatorFn=function wt(ee){return Array.isArray(ee)?xt(ee):ee||null}(this._rawAsyncValidators)}}class si extends $n{constructor(Z,xe,te){super(Pn(xe),je(te,xe)),this.controls=Z,this._initObservables(),this._setUpdateStrategy(xe),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(Z,xe){return this.controls[Z]?this.controls[Z]:(this.controls[Z]=xe,xe.setParent(this),xe._registerOnCollectionChange(this._onCollectionChange),xe)}addControl(Z,xe,te={}){this.registerControl(Z,xe),this.updateValueAndValidity({emitEvent:te.emitEvent}),this._onCollectionChange()}removeControl(Z,xe={}){this.controls[Z]&&this.controls[Z]._registerOnCollectionChange(()=>{}),delete this.controls[Z],this.updateValueAndValidity({emitEvent:xe.emitEvent}),this._onCollectionChange()}setControl(Z,xe,te={}){this.controls[Z]&&this.controls[Z]._registerOnCollectionChange(()=>{}),delete this.controls[Z],xe&&this.registerControl(Z,xe),this.updateValueAndValidity({emitEvent:te.emitEvent}),this._onCollectionChange()}contains(Z){return this.controls.hasOwnProperty(Z)&&this.controls[Z].enabled}setValue(Z,xe={}){(function cn(ee,Z,xe){ee._forEachChild((te,Be)=>{if(void 0===xe[Be])throw new M.vHH(1002,"")})})(this,0,Z),Object.keys(Z).forEach(te=>{(function Ot(ee,Z,xe){const te=ee.controls;if(!(Z?Object.keys(te):te).length)throw new M.vHH(1e3,"");if(!te[xe])throw new M.vHH(1001,"")})(this,!0,te),this.controls[te].setValue(Z[te],{onlySelf:!0,emitEvent:xe.emitEvent})}),this.updateValueAndValidity(xe)}patchValue(Z,xe={}){null!=Z&&(Object.keys(Z).forEach(te=>{const Be=this.controls[te];Be&&Be.patchValue(Z[te],{onlySelf:!0,emitEvent:xe.emitEvent})}),this.updateValueAndValidity(xe))}reset(Z={},xe={}){this._forEachChild((te,Be)=>{te.reset(Z[Be],{onlySelf:!0,emitEvent:xe.emitEvent})}),this._updatePristine(xe),this._updateTouched(xe),this.updateValueAndValidity(xe)}getRawValue(){return this._reduceChildren({},(Z,xe,te)=>(Z[te]=xe.getRawValue(),Z))}_syncPendingControls(){let Z=this._reduceChildren(!1,(xe,te)=>!!te._syncPendingControls()||xe);return Z&&this.updateValueAndValidity({onlySelf:!0}),Z}_forEachChild(Z){Object.keys(this.controls).forEach(xe=>{const te=this.controls[xe];te&&Z(te,xe)})}_setUpControls(){this._forEachChild(Z=>{Z.setParent(this),Z._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(Z){for(const[xe,te]of Object.entries(this.controls))if(this.contains(xe)&&Z(te))return!0;return!1}_reduceValue(){return this._reduceChildren({},(xe,te,Be)=>((te.enabled||this.disabled)&&(xe[Be]=te.value),xe))}_reduceChildren(Z,xe){let te=Z;return this._forEachChild((Be,zn)=>{te=xe(te,Be,zn)}),te}_allControlsDisabled(){for(const Z of Object.keys(this.controls))if(this.controls[Z].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(Z){return this.controls.hasOwnProperty(Z)?this.controls[Z]:null}}const Di=new M.OlP("CallSetDisabledState",{providedIn:"root",factory:()=>no}),no="always";function Wr(ee,Z,xe=no){qr(ee,Z),Z.valueAccessor.writeValue(ee.value),(ee.disabled||"always"===xe)&&Z.valueAccessor.setDisabledState?.(ee.disabled),function Br(ee,Z){Z.valueAccessor.registerOnChange(xe=>{ee._pendingValue=xe,ee._pendingChange=!0,ee._pendingDirty=!0,"change"===ee.updateOn&&Hi(ee,Z)})}(ee,Z),function Ur(ee,Z){const xe=(te,Be)=>{Z.valueAccessor.writeValue(te),Be&&Z.viewToModelUpdate(te)};ee.registerOnChange(xe),Z._registerOnDestroy(()=>{ee._unregisterOnChange(xe)})}(ee,Z),function Dr(ee,Z){Z.valueAccessor.registerOnTouched(()=>{ee._pendingTouched=!0,"blur"===ee.updateOn&&ee._pendingChange&&Hi(ee,Z),"submit"!==ee.updateOn&&ee.markAsTouched()})}(ee,Z),function Uo(ee,Z){if(Z.valueAccessor.setDisabledState){const xe=te=>{Z.valueAccessor.setDisabledState(te)};ee.registerOnDisabledChange(xe),Z._registerOnDestroy(()=>{ee._unregisterOnDisabledChange(xe)})}}(ee,Z)}function qi(ee,Z,xe=!0){const te=()=>{};Z.valueAccessor&&(Z.valueAccessor.registerOnChange(te),Z.valueAccessor.registerOnTouched(te)),Ao(ee,Z),ee&&(Z._invokeOnDestroyCallbacks(),ee._registerOnCollectionChange(()=>{}))}function Mo(ee,Z){ee.forEach(xe=>{xe.registerOnValidatorChange&&xe.registerOnValidatorChange(Z)})}function qr(ee,Z){const xe=xn(ee);null!==Z.validator?ee.setValidators(St(xe,Z.validator)):"function"==typeof xe&&ee.setValidators([xe]);const te=Hn(ee);null!==Z.asyncValidator?ee.setAsyncValidators(St(te,Z.asyncValidator)):"function"==typeof te&&ee.setAsyncValidators([te]);const Be=()=>ee.updateValueAndValidity();Mo(Z._rawValidators,Be),Mo(Z._rawAsyncValidators,Be)}function Ao(ee,Z){let xe=!1;if(null!==ee){if(null!==Z.validator){const Be=xn(ee);if(Array.isArray(Be)&&Be.length>0){const zn=Be.filter(zi=>zi!==Z.validator);zn.length!==Be.length&&(xe=!0,ee.setValidators(zn))}}if(null!==Z.asyncValidator){const Be=Hn(ee);if(Array.isArray(Be)&&Be.length>0){const zn=Be.filter(zi=>zi!==Z.asyncValidator);zn.length!==Be.length&&(xe=!0,ee.setAsyncValidators(zn))}}}const te=()=>{};return Mo(Z._rawValidators,te),Mo(Z._rawAsyncValidators,te),xe}function Hi(ee,Z){ee._pendingDirty&&ee.markAsDirty(),ee.setValue(ee._pendingValue,{emitModelToViewChange:!1}),Z.viewToModelUpdate(ee._pendingValue),ee._pendingChange=!1}function xr(ee,Z){qr(ee,Z)}function os(ee,Z){ee._syncPendingControls(),Z.forEach(xe=>{const te=xe.control;"submit"===te.updateOn&&te._pendingChange&&(xe.viewToModelUpdate(te._pendingValue),te._pendingChange=!1)})}const Pi={provide:yn,useExisting:(0,M.Gpc)(()=>Oe)},se=(()=>Promise.resolve())();let Oe=(()=>{var ee;class Z extends yn{constructor(te,Be,zn){super(),this.callSetDisabledState=zn,this.submitted=!1,this._directives=new Set,this.ngSubmit=new M.vpe,this.form=new si({},Cn(te),xt(Be))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(te){se.then(()=>{const Be=this._findContainer(te.path);te.control=Be.registerControl(te.name,te.control),Wr(te.control,te,this.callSetDisabledState),te.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(te)})}getControl(te){return this.form.get(te.path)}removeControl(te){se.then(()=>{const Be=this._findContainer(te.path);Be&&Be.removeControl(te.name),this._directives.delete(te)})}addFormGroup(te){se.then(()=>{const Be=this._findContainer(te.path),zn=new si({});xr(zn,te),Be.registerControl(te.name,zn),zn.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(te){se.then(()=>{const Be=this._findContainer(te.path);Be&&Be.removeControl(te.name)})}getFormGroup(te){return this.form.get(te.path)}updateModel(te,Be){se.then(()=>{this.form.get(te.path).setValue(Be)})}setValue(te){this.control.setValue(te)}onSubmit(te){return this.submitted=!0,os(this.form,this._directives),this.ngSubmit.emit(te),"dialog"===te?.target?.method}onReset(){this.resetForm()}resetForm(te=void 0){this.form.reset(te),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(te){return te.pop(),te.length?this.form.get(te):this.form}}return(ee=Z).\u0275fac=function(te){return new(te||ee)(M.Y36(un,10),M.Y36(De,10),M.Y36(Di,8))},ee.\u0275dir=M.lG2({type:ee,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(te,Be){1&te&&M.NdJ("submit",function(zi){return Be.onSubmit(zi)})("reset",function(){return Be.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[M._Bn([Pi]),M.qOj]}),Z})();function ge(ee,Z){const xe=ee.indexOf(Z);xe>-1&&ee.splice(xe,1)}function Te(ee){return"object"==typeof ee&&null!==ee&&2===Object.keys(ee).length&&"value"in ee&&"disabled"in ee}const vt=class extends $n{constructor(Z=null,xe,te){super(Pn(xe),je(te,xe)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(Z),this._setUpdateStrategy(xe),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Ge(xe)&&(xe.nonNullable||xe.initialValueIsDefault)&&(this.defaultValue=Te(Z)?Z.value:Z)}setValue(Z,xe={}){this.value=this._pendingValue=Z,this._onChange.length&&!1!==xe.emitModelToViewChange&&this._onChange.forEach(te=>te(this.value,!1!==xe.emitViewToModelChange)),this.updateValueAndValidity(xe)}patchValue(Z,xe={}){this.setValue(Z,xe)}reset(Z=this.defaultValue,xe={}){this._applyFormState(Z),this.markAsPristine(xe),this.markAsUntouched(xe),this.setValue(this.value,xe),this._pendingChange=!1}_updateValue(){}_anyControls(Z){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(Z){this._onChange.push(Z)}_unregisterOnChange(Z){ge(this._onChange,Z)}registerOnDisabledChange(Z){this._onDisabledChange.push(Z)}_unregisterOnDisabledChange(Z){ge(this._onDisabledChange,Z)}_forEachChild(Z){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(Z){Te(Z)?(this.value=this._pendingValue=Z.value,Z.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=Z}},jo={provide:lr,useExisting:(0,M.Gpc)(()=>To)},mo=(()=>Promise.resolve())();let To=(()=>{var ee;class Z extends lr{constructor(te,Be,zn,zi,ns,ws){super(),this._changeDetectorRef=ns,this.callSetDisabledState=ws,this.control=new vt,this._registered=!1,this.name="",this.update=new M.vpe,this._parent=te,this._setValidators(Be),this._setAsyncValidators(zn),this.valueAccessor=function Yr(ee,Z){if(!Z)return null;let xe,te,Be;return Array.isArray(Z),Z.forEach(zn=>{zn.constructor===Ze?xe=zn:function Co(ee){return Object.getPrototypeOf(ee.constructor)===Qe}(zn)?te=zn:Be=zn}),Be||te||xe||null}(0,zi)}ngOnChanges(te){if(this._checkForErrors(),!this._registered||"name"in te){if(this._registered&&(this._checkName(),this.formDirective)){const Be=te.name.previousValue;this.formDirective.removeControl({name:Be,path:this._getPath(Be)})}this._setUpControl()}"isDisabled"in te&&this._updateDisabled(te),function es(ee,Z){if(!ee.hasOwnProperty("model"))return!1;const xe=ee.model;return!!xe.isFirstChange()||!Object.is(Z,xe.currentValue)}(te,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(te){this.viewModel=te,this.update.emit(te)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Wr(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(te){mo.then(()=>{this.control.setValue(te,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(te){const Be=te.isDisabled.currentValue,zn=0!==Be&&(0,M.VuI)(Be);mo.then(()=>{zn&&!this.control.disabled?this.control.disable():!zn&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(te){return this._parent?function Gr(ee,Z){return[...Z.path,ee]}(te,this._parent):[te]}}return(ee=Z).\u0275fac=function(te){return new(te||ee)(M.Y36(yn,9),M.Y36(un,10),M.Y36(De,10),M.Y36(_t,10),M.Y36(M.sBO,8),M.Y36(Di,8))},ee.\u0275dir=M.lG2({type:ee,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[M._Bn([jo]),M.qOj,M.TTD]}),Z})(),Ys=(()=>{var ee;class Z{}return(ee=Z).\u0275fac=function(te){return new(te||ee)},ee.\u0275mod=M.oAB({type:ee}),ee.\u0275inj=M.cJS({}),Z})();const hs={provide:yn,useExisting:(0,M.Gpc)(()=>co)};let co=(()=>{var ee;class Z extends yn{constructor(te,Be,zn){super(),this.callSetDisabledState=zn,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new M.vpe,this._setValidators(te),this._setAsyncValidators(Be)}ngOnChanges(te){this._checkFormPresent(),te.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Ao(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(te){const Be=this.form.get(te.path);return Wr(Be,te,this.callSetDisabledState),Be.updateValueAndValidity({emitEvent:!1}),this.directives.push(te),Be}getControl(te){return this.form.get(te.path)}removeControl(te){qi(te.control||null,te,!1),function Lo(ee,Z){const xe=ee.indexOf(Z);xe>-1&&ee.splice(xe,1)}(this.directives,te)}addFormGroup(te){this._setUpFormContainer(te)}removeFormGroup(te){this._cleanUpFormContainer(te)}getFormGroup(te){return this.form.get(te.path)}addFormArray(te){this._setUpFormContainer(te)}removeFormArray(te){this._cleanUpFormContainer(te)}getFormArray(te){return this.form.get(te.path)}updateModel(te,Be){this.form.get(te.path).setValue(Be)}onSubmit(te){return this.submitted=!0,os(this.form,this.directives),this.ngSubmit.emit(te),"dialog"===te?.target?.method}onReset(){this.resetForm()}resetForm(te=void 0){this.form.reset(te),this.submitted=!1}_updateDomValue(){this.directives.forEach(te=>{const Be=te.control,zn=this.form.get(te.path);Be!==zn&&(qi(Be||null,te),(ee=>ee instanceof vt)(zn)&&(Wr(zn,te,this.callSetDisabledState),te.control=zn))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(te){const Be=this.form.get(te.path);xr(Be,te),Be.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(te){if(this.form){const Be=this.form.get(te.path);Be&&function Ni(ee,Z){return Ao(ee,Z)}(Be,te)&&Be.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){qr(this.form,this),this._oldForm&&Ao(this._oldForm,this)}_checkFormPresent(){}}return(ee=Z).\u0275fac=function(te){return new(te||ee)(M.Y36(un,10),M.Y36(De,10),M.Y36(Di,8))},ee.\u0275dir=M.lG2({type:ee,selectors:[["","formGroup",""]],hostBindings:function(te,Be){1&te&&M.NdJ("submit",function(zi){return Be.onSubmit(zi)})("reset",function(){return Be.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[M._Bn([hs]),M.qOj,M.TTD]}),Z})(),ms=(()=>{var ee;class Z{}return(ee=Z).\u0275fac=function(te){return new(te||ee)},ee.\u0275mod=M.oAB({type:ee}),ee.\u0275inj=M.cJS({imports:[Ys]}),Z})(),Lr=(()=>{var ee;class Z{static withConfig(te){return{ngModule:Z,providers:[{provide:Di,useValue:te.callSetDisabledState??no}]}}}return(ee=Z).\u0275fac=function(te){return new(te||ee)},ee.\u0275mod=M.oAB({type:ee}),ee.\u0275inj=M.cJS({imports:[ms]}),Z})()},6593:(ci,Qt,le)=>{"use strict";le.d(Qt,{Dx:()=>lr,b2:()=>qn,q6:()=>St,se:()=>dt});var M=le(9468),b=le(6814);class Ft extends b.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class l extends Ft{static makeCurrent(){(0,b.HT)(new l)}onAndCancel(je,wt,Ge){return je.addEventListener(wt,Ge),()=>{je.removeEventListener(wt,Ge)}}dispatchEvent(je,wt){je.dispatchEvent(wt)}remove(je){je.parentNode&&je.parentNode.removeChild(je)}createElement(je,wt){return(wt=wt||this.getDefaultDocument()).createElement(je)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(je){return je.nodeType===Node.ELEMENT_NODE}isShadowRoot(je){return je instanceof DocumentFragment}getGlobalEventTarget(je,wt){return"window"===wt?window:"document"===wt?je:"body"===wt?je.body:null}getBaseHref(je){const wt=function ht(){return Me=Me||document.querySelector("base"),Me?Me.getAttribute("href"):null}();return null==wt?null:function pt(Ye){Ke=Ke||document.createElement("a"),Ke.setAttribute("href",Ye);const je=Ke.pathname;return"/"===je.charAt(0)?je:`/${je}`}(wt)}resetBaseElement(){Me=null}getUserAgent(){return window.navigator.userAgent}getCookie(je){return(0,b.Mx)(document.cookie,je)}}let Ke,Me=null,Dt=(()=>{var Ye;class je{build(){return new XMLHttpRequest}}return(Ye=je).\u0275fac=function(Ge){return new(Ge||Ye)},Ye.\u0275prov=M.Yz7({token:Ye,factory:Ye.\u0275fac}),je})();const st=new M.OlP("EventManagerPlugins");let bt=(()=>{var Ye;class je{constructor(Ge,Ot){this._zone=Ot,this._eventNameToPlugin=new Map,Ge.forEach(cn=>{cn.manager=this}),this._plugins=Ge.slice().reverse()}addEventListener(Ge,Ot,cn){return this._findPluginFor(Ot).addEventListener(Ge,Ot,cn)}getZone(){return this._zone}_findPluginFor(Ge){let Ot=this._eventNameToPlugin.get(Ge);if(Ot)return Ot;if(Ot=this._plugins.find($n=>$n.supports(Ge)),!Ot)throw new M.vHH(5101,!1);return this._eventNameToPlugin.set(Ge,Ot),Ot}}return(Ye=je).\u0275fac=function(Ge){return new(Ge||Ye)(M.LFG(st),M.LFG(M.R0b))},Ye.\u0275prov=M.Yz7({token:Ye,factory:Ye.\u0275fac}),je})();class mt{constructor(je){this._doc=je}}const Qe="ng-app-id";let _t=(()=>{var Ye;class je{constructor(Ge,Ot,cn,$n={}){this.doc=Ge,this.appId=Ot,this.nonce=cn,this.platformId=$n,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=(0,b.PM)($n),this.resetHostNodes()}addStyles(Ge){for(const Ot of Ge)1===this.changeUsageCount(Ot,1)&&this.onStyleAdded(Ot)}removeStyles(Ge){for(const Ot of Ge)this.changeUsageCount(Ot,-1)<=0&&this.onStyleRemoved(Ot)}ngOnDestroy(){const Ge=this.styleNodesInDOM;Ge&&(Ge.forEach(Ot=>Ot.remove()),Ge.clear());for(const Ot of this.getAllStyles())this.onStyleRemoved(Ot);this.resetHostNodes()}addHost(Ge){this.hostNodes.add(Ge);for(const Ot of this.getAllStyles())this.addStyleToHost(Ge,Ot)}removeHost(Ge){this.hostNodes.delete(Ge)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(Ge){for(const Ot of this.hostNodes)this.addStyleToHost(Ot,Ge)}onStyleRemoved(Ge){const Ot=this.styleRef;Ot.get(Ge)?.elements?.forEach(cn=>cn.remove()),Ot.delete(Ge)}collectServerRenderedStyles(){const Ge=this.doc.head?.querySelectorAll(`style[${Qe}="${this.appId}"]`);if(Ge?.length){const Ot=new Map;return Ge.forEach(cn=>{null!=cn.textContent&&Ot.set(cn.textContent,cn)}),Ot}return null}changeUsageCount(Ge,Ot){const cn=this.styleRef;if(cn.has(Ge)){const $n=cn.get(Ge);return $n.usage+=Ot,$n.usage}return cn.set(Ge,{usage:Ot,elements:[]}),Ot}getStyleElement(Ge,Ot){const cn=this.styleNodesInDOM,$n=cn?.get(Ot);if($n?.parentNode===Ge)return cn.delete(Ot),$n.removeAttribute(Qe),$n;{const si=this.doc.createElement("style");return this.nonce&&si.setAttribute("nonce",this.nonce),si.textContent=Ot,this.platformIsServer&&si.setAttribute(Qe,this.appId),si}}addStyleToHost(Ge,Ot){const cn=this.getStyleElement(Ge,Ot);Ge.appendChild(cn);const $n=this.styleRef,si=$n.get(Ot)?.elements;si?si.push(cn):$n.set(Ot,{elements:[cn],usage:1})}resetHostNodes(){const Ge=this.hostNodes;Ge.clear(),Ge.add(this.doc.head)}}return(Ye=je).\u0275fac=function(Ge){return new(Ge||Ye)(M.LFG(b.K0),M.LFG(M.AFp),M.LFG(M.Ojb,8),M.LFG(M.Lbi))},Ye.\u0275prov=M.Yz7({token:Ye,factory:Ye.\u0275fac}),je})();const Wt={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Ct=/%COMP%/g,Fe=new M.OlP("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function De(Ye,je){return je.map(wt=>wt.replace(Ct,Ye))}let dt=(()=>{var Ye;class je{constructor(Ge,Ot,cn,$n,si,bi,Ui,ji=null){this.eventManager=Ge,this.sharedStylesHost=Ot,this.appId=cn,this.removeStylesOnCompDestroy=$n,this.doc=si,this.platformId=bi,this.ngZone=Ui,this.nonce=ji,this.rendererByCompId=new Map,this.platformIsServer=(0,b.PM)(bi),this.defaultRenderer=new Lt(Ge,si,Ui,this.platformIsServer)}createRenderer(Ge,Ot){if(!Ge||!Ot)return this.defaultRenderer;this.platformIsServer&&Ot.encapsulation===M.ifc.ShadowDom&&(Ot={...Ot,encapsulation:M.ifc.Emulated});const cn=this.getOrCreateRenderer(Ge,Ot);return cn instanceof Ht?cn.applyToHost(Ge):cn instanceof Jn&&cn.applyStyles(),cn}getOrCreateRenderer(Ge,Ot){const cn=this.rendererByCompId;let $n=cn.get(Ot.id);if(!$n){const si=this.doc,bi=this.ngZone,Ui=this.eventManager,ji=this.sharedStylesHost,vr=this.removeStylesOnCompDestroy,Di=this.platformIsServer;switch(Ot.encapsulation){case M.ifc.Emulated:$n=new Ht(Ui,ji,Ot,this.appId,vr,si,bi,Di);break;case M.ifc.ShadowDom:return new Vt(Ui,ji,Ge,Ot,si,bi,this.nonce,Di);default:$n=new Jn(Ui,ji,Ot,vr,si,bi,Di)}cn.set(Ot.id,$n)}return $n}ngOnDestroy(){this.rendererByCompId.clear()}}return(Ye=je).\u0275fac=function(Ge){return new(Ge||Ye)(M.LFG(bt),M.LFG(_t),M.LFG(M.AFp),M.LFG(Fe),M.LFG(b.K0),M.LFG(M.Lbi),M.LFG(M.R0b),M.LFG(M.Ojb))},Ye.\u0275prov=M.Yz7({token:Ye,factory:Ye.\u0275fac}),je})();class Lt{constructor(je,wt,Ge,Ot){this.eventManager=je,this.doc=wt,this.ngZone=Ge,this.platformIsServer=Ot,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(je,wt){return wt?this.doc.createElementNS(Wt[wt]||wt,je):this.doc.createElement(je)}createComment(je){return this.doc.createComment(je)}createText(je){return this.doc.createTextNode(je)}appendChild(je,wt){(hn(je)?je.content:je).appendChild(wt)}insertBefore(je,wt,Ge){je&&(hn(je)?je.content:je).insertBefore(wt,Ge)}removeChild(je,wt){je&&je.removeChild(wt)}selectRootElement(je,wt){let Ge="string"==typeof je?this.doc.querySelector(je):je;if(!Ge)throw new M.vHH(-5104,!1);return wt||(Ge.textContent=""),Ge}parentNode(je){return je.parentNode}nextSibling(je){return je.nextSibling}setAttribute(je,wt,Ge,Ot){if(Ot){wt=Ot+":"+wt;const cn=Wt[Ot];cn?je.setAttributeNS(cn,wt,Ge):je.setAttribute(wt,Ge)}else je.setAttribute(wt,Ge)}removeAttribute(je,wt,Ge){if(Ge){const Ot=Wt[Ge];Ot?je.removeAttributeNS(Ot,wt):je.removeAttribute(`${Ge}:${wt}`)}else je.removeAttribute(wt)}addClass(je,wt){je.classList.add(wt)}removeClass(je,wt){je.classList.remove(wt)}setStyle(je,wt,Ge,Ot){Ot&(M.JOm.DashCase|M.JOm.Important)?je.style.setProperty(wt,Ge,Ot&M.JOm.Important?"important":""):je.style[wt]=Ge}removeStyle(je,wt,Ge){Ge&M.JOm.DashCase?je.style.removeProperty(wt):je.style[wt]=""}setProperty(je,wt,Ge){je[wt]=Ge}setValue(je,wt){je.nodeValue=wt}listen(je,wt,Ge){if("string"==typeof je&&!(je=(0,b.q)().getGlobalEventTarget(this.doc,je)))throw new Error(`Unsupported event target ${je} for event ${wt}`);return this.eventManager.addEventListener(je,wt,this.decoratePreventDefault(Ge))}decoratePreventDefault(je){return wt=>{if("__ngUnwrap__"===wt)return je;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>je(wt)):je(wt))&&wt.preventDefault()}}}function hn(Ye){return"TEMPLATE"===Ye.tagName&&void 0!==Ye.content}class Vt extends Lt{constructor(je,wt,Ge,Ot,cn,$n,si,bi){super(je,cn,$n,bi),this.sharedStylesHost=wt,this.hostEl=Ge,this.shadowRoot=Ge.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const Ui=De(Ot.id,Ot.styles);for(const ji of Ui){const vr=document.createElement("style");si&&vr.setAttribute("nonce",si),vr.textContent=ji,this.shadowRoot.appendChild(vr)}}nodeOrShadowRoot(je){return je===this.hostEl?this.shadowRoot:je}appendChild(je,wt){return super.appendChild(this.nodeOrShadowRoot(je),wt)}insertBefore(je,wt,Ge){return super.insertBefore(this.nodeOrShadowRoot(je),wt,Ge)}removeChild(je,wt){return super.removeChild(this.nodeOrShadowRoot(je),wt)}parentNode(je){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(je)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Jn extends Lt{constructor(je,wt,Ge,Ot,cn,$n,si,bi){super(je,cn,$n,si),this.sharedStylesHost=wt,this.removeStylesOnCompDestroy=Ot,this.styles=bi?De(bi,Ge.styles):Ge.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class Ht extends Jn{constructor(je,wt,Ge,Ot,cn,$n,si,bi){const Ui=Ot+"-"+Ge.id;super(je,wt,Ge,cn,$n,si,bi,Ui),this.contentAttr=function $t(Ye){return"_ngcontent-%COMP%".replace(Ct,Ye)}(Ui),this.hostAttr=function un(Ye){return"_nghost-%COMP%".replace(Ct,Ye)}(Ui)}applyToHost(je){this.applyStyles(),this.setAttribute(je,this.hostAttr,"")}createElement(je,wt){const Ge=super.createElement(je,wt);return super.setAttribute(Ge,this.contentAttr,""),Ge}}let li=(()=>{var Ye;class je extends mt{constructor(Ge){super(Ge)}supports(Ge){return!0}addEventListener(Ge,Ot,cn){return Ge.addEventListener(Ot,cn,!1),()=>this.removeEventListener(Ge,Ot,cn)}removeEventListener(Ge,Ot,cn){return Ge.removeEventListener(Ot,cn)}}return(Ye=je).\u0275fac=function(Ge){return new(Ge||Ye)(M.LFG(b.K0))},Ye.\u0275prov=M.Yz7({token:Ye,factory:Ye.\u0275fac}),je})();const tn=["alt","control","meta","shift"],Re={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Ne={alt:Ye=>Ye.altKey,control:Ye=>Ye.ctrlKey,meta:Ye=>Ye.metaKey,shift:Ye=>Ye.shiftKey};let at=(()=>{var Ye;class je extends mt{constructor(Ge){super(Ge)}supports(Ge){return null!=je.parseEventName(Ge)}addEventListener(Ge,Ot,cn){const $n=je.parseEventName(Ot),si=je.eventCallback($n.fullKey,cn,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,b.q)().onAndCancel(Ge,$n.domEventName,si))}static parseEventName(Ge){const Ot=Ge.toLowerCase().split("."),cn=Ot.shift();if(0===Ot.length||"keydown"!==cn&&"keyup"!==cn)return null;const $n=je._normalizeKey(Ot.pop());let si="",bi=Ot.indexOf("code");if(bi>-1&&(Ot.splice(bi,1),si="code."),tn.forEach(ji=>{const vr=Ot.indexOf(ji);vr>-1&&(Ot.splice(vr,1),si+=ji+".")}),si+=$n,0!=Ot.length||0===$n.length)return null;const Ui={};return Ui.domEventName=cn,Ui.fullKey=si,Ui}static matchEventFullKeyCode(Ge,Ot){let cn=Re[Ge.key]||Ge.key,$n="";return Ot.indexOf("code.")>-1&&(cn=Ge.code,$n="code."),!(null==cn||!cn)&&(cn=cn.toLowerCase()," "===cn?cn="space":"."===cn&&(cn="dot"),tn.forEach(si=>{si!==cn&&(0,Ne[si])(Ge)&&($n+=si+".")}),$n+=cn,$n===Ot)}static eventCallback(Ge,Ot,cn){return $n=>{je.matchEventFullKeyCode($n,Ge)&&cn.runGuarded(()=>Ot($n))}}static _normalizeKey(Ge){return"esc"===Ge?"escape":Ge}}return(Ye=je).\u0275fac=function(Ge){return new(Ge||Ye)(M.LFG(b.K0))},Ye.\u0275prov=M.Yz7({token:Ye,factory:Ye.\u0275fac}),je})();const St=(0,M.eFA)(M._c5,"browser",[{provide:M.Lbi,useValue:b.bD},{provide:M.g9A,useValue:function ri(){l.makeCurrent()},multi:!0},{provide:b.K0,useFactory:function nn(){return(0,M.RDi)(document),document},deps:[]}]),xn=new M.OlP(""),Hn=[{provide:M.rWj,useClass:class yt{addToWindow(je){M.dqk.getAngularTestability=(Ge,Ot=!0)=>{const cn=je.findTestabilityInTree(Ge,Ot);if(null==cn)throw new M.vHH(5103,!1);return cn},M.dqk.getAllAngularTestabilities=()=>je.getAllTestabilities(),M.dqk.getAllAngularRootElements=()=>je.getAllRootElements(),M.dqk.frameworkStabilizers||(M.dqk.frameworkStabilizers=[]),M.dqk.frameworkStabilizers.push(Ge=>{const Ot=M.dqk.getAllAngularTestabilities();let cn=Ot.length,$n=!1;const si=function(bi){$n=$n||bi,cn--,0==cn&&Ge($n)};Ot.forEach(bi=>{bi.whenStable(si)})})}findTestabilityInTree(je,wt,Ge){return null==wt?null:je.getTestability(wt)??(Ge?(0,b.q)().isShadowRoot(wt)?this.findTestabilityInTree(je,wt.host,!0):this.findTestabilityInTree(je,wt.parentElement,!0):null)}},deps:[]},{provide:M.lri,useClass:M.dDg,deps:[M.R0b,M.eoX,M.rWj]},{provide:M.dDg,useClass:M.dDg,deps:[M.R0b,M.eoX,M.rWj]}],yi=[{provide:M.zSh,useValue:"root"},{provide:M.qLn,useFactory:function Cn(){return new M.qLn},deps:[]},{provide:st,useClass:li,multi:!0,deps:[b.K0,M.R0b,M.Lbi]},{provide:st,useClass:at,multi:!0,deps:[b.K0]},dt,_t,bt,{provide:M.FYo,useExisting:dt},{provide:b.JF,useClass:Dt,deps:[]},[]];let qn=(()=>{var Ye;class je{constructor(Ge){}static withServerTransition(Ge){return{ngModule:je,providers:[{provide:M.AFp,useValue:Ge.appId}]}}}return(Ye=je).\u0275fac=function(Ge){return new(Ge||Ye)(M.LFG(xn,12))},Ye.\u0275mod=M.oAB({type:Ye}),Ye.\u0275inj=M.cJS({providers:[...yi,...Hn],imports:[b.ez,M.hGG]}),je})(),lr=(()=>{var Ye;class je{constructor(Ge){this._doc=Ge}getTitle(){return this._doc.title}setTitle(Ge){this._doc.title=Ge||""}}return(Ye=je).\u0275fac=function(Ge){return new(Ge||Ye)(M.LFG(b.K0))},Ye.\u0275prov=M.Yz7({token:Ye,factory:function(Ge){let Ot=null;return Ot=Ge?new Ge:function yn(){return new lr((0,M.LFG)(b.K0))}(),Ot},providedIn:"root"}),je})();typeof window<"u"&&window},6879:(ci,Qt,le)=>{"use strict";le.d(Qt,{gz:()=>lo,y6:()=>To,OD:()=>Lo,eC:()=>xt,wm:()=>Bl,wN:()=>Mi,F0:()=>Js,rH:()=>ei,Bz:()=>js,Hx:()=>No});var M=le(9468),b=le(5592),Ft=le(4674),Me=le(7715),ht=le(2096),Ke=le(5619),pt=le(2572);const Dt=(0,le(2306).d)(P=>function(){P(this),this.name="EmptyError",this.message="no elements in sequence"});var st=le(5211),bt=le(4911),mt=le(8407);function Qe(P,O){const V=(0,Ft.m)(P)?P:()=>P,L=q=>q.error(V());return new b.y(O?q=>O.schedule(L,0,q):L)}var _t=le(6232),Wt=le(7394),Ct=le(9360),it=le(8251);function Kt(){return(0,Ct.e)((P,O)=>{let V=null;P._refCount++;const L=(0,it.x)(O,void 0,void 0,void 0,()=>{if(!P||P._refCount<=0||0<--P._refCount)return void(V=null);const q=P._connection,ve=V;V=null,q&&(!ve||q===ve)&&q.unsubscribe(),O.unsubscribe()});P.subscribe(L),L.closed||(V=P.connect())})}class Tt extends b.y{constructor(O,V){super(),this.source=O,this.subjectFactory=V,this._subject=null,this._refCount=0,this._connection=null,(0,Ct.A)(O)&&(this.lift=O.lift)}_subscribe(O){return this.getSubject().subscribe(O)}getSubject(){const O=this._subject;return(!O||O.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:O}=this;this._subject=this._connection=null,O?.unsubscribe()}connect(){let O=this._connection;if(!O){O=this._connection=new Wt.w0;const V=this.getSubject();O.add(this.source.subscribe((0,it.x)(V,void 0,()=>{this._teardown(),V.complete()},L=>{this._teardown(),V.error(L)},()=>this._teardown()))),O.closed&&(this._connection=null,O=Wt.w0.EMPTY)}return O}refCount(){return Kt()(this)}}var Ze=le(8645),Fe=le(6814),$t=le(7398),un=le(4664),De=le(8180),dt=le(7921),Lt=le(2181),ft=le(1631);function pn(P){return(0,Ct.e)((O,V)=>{let L=!1;O.subscribe((0,it.x)(V,q=>{L=!0,V.next(q)},()=>{L||V.next(P),V.complete()}))})}function hn(P=Vt){return(0,Ct.e)((O,V)=>{let L=!1;O.subscribe((0,it.x)(V,q=>{L=!0,V.next(q)},()=>L?V.complete():V.error(P())))})}function Vt(){return new Dt}var Jn=le(2737);function Ht(P,O){const V=arguments.length>=2;return L=>L.pipe(P?(0,Lt.h)((q,ve)=>P(q,ve,L)):Jn.y,(0,De.q)(1),V?pn(O):hn(()=>new Dt))}function li(P,O){return(0,Ft.m)(O)?(0,ft.z)(P,O,1):(0,ft.z)(P,1)}var tn=le(9397),Re=le(4829);function Ne(P){return(0,Ct.e)((O,V)=>{let ve,L=null,q=!1;L=O.subscribe((0,it.x)(V,void 0,void 0,me=>{ve=(0,Re.Xf)(P(me,Ne(P)(O))),L?(L.unsubscribe(),L=null,ve.subscribe(V)):q=!0})),q&&(L.unsubscribe(),L=null,ve.subscribe(V))})}function en(P){return P<=0?()=>_t.E:(0,Ct.e)((O,V)=>{let L=[];O.subscribe((0,it.x)(V,q=>{L.push(q),P<L.length&&L.shift()},()=>{for(const q of L)V.next(q);V.complete()},void 0,()=>{L=null}))})}function ri(P){return(0,Ct.e)((O,V)=>{try{O.subscribe(V)}finally{V.add(P)}})}var Cn=le(7537),nn=le(6593);const xt="primary",St=Symbol("RouteTitle");class xn{constructor(O){this.params=O||{}}has(O){return Object.prototype.hasOwnProperty.call(this.params,O)}get(O){if(this.has(O)){const V=this.params[O];return Array.isArray(V)?V[0]:V}return null}getAll(O){if(this.has(O)){const V=this.params[O];return Array.isArray(V)?V:[V]}return[]}get keys(){return Object.keys(this.params)}}function Hn(P){return new xn(P)}function yi(P,O,V){const L=V.path.split("/");if(L.length>P.length||"full"===V.pathMatch&&(O.hasChildren()||L.length<P.length))return null;const q={};for(let ve=0;ve<L.length;ve++){const me=L[ve],et=P[ve];if(me.startsWith(":"))q[me.substring(1)]=et;else if(me!==et.path)return null}return{consumed:P.slice(0,L.length),posParams:q}}function ti(P,O){const V=P?Object.keys(P):void 0,L=O?Object.keys(O):void 0;if(!V||!L||V.length!=L.length)return!1;let q;for(let ve=0;ve<V.length;ve++)if(q=V[ve],!Xn(P[q],O[q]))return!1;return!0}function Xn(P,O){if(Array.isArray(P)&&Array.isArray(O)){if(P.length!==O.length)return!1;const V=[...P].sort(),L=[...O].sort();return V.every((q,ve)=>L[ve]===q)}return P===O}function ar(P){return P.length>0?P[P.length-1]:null}function yn(P){return function l(P){return!!P&&(P instanceof b.y||(0,Ft.m)(P.lift)&&(0,Ft.m)(P.subscribe))}(P)?P:(0,M.QGY)(P)?(0,Me.D)(Promise.resolve(P)):(0,ht.of)(P)}const lr={exact:function Si(P,O,V){if(!ir(P.segments,O.segments)||!Hr(P.segments,O.segments,V)||P.numberOfChildren!==O.numberOfChildren)return!1;for(const L in O.children)if(!P.children[L]||!Si(P.children[L],O.children[L],V))return!1;return!0},subset:po},Pr={exact:function oo(P,O){return ti(P,O)},subset:function $i(P,O){return Object.keys(O).length<=Object.keys(P).length&&Object.keys(O).every(V=>Xn(P[V],O[V]))},ignored:()=>!0};function pr(P,O,V){return lr[V.paths](P.root,O.root,V.matrixParams)&&Pr[V.queryParams](P.queryParams,O.queryParams)&&!("exact"===V.fragment&&P.fragment!==O.fragment)}function po(P,O,V){return wi(P,O,O.segments,V)}function wi(P,O,V,L){if(P.segments.length>V.length){const q=P.segments.slice(0,V.length);return!(!ir(q,V)||O.hasChildren()||!Hr(q,V,L))}if(P.segments.length===V.length){if(!ir(P.segments,V)||!Hr(P.segments,V,L))return!1;for(const q in O.children)if(!P.children[q]||!po(P.children[q],O.children[q],L))return!1;return!0}{const q=V.slice(0,P.segments.length),ve=V.slice(P.segments.length);return!!(ir(P.segments,q)&&Hr(P.segments,q,L)&&P.children[xt])&&wi(P.children[xt],O,ve,L)}}function Hr(P,O,V){return O.every((L,q)=>Pr[V](P[q].parameters,L.parameters))}class Er{constructor(O=new fi([],{}),V={},L=null){this.root=O,this.queryParams=V,this.fragment=L}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Hn(this.queryParams)),this._queryParamMap}toString(){return ae.serialize(this)}}class fi{constructor(O,V){this.segments=O,this.children=V,this.parent=null,Object.values(V).forEach(L=>L.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return de(this)}}class Sr{constructor(O,V){this.path=O,this.parameters=V}get parameterMap(){return this._parameterMap||(this._parameterMap=Hn(this.parameters)),this._parameterMap}toString(){return bn(this)}}function ir(P,O){return P.length===O.length&&P.every((V,L)=>V.path===O[L].path)}let No=(()=>{var P;class O{}return(P=O).\u0275fac=function(L){return new(L||P)},P.\u0275prov=M.Yz7({token:P,factory:function(){return new Ue},providedIn:"root"}),O})();class Ue{parse(O){const V=new Ui(O);return new Er(V.parseRootSegment(),V.parseQueryParams(),V.parseFragment())}serialize(O){const V=`/${Le(O.root,!0)}`,L=function Ye(P){const O=Object.keys(P).map(V=>{const L=P[V];return Array.isArray(L)?L.map(q=>`${ot(V)}=${ot(q)}`).join("&"):`${ot(V)}=${ot(L)}`}).filter(V=>!!V);return O.length?`?${O.join("&")}`:""}(O.queryParams);return`${V}${L}${"string"==typeof O.fragment?`#${function Rt(P){return encodeURI(P)}(O.fragment)}`:""}`}}const ae=new Ue;function de(P){return P.segments.map(O=>bn(O)).join("/")}function Le(P,O){if(!P.hasChildren())return de(P);if(O){const V=P.children[xt]?Le(P.children[xt],!1):"",L=[];return Object.entries(P.children).forEach(([q,ve])=>{q!==xt&&L.push(`${q}:${Le(ve,!1)}`)}),L.length>0?`${V}(${L.join("//")})`:V}{const V=function rr(P,O){let V=[];return Object.entries(P.children).forEach(([L,q])=>{L===xt&&(V=V.concat(O(q,L)))}),Object.entries(P.children).forEach(([L,q])=>{L!==xt&&(V=V.concat(O(q,L)))}),V}(P,(L,q)=>q===xt?[Le(P.children[xt],!1)]:[`${q}:${Le(L,!1)}`]);return 1===Object.keys(P.children).length&&null!=P.children[xt]?`${de(P)}/${V[0]}`:`${de(P)}/(${V.join("//")})`}}function We(P){return encodeURIComponent(P).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ot(P){return We(P).replace(/%3B/gi,";")}function It(P){return We(P).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function rt(P){return decodeURIComponent(P)}function Bt(P){return rt(P.replace(/\+/g,"%20"))}function bn(P){return`${It(P.path)}${function Pn(P){return Object.keys(P).map(O=>`;${It(O)}=${It(P[O])}`).join("")}(P.parameters)}`}const je=/^[^\/()?;#]+/;function wt(P){const O=P.match(je);return O?O[0]:""}const Ge=/^[^\/()?;=#]+/,cn=/^[^=?&#]+/,si=/^[^&#]+/;class Ui{constructor(O){this.url=O,this.remaining=O}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new fi([],{}):new fi([],this.parseChildren())}parseQueryParams(){const O={};if(this.consumeOptional("?"))do{this.parseQueryParam(O)}while(this.consumeOptional("&"));return O}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const O=[];for(this.peekStartsWith("(")||O.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),O.push(this.parseSegment());let V={};this.peekStartsWith("/(")&&(this.capture("/"),V=this.parseParens(!0));let L={};return this.peekStartsWith("(")&&(L=this.parseParens(!1)),(O.length>0||Object.keys(V).length>0)&&(L[xt]=new fi(O,V)),L}parseSegment(){const O=wt(this.remaining);if(""===O&&this.peekStartsWith(";"))throw new M.vHH(4009,!1);return this.capture(O),new Sr(rt(O),this.parseMatrixParams())}parseMatrixParams(){const O={};for(;this.consumeOptional(";");)this.parseParam(O);return O}parseParam(O){const V=function Ot(P){const O=P.match(Ge);return O?O[0]:""}(this.remaining);if(!V)return;this.capture(V);let L="";if(this.consumeOptional("=")){const q=wt(this.remaining);q&&(L=q,this.capture(L))}O[rt(V)]=rt(L)}parseQueryParam(O){const V=function $n(P){const O=P.match(cn);return O?O[0]:""}(this.remaining);if(!V)return;this.capture(V);let L="";if(this.consumeOptional("=")){const me=function bi(P){const O=P.match(si);return O?O[0]:""}(this.remaining);me&&(L=me,this.capture(L))}const q=Bt(V),ve=Bt(L);if(O.hasOwnProperty(q)){let me=O[q];Array.isArray(me)||(me=[me],O[q]=me),me.push(ve)}else O[q]=ve}parseParens(O){const V={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const L=wt(this.remaining),q=this.remaining[L.length];if("/"!==q&&")"!==q&&";"!==q)throw new M.vHH(4010,!1);let ve;L.indexOf(":")>-1?(ve=L.slice(0,L.indexOf(":")),this.capture(ve),this.capture(":")):O&&(ve=xt);const me=this.parseChildren();V[ve]=1===Object.keys(me).length?me[xt]:new fi([],me),this.consumeOptional("//")}return V}peekStartsWith(O){return this.remaining.startsWith(O)}consumeOptional(O){return!!this.peekStartsWith(O)&&(this.remaining=this.remaining.substring(O.length),!0)}capture(O){if(!this.consumeOptional(O))throw new M.vHH(4011,!1)}}function ji(P){return P.segments.length>0?new fi([],{[xt]:P}):P}function vr(P){const O={};for(const L of Object.keys(P.children)){const ve=vr(P.children[L]);if(L===xt&&0===ve.segments.length&&ve.hasChildren())for(const[me,et]of Object.entries(ve.children))O[me]=et;else(ve.segments.length>0||ve.hasChildren())&&(O[L]=ve)}return function Di(P){if(1===P.numberOfChildren&&P.children[xt]){const O=P.children[xt];return new fi(P.segments.concat(O.segments),O.children)}return P}(new fi(P.segments,O))}function no(P){return P instanceof Er}function Wr(P){let O;const q=ji(function V(ve){const me={};for(const In of ve.children){const Yn=V(In);me[In.outlet]=Yn}const et=new fi(ve.url,me);return ve===P&&(O=et),et}(P.root));return O??q}function qi(P,O,V,L){let q=P;for(;q.parent;)q=q.parent;if(0===O.length)return qr(q,q,q,V,L);const ve=function Dr(P){if("string"==typeof P[0]&&1===P.length&&"/"===P[0])return new Br(!0,0,P);let O=0,V=!1;const L=P.reduce((q,ve,me)=>{if("object"==typeof ve&&null!=ve){if(ve.outlets){const et={};return Object.entries(ve.outlets).forEach(([In,Yn])=>{et[In]="string"==typeof Yn?Yn.split("/"):Yn}),[...q,{outlets:et}]}if(ve.segmentPath)return[...q,ve.segmentPath]}return"string"!=typeof ve?[...q,ve]:0===me?(ve.split("/").forEach((et,In)=>{0==In&&"."===et||(0==In&&""===et?V=!0:".."===et?O++:""!=et&&q.push(et))}),q):[...q,ve]},[]);return new Br(V,O,L)}(O);if(ve.toRoot())return qr(q,q,new fi([],{}),V,L);const me=function Ur(P,O,V){if(P.isAbsolute)return new Hi(O,!0,0);if(!V)return new Hi(O,!1,NaN);if(null===V.parent)return new Hi(V,!0,0);const L=Mo(P.commands[0])?0:1;return function xr(P,O,V){let L=P,q=O,ve=V;for(;ve>q;){if(ve-=q,L=L.parent,!L)throw new M.vHH(4005,!1);q=L.segments.length}return new Hi(L,!1,q-ve)}(V,V.segments.length-1+L,P.numberOfDoubleDots)}(ve,q,P),et=me.processChildren?Gt(me.segmentGroup,me.index,ve.commands):Qo(me.segmentGroup,me.index,ve.commands);return qr(q,me.segmentGroup,et,V,L)}function Mo(P){return"object"==typeof P&&null!=P&&!P.outlets&&!P.segmentPath}function Uo(P){return"object"==typeof P&&null!=P&&P.outlets}function qr(P,O,V,L,q){let me,ve={};L&&Object.entries(L).forEach(([In,Yn])=>{ve[In]=Array.isArray(Yn)?Yn.map(or=>`${or}`):`${Yn}`}),me=P===O?V:Ao(P,O,V);const et=ji(vr(me));return new Er(et,ve,q)}function Ao(P,O,V){const L={};return Object.entries(P.children).forEach(([q,ve])=>{L[q]=ve===O?V:Ao(ve,O,V)}),new fi(P.segments,L)}class Br{constructor(O,V,L){if(this.isAbsolute=O,this.numberOfDoubleDots=V,this.commands=L,O&&L.length>0&&Mo(L[0]))throw new M.vHH(4003,!1);const q=L.find(Uo);if(q&&q!==ar(L))throw new M.vHH(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Hi{constructor(O,V,L){this.segmentGroup=O,this.processChildren=V,this.index=L}}function Qo(P,O,V){if(P||(P=new fi([],{})),0===P.segments.length&&P.hasChildren())return Gt(P,O,V);const L=function so(P,O,V){let L=0,q=O;const ve={match:!1,pathIndex:0,commandIndex:0};for(;q<P.segments.length;){if(L>=V.length)return ve;const me=P.segments[q],et=V[L];if(Uo(et))break;const In=`${et}`,Yn=L<V.length-1?V[L+1]:null;if(q>0&&void 0===In)break;if(In&&Yn&&"object"==typeof Yn&&void 0===Yn.outlets){if(!Co(In,Yn,me))return ve;L+=2}else{if(!Co(In,{},me))return ve;L++}q++}return{match:!0,pathIndex:q,commandIndex:L}}(P,O,V),q=V.slice(L.commandIndex);if(L.match&&L.pathIndex<P.segments.length){const ve=new fi(P.segments.slice(0,L.pathIndex),{});return ve.children[xt]=new fi(P.segments.slice(L.pathIndex),P.children),Gt(ve,0,q)}return L.match&&0===q.length?new fi(P.segments,{}):L.match&&!P.hasChildren()?Rr(P,O,V):L.match?Gt(P,0,q):Rr(P,O,V)}function Gt(P,O,V){if(0===V.length)return new fi(P.segments,{});{const L=function Ni(P){return Uo(P[0])?P[0].outlets:{[xt]:P}}(V),q={};if(!L[xt]&&P.children[xt]&&1===P.numberOfChildren&&0===P.children[xt].segments.length){const ve=Gt(P.children[xt],O,V);return new fi(P.segments,ve.children)}return Object.entries(L).forEach(([ve,me])=>{"string"==typeof me&&(me=[me]),null!==me&&(q[ve]=Qo(P.children[ve],O,me))}),Object.entries(P.children).forEach(([ve,me])=>{void 0===L[ve]&&(q[ve]=me)}),new fi(P.segments,q)}}function Rr(P,O,V){const L=P.segments.slice(0,O);let q=0;for(;q<V.length;){const ve=V[q];if(Uo(ve)){const In=Or(ve.outlets);return new fi(L,In)}if(0===q&&Mo(V[0])){L.push(new Sr(P.segments[O].path,es(V[0]))),q++;continue}const me=Uo(ve)?ve.outlets[xt]:`${ve}`,et=q<V.length-1?V[q+1]:null;me&&et&&Mo(et)?(L.push(new Sr(me,es(et))),q+=2):(L.push(new Sr(me,{})),q++)}return new fi(L,{})}function Or(P){const O={};return Object.entries(P).forEach(([V,L])=>{"string"==typeof L&&(L=[L]),null!==L&&(O[V]=Rr(new fi([],{}),0,L))}),O}function es(P){const O={};return Object.entries(P).forEach(([V,L])=>O[V]=`${L}`),O}function Co(P,O,V){return P==V.path&&ti(O,V.parameters)}const os="imperative";class Yr{constructor(O,V){this.id=O,this.url=V}}class Lo extends Yr{constructor(O,V,L="imperative",q=null){super(O,V),this.type=0,this.navigationTrigger=L,this.restoredState=q}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Un extends Yr{constructor(O,V,L){super(O,V),this.urlAfterRedirects=L,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Pi extends Yr{constructor(O,V,L,q){super(O,V),this.reason=L,this.code=q,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class se extends Yr{constructor(O,V,L,q){super(O,V),this.reason=L,this.code=q,this.type=16}}class Oe extends Yr{constructor(O,V,L,q){super(O,V),this.error=L,this.target=q,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class ge extends Yr{constructor(O,V,L,q){super(O,V),this.urlAfterRedirects=L,this.state=q,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Te extends Yr{constructor(O,V,L,q){super(O,V),this.urlAfterRedirects=L,this.state=q,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class vt extends Yr{constructor(O,V,L,q,ve){super(O,V),this.urlAfterRedirects=L,this.state=q,this.shouldActivate=ve,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Mt extends Yr{constructor(O,V,L,q){super(O,V),this.urlAfterRedirects=L,this.state=q,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class sn extends Yr{constructor(O,V,L,q){super(O,V),this.urlAfterRedirects=L,this.state=q,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class mn{constructor(O){this.route=O,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class an{constructor(O){this.route=O,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Tn{constructor(O){this.snapshot=O,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ii{constructor(O){this.snapshot=O,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class vi{constructor(O){this.snapshot=O,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Fi{constructor(O){this.snapshot=O,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class br{constructor(O,V,L){this.routerEvent=O,this.position=V,this.anchor=L,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class mo{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new To,this.attachRef=null}}let To=(()=>{var P;class O{constructor(){this.contexts=new Map}onChildOutletCreated(L,q){const ve=this.getOrCreateContext(L);ve.outlet=q,this.contexts.set(L,ve)}onChildOutletDestroyed(L){const q=this.getContext(L);q&&(q.outlet=null,q.attachRef=null)}onOutletDeactivated(){const L=this.contexts;return this.contexts=new Map,L}onOutletReAttached(L){this.contexts=L}getOrCreateContext(L){let q=this.getContext(L);return q||(q=new mo,this.contexts.set(L,q)),q}getContext(L){return this.contexts.get(L)||null}}return(P=O).\u0275fac=function(L){return new(L||P)},P.\u0275prov=M.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),O})();class go{constructor(O){this._root=O}get root(){return this._root.value}parent(O){const V=this.pathFromRoot(O);return V.length>1?V[V.length-2]:null}children(O){const V=ao(O,this._root);return V?V.children.map(L=>L.value):[]}firstChild(O){const V=ao(O,this._root);return V&&V.children.length>0?V.children[0].value:null}siblings(O){const V=Po(O,this._root);return V.length<2?[]:V[V.length-2].children.map(q=>q.value).filter(q=>q!==O)}pathFromRoot(O){return Po(O,this._root).map(V=>V.value)}}function ao(P,O){if(P===O.value)return O;for(const V of O.children){const L=ao(P,V);if(L)return L}return null}function Po(P,O){if(P===O.value)return[O];for(const V of O.children){const L=Po(P,V);if(L.length)return L.unshift(O),L}return[]}class cr{constructor(O,V){this.value=O,this.children=V}toString(){return`TreeNode(${this.value})`}}function Ls(P){const O={};return P&&P.children.forEach(V=>O[V.value.outlet]=V),O}class Ys extends go{constructor(O,V){super(O),this.snapshot=V,hs(this,O)}toString(){return this.snapshot.toString()}}function Ii(P,O){const V=function Cr(P,O){const me=new Rs([],{},{},"",{},xt,O,null,{});return new na("",new cr(me,[]))}(0,O),L=new Ke.X([new Sr("",{})]),q=new Ke.X({}),ve=new Ke.X({}),me=new Ke.X({}),et=new Ke.X(""),In=new lo(L,q,me,et,ve,xt,O,V.root);return In.snapshot=V.root,new Ys(new cr(In,[]),V)}class lo{constructor(O,V,L,q,ve,me,et,In){this.urlSubject=O,this.paramsSubject=V,this.queryParamsSubject=L,this.fragmentSubject=q,this.dataSubject=ve,this.outlet=me,this.component=et,this._futureSnapshot=In,this.title=this.dataSubject?.pipe((0,$t.U)(Yn=>Yn[St]))??(0,ht.of)(void 0),this.url=O,this.params=V,this.queryParams=L,this.fragment=q,this.data=ve}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,$t.U)(O=>Hn(O)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,$t.U)(O=>Hn(O)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function ds(P,O="emptyOnly"){const V=P.pathFromRoot;let L=0;if("always"!==O)for(L=V.length-1;L>=1;){const q=V[L],ve=V[L-1];if(q.routeConfig&&""===q.routeConfig.path)L--;else{if(ve.component)break;L--}}return function ur(P){return P.reduce((O,V)=>({params:{...O.params,...V.params},data:{...O.data,...V.data},resolve:{...V.data,...O.resolve,...V.routeConfig?.data,...V._resolvedData}}),{params:{},data:{},resolve:{}})}(V.slice(L))}class Rs{get title(){return this.data?.[St]}constructor(O,V,L,q,ve,me,et,In,Yn){this.url=O,this.params=V,this.queryParams=L,this.fragment=q,this.data=ve,this.outlet=me,this.component=et,this.routeConfig=In,this._resolve=Yn}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Hn(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Hn(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(L=>L.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class na extends go{constructor(O,V){super(V),this.url=O,hs(this,V)}toString(){return co(this._root)}}function hs(P,O){O.value._routerState=P,O.children.forEach(V=>hs(P,V))}function co(P){const O=P.children.length>0?` { ${P.children.map(co).join(", ")} } `:"";return`${P.value}${O}`}function ia(P){if(P.snapshot){const O=P.snapshot,V=P._futureSnapshot;P.snapshot=V,ti(O.queryParams,V.queryParams)||P.queryParamsSubject.next(V.queryParams),O.fragment!==V.fragment&&P.fragmentSubject.next(V.fragment),ti(O.params,V.params)||P.paramsSubject.next(V.params),function qn(P,O){if(P.length!==O.length)return!1;for(let V=0;V<P.length;++V)if(!ti(P[V],O[V]))return!1;return!0}(O.url,V.url)||P.urlSubject.next(V.url),ti(O.data,V.data)||P.dataSubject.next(V.data)}else P.snapshot=P._futureSnapshot,P.dataSubject.next(P._futureSnapshot.data)}function Ir(P,O){const V=ti(P.params,O.params)&&function gr(P,O){return ir(P,O)&&P.every((V,L)=>ti(V.parameters,O[L].parameters))}(P.url,O.url);return V&&!(!P.parent!=!O.parent)&&(!P.parent||Ir(P.parent,O.parent))}let Kn=(()=>{var P;class O{constructor(){this.activated=null,this._activatedRoute=null,this.name=xt,this.activateEvents=new M.vpe,this.deactivateEvents=new M.vpe,this.attachEvents=new M.vpe,this.detachEvents=new M.vpe,this.parentContexts=(0,M.f3M)(To),this.location=(0,M.f3M)(M.s_b),this.changeDetector=(0,M.f3M)(M.sBO),this.environmentInjector=(0,M.f3M)(M.lqb),this.inputBinder=(0,M.f3M)(Tr,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(L){if(L.name){const{firstChange:q,previousValue:ve}=L.name;if(q)return;this.isTrackedInParentContexts(ve)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(ve)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(L){return this.parentContexts.getContext(L)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const L=this.parentContexts.getContext(this.name);L?.route&&(L.attachRef?this.attach(L.attachRef,L.route):this.activateWith(L.route,L.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new M.vHH(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new M.vHH(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new M.vHH(4012,!1);this.location.detach();const L=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(L.instance),L}attach(L,q){this.activated=L,this._activatedRoute=q,this.location.insert(L.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(L.instance)}deactivate(){if(this.activated){const L=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(L)}}activateWith(L,q){if(this.isActivated)throw new M.vHH(4013,!1);this._activatedRoute=L;const ve=this.location,et=L.snapshot.component,In=this.parentContexts.getOrCreateContext(this.name).children,Yn=new Ti(L,In,ve.injector);this.activated=ve.createComponent(et,{index:ve.length,injector:Yn,environmentInjector:q??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}}return(P=O).\u0275fac=function(L){return new(L||P)},P.\u0275dir=M.lG2({type:P,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[M.TTD]}),O})();class Ti{constructor(O,V,L){this.route=O,this.childContexts=V,this.parent=L}get(O,V){return O===lo?this.route:O===To?this.childContexts:this.parent.get(O,V)}}const Tr=new M.OlP("");let ts=(()=>{var P;class O{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(L){this.unsubscribeFromRouteData(L),this.subscribeToRouteData(L)}unsubscribeFromRouteData(L){this.outletDataSubscriptions.get(L)?.unsubscribe(),this.outletDataSubscriptions.delete(L)}subscribeToRouteData(L){const{activatedRoute:q}=L,ve=(0,pt.a)([q.queryParams,q.params,q.data]).pipe((0,un.w)(([me,et,In],Yn)=>(In={...me,...et,...In},0===Yn?(0,ht.of)(In):Promise.resolve(In)))).subscribe(me=>{if(!L.isActivated||!L.activatedComponentRef||L.activatedRoute!==q||null===q.component)return void this.unsubscribeFromRouteData(L);const et=(0,M.qFp)(q.component);if(et)for(const{templateName:In}of et.inputs)L.activatedComponentRef.setInput(In,me[In]);else this.unsubscribeFromRouteData(L)});this.outletDataSubscriptions.set(L,ve)}}return(P=O).\u0275fac=function(L){return new(L||P)},P.\u0275prov=M.Yz7({token:P,factory:P.\u0275fac}),O})();function zr(P,O,V){if(V&&P.shouldReuseRoute(O.value,V.value.snapshot)){const L=V.value;L._futureSnapshot=O.value;const q=function zo(P,O,V){return O.children.map(L=>{for(const q of V.children)if(P.shouldReuseRoute(L.value,q.value.snapshot))return zr(P,L,q);return zr(P,L)})}(P,O,V);return new cr(L,q)}{if(P.shouldAttach(O.value)){const ve=P.retrieve(O.value);if(null!==ve){const me=ve.route;return me.value._futureSnapshot=O.value,me.children=O.children.map(et=>zr(P,et)),me}}const L=function Xr(P){return new lo(new Ke.X(P.url),new Ke.X(P.params),new Ke.X(P.queryParams),new Ke.X(P.fragment),new Ke.X(P.data),P.outlet,P.component,P)}(O.value),q=O.children.map(ve=>zr(P,ve));return new cr(L,q)}}const _o="ngNavigationCancelingError";function So(P,O){const{redirectTo:V,navigationBehaviorOptions:L}=no(O)?{redirectTo:O,navigationBehaviorOptions:void 0}:O,q=xi(!1,0,O);return q.url=V,q.navigationBehaviorOptions=L,q}function xi(P,O,V){const L=new Error("NavigationCancelingError: "+(P||""));return L[_o]=!0,L.cancellationCode=O,V&&(L.url=V),L}function Fo(P){return Fs(P)&&no(P.url)}function Fs(P){return P&&P[_o]}let ss=(()=>{var P;class O{}return(P=O).\u0275fac=function(L){return new(L||P)},P.\u0275cmp=M.Xpm({type:P,selectors:[["ng-component"]],standalone:!0,features:[M.jDz],decls:1,vars:0,template:function(L,q){1&L&&M._UZ(0,"router-outlet")},dependencies:[Kn],encapsulation:2}),O})();function oa(P){const O=P.children&&P.children.map(oa),V=O?{...P,children:O}:{...P};return!V.component&&!V.loadComponent&&(O||V.loadChildren)&&V.outlet&&V.outlet!==xt&&(V.component=ss),V}function _i(P){return P.outlet||xt}function Ns(P){if(!P)return null;if(P.routeConfig?._injector)return P.routeConfig._injector;for(let O=P.parent;O;O=O.parent){const V=O.routeConfig;if(V?._loadedInjector)return V._loadedInjector;if(V?._injector)return V._injector}return null}class aa{constructor(O,V,L,q,ve){this.routeReuseStrategy=O,this.futureState=V,this.currState=L,this.forwardEvent=q,this.inputBindingEnabled=ve}activate(O){const V=this.futureState._root,L=this.currState?this.currState._root:null;this.deactivateChildRoutes(V,L,O),ia(this.futureState.root),this.activateChildRoutes(V,L,O)}deactivateChildRoutes(O,V,L){const q=Ls(V);O.children.forEach(ve=>{const me=ve.value.outlet;this.deactivateRoutes(ve,q[me],L),delete q[me]}),Object.values(q).forEach(ve=>{this.deactivateRouteAndItsChildren(ve,L)})}deactivateRoutes(O,V,L){const q=O.value,ve=V?V.value:null;if(q===ve)if(q.component){const me=L.getContext(q.outlet);me&&this.deactivateChildRoutes(O,V,me.children)}else this.deactivateChildRoutes(O,V,L);else ve&&this.deactivateRouteAndItsChildren(V,L)}deactivateRouteAndItsChildren(O,V){O.value.component&&this.routeReuseStrategy.shouldDetach(O.value.snapshot)?this.detachAndStoreRouteSubtree(O,V):this.deactivateRouteAndOutlet(O,V)}detachAndStoreRouteSubtree(O,V){const L=V.getContext(O.value.outlet),q=L&&O.value.component?L.children:V,ve=Ls(O);for(const me of Object.keys(ve))this.deactivateRouteAndItsChildren(ve[me],q);if(L&&L.outlet){const me=L.outlet.detach(),et=L.children.onOutletDeactivated();this.routeReuseStrategy.store(O.value.snapshot,{componentRef:me,route:O,contexts:et})}}deactivateRouteAndOutlet(O,V){const L=V.getContext(O.value.outlet),q=L&&O.value.component?L.children:V,ve=Ls(O);for(const me of Object.keys(ve))this.deactivateRouteAndItsChildren(ve[me],q);L&&(L.outlet&&(L.outlet.deactivate(),L.children.onOutletDeactivated()),L.attachRef=null,L.route=null)}activateChildRoutes(O,V,L){const q=Ls(V);O.children.forEach(ve=>{this.activateRoutes(ve,q[ve.value.outlet],L),this.forwardEvent(new Fi(ve.value.snapshot))}),O.children.length&&this.forwardEvent(new ii(O.value.snapshot))}activateRoutes(O,V,L){const q=O.value,ve=V?V.value:null;if(ia(q),q===ve)if(q.component){const me=L.getOrCreateContext(q.outlet);this.activateChildRoutes(O,V,me.children)}else this.activateChildRoutes(O,V,L);else if(q.component){const me=L.getOrCreateContext(q.outlet);if(this.routeReuseStrategy.shouldAttach(q.snapshot)){const et=this.routeReuseStrategy.retrieve(q.snapshot);this.routeReuseStrategy.store(q.snapshot,null),me.children.onOutletReAttached(et.contexts),me.attachRef=et.componentRef,me.route=et.route.value,me.outlet&&me.outlet.attach(et.componentRef,et.route.value),ia(et.route.value),this.activateChildRoutes(O,null,me.children)}else{const et=Ns(q.snapshot);me.attachRef=null,me.route=q,me.injector=et,me.outlet&&me.outlet.activateWith(q,me.injector),this.activateChildRoutes(O,null,me.children)}}else this.activateChildRoutes(O,null,L)}}class Go{constructor(O){this.path=O,this.route=this.path[this.path.length-1]}}class $o{constructor(O,V){this.component=O,this.route=V}}function yo(P,O,V){const L=P._root;return Bo(L,O?O._root:null,V,[L.value])}function jr(P,O){const V=Symbol(),L=O.get(P,V);return L===V?"function"!=typeof P||(0,M.Z0I)(P)?O.get(P):P:L}function Bo(P,O,V,L,q={canDeactivateChecks:[],canActivateChecks:[]}){const ve=Ls(O);return P.children.forEach(me=>{(function Ea(P,O,V,L,q={canDeactivateChecks:[],canActivateChecks:[]}){const ve=P.value,me=O?O.value:null,et=V?V.getContext(P.value.outlet):null;if(me&&ve.routeConfig===me.routeConfig){const In=function zs(P,O,V){if("function"==typeof V)return V(P,O);switch(V){case"pathParamsChange":return!ir(P.url,O.url);case"pathParamsOrQueryParamsChange":return!ir(P.url,O.url)||!ti(P.queryParams,O.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Ir(P,O)||!ti(P.queryParams,O.queryParams);default:return!Ir(P,O)}}(me,ve,ve.routeConfig.runGuardsAndResolvers);In?q.canActivateChecks.push(new Go(L)):(ve.data=me.data,ve._resolvedData=me._resolvedData),Bo(P,O,ve.component?et?et.children:null:V,L,q),In&&et&&et.outlet&&et.outlet.isActivated&&q.canDeactivateChecks.push(new $o(et.outlet.component,me))}else me&&ms(O,et,q),q.canActivateChecks.push(new Go(L)),Bo(P,null,ve.component?et?et.children:null:V,L,q)})(me,ve[me.value.outlet],V,L.concat([me.value]),q),delete ve[me.value.outlet]}),Object.entries(ve).forEach(([me,et])=>ms(et,V.getContext(me),q)),q}function ms(P,O,V){const L=Ls(P),q=P.value;Object.entries(L).forEach(([ve,me])=>{ms(me,q.component?O?O.children.getContext(ve):null:O,V)}),V.canDeactivateChecks.push(new $o(q.component&&O&&O.outlet&&O.outlet.isActivated?O.outlet.component:null,q))}function T(P){return"function"==typeof P}function vo(P){return P instanceof Dt||"EmptyError"===P?.name}const ee=Symbol("INITIAL_VALUE");function Z(){return(0,un.w)(P=>(0,pt.a)(P.map(O=>O.pipe((0,De.q)(1),(0,dt.O)(ee)))).pipe((0,$t.U)(O=>{for(const V of O)if(!0!==V){if(V===ee)return ee;if(!1===V||V instanceof Er)return V}return!0}),(0,Lt.h)(O=>O!==ee),(0,De.q)(1)))}function ya(P){return(0,mt.z)((0,tn.b)(O=>{if(no(O))throw So(0,O)}),(0,$t.U)(O=>!0===O))}class gs{constructor(O){this.segmentGroup=O||null}}class ha{constructor(O){this.urlTree=O}}function ce(P){return Qe(new gs(P))}function I(P){return Qe(new ha(P))}class ue{constructor(O,V){this.urlSerializer=O,this.urlTree=V}noMatchError(O){return new M.vHH(4002,!1)}lineralizeSegments(O,V){let L=[],q=V.root;for(;;){if(L=L.concat(q.segments),0===q.numberOfChildren)return(0,ht.of)(L);if(q.numberOfChildren>1||!q.children[xt])return Qe(new M.vHH(4e3,!1));q=q.children[xt]}}applyRedirectCommands(O,V,L){return this.applyRedirectCreateUrlTree(V,this.urlSerializer.parse(V),O,L)}applyRedirectCreateUrlTree(O,V,L,q){const ve=this.createSegmentGroup(O,V.root,L,q);return new Er(ve,this.createQueryParams(V.queryParams,this.urlTree.queryParams),V.fragment)}createQueryParams(O,V){const L={};return Object.entries(O).forEach(([q,ve])=>{if("string"==typeof ve&&ve.startsWith(":")){const et=ve.substring(1);L[q]=V[et]}else L[q]=ve}),L}createSegmentGroup(O,V,L,q){const ve=this.createSegments(O,V.segments,L,q);let me={};return Object.entries(V.children).forEach(([et,In])=>{me[et]=this.createSegmentGroup(O,In,L,q)}),new fi(ve,me)}createSegments(O,V,L,q){return V.map(ve=>ve.path.startsWith(":")?this.findPosParam(O,ve,q):this.findOrReturn(ve,L))}findPosParam(O,V,L){const q=L[V.path.substring(1)];if(!q)throw new M.vHH(4001,!1);return q}findOrReturn(O,V){let L=0;for(const q of V){if(q.path===O.path)return V.splice(L),q;L++}return O}}const Se={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function nt(P,O,V,L,q){const ve=gt(P,O,V);return ve.matched?(L=function kr(P,O){return P.providers&&!P._injector&&(P._injector=(0,M.MMx)(P.providers,O,`Route: ${P.path}`)),P._injector??O}(O,L),function $a(P,O,V,L){const q=O.canMatch;if(!q||0===q.length)return(0,ht.of)(!0);const ve=q.map(me=>{const et=jr(me,P);return yn(function ai(P){return P&&T(P.canMatch)}(et)?et.canMatch(O,V):P.runInContext(()=>et(O,V)))});return(0,ht.of)(ve).pipe(Z(),ya())}(L,O,V).pipe((0,$t.U)(me=>!0===me?ve:{...Se}))):(0,ht.of)(ve)}function gt(P,O,V){if(""===O.path)return"full"===O.pathMatch&&(P.hasChildren()||V.length>0)?{...Se}:{matched:!0,consumedSegments:[],remainingSegments:V,parameters:{},positionalParamSegments:{}};const q=(O.matcher||yi)(V,P,O);if(!q)return{...Se};const ve={};Object.entries(q.posParams??{}).forEach(([et,In])=>{ve[et]=In.path});const me=q.consumed.length>0?{...ve,...q.consumed[q.consumed.length-1].parameters}:ve;return{matched:!0,consumedSegments:q.consumed,remainingSegments:V.slice(q.consumed.length),parameters:me,positionalParamSegments:q.posParams??{}}}function Zt(P,O,V,L){return V.length>0&&function Wn(P,O,V){return V.some(L=>Yi(P,O,L)&&_i(L)!==xt)}(P,V,L)?{segmentGroup:new fi(O,gi(L,new fi(V,P.children))),slicedSegments:[]}:0===V.length&&function mr(P,O,V){return V.some(L=>Yi(P,O,L))}(P,V,L)?{segmentGroup:new fi(P.segments,fn(P,0,V,L,P.children)),slicedSegments:V}:{segmentGroup:new fi(P.segments,P.children),slicedSegments:V}}function fn(P,O,V,L,q){const ve={};for(const me of L)if(Yi(P,V,me)&&!q[_i(me)]){const et=new fi([],{});ve[_i(me)]=et}return{...q,...ve}}function gi(P,O){const V={};V[xt]=O;for(const L of P)if(""===L.path&&_i(L)!==xt){const q=new fi([],{});V[_i(L)]=q}return V}function Yi(P,O,V){return(!(P.hasChildren()||O.length>0)||"full"!==V.pathMatch)&&""===V.path}class xo{constructor(O,V,L,q,ve,me,et){this.injector=O,this.configLoader=V,this.rootComponentType=L,this.config=q,this.urlTree=ve,this.paramsInheritanceStrategy=me,this.urlSerializer=et,this.allowRedirects=!0,this.applyRedirects=new ue(this.urlSerializer,this.urlTree)}noMatchError(O){return new M.vHH(4002,!1)}recognize(){const O=Zt(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,O,xt).pipe(Ne(V=>{if(V instanceof ha)return this.allowRedirects=!1,this.urlTree=V.urlTree,this.match(V.urlTree);throw V instanceof gs?this.noMatchError(V):V}),(0,$t.U)(V=>{const L=new Rs([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},xt,this.rootComponentType,null,{}),q=new cr(L,V),ve=new na("",q),me=function Gr(P,O,V=null,L=null){return qi(Wr(P),O,V,L)}(L,[],this.urlTree.queryParams,this.urlTree.fragment);return me.queryParams=this.urlTree.queryParams,ve.url=this.urlSerializer.serialize(me),this.inheritParamsAndData(ve._root),{state:ve,tree:me}}))}match(O){return this.processSegmentGroup(this.injector,this.config,O.root,xt).pipe(Ne(L=>{throw L instanceof gs?this.noMatchError(L):L}))}inheritParamsAndData(O){const V=O.value,L=ds(V,this.paramsInheritanceStrategy);V.params=Object.freeze(L.params),V.data=Object.freeze(L.data),O.children.forEach(q=>this.inheritParamsAndData(q))}processSegmentGroup(O,V,L,q){return 0===L.segments.length&&L.hasChildren()?this.processChildren(O,V,L):this.processSegment(O,V,L,L.segments,q,!0)}processChildren(O,V,L){const q=[];for(const ve of Object.keys(L.children))"primary"===ve?q.unshift(ve):q.push(ve);return(0,Me.D)(q).pipe(li(ve=>{const me=L.children[ve],et=function sa(P,O){const V=P.filter(L=>_i(L)===O);return V.push(...P.filter(L=>_i(L)!==O)),V}(V,ve);return this.processSegmentGroup(O,et,me,ve)}),function At(P,O){return(0,Ct.e)(function at(P,O,V,L,q){return(ve,me)=>{let et=V,In=O,Yn=0;ve.subscribe((0,it.x)(me,or=>{const ui=Yn++;In=et?P(In,or,ui):(et=!0,or),L&&me.next(In)},q&&(()=>{et&&me.next(In),me.complete()})))}}(P,O,arguments.length>=2,!0))}((ve,me)=>(ve.push(...me),ve)),pn(null),function on(P,O){const V=arguments.length>=2;return L=>L.pipe(P?(0,Lt.h)((q,ve)=>P(q,ve,L)):Jn.y,en(1),V?pn(O):hn(()=>new Dt))}(),(0,ft.z)(ve=>{if(null===ve)return ce(L);const me=Wo(ve);return function as(P){P.sort((O,V)=>O.value.outlet===xt?-1:V.value.outlet===xt?1:O.value.outlet.localeCompare(V.value.outlet))}(me),(0,ht.of)(me)}))}processSegment(O,V,L,q,ve,me){return(0,Me.D)(V).pipe(li(et=>this.processSegmentAgainstRoute(et._injector??O,V,et,L,q,ve,me).pipe(Ne(In=>{if(In instanceof gs)return(0,ht.of)(null);throw In}))),Ht(et=>!!et),Ne(et=>{if(vo(et))return function Vi(P,O,V){return 0===O.length&&!P.children[V]}(L,q,ve)?(0,ht.of)([]):ce(L);throw et}))}processSegmentAgainstRoute(O,V,L,q,ve,me,et){return function Oi(P,O,V,L){return!!(_i(P)===L||L!==xt&&Yi(O,V,P))&&("**"===P.path||gt(O,P,V).matched)}(L,q,ve,me)?void 0===L.redirectTo?this.matchSegmentAgainstRoute(O,q,L,ve,me,et):et&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(O,q,V,L,ve,me):ce(q):ce(q)}expandSegmentAgainstRouteUsingRedirect(O,V,L,q,ve,me){return"**"===q.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(O,L,q,me):this.expandRegularSegmentAgainstRouteUsingRedirect(O,V,L,q,ve,me)}expandWildCardWithParamsAgainstRouteUsingRedirect(O,V,L,q){const ve=this.applyRedirects.applyRedirectCommands([],L.redirectTo,{});return L.redirectTo.startsWith("/")?I(ve):this.applyRedirects.lineralizeSegments(L,ve).pipe((0,ft.z)(me=>{const et=new fi(me,{});return this.processSegment(O,V,et,me,q,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(O,V,L,q,ve,me){const{matched:et,consumedSegments:In,remainingSegments:Yn,positionalParamSegments:or}=gt(V,q,ve);if(!et)return ce(V);const ui=this.applyRedirects.applyRedirectCommands(In,q.redirectTo,or);return q.redirectTo.startsWith("/")?I(ui):this.applyRedirects.lineralizeSegments(q,ui).pipe((0,ft.z)(Xo=>this.processSegment(O,L,V,Xo.concat(Yn),me,!1)))}matchSegmentAgainstRoute(O,V,L,q,ve,me){let et;if("**"===L.path){const In=q.length>0?ar(q).parameters:{},Yn=new Rs(q,In,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,$s(L),_i(L),L.component??L._loadedComponent??null,L,_s(L));et=(0,ht.of)({snapshot:Yn,consumedSegments:[],remainingSegments:[]}),V.children={}}else et=nt(V,L,q,O).pipe((0,$t.U)(({matched:In,consumedSegments:Yn,remainingSegments:or,parameters:ui})=>In?{snapshot:new Rs(Yn,ui,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,$s(L),_i(L),L.component??L._loadedComponent??null,L,_s(L)),consumedSegments:Yn,remainingSegments:or}:null));return et.pipe((0,un.w)(In=>null===In?ce(V):this.getChildConfig(O=L._injector??O,L,q).pipe((0,un.w)(({routes:Yn})=>{const or=L._loadedInjector??O,{snapshot:ui,consumedSegments:Xo,remainingSegments:Ha}=In,{segmentGroup:$l,slicedSegments:Il}=Zt(V,Xo,Ha,Yn);if(0===Il.length&&$l.hasChildren())return this.processChildren(or,Yn,$l).pipe((0,$t.U)(Qa=>null===Qa?null:[new cr(ui,Qa)]));if(0===Yn.length&&0===Il.length)return(0,ht.of)([new cr(ui,[])]);const Vl=_i(L)===ve;return this.processSegment(or,Yn,$l,Il,Vl?xt:ve,!0).pipe((0,$t.U)(Qa=>[new cr(ui,Qa)]))}))))}getChildConfig(O,V,L){return V.children?(0,ht.of)({routes:V.children,injector:O}):V.loadChildren?void 0!==V._loadedRoutes?(0,ht.of)({routes:V._loadedRoutes,injector:V._loadedInjector}):function Zs(P,O,V,L){const q=O.canLoad;if(void 0===q||0===q.length)return(0,ht.of)(!0);const ve=q.map(me=>{const et=jr(me,P);return yn(function S(P){return P&&T(P.canLoad)}(et)?et.canLoad(O,V):P.runInContext(()=>et(O,V)))});return(0,ht.of)(ve).pipe(Z(),ya())}(O,V,L).pipe((0,ft.z)(q=>q?this.configLoader.loadChildren(O,V).pipe((0,tn.b)(ve=>{V._loadedRoutes=ve.routes,V._loadedInjector=ve.injector})):function W(P){return Qe(xi(!1,3))}())):(0,ht.of)({routes:[],injector:O})}}function Ds(P){const O=P.value.routeConfig;return O&&""===O.path}function Wo(P){const O=[],V=new Set;for(const L of P){if(!Ds(L)){O.push(L);continue}const q=O.find(ve=>L.value.routeConfig===ve.value.routeConfig);void 0!==q?(q.children.push(...L.children),V.add(q)):O.push(L)}for(const L of V){const q=Wo(L.children);O.push(new cr(L.value,q))}return O.filter(L=>!V.has(L))}function $s(P){return P.data||{}}function _s(P){return P.resolve||{}}function F(P){return"string"==typeof P.title||null===P.title}function X(P){return(0,un.w)(O=>{const V=P(O);return V?(0,Me.D)(V).pipe((0,$t.U)(()=>O)):(0,ht.of)(O)})}const ye=new M.OlP("ROUTES");let j=(()=>{var P;class O{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,M.f3M)(M.Sil)}loadComponent(L){if(this.componentLoaders.get(L))return this.componentLoaders.get(L);if(L._loadedComponent)return(0,ht.of)(L._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(L);const q=yn(L.loadComponent()).pipe((0,$t.U)(Xe),(0,tn.b)(me=>{this.onLoadEndListener&&this.onLoadEndListener(L),L._loadedComponent=me}),ri(()=>{this.componentLoaders.delete(L)})),ve=new Tt(q,()=>new Ze.x).pipe(Kt());return this.componentLoaders.set(L,ve),ve}loadChildren(L,q){if(this.childrenLoaders.get(q))return this.childrenLoaders.get(q);if(q._loadedRoutes)return(0,ht.of)({routes:q._loadedRoutes,injector:q._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(q);const me=this.loadModuleFactoryOrRoutes(q.loadChildren).pipe((0,$t.U)(In=>{this.onLoadEndListener&&this.onLoadEndListener(q);let Yn,or;return Array.isArray(In)?or=In:(Yn=In.create(L).injector,or=Yn.get(ye,[],M.XFs.Self|M.XFs.Optional).flat()),{routes:or.map(oa),injector:Yn}}),ri(()=>{this.childrenLoaders.delete(q)})),et=new Tt(me,()=>new Ze.x).pipe(Kt());return this.childrenLoaders.set(q,et),et}loadModuleFactoryOrRoutes(L){return yn(L()).pipe((0,$t.U)(Xe),(0,ft.z)(q=>q instanceof M.YKP||Array.isArray(q)?(0,ht.of)(q):(0,Me.D)(this.compiler.compileModuleAsync(q))))}}return(P=O).\u0275fac=function(L){return new(L||P)},P.\u0275prov=M.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),O})();function Xe(P){return function fe(P){return P&&"object"==typeof P&&"default"in P}(P)?P.default:P}let rn=(()=>{var P;class O{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new Ze.x,this.configLoader=(0,M.f3M)(j),this.environmentInjector=(0,M.f3M)(M.lqb),this.urlSerializer=(0,M.f3M)(No),this.rootContexts=(0,M.f3M)(To),this.inputBindingEnabled=null!==(0,M.f3M)(Tr,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>(0,ht.of)(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=ve=>this.events.next(new an(ve)),this.configLoader.onLoadStartListener=ve=>this.events.next(new mn(ve))}complete(){this.transitions?.complete()}handleNavigationRequest(L){const q=++this.navigationId;this.transitions?.next({...this.transitions.value,...L,id:q})}setupNavigations(L){return this.transitions=new Ke.X({id:0,currentUrlTree:L.currentUrlTree,currentRawUrl:L.currentUrlTree,extractedUrl:L.urlHandlingStrategy.extract(L.currentUrlTree),urlAfterRedirects:L.urlHandlingStrategy.extract(L.currentUrlTree),rawUrl:L.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:os,restoredState:null,currentSnapshot:L.routerState.snapshot,targetSnapshot:null,currentRouterState:L.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,Lt.h)(q=>0!==q.id),(0,$t.U)(q=>({...q,extractedUrl:L.urlHandlingStrategy.extract(q.rawUrl)})),(0,un.w)(q=>{let ve=!1,me=!1;return(0,ht.of)(q).pipe((0,tn.b)(et=>{this.currentNavigation={id:et.id,initialUrl:et.rawUrl,extractedUrl:et.extractedUrl,trigger:et.source,extras:et.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,un.w)(et=>{const In=L.browserUrlTree.toString(),Yn=!L.navigated||et.extractedUrl.toString()!==In||In!==L.currentUrlTree.toString();if(!Yn&&"reload"!==(et.extras.onSameUrlNavigation??L.onSameUrlNavigation)){const ui="";return this.events.next(new se(et.id,L.serializeUrl(q.rawUrl),ui,0)),L.rawUrlTree=et.rawUrl,et.resolve(null),_t.E}if(L.urlHandlingStrategy.shouldProcessUrl(et.rawUrl))return _n(et.source)&&(L.browserUrlTree=et.extractedUrl),(0,ht.of)(et).pipe((0,un.w)(ui=>{const Xo=this.transitions?.getValue();return this.events.next(new Lo(ui.id,this.urlSerializer.serialize(ui.extractedUrl),ui.source,ui.restoredState)),Xo!==this.transitions?.getValue()?_t.E:Promise.resolve(ui)}),function fa(P,O,V,L,q,ve){return(0,ft.z)(me=>function Kr(P,O,V,L,q,ve,me="emptyOnly"){return new xo(P,O,V,L,q,me,ve).recognize()}(P,O,V,L,me.extractedUrl,q,ve).pipe((0,$t.U)(({state:et,tree:In})=>({...me,targetSnapshot:et,urlAfterRedirects:In}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,L.config,this.urlSerializer,L.paramsInheritanceStrategy),(0,tn.b)(ui=>{if(q.targetSnapshot=ui.targetSnapshot,q.urlAfterRedirects=ui.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:ui.urlAfterRedirects},"eager"===L.urlUpdateStrategy){if(!ui.extras.skipLocationChange){const Ha=L.urlHandlingStrategy.merge(ui.urlAfterRedirects,ui.rawUrl);L.setBrowserUrl(Ha,ui)}L.browserUrlTree=ui.urlAfterRedirects}const Xo=new ge(ui.id,this.urlSerializer.serialize(ui.extractedUrl),this.urlSerializer.serialize(ui.urlAfterRedirects),ui.targetSnapshot);this.events.next(Xo)}));if(Yn&&L.urlHandlingStrategy.shouldProcessUrl(L.rawUrlTree)){const{id:ui,extractedUrl:Xo,source:Ha,restoredState:$l,extras:Il}=et,Vl=new Lo(ui,this.urlSerializer.serialize(Xo),Ha,$l);this.events.next(Vl);const Qa=Ii(0,this.rootComponentType).snapshot;return q={...et,targetSnapshot:Qa,urlAfterRedirects:Xo,extras:{...Il,skipLocationChange:!1,replaceUrl:!1}},(0,ht.of)(q)}{const ui="";return this.events.next(new se(et.id,L.serializeUrl(q.extractedUrl),ui,1)),L.rawUrlTree=et.rawUrl,et.resolve(null),_t.E}}),(0,tn.b)(et=>{const In=new Te(et.id,this.urlSerializer.serialize(et.extractedUrl),this.urlSerializer.serialize(et.urlAfterRedirects),et.targetSnapshot);this.events.next(In)}),(0,$t.U)(et=>q={...et,guards:yo(et.targetSnapshot,et.currentSnapshot,this.rootContexts)}),function xe(P,O){return(0,ft.z)(V=>{const{targetSnapshot:L,currentSnapshot:q,guards:{canActivateChecks:ve,canDeactivateChecks:me}}=V;return 0===me.length&&0===ve.length?(0,ht.of)({...V,guardsResult:!0}):function te(P,O,V,L){return(0,Me.D)(P).pipe((0,ft.z)(q=>function Es(P,O,V,L,q){const ve=O&&O.routeConfig?O.routeConfig.canDeactivate:null;if(!ve||0===ve.length)return(0,ht.of)(!0);const me=ve.map(et=>{const In=Ns(O)??q,Yn=jr(et,In);return yn(function wn(P){return P&&T(P.canDeactivate)}(Yn)?Yn.canDeactivate(P,O,V,L):In.runInContext(()=>Yn(P,O,V,L))).pipe(Ht())});return(0,ht.of)(me).pipe(Z())}(q.component,q.route,V,O,L)),Ht(q=>!0!==q,!0))}(me,L,q,P).pipe((0,ft.z)(et=>et&&function K(P){return"boolean"==typeof P}(et)?function Be(P,O,V,L){return(0,Me.D)(O).pipe(li(q=>(0,st.z)(function zi(P,O){return null!==P&&O&&O(new Tn(P)),(0,ht.of)(!0)}(q.route.parent,L),function zn(P,O){return null!==P&&O&&O(new vi(P)),(0,ht.of)(!0)}(q.route,L),function ws(P,O,V){const L=O[O.length-1],ve=O.slice(0,O.length-1).reverse().map(me=>function Ka(P){const O=P.routeConfig?P.routeConfig.canActivateChild:null;return O&&0!==O.length?{node:P,guards:O}:null}(me)).filter(me=>null!==me).map(me=>(0,bt.P)(()=>{const et=me.guards.map(In=>{const Yn=Ns(me.node)??V,or=jr(In,Yn);return yn(function Ee(P){return P&&T(P.canActivateChild)}(or)?or.canActivateChild(L,P):Yn.runInContext(()=>or(L,P))).pipe(Ht())});return(0,ht.of)(et).pipe(Z())}));return(0,ht.of)(ve).pipe(Z())}(P,q.path,V),function ns(P,O,V){const L=O.routeConfig?O.routeConfig.canActivate:null;if(!L||0===L.length)return(0,ht.of)(!0);const q=L.map(ve=>(0,bt.P)(()=>{const me=Ns(O)??V,et=jr(ve,me);return yn(function Q(P){return P&&T(P.canActivate)}(et)?et.canActivate(O,P):me.runInContext(()=>et(O,P))).pipe(Ht())}));return(0,ht.of)(q).pipe(Z())}(P,q.route,V))),Ht(q=>!0!==q,!0))}(L,ve,P,O):(0,ht.of)(et)),(0,$t.U)(et=>({...V,guardsResult:et})))})}(this.environmentInjector,et=>this.events.next(et)),(0,tn.b)(et=>{if(q.guardsResult=et.guardsResult,no(et.guardsResult))throw So(0,et.guardsResult);const In=new vt(et.id,this.urlSerializer.serialize(et.extractedUrl),this.urlSerializer.serialize(et.urlAfterRedirects),et.targetSnapshot,!!et.guardsResult);this.events.next(In)}),(0,Lt.h)(et=>!!et.guardsResult||(L.restoreHistory(et),this.cancelNavigationTransition(et,"",3),!1)),X(et=>{if(et.guards.canActivateChecks.length)return(0,ht.of)(et).pipe((0,tn.b)(In=>{const Yn=new Mt(In.id,this.urlSerializer.serialize(In.extractedUrl),this.urlSerializer.serialize(In.urlAfterRedirects),In.targetSnapshot);this.events.next(Yn)}),(0,un.w)(In=>{let Yn=!1;return(0,ht.of)(In).pipe(function Xs(P,O){return(0,ft.z)(V=>{const{targetSnapshot:L,guards:{canActivateChecks:q}}=V;if(!q.length)return(0,ht.of)(V);let ve=0;return(0,Me.D)(q).pipe(li(me=>function va(P,O,V,L){const q=P.routeConfig,ve=P._resolve;return void 0!==q?.title&&!F(q)&&(ve[St]=q.title),function bl(P,O,V,L){const q=function Ks(P){return[...Object.keys(P),...Object.getOwnPropertySymbols(P)]}(P);if(0===q.length)return(0,ht.of)({});const ve={};return(0,Me.D)(q).pipe((0,ft.z)(me=>function Vs(P,O,V,L){const q=Ns(O)??L,ve=jr(P,q);return yn(ve.resolve?ve.resolve(O,V):q.runInContext(()=>ve(O,V)))}(P[me],O,V,L).pipe(Ht(),(0,tn.b)(et=>{ve[me]=et}))),en(1),function Zn(P){return(0,$t.U)(()=>P)}(ve),Ne(me=>vo(me)?_t.E:Qe(me)))}(ve,P,O,L).pipe((0,$t.U)(me=>(P._resolvedData=me,P.data=ds(P,V).resolve,q&&F(q)&&(P.data[St]=q.title),null)))}(me.route,L,P,O)),(0,tn.b)(()=>ve++),en(1),(0,ft.z)(me=>ve===q.length?(0,ht.of)(V):_t.E))})}(L.paramsInheritanceStrategy,this.environmentInjector),(0,tn.b)({next:()=>Yn=!0,complete:()=>{Yn||(L.restoreHistory(In),this.cancelNavigationTransition(In,"",2))}}))}),(0,tn.b)(In=>{const Yn=new sn(In.id,this.urlSerializer.serialize(In.extractedUrl),this.urlSerializer.serialize(In.urlAfterRedirects),In.targetSnapshot);this.events.next(Yn)}))}),X(et=>{const In=Yn=>{const or=[];Yn.routeConfig?.loadComponent&&!Yn.routeConfig._loadedComponent&&or.push(this.configLoader.loadComponent(Yn.routeConfig).pipe((0,tn.b)(ui=>{Yn.component=ui}),(0,$t.U)(()=>{})));for(const ui of Yn.children)or.push(...In(ui));return or};return(0,pt.a)(In(et.targetSnapshot.root)).pipe(pn(),(0,De.q)(1))}),X(()=>this.afterPreactivation()),(0,$t.U)(et=>{const In=function Os(P,O,V){const L=zr(P,O._root,V?V._root:void 0);return new Ys(L,O)}(L.routeReuseStrategy,et.targetSnapshot,et.currentRouterState);return q={...et,targetRouterState:In}}),(0,tn.b)(et=>{L.currentUrlTree=et.urlAfterRedirects,L.rawUrlTree=L.urlHandlingStrategy.merge(et.urlAfterRedirects,et.rawUrl),L.routerState=et.targetRouterState,"deferred"===L.urlUpdateStrategy&&(et.extras.skipLocationChange||L.setBrowserUrl(L.rawUrlTree,et),L.browserUrlTree=et.urlAfterRedirects)}),((P,O,V,L)=>(0,$t.U)(q=>(new aa(O,q.targetRouterState,q.currentRouterState,V,L).activate(P),q)))(this.rootContexts,L.routeReuseStrategy,et=>this.events.next(et),this.inputBindingEnabled),(0,De.q)(1),(0,tn.b)({next:et=>{ve=!0,this.lastSuccessfulNavigation=this.currentNavigation,L.navigated=!0,this.events.next(new Un(et.id,this.urlSerializer.serialize(et.extractedUrl),this.urlSerializer.serialize(L.currentUrlTree))),L.titleStrategy?.updateTitle(et.targetRouterState.snapshot),et.resolve(!0)},complete:()=>{ve=!0}}),ri(()=>{ve||me||this.cancelNavigationTransition(q,"",1),this.currentNavigation?.id===q.id&&(this.currentNavigation=null)}),Ne(et=>{if(me=!0,Fs(et)){Fo(et)||(L.navigated=!0,L.restoreHistory(q,!0));const In=new Pi(q.id,this.urlSerializer.serialize(q.extractedUrl),et.message,et.cancellationCode);if(this.events.next(In),Fo(et)){const Yn=L.urlHandlingStrategy.merge(et.url,L.rawUrlTree),or={skipLocationChange:q.extras.skipLocationChange,replaceUrl:"eager"===L.urlUpdateStrategy||_n(q.source)};L.scheduleNavigation(Yn,os,null,or,{resolve:q.resolve,reject:q.reject,promise:q.promise})}else q.resolve(!1)}else{L.restoreHistory(q,!0);const In=new Oe(q.id,this.urlSerializer.serialize(q.extractedUrl),et,q.targetSnapshot??void 0);this.events.next(In);try{q.resolve(L.errorHandler(et))}catch(Yn){q.reject(Yn)}}return _t.E}))}))}cancelNavigationTransition(L,q,ve){const me=new Pi(L.id,this.urlSerializer.serialize(L.extractedUrl),q,ve);this.events.next(me),L.resolve(!1)}}return(P=O).\u0275fac=function(L){return new(L||P)},P.\u0275prov=M.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),O})();function _n(P){return P!==os}let ki=(()=>{var P;class O{buildTitle(L){let q,ve=L.root;for(;void 0!==ve;)q=this.getResolvedTitleForRoute(ve)??q,ve=ve.children.find(me=>me.outlet===xt);return q}getResolvedTitleForRoute(L){return L.data[St]}}return(P=O).\u0275fac=function(L){return new(L||P)},P.\u0275prov=M.Yz7({token:P,factory:function(){return(0,M.f3M)(Gi)},providedIn:"root"}),O})(),Gi=(()=>{var P;class O extends ki{constructor(L){super(),this.title=L}updateTitle(L){const q=this.buildTitle(L);void 0!==q&&this.title.setTitle(q)}}return(P=O).\u0275fac=function(L){return new(L||P)(M.LFG(nn.Dx))},P.\u0275prov=M.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),O})(),Mi=(()=>{var P;class O{}return(P=O).\u0275fac=function(L){return new(L||P)},P.\u0275prov=M.Yz7({token:P,factory:function(){return(0,M.f3M)(Zi)},providedIn:"root"}),O})();class Qi{shouldDetach(O){return!1}store(O,V){}shouldAttach(O){return!1}retrieve(O){return null}shouldReuseRoute(O,V){return O.routeConfig===V.routeConfig}}let Zi=(()=>{var P;class O extends Qi{}return(P=O).\u0275fac=function(){let V;return function(q){return(V||(V=M.n5z(P)))(q||P)}}(),P.\u0275prov=M.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),O})();const Xi=new M.OlP("",{providedIn:"root",factory:()=>({})});let wr=(()=>{var P;class O{}return(P=O).\u0275fac=function(L){return new(L||P)},P.\u0275prov=M.Yz7({token:P,factory:function(){return(0,M.f3M)(Mr)},providedIn:"root"}),O})(),Mr=(()=>{var P;class O{shouldProcessUrl(L){return!0}extract(L){return L}merge(L,q){return L}}return(P=O).\u0275fac=function(L){return new(L||P)},P.\u0275prov=M.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),O})();var qo=function(P){return P[P.COMPLETE=0]="COMPLETE",P[P.FAILED=1]="FAILED",P[P.REDIRECTING=2]="REDIRECTING",P}(qo||{});function Cs(P,O){P.events.pipe((0,Lt.h)(V=>V instanceof Un||V instanceof Pi||V instanceof Oe||V instanceof se),(0,$t.U)(V=>V instanceof Un||V instanceof se?qo.COMPLETE:V instanceof Pi&&(0===V.code||1===V.code)?qo.REDIRECTING:qo.FAILED),(0,Lt.h)(V=>V!==qo.REDIRECTING),(0,De.q)(1)).subscribe(()=>{O()})}function Yo(P){throw P}function Zo(P,O,V){return O.parse("/")}const xa={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Da={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Js=(()=>{var P;class O{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=(0,M.f3M)(M.c2e),this.isNgZoneEnabled=!1,this.options=(0,M.f3M)(Xi,{optional:!0})||{},this.pendingTasks=(0,M.f3M)(M.HDt),this.errorHandler=this.options.errorHandler||Yo,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||Zo,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=(0,M.f3M)(wr),this.routeReuseStrategy=(0,M.f3M)(Mi),this.titleStrategy=(0,M.f3M)(ki),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=(0,M.f3M)(ye,{optional:!0})?.flat()??[],this.navigationTransitions=(0,M.f3M)(rn),this.urlSerializer=(0,M.f3M)(No),this.location=(0,M.f3M)(Fe.Ye),this.componentInputBindingEnabled=!!(0,M.f3M)(Tr,{optional:!0}),this.isNgZoneEnabled=(0,M.f3M)(M.R0b)instanceof M.R0b&&M.R0b.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Er,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=Ii(0,null),this.navigationTransitions.setupNavigations(this).subscribe(L=>{this.lastSuccessfulId=L.id,this.currentPageId=this.browserPageId??0},L=>{this.console.warn(`Unhandled Navigation Error: ${L}`)})}resetRootComponentType(L){this.routerState.root.component=L,this.navigationTransitions.rootComponentType=L}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const L=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),os,L)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(L=>{const q="popstate"===L.type?"popstate":"hashchange";"popstate"===q&&setTimeout(()=>{this.navigateToSyncWithBrowser(L.url,q,L.state)},0)}))}navigateToSyncWithBrowser(L,q,ve){const me={replaceUrl:!0},et=ve?.navigationId?ve:null;if(ve){const Yn={...ve};delete Yn.navigationId,delete Yn.\u0275routerPageId,0!==Object.keys(Yn).length&&(me.state=Yn)}const In=this.parseUrl(L);this.scheduleNavigation(In,q,et,me)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(L){this.config=L.map(oa),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(L,q={}){const{relativeTo:ve,queryParams:me,fragment:et,queryParamsHandling:In,preserveFragment:Yn}=q,or=Yn?this.currentUrlTree.fragment:et;let Xo,ui=null;switch(In){case"merge":ui={...this.currentUrlTree.queryParams,...me};break;case"preserve":ui=this.currentUrlTree.queryParams;break;default:ui=me||null}null!==ui&&(ui=this.removeEmptyProps(ui));try{Xo=Wr(ve?ve.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof L[0]||!L[0].startsWith("/"))&&(L=[]),Xo=this.currentUrlTree.root}return qi(Xo,L,ui,or??null)}navigateByUrl(L,q={skipLocationChange:!1}){const ve=no(L)?L:this.parseUrl(L),me=this.urlHandlingStrategy.merge(ve,this.rawUrlTree);return this.scheduleNavigation(me,os,null,q)}navigate(L,q={skipLocationChange:!1}){return function Pa(P){for(let O=0;O<P.length;O++)if(null==P[O])throw new M.vHH(4008,!1)}(L),this.navigateByUrl(this.createUrlTree(L,q),q)}serializeUrl(L){return this.urlSerializer.serialize(L)}parseUrl(L){let q;try{q=this.urlSerializer.parse(L)}catch(ve){q=this.malformedUriErrorHandler(ve,this.urlSerializer,L)}return q}isActive(L,q){let ve;if(ve=!0===q?{...xa}:!1===q?{...Da}:q,no(L))return pr(this.currentUrlTree,L,ve);const me=this.parseUrl(L);return pr(this.currentUrlTree,me,ve)}removeEmptyProps(L){return Object.keys(L).reduce((q,ve)=>{const me=L[ve];return null!=me&&(q[ve]=me),q},{})}scheduleNavigation(L,q,ve,me,et){if(this.disposed)return Promise.resolve(!1);let In,Yn,or;et?(In=et.resolve,Yn=et.reject,or=et.promise):or=new Promise((Xo,Ha)=>{In=Xo,Yn=Ha});const ui=this.pendingTasks.add();return Cs(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(ui))}),this.navigationTransitions.handleNavigationRequest({source:q,restoredState:ve,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:L,extras:me,resolve:In,reject:Yn,promise:or,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),or.catch(Xo=>Promise.reject(Xo))}setBrowserUrl(L,q){const ve=this.urlSerializer.serialize(L);if(this.location.isCurrentPathEqualTo(ve)||q.extras.replaceUrl){const et={...q.extras.state,...this.generateNgRouterState(q.id,this.browserPageId)};this.location.replaceState(ve,"",et)}else{const me={...q.extras.state,...this.generateNgRouterState(q.id,(this.browserPageId??0)+1)};this.location.go(ve,"",me)}}restoreHistory(L,q=!1){if("computed"===this.canceledNavigationResolution){const me=this.currentPageId-(this.browserPageId??this.currentPageId);0!==me?this.location.historyGo(me):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===me&&(this.resetState(L),this.browserUrlTree=L.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(q&&this.resetState(L),this.resetUrlToCurrentUrlTree())}resetState(L){this.routerState=L.currentRouterState,this.currentUrlTree=L.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,L.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(L,q){return"computed"===this.canceledNavigationResolution?{navigationId:L,\u0275routerPageId:q}:{navigationId:L}}}return(P=O).\u0275fac=function(L){return new(L||P)},P.\u0275prov=M.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),O})(),ei=(()=>{var P;class O{constructor(L,q,ve,me,et,In){this.router=L,this.route=q,this.tabIndexAttribute=ve,this.renderer=me,this.el=et,this.locationStrategy=In,this.href=null,this.commands=null,this.onChanges=new Ze.x,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const Yn=et.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===Yn||"area"===Yn,this.isAnchorElement?this.subscription=L.events.subscribe(or=>{or instanceof Un&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(L){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",L)}ngOnChanges(L){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(L){null!=L?(this.commands=Array.isArray(L)?L:[L],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(L,q,ve,me,et){return!!(null===this.urlTree||this.isAnchorElement&&(0!==L||q||ve||me||et||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const L=null===this.href?null:(0,M.P3R)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",L)}applyAttributeValue(L,q){const ve=this.renderer,me=this.el.nativeElement;null!==q?ve.setAttribute(me,L,q):ve.removeAttribute(me,L)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return(P=O).\u0275fac=function(L){return new(L||P)(M.Y36(Js),M.Y36(lo),M.$8M("tabindex"),M.Y36(M.Qsj),M.Y36(M.SBq),M.Y36(Fe.S$))},P.\u0275dir=M.lG2({type:P,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(L,q){1&L&&M.NdJ("click",function(me){return q.onClick(me.button,me.ctrlKey,me.shiftKey,me.altKey,me.metaKey)}),2&L&&M.uIk("target",q.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",M.VuI],skipLocationChange:["skipLocationChange","skipLocationChange",M.VuI],replaceUrl:["replaceUrl","replaceUrl",M.VuI],routerLink:"routerLink"},standalone:!0,features:[M.Xq5,M.TTD]}),O})();class wl{}let Bl=(()=>{var P;class O{preload(L,q){return q().pipe(Ne(()=>(0,ht.of)(null)))}}return(P=O).\u0275fac=function(L){return new(L||P)},P.\u0275prov=M.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),O})(),Wi=(()=>{var P;class O{constructor(L,q,ve,me,et){this.router=L,this.injector=ve,this.preloadingStrategy=me,this.loader=et}setUpPreloading(){this.subscription=this.router.events.pipe((0,Lt.h)(L=>L instanceof Un),li(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(L,q){const ve=[];for(const me of q){me.providers&&!me._injector&&(me._injector=(0,M.MMx)(me.providers,L,`Route: ${me.path}`));const et=me._injector??L,In=me._loadedInjector??et;(me.loadChildren&&!me._loadedRoutes&&void 0===me.canLoad||me.loadComponent&&!me._loadedComponent)&&ve.push(this.preloadConfig(et,me)),(me.children||me._loadedRoutes)&&ve.push(this.processRoutes(In,me.children??me._loadedRoutes))}return(0,Me.D)(ve).pipe((0,Cn.J)())}preloadConfig(L,q){return this.preloadingStrategy.preload(q,()=>{let ve;ve=q.loadChildren&&void 0===q.canLoad?this.loader.loadChildren(L,q):(0,ht.of)(null);const me=ve.pipe((0,ft.z)(et=>null===et?(0,ht.of)(void 0):(q._loadedRoutes=et.routes,q._loadedInjector=et.injector,this.processRoutes(et.injector??L,et.routes))));if(q.loadComponent&&!q._loadedComponent){const et=this.loader.loadComponent(q);return(0,Me.D)([me,et]).pipe((0,Cn.J)())}return me})}}return(P=O).\u0275fac=function(L){return new(L||P)(M.LFG(Js),M.LFG(M.Sil),M.LFG(M.lqb),M.LFG(wl),M.LFG(j))},P.\u0275prov=M.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),O})();const El=new M.OlP("");let nu=(()=>{var P;class O{constructor(L,q,ve,me,et={}){this.urlSerializer=L,this.transitions=q,this.viewportScroller=ve,this.zone=me,this.options=et,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},et.scrollPositionRestoration=et.scrollPositionRestoration||"disabled",et.anchorScrolling=et.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(L=>{L instanceof Lo?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=L.navigationTrigger,this.restoredId=L.restoredState?L.restoredState.navigationId:0):L instanceof Un?(this.lastId=L.id,this.scheduleScrollEvent(L,this.urlSerializer.parse(L.urlAfterRedirects).fragment)):L instanceof se&&0===L.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(L,this.urlSerializer.parse(L.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(L=>{L instanceof br&&(L.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(L.position):L.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(L.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(L,q){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new br(L,"popstate"===this.lastSource?this.store[this.restoredId]:null,q))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return(P=O).\u0275fac=function(L){M.$Z()},P.\u0275prov=M.Yz7({token:P,factory:P.\u0275fac}),O})();function Ca(P,O){return{\u0275kind:P,\u0275providers:O}}function Tl(){const P=(0,M.f3M)(M.zs3);return O=>{const V=P.get(M.z2F);if(O!==V.components[0])return;const L=P.get(Js),q=P.get(wc);1===P.get(oc)&&L.initialNavigation(),P.get(Sl,null,M.XFs.Optional)?.setUpPreloading(),P.get(El,null,M.XFs.Optional)?.init(),L.resetRootComponentType(V.componentTypes[0]),q.closed||(q.next(),q.complete(),q.unsubscribe())}}const wc=new M.OlP("",{factory:()=>new Ze.x}),oc=new M.OlP("",{providedIn:"root",factory:()=>1}),Sl=new M.OlP("");function Ts(P){return Ca(0,[{provide:Sl,useExisting:Wi},{provide:wl,useExisting:P}])}const su=new M.OlP("ROUTER_FORROOT_GUARD"),ph=[Fe.Ye,{provide:No,useClass:Ue},Js,To,{provide:lo,useFactory:function ru(P){return P.routerState.root},deps:[Js]},j,[]];function au(){return new M.PXZ("Router",Js)}let js=(()=>{var P;class O{constructor(L){}static forRoot(L,q){return{ngModule:O,providers:[ph,[],{provide:ye,multi:!0,useValue:L},{provide:su,useFactory:Ja,deps:[[Js,new M.FiY,new M.tp0]]},{provide:Xi,useValue:q||{}},q?.useHash?{provide:Fe.S$,useClass:Fe.Do}:{provide:Fe.S$,useClass:Fe.b0},{provide:El,useFactory:()=>{const P=(0,M.f3M)(Fe.EM),O=(0,M.f3M)(M.R0b),V=(0,M.f3M)(Xi),L=(0,M.f3M)(rn),q=(0,M.f3M)(No);return V.scrollOffset&&P.setOffset(V.scrollOffset),new nu(q,L,P,O,V)}},q?.preloadingStrategy?Ts(q.preloadingStrategy).\u0275providers:[],{provide:M.PXZ,multi:!0,useFactory:au},q?.initialNavigation?Pu(q):[],q?.bindToComponentInputs?Ca(8,[ts,{provide:Tr,useExisting:ts}]).\u0275providers:[],[{provide:cu,useFactory:Tl},{provide:M.tb,multi:!0,useExisting:cu}]]}}static forChild(L){return{ngModule:O,providers:[{provide:ye,multi:!0,useValue:L}]}}}return(P=O).\u0275fac=function(L){return new(L||P)(M.LFG(su,8))},P.\u0275mod=M.oAB({type:P}),P.\u0275inj=M.cJS({}),O})();function Ja(P){return"guarded"}function Pu(P){return["disabled"===P.initialNavigation?Ca(3,[{provide:M.ip1,multi:!0,useFactory:()=>{const O=(0,M.f3M)(Js);return()=>{O.setUpLocationChangeListener()}}},{provide:oc,useValue:2}]).\u0275providers:[],"enabledBlocking"===P.initialNavigation?Ca(2,[{provide:oc,useValue:0},{provide:M.ip1,multi:!0,deps:[M.zs3],useFactory:O=>{const V=O.get(Fe.V_,Promise.resolve());return()=>V.then(()=>new Promise(L=>{const q=O.get(Js),ve=O.get(wc);Cs(q,()=>{L(!0)}),O.get(rn).afterPreactivation=()=>(L(!0),ve.closed?(0,ht.of)(void 0):ve),q.initialNavigation()}))}}]).\u0275providers:[]]}const cu=new M.OlP("")},7852:(ci,Qt,le)=>{"use strict";le.d(Qt,{w:()=>xt,dr:()=>Si,oU:()=>po,cs:()=>kr,YG:()=>Sr,Sm:()=>gr,PM:()=>ir,FN:()=>rr,Zi:()=>No,tO:()=>Ue,Dq:()=>ae,wI:()=>We,W2:()=>ot,fr:()=>Pn,jY:()=>Ye,Gu:()=>je,gu:()=>wt,pK:()=>$n,Ie:()=>si,Q$:()=>no,z0:()=>Mo,fG:()=>Uo,jP:()=>So,Nd:()=>Co,wd:()=>an,ho:()=>ii,sr:()=>vi,Pc:()=>zs,r4:()=>Ka,YI:()=>xs,j9:()=>yi,yF:()=>Ho});var M=le(5861),b=le(9468),Ft=le(95),l=le(7582),Me=le(2438),ht=le(8645),Ke=le(5619),pt=le(2572),yt=le(2096),Dt=le(6879),_t=(le(6506),le(8899),le(5298),le(8077),le(7876)),Wt=le(544),Ct=le(1273),it=le(8354),Tt=(le(1767),le(8946)),$t=(le(7643),le(4587),le(6953)),De=le(2181),dt=le(4664),Lt=le(3997),ft=le(6814);const hn=_t.i,Ht=["*"],en=T=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(T):"function"==typeof requestAnimationFrame?requestAnimationFrame(T):setTimeout(T);let on=(()=>{class T{constructor(S,Q){this.injector=S,this.el=Q,this.onChange=()=>{},this.onTouched=()=>{}}writeValue(S){this.el.nativeElement.value=this.lastValue=S,Zn(this.el)}handleValueChange(S,Q){S===this.el.nativeElement&&(Q!==this.lastValue&&(this.lastValue=Q,this.onChange(Q)),Zn(this.el))}_handleBlurEvent(S){S===this.el.nativeElement&&(this.onTouched(),Zn(this.el))}registerOnChange(S){this.onChange=S}registerOnTouched(S){this.onTouched=S}setDisabledState(S){this.el.nativeElement.disabled=S}ngOnDestroy(){this.statusChanges&&this.statusChanges.unsubscribe()}ngAfterViewInit(){let S;try{S=this.injector.get(Ft.a5)}catch{}if(!S)return;S.statusChanges&&(this.statusChanges=S.statusChanges.subscribe(()=>Zn(this.el)));const Q=S.control;Q&&["markAsTouched","markAllAsTouched","markAsUntouched","markAsDirty","markAsPristine"].forEach(wn=>{if(typeof Q[wn]<"u"){const ai=Q[wn].bind(Q);Q[wn]=(...oi)=>{ai(...oi),Zn(this.el)}}})}}return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.zs3),b.Y36(b.SBq))},T.\u0275dir=b.lG2({type:T,hostBindings:function(S,Q){1&S&&b.NdJ("ionBlur",function(wn){return Q._handleBlurEvent(wn.target)})}}),T})();const Zn=T=>{en(()=>{const K=T.nativeElement,S=null!=K.value&&K.value.toString().length>0,Q=ri(K);Cn(K,Q);const Ee=K.closest("ion-item");Ee&&Cn(Ee,S?[...Q,"item-has-value"]:Q)})},ri=T=>{const K=T.classList,S=[];for(let Q=0;Q<K.length;Q++){const Ee=K.item(Q);null!==Ee&&nn(Ee,"ng-")&&S.push(`ion-${Ee.substring(3)}`)}return S},Cn=(T,K)=>{const S=T.classList;S.remove("ion-valid","ion-invalid","ion-touched","ion-untouched","ion-dirty","ion-pristine"),S.add(...K)},nn=(T,K)=>T.substring(0,K.length)===K;let xt=(()=>{class T extends on{constructor(S,Q){super(S,Q)}writeValue(S){this.el.nativeElement.checked=this.lastValue=S,Zn(this.el)}_handleIonChange(S){this.handleValueChange(S,S.checked)}}return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.zs3),b.Y36(b.SBq))},T.\u0275dir=b.lG2({type:T,selectors:[["ion-checkbox"],["ion-toggle"]],hostBindings:function(S,Q){1&S&&b.NdJ("ionChange",function(wn){return Q._handleIonChange(wn.target)})},features:[b._Bn([{provide:Ft.JU,useExisting:T,multi:!0}]),b.qOj]}),T})(),yi=(()=>{class T extends on{constructor(S,Q){super(S,Q)}_handleInputEvent(S){this.handleValueChange(S,S.value)}}return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.zs3),b.Y36(b.SBq))},T.\u0275dir=b.lG2({type:T,selectors:[["ion-input",3,"type","number"],["ion-textarea"],["ion-searchbar"]],hostBindings:function(S,Q){1&S&&b.NdJ("ionInput",function(wn){return Q._handleInputEvent(wn.target)})},features:[b._Bn([{provide:Ft.JU,useExisting:T,multi:!0}]),b.qOj]}),T})();const qn=(T,K)=>{const S=T.prototype;K.forEach(Q=>{Object.defineProperty(S,Q,{get(){return this.el[Q]},set(Ee){this.z.runOutsideAngular(()=>this.el[Q]=Ee)}})})},ti=(T,K)=>{const S=T.prototype;K.forEach(Q=>{S[Q]=function(){const Ee=arguments;return this.z.runOutsideAngular(()=>this.el[Q].apply(this.el,Ee))}})},Xn=(T,K,S)=>{S.forEach(Q=>T[Q]=(0,Me.R)(K,Q))};function yn(T){return function(S){const{defineCustomElementFn:Q,inputs:Ee,methods:wn}=T;return void 0!==Q&&Q(),Ee&&qn(S,Ee),wn&&ti(S,wn),S}}let Si=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-app"]],ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({})],T),T})(),po=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-back-button"]],inputs:{color:"color",defaultHref:"defaultHref",disabled:"disabled",icon:"icon",mode:"mode",routerAnimation:"routerAnimation",text:"text",type:"type"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["color","defaultHref","disabled","icon","mode","routerAnimation","text","type"]})],T),T})(),Sr=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement,Xn(this,this.el,["ionFocus","ionBlur"])}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-button"]],inputs:{buttonType:"buttonType",color:"color",disabled:"disabled",download:"download",expand:"expand",fill:"fill",form:"form",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",shape:"shape",size:"size",strong:"strong",target:"target",type:"type"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["buttonType","color","disabled","download","expand","fill","form","href","mode","rel","routerAnimation","routerDirection","shape","size","strong","target","type"]})],T),T})(),gr=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-buttons"]],inputs:{collapse:"collapse"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["collapse"]})],T),T})(),ir=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-card"]],inputs:{button:"button",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",target:"target",type:"type"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["button","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","target","type"]})],T),T})(),rr=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-card-content"]],inputs:{mode:"mode"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["mode"]})],T),T})(),No=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-card-header"]],inputs:{color:"color",mode:"mode",translucent:"translucent"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["color","mode","translucent"]})],T),T})(),Ue=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-card-subtitle"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["color","mode"]})],T),T})(),ae=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-card-title"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["color","mode"]})],T),T})(),We=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-col"]],inputs:{offset:"offset",offsetLg:"offsetLg",offsetMd:"offsetMd",offsetSm:"offsetSm",offsetXl:"offsetXl",offsetXs:"offsetXs",pull:"pull",pullLg:"pullLg",pullMd:"pullMd",pullSm:"pullSm",pullXl:"pullXl",pullXs:"pullXs",push:"push",pushLg:"pushLg",pushMd:"pushMd",pushSm:"pushSm",pushXl:"pushXl",pushXs:"pushXs",size:"size",sizeLg:"sizeLg",sizeMd:"sizeMd",sizeSm:"sizeSm",sizeXl:"sizeXl",sizeXs:"sizeXs"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["offset","offsetLg","offsetMd","offsetSm","offsetXl","offsetXs","pull","pullLg","pullMd","pullSm","pullXl","pullXs","push","pushLg","pushMd","pushSm","pushXl","pushXs","size","sizeLg","sizeMd","sizeSm","sizeXl","sizeXs"]})],T),T})(),ot=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement,Xn(this,this.el,["ionScrollStart","ionScroll","ionScrollEnd"])}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-content"]],inputs:{color:"color",forceOverscroll:"forceOverscroll",fullscreen:"fullscreen",scrollEvents:"scrollEvents",scrollX:"scrollX",scrollY:"scrollY"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["color","forceOverscroll","fullscreen","scrollEvents","scrollX","scrollY"],methods:["getScrollElement","scrollToTop","scrollToBottom","scrollByPoint","scrollToPoint"]})],T),T})(),Pn=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-footer"]],inputs:{collapse:"collapse",mode:"mode",translucent:"translucent"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["collapse","mode","translucent"]})],T),T})(),Ye=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-grid"]],inputs:{fixed:"fixed"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["fixed"]})],T),T})(),je=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-header"]],inputs:{collapse:"collapse",mode:"mode",translucent:"translucent"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["collapse","mode","translucent"]})],T),T})(),wt=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-icon"]],inputs:{color:"color",flipRtl:"flipRtl",icon:"icon",ios:"ios",lazy:"lazy",md:"md",mode:"mode",name:"name",sanitize:"sanitize",size:"size",src:"src"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["color","flipRtl","icon","ios","lazy","md","mode","name","sanitize","size","src"]})],T),T})(),$n=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement,Xn(this,this.el,["ionInput","ionChange","ionBlur","ionFocus"])}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-input"]],inputs:{accept:"accept",autocapitalize:"autocapitalize",autocomplete:"autocomplete",autocorrect:"autocorrect",autofocus:"autofocus",clearInput:"clearInput",clearOnEdit:"clearOnEdit",color:"color",counter:"counter",counterFormatter:"counterFormatter",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",errorText:"errorText",fill:"fill",helperText:"helperText",inputmode:"inputmode",label:"label",labelPlacement:"labelPlacement",legacy:"legacy",max:"max",maxlength:"maxlength",min:"min",minlength:"minlength",mode:"mode",multiple:"multiple",name:"name",pattern:"pattern",placeholder:"placeholder",readonly:"readonly",required:"required",shape:"shape",size:"size",spellcheck:"spellcheck",step:"step",type:"type",value:"value"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["accept","autocapitalize","autocomplete","autocorrect","autofocus","clearInput","clearOnEdit","color","counter","counterFormatter","debounce","disabled","enterkeyhint","errorText","fill","helperText","inputmode","label","labelPlacement","legacy","max","maxlength","min","minlength","mode","multiple","name","pattern","placeholder","readonly","required","shape","size","spellcheck","step","type","value"],methods:["setFocus","getInputElement"]})],T),T})(),si=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-item"]],inputs:{button:"button",color:"color",counter:"counter",counterFormatter:"counterFormatter",detail:"detail",detailIcon:"detailIcon",disabled:"disabled",download:"download",fill:"fill",href:"href",lines:"lines",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",shape:"shape",target:"target",type:"type"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["button","color","counter","counterFormatter","detail","detailIcon","disabled","download","fill","href","lines","mode","rel","routerAnimation","routerDirection","shape","target","type"]})],T),T})(),no=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-label"]],inputs:{color:"color",mode:"mode",position:"position"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["color","mode","position"]})],T),T})(),Mo=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement,Xn(this,this.el,["ionWillOpen","ionWillClose","ionDidOpen","ionDidClose"])}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-menu"]],inputs:{contentId:"contentId",disabled:"disabled",maxEdgeStart:"maxEdgeStart",menuId:"menuId",side:"side",swipeGesture:"swipeGesture",type:"type"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["contentId","disabled","maxEdgeStart","menuId","side","swipeGesture","type"],methods:["isOpen","isActive","open","close","toggle","setOpen"]})],T),T})(),Uo=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-menu-button"]],inputs:{autoHide:"autoHide",color:"color",disabled:"disabled",menu:"menu",mode:"mode",type:"type"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["autoHide","color","disabled","menu","mode","type"]})],T),T})(),Co=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-row"]],ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({})],T),T})(),an=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-title"]],inputs:{color:"color",size:"size"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["color","size"]})],T),T})(),ii=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement,Xn(this,this.el,["ionChange","ionFocus","ionBlur"])}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-toggle"]],inputs:{checked:"checked",color:"color",disabled:"disabled",enableOnOffLabels:"enableOnOffLabels",justify:"justify",labelPlacement:"labelPlacement",legacy:"legacy",mode:"mode",name:"name",value:"value"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["checked","color","disabled","enableOnOffLabels","justify","labelPlacement","legacy","mode","name","value"]})],T),T})(),vi=(()=>{let T=class{constructor(S,Q,Ee){this.z=Ee,S.detach(),this.el=Q.nativeElement}};return T.\u0275fac=function(S){return new(S||T)(b.Y36(b.sBO),b.Y36(b.SBq),b.Y36(b.R0b))},T.\u0275cmp=b.Xpm({type:T,selectors:[["ion-toolbar"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:Ht,decls:1,vars:0,template:function(S,Q){1&S&&(b.F$t(),b.Hsn(0))},encapsulation:2,changeDetection:0}),T=(0,l.gn)([yn({inputs:["color","mode"]})],T),T})(),Fi=(()=>{class T{get(S,Q){const Ee=jo();return Ee?Ee.get(S,Q):null}getBoolean(S,Q){const Ee=jo();return!!Ee&&Ee.getBoolean(S,Q)}getNumber(S,Q){const Ee=jo();return Ee?Ee.getNumber(S,Q):0}}return T.\u0275fac=function(S){return new(S||T)},T.\u0275prov=b.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();const br=new b.OlP("USERCONFIG"),jo=()=>{if(typeof window<"u"){const T=window.Ionic;if(T?.config)return T.config}return null};let mo=(()=>{class T{constructor(S,Q){this.doc=S,this.backButton=new ht.x,this.keyboardDidShow=new ht.x,this.keyboardDidHide=new ht.x,this.pause=new ht.x,this.resume=new ht.x,this.resize=new ht.x,Q.run(()=>{let Ee;this.win=S.defaultView,this.backButton.subscribeWithPriority=function(wn,ai){return this.subscribe(oi=>oi.register(wn,Lr=>Q.run(()=>ai(Lr))))},go(this.pause,S,"pause"),go(this.resume,S,"resume"),go(this.backButton,S,"ionBackButton"),go(this.resize,this.win,"resize"),go(this.keyboardDidShow,this.win,"ionKeyboardDidShow"),go(this.keyboardDidHide,this.win,"ionKeyboardDidHide"),this._readyPromise=new Promise(wn=>{Ee=wn}),this.win?.cordova?S.addEventListener("deviceready",()=>{Ee("cordova")},{once:!0}):Ee("dom")})}is(S){return(0,_t.a)(this.win,S)}platforms(){return(0,_t.g)(this.win)}ready(){return this._readyPromise}get isRTL(){return"rtl"===this.doc.dir}getQueryParam(S){return To(this.win.location.href,S)}isLandscape(){return!this.isPortrait()}isPortrait(){return this.win.matchMedia?.("(orientation: portrait)").matches}testUserAgent(S){const Q=this.win.navigator;return!!(Q?.userAgent&&Q.userAgent.indexOf(S)>=0)}url(){return this.win.location.href}width(){return this.win.innerWidth}height(){return this.win.innerHeight}}return T.\u0275fac=function(S){return new(S||T)(b.LFG(ft.K0),b.LFG(b.R0b))},T.\u0275prov=b.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();const To=(T,K)=>{K=K.replace(/[[\]\\]/g,"\\$&");const Q=new RegExp("[\\?&]"+K+"=([^&#]*)").exec(T);return Q?decodeURIComponent(Q[1].replace(/\+/g," ")):null},go=(T,K,S)=>{K&&K.addEventListener(S,Q=>{const Ee=Q?.detail;T.next(Ee)})};let ao=(()=>{class T{constructor(S,Q,Ee,wn){this.location=Q,this.serializer=Ee,this.router=wn,this.direction=cr,this.animated=Ls,this.guessDirection="forward",this.lastNavId=-1,wn&&wn.events.subscribe(ai=>{if(ai instanceof Dt.OD){const oi=ai.restoredState?ai.restoredState.navigationId:ai.id;this.guessDirection=oi<this.lastNavId?"back":"forward",this.guessAnimation=ai.restoredState?void 0:this.guessDirection,this.lastNavId="forward"===this.guessDirection?ai.id:oi}}),S.backButton.subscribeWithPriority(0,ai=>{this.pop(),ai()})}navigateForward(S,Q={}){return this.setDirection("forward",Q.animated,Q.animationDirection,Q.animation),this.navigate(S,Q)}navigateBack(S,Q={}){return this.setDirection("back",Q.animated,Q.animationDirection,Q.animation),this.navigate(S,Q)}navigateRoot(S,Q={}){return this.setDirection("root",Q.animated,Q.animationDirection,Q.animation),this.navigate(S,Q)}back(S={animated:!0,animationDirection:"back"}){return this.setDirection("back",S.animated,S.animationDirection,S.animation),this.location.back()}pop(){var S=this;return(0,M.Z)(function*(){let Q=S.topOutlet;for(;Q;){if(yield Q.pop())return!0;Q=Q.parentOutlet}return!1})()}setDirection(S,Q,Ee,wn){this.direction=S,this.animated=Po(S,Q,Ee),this.animationBuilder=wn}setTopOutlet(S){this.topOutlet=S}consumeTransition(){let Q,S="root";const Ee=this.animationBuilder;return"auto"===this.direction?(S=this.guessDirection,Q=this.guessAnimation):(Q=this.animated,S=this.direction),this.direction=cr,this.animated=Ls,this.animationBuilder=void 0,{direction:S,animation:Q,animationBuilder:Ee}}navigate(S,Q){if(Array.isArray(S))return this.router.navigate(S,Q);{const Ee=this.serializer.parse(S.toString());return void 0!==Q.queryParams&&(Ee.queryParams={...Q.queryParams}),void 0!==Q.fragment&&(Ee.fragment=Q.fragment),this.router.navigateByUrl(Ee,Q)}}}return T.\u0275fac=function(S){return new(S||T)(b.LFG(mo),b.LFG(ft.Ye),b.LFG(Dt.Hx),b.LFG(Dt.F0,8))},T.\u0275prov=b.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();const Po=(T,K,S)=>{if(!1!==K){if(void 0!==S)return S;if("forward"===T||"back"===T)return T;if("root"===T&&!0===K)return"forward"}},cr="auto",Ls=void 0;class Ys{constructor(K={}){this.data=K}get(K){return this.data[K]}}let Ii=(()=>{class T{constructor(){this.zone=(0,b.f3M)(b.R0b),this.applicationRef=(0,b.f3M)(b.z2F)}create(S,Q,Ee){return new Cr(S,Q,this.applicationRef,this.zone,Ee)}}return T.\u0275fac=function(S){return new(S||T)},T.\u0275prov=b.Yz7({token:T,factory:T.\u0275fac}),T})();class Cr{constructor(K,S,Q,Ee,wn){this.environmentInjector=K,this.injector=S,this.applicationRef=Q,this.zone=Ee,this.elementReferenceKey=wn,this.elRefMap=new WeakMap,this.elEventsMap=new WeakMap}attachViewToDom(K,S,Q,Ee){return this.zone.run(()=>new Promise(wn=>{const ai={...Q};void 0!==this.elementReferenceKey&&(ai[this.elementReferenceKey]=K),wn(lo(this.zone,this.environmentInjector,this.injector,this.applicationRef,this.elRefMap,this.elEventsMap,K,S,ai,Ee,this.elementReferenceKey))}))}removeViewFromDom(K,S){return this.zone.run(()=>new Promise(Q=>{const Ee=this.elRefMap.get(S);if(Ee){Ee.destroy(),this.elRefMap.delete(S);const wn=this.elEventsMap.get(S);wn&&(wn(),this.elEventsMap.delete(S))}Q()}))}}const lo=(T,K,S,Q,Ee,wn,ai,oi,Lr,vo,ee)=>{const Z=b.zs3.create({providers:na(Lr),parent:S}),xe=(0,b.LMc)(oi,{environmentInjector:K,elementInjector:Z}),te=xe.instance,Be=xe.location.nativeElement;if(Lr&&(ee&&void 0!==te[ee]&&console.error(`[Ionic Error]: ${ee} is a reserved property when using ${ai.tagName.toLowerCase()}. Rename or remove the "${ee}" property from ${oi.name}.`),Object.assign(te,Lr)),vo)for(const zi of vo)Be.classList.add(zi);const zn=ur(T,te,Be);return ai.appendChild(Be),Q.attachView(xe.hostView),Ee.set(Be,xe),wn.set(Be,zn),Be},ds=[it.L,it.a,it.b,it.c,it.d],ur=(T,K,S)=>T.run(()=>{const Q=ds.filter(Ee=>"function"==typeof K[Ee]).map(Ee=>{const wn=ai=>K[Ee](ai.detail);return S.addEventListener(Ee,wn),()=>S.removeEventListener(Ee,wn)});return()=>Q.forEach(Ee=>Ee())}),Rs=new b.OlP("NavParamsToken"),na=T=>[{provide:Rs,useValue:T},{provide:Ys,useFactory:hs,deps:[Rs]}],hs=T=>new Ys(T),ia=(T,K)=>((T=T.filter(S=>S.stackId!==K.stackId)).push(K),T),Ti=(T,K)=>{const S=T.createUrlTree(["."],{relativeTo:K});return T.serializeUrl(S)},ts=(T,K)=>{if(!T)return;const S=Os(K);for(let Q=0;Q<S.length;Q++){if(Q>=T.length)return S[Q];if(S[Q]!==T[Q])return}},Os=T=>T.split("/").map(K=>K.trim()).filter(K=>""!==K),zr=T=>{T&&(T.ref.destroy(),T.unlistenEvents())};class zo{constructor(K,S,Q,Ee,wn,ai){this.containerEl=S,this.router=Q,this.navCtrl=Ee,this.zone=wn,this.location=ai,this.views=[],this.skipTransition=!1,this.nextId=0,this.tabsPrefix=void 0!==K?Os(K):void 0}createView(K,S){const Q=Ti(this.router,S),Ee=K?.location?.nativeElement,wn=ur(this.zone,K.instance,Ee);return{id:this.nextId++,stackId:ts(this.tabsPrefix,Q),unlistenEvents:wn,element:Ee,ref:K,url:Q}}getExistingView(K){const S=Ti(this.router,K),Q=this.views.find(Ee=>Ee.url===S);return Q&&Q.ref.changeDetectorRef.reattach(),Q}setActive(K){const S=this.navCtrl.consumeTransition();let{direction:Q,animation:Ee,animationBuilder:wn}=S;const ai=this.activeView,oi=((T,K)=>!K||T.stackId!==K.stackId)(K,ai);oi&&(Q="back",Ee=void 0);const Lr=this.views.slice();let vo;const ee=this.router;ee.getCurrentNavigation?vo=ee.getCurrentNavigation():ee.navigations?.value&&(vo=ee.navigations.value),vo?.extras?.replaceUrl&&this.views.length>0&&this.views.splice(-1,1);const Z=this.views.includes(K),xe=this.insertView(K,Q);Z||K.ref.changeDetectorRef.detectChanges();const te=K.animationBuilder;return void 0===wn&&"back"===Q&&!oi&&void 0!==te&&(wn=te),ai&&(ai.animationBuilder=wn),this.zone.runOutsideAngular(()=>this.wait(()=>(ai&&ai.ref.changeDetectorRef.detach(),K.ref.changeDetectorRef.reattach(),this.transition(K,ai,Ee,this.canGoBack(1),!1,wn).then(()=>Xr(K,xe,Lr,this.location,this.zone)).then(()=>({enteringView:K,direction:Q,animation:Ee,tabSwitch:oi})))))}canGoBack(K,S=this.getActiveStackId()){return this.getStack(S).length>K}pop(K,S=this.getActiveStackId()){return this.zone.run(()=>{const Q=this.getStack(S);if(Q.length<=K)return Promise.resolve(!1);const Ee=Q[Q.length-K-1];let wn=Ee.url;const ai=Ee.savedData;if(ai){const Lr=ai.get("primary");Lr?.route?._routerState?.snapshot.url&&(wn=Lr.route._routerState.snapshot.url)}const{animationBuilder:oi}=this.navCtrl.consumeTransition();return this.navCtrl.navigateBack(wn,{...Ee.savedExtras,animation:oi}).then(()=>!0)})}startBackTransition(){const K=this.activeView;if(K){const S=this.getStack(K.stackId),Q=S[S.length-2],Ee=Q.animationBuilder;return this.wait(()=>this.transition(Q,K,"back",this.canGoBack(2),!0,Ee))}return Promise.resolve()}endBackTransition(K){K?(this.skipTransition=!0,this.pop(1)):this.activeView&&_o(this.activeView,this.views,this.views,this.location,this.zone)}getLastUrl(K){const S=this.getStack(K);return S.length>0?S[S.length-1]:void 0}getRootUrl(K){const S=this.getStack(K);return S.length>0?S[0]:void 0}getActiveStackId(){return this.activeView?this.activeView.stackId:void 0}hasRunningTask(){return void 0!==this.runningTask}destroy(){this.containerEl=void 0,this.views.forEach(zr),this.activeView=void 0,this.views=[]}getStack(K){return this.views.filter(S=>S.stackId===K)}insertView(K,S){return this.activeView=K,this.views=((T,K,S)=>"root"===S?ia(T,K):"forward"===S?((T,K)=>(T.indexOf(K)>=0?T=T.filter(Q=>Q.stackId!==K.stackId||Q.id<=K.id):T.push(K),T))(T,K):((T,K)=>T.indexOf(K)>=0?T.filter(Q=>Q.stackId!==K.stackId||Q.id<=K.id):ia(T,K))(T,K))(this.views,K,S),this.views.slice()}transition(K,S,Q,Ee,wn,ai){if(this.skipTransition)return this.skipTransition=!1,Promise.resolve(!1);if(S===K)return Promise.resolve(!1);const oi=K?K.element:void 0,Lr=S?S.element:void 0,vo=this.containerEl;return oi&&oi!==Lr&&(oi.classList.add("ion-page"),oi.classList.add("ion-page-invisible"),oi.parentElement!==vo&&vo.appendChild(oi),vo.commit)?vo.commit(oi,Lr,{duration:void 0===Q?0:void 0,direction:Q,showGoBack:Ee,progressAnimation:wn,animationBuilder:ai}):Promise.resolve(!1)}wait(K){var S=this;return(0,M.Z)(function*(){void 0!==S.runningTask&&(yield S.runningTask,S.runningTask=void 0);const Q=S.runningTask=K();return Q.finally(()=>S.runningTask=void 0),Q})()}}const Xr=(T,K,S,Q,Ee)=>"function"==typeof requestAnimationFrame?new Promise(wn=>{requestAnimationFrame(()=>{_o(T,K,S,Q,Ee),wn()})}):Promise.resolve(),_o=(T,K,S,Q,Ee)=>{Ee.run(()=>S.filter(wn=>!K.includes(wn)).forEach(zr)),K.forEach(wn=>{const oi=Q.path().split("?")[0].split("#")[0];if(wn!==T&&wn.url!==oi){const Lr=wn.element;Lr.setAttribute("aria-hidden","true"),Lr.classList.add("ion-page-hidden"),wn.ref.changeDetectorRef.detach()}})};let So=(()=>{class T{constructor(S,Q,Ee,wn,ai,oi,Lr,vo){this.parentOutlet=vo,this.activatedView=null,this.proxyMap=new WeakMap,this.currentActivatedRoute$=new Ke.X(null),this.activated=null,this._activatedRoute=null,this.name=Dt.eC,this.stackEvents=new b.vpe,this.activateEvents=new b.vpe,this.deactivateEvents=new b.vpe,this.parentContexts=(0,b.f3M)(Dt.y6),this.location=(0,b.f3M)(b.s_b),this.environmentInjector=(0,b.f3M)(b.lqb),this.inputBinder=(0,b.f3M)(Fo,{optional:!0}),this.supportsBindingToComponentInputs=!0,this.config=(0,b.f3M)(Fi),this.navCtrl=(0,b.f3M)(ao),this.nativeEl=wn.nativeElement,this.name=S||Dt.eC,this.tabsPrefix="true"===Q?Ti(ai,Lr):void 0,this.stackCtrl=new zo(this.tabsPrefix,this.nativeEl,ai,this.navCtrl,oi,Ee),this.parentContexts.onChildOutletCreated(this.name,this)}get activatedComponentRef(){return this.activated}set animation(S){this.nativeEl.animation=S}set animated(S){this.nativeEl.animated=S}set swipeGesture(S){this._swipeGesture=S,this.nativeEl.swipeHandler=S?{canStart:()=>this.stackCtrl.canGoBack(1)&&!this.stackCtrl.hasRunningTask(),onStart:()=>this.stackCtrl.startBackTransition(),onEnd:Q=>this.stackCtrl.endBackTransition(Q)}:void 0}ngOnDestroy(){this.stackCtrl.destroy(),this.inputBinder?.unsubscribeFromRouteData(this)}getContext(){return this.parentContexts.getContext(this.name)}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(!this.activated){const S=this.getContext();S?.route&&this.activateWith(S.route,S.injector)}new Promise(S=>(0,Wt.c)(this.nativeEl,S)).then(()=>{void 0===this._swipeGesture&&(this.swipeGesture=this.config.getBoolean("swipeBackEnabled","ios"===this.nativeEl.mode))})}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){throw new Error("incompatible reuse strategy")}attach(S,Q){throw new Error("incompatible reuse strategy")}deactivate(){if(this.activated){if(this.activatedView){const Q=this.getContext();this.activatedView.savedData=new Map(Q.children.contexts);const Ee=this.activatedView.savedData.get("primary");if(Ee&&Q.route&&(Ee.route={...Q.route}),this.activatedView.savedExtras={},Q.route){const wn=Q.route.snapshot;this.activatedView.savedExtras.queryParams=wn.queryParams,this.activatedView.savedExtras.fragment=wn.fragment}}const S=this.component;this.activatedView=null,this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(S)}}activateWith(S,Q){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=S;let Ee,wn=this.stackCtrl.getExistingView(S);if(wn){Ee=this.activated=wn.ref;const ai=wn.savedData;ai&&(this.getContext().children.contexts=ai),this.updateActivatedRouteProxy(Ee.instance,S)}else{const ai=S._futureSnapshot,oi=this.parentContexts.getOrCreateContext(this.name).children,Lr=new Ke.X(null),vo=this.createActivatedRouteProxy(Lr,S),ee=new xi(vo,oi,this.location.injector);Ee=this.activated=this.location.createComponent(ai.routeConfig.component??ai.component,{index:this.location.length,injector:ee,environmentInjector:Q??this.environmentInjector}),Lr.next(Ee.instance),wn=this.stackCtrl.createView(this.activated,S),this.proxyMap.set(Ee.instance,vo),this.currentActivatedRoute$.next({component:Ee.instance,activatedRoute:S})}this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activatedView=wn,this.navCtrl.setTopOutlet(this),this.stackCtrl.setActive(wn).then(ai=>{this.activateEvents.emit(Ee.instance),this.stackEvents.emit(ai)})}canGoBack(S=1,Q){return this.stackCtrl.canGoBack(S,Q)}pop(S=1,Q){return this.stackCtrl.pop(S,Q)}getLastUrl(S){const Q=this.stackCtrl.getLastUrl(S);return Q?Q.url:void 0}getLastRouteView(S){return this.stackCtrl.getLastUrl(S)}getRootView(S){return this.stackCtrl.getRootUrl(S)}getActiveStackId(){return this.stackCtrl.getActiveStackId()}createActivatedRouteProxy(S,Q){const Ee=new Dt.gz;return Ee._futureSnapshot=Q._futureSnapshot,Ee._routerState=Q._routerState,Ee.snapshot=Q.snapshot,Ee.outlet=Q.outlet,Ee.component=Q.component,Ee._paramMap=this.proxyObservable(S,"paramMap"),Ee._queryParamMap=this.proxyObservable(S,"queryParamMap"),Ee.url=this.proxyObservable(S,"url"),Ee.params=this.proxyObservable(S,"params"),Ee.queryParams=this.proxyObservable(S,"queryParams"),Ee.fragment=this.proxyObservable(S,"fragment"),Ee.data=this.proxyObservable(S,"data"),Ee}proxyObservable(S,Q){return S.pipe((0,De.h)(Ee=>!!Ee),(0,dt.w)(Ee=>this.currentActivatedRoute$.pipe((0,De.h)(wn=>null!==wn&&wn.component===Ee),(0,dt.w)(wn=>wn&&wn.activatedRoute[Q]),(0,Lt.x)())))}updateActivatedRouteProxy(S,Q){const Ee=this.proxyMap.get(S);if(!Ee)throw new Error("Could not find activated route proxy for view");Ee._futureSnapshot=Q._futureSnapshot,Ee._routerState=Q._routerState,Ee.snapshot=Q.snapshot,Ee.outlet=Q.outlet,Ee.component=Q.component,this.currentActivatedRoute$.next({component:S,activatedRoute:Q})}}return T.\u0275fac=function(S){return new(S||T)(b.$8M("name"),b.$8M("tabs"),b.Y36(ft.Ye),b.Y36(b.SBq),b.Y36(Dt.F0),b.Y36(b.R0b),b.Y36(Dt.gz),b.Y36(T,12))},T.\u0275dir=b.lG2({type:T,selectors:[["ion-router-outlet"]],inputs:{animated:"animated",animation:"animation",mode:"mode",swipeGesture:"swipeGesture",name:"name"},outputs:{stackEvents:"stackEvents",activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),T})();class xi{constructor(K,S,Q){this.route=K,this.childContexts=S,this.parent=Q}get(K,S){return K===Dt.gz?this.route:K===Dt.y6?this.childContexts:this.parent.get(K,S)}}const Fo=new b.OlP("");let Fs=(()=>{class T{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(S){this.unsubscribeFromRouteData(S),this.subscribeToRouteData(S)}unsubscribeFromRouteData(S){this.outletDataSubscriptions.get(S)?.unsubscribe(),this.outletDataSubscriptions.delete(S)}subscribeToRouteData(S){const{activatedRoute:Q}=S,Ee=(0,pt.a)([Q.queryParams,Q.params,Q.data]).pipe((0,dt.w)(([wn,ai,oi],Lr)=>(oi={...wn,...ai,...oi},0===Lr?(0,yt.of)(oi):Promise.resolve(oi)))).subscribe(wn=>{if(!S.isActivated||!S.activatedComponentRef||S.activatedRoute!==Q||null===Q.component)return void this.unsubscribeFromRouteData(S);const ai=(0,b.qFp)(Q.component);if(ai)for(const{templateName:oi}of ai.inputs)S.activatedComponentRef.setInput(oi,wn[oi]);else this.unsubscribeFromRouteData(S)});this.outletDataSubscriptions.set(S,Ee)}}return T.\u0275fac=function(S){return new(S||T)},T.\u0275prov=b.Yz7({token:T,factory:T.\u0275fac}),T})(),kr=(()=>{class T{constructor(S,Q,Ee){this.routerOutlet=S,this.navCtrl=Q,this.config=Ee}onClick(S){const Q=this.defaultHref||this.config.get("backButtonDefaultHref");this.routerOutlet?.canGoBack()?(this.navCtrl.setDirection("back",void 0,void 0,this.routerAnimation),this.routerOutlet.pop(),S.preventDefault()):null!=Q&&(this.navCtrl.navigateBack(Q,{animation:this.routerAnimation}),S.preventDefault())}}return T.\u0275fac=function(S){return new(S||T)(b.Y36(So,8),b.Y36(ao),b.Y36(Fi))},T.\u0275dir=b.lG2({type:T,selectors:[["ion-back-button"]],hostBindings:function(S,Q){1&S&&b.NdJ("click",function(wn){return Q.onClick(wn)})},inputs:{defaultHref:"defaultHref",routerAnimation:"routerAnimation"}}),T})(),xs=(()=>{class T{constructor(S,Q,Ee,wn,ai){this.locationStrategy=S,this.navCtrl=Q,this.elementRef=Ee,this.router=wn,this.routerLink=ai,this.routerDirection="forward"}ngOnInit(){this.updateTargetUrlAndHref()}ngOnChanges(){this.updateTargetUrlAndHref()}updateTargetUrlAndHref(){if(this.routerLink?.urlTree){const S=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.routerLink.urlTree));this.elementRef.nativeElement.href=S}}onClick(S){this.navCtrl.setDirection(this.routerDirection,void 0,void 0,this.routerAnimation),S.preventDefault()}}return T.\u0275fac=function(S){return new(S||T)(b.Y36(ft.S$),b.Y36(ao),b.Y36(b.SBq),b.Y36(Dt.F0),b.Y36(Dt.rH,8))},T.\u0275dir=b.lG2({type:T,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(S,Q){1&S&&b.NdJ("click",function(wn){return Q.onClick(wn)})},inputs:{routerDirection:"routerDirection",routerAnimation:"routerAnimation"},features:[b.TTD]}),T})();class Ji{constructor(K){this.ctrl=K}create(K){return this.ctrl.create(K||{})}dismiss(K,S,Q){return this.ctrl.dismiss(K,S,Q)}getTop(){return this.ctrl.getTop()}}let Ns=(()=>{class T extends Ji{constructor(){super(Tt.m),this.angularDelegate=(0,b.f3M)(Ii),this.injector=(0,b.f3M)(b.zs3),this.environmentInjector=(0,b.f3M)(b.lqb)}create(S){return super.create({...S,delegate:this.angularDelegate.create(this.environmentInjector,this.injector,"modal")})}}return T.\u0275fac=function(S){return new(S||T)},T.\u0275prov=b.Yz7({token:T,factory:T.\u0275fac}),T})(),da=(()=>{class T extends Ji{constructor(){super(Tt.c),this.angularDelegate=(0,b.f3M)(Ii),this.injector=(0,b.f3M)(b.zs3),this.environmentInjector=(0,b.f3M)(b.lqb)}create(S){return super.create({...S,delegate:this.angularDelegate.create(this.environmentInjector,this.injector,"popover")})}}return T.\u0275fac=function(S){return new(S||T)},T.\u0275prov=b.Yz7({token:T,factory:T.\u0275fac}),T})(),Ho=(()=>{class T extends Ji{constructor(){super(Tt.t)}}return T.\u0275fac=function(S){return new(S||T)},T.\u0275prov=b.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();class Ka{shouldDetach(K){return!1}shouldAttach(K){return!1}store(K,S){}retrieve(K){return null}shouldReuseRoute(K,S){if(K.routeConfig!==S.routeConfig)return!1;const Q=K.params,Ee=S.params,wn=Object.keys(Q),ai=Object.keys(Ee);if(wn.length!==ai.length)return!1;for(const oi of wn)if(Ee[oi]!==Q[oi])return!1;return!0}}const jr=(T,K,S)=>()=>{if(K.defaultView&&typeof window<"u"){(0,Ct.s)({...T,_zoneGate:wn=>S.run(wn)});const Ee="__zone_symbol__addEventListener"in K.body?"__zone_symbol__addEventListener":"addEventListener";return function pn(){var T=[];if(typeof window<"u"){var K=window;(!K.customElements||K.Element&&(!K.Element.prototype.closest||!K.Element.prototype.matches||!K.Element.prototype.remove||!K.Element.prototype.getRootNode))&&T.push(le.e(6748).then(le.t.bind(le,3342,23))),("function"!=typeof Object.assign||!Object.entries||!Array.prototype.find||!Array.prototype.includes||!String.prototype.startsWith||!String.prototype.endsWith||K.NodeList&&!K.NodeList.prototype.forEach||!K.fetch||!function(){try{var Q=new URL("b","http://a");return Q.pathname="c%20d","http://a/c%20d"===Q.href&&Q.searchParams}catch{return!1}}()||typeof WeakMap>"u")&&T.push(le.e(2214).then(le.t.bind(le,2668,23)))}return Promise.all(T)}().then(()=>((T,K)=>typeof window>"u"?Promise.resolve():(0,$t.p)().then(()=>(hn(),(0,$t.b)(JSON.parse('[["ion-menu_3",[[33,"ion-menu-button",{"color":[513],"disabled":[4],"menu":[1],"autoHide":[4,"auto-hide"],"type":[1],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]],[33,"ion-menu",{"contentId":[513,"content-id"],"menuId":[513,"menu-id"],"type":[1025],"disabled":[1028],"side":[513],"swipeGesture":[4,"swipe-gesture"],"maxEdgeStart":[2,"max-edge-start"],"isPaneVisible":[32],"isEndSide":[32],"isOpen":[64],"isActive":[64],"open":[64],"close":[64],"toggle":[64],"setOpen":[64]},[[16,"ionSplitPaneVisible","onSplitPaneChanged"],[2,"click","onBackdropClick"],[0,"keydown","onKeydown"]]],[1,"ion-menu-toggle",{"menu":[1],"autoHide":[4,"auto-hide"],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]]]],["ion-fab_3",[[33,"ion-fab-button",{"color":[513],"activated":[4],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1],"show":[4],"translucent":[4],"type":[1],"size":[1],"closeIcon":[1,"close-icon"]}],[1,"ion-fab",{"horizontal":[1],"vertical":[1],"edge":[4],"activated":[1028],"close":[64],"toggle":[64]}],[1,"ion-fab-list",{"activated":[4],"side":[1]}]]],["ion-refresher_2",[[0,"ion-refresher-content",{"pullingIcon":[1025,"pulling-icon"],"pullingText":[1,"pulling-text"],"refreshingSpinner":[1025,"refreshing-spinner"],"refreshingText":[1,"refreshing-text"]}],[32,"ion-refresher",{"pullMin":[2,"pull-min"],"pullMax":[2,"pull-max"],"closeDuration":[1,"close-duration"],"snapbackDuration":[1,"snapback-duration"],"pullFactor":[2,"pull-factor"],"disabled":[4],"nativeRefresher":[32],"state":[32],"complete":[64],"cancel":[64],"getProgress":[64]}]]],["ion-back-button",[[33,"ion-back-button",{"color":[513],"defaultHref":[1025,"default-href"],"disabled":[516],"icon":[1],"text":[1],"type":[1],"routerAnimation":[16]}]]],["ion-toast",[[33,"ion-toast",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"color":[513],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"duration":[2],"header":[1],"layout":[1],"message":[1],"keyboardClose":[4,"keyboard-close"],"position":[1],"buttons":[16],"translucent":[4],"animated":[4],"icon":[1],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"revealContentToScreenReader":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-card_5",[[33,"ion-card",{"color":[513],"button":[4],"type":[1],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}],[32,"ion-card-content"],[33,"ion-card-header",{"color":[513],"translucent":[4]}],[33,"ion-card-subtitle",{"color":[513]}],[33,"ion-card-title",{"color":[513]}]]],["ion-item-option_3",[[33,"ion-item-option",{"color":[513],"disabled":[4],"download":[1],"expandable":[4],"href":[1],"rel":[1],"target":[1],"type":[1]}],[32,"ion-item-options",{"side":[1],"fireSwipeEvent":[64]}],[0,"ion-item-sliding",{"disabled":[4],"state":[32],"getOpenAmount":[64],"getSlidingRatio":[64],"open":[64],"close":[64],"closeOpened":[64]}]]],["ion-accordion_2",[[49,"ion-accordion",{"value":[1],"disabled":[4],"readonly":[4],"toggleIcon":[1,"toggle-icon"],"toggleIconSlot":[1,"toggle-icon-slot"],"state":[32],"isNext":[32],"isPrevious":[32]}],[33,"ion-accordion-group",{"animated":[4],"multiple":[4],"value":[1025],"disabled":[4],"readonly":[4],"expand":[1],"requestAccordionToggle":[64],"getAccordions":[64]},[[0,"keydown","onKeydown"]]]]],["ion-infinite-scroll_2",[[32,"ion-infinite-scroll-content",{"loadingSpinner":[1025,"loading-spinner"],"loadingText":[1,"loading-text"]}],[0,"ion-infinite-scroll",{"threshold":[1],"disabled":[4],"position":[1],"isLoading":[32],"complete":[64]}]]],["ion-reorder_2",[[33,"ion-reorder",null,[[2,"click","onClick"]]],[0,"ion-reorder-group",{"disabled":[4],"state":[32],"complete":[64]}]]],["ion-segment_2",[[33,"ion-segment-button",{"disabled":[1028],"layout":[1],"type":[1],"value":[8],"checked":[32],"setFocus":[64]}],[33,"ion-segment",{"color":[513],"disabled":[4],"scrollable":[4],"swipeGesture":[4,"swipe-gesture"],"value":[1032],"selectOnFocus":[4,"select-on-focus"],"activated":[32]},[[0,"keydown","onKeyDown"]]]]],["ion-tab-bar_2",[[33,"ion-tab-button",{"disabled":[4],"download":[1],"href":[1],"rel":[1],"layout":[1025],"selected":[1028],"tab":[1],"target":[1]},[[8,"ionTabBarChanged","onTabBarChanged"]]],[33,"ion-tab-bar",{"color":[513],"selectedTab":[1,"selected-tab"],"translucent":[4],"keyboardVisible":[32]}]]],["ion-chip",[[1,"ion-chip",{"color":[513],"outline":[4],"disabled":[4]}]]],["ion-datetime-button",[[33,"ion-datetime-button",{"color":[513],"disabled":[516],"datetime":[1],"datetimePresentation":[32],"dateText":[32],"timeText":[32],"datetimeActive":[32],"selectedButton":[32]}]]],["ion-input",[[38,"ion-input",{"color":[513],"accept":[1],"autocapitalize":[1],"autocomplete":[1],"autocorrect":[1],"autofocus":[4],"clearInput":[4,"clear-input"],"clearOnEdit":[4,"clear-on-edit"],"counter":[4],"counterFormatter":[16],"debounce":[2],"disabled":[4],"enterkeyhint":[1],"errorText":[1,"error-text"],"fill":[1],"inputmode":[1],"helperText":[1,"helper-text"],"label":[1],"labelPlacement":[1,"label-placement"],"legacy":[4],"max":[8],"maxlength":[2],"min":[8],"minlength":[2],"multiple":[4],"name":[1],"pattern":[1],"placeholder":[1],"readonly":[4],"required":[4],"shape":[1],"spellcheck":[4],"step":[1],"size":[2],"type":[1],"value":[1032],"hasFocus":[32],"setFocus":[64],"getInputElement":[64]}]]],["ion-searchbar",[[34,"ion-searchbar",{"color":[513],"animated":[4],"autocomplete":[1],"autocorrect":[1],"cancelButtonIcon":[1,"cancel-button-icon"],"cancelButtonText":[1,"cancel-button-text"],"clearIcon":[1,"clear-icon"],"debounce":[2],"disabled":[4],"inputmode":[1],"enterkeyhint":[1],"name":[1],"placeholder":[1],"searchIcon":[1,"search-icon"],"showCancelButton":[1,"show-cancel-button"],"showClearButton":[1,"show-clear-button"],"spellcheck":[4],"type":[1],"value":[1025],"focused":[32],"noAnimate":[32],"setFocus":[64],"getInputElement":[64]}]]],["ion-toggle",[[33,"ion-toggle",{"color":[513],"name":[1],"checked":[1028],"disabled":[4],"value":[1],"enableOnOffLabels":[4,"enable-on-off-labels"],"labelPlacement":[1,"label-placement"],"legacy":[4],"justify":[1],"activated":[32]}]]],["ion-nav_2",[[1,"ion-nav",{"delegate":[16],"swipeGesture":[1028,"swipe-gesture"],"animated":[4],"animation":[16],"rootParams":[16],"root":[1],"push":[64],"insert":[64],"insertPages":[64],"pop":[64],"popTo":[64],"popToRoot":[64],"removeIndex":[64],"setRoot":[64],"setPages":[64],"setRouteId":[64],"getRouteId":[64],"getActive":[64],"getByIndex":[64],"canGoBack":[64],"getPrevious":[64]}],[0,"ion-nav-link",{"component":[1],"componentProps":[16],"routerDirection":[1,"router-direction"],"routerAnimation":[16]}]]],["ion-textarea",[[38,"ion-textarea",{"color":[513],"autocapitalize":[1],"autofocus":[4],"clearOnEdit":[4,"clear-on-edit"],"debounce":[2],"disabled":[4],"fill":[1],"inputmode":[1],"enterkeyhint":[1],"maxlength":[2],"minlength":[2],"name":[1],"placeholder":[1],"readonly":[4],"required":[4],"spellcheck":[4],"cols":[2],"rows":[2],"wrap":[1],"autoGrow":[516,"auto-grow"],"value":[1025],"counter":[4],"counterFormatter":[16],"errorText":[1,"error-text"],"helperText":[1,"helper-text"],"label":[1],"labelPlacement":[1,"label-placement"],"legacy":[4],"shape":[1],"hasFocus":[32],"setFocus":[64],"getInputElement":[64]}]]],["ion-backdrop",[[33,"ion-backdrop",{"visible":[4],"tappable":[4],"stopPropagation":[4,"stop-propagation"]},[[2,"click","onMouseDown"]]]]],["ion-loading",[[34,"ion-loading",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"message":[1],"cssClass":[1,"css-class"],"duration":[2],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"spinner":[1025],"translucent":[4],"animated":[4],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-breadcrumb_2",[[33,"ion-breadcrumb",{"collapsed":[4],"last":[4],"showCollapsedIndicator":[4,"show-collapsed-indicator"],"color":[1],"active":[4],"disabled":[4],"download":[1],"href":[1],"rel":[1],"separator":[4],"target":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16]}],[33,"ion-breadcrumbs",{"color":[513],"maxItems":[2,"max-items"],"itemsBeforeCollapse":[2,"items-before-collapse"],"itemsAfterCollapse":[2,"items-after-collapse"],"collapsed":[32],"activeChanged":[32]},[[0,"collapsedClick","onCollapsedClick"]]]]],["ion-modal",[[33,"ion-modal",{"hasController":[4,"has-controller"],"overlayIndex":[2,"overlay-index"],"delegate":[16],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"breakpoints":[16],"initialBreakpoint":[2,"initial-breakpoint"],"backdropBreakpoint":[2,"backdrop-breakpoint"],"handle":[4],"handleBehavior":[1,"handle-behavior"],"component":[1],"componentProps":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"animated":[4],"presentingElement":[16],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"keepContentsMounted":[4,"keep-contents-mounted"],"canDismiss":[4,"can-dismiss"],"presented":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64],"setCurrentBreakpoint":[64],"getCurrentBreakpoint":[64]}]]],["ion-route_4",[[0,"ion-route",{"url":[1],"component":[1],"componentProps":[16],"beforeLeave":[16],"beforeEnter":[16]}],[0,"ion-route-redirect",{"from":[1],"to":[1]}],[0,"ion-router",{"root":[1],"useHash":[4,"use-hash"],"canTransition":[64],"push":[64],"back":[64],"printDebug":[64],"navChanged":[64]},[[8,"popstate","onPopState"],[4,"ionBackButton","onBackButton"]]],[1,"ion-router-link",{"color":[513],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}]]],["ion-avatar_3",[[33,"ion-avatar"],[33,"ion-badge",{"color":[513]}],[1,"ion-thumbnail"]]],["ion-col_3",[[1,"ion-col",{"offset":[1],"offsetXs":[1,"offset-xs"],"offsetSm":[1,"offset-sm"],"offsetMd":[1,"offset-md"],"offsetLg":[1,"offset-lg"],"offsetXl":[1,"offset-xl"],"pull":[1],"pullXs":[1,"pull-xs"],"pullSm":[1,"pull-sm"],"pullMd":[1,"pull-md"],"pullLg":[1,"pull-lg"],"pullXl":[1,"pull-xl"],"push":[1],"pushXs":[1,"push-xs"],"pushSm":[1,"push-sm"],"pushMd":[1,"push-md"],"pushLg":[1,"push-lg"],"pushXl":[1,"push-xl"],"size":[1],"sizeXs":[1,"size-xs"],"sizeSm":[1,"size-sm"],"sizeMd":[1,"size-md"],"sizeLg":[1,"size-lg"],"sizeXl":[1,"size-xl"]},[[9,"resize","onResize"]]],[1,"ion-grid",{"fixed":[4]}],[1,"ion-row"]]],["ion-tab_2",[[1,"ion-tab",{"active":[1028],"delegate":[16],"tab":[1],"component":[1],"setActive":[64]}],[1,"ion-tabs",{"useRouter":[1028,"use-router"],"selectedTab":[32],"select":[64],"getTab":[64],"getSelected":[64],"setRouteId":[64],"getRouteId":[64]}]]],["ion-img",[[1,"ion-img",{"alt":[1],"src":[1],"loadSrc":[32],"loadError":[32]}]]],["ion-progress-bar",[[33,"ion-progress-bar",{"type":[1],"reversed":[4],"value":[2],"buffer":[2],"color":[513]}]]],["ion-range",[[33,"ion-range",{"color":[513],"debounce":[2],"name":[1],"label":[1],"dualKnobs":[4,"dual-knobs"],"min":[2],"max":[2],"pin":[4],"pinFormatter":[16],"snaps":[4],"step":[2],"ticks":[4],"activeBarStart":[1026,"active-bar-start"],"disabled":[4],"value":[1026],"labelPlacement":[1,"label-placement"],"legacy":[4],"ratioA":[32],"ratioB":[32],"pressedKnob":[32]}]]],["ion-split-pane",[[33,"ion-split-pane",{"contentId":[513,"content-id"],"disabled":[4],"when":[8],"visible":[32]}]]],["ion-text",[[1,"ion-text",{"color":[513]}]]],["ion-item_8",[[33,"ion-item-divider",{"color":[513],"sticky":[4]}],[32,"ion-item-group"],[1,"ion-skeleton-text",{"animated":[4]}],[32,"ion-list",{"lines":[1],"inset":[4],"closeSlidingItems":[64]}],[33,"ion-list-header",{"color":[513],"lines":[1]}],[49,"ion-item",{"color":[513],"button":[4],"detail":[4],"detailIcon":[1,"detail-icon"],"disabled":[4],"download":[1],"fill":[1],"shape":[1],"href":[1],"rel":[1],"lines":[1],"counter":[4],"routerAnimation":[16],"routerDirection":[1,"router-direction"],"target":[1],"type":[1],"counterFormatter":[16],"multipleInputs":[32],"focusable":[32],"counterString":[32]},[[0,"ionInput","handleIonInput"],[0,"ionColor","labelColorChanged"],[0,"ionStyle","itemStyle"]]],[34,"ion-label",{"color":[513],"position":[1],"noAnimate":[32]}],[33,"ion-note",{"color":[513]}]]],["ion-select_3",[[33,"ion-select",{"cancelText":[1,"cancel-text"],"color":[513],"compareWith":[1,"compare-with"],"disabled":[4],"fill":[1],"interface":[1],"interfaceOptions":[8,"interface-options"],"justify":[1],"label":[1],"labelPlacement":[1,"label-placement"],"legacy":[4],"multiple":[4],"name":[1],"okText":[1,"ok-text"],"placeholder":[1],"selectedText":[1,"selected-text"],"toggleIcon":[1,"toggle-icon"],"expandedIcon":[1,"expanded-icon"],"shape":[1],"value":[1032],"isExpanded":[32],"open":[64]}],[1,"ion-select-option",{"disabled":[4],"value":[8]}],[34,"ion-select-popover",{"header":[1],"subHeader":[1,"sub-header"],"message":[1],"multiple":[4],"options":[16]}]]],["ion-picker-internal",[[33,"ion-picker-internal",{"exitInputMode":[64]},[[1,"touchstart","preventTouchStartPropagation"]]]]],["ion-datetime_3",[[33,"ion-datetime",{"color":[1],"name":[1],"disabled":[4],"readonly":[4],"isDateEnabled":[16],"min":[1025],"max":[1025],"presentation":[1],"cancelText":[1,"cancel-text"],"doneText":[1,"done-text"],"clearText":[1,"clear-text"],"yearValues":[8,"year-values"],"monthValues":[8,"month-values"],"dayValues":[8,"day-values"],"hourValues":[8,"hour-values"],"minuteValues":[8,"minute-values"],"locale":[1],"firstDayOfWeek":[2,"first-day-of-week"],"titleSelectedDatesFormatter":[16],"multiple":[4],"highlightedDates":[16],"value":[1025],"showDefaultTitle":[4,"show-default-title"],"showDefaultButtons":[4,"show-default-buttons"],"showClearButton":[4,"show-clear-button"],"showDefaultTimeLabel":[4,"show-default-time-label"],"hourCycle":[1,"hour-cycle"],"size":[1],"preferWheel":[4,"prefer-wheel"],"showMonthAndYear":[32],"activeParts":[32],"workingParts":[32],"isTimePopoverOpen":[32],"confirm":[64],"reset":[64],"cancel":[64]}],[34,"ion-picker",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"columns":[16],"cssClass":[1,"css-class"],"duration":[2],"showBackdrop":[4,"show-backdrop"],"backdropDismiss":[4,"backdrop-dismiss"],"animated":[4],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"presented":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64],"getColumn":[64]}],[32,"ion-picker-column",{"col":[16]}]]],["ion-radio_2",[[33,"ion-radio",{"color":[513],"name":[1],"disabled":[4],"value":[8],"labelPlacement":[1,"label-placement"],"legacy":[4],"justify":[1],"checked":[32],"buttonTabindex":[32],"setFocus":[64],"setButtonTabindex":[64]}],[0,"ion-radio-group",{"allowEmptySelection":[4,"allow-empty-selection"],"name":[1],"value":[1032]},[[4,"keydown","onKeydown"]]]]],["ion-ripple-effect",[[1,"ion-ripple-effect",{"type":[1],"addRipple":[64]}]]],["ion-button_2",[[33,"ion-button",{"color":[513],"buttonType":[1025,"button-type"],"disabled":[516],"expand":[513],"fill":[1537],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"download":[1],"href":[1],"rel":[1],"shape":[513],"size":[513],"strong":[4],"target":[1],"type":[1],"form":[1]}],[1,"ion-icon",{"mode":[1025],"color":[1],"ios":[1],"md":[1],"flipRtl":[4,"flip-rtl"],"name":[513],"src":[1],"icon":[8],"size":[1],"lazy":[4],"sanitize":[4],"svgContent":[32],"isVisible":[32]}]]],["ion-action-sheet",[[34,"ion-action-sheet",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"header":[1],"subHeader":[1,"sub-header"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-alert",[[34,"ion-alert",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"header":[1],"subHeader":[1,"sub-header"],"message":[1],"buttons":[16],"inputs":[1040],"backdropDismiss":[4,"backdrop-dismiss"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},[[4,"keydown","onKeydown"]]]]],["ion-app_8",[[0,"ion-app",{"setFocus":[64]}],[1,"ion-content",{"color":[513],"fullscreen":[4],"forceOverscroll":[1028,"force-overscroll"],"scrollX":[4,"scroll-x"],"scrollY":[4,"scroll-y"],"scrollEvents":[4,"scroll-events"],"getScrollElement":[64],"getBackgroundElement":[64],"scrollToTop":[64],"scrollToBottom":[64],"scrollByPoint":[64],"scrollToPoint":[64]},[[8,"appload","onAppLoad"],[9,"resize","onResize"]]],[36,"ion-footer",{"collapse":[1],"translucent":[4],"keyboardVisible":[32]}],[36,"ion-header",{"collapse":[1],"translucent":[4]}],[1,"ion-router-outlet",{"mode":[1025],"delegate":[16],"animated":[4],"animation":[16],"swipeHandler":[16],"commit":[64],"setRouteId":[64],"getRouteId":[64]}],[33,"ion-title",{"color":[513],"size":[1]}],[33,"ion-toolbar",{"color":[513]},[[0,"ionStyle","childrenStyle"]]],[34,"ion-buttons",{"collapse":[4]}]]],["ion-picker-column-internal",[[33,"ion-picker-column-internal",{"items":[16],"value":[1032],"color":[513],"numericInput":[4,"numeric-input"],"isActive":[32],"scrollActiveItemIntoView":[64],"setValue":[64]}]]],["ion-popover",[[33,"ion-popover",{"hasController":[4,"has-controller"],"delegate":[16],"overlayIndex":[2,"overlay-index"],"enterAnimation":[16],"leaveAnimation":[16],"component":[1],"componentProps":[16],"keyboardClose":[4,"keyboard-close"],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"event":[8],"showBackdrop":[4,"show-backdrop"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"triggerAction":[1,"trigger-action"],"trigger":[1],"size":[1],"dismissOnSelect":[4,"dismiss-on-select"],"reference":[1],"side":[1],"alignment":[1025],"arrow":[4],"isOpen":[4,"is-open"],"keyboardEvents":[4,"keyboard-events"],"keepContentsMounted":[4,"keep-contents-mounted"],"presented":[32],"presentFromTrigger":[64],"present":[64],"dismiss":[64],"getParentPopover":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-checkbox",[[33,"ion-checkbox",{"color":[513],"name":[1],"checked":[1028],"indeterminate":[1028],"disabled":[4],"value":[8],"labelPlacement":[1,"label-placement"],"justify":[1],"legacy":[4]}]]],["ion-spinner",[[1,"ion-spinner",{"color":[513],"duration":[2],"name":[1],"paused":[4]}]]]]'),K))))(0,{exclude:["ion-tabs","ion-tab"],syncQueue:!0,raf:en,jmp:wn=>S.runOutsideAngular(wn),ael(wn,ai,oi,Lr){wn[Ee](ai,oi,Lr)},rel(wn,ai,oi,Lr){wn.removeEventListener(ai,oi,Lr)}}))}};let zs=(()=>{class T{static forRoot(S){return{ngModule:T,providers:[{provide:br,useValue:S},{provide:b.ip1,useFactory:jr,multi:!0,deps:[br,ft.K0,b.R0b]},{provide:Fo,useFactory:ms,deps:[Dt.F0]}]}}}return T.\u0275fac=function(S){return new(S||T)},T.\u0275mod=b.oAB({type:T}),T.\u0275inj=b.cJS({providers:[Ii,Ns,da],imports:[ft.ez]}),T})();function ms(T){return T?.componentInputBindingEnabled?new Fs:null}},5861:(ci,Qt,le)=>{"use strict";function M(Ft,l,Me,ht,Ke,pt,yt){try{var Dt=Ft[pt](yt),st=Dt.value}catch(bt){return void Me(bt)}Dt.done?l(st):Promise.resolve(st).then(ht,Ke)}function b(Ft){return function(){var l=this,Me=arguments;return new Promise(function(ht,Ke){var pt=Ft.apply(l,Me);function yt(st){M(pt,ht,Ke,yt,Dt,"next",st)}function Dt(st){M(pt,ht,Ke,yt,Dt,"throw",st)}yt(void 0)})}}le.d(Qt,{Z:()=>b})},7582:(ci,Qt,le)=>{"use strict";function Me(Re,Ne,at,At){var Zn,en=arguments.length,on=en<3?Ne:null===At?At=Object.getOwnPropertyDescriptor(Ne,at):At;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)on=Reflect.decorate(Re,Ne,at,At);else for(var ri=Re.length-1;ri>=0;ri--)(Zn=Re[ri])&&(on=(en<3?Zn(on):en>3?Zn(Ne,at,on):Zn(Ne,at))||on);return en>3&&on&&Object.defineProperty(Ne,at,on),on}function bt(Re,Ne,at,At){return new(at||(at=Promise))(function(on,Zn){function ri(xt){try{nn(At.next(xt))}catch(St){Zn(St)}}function Cn(xt){try{nn(At.throw(xt))}catch(St){Zn(St)}}function nn(xt){xt.done?on(xt.value):function en(on){return on instanceof at?on:new at(function(Zn){Zn(on)})}(xt.value).then(ri,Cn)}nn((At=At.apply(Re,Ne||[])).next())})}function Ze(Re){return this instanceof Ze?(this.v=Re,this):new Ze(Re)}function Fe(Re,Ne,at){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var en,At=at.apply(Re,Ne||[]),on=[];return en={},Zn("next"),Zn("throw"),Zn("return"),en[Symbol.asyncIterator]=function(){return this},en;function Zn(xn){At[xn]&&(en[xn]=function(Hn){return new Promise(function(yi,qn){on.push([xn,Hn,yi,qn])>1||ri(xn,Hn)})})}function ri(xn,Hn){try{!function Cn(xn){xn.value instanceof Ze?Promise.resolve(xn.value.v).then(nn,xt):St(on[0][2],xn)}(At[xn](Hn))}catch(yi){St(on[0][3],yi)}}function nn(xn){ri("next",xn)}function xt(xn){ri("throw",xn)}function St(xn,Hn){xn(Hn),on.shift(),on.length&&ri(on[0][0],on[0][1])}}function un(Re){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var at,Ne=Re[Symbol.asyncIterator];return Ne?Ne.call(Re):(Re=function Wt(Re){var Ne="function"==typeof Symbol&&Symbol.iterator,at=Ne&&Re[Ne],At=0;if(at)return at.call(Re);if(Re&&"number"==typeof Re.length)return{next:function(){return Re&&At>=Re.length&&(Re=void 0),{value:Re&&Re[At++],done:!Re}}};throw new TypeError(Ne?"Object is not iterable.":"Symbol.iterator is not defined.")}(Re),at={},At("next"),At("throw"),At("return"),at[Symbol.asyncIterator]=function(){return this},at);function At(on){at[on]=Re[on]&&function(Zn){return new Promise(function(ri,Cn){!function en(on,Zn,ri,Cn){Promise.resolve(Cn).then(function(nn){on({value:nn,done:ri})},Zn)}(ri,Cn,(Zn=Re[on](Zn)).done,Zn.value)})}}}le.d(Qt,{FC:()=>Fe,KL:()=>un,gn:()=>Me,mG:()=>bt,qq:()=>Ze}),"function"==typeof SuppressedError&&SuppressedError}},ci=>{ci(ci.s=3165)}]);